{
    "id": "riskDis",
    "text": "风险识别",
    "config":{
        // 展现的sql
        // "sql": "select a.nid as id, dim_company as company, b.sname as companyname, dim_period as period, dim_department as department, c.sname as departmentname, sriskname, sfilluser, screatetime, sriskdescription, nprobability, d.sname as probabilityname, ninfluence, e.sname as influencename, nscore, ngrade, f.sname as gradename, colormark as gradecolor, srisktype, g.sname as srisktypename,sreporttype, h.sname as sreporttypename, sissubmit, smeasures, sproposal, ssubmituser, ssubmittime,SORIGIN from(select * from risk_distinguish where (substr(screatetime,1,4) ||  substr(screatetime,6,2) ) :permissionDate and dim_company = :company) a left join dw_dimcompany b on a.dim_company = b.scode left join dw_dimdepartment c on a.dim_department = c.scode left join RISK_PROBABILITY d on a.nprobability = d.nid left join RISK_INFLUENCE_DEGREE e on a.ninfluence = e.nid left join RISK_MATRIX f on a.ngrade = f.nid left join RISK_TYPE g on a.srisktype = g.scode left join RISKREPORT_TYPE h on a.sreporttype = h.scode "
        // "sql": "SELECT a.nid AS id, dim_company AS company, b.sname AS companyname, dim_period AS period, dim_department AS department, nvl(c.sname, '无部门') AS departmentname, sriskname, sfilluser, screatetime, sriskdescription, nprobability, d.sname AS probabilityname, ninfluence, e.sname AS influencename, nscore, ngrade, f.sname AS gradename, colormark AS gradecolor, srisktype, g.sname AS srisktypename, sreporttype, h.sname AS sreporttypename, sissubmit, smeasures, sproposal, ssubmituser, ssubmittime, SORIGIN FROM( SELECT * FROM risk_distinguish WHERE ( SUBSTR(screatetime,1,4) || SUBSTR(screatetime,6,2)) :permissionDate AND dim_company = :company) a LEFT JOIN dw_dimcompany b ON a.dim_company = b.scode LEFT JOIN dw_dimdepartment c ON a.dim_department = c.scode and c.scomcode = a.dim_company LEFT JOIN RISK_PROBABILITY d ON a.nprobability = d.nid LEFT JOIN RISK_INFLUENCE_DEGREE e ON a.ninfluence = e.nid LEFT JOIN RISK_MATRIX f ON a.ngrade = f.nid LEFT JOIN RISK_TYPE g ON a.srisktype = g.scode LEFT JOIN RISKREPORT_TYPE h ON a.sreporttype = h.scode"
        // "sql": "SELECT a.nid AS id, dim_company AS company, b.sname AS companyname, a.dim_period AS period, a.dim_department AS department, NVL(c.sname, '无部门') AS departmentname, a.sriskname, a.sfilluser, a.screatetime, a.sriskdescription, a.nprobability, d.sname AS probabilityname, a.ninfluence, e.sname AS influencename, a.nscore, a.ngrade, f.sname AS gradename, colormark AS gradecolor, srisktype, g.sname AS srisktypename, a.sreporttype, h.sname AS sreporttypename, a.sissubmit, a.smeasures, a.sproposal, a.ssubmituser, a.ssubmittime, a.SORIGIN,a.sisclose as isclosename,case when i.sisreport is null or i.sisreport in('-1','0','2') then '-1' else '1' end as sisreport, case when i.sisreport is null or i.sisreport = '-1' then '未上报' when i.sisreport = '1' then '已上报' else '未上报' end as sisreport FROM( SELECT * FROM risk_distinguish WHERE ( SUBSTR(screatetime,1,4) || SUBSTR(screatetime,6,2)) :permissionDate AND dim_company = :company) a LEFT JOIN dw_dimcompany b ON a.dim_company = b.scode LEFT JOIN dw_dimdepartment c ON a.dim_department = c.scode AND c.scomcode = a.dim_company LEFT JOIN RISK_PROBABILITY d ON a.nprobability = d.nid LEFT JOIN RISK_INFLUENCE_DEGREE e ON a.ninfluence = e.nid LEFT JOIN RISK_MATRIX f ON a.ngrade = f.nid LEFT JOIN RISK_TYPE g ON a.srisktype = g.scode LEFT JOIN RISKREPORT_TYPE h ON a.sreporttype = h.scode"
        "sql": "SELECT a.nid AS id, a.dim_company AS company, b.sname AS companyname, a.dim_period AS period, a.dim_department AS department, NVL(c.sname, '无部门') AS departmentname, a.sriskname, a.sfilluser, a.screatetime, a.sriskdescription, a.nprobability, d.sname AS probabilityname, a.ninfluence, e.sname AS influencename, a.nscore, a.ngrade, f.sname AS gradename, colormark AS gradecolor, srisktype, g.sname AS srisktypename, a.sreporttype, h.sname AS sreporttypename, a.sissubmit, a.smeasures, a.sproposal, a.ssubmituser, a.ssubmittime, a.SORIGIN,a.sisclose as isclosename, case when i.sisreport is null or i.sisreport in('-1','0','2') then '-1' else '1' end as sisreport, case when i.sisreport is null or i.sisreport = '-1' then '未上报' when i.sisreport = '1' then '已上报' else '未上报' end as sisreportname FROM( SELECT * FROM risk_distinguish WHERE ( SUBSTR(screatetime,1,4) || SUBSTR(screatetime,6,2)) :permissionDate AND dim_company = :company) a LEFT JOIN dw_dimcompany b ON a.dim_company = b.scode LEFT JOIN dw_dimdepartment c ON a.dim_department = c.scode AND c.scomcode = a.dim_company LEFT JOIN RISK_PROBABILITY d ON a.nprobability = d.nid LEFT JOIN RISK_INFLUENCE_DEGREE e ON a.ninfluence = e.nid LEFT JOIN RISK_MATRIX f ON a.ngrade = f.nid LEFT JOIN RISK_TYPE g ON a.srisktype = g.scode LEFT JOIN RISKREPORT_TYPE h ON a.sreporttype = h.scode left join risk_reportstate i on a.nid = i.nrelateid",
        // 上报状态查看的sql
        "sql2": "select case when a.SISREPORT is null or a.sisreport in('-1','0','2') then '-1' else '1' end as sisreport, case when a.sisreport is null or a.sisreport = '-1' then '未上报' when a.sisreport = '1' then '已上报' else '未上报' end as sisreportname from(select SISREPORT from risk_reportstate where DIM_PERIOD = :period and DIM_COMPANY = :company) a"
    },
    "columns": [
        // {
        //     "id": "index",
        //     "text": "序号",
        //     "type": "index",
        //     "determine": false,
        //     "width": "60"
        // },
        // {
        //     "id": "selection",
        //     "determine": false,
        //     "type": "selection",
        //     "width": "60"
        // },
        {
            "id": "isclosename",
            "text": "风险状态",
            "type": "string",
            "determine": false,
            "width": "120"
        },
        {
            "id": "sissubmit",
            "text": "提交状态",
            "type": "string",
            "determine": false,
            "width": "120"
        },
        {
            "id": "sriskname",
            "text": "风险名称",
            "type": "string",
            "determine": false,
            "showOverflow": true,
            "width": "160"
        },
        {
            "id": "srisktypename",
            "text": "风险类型",
            "type": "string",
            "determine": false,
            "width": "160"
        },
        {
            "id": "gradename",
            "text": "风险等级",
            "type": "string",
            "determine": false,
            "width": "160"
        },
        {
            "id": "departmentname",
            "text": "填报部门",
            "type": "string",
            "determine": false,
            "width": "160"
        },
        {
            "id": "sfilluser",
            "text": "填报人",
            "type": "string",
            "determine": false,
            "width": "120"
        },
        {
            "id": "sorigin",
            "text": "风险来源",
            "type": "string",
            "determine": false,
            "width": "160"
        },
        {
            "id": "screatetime",
            "text": "提交时间",
            "type": "string",
            "determine": false,
            "width": "160"
        },
        {
            "id": "sriskdescription",
            "text": "风险概述",
            "type": "string",
            "showOverflow": true,
            "determine": false,
            "width": "160"
        },
        {
            "id": "probabilityname",
            "text": "风险发生概率",
            "type": "string",
            "determine": false,
            "width": "160"
        },
        {
            "id": "influencename",
            "text": "风险影响等级",
            "type": "string",
            "determine": false,
            "width": "160"
        },
        {
            "id": "nscore",
            "text": "风险分值",
            "type": "string",
            "determine": false,
            "width": "160"
        },
        {
            "id": "sreporttypename",
            "text": "报告类型",
            "type": "string",
            "determine": false,
            "width": "160"
        },
        {
            "id": "smeasures",
            "text": "采取措施",
            "type": "string",
            "determine": false,
            "showOverflow": true,
            "width": "160"
        },
        {
            "id": "sproposal",
            "text": "应对建议",
            "type": "string",
            "determine": false,
            "showOverflow": true,
            "width": "160"
        }
    ],
    "rows": [

    ],
    "queryDataBefore": function(params, obj, $this){
        // debugger
        let html = "" ;
        if($this.periodtype){
            html = "= :period" ; 
        }else{
            html = "<= :period and sisclose = 'N'" ; 
        }
        obj.config.sql = obj.config.sql.replace(/:permissionDate/g,html) ;
        params.sql = obj.config.sql ;
        return params ; 
    },
    "queryDataAfter": function(datas, $this){
        // debugger
        datas.forEach(res => {
            if(res.sissubmit == "N"){
                res.sissubmit = "未提交" ;
            }else{
                res.sissubmit = "已提交"
            }
            if(res.isclosename == "N"){
                res.isclosename = "未关闭"
            }else{
                res.isclosename = "已关闭"
            }
        });
        return datas ;
    },
    "drillProperties": ["sissubmit","isclosename"],
    "cellStyle": function({row, column, rowIndex, columnIndex}, $this){
        // debugger
        let css = "padding: 4px 0;";
        let pro = column.property;
        if (!pro) {
            return css;
        }
        // let record = row.row;
        let drillProperties = this.drillProperties;
        if (drillProperties.indexOf(pro) != -1) {
            if(row[pro] == "未提交"){
                let drill = "color: red; fontWeight: bold;" ;
                return css + drill ;
            }else if(row[pro] == "已提交"){
                let drill = "color: green; fontWeight: bold;" ;
                return css + drill ;
            }else if(row[pro] == "未关闭"){
                let drill = "color: red; fontWeight: bold;" ;
                return css + drill ;
            }else if(row[pro] == "已关闭"){
                let drill = "color: green; fontWeight: bold;" ;
                return css + drill ;
            }
        }else{
            return css ;
        }
    }
}