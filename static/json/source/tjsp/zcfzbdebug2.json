{
    "id": "888",
    "text": "钻取的树表",
    "layout": {
        "xtype": "column"
    },
    "show": true,
    "showDims": ["year", "month", "company", "conversion"],
    "items": [{
        "xtype": "elementTree",
        "id": "zcfzbej",
        "stype": true,
        "isUnfold": true, // 自动展开的配置
        "text": "资产负债表二级",
        "tableBefore": true,
        "extendDrillPeriod": true,
        "weight": 24,
        "show": true,
        "queryDataBefore": function(a, b, c) {
            // debugger
            // var pointItem = c.$store.pointItem;				
            b.sql = b.sql2;
            let len = c.items.length;
            let id = c.items[len - 1].id;
            b.sql = b.sql.replace(/:dimpoint/g, id);
            return a;

        },
        "queryDataAfter": function(data, vue) {
            let datas = [];
            // data.forEach(item => { // 没有数据的不显示行数据
            // 	if((item.qmye && item.qmye!=0) || (item.zje && item.zje!=0) || (item.sntq && item.sntq!=0) || (item.tbzje && item.tbzje!=0) || (item.cye && item.cye!=0)){
            // 		datas.push(item);
            // 	}
            // });
            return data;
        },
        "config": {
            "sql": "",
            "sql2": "SELECT D.ROOT_SCODE SCODE, D.SNAME GSMC, D.SPCODE SPCODE, SUM(NVL(QMYE, 0)) QMYE, SUM(NVL(ZJE, 0)) ZJE,(CASE WHEN SUM(NVL(FACT_A,0))=0 THEN 0 ELSE ROUND((SUM(QMYE)-SUM(FACT_A))*100/SUM(FACT_A), 4) END) AS ZJL, SUM(NVL(SNTQ, 0)) SNTQ, SUM(QMYE-SNTQ) TBZJE, (CASE WHEN SUM(SNTQ)=0 THEN 0 ELSE ROUND((SUM(QMYE-SNTQ)/SUM(SNTQ))*100, 4) END)TBZJL, SUM(NVL(BNYS, 0)) BNYS, SUM(NVL(CYE, 0)) CYE, (CASE WHEN SUM(NVL(BNYS,0))=0 THEN 0 ELSE ROUND(((SUM(QMYE)-SUM(BNYS))*100/SUM(BNYS)), 4) END) AS CYL FROM ((SELECT A.DIM_COMPANY AS GSBM, FACT_A,A.FACT_B AS QMYE, (A.FACT_B-A.FACT_A) AS ZJE, 0 AS SNTQ, 0 AS TBZJE, 0 AS BNYS, 0 AS CYE FROM DW_FACTFINANCEPOINT A, DW_DIMCOMPANY B WHERE A.DIM_COMPANY=B.SCODE AND A.DIM_ITEMPOINT=':dimpoint' AND A.DIM_PERIOD=:period AND DIM_COMPANY IN (SELECT SCODE FROM DW_DIMCOMPANY WHERE CISDEL='N' AND STYPE IN ('1','R') START WITH SCODE=:company CONNECT BY PRIOR SCODE = SPCODE)) UNION ALL (SELECT DIM_COMPANY AS GSBM,0 FACT_A,0 AS QMYE, 0 AS ZJE, FACT_B AS SNTQ, 0 AS TBZJE,0 AS BNYS, 0 AS CYE FROM DW_FACTFINANCEPOINT, DW_DIMCOMPANY B WHERE DIM_COMPANY=B.SCODE AND DIM_ITEMPOINT=':dimpoint' AND DIM_PERIOD=:comparePeriod AND DIM_COMPANY IN (SELECT SCODE FROM DW_DIMCOMPANY WHERE CISDEL='N' AND STYPE IN ('1','R') START WITH SCODE=:company CONNECT BY PRIOR SCODE = SPCODE)) UNION ALL (SELECT DIM_COMPANY AS GSBM,0 FACT_A,0 AS QMYE, 0 AS ZJE,0 AS SNTQ,0 AS TBZJE, FACT_C AS BNYS, (FACT_B-FACT_C) AS CYE FROM DW_FACTFINANCEPOINT, DW_DIMCOMPANY B WHERE DIM_COMPANY=B.SCODE AND DIM_ITEMPOINT=':dimpoint' AND DIM_PERIOD=:period AND DIM_COMPANY IN (SELECT SCODE FROM DW_DIMCOMPANY WHERE CISDEL='N' AND STYPE IN ('1','R') START WITH SCODE=:company CONNECT BY PRIOR SCODE = SPCODE))) H RIGHT JOIN (SELECT ROOT_SCODE,E.SCODE,F.SNAME,F.SPCODE FROM (SELECT CONNECT_BY_ROOT(SCODE) ROOT_SCODE,SCODE FROM DW_DIMCOMPANY WHERE CISDEL='N' AND STYPE IN('1','R') START WITH SCODE in (select scode from dw_dimcompany where cisdel = 'N' start with scode =:company connect by prior scode = spcode) CONNECT BY PRIOR SCODE = SPCODE) E INNER JOIN DW_DIMCOMPANY F ON E.ROOT_SCODE=F.SCODE)D ON D.SCODE = H.GSBM GROUP BY D.ROOT_SCODE,D.SNAME,D.SPCODE ORDER BY SCODE",
            "_cube": {
                "subject": "0001",
                "cubeId": 4
            },
            "generateVar": { //生成变量rows
                "periodCount": 2,
                "compareType": "-1&0",
                "reverse": true
            },
            "tableHeads": true,
            "mainDim": "itemperiod",
            "needDims": [
                "year",
                "month",
                "company",
                "conversion"
            ],
            "random": {
                "min": 100,
                "max": 100000
            },
            "type": 1
        },
        "columns": [

            // {
            // 	"id": "",
            // 	"type": "string",
            // 	"text": "",
            // 	"isTree":true
            // },
            {
                "id": "scode",
                "type": "string",
                "width": "180",
                "fixed": true,
                "text": "编码"
            },
            {
                "id": "gsmc",
                "type": "string",
                "width": "360px",
                "fixed": true,
                "text": "公司名称"
            },
            {
                "id": "qmye",
                "type": "decimal",
                "width": "200px",
                "align": "right",
                "text": "期末余额"
            },
            {
                "id": "",
                "type": "string",
                "text": "与年初比",
                "children": [{
                        "id": "zje",
                        "type": "decimal",
                        "width": "200px",
                        "align": "right",
                        "text": "增减额"
                    },
                    {
                        "id": "zjl",
                        "type": "decimal",
                        "width": "120",
                        "align": "right",
                        "conversion": "%",
                        "text": "增减率（%）"
                    }
                ]
            },
            {
                "id": "",
                "type": "string",
                "text": "与上年同期比",
                "children": [{
                        "id": "sntq",
                        "type": "decimal",
                        "width": "200px",
                        "align": "right",
                        "text": "上年同期"
                    },
                    {
                        "id": "tbzje",
                        "type": "decimal",
                        "width": "200px",
                        "align": "right",
                        "text": "同比增减额"
                    }, {
                        "id": "tbzjl",
                        "text": "同比增减率（%）",
                        "width": "160",
                        "align": "right",
                        "type": "decimal",
                        "conversion": "%"
                    }
                ]
            },
            {
                "id": "",
                "type": "string",
                "text": "预算数",
                "children": [{
                        "id": "bnys",
                        "type": "decimal",
                        "width": "200px",
                        "align": "right",
                        "text": "本年预算"
                    },
                    {
                        "id": "cye",
                        "type": "decimal",
                        "width": "200px",
                        "align": "right",
                        "text": "差异额"
                    },
                    {
                        "id": "cyl",
                        "type": "decimal",
                        "conversion": "%",
                        "width": "120",
                        "align": "right",
                        "text": "差异率（%）"
                    }
                ]
            }
        ],
        "rows": [],
        "levelProperties": { gsbm: "_level" }, //加缩进 可选 table
    }]
}