{
    "id": "0014100101",
    "text": "经营目标完成情况表",
    "layout": {
        "xtype": "tab"
    },
    "showDims": ["year","month","company","conversion"],
    "__queryDataAfter":function(data,$vue){//数据的后置处理
        let me = this;
        me.items[0].updateView = $vue.updateView;
        me.items[0].$vue = $vue;
        return data;
    },
    "config": {
        "sql": "WITH TMP1 AS( SELECT CONNECT_BY_ROOT SCODE AS ROOT_SCODE, SCODE FROM DW_DIMCOMPANY WHERE CISDEL='N' AND STYPE='1' CONNECT BY PRIOR SCODE = SPCODE), T1 AS( SELECT ROOT_SCODE,SCODE FROM TMP1 WHERE ROOT_SCODE IN( SELECT SCODE FROM DW_DIMCOMPANY WHERE CISDEL='N' START WITH SCODE=:company CONNECT BY PRIOR SCODE = SPCODE ) ) SELECT ROOT_SCODE AS GSBM,SNAME AS GSMC,SUM(KHJY)AS M1,SUM(LJWC) AS M2,ROUND(DECODE(SUM(KHJY),0,0,SUM(LJWC)/SUM(KHJY)),4) AS M3, SUM(SNTQWC) AS M4,SUM(ZJE) AS M5,ROUND(DECODE(SUM(SNTQWC),0,0,(SUM(LJWC)-SUM(SNTQWC))/SUM(SNTQWC)),4) AS M6, SUM(LRZEKHJY) AS M11, SUM(LRZELJWC) AS M12,ROUND(DECODE(SUM(LRZEKHJY),0,0,SUM(LRZELJWC)/SUM(LRZEKHJY)),4) AS M13, SUM(LRZESNTQWC) AS M14,SUM(LRZEZJE) AS M15,ROUND(DECODE(SUM(LRZESNTQWC),0,0,(SUM(LRZELJWC)-SUM(LRZESNTQWC))/SUM(LRZESNTQWC)),4) AS M16 FROM( SELECT ROOT_SCODE,SNAME,KHJY,LJWC, SNTQWC, LJWC-SNTQWC AS ZJE ,0 as LRZEKHJY,0 AS LRZELJWC,0 AS LRZESNTQWC,0 AS LRZEZJE FROM( SELECT T1.ROOT_SCODE,T1.SCODE,T2.KHJY ,T3.LJWC ,T3.SNTQWC FROM T1 LEFT JOIN (SELECT DIM_COMPANY,SUM(NVL(FACT_A,0)) KHJY FROM DW_FACTTARGETASSESSMENT_FILL WHERE DIM_PERIOD=:period AND DIM_COMPANY IN (SELECT SCODE FROM T1) GROUP BY DIM_COMPANY) T2 ON T1.SCODE=T2.DIM_COMPANY LEFT JOIN ( SELECT DIM_COMPANY,SUM(CASE WHEN DIM_PERIOD=:period THEN FACT_B ELSE 0 END) AS LJWC, SUM(CASE WHEN DIM_PERIOD=:comparePeriod THEN FACT_B ELSE 0 END) AS SNTQWC FROM DW_FACTFINANCEPERIOD WHERE DIM_COMPANY IN (SELECT SCODE FROM T1) AND DIM_ITEMPERIOD IN ('1416001') AND DIM_PERIOD IN(:comparePeriod,:period) GROUP BY DIM_COMPANY )T3 ON T1.SCODE = T3.DIM_COMPANY )T4 INNER JOIN (SELECT SCODE,SNAME FROM DW_DIMCOMPANY) TNAME ON T4.ROOT_SCODE =TNAME.SCODE UNION ALL SELECT ROOT_SCODE,SNAME,0 as KHJY,0 AS LJWC,0 AS SNTQWC,0 AS ZJE,LRZEKHJY ,LRZELJWC, LRZESNTQWC, LRZELJWC-LRZESNTQWC AS LRZEZJE FROM( SELECT T1.ROOT_SCODE,T1.SCODE,T2.LRZEKHJY ,T3.LRZELJWC ,T3.LRZESNTQWC FROM T1 LEFT JOIN (SELECT DIM_COMPANY,SUM(NVL(FACT_B,0)) LRZEKHJY FROM DW_FACTTARGETASSESSMENT_FILL WHERE DIM_PERIOD=:period AND DIM_COMPANY IN (SELECT SCODE FROM T1) GROUP BY DIM_COMPANY) T2 ON T1.SCODE=T2.DIM_COMPANY LEFT JOIN ( SELECT DIM_COMPANY,SUM(CASE WHEN DIM_PERIOD=:period THEN FACT_B ELSE 0 END) AS LRZELJWC, SUM(CASE WHEN DIM_PERIOD=:comparePeriod THEN FACT_B ELSE 0 END) AS LRZESNTQWC FROM DW_FACTFINANCEPERIOD WHERE DIM_COMPANY IN (SELECT SCODE FROM T1) AND DIM_ITEMPERIOD IN ('1403100') AND DIM_PERIOD IN(:comparePeriod,:period) GROUP BY DIM_COMPANY )T3 ON T1.SCODE = T3.DIM_COMPANY ) T4 INNER JOIN (SELECT SCODE,SNAME FROM DW_DIMCOMPANY) TNAME ON T4.ROOT_SCODE =TNAME.SCODE ) GROUP BY ROOT_SCODE,SNAME",
        "cube": {
            "cubeId": 4 ,
            "subject": "0002"
        },
        "mainDim":"itemperiod",
        "needDims":["year","month","company","conversion"],
        "random":{"min":100,"max":100000},
        "type":1 ,
        "tableHeads":true,
        "generateVar":{//生成变量rows
            "periodCount":2,
            "compareType":"-1&0",
            "reverse":true
        } 
    },
    "columns": [
        {
            "id": "",
            "type": "string",
            "text": "利润总额完成情况（万元）",
            "children":[{
                "id": "m11",
                "type": "decimal",
                "width":"150px",
                "text": "当年年考核目标建议值"
            },{
                "id": "m12",
                "type": "decimal",
                "width":"150px",
                "text": "累计完成"
            },{
                "id": "m13",
                "type": "decimal",
                "width":"150px",
                "text": "完成目标进度"
            },{
                "id": "",
                "type":"string",
                "text":"与上年同期比较",
                "children":[
                    {
                        "id": "m14",
                        "type":"decimal",
                        "text":"上年同期完成",
                        "width":"150px"
                    },
                    {
                        "id": "m15",
                        "type":"decimal",
                        "text":"增减额",
                        "width":"150px"
                    },
                    {
                        "id": "m16",
                        "type":"decimal",
                        "text":"增减率%",
                        "conversion":"%",
                        "width":"150px"
                    }
                ]
            }]
        },
        {
            "id": "gsbm",
            "type": "string",
            "width":"120px",
            "text": "公司编码"
        },
        {
            "id": "gsmc",
            "type": "string",
            "width":"320px",
            "text": "公司名称"
        },
        {
            "id": "",
            "type": "string",
            "text": "营业收入完成情况（万元）",
            "children":[{
                "id": "m1",
                "type": "decimal",
                "width":"150px",
                "text": "当年年考核目标建议值"
            },{
                "id": "m2",
                "type": "decimal",
                "width":"150px",
                "text": "累计完成"
            },{
                "id": "m3",
                "type": "decimal",
                "width":"150px",
                "text": "完成目标进度"
            },{
                "id": "",
                "type":"string",
                "text":"与上年同期比较",
                "children":[
                    {
                        "id": "m4",
                        "type":"decimal",
                        "text":"上年同期完成",
                        "width":"150px"
                    },
                    {
                        "id": "m5",
                        "type":"decimal",
                        "text":"增减额",
                        "width":"150px"
                    },
                    {
                        "id": "m6",
                        "type":"decimal",
                        "text":"增减率%",
                        "conversion":"%",
                        "width":"150px"
                    }
                ]
            }]
        }
    ],
    "rows": [],
    "items": [
        {
            "xtype": "bi-table",
            "id" : "jymbwcqkb",
            "stype": "tree",
            "text" : "经营目标完成情况表",
            "toolbar":[{    
                "id":"1",
                "text":"刷新",
                "xtype":"button",
                "cellStyle":{
                    "color":"black",
                    "background-color":"#189271"
                },
                "handler":function(vue,btn){
                    debugger
                    console.log(vue);
                    let $vue = vue.item.$vue;
                    $vue.closeTabTaget({}, $vue);
                    vue.item.updateView("company");
                }
            },{
                "id":"2",
                "text":"导出",
                "xtype":"button",
                "cellStyle":{
                    "color":"black",
                    "background-color":"#189271"
                },
                "handler":function(vue,btn){
                    debugger
                    console.log(vue);
                    vue.handleDownload(vue);
                }
            }]
        }
    ]
}