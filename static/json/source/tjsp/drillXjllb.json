{
    "id":"0033",
	"text":"二级穿透",
	"layout":{
		"xtype":"column"
	 },
	 "show":true,
    "items":[
        {
			// "xtype": "STreeGrid",
            "xtype": "elementTree",
            "id": "xjllbej",
            "stype": true,
            "isUnfold": true,// 自动展开的配置
            "text": "现金流量表二级",
            "showDims":["year","month","company","conversion"],
			"weight": 24,
            "show":true,
            "queryDataBefore":function(params,config,option){//替换sql中的:itemperiod
                debugger
                config.sql = config.sql1;//执行sql，但是设置sql1是为了sql中一直是:itemperiod
                let len = option.items.length;
                let id = option.items[len-1].id;//获取下钻科目的id
                config.sql = config.sql.replace(/:itemperiod/g,id);//全局替换:itemperiod
                return params;

            },
            "queryDataAfter":function(data,vue){
                // debugger
                let datas = [];
                // if(data && data.length==1)return data ; 
                // let is = data.some(res => {
                //     return (res.sntq && res.sntq!=0) || (res.tbzje && res.tbzje!=0) || (res.ljsj && res.ljsj!=0)
                // })
                // if(is) {
                    // data.forEach(item => { // 没有数据的不显示行数据
                    //     if((item.sntq && item.sntq!=0) || (item.tbzje && item.tbzje!=0) || (item.ljsj && item.ljsj!=0) || (item.cye && item.cye!=0)){
                    //         datas.push(item);
                    //     }
                    // });
                // }
                
                return data;
            },
            "config": {
                "sql":"",
                "sql1":"SELECT C.ROOT_SCODE AS SCODE,C.SNAME AS GSMC,C.SPCODE AS SPCODE, SUM(NVL(FACT_B,0)) AS LJSJ,SUM(NVL(SNTQ,0)) AS SNTQ, SUM(NVL(FACT_B,0))-SUM(NVL(SNTQ,0)) AS TBZJE, ROUND(DECODE(SUM(NVL(SNTQ,0)),0,0,(SUM(NVL(FACT_B,0))-SUM(NVL(SNTQ,0)))/SUM(NVL(SNTQ,0))*100),4) AS TBZJL, SUM(NVL(FACT_C,0)) AS BNYS, SUM(NVL(FACT_B,0))-SUM(NVL(FACT_C,0)) AS CYE, ROUND(DECODE(SUM(NVL(FACT_C,0)),0,0,SUM(NVL(FACT_B,0))/SUM(NVL(FACT_C,0)*100),4)) AS WCL FROM(SELECT DIM_COMPANY ,FACT_B ,0 AS SNTQ ,FACT_C FROM DW_FACTFINANCEPERIOD WHERE DIM_COMPANY IN (SELECT SCODE FROM DW_DIMCOMPANY WHERE STYPE IN('1','R') AND CISDEL='N' START WITH SCODE=:company CONNECT BY PRIOR SCODE=SPCODE) AND DIM_PERIOD = :period AND DIM_ITEMPERIOD =':itemperiod' UNION ALL SELECT DIM_COMPANY,0 AS FACT_B,FACT_B AS SNTQ ,0 AS FACT_C FROM DW_FACTFINANCEPERIOD WHERE DIM_COMPANY IN (SELECT SCODE FROM DW_DIMCOMPANY WHERE STYPE IN('1','R') AND CISDEL='N' START WITH SCODE=:company CONNECT BY PRIOR SCODE=SPCODE) AND DIM_PERIOD = :comparePeriod AND DIM_ITEMPERIOD =':itemperiod' ) A RIGHT JOIN (SELECT ROOT_SCODE,E.SCODE,F.SNAME,F.SPCODE FROM (SELECT CONNECT_BY_ROOT(SCODE) ROOT_SCODE,SCODE FROM DW_DIMCOMPANY WHERE CISDEL='N' AND STYPE IN('1','R') START WITH SCODE in (select scode from dw_dimcompany where cisdel = 'N' start with scode = :company connect by prior scode = spcode) CONNECT BY PRIOR SCODE = SPCODE) E INNER JOIN DW_DIMCOMPANY F ON E.ROOT_SCODE=F.SCODE ) C ON C.SCODE = A.DIM_COMPANY GROUP BY C.ROOT_SCODE,C.SNAME, C.SPCODE ORDER BY SCODE ", 
                "_cube": {
                    "subject": "1005",
                    "cubeId": 4,
                    "dim_item": "1001"
                },
                "mainDim": "itemperiod",
                "needDims": [
                    "year",
                    "month",
                    "company","conversion"
                ],
                "generateVar":{
					"periodCount":2,
					"compareType":"-1&0",
				    "reverse":true
				},
                "random": {
                    "min": 100,
                    "max": 100000
                },
                "tableHeads":true,
                "type": 1
            },    
                 
            // "columns": [
            //     {
            //         "type": "string",
            //         "text": "预算数",
            //         "children":[
            //             {
            //             "id": "bnlj",
            //             "type": "decimal",
            //             "text": "本年预算"
            //             },
            //             {
            //                 "id": "cye",
            //                 "type": "decimal",
            //                 "text": "差异额"
            //             },
            //             {
            //                 "id": "wcl",
            //                 "type": "decimal",
            //                 "text": "完成率（%）",
            //                 "conversion":"%"
            //             }
            //         ]
            //     },
            //     {
            //         "id": "gsbm",
            //         "type": "string",
            //         "text": "",
            //         "isTree":true
            //     },
            //     {
            //         "id": "scode",
            //         "type": "string",
            //         "fixed":true,
            //         "text": "公司编码"
            //     },
            //     {
            //         "id": "gsmc",
            //         "type": "string",
            //         "text": "公司名称",
            //         "fixed":true,
            //         "width":"360px"
            //     },
            //     {
            //         "type": "string",
            //         "text": "累计数",
            //         "children":[
            //             {
            //                 "id": "ljsj",
            //                 "type": "decimal",
            //                 "text": "累计实际"
            //             },{
            //                 "id": "sntq",
            //                 "type": "decimal",
            //                 "text": "上年同期"
            //             },
            //             {
            //                 "id": "tbzje",
            //                 "type": "decimal",
            //                 "text": "同比增减额"
            //             },
            //             {
            //                 "id": "tbzjl",
            //                 "type": "decimal",
            //                 "width": "150px",
            //                 "text": "同比增减率（%）",
            //                 "conversion":"%"
            //             }
            //         ]
            //     }				
            // ],
            "columns": [
                
                // {
                //     "id": "gsbm",
                //     "type": "string",
                //     "text": "",
                //     "isTree":true
                // },
                {
                    "id": "scode",
                    "type": "string",
                    "fixed":true,
                    "width": "180",
                    "text": "公司编码"
                },
                {
                    "id": "gsmc",
                    "type": "string",
                    "text": "公司名称",
                    "fixed":true,
                    "width":"360px"
                },
                {
                    "type": "string",
                    "text": "累计数",
                    "children":[
                        {
                            "id": "ljsj",
                            "type": "decimal",
                            "width": "160",
                            "align": "right",
                            "text": "累计实际"
                        },{
                            "id": "sntq",
                            "type": "decimal",
                            "width": "160",
                            "align": "right",
                            "text": "上年同期"
                        },
                        {
                            "id": "tbzje",
                            "type": "decimal",
                            "width": "160",
                            "align": "right",
                            "text": "同比增减额"
                        },
                        {
                            "id": "tbzjl",
                            "type": "decimal",
                            "width": "160",
                            "align": "right",
                            "text": "同比增减率（%）",
                            "conversion":"%"
                        }
                    ]
                },
                {
                    "type": "string",
                    "text": "预算数",
                    "children":[
                        {
                            "id": "bnlj",
                            "type": "decimal",
                            "width": "160",
                            "align": "right",
                            "text": "本年预算"
                        },
                        {
                            "id": "cye",
                            "type": "decimal",
                            "width": "160",
                            "align": "right",
                            "text": "差异额"
                        },
                        {
                            "id": "wcl",
                            "type": "decimal",
                            "width": "160",
                            "align": "right",
                            "text": "完成率（%）",
                            "conversion":"%"
                        }
                    ]
                }				
            ],
            "rows": [],
            "levelProperties":{gsbm:"_level"} //加缩进 可选 table
        }		
    ]
}