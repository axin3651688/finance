{
	"layout": {
		"xtype":"column"
	},
	"id": "888",
	"text": "指标分析",
	"items": [
		{
			"xtype": "chart",
			"id": "1403100000",
			"text": "行业效果图",
			"weight": 24,
			
			"closable": true,
			"show": true,
			"queryDataBefore":function(params,config,$vue){
				debugger;
				let me = this;
				let itemscode = $vue.$store.itemscode;
				if(itemscode){
					params.itemscode = itemscode;
				}
				return params;
			},
			"config": {
				"sql":"WITH T AS(SELECT B.SNAME AS DSNAME,A.SCODE,B.SCODE INDSCODE FROM DW_DIMCOMPANY A LEFT JOIN DW_DIMINDUSTRY B ON A.SINDCODE=B.SCODE where A.cisdel='N' AND SINDCODE IS NOT NULL AND STYPE<>'0' START WITH A.SCODE=:company CONNECT BY PRIOR A.SCODE=A.SPCODE) SELECT INDSCODE,HYMC,LJWC FROM ( SELECT T.INDSCODE INDSCODE,T.DSNAME AS HYMC,0 AS MBJY,SUM(T1.FACT_B) AS LJWC,0 AS LJWCL,SUM(T1.SNTQ) AS SNTQ, SUM((T1.FACT_B-T1.SNTQ)) AS TBZJE FROM T INNER JOIN (SELECT DIM_COMPANY,DIM_PERIOD,SUM(CASE WHEN DIM_PERIOD=:period THEN FACT_B ELSE 0 END) FACT_B, SUM(CASE WHEN DIM_PERIOD=:comparePeriod THEN FACT_B ELSE 0 END)SNTQ FROM DW_FACTFINANCEPERIOD WHERE DIM_ITEMPERIOD =:itemscode AND DIM_PERIOD IN(:period,:comparePeriod) GROUP BY(dim_company,dim_period))T1 ON T.SCODE=T1.DIM_COMPANY GROUP BY T.DSNAME,T.INDSCODE)",
				"_cube": {
					"subject": "0001",
					"cubeId": 4
				},
				"mainDim": "itempoint",
				"needDims": [
					"year",
					"month",
					"company"
				],
				"random": {
					"min": 100,
					"max": 100000
				},
				"type": 1,
				"generateVar":{
					"periodCount":2,
					"compareType":"-1&0",
					"reverse":true
				},
				"columns": [
					{
						"id": "tbzjl",
						"type": "decimal",
						"text": "同比增减率"
					},
					{
						"id": "hymc",
						"type": "string",
						"text": "行业名称"
					},
					{
						"id": "mbjy",
						"type": "decimal",
						"text": "全年考核目标建议值"
					},
					{
						"id": "ljwc",
						"type": "decimal",
						"text": "累计完成"
					},
					{
						"id": "ljwcl",
						"type": "decimal",
						"text": "累计完成率"
					},
					{
						"id": "sntq",
						"type": "decimal",
						"text": "上年同期"
					},
					{
						"id": "tbzje",
						"type": "decimal",
						"text": "同比增减额"
					}	
				],
				"rows": []
			},
			"listeners":[
				{
					"type":"click",
					"way":"addTab",
					"sourceApi":"/cnbi/json/source/tjsp/ybpTreeDebug.json",
					"handler": ($vue,params) =>{
						let me = this;
						let name = params.name;
						let data;
						if(name){
							data = $vue.item.datas.filter(function(it,indx){
								return it.hymc == name;
							})
						}
						$vue.$store.chartData = data;
						console.log(params);
					}
				}
			],
			"options": {
				"type": "advancechart",
				"subType": "pie",
				"getData": {
					"type": 2,
					"columns": [
						{
							"id": "hymc",
							 "prop":"name"
						},
						{
							"id": "ljwc",
							 "prop":"value"
						}
					],
					"sign":"pie",
					"scope": true
				}
			},
			  "chartOptions": {
				"dd": "this.item.text",
				"height_s":"400px",
				"unitObj":{
					"mult":10000,
					"unitName":"万元"
				},
                "title": {
                    "text": "this.item.text",
                    "x": "center"
                },
                "tooltip": {
					"trigger": "item",
					"confine": true,
                    "formatter": "{b} : {c} ({d}%)"
				},
                "series": [{
                    "name": "",
                    "type": "pie",
                    "radius": "55%",
                    "center": ["50%", "50%"],
                    "data": "this.item.options.datas",
                    "itemStyle": {
                        "emphasis": {
                            "shadowBlur": 10,
                            "shadowOffsetX": 0,
                            "shadowColor": "rgba(0, 0, 0, 0.5)"
                        }
                    }
				}],
				"legend": {
					"bottom": 10,
					"left": "center",
                    // "orient": "vertical",
                    // "left": "5%",
                    // "top": "10%",
                    "data": "[this.item.chartOptions.series[0].data.map(item=>{return item.name; })]"
                }
               
            }
		},
		{
			"xtype": "bi-table",
			"id": "1400111",
			"text": "这个也是钻取过来的表",
			"weight": 24,
			// "height":400,
			"show": true,
			"queryDataBefore":function(params,config,$vue){
				let me = this;
				let itemscode = $vue.$store.itemscode;
				if(itemscode){
					params.itemscode = itemscode;
				}
				return params;
			},
			"listeners":[
				{
					"type":"click",
					"way":"addTab",
					"sourceApi":"/cnbi/json/source/tjsp/ybpTreeDebug.json",
					"handler": ($vue,params) =>{
						debugger;
						let me = this;
						let name = params.name;
						let data;
						if(name){
							data = $vue.item.datas.filter(function(it,indx){
								return it.hymc == name;
							})
						};
						$vue.$store.chartData = data;
						console.log(params);
					}
				}
			],
			"cellStyle":function(row,that){
				let me = this;
				if(row.columnIndex == 0){
					let css = "color: #428bca;cursor: pointer;";
					return css;
				}
			},
			"onCellClick":function(row, column, cell, event, option){
				let me = this;
				if(cell.cellIndex != 0){
					return;
				};
				let listeners = this.listeners[0];	
				let params = {name:row.hymc},id = row.id,text = row.hymc;
				let textObj = {id:id,text:text};
				option.commonHandler(listeners,params,textObj);
			},
			"config": {
				"sql":"WITH T AS(SELECT B.SNAME AS DSNAME,B.SCODE INDSCODE,A.SCODE FROM DW_DIMCOMPANY A LEFT JOIN DW_DIMINDUSTRY B ON A.SINDCODE=B.SCODE where A.cisdel='N' AND SINDCODE IS NOT NULL AND STYPE<>'0' START WITH A.SCODE=:company CONNECT BY PRIOR A.SCODE=A.SPCODE) SELECT INDSCODE,HYMC,MBJY,LJWC,LJWCL,SNTQ,TBZJE,ROUND(DECODE(SNTQ,0,0,TBZJE/SNTQ),4) AS TBZJL FROM( SELECT T.INDSCODE INDSCODE,DECODE(T.DSNAME,NULL,'合计',T.DSNAME) AS HYMC,0 AS MBJY,SUM(T1.FACT_B) AS LJWC,0 AS LJWCL,SUM(T1.SNTQ) AS SNTQ, SUM((T1.FACT_B-T1.SNTQ)) AS TBZJE FROM T inner JOIN (SELECT DIM_COMPANY,DIM_PERIOD,SUM(CASE WHEN DIM_PERIOD=:period THEN FACT_B ELSE 0 END) FACT_B, SUM(CASE WHEN DIM_PERIOD=:comparePeriod THEN FACT_B ELSE 0 END)SNTQ FROM DW_FACTFINANCEPERIOD WHERE DIM_ITEMPERIOD =:itemscode AND DIM_PERIOD IN(:period,:comparePeriod) GROUP BY(dim_company,dim_period))T1 ON T.SCODE=T1.DIM_COMPANY GROUP BY GROUPING sets ((T.DSNAME,T.INDSCODE),()))",
				"_cube": {
					"subject": "0001",
					"cubeId": 4
				},
				"mainDim": "itempoint",
				"needDims": [
					"year",
					"month",
					"company"
				],
				"random": {
					"min": 100,
					"max": 100000
				},
				"type": 1,
				"generateVar":{
					"periodCount":2,
					"compareType":"-1&0",
					"reverse":true
				},
				"columns": [
					{
						"id": "tbzjl",
						"type": "decimal",
						"text": "同比增减率"
					},
					{
						"id": "hymc",
						"type": "string",
						"text": "行业名称",
						"width":"300px"
					},
					{
						"id": "mbjy",
						"type": "decimal",
						"text": "全年考核目标建议值"
					},
					{
						"id": "ljwc",
						"type": "decimal",
						"text": "累计完成"
					},
					{
						"id": "ljwcl",
						"type": "decimal",
						"text": "累计完成率"
					},
					{
						"id": "sntq",
						"type": "decimal",
						"text": "上年同期"
					},
					{
						"id": "tbzje",
						"type": "decimal",
						"text": "同比增减额"
					}	
				],
				"rows": []
			}
		}
	]
}