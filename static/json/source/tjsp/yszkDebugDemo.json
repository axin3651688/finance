{
    "layout": {
        "xtype": "column"
    },
    "text": "应收账款",
    "id": "66601",
    "children": [{
            "xtype": "bi-table",
            "id": "yszk",
            "text": "应收账款",
            "show": false,
            "width": 6,
            "tableBefore": true,
            "queryDataBefore": function(params, config, $vue) {
                let me = this;
                let selectPeriod = $vue.$store.selectPeriod;
                if (selectPeriod) {
                    let year = selectPeriod.substring(0, 4);
                    let month = selectPeriod.substring(4, 6);
                    if (year) {
                        params.year = year;
                    }
                    if (month) {
                        params.month = month;
                    }
                    params.period = selectPeriod;
                }
                return params;
            },
            "tableBeforeFun": function($vue, params) {
                debugger;
                let me = this;
                let period = $vue.$store.selectPeriod;
                let year = period.substring(0, 4);
                let month = period.substring(4, 6);
                let company = $vue.$store.getters.companyName;
                // let unit = "单位：元";
                let pStyle = "height:30px;line-height:30px;font-weight:bold;";
                let snStyle = "padding:5px 10px;";
                let currentUnit = "元";
                let html = "<p style='" + pStyle + "'><span style='" + snStyle + "'>" + company + "</span><span  style='" + snStyle + "'>(期间：" + year + "年" + month + "月" + "</span><span>单位：" + currentUnit + ")</span></p>";
                return html;
            },
            "showFun": function($store) {
                debugger
                if ($store.getters.treeInfo.nisleaf) {
                    return true;
                } else {
                    return false;
                }
            },
            "config": {
                "sql": "SELECT NID,B.SNAME AS SK, FACT_BALANCE AS BALANCE, FACT_A AS ONEYEAR, FACT_B AS TWOYEAR, FACT_C AS THREEYEAR, FACT_D AS FOURYEAR, C.SNAME AS SKXZ,(CASE WHEN ISINSIDE='1' THEN '是' ELSE '否' END) AS SFNB,(CASE WHEN ISNORMAL='1' THEN '是' ELSE '否' END) AS SFZC,D.SNAME AS FZCFL,E.SNAME AS ZWRZK, FACT_E AS KHSJE, FACT_F AS DNKHSJE, FACT_G AS YQZK, FACT_H AS SZXSSJE FROM (SELECT NID,DIM_CUSUPPLIER,DIM_COMPANY,DIM_ITEM,FACT_BALANCE,FACT_A,FACT_B,FACT_C,FACT_D,ISNATURE, ISINSIDE,ISNORMAL,SCONTENTA,SCONTENTB,FACT_E,FACT_F,FACT_G,FACT_H FROM DW_FACTAGEANALYSIS WHERE DIM_COMPANY=:company AND DIM_PERIOD=:period AND DIM_ITEM='1001') A INNER JOIN (SELECT SCODE,SNAME FROM DW_DIMCUSTOMER WHERE SCOMCODE IN('1001',:company)) B ON A.DIM_CUSUPPLIER=B.SCODE LEFT JOIN (SELECT SCODE,SNAME FROM DW_DIMDROPMENU WHERE SPCODE='10') C ON A.ISNATURE=C.SCODE LEFT JOIN (SELECT SCODE,SNAME FROM DW_DIMDROPMENU WHERE SPCODE='11') D ON A.SCONTENTA=D.SCODE LEFT JOIN (SELECT SCODE,SNAME FROM DW_DIMDROPMENU WHERE SPCODE='12') E ON A.SCONTENTB=E.SCODE",
                "cube": {
                    "subject": "",
                    "cubeId": 4
                },
                "mainDim": "itemperiod",
                "needDims": ["year", "month", "company", "conversion"],
                "random": { "min": 100, "max": 100000 },
                "type": 1,
                "tableHeads": true,
                "columns": [{
                        "id": "sjssje",
                        "type": "decimal",
                        "text": "已形成实质性损失金额"
                    },
                    {
                        "id": "",
                        "type": "index",
                        "width": "60",
                        "text": "序号"
                    },
                    {
                        "id": "sk",
                        "type": "string",
                        "width": "330",
                        "text": "客商"
                    },
                    {
                        "id": "balance",
                        "type": "decimal",
                        "text": "余额"
                    },
                    {
                        "id": "zq",
                        "type": "string",
                        "text": "账期",
                        "children": [{
                                "id": "oneyear",
                                "type": "decimal",
                                "text": "1年以内"
                            },
                            {
                                "id": "twoyear",
                                "type": "decimal",
                                "text": "1-2年以内"
                            },
                            {
                                "id": "threeyear",
                                "type": "decimal",
                                "text": "2-3年以内"
                            },
                            {
                                "id": "fouryear",
                                "type": "decimal",
                                "text": "3年以上"
                            }
                        ]
                    },
                    {
                        "id": "skxz",
                        "type": "string",
                        "align": "center",
                        "text": "商客性质*"
                    },
                    {
                        "id": "sfnb",
                        "type": "string",
                        "align": "center",
                        "text": "是否内部*"
                    },
                    {
                        "id": "sfzc",
                        "type": "string",
                        "align": "center",
                        "text": "是否正常*"
                    },
                    {
                        "id": "fzcfl",
                        "type": "decimal",
                        "text": "非正常分类*"
                    },
                    {
                        "id": "zwrqk",
                        "type": "decimal",
                        "text": "债务人情况*"
                    },
                    {
                        "id": "kshjk",
                        "type": "decimal",
                        "text": "可收回金额*"
                    },
                    {
                        "id": "dykshje",
                        "type": "decimal",
                        "text": "其中:当年可收回金额*"
                    },
                    {
                        "id": "yqzk",
                        "type": "decimal",
                        "text": "逾期账款"
                    }
                ],
                "rows": []

            }
        },
        {
            "xtype": "STreeGrid",
            "id": "yszkej",
            "text": "应收账款二级",
            "style": {
                "height": "780px"
            },
            "show": false,
            "tableBefore": true,
            "showFun": function($store) {
                if ($store.getters.treeInfo.nisleaf) {
                    return false;
                } else {
                    return true;
                }
            },
            "queryDataBefore": function(params, config, $vue) {
                debugger;
                let me = this;
                let selectPeriod = $vue.$store.selectPeriod;
                if (selectPeriod) {
                    let year = selectPeriod.substring(0, 4);
                    let month = selectPeriod.substring(4, 6);
                    if (year) {
                        params.year = year;
                    }
                    if (month) {
                        params.month = month;
                    }
                    params.period = selectPeriod;
                }
                //上年12月的数据。
                params.oneYearBefore = params.year - 1 + "12";
                if (params.company == '1001') {
                    config.sql = config.sql1;
                } else {
                    config.sql = config.sql2;
                }
                return params;
            },
            "queryDataAfter": function(data, $vue) {
                debugger;
                data.forEach(item => {
                    if (item.riskrange == "SAFE") {
                        item.riskrange = "安全";
                    } else if (item.riskrange == "DANGER") {
                        item.riskrange = "警告";
                    } else if (item.riskrange == "PROMPT") {
                        item.riskrange = "预警";
                    } else {
                        item.riskrange = "错误！不在范围之内！";
                    }
                });
                return data;
            },
            "config": {
                "sql2": 7,
                "sql1": 9,
                "sql": "",
                "_cube": {
                    "subject": "",
                    "cubeId": 4
                },
                "generateVar": {
                    "periodCount": 2,
                    "compareType": "-1&0",
                    "reverse": true
                },
                "mainDim": "itemperiod",
                "needDims": ["year", "month", "company", "conversion"],
                "random": { "min": 100, "max": 100000 },
                "type": 1,
                "tableHeads": true,
                "columns": [{
                        "text": "已形成实质性损失金额",
                        "type": "decimal",
                        "id": "www4"
                    }, {
                        "text": "",
                        "type": "string",
                        "id": "",
                        "isTree": true
                    },
                    {
                        "text": "公司编码",
                        "type": "string",
                        "id": "scode"
                    },
                    {
                        "text": "公司名称",
                        "width": "275",
                        "type": "string",
                        "id": "gsmc"
                    },
                    {
                        "text": "口径",
                        "type": "string",
                        "id": "kj"
                    },
                    {
                        "text": "余额",
                        "type": "decimal",
                        "id": "ye"
                    },
                    {
                        "text": "与年初相比增减额",
                        "type": "decimal",
                        "id": "zje"
                    },
                    {
                        "text": "与年初相比增减率（%）",
                        "type": "decimal",
                        "conversion": "%",
                        "id": "zjl"
                    },
                    {
                        "text": "预警等级",
                        "type": "string",
                        "id": "riskrange"
                    },
                    {
                        "id": "",
                        "type": "string",
                        "text": "账期",
                        "children": [{
                                "text": "1年以内",
                                "type": "decimal",
                                "id": "oneYear"
                            },
                            {
                                "text": "1-2年",
                                "type": "decimal",
                                "id": "twoYear"
                            },
                            {
                                "text": "2-3年",
                                "type": "decimal",
                                "id": "threeYear"
                            },
                            {
                                "text": "3年以上",
                                "type": "decimal",
                                "id": "allYear"
                            }
                        ]
                    },
                    {
                        "text": "正常余额",
                        "type": "decimal",
                        "id": "zcje"
                    },
                    {
                        "id": "",
                        "type": "string",
                        "text": "非正常金额",
                        "children": [{
                                "text": "向系统外出借资金",
                                "type": "decimal",
                                "id": "fff1"
                            },
                            {
                                "text": "成本费用挂账",
                                "type": "decimal",
                                "id": "fff2"
                            },
                            {
                                "text": "通过融资性贸易、赊销业务、虚假贸易等虚增应收",
                                "type": "decimal",
                                "id": "fff3"
                            },
                            {
                                "text": "为其他企业代偿金融机构的贷款",
                                "type": "decimal",
                                "id": "fff4"
                            },
                            {
                                "text": "长期挂账、未及时清理",
                                "type": "decimal",
                                "id": "fff5"
                            },
                            {
                                "text": "核算不规范",
                                "type": "decimal",
                                "id": "fff6"
                            },
                            {
                                "text": "其他",
                                "type": "decimal",
                                "id": "fff7"
                            }
                        ]
                    },
                    {
                        "text": "可收回金额",
                        "type": "decimal",
                        "id": "www1"
                    },
                    {
                        "text": "其中：当年可收回金额",
                        "type": "decimal",
                        "id": "www2"
                    },
                    {
                        "text": "逾期账款",
                        "type": "decimal",
                        "id": "www3"
                    }
                ],
                "rows": []
            },

            // "drillProperties":["riskrange","gsmc"],
            "__onRowClick": function(row, column, e, $this) {
                debugger
                let id = row.gsbm,
                    text = row.gsmc;
                if (this.drillProperties[1].indexOf(column.property) != -1) {
                    if (row.gsmc != "" && row.gsmc != undefined) {
                        $this.commonHandler({
                            "type": "click", //事件类型
                            "way": "addTab", //调用的公共方法
                            "sourceApi": "/cnbi/json/source/tjsp/yszkmxb.json",
                            "handler": ($vue, params) => { //自定义的回调
                                console.info(params);
                                debugger;
                            }
                        }, { row: row, column: column, e: e }, { id: id, text: text });
                    }
                }
            },
            "__cellStyle": function(row, obj) {
                debugger
                // for(row.columnIndex; row.columnIndex<obj.item.config.columns.length; row.columnIndex++){
                //   let pro = obj.item.config.columns[row.columnIndex].id ; 

                let css = "padding: 4px 0;";
                // let pro = obj.item.config.columns;
                // let pro = "";
                let pro = row.column.property;
                if (!pro) {
                    return css;
                }

                let textIndent = "";

                let record = row.row;
                let drillProperties = this.drillProperties;
                if (drillProperties.indexOf(pro) != -1) {
                    if (record.riskrange && record.riskrange == "安全" && pro != "gsmc") {
                        let drill = "text-decoration: none;color: green;font-weight: bold;cursor: pointer;text-align: center;";
                        css = css + "font-weight:bold;" + textIndent + drill;
                        return css;
                    } else if (record.riskrange && record.riskrange == "警告" && pro != "gsmc") {
                        let drill = "text-decoration: none;color: red;font-weight: bold;cursor: pointer;text-align: center;";
                        css = css + "font-weight:bold;" + textIndent + drill;
                        return css;
                    } else if (record.riskrange && record.riskrange == "预警" && pro != "gsmc") {
                        let drill = "text-decoration: none;color: #FF9900;font-weight: bold;cursor: pointer;text-align: center;";
                        css = css + "font-weight:bold;" + textIndent + drill;
                        return css;
                    } else if (pro == "gsmc" && record.gsmc != "总计") {
                        let drill = "text-decoration: none;color: #428bca;font-weight: bold;cursor: pointer;";
                        css = css + "font-weight:bold;" + textIndent + drill;
                        return css;
                    } else {
                        return css + textIndent;
                    }
                } else {
                    return css + textIndent;
                }
            }

            //   }


        }
    ]
}