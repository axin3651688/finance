{
    "id": "10133",
    "text": "",
    "layout": {
        "xtype": "column"
    },
    "children": [{
        "id": "",
        "text": "",
        "stype": "tree",
        // "xtype": "STreeGrid",
        "xtype": "elementTree",
        "weight": 24,
        "show": true,
        "queryDataBefore": function(params, $items, $this) {
            // debugger
            $items.sql = $items.sql2;
            let len = $this.items.length;
            let id = $this.items[len - 1].id;
            $items.sql = $items.sql.replace(/:company/g, "'" + id + "'");
            return params;
        },
        "queryDataAfter": function(data, $vue) { //数据的后置处理
            // debugger
            let me = this;           
            data.forEach(res => {
                if(res.yhzhmc === "SH" || res.yhzhmc === "")res.yhzhmc = "合计"
            });
            let datas = []; //有数据的
            let datax = []; //没有数据的
            // me.items[0].updateView = $vue.updateView;
            // data.forEach((item, index) => {
            //     if ((item.hbzj && item.hbzj != 0) || (item.yhck && item.yhck != 0) || (item.jzje && item.jzje != 0)) {
            //         datas.push(item);
            //     } else {
            //         datax.push(item);
            //     }
            // });
            // if (datax.length > 0) {
            //     datax.forEach(item => {
            //         datas.push(item);
            //     });
            // }

            // return datas;
            return data ;
        },
        "config": {
            "sql2": "WITH tt AS( SELECT B.scode as gsbm , b.scode AS scode, b.sname AS sname , a.DIM_BANKNAME AS YHZHMC, B.SCODE AS spcode, FACT_A AS HBZJ,  ( case when DIM_ACCOUNTBANKS='SH' then 0 else  FACT_B  end ) AS YHCK, FACT_C AS JZJE, CASE WHEN(NVL(FACT_A,0)+NVL(FACT_C,0))=0 THEN 0 ELSE ROUND((NVL(FACT_C,0)/(NVL(FACT_A,0)+NVL(FACT_C,0))*100),4) END AS JZD, sdesc FROM DW_FACTCAPITALDETAIL A INNER JOIN DW_DIMCOMPANY B ON A.DIM_COMPANY=B.SCODE AND DIM_PERIOD=:period WHERE B.SCODE IN ( SELECT SCODE FROM DW_DIMCOMPANY WHERE CISDEL = 'N' AND STYPE='1' START WITH SCODE=:company CONNECT BY prior scode=spcode) AND B.SCODE NOT IN ( SELECT SCODE FROM DW_DIMCOMPANY WHERE STYPE='0')) SELECT GSBM AS SCODE, SCODE AS GSBM, SNAME, YHZHMC, spcode, SUM(HBZJ) HBZJ, SUM(YHCK) YHCK, SUM(JZJE) JZJE, SUM(JZD) JZD, sdesc AS yy FROM ( SELECT 'NID' || TO_CHAR(ROWNUM) AS GSBM, '' AS SCODE, '' AS SNAME, YHZHMC, spcode, HBZJ, YHCK, JZJE, JZD, sdesc FROM tt UNION ALL SELECT DISTINCT a.scode, a.scode, SNAME, a.YHZHMC, '' pid, a.HBZJ, a.YHCK, a.JZJE, CASE WHEN(NVL(a.YHCK,0)+NVL(a.JZJE,0))=0 THEN 0 ELSE ROUND((NVL(a.JZJE,0)/(NVL(a.YHCK,0)+NVL(a.JZJE,0))*100),4) END AS JZD, '' descc FROM ( SELECT scode , 'SH' AS YHZHMC, SUM(NVL(HBZJ,0)) AS HBZJ, SUM (NVL(YHCK,0)) AS YHCK, SUM(NVL(JZJE,0)) AS JZJE FROM tt GROUP BY scode ) a RIGHT JOIN tt b ON a.scode = b.scode ) WHERE YHZHMC IS NOT NULL GROUP BY GSBM, SCODE, SNAME, YHZHMC, spcode, sdesc ORDER BY DECODE(spcode,'',gsbm), YHZHMC",
            // "sql2": "WITH tt AS( SELECT B.scode AS gsbm, b.scode AS scode, b.sname AS sname , a.DIM_BANKNAME AS YHZHMC, B.SCODE AS pid, FACT_A AS HBZJ, FACT_B AS YHCK, FACT_C AS JZJE, CASE WHEN(NVL(FACT_B,0)+NVL(FACT_C,0))=0 THEN 0 ELSE ROUND((NVL(FACT_C,0)/(NVL(FACT_B,0)+NVL(FACT_C,0))*100),4) END AS JZD, sdesc FROM DW_FACTCAPITALDETAIL A INNER JOIN DW_DIMCOMPANY B ON A.DIM_COMPANY=B.SCODE AND DIM_PERIOD=:period WHERE B.SCODE IN ( SELECT SCODE FROM DW_DIMCOMPANY WHERE CISDEL = 'N' AND STYPE='1' START WITH SCODE=:company CONNECT BY prior scode=spcode) AND B.SCODE NOT IN ( SELECT SCODE FROM DW_DIMCOMPANY WHERE STYPE='0') AND ( a.DIM_BANKNAME IS NOT NULL)) SELECT GSBM, SCODE, SNAME, YHZHMC, pid, SUM(HBZJ) HBZJ, SUM(YHCK) YHCK, SUM(JZJE) JZJE, SUM(JZD) JZD, sdesc AS yy FROM ( SELECT 'NID' || TO_CHAR(ROWNUM) AS GSBM, '' AS SCODE, '' AS SNAME, YHZHMC, pid, HBZJ, YHCK, JZJE, JZD, sdesc FROM tt UNION ALL SELECT DISTINCT a.scode, a.scode, SNAME, a.YHZHMC, '' pid, a.HBZJ, a.YHCK, a.JZJE, CASE WHEN(NVL(a.HBZJ,0)+NVL(a.JZJE,0))=0 THEN 0 ELSE ROUND((NVL(a.JZJE,0)/(NVL(a.HBZJ,0)+NVL(a.JZJE,0))*100),4) END AS JZD, '' descc FROM ( SELECT scode , 'SH' AS YHZHMC, SUM(NVL(HBZJ,0)) AS HBZJ, SUM (NVL(YHCK,0)) AS YHCK, SUM(NVL(JZJE,0)) AS JZJE FROM tt GROUP BY scode ) a RIGHT JOIN tt b ON a.scode = b.scode ) GROUP BY GSBM, SCODE, SNAME, YHZHMC, pid, sdesc ORDER BY DECODE(pid,'',gsbm), YHZHMC ",
            // "sql2": "WITH tt AS( SELECT B.scode AS gsbm, b.scode AS scode, b.sname AS sname , a.DIM_BANKNAME AS YHZHMC, B.SCODE AS PID, FACT_A AS HBZJ, FACT_B AS YHCK, FACT_C AS JZJE, CASE WHEN(NVL(FACT_B,0)+NVL(FACT_C,0))=0 THEN 0 ELSE ROUND((NVL(FACT_C,0)/(NVL(FACT_B,0)+NVL(FACT_C,0))*100),4) END AS JZD, sdesc FROM DW_FACTCAPITALDETAIL A INNER JOIN DW_DIMCOMPANY B ON A.DIM_COMPANY=B.SCODE AND DIM_PERIOD=:period WHERE B.SCODE IN ( SELECT SCODE FROM DW_DIMCOMPANY WHERE CISDEL = 'N' AND STYPE='1' start with SCODE=:company connect by prior scode=spcode) AND B.SCODE NOT IN ( SELECT SCODE FROM DW_DIMCOMPANY WHERE STYPE='0') AND ( a.DIM_BANKNAME IS NOT NULL) ) SELECT GSBM, SCODE, SNAME, YHZHMC, PID, SUM(HBZJ) HBZJ, SUM(YHCK) YHCK, SUM(JZJE) JZJE, SUM(JZD) JZD, sdesc AS yy FROM ( SELECT '' AS GSBM, '' AS SCODE, '' AS SNAME, YHZHMC, PID, HBZJ, YHCK, JZJE, JZD, sdesc FROM tt UNION ALL SELECT DISTINCT a.scode, a.scode, SNAME, a.YHZHMC, '' pid, a.HBZJ, a.YHCK, a.JZJE, CASE WHEN(NVL(a.YHCK,0)+NVL(a.JZJE,0))=0 THEN 0 ELSE ROUND((NVL(a.JZJE,0)/(NVL(a.YHCK,0)+NVL(a.JZJE,0))*100),4) END AS JZD, '' descc FROM ( SELECT scode , 'SH' AS YHZHMC, SUM(NVL(HBZJ,0)) AS HBZJ, SUM (NVL(YHCK,0)) AS YHCK, SUM(NVL(JZJE,0)) AS JZJE FROM tt GROUP BY scode ) a RIGHT JOIN tt b ON a.scode = b.scode ) GROUP BY GSBM, SCODE, SNAME, YHZHMC, PID, sdesc ORDER BY DECODE(pid,'',gsbm), YHZHMC ",
            // "sql2": "with tt as( SELECT CASE WHEN C.SCODE IS NULL THEN B.scode ELSE C.SCODE END AS gsbm, CASE WHEN C.SCODE IS NULL AND B.SNAME IS NOT NULL THEN B.SCODE ELSE '' END AS scode, CASE WHEN C.scode IS NOT NULL THEN '' ELSE B.sname END sname , CASE WHEN C.SNAME IS NOT NULL THEN C.SNAME ELSE A.DIM_ACCOUNTBANKS END YHZHMC, ( CASE WHEN C.SNAME IS NULL THEN NULL ELSE B.SCODE END) AS PID, FACT_A AS HBZJ, FACT_B AS YHCK, FACT_C AS JZJE, CASE WHEN(NVL(FACT_B,0)+NVL(FACT_C,0))=0 THEN 0 ELSE ROUND((NVL(FACT_C,0)/(NVL(FACT_B,0)+NVL(FACT_C,0))*100),4) END AS JZD FROM DW_FACTCAPITALDETAIL A INNER JOIN DW_DIMCOMPANY B ON A.DIM_COMPANY=B.SCODE AND DIM_PERIOD=:period LEFT JOIN DW_DIMACCOUNTBANKS C ON A.DIM_ACCOUNTBANKS=C.SCODE WHERE B.SCODE IN ( SELECT SCODE FROM DW_DIMCOMPANY WHERE ( SCODE=:company OR SPCODE LIKE :company||'%') AND CISDEL = 'N' AND STYPE='1') AND B.SCODE NOT IN ( SELECT SCODE FROM DW_DIMCOMPANY WHERE STYPE='0')) SELECT GSBM,SCODE,SNAME,YHZHMC,PID,SUM(HBZJ) HBZJ,SUM(YHCK) YHCK,SUM(JZJE) JZJE,SUM(JZD) JZD FROM( select GSBM,SCODE,SNAME,YHZHMC,PID,HBZJ,YHCK,JZJE,JZD from tt union all SELECT SCODE,SCODE,SNAME,'SH' AS YHZHMC,'' PID,0 HBZJ,0 YHCK,0 JZJE,0 JZD FROM DW_DIMCOMPANY WHERE ( SCODE=:company OR SPCODE LIKE :company||'%') AND CISDEL = 'N' AND STYPE='1' ) GROUP BY GSBM,SCODE,SNAME,YHZHMC,PID ORDER BY decode(pid,'',gsbm,pid),GSBM",
            // "sql2": "SELECT CASE WHEN C.SCODE IS NULL THEN B.scode ELSE C.SCODE END AS gsbm, CASE WHEN C.SCODE IS NULL AND B.SNAME IS NOT NULL THEN B.SCODE ELSE '' END AS scode, CASE WHEN C.scode is NOT NULL THEN '' ELSE B.sname END sname , C.SNAME ASYHZHMC ,( CASE WHEN C.SNAME IS NULL THEN null ELSE B.SCODE END) AS PID,FACT_A AS HBZJ,FACT_B AS YHCK,FACT_C AS JZJE, CASE WHEN(NVL(FACT_B,0)+NVL(FACT_C,0))=0 THEN 0 ELSE round((NVL(FACT_C,0)/(NVL(FACT_B,0)+NVL(FACT_C,0))*100),4) END AS JZD FROM DW_FACTCAPITALDETAIL A INNER JOIN DW_DIMCOMPANY B ON A.DIM_COMPANY=B.SCODE AND DIM_PERIOD=:period LEFT JOIN DW_DIMACCOUNTBANKS C ON A.DIM_ACCOUNTBANKS=C.SCODE WHERE B.SCODE IN(SELECT SCODE FROM DW_DIMCOMPANY WHERE (SCODE=:company OR SPCODE LIKE :company||'%') AND CISDEL = 'N' AND STYPE='1') AND B.SCODE NOT IN (SELECT SCODE FROM DW_DIMCOMPANY WHERE STYPE='0') ORDER BY B.SCODE,DIM_ACCOUNTBANKS ",
            "sql": "",
            "_cube": {
                "subject": "0001",
                "cubeId": 5
            },
            "mainDim": "itempoint",
            "needDims": ["year", "month", "company"],
            "random": { "min": 100, "max": 100000 },
            "type": 1
        },
        "rows": [

        ],

        "columns": [
            // {
            //     "text": "集中度（%）",
            //     "type": "decimal",
            //     "conversion": "%",
            //     "id": "jzd"
            // },
            // {
            //     "text": "",
            //     "type": "string",
            //     "id": "",
            //     "isTree": true
            // },
            {
                "text": "公司编码",
                "type": "string",
                "width":"160",
                "fixed": true,
                "id": "gsbm"
            },
            {
                "text": "公司名称",
                "type": "string",
                "width": "360",
                "fixed": true,
                "id": "sname"
            },
            {
                "text": "银行账户名称",
                "type": "string",
                "width": "350",
                "id": "yhzhmc"
            },
            {
                "text": "货币金额",
                "type": "decimal",
                "width": "200px",
                "align": "right",
                "id": "hbzj"
            },
            {
                "text": "其中：银行存款",
                "type": "decimal",
                "width": "200px",
                "align": "right",
                "id": "yhck"
            },
            {
                "text": "集中金额",
                "type": "decimal",
                "width": "200px",
                "align": "right",
                "id": "jzje"
            },
            {
                "text": "集中度（%）",
                "type": "decimal",
                "width": "120",
                "align": "right",
                "conversion": "%",
                "id": "jzd"
            },
            {
                "text": "原因",
                "type": "string",
                "width": "260",
                "align": "left",
                "showOverflowTooltip": true,
                "id": "yy"
            }
        ],
        "levelProperties":{scode:"_level"} //加缩进 可选 table
    }]
}