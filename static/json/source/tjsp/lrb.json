{
    "id":"101",
    "text":"资金集中情况汇总表",
    "config":{
        "sql":"WITH TMP1 AS( SELECT ROOT_SCODE, COUNT(*) HS FROM (SELECT CONNECT_BY_ROOT SCODE AS ROOT_SCODE,SCODE FROM DW_DIMCOMPANY WHERE CTYPE='1' AND CISDEL='N' CONNECT BY PRIOR SCODE = SPCODE)GROUP BY ROOT_SCODE), TMP2 AS (SELECT SCODE,SPCODE,SNAME FROM DW_DIMCOMPANY WHERE CISDEL='N' AND CTYPE IN('1','0') START WITH SCODE='100101' CONNECT BY PRIOR SCODE = SPCODE), TMP3 AS (SELECT ROOT_SCODE,COUNT(*) JZHS FROM ((SELECT CONNECT_BY_ROOT SCODE AS ROOT_SCODE, SCODE FROM DW_DIMCOMPANY WHERE CTYPE='1' AND CISDEL='N' CONNECT BY PRIOR SCODE = SPCODE) A1 INNER JOIN (SELECT DISTINCT DIM_COMPANY FROM DW_FACTCAPITALDETAIL WHERE DIM_PERIOD='201711') A2 ON A1.SCODE = A2.DIM_COMPANY) GROUP BY ROOT_SCODE) SELECT SCODE,SPCODE AS PID,SNAME,HS,JZHS,ROUND(JZHS/HS,4) AS GKM ,FACT_A AS HBZJ,FACT_B AS YHCK,FACT_C AS JZJE, CASE WHEN SCODE='1001' THEN (CASE WHEN FACT_A=0 THEN 0 ELSE ROUND(FACT_C/FACT_A,4) END) ELSE (CASE WHEN FACT_A+FACT_B=0 THEN 0 ELSE ROUND(FACT_C/(FACT_A+FACT_B),4) END) END AS JZD FROM TMP2 T1 LEFT JOIN TMP1 T2 ON T1.SCODE=T2.ROOT_SCODE LEFT JOIN TMP3 T3 ON T1.SCODE=T3.ROOT_SCODE LEFT JOIN DW_FACTCAPITALDETAIL A ON T1.SCODE=A.DIM_COMPANY AND DIM_BANK='SH' AND DIM_PERIOD='201711' ORDER BY SCODE ",
      "_cube":{
         "subject":"0001",
         "cubeId":5
      },
      "mainDim":"itempoint",
      "needDims":["year","month","company"],
      "random":{"min":100,"max":100000},
      "type":1     
   },
  
    "columns": [
      {
          "text": "公司编码",
          "value": "scode"
      },
      {
          "text": "公司名称",
          "value": "sname"
        },
        {
          "text": "下级户数",
          "value": "hs"
        },
        {
          "text": "下级集中户数",
          "value": "pid"
        },
        {
          "text": "掌控面",
          "value": "gkm"
        },
        {
          "text": "货币金额",
          "value": "hbzj"
        },
        {
          "text": "其中：银行存款",
          "value": "yhck"
        },
        {
          "text": "集中金额",
          "value": "jzje"
        },
        {
          "text": "集中度",
          "value": "jzd"
        }
  ],
  "layout": {
    "xtype": "form"
  },
  "items": [{
    "xtype": "tree-grid",
    "id": "",
    "text": ""
  }],
  "code":200,"msg":"查询数据源【company】维度成功！"
  }