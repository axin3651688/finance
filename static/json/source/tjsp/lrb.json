{
    /**
     * name : sjz
     * 因为是sql配的 不利于导入填报  所以弃用  改为cube配置
     * 重新启用（表样更换）
     */
    "id":"0002",
    "text":"利润表",
    "layout":{
        "xtype":"tab"
    },
    "monthConfig":{
        "id":"month",
        "value":13
    }, 
    "showDims": ["year","month","company","conversion"],
    "changeYearBefore":function(newyear,option){
        option.closeTabTaget(newyear,option);
    } ,
    "changeMonthBefore":function(newmonth,option){
        option.closeTabTaget(newmonth,option);
    },
    "changeCompanyBefore":function(newcompany,option){
        option.closeTabTaget(newcompany,option);
    },
    "changeConversionBefore":function(newconversion, option){
        debugger
        option.closeTabTaget(newconversion,option);
    },
    "__queryDataAfter":function(data,$vue){//数据的后置处理
        let me = this;
        me.items[0].updateView = $vue.updateView;
        me.items[0].$vue = $vue;
        return data;
    },
    "config":{
        "sql": "WITH T1 AS( SELECT DIM_ITEMPERIOD, SUM(CASE WHEN DIM_PERIOD=:period THEN FACT_A ELSE 0 END) DYSBN, SUM(CASE WHEN DIM_PERIOD=:comparePeriod THEN FACT_A ELSE 0 END) DYSSNTQ, SUM(CASE WHEN DIM_PERIOD=:period THEN FACT_B ELSE 0 END) LJSBN, SUM(CASE WHEN DIM_PERIOD=:comparePeriod THEN FACT_B ELSE 0 END) LJSSNTQ FROM DW_FACTFINANCEPERIOD where DIM_PERIOD IN(:comparePeriod,:period)and DIM_COMPANY=:company and SUBJECT='0002' GROUP BY DIM_ITEMPERIOD) SELECT b.scode, CASE WHEN B.SCODE IN('1416001','1426400','1402100','1403100','1400100') THEN '0' WHEN B.SCODE IN('1426401','1416101','1416301','1426711','1426801','1400200','1400400','1400500') THEN '2.5' WHEN B.SCODE IN('1400300') THEN '2' WHEN B.SCODE IN('1435302','1436605','1436606','1416303','1416304','1416305','1426713','1426714') THEN '6.5' ELSE '4.5' END nlevel, B.SNAME, NVL(DYSBN,0) DYSBN, NVL(DYSSNTQ,0) DYSSNTQ, (NVL(DYSBN,0)-NVL(DYSSNTQ,0)) DYSTBZJE, ROUND(CASE WHEN NVL(DYSSNTQ,0)='0' THEN 0 ELSE (NVL(DYSBN,0)-NVL(DYSSNTQ,0))*100/NVL(DYSSNTQ,0) END ,4) DYSTBZJL, NVL(LJSBN,0) LJSBN, NVL(LJSSNTQ,0) LJSSNTQ, (NVL(LJSBN,0)-NVL(LJSSNTQ,0)) LJSTBZJE, ROUND(CASE WHEN NVL(LJSSNTQ,0)='0' THEN 0 ELSE (NVL(LJSBN,0)-NVL(LJSSNTQ,0))*100/NVL(LJSSNTQ,0) END ,4) LJSTBZJL FROM T1 A RIGHT JOIN (SELECT SCODE, SNAME, SSORTBY FROM DW_DIMITEMPERIOD WHERE PROPERTY3='14')B ON A.DIM_ITEMPERIOD=B.SCODE ORDER BY B.SSORTBY,b.scode ",
        // "sql":"select SCODE as id, SNAME as text, SSORTBY, NLEVEL,FACT_A as a, FACT_B as b from( SELECT FACT_A, FACT_B, DIM_ITEMPERIOD FROM DW_FACTFINANCEPERIOD where DIM_PERIOD=:period and DIM_COMPANY =:company)a right join(SELECT SCODE, SNAME, SSORTBY, NLEVEL FROM DW_DIMITEMPERIOD where stype='14' and PROPERTY3='14') b on a.DIM_ITEMPERIOD=b.SCODE order by SSORTBY",
        "_cube":{
            "cubeId":4,
            "subject":"0002"
        },
        "mainDim":"itemperiod",
        "needDims":["year","month","company","conversion"],
        "random":{"min":100,"max":100000},
        "type":1 ,
        "tableHeads":true,
        "generateVar":{
            "periodCount":2,
             "compareType":"-1&0",
             "reverse":true
        }    
    },
    
    "columns":[
        {
            "id": "",
            "type": "string",
            "text": "累计数",
            "children":[
                {
                    "id": "ljsbn",
                    "type": "decimal",
                    "text": "本年",
                    "width": "170px"
                },
                {
                    "id": "ljssntq",
                    "type": "decimal",
                    "text": "上年同期",
                    "width": "170px"
                },
                {
                    "id": "ljstbzje",
                    "type": "decimal",
                    "text": "同比增减额",
                    "width": "170px"
                },
                {
                    "id":"ljstbzjl",
                    "type": "decimal",
                    "text": "同比增减率（%）",
                    "conversion": "%",
                    "width": "150px"
                }
            ]
        },
        {
            "id": "sname",
            "type": "string",
            "width": "370px",
            "fixed": true,
            "text": "项目"
        },
        {
            "id": "row",
            "type": "index",
            "text": "行次",
            "align": "center",
            "width": "60px"
        },
        {
            "id": "",
            "type": "string",
            "text": "当月数",
            "children":[
                {
                    "id": "dysbn",
                    "type": "decimal",
                    "text": "本年",
                    "width": "170px"
                },
                {
                    "id": "dyssntq",
                    "type": "decimal",
                    "text": "上年同期",
                    "width": "170px"
                },
                {
                    "id": "dystbzje",
                    "type": "decimal",
                    "text": "同比增减额",
                    "width": "170px"
                },
                {
                    "id":"dystbzjl",
                    "type": "decimal",
                    "text": "同比增减率（%）",
                    "conversion": "%",
                    "width": "150px"
                }
            ]
        }
    ],
    "rows":[],
    "items":[{
        "id":"jlr",
        "text":"利润表",
        "xtype":"bi-table",
        "toolbar":[{
            "id":"1",
            "text":"刷新",
            "xtype":"button",
            "cellStyle":{
                "color":"black",
                // "background-color":"#189271"
                "background-color":"#fff"
            },
            "handler":function(vue,btn){
                debugger
                console.log(vue);
                let $vue = vue.item.$vue;
                $vue.closeTabTaget({}, $vue);
                vue.item.updateView("company");
            }
        }
        , {
            "id":"2",
            "text":"导出",
            "xtype":"button",
            "cellStyle":{
                "color":"black",
                // "background-color":"#189271"
                "background-color":"#fff"
            },
            "handler":function(vue,btn){
                debugger
                console.log(vue);
                vue.handleDownload(vue);
            }
        }
    ],
        
        "onCellClick":function(row, column, cell, event,vue){//单元格点击事件
            debugger
            let id = row.scode, text = row.sname;
            let datas = this.datas;
                let data = datas.filter(function(item){
                        return item.scode == row.scode;
                });
            let record = data[0];

            if(this.drillProperties.indexOf(column.property) != -1){
                if((record.dysbn && record.dysbn!=0) || (record.dyssntq && record.dyssntq!=0) || 
                   (record.ljsbn && record.ljsbn!=0) || (record.ljssntq && record.ljssntq!=0)){
                        vue.commonHandler(
                            {
                                "type":"click",//事件类型
                                "way":"addTab",//调用的公共方法
                                "sourceApi":"/cnbi/json/source/tjsp/lrbdebug2.json",
                                "handler":($vue,params)=>{//自定义的回调
                                    console.info(params);
                                    debugger; 
                                } 
                            },
                            { row: row, column: column, cell: cell, event: event },
                            { id: id, text: text }
                        );
                }
            }    
            console.log(this);
        },
        "levelProperties":{sname:"nlevel"},//加缩进 可选 table
        "drillProperties":["sname"],//有钻取，给蓝色 可选 table
        "cellStyle":function(row){
            debugger           
            let datas = this.datas;
            let record = datas[row.rowIndex];
            let css = "padding: 4px 0;";
            let pro = row.column.property;
            if (!pro) {
                return css;
            }
            let levelProperties = this.levelProperties;//行缩进
            let textIndent ="";
            // let record = row.row;  //获取的行数据        
            let drillProperties = this.drillProperties;//给那一列赋予蓝色
            let levelPro = levelProperties[pro];
            if (levelPro && record[levelPro]) {//行缩进处理
                let level = record[levelPro] || 1;
                textIndent = level > 1 ? "text-indent: " + (level - 1) * 20 + "px;" : ";";
            }
            if (drillProperties.indexOf(pro) != -1) { // 判断给那一列附蓝色；不然一行全是蓝色的
                if ((record.dysbn && record.dysbn!=0) || (record.dyssntq && record.dyssntq!=0) || 
                    (record.ljsbn && record.ljsbn!=0) || (record.ljssntq && record.ljssntq!=0)) {//判断A、B的值是否存在 and 不能等于0；
                    let drill = "text-decoration: none;color: #428bca;cursor: pointer;";
                    css = css + "font-weight:bold;" + textIndent + drill;
                    return css;
                } else if(record.scode=="1416001" || record.scode=="1426400" || record.scode=="1402100" || record.scode=='1403100' || record.scode=='1400100'){
                    let drill = "text-decoration: none;color: black;";
                    css = css + "font-weight:bold;" + textIndent + drill;
                    return css;
                }else {//否则不给蓝色：说明无click事件；不做处理；
                    return css+textIndent;
                }
            } else {
                return css+textIndent;
            }
        }      
    }]
}