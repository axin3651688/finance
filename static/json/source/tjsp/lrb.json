{
    "id":"1013",
    "text":"资金集中情况汇总表",
    "config":{
<<<<<<< HEAD
        "cube":{
          "subject":"0007",
          "cubeId":4
        },
        
        "mainDim":"itemperiod",
        "needDims":["year","month","company"],
        "random":{"min":100,"max":100000},
        "type":1,
        "_sql":"SELECT c.cisleaf AS leaf, c.scode AS company, cr.nid AS companyReportId, cr.nreport AS report,( CASE WHEN cr.nlocked = '1' THEN to_number(cr.sscore, '99999') END) AS score, cr.nlocked AS locked, cr.nlocked AS index1, c.sname AS title, cr.slockedtime AS lockedTime, cr.slockeduser AS lockedUser, (SELECT srolename FROM sys_role WHERE roleid = ( SELECT roleid FROM sys_user WHERE suser = cr.slockeduser ) ) AS rolename, (SELECT struename FROM sys_user WHERE suser = cr.slockeduser ) AS lockedTrueName, (SELECT nsource || '-' || nid FROM sys_source_comment WHERE REGEXP_LIKE ( nid, '(^[+-]?\d{0,}\.?\d{0,}$)' ) AND stitle = TO_CHAR(cr.nid) AND ROWNUM = 1 ) AS topicSource, ( SELECT SUM(to_number(sscore, '99999')) FROM rpt_company_report WHERE scompany = cr.scompany AND syear = substr(cr.speriod, 1, 4) AND nlocked = 1 AND smonth BETWEEN '01' AND substr(cr.speriod, 5, 2) ) / to_number(substr(cr.speriod, 5, 2)) AS avgscore, cr.speriod AS period, ( SELECT sname FROM rpt_webreport WHERE cr.nreport = nid ) reportName FROM rpt_company_report cr RIGHT JOIN dw_dimcompany c ON c.scode = cr.scompany AND c.scode IN (select scode from dw_dimcompany where spcode = '1' and cisdel = 'N' ) AND cr.nlocked IN ( 0, 1 ) AND c.ctype != '2' WHERE speriod = '201606' ORDER BY c.scode, cr.nlocked DESC, cr.slockedtime"
          
     },
=======
        "sql":"WITH TMP1 AS( SELECT ROOT_SCODE, COUNT(*) HS FROM (SELECT CONNECT_BY_ROOT SCODE AS ROOT_SCODE,SCODE FROM DW_DIMCOMPANY WHERE CTYPE='1' AND CISDEL='N' CONNECT BY PRIOR SCODE = SPCODE)GROUP BY ROOT_SCODE), TMP2 AS (SELECT SCODE,SPCODE,SNAME FROM DW_DIMCOMPANY WHERE CISDEL='N' AND CTYPE IN('1','0') START WITH SCODE='100101' CONNECT BY PRIOR SCODE = SPCODE), TMP3 AS (SELECT ROOT_SCODE,COUNT(*) JZHS FROM ((SELECT CONNECT_BY_ROOT SCODE AS ROOT_SCODE, SCODE FROM DW_DIMCOMPANY WHERE CTYPE='1' AND CISDEL='N' CONNECT BY PRIOR SCODE = SPCODE) A1 INNER JOIN (SELECT DISTINCT DIM_COMPANY FROM DW_FACTCAPITALDETAIL WHERE DIM_PERIOD='201711') A2 ON A1.SCODE = A2.DIM_COMPANY) GROUP BY ROOT_SCODE) SELECT SCODE,SPCODE AS PID,SNAME,HS,JZHS,ROUND(JZHS/HS,4) AS GKM ,FACT_A AS HBZJ,FACT_B AS YHCK,FACT_C AS JZJE, CASE WHEN SCODE='1001' THEN (CASE WHEN FACT_A=0 THEN 0 ELSE ROUND(FACT_C/FACT_A,4) END) ELSE (CASE WHEN FACT_A+FACT_B=0 THEN 0 ELSE ROUND(FACT_C/(FACT_A+FACT_B),4) END) END AS JZD FROM TMP2 T1 LEFT JOIN TMP1 T2 ON T1.SCODE=T2.ROOT_SCODE LEFT JOIN TMP3 T3 ON T1.SCODE=T3.ROOT_SCODE LEFT JOIN DW_FACTCAPITALDETAIL A ON T1.SCODE=A.DIM_COMPANY AND DIM_BANK='SH' AND DIM_PERIOD='201711' ORDER BY SCODE ",
      "_cube":{
         "subject":"0001",
         "cubeId":5
      },
      "mainDim":"itempoint",
      "needDims":["year","month","company"],
      "random":{"min":100,"max":100000},
      "type":1     
   },
  
>>>>>>> c9302cd692dd3b303929600cac91cbc867216a0a
    "columns": [
      {
          "text": "公司编码",
          "value": ""
      },
      {
          "text": "公司名称",
          "value": "sname"
        },
        {
          "text": "下级户数",
          "value": "hs"
        },
        {
          "text": "下级集中户数",
          "value": "pid"
        },
        {
          "text": "掌控面",
          "value": "gkm"
        },
        {
          "text": "货币金额",
          "value": "hbzj"
        },
        {
          "text": "其中：银行存款",
          "value": "yhck"
        },
        {
          "text": "集中金额",
          "value": "jzje"
        },
        {
          "text": "集中度",
          "value": "jzd"
        }
  ],
  "layout": {
    "xtype": "form"
  },
  "items": [{
    "xtype": "tree-grid",
    "id": "",
    "text": ""
  }],
  "code":200,"msg":"查询数据源【company】维度成功！"
  }