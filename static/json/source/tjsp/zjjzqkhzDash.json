{
    "id": "1013",
    "text": "资金集中情况汇总表",

    "layout": {
        "xtype": "column"
    },
    "children": [{
        "xtype": "tree-grid",
        "id": "zjjzqkhz",
        "text": "资金集中情况汇总表",
        "config": {
            "sql": "WITH T1 AS( SELECT CONNECT_BY_ROOT SCODE AS ROOT_SCODE, SCODE FROM DW_DIMCOMPANY WHERE CISDEL='N' AND STYPE='1' CONNECT BY PRIOR SCODE = SPCODE) , T2 AS ( SELECT ROOT_SCODE, SCODE FROM T1 WHERE ROOT_SCODE IN ( SELECT SCODE FROM DW_DIMCOMPANY WHERE CISDEL='N' START WITH SCODE=:company CONNECT BY PRIOR SCODE = SPCODE ) ) , T3 AS ( SELECT ROOT_SCODE, COUNT(*) JZHS FROM ( ( SELECT CONNECT_BY_ROOT SCODE AS ROOT_SCODE, SCODE FROM DW_DIMCOMPANY WHERE STYPE='1' AND CISDEL='N' CONNECT BY PRIOR SCODE = SPCODE) A1 INNER JOIN ( SELECT DISTINCT DIM_COMPANY FROM DW_FACTCAPITALDETAIL WHERE DIM_PERIOD=:period) A2 ON A1.SCODE = A2.DIM_COMPANY) GROUP BY ROOT_SCODE ) , T4 AS ( SELECT ROOT_SCODE, COUNT(*) HS FROM ( SELECT CONNECT_BY_ROOT SCODE AS ROOT_SCODE, SCODE FROM DW_DIMCOMPANY WHERE STYPE='1' AND CISDEL='N' CONNECT BY PRIOR SCODE = SPCODE) GROUP BY ROOT_SCODE ) , T5 AS ( SELECT T2.ROOT_SCODE, HS, NVL(JZHS,0) JZHS, SUM(NVL(FACT_A,0)) AS HBZJ, SUM(NVL(FACT_B,0)) AS YHCK, SUM(NVL(FACT_C,0)) AS JZJE FROM T2 LEFT JOIN (select DIM_COMPANY, fact_a, fact_b, fact_c from DW_FACTCAPITALDETAIL where DIM_PERIOD=:period and DIM_ACCOUNTBANKS='SH') A ON T2.SCODE=A.DIM_COMPANY LEFT JOIN T4 ON T2.ROOT_SCODE=T4.ROOT_SCODE LEFT JOIN T3 ON T2.ROOT_SCODE=T3.ROOT_SCODE GROUP BY T2.ROOT_SCODE, HS, JZHS ) SELECT t5.ROOT_SCODE AS scode, t5.ROOT_SCODE AS gsbm, spcode AS pid, TA.SNAME, HS, JZHS, CASE WHEN HS=0 THEN 0 ELSE ROUND(JZHS/HS*100, 4) END AS GKM, HBZJ, YHCK, JZJE, CASE WHEN t5.ROOT_SCODE='1001' THEN ( CASE WHEN HBZJ=0 THEN 0 ELSE ROUND(JZJE/HBZJ*100,4) END) ELSE ( CASE WHEN YHCK+JZJE=0 THEN 0 ELSE ROUND(JZJE/(YHCK+JZJE)*100,4) END) END AS JZD FROM T5 LEFT JOIN DW_DIMCOMPANY TA ON TA.SCODE=T5.ROOT_SCODE ORDER BY T5.ROOT_SCODE  ",
            "_cube": {
                "subject": "0001",
                "cubeId": 5
            },
            "mainDim": "itempoint",
            "needDims": ["year", "month", "company", "conversion"],
            "random": { "min": 100, "max": 100000 },
            "type": 1,

            "columns": [{
                    "text": "集中度（%）",
                    "type": "decimal",
                    "unit": "%",
                    "id": "jzd"
                },
                {
                    "text": "",
                    "type": "string",
                    "id": "",
                    "isTree": true
                },
                {
                    "text": "公司编码",
                    "type": "string",
                    "id": "scode"
                },
                {
                    "text": "公司名称",
                    "type": "string",
                    "width": "310",
                    "id": "sname"
                },
                {
                    "text": "下级户数",
                    "align": "center",
                    "type": "number",
                    "id": "hs"
                },
                {
                    "text": "下级集中户数",
                    "width": "150",
                    "align": "center",
                    "type": "number",
                    "id": "jzhs"
                },
                {
                    "text": "管控面（%）",
                    "type": "decimal",
                    "unit": "%",
                    "id": "gkm"
                },
                {
                    "text": "货币金额",
                    "type": "decimal",
                    "id": "hbzj"
                },
                {
                    "text": "其中：银行存款",
                    "type": "decimal",
                    "id": "yhck"
                },
                {
                    "text": "集中金额",
                    "type": "decimal",
                    "id": "jzje"
                }

            ],
            "rows": []
        },
        "onRowClick": function(row, e, col, $vue) {
            debugger
            let id = row.scode,
                text = row.sname;
            if (this.drillProperties.indexOf(e.property) != -1) {
                if (row.jzhs && row.jzhs > 0) {
                    $vue.commonHandler({
                        "type": "click",
                        "way": "addTab",
                        "sourceApi": "/cnbi/json/source/tjsp/zjjzqkmxb.json",
                        "handler": ($vue, params) => {
                            console.info(params);
                            debugger;
                        }
                    }, { row: row, e: e, col: col }, { id: id, text: text });
                }

            }
        },
        "drillProperties": ["jzhs"], //有钻取，给蓝色 可选 table
        "cellStyle": function(row, obj) {

            // let a = obj.item.config.columns;

            debugger
            // for(row.columnIndex; row.columnIndex<obj.item.config.columns.length; row.columnIndex++){
            //     let pro = obj.item.config.columns[row.columnIndex].id ; 

            let css = "padding: 4px 0;";
            // let pro = obj.item.config.columns;
            // let pro = "";
            let pro = row.column.property;
            if (!pro) {
                return css;
            }

            let textIndent = "";

            let record = row.row; //获取的行数据  
            let drillProperties = this.drillProperties; //给那一列赋予蓝色
            if (drillProperties.indexOf(pro) != -1) {
                if (record.jzhs && record.jzhs > 0) {
                    // return ;
                    let drill = "text-decoration: none;color: #428bca;cursor: pointer;";
                    css = css + "font-weight:bold;" + textIndent + drill;
                    return css;
                } else {
                    return css + textIndent;
                }
            } else {
                return css + textIndent;
            }
            // }
            //   if (levelPro && record[levelPro]) {//行缩进处理
            //     let level = record[levelPro] || 1;
            //     textIndent = level > 1 ? "text-indent: " + (level - 1) * 20 + "px;" : ";";
            // }
            // if (drillProperties.indexOf(pro) != -1) { // 判断给那一列附蓝色；不然一行全是蓝色的
            //     if (row.jzhs && row.jzhs>0) {//判断A、B的值是否存在 and 不能等于0；
            //         let drill = "text-decoration: none;color: #428bca;cursor: pointer;";
            //         css = css + "font-weight:bold;" + textIndent + drill;
            //         return css;
            //     } else {//否则不给蓝色：说明无click事件；不做处理；
            //         return css+textIndent;
            //     }
            // } else {
            //     return css+textIndent;
            // }
        }

    }]
}