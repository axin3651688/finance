{
    "id":"001401",
    "text": "财务状况指标",
    "layout":{
        "xtype":"tab"
    },
    "showDims": ["year","month","company","conversion"],
    "changeCompanyBefore":function(newcompany,option){ 
        option.closeTabTaget(newcompany,option);
    },
    "changeYearBefore":function(newyear,option){
        option.closeTabTaget(newyear,option);
    },
    "changeMonthBefore":function(newmonth,option){
        option.closeTabTaget(newmonth,option);
    },
    "__queryDataAfter":function(data,$vue){//数据的后置处理 
        // debugger
        let me = this ; 
        let property = $vue.$store.getters.treeInfo.property1 ;                
        if(me.id == "001401"){
            if(property == "0"){
                data = [] ;
                me.items[0].property = true; 
                $vue.$message({ message: "该公司不是重点单位", type: "warning" })
            }else{
                me.items[0].property = false;
            } 
        }
        me.items[0].updateView = $vue.updateView;
        me.items[0].$vue = $vue;
        return data;
    },
    "config": {
        // "sql": "WITH TT AS( SELECT SCODE, spcode, SNAME FROM DW_DIMCOMPANY WHERE cisdel='N' AND SINDCODE IS NOT NULL AND STYPE<>'0' START WITH SCODE=:company CONNECT BY PRIOR SCODE=SPCODE) , T1 AS ( SELECT fact_a, fact_b, DIM_ITEMPOINT, DIM_COMPANY, F.SNAME FROM DW_FACTFINANCEPOINT E RIGHT JOIN TT F ON E.DIM_COMPANY=F.SCODE WHERE DIM_PERIOD=:period ) , T2 AS ( SELECT t1.DIM_COMPANY, t1.SNAME, fact_a ZCZE_A, fact_b ZCZE_B, HBZJ_A, HBZJ_b, CH_A, CH_B, YSZK_A, YSZK_b, FZZE_A, FZZE_B, DQJK_A, DQJK_B, YFZK_A, YFZK_B, CQJK_A, CQJK_B, SYZQY_A, SYZQY_B FROM t1 LEFT JOIN ( SELECT DIM_COMPANY, SNAME, FACT_A HBZJ_A, FACT_B HBZJ_b FROM t1 WHERE DIM_ITEMPOINT='1111001') bb ON t1.DIM_COMPANY=bb.DIM_COMPANY LEFT JOIN ( SELECT DIM_COMPANY, SNAME, FACT_A CH_A, FACT_B CH_B FROM t1 WHERE DIM_ITEMPOINT='1111401') cc ON cc.DIM_COMPANY=bb.DIM_COMPANY LEFT JOIN ( SELECT DIM_COMPANY, SNAME, FACT_A YSZK_A, FACT_B YSZK_B FROM t1 WHERE DIM_ITEMPOINT='1111122') dd ON cc.DIM_COMPANY=dd.DIM_COMPANY LEFT JOIN ( SELECT DIM_COMPANY, SNAME, fact_a FZZE_A, fact_b FZZE_B FROM t1 WHERE DIM_ITEMPOINT='1200100') EE ON EE.DIM_COMPANY=dd.DIM_COMPANY LEFT JOIN ( SELECT DIM_COMPANY, SNAME, FACT_A DQJK_A, FACT_B DQJK_B FROM t1 WHERE DIM_ITEMPOINT='1212001') FF ON EE.DIM_COMPANY=FF.DIM_COMPANY LEFT JOIN ( SELECT DIM_COMPANY, SNAME, FACT_A YFZK_A, FACT_B YFZK_B FROM t1 WHERE DIM_ITEMPOINT='1212202') GG ON FF.DIM_COMPANY=GG.DIM_COMPANY LEFT JOIN ( SELECT DIM_COMPANY, SNAME, FACT_A CQJK_A, FACT_B CQJK_B FROM t1 WHERE DIM_ITEMPOINT='1222501') HH ON GG.DIM_COMPANY=HH.DIM_COMPANY LEFT JOIN ( SELECT DIM_COMPANY, SNAME, FACT_A SYZQY_A, FACT_B SYZQY_B FROM T1 WHERE DIM_ITEMPOINT='1300100') II ON II.DIM_COMPANY=HH.DIM_COMPANY WHERE DIM_ITEMPOINT='1100100' ) , tt1 AS ( SELECT DIM_COMPANY GSBM, SNAME GSMC, SUM(NVL(ZCZE_B,0)) ZCZE_B, SUM(NVL(ZCZE_A,0)) ZCZE_A, SUM(NVL(HBZJ_B,0)) HBZJ_B, SUM(NVL(HBZJ_A,0)) HBZJ_A, SUM(NVL(CH_B,0)) CH_B, SUM(NVL(CH_A,0)) CH_A, SUM(NVL(YSZK_B,0)) YSZK_B, SUM(NVL(YSZK_A,0)) YSZK_A, SUM(NVL(FZZE_B,0)) FZZE_B, SUM(NVL(FZZE_A,0)) FZZE_A, SUM(NVL(DQJK_B,0)) DQJK_B, SUM(NVL(DQJK_A,0)) DQJK_A, SUM(NVL(YFZK_B,0)) YFZK_B, SUM(NVL(YFZK_A,0)) YFZK_A, SUM(NVL(CQJK_B,0)) CQJK_B, SUM(NVL(CQJK_A,0)) CQJK_A, SUM(NVL(SYZQY_B,0)) SYZQY_B, SUM(NVL(SYZQY_A,0)) SYZQY_A, CASE WHEN SUM(NVL(ZCZE_B,0))=0 THEN 0 ELSE ROUND((SUM(NVL(FZZE_B,0))/SUM(NVL(ZCZE_B,0))),4) END ZCFZL_B, CASE WHEN SUM(NVL(ZCZE_A,0))=0 THEN 0 ELSE ROUND((SUM(NVL(FZZE_A,0))/SUM(NVL(ZCZE_A,0))),4) END ZCFZL_A FROM T2 A GROUP BY DIM_COMPANY, SNAME ORDER BY DIM_COMPANY ) SELECT SCODE gsbm, SNAME, spcode AS pid, ZCZE_B, ZCZE_A, HBZJ_B, HBZJ_A, CH_B, CH_A, YSZK_B, YSZK_A, FZZE_B, FZZE_A, DQJK_B, DQJK_A, YFZK_B, YFZK_A, CQJK_B, CQJK_A, SYZQY_B, SYZQY_A, ZCFZL_B, ZCFZL_A FROM DW_DIMCOMPANY H LEFT JOIN ( SELECT GSBM, GSMC, ZCZE_B, ZCZE_A, HBZJ_B, HBZJ_A, CH_B, CH_A, YSZK_B, YSZK_A, FZZE_B, FZZE_A, DQJK_B, DQJK_A, YFZK_B, YFZK_A, CQJK_B, CQJK_A, SYZQY_B, SYZQY_A, ZCFZL_B, ZCFZL_A FROM tt1) g ON h.scode = g.gsbm where cisdel='N' AND SINDCODE IS NOT NULL AND STYPE<>'0' START WITH SCODE=:company CONNECT BY PRIOR SCODE=SPCODE ORDER BY H.SCODE",
        // 没有关联公司表
        "sql": "WITH TTT AS( SELECT CONNECT_BY_ROOT SCODE AS ROOT_SCODE, SCODE FROM DW_DIMCOMPANY WHERE CISDEL='N' and PROPERTY1='1' AND STYPE='1' CONNECT BY PRIOR SCODE=SPCODE) , TT AS ( SELECT ROOT_SCODE, SCODE FROM TTT WHERE ROOT_SCODE IN ( SELECT SCODE FROM DW_DIMCOMPANY WHERE PROPERTY1='1' AND CISDEL='N' START WITH SCODE=:company CONNECT BY PRIOR SCODE = SPCODE) ) , T1 AS ( SELECT fact_a, fact_b, DIM_ITEMPOINT, DIM_COMPANY, ROOT_SCODE FROM DW_FACTFINANCEPOINT E RIGHT JOIN TT F ON E.DIM_COMPANY=F.SCODE WHERE DIM_PERIOD=:period and DIM_ITEMPOINT in ('1100100', '1111001','1111401', '1111122', '1200100', '1200100','1212202', '1222501','1300100') ) , T2 AS ( SELECT t1.DIM_COMPANY, t1.ROOT_SCODE, (case when DIM_ITEMPOINT='1100100' then fact_a else 0 end ) ZCZE_A, (case when DIM_ITEMPOINT='1100100' then fact_b else 0 end ) ZCZE_B, (case when DIM_ITEMPOINT='1111001' then fact_a else 0 end ) HBZJ_A, (case when DIM_ITEMPOINT='1111001' then fact_b else 0 end ) HBZJ_b, (case when DIM_ITEMPOINT='1111401' then fact_a else 0 end ) CH_A, (case when DIM_ITEMPOINT='1111401' then fact_b else 0 end ) CH_B, (case when DIM_ITEMPOINT='1111122' then fact_a else 0 end ) YSZK_A, (case when DIM_ITEMPOINT='1111122' then fact_b else 0 end ) YSZK_b, (case when DIM_ITEMPOINT='1200100' then fact_a else 0 end ) FZZE_A, (case when DIM_ITEMPOINT='1200100' then fact_b else 0 end ) FZZE_B, (case when DIM_ITEMPOINT='1200100' then fact_a else 0 end ) DQJK_A, (case when DIM_ITEMPOINT='1200100' then fact_b else 0 end ) DQJK_B, (case when DIM_ITEMPOINT='1212202' then fact_a else 0 end ) YFZK_A, (case when DIM_ITEMPOINT='1212202' then fact_b else 0 end ) YFZK_B, (case when DIM_ITEMPOINT='1222501' then fact_a else 0 end ) CQJK_A, (case when DIM_ITEMPOINT='1222501' then fact_b else 0 end ) CQJK_B, (case when DIM_ITEMPOINT='1300100' then fact_a else 0 end ) SYZQY_A, (case when DIM_ITEMPOINT='1300100' then fact_b else 0 end ) SYZQY_B FROM t1 ) , tt1 AS ( SELECT ROOT_SCODE GSBM, SUM(NVL(ZCZE_B,0)) ZCZE_B, SUM(NVL(ZCZE_A,0)) ZCZE_A, SUM(NVL(HBZJ_B,0)) HBZJ_B, SUM(NVL(HBZJ_A,0)) HBZJ_A, SUM(NVL(CH_B,0)) CH_B, SUM(NVL(CH_A,0)) CH_A, SUM(NVL(YSZK_B,0)) YSZK_B, SUM(NVL(YSZK_A,0)) YSZK_A, SUM(NVL(FZZE_B,0)) FZZE_B, SUM(NVL(FZZE_A,0)) FZZE_A, SUM(NVL(DQJK_B,0)) DQJK_B, SUM(NVL(DQJK_A,0)) DQJK_A, SUM(NVL(YFZK_B,0)) YFZK_B, SUM(NVL(YFZK_A,0)) YFZK_A, SUM(NVL(CQJK_B,0)) CQJK_B, SUM(NVL(CQJK_A,0)) CQJK_A, SUM(NVL(SYZQY_B,0)) SYZQY_B, SUM(NVL(SYZQY_A,0)) SYZQY_A, CASE WHEN SUM(NVL(ZCZE_B,0))=0 THEN 0 ELSE ROUND((SUM(NVL(FZZE_B,0))/SUM(NVL(ZCZE_B,0))),4) END ZCFZL_B, CASE WHEN SUM(NVL(ZCZE_A,0))=0 THEN 0 ELSE ROUND((SUM(NVL(FZZE_A,0))/SUM(NVL(ZCZE_A,0))),4) END ZCFZL_A FROM T2 A GROUP BY ROOT_SCODE ) SELECT SCODE, SNAME, spcode, ZCZE_B, ZCZE_A, HBZJ_B, HBZJ_A, CH_B, CH_A, YSZK_B, YSZK_A, FZZE_B, FZZE_A, DQJK_B, DQJK_A, YFZK_B, YFZK_A, CQJK_B, CQJK_A, SYZQY_B, SYZQY_A, ZCFZL_B, ZCFZL_A FROM DW_DIMCOMPANY H LEFT JOIN ( SELECT GSBM, ZCZE_B, ZCZE_A, HBZJ_B, HBZJ_A, CH_B, CH_A, YSZK_B, YSZK_A, FZZE_B, FZZE_A, DQJK_B, DQJK_A, YFZK_B, YFZK_A, CQJK_B, CQJK_A, SYZQY_B, SYZQY_A, ZCFZL_B, ZCFZL_A FROM tt1) g ON h.scode = g.gsbm WHERE PROPERTY1='1' AND CISDEL='N' START WITH SCODE=:company CONNECT BY PRIOR SCODE = SPCODE ORDER BY H.SCODE",
        // "sql": "WITH TTT AS( SELECT CONNECT_BY_ROOT SCODE AS ROOT_SCODE, SCODE FROM DW_DIMCOMPANY WHERE CISDEL='N' AND STYPE='1' CONNECT BY PRIOR SCODE=SPCODE) , TT AS ( SELECT ROOT_SCODE, SCODE FROM TTT WHERE ROOT_SCODE IN ( SELECT SCODE FROM DW_DIMCOMPANY WHERE PROPERTY1='1' AND CISDEL='N' START WITH SCODE=:company CONNECT BY PRIOR SCODE = SPCODE) ) , T1 AS ( SELECT fact_a, fact_b, DIM_ITEMPOINT, DIM_COMPANY, ROOT_SCODE FROM DW_FACTFINANCEPOINT E RIGHT JOIN TT F ON E.DIM_COMPANY=F.SCODE WHERE DIM_PERIOD=:period ) , T2 AS ( SELECT t1.DIM_COMPANY, t1.ROOT_SCODE, fact_a ZCZE_A, fact_b ZCZE_B, HBZJ_A, HBZJ_b, CH_A, CH_B, YSZK_A, YSZK_b, FZZE_A, FZZE_B, DQJK_A, DQJK_B, YFZK_A, YFZK_B, CQJK_A, CQJK_B, SYZQY_A, SYZQY_B FROM t1 LEFT JOIN ( SELECT DIM_COMPANY, FACT_A HBZJ_A, FACT_B HBZJ_b FROM t1 WHERE DIM_ITEMPOINT='1111001') bb ON t1.DIM_COMPANY=bb.DIM_COMPANY LEFT JOIN ( SELECT DIM_COMPANY, FACT_A CH_A, FACT_B CH_B FROM t1 WHERE DIM_ITEMPOINT='1111401') cc ON cc.DIM_COMPANY=bb.DIM_COMPANY LEFT JOIN ( SELECT DIM_COMPANY, FACT_A YSZK_A, FACT_B YSZK_B FROM t1 WHERE DIM_ITEMPOINT='1111122') dd ON cc.DIM_COMPANY=dd.DIM_COMPANY LEFT JOIN ( SELECT DIM_COMPANY, fact_a FZZE_A, fact_b FZZE_B FROM t1 WHERE DIM_ITEMPOINT='1200100') EE ON EE.DIM_COMPANY=dd.DIM_COMPANY LEFT JOIN ( SELECT DIM_COMPANY, FACT_A DQJK_A, FACT_B DQJK_B FROM t1 WHERE DIM_ITEMPOINT='1212001') FF ON EE.DIM_COMPANY=FF.DIM_COMPANY LEFT JOIN ( SELECT DIM_COMPANY, FACT_A YFZK_A, FACT_B YFZK_B FROM t1 WHERE DIM_ITEMPOINT='1212202') GG ON FF.DIM_COMPANY=GG.DIM_COMPANY LEFT JOIN ( SELECT DIM_COMPANY, FACT_A CQJK_A, FACT_B CQJK_B FROM t1 WHERE DIM_ITEMPOINT='1222501') HH ON GG.DIM_COMPANY=HH.DIM_COMPANY LEFT JOIN ( SELECT DIM_COMPANY, FACT_A SYZQY_A, FACT_B SYZQY_B FROM T1 WHERE DIM_ITEMPOINT='1300100') II ON II.DIM_COMPANY=HH.DIM_COMPANY WHERE DIM_ITEMPOINT='1100100' ) , tt1 AS ( SELECT ROOT_SCODE GSBM, SUM(NVL(ZCZE_B,0)) ZCZE_B, SUM(NVL(ZCZE_A,0)) ZCZE_A, SUM(NVL(HBZJ_B,0)) HBZJ_B, SUM(NVL(HBZJ_A,0)) HBZJ_A, SUM(NVL(CH_B,0)) CH_B, SUM(NVL(CH_A,0)) CH_A, SUM(NVL(YSZK_B,0)) YSZK_B, SUM(NVL(YSZK_A,0)) YSZK_A, SUM(NVL(FZZE_B,0)) FZZE_B, SUM(NVL(FZZE_A,0)) FZZE_A, SUM(NVL(DQJK_B,0)) DQJK_B, SUM(NVL(DQJK_A,0)) DQJK_A, SUM(NVL(YFZK_B,0)) YFZK_B, SUM(NVL(YFZK_A,0)) YFZK_A, SUM(NVL(CQJK_B,0)) CQJK_B, SUM(NVL(CQJK_A,0)) CQJK_A, SUM(NVL(SYZQY_B,0)) SYZQY_B, SUM(NVL(SYZQY_A,0)) SYZQY_A, CASE WHEN SUM(NVL(ZCZE_B,0))=0 THEN 0 ELSE ROUND((SUM(NVL(FZZE_B,0))/SUM(NVL(ZCZE_B,0))),4) END ZCFZL_B, CASE WHEN SUM(NVL(ZCZE_A,0))=0 THEN 0 ELSE ROUND((SUM(NVL(FZZE_A,0))/SUM(NVL(ZCZE_A,0))),4) END ZCFZL_A FROM T2 A GROUP BY ROOT_SCODE ) SELECT SCODE, SNAME, spcode, ZCZE_B, ZCZE_A, HBZJ_B, HBZJ_A, CH_B, CH_A, YSZK_B, YSZK_A, FZZE_B, FZZE_A, DQJK_B, DQJK_A, YFZK_B, YFZK_A, CQJK_B, CQJK_A, SYZQY_B, SYZQY_A, ZCFZL_B, ZCFZL_A FROM DW_DIMCOMPANY H LEFT JOIN ( SELECT GSBM, ZCZE_B, ZCZE_A, HBZJ_B, HBZJ_A, CH_B, CH_A, YSZK_B, YSZK_A, FZZE_B, FZZE_A, DQJK_B, DQJK_A, YFZK_B, YFZK_A, CQJK_B, CQJK_A, SYZQY_B, SYZQY_A, ZCFZL_B, ZCFZL_A FROM tt1) g ON h.scode = g.gsbm WHERE PROPERTY1='1' AND CISDEL='N' START WITH SCODE=:company CONNECT BY PRIOR SCODE = SPCODE ORDER BY H.SCODE",
        // "sql": "WITH TT AS( SELECT SCODE, spcode, SNAME FROM DW_DIMCOMPANY WHERE PROPERTY1='1' AND CISDEL='N' AND SPCODE LIKE :company||'%' OR scode=:company) , T1 AS ( SELECT fact_a, fact_b, DIM_ITEMPOINT, DIM_COMPANY, F.SNAME FROM DW_FACTFINANCEPOINT E RIGHT JOIN TT F ON E.DIM_COMPANY=F.SCODE WHERE DIM_PERIOD=:period ) , T2 AS ( SELECT t1.DIM_COMPANY, t1.SNAME, fact_a ZCZE_A, fact_b ZCZE_B, HBZJ_A, HBZJ_b, CH_A, CH_B, YSZK_A, YSZK_b, FZZE_A, FZZE_B, DQJK_A, DQJK_B, YFZK_A, YFZK_B, CQJK_A, CQJK_B, SYZQY_A, SYZQY_B FROM t1 LEFT JOIN ( SELECT DIM_COMPANY, SNAME, FACT_A HBZJ_A, FACT_B HBZJ_b FROM t1 WHERE DIM_ITEMPOINT='1111001') bb ON t1.DIM_COMPANY=bb.DIM_COMPANY LEFT JOIN ( SELECT DIM_COMPANY, SNAME, FACT_A CH_A, FACT_B CH_B FROM t1 WHERE DIM_ITEMPOINT='1111401') cc ON cc.DIM_COMPANY=bb.DIM_COMPANY LEFT JOIN ( SELECT DIM_COMPANY, SNAME, FACT_A YSZK_A, FACT_B YSZK_B FROM t1 WHERE DIM_ITEMPOINT='1111122') dd ON cc.DIM_COMPANY=dd.DIM_COMPANY LEFT JOIN ( SELECT DIM_COMPANY, SNAME, fact_a FZZE_A, fact_b FZZE_B FROM t1 WHERE DIM_ITEMPOINT='1200100') EE ON EE.DIM_COMPANY=dd.DIM_COMPANY LEFT JOIN ( SELECT DIM_COMPANY, SNAME, FACT_A DQJK_A, FACT_B DQJK_B FROM t1 WHERE DIM_ITEMPOINT='1212001') FF ON EE.DIM_COMPANY=FF.DIM_COMPANY LEFT JOIN ( SELECT DIM_COMPANY, SNAME, FACT_A YFZK_A, FACT_B YFZK_B FROM t1 WHERE DIM_ITEMPOINT='1212202') GG ON FF.DIM_COMPANY=GG.DIM_COMPANY LEFT JOIN ( SELECT DIM_COMPANY, SNAME, FACT_A CQJK_A, FACT_B CQJK_B FROM t1 WHERE DIM_ITEMPOINT='1222501') HH ON GG.DIM_COMPANY=HH.DIM_COMPANY LEFT JOIN ( SELECT DIM_COMPANY, SNAME, FACT_A SYZQY_A, FACT_B SYZQY_B FROM T1 WHERE DIM_ITEMPOINT='1300100') II ON II.DIM_COMPANY=HH.DIM_COMPANY WHERE DIM_ITEMPOINT='1100100' ) , tt1 AS ( SELECT DIM_COMPANY GSBM, SNAME GSMC, SUM(NVL(ZCZE_B,0)) ZCZE_B, SUM(NVL(ZCZE_A,0)) ZCZE_A, SUM(NVL(HBZJ_B,0)) HBZJ_B, SUM(NVL(HBZJ_A,0)) HBZJ_A, SUM(NVL(CH_B,0)) CH_B, SUM(NVL(CH_A,0)) CH_A, SUM(NVL(YSZK_B,0)) YSZK_B, SUM(NVL(YSZK_A,0)) YSZK_A, SUM(NVL(FZZE_B,0)) FZZE_B, SUM(NVL(FZZE_A,0)) FZZE_A, SUM(NVL(DQJK_B,0)) DQJK_B, SUM(NVL(DQJK_A,0)) DQJK_A, SUM(NVL(YFZK_B,0)) YFZK_B, SUM(NVL(YFZK_A,0)) YFZK_A, SUM(NVL(CQJK_B,0)) CQJK_B, SUM(NVL(CQJK_A,0)) CQJK_A, SUM(NVL(SYZQY_B,0)) SYZQY_B, SUM(NVL(SYZQY_A,0)) SYZQY_A, CASE WHEN SUM(NVL(ZCZE_B,0))=0 THEN 0 ELSE ROUND((SUM(NVL(FZZE_B,0))/SUM(NVL(ZCZE_B,0)))*100,4) END ZCFZL_B, CASE WHEN SUM(NVL(ZCZE_A,0))=0 THEN 0 ELSE ROUND((SUM(NVL(FZZE_A,0))/SUM(NVL(ZCZE_A,0)))*100,4) END ZCFZL_A FROM T2 A GROUP BY DIM_COMPANY, SNAME ORDER BY DIM_COMPANY ) SELECT SCODE gsbm, SNAME, spcode as pid, ZCZE_B, ZCZE_A, HBZJ_B, HBZJ_A, CH_B, CH_A, YSZK_B, YSZK_A, FZZE_B, FZZE_A, DQJK_B, DQJK_A, YFZK_B, YFZK_A, CQJK_B, CQJK_A, SYZQY_B, SYZQY_A, ZCFZL_B, ZCFZL_A FROM DW_DIMCOMPANY H LEFT JOIN ( SELECT GSBM, GSMC, ZCZE_B, ZCZE_A, HBZJ_B, HBZJ_A, CH_B, CH_A, YSZK_B, YSZK_A, FZZE_B, FZZE_A, DQJK_B, DQJK_A, YFZK_B, YFZK_A, CQJK_B, CQJK_A, SYZQY_B, SYZQY_A, ZCFZL_B, ZCFZL_A FROM tt1) g ON h.scode = g.gsbm WHERE PROPERTY1='1' AND CISDEL='N' AND SPCODE LIKE :company||'%' OR scode=:company ORDER BY H.SCODE",
        // "sql": "WITH TT AS( SELECT SCODE,spcode, SNAME FROM DW_DIMCOMPANY WHERE PROPERTY1='1' and CISDEL='N' and SPCODE like :company || '%' or scode=:company), T1 as (select fact_a, fact_b, DIM_ITEMPOINT, DIM_COMPANY, F.SNAME from DW_FACTFINANCEPOINT E RIGHT JOIN TT F ON E.DIM_COMPANY=F.SCODE where DIM_PERIOD=:period ), T2 AS ( select t1.DIM_COMPANY,t1.SNAME, fact_a ZCZE_A, fact_b ZCZE_B, HBZJ_A, HBZJ_b,CH_A, CH_B,YSZK_A, YSZK_b,FZZE_A, FZZE_B, DQJK_A, DQJK_B, YFZK_A, YFZK_B, CQJK_A, CQJK_B,SYZQY_A, SYZQY_B from t1 left join (select DIM_COMPANY, SNAME, FACT_A HBZJ_A, FACT_B HBZJ_b from t1 where DIM_ITEMPOINT='1111001') bb on t1.DIM_COMPANY=bb.DIM_COMPANY left join (select DIM_COMPANY,SNAME, FACT_A CH_A, FACT_B CH_B from t1 where DIM_ITEMPOINT='1111401') cc on cc.DIM_COMPANY=bb.DIM_COMPANY left join (select DIM_COMPANY,SNAME, FACT_A YSZK_A, FACT_B YSZK_B from t1 where DIM_ITEMPOINT='1111122') dd on cc.DIM_COMPANY=dd.DIM_COMPANY LEFT JOIN (select DIM_COMPANY,SNAME, fact_a FZZE_A, fact_b FZZE_B from t1 where DIM_ITEMPOINT='1200100') EE ON EE.DIM_COMPANY=dd.DIM_COMPANY LEFT JOIN (select DIM_COMPANY,SNAME, FACT_A DQJK_A, FACT_B DQJK_B from t1 where DIM_ITEMPOINT='1212001') FF on EE.DIM_COMPANY=FF.DIM_COMPANY left join (select DIM_COMPANY,SNAME, FACT_A YFZK_A, FACT_B YFZK_B from t1 where DIM_ITEMPOINT='1212202') GG on FF.DIM_COMPANY=GG.DIM_COMPANY left join (select DIM_COMPANY,SNAME, FACT_A CQJK_A, FACT_B CQJK_B from t1 where DIM_ITEMPOINT='1222501') HH on GG.DIM_COMPANY=HH.DIM_COMPANY LEFT JOIN (SELECT DIM_COMPANY,SNAME, FACT_A SYZQY_A, FACT_B SYZQY_B FROM T1 WHERE DIM_ITEMPOINT='1300100') II on II.DIM_COMPANY=HH.DIM_COMPANY where DIM_ITEMPOINT='1100100' ) SELECT DIM_COMPANY GSBM,SNAME GSMC, SUM(NVL(ZCZE_B,0)) ZCZE_B,SUM(NVL(ZCZE_A,0)) ZCZE_A, SUM(NVL(HBZJ_B,0)) HBZJ_B, SUM(NVL(HBZJ_A,0)) HBZJ_A,SUM(NVL(CH_B,0)) CH_B, SUM(NVL(CH_A,0)) CH_A, SUM(NVL(YSZK_B,0)) YSZK_B, SUM(NVL(YSZK_A,0)) YSZK_A, SUM(NVL(FZZE_B,0)) FZZE_B,SUM(NVL(FZZE_A,0)) FZZE_A,SUM(NVL(DQJK_B,0)) DQJK_B, SUM(NVL(DQJK_A,0)) DQJK_A, SUM(NVL(YFZK_B,0)) YFZK_B,SUM(NVL(YFZK_A,0)) YFZK_A,SUM(NVL(CQJK_B,0)) CQJK_B, SUM(NVL(CQJK_A,0)) CQJK_A, SUM(NVL(SYZQY_B,0)) SYZQY_B, SUM(NVL(SYZQY_A,0)) SYZQY_A, CASE WHEN SUM(NVL(ZCZE_B,0))=0 THEN 0 ELSE ROUND((SUM(NVL(FZZE_B,0))/SUM(NVL(ZCZE_B,0))),4)*100 END ZCFZL_B, CASE WHEN SUM(NVL(ZCZE_A,0))=0 THEN 0 ELSE ROUND((SUM(NVL(FZZE_A,0))/SUM(NVL(ZCZE_A,0))),4)*100 END ZCFZL_A FROM T2 A GROUP BY DIM_COMPANY,SNAME ORDER BY DIM_COMPANY",
        // "sql": "WITH TT AS( SELECT SCODE,spcode, SNAME FROM DW_DIMCOMPANY WHERE PROPERTY1='1' and CISDEL='N' and SPCODE like :company||'%' or scode=:company), T1 as (select fact_a, fact_b, DIM_ITEMPOINT, DIM_COMPANY, F.SNAME from DW_FACTFINANCEPOINT E RIGHT JOIN TT F ON E.DIM_COMPANY=F.SCODE where DIM_PERIOD=:period ), T2 AS ( select t1.DIM_COMPANY,t1.SNAME, fact_a ZCZE_A, fact_b ZCZE_B, HBZJ_A, HBZJ_b,CH_A, CH_B,YSZK_A, YSZK_b,FZZE_A, FZZE_B, DQJK_A, DQJK_B, YFZK_A, YFZK_B, CQJK_A, CQJK_B,SYZQY_A, SYZQY_B from t1 left join (select DIM_COMPANY, SNAME, FACT_A HBZJ_A, FACT_B HBZJ_b from t1 where DIM_ITEMPOINT='1111001') bb on t1.DIM_COMPANY=bb.DIM_COMPANY left join (select DIM_COMPANY,SNAME, FACT_A CH_A, FACT_B CH_B from t1 where DIM_ITEMPOINT='1111401') cc on cc.DIM_COMPANY=bb.DIM_COMPANY left join (select DIM_COMPANY,SNAME, FACT_A YSZK_A, FACT_B YSZK_B from t1 where DIM_ITEMPOINT='1111122') dd on cc.DIM_COMPANY=dd.DIM_COMPANY LEFT JOIN (select DIM_COMPANY,SNAME, fact_a FZZE_A, fact_b FZZE_B from t1 where DIM_ITEMPOINT='1200100') EE ON EE.DIM_COMPANY=dd.DIM_COMPANY LEFT JOIN (select DIM_COMPANY,SNAME, FACT_A DQJK_A, FACT_B DQJK_B from t1 where DIM_ITEMPOINT='1212001') FF on EE.DIM_COMPANY=FF.DIM_COMPANY left join (select DIM_COMPANY,SNAME, FACT_A YFZK_A, FACT_B YFZK_B from t1 where DIM_ITEMPOINT='1212202') GG on FF.DIM_COMPANY=GG.DIM_COMPANY left join (select DIM_COMPANY,SNAME, FACT_A CQJK_A, FACT_B CQJK_B from t1 where DIM_ITEMPOINT='1222501') HH on GG.DIM_COMPANY=HH.DIM_COMPANY LEFT JOIN (SELECT DIM_COMPANY,SNAME, FACT_A SYZQY_A, FACT_B SYZQY_B FROM T1 WHERE DIM_ITEMPOINT='1300100') II on II.DIM_COMPANY=HH.DIM_COMPANY where DIM_ITEMPOINT='1100100' ), tt1 as ( SELECT DIM_COMPANY GSBM,SNAME GSMC, SUM(NVL(ZCZE_B,0)) ZCZE_B,SUM(NVL(ZCZE_A,0)) ZCZE_A, SUM(NVL(HBZJ_B,0)) HBZJ_B, SUM(NVL(HBZJ_A,0)) HBZJ_A,SUM(NVL(CH_B,0)) CH_B, SUM(NVL(CH_A,0)) CH_A, SUM(NVL(YSZK_B,0)) YSZK_B, SUM(NVL(YSZK_A,0)) YSZK_A, SUM(NVL(FZZE_B,0)) FZZE_B,SUM(NVL(FZZE_A,0)) FZZE_A,SUM(NVL(DQJK_B,0)) DQJK_B, SUM(NVL(DQJK_A,0)) DQJK_A, SUM(NVL(YFZK_B,0)) YFZK_B,SUM(NVL(YFZK_A,0)) YFZK_A,SUM(NVL(CQJK_B,0)) CQJK_B, SUM(NVL(CQJK_A,0)) CQJK_A, SUM(NVL(SYZQY_B,0)) SYZQY_B, SUM(NVL(SYZQY_A,0)) SYZQY_A, CASE WHEN SUM(NVL(ZCZE_B,0))=0 THEN 0 ELSE ROUND((SUM(NVL(FZZE_B,0))/SUM(NVL(ZCZE_B,0))),4) END ZCFZL_B, CASE WHEN SUM(NVL(ZCZE_A,0))=0 THEN 0 ELSE ROUND((SUM(NVL(FZZE_A,0))/SUM(NVL(ZCZE_A,0))),4) END ZCFZL_A FROM T2 A GROUP BY DIM_COMPANY,SNAME ORDER BY DIM_COMPANY ) SELECT SCODE, SNAME, ZCZE_B, ZCZE_A, HBZJ_B, HBZJ_A, CH_B, CH_A, YSZK_B, YSZK_A, FZZE_B, FZZE_A, DQJK_B, DQJK_A, YFZK_B, YFZK_A, CQJK_B, CQJK_A, SYZQY_B, SYZQY_A, ZCFZL_B, ZCFZL_A FROM DW_DIMCOMPANY H left join ( select GSBM, GSMC, ZCZE_B, ZCZE_A, HBZJ_B, HBZJ_A, CH_B, CH_A, YSZK_B, YSZK_A, FZZE_B, FZZE_A, DQJK_B, DQJK_A, YFZK_B, YFZK_A, CQJK_B, CQJK_A, SYZQY_B, SYZQY_A, ZCFZL_B, ZCFZL_A from tt1) g ON h.scode = g.gsbm WHERE PROPERTY1='1' AND CISDEL='N' AND SPCODE LIKE :company||'%' OR scode=:company ORDER BY H.SCODE",
        "_cube":{
            "cubeId":4,
            "subject":"0002"
        },
        "mainDim":"itemperiod",
        "needDims":["year","month","company","conversion"],
        "random":{"min":100,"max":100000},
        "tableHeads":true,
        "type":1  
    },
    "columns": [
       
    {
        "id": "scode",
        "type": "string",
        "width":"200",
        "fixed":true,
        "align": "left",
        "text": "公司编码"
    },
    {
        "id": "sname",
        "type": "string",
        "width":"360px",
        "align": "left",
        "fixed":true,
        "text": "公司名称"
    },{
        "id":"",
        "type":"string",
        "text":"资产总额",
        "children":[
            {
                "id": "",
                "type": "string",
                "text": "资产总额",
                "children":[{
                    "id": "zcze_b",
                    "type": "decimal",
                    "width":"200px",
                    "align": "right",
                    "text": "本期"
                },{
                    "id": "zcze_a",
                    "type": "decimal",
                    "width":"200px",
                    "align": "right",
                    "text": "期初"
                }]
            },{
                "id": "",
                "type": "string",
                "text": "货币资金",
                "children":[{
                    "id": "hbzj_b",
                    "type": "decimal",
                    "width":"200px",
                    "align": "right",
                    "text": "本期"
                },{
                    "id": "hbzj_a",
                    "type": "decimal",
                    "width":"200px",
                    "align": "right",
                    "text": "期初"
                }]
            },{
                "id": "",
                "type": "string",
                "text": "存货",
                "children":[{
                    "id": "ch_b",
                    "type": "decimal",
                    "width":"200px",
                    "align": "right",
                    "text": "本期"
                },{
                    "id": "ch_a",
                    "type": "decimal",
                    "width":"200px",
                    "align": "right",
                    "text": "期初"
                }]
            },{
                "id": "",
                "type": "string",
                "text": "应收账款",
                "children":[{
                    "id": "yszk_b",
                    "type": "decimal",
                    "width":"200px",
                    "align": "right",
                    "text": "本期"
                },{
                    "id": "yszk_a",
                    "type": "decimal",
                    "width":"200px",
                    "align": "right",
                    "text": "期初"
                }]
            }
        ]
    },{
        "id":"",
        "type":"string",
        "text":"负债总额",
        "children":[
            {
                "id": "",
                "type": "string",
                "text": "负债总额",
                "children":[{
                    "id": "fzze_b",
                    "type": "decimal",
                    "width":"200px",
                    "align": "right",
                    "text": "本期"
                },{
                    "id": "fzze_a",
                    "type": "decimal",
                    "width":"200px",
                    "align": "right",
                    "text": "期初"
                }]
            },{
                "id": "",
                "type": "string",
                "text": "短期借款",
                "children":[{
                    "id": "dqjk_b",
                    "type": "decimal",
                    "width":"200px",
                    "align": "right",
                    "text": "本期"
                },{
                    "id": "dqjk_a",
                    "type": "decimal",
                    "width":"200px",
                    "align": "right",
                    "text": "期初"
                }]
            },{
                "id": "",
                "type": "string",
                "text": "应付账款",
                "children":[{
                    "id": "yfzk_b",
                    "type": "decimal",
                    "width":"200px",
                    "align": "right",
                    "text": "本期"
                },{
                    "id": "yfzk_a",
                    "type": "decimal",
                    "width":"200px",
                    "align": "right",
                    "text": "期初"
                }]
            },{
                "id": "",
                "type": "string",
                "text": "长期借款",
                "children":[{
                    "id": "cqjk_b",
                    "type": "decimal",
                    "width":"200px",
                    "align": "right",
                    "text": "本期"
                },{
                    "id": "cqjk_a",
                    "type": "decimal",
                    "width":"200px",
                    "align": "right",
                    "text": "期初"
                }]
            }
        ]
    },
    {
        "id": "syzqy",
        "type": "string",
        "text": "所有者权益",
        "children":[{
            "id": "syzqy_b",
            "type": "decimal",
            "width":"200px",
            "align": "right",
            "text": "本期"
        },{
            "id": "syzqy_a",
            "type": "decimal",
            "width":"200px",
            "align": "right",
            "text": "期初"
        }]
    },
    {
        "id": "",
        "type": "string",
        "text": "资产负债率%",
        "children":[{
            "id": "zcfzl_b",
            "type": "decimal",
            "width":"130px",
            "text": "本期",
            "align": "right",
            "conversion":"%"
        },{
            "id": "zcfzl_a",
            "type": "decimal",
            "width":"130px",
            "text": "期初",
            "align": "right",
            "conversion":"%"
        }]
    },
],
    "rows": [],
    "items":[
        {
            "xtype" : "elementTree",
            "stype" : false,
            "id" : "cwzkzb",
            "stype": false,
            "isUnfold": true,// 自动展开的配置
            "text" : "财务状况指标",
            "levelProperties": { gsbm: "_level" },
            "queryDataAfter":function(data, $vue){
                // debugger
                // 是否为重点单位，只展示为“是”的公司，“否”不展示（空表）；0=否｜1=是
                let property = $vue.$store.getters.treeInfo.property1 ;                
                if(property == "0"){
                    data = [] ;
                    $vue.items[0].property = true; 
                    $vue.$message({ message: "该公司不是重点单位", type: "warning" })
                }else{
                    $vue.items[0].property = false; 
                }
                return data;                   
            },
            "toolbar":[{    
                "id":"1",
                "text":"刷新",
                "xtype":"button",
                "cellStyle":{
                    // "color":"black",
                    // "background-color":"#189271"
                    // "background-color":"#fff"
                    "margin-bottom": "0px"
                },
                "handler":function(vue,btn){
                    // debugger
                    // console.log(vue);
                    let $vue = vue.item.$vue;
                    $vue.closeTabTaget({}, $vue);
                    vue.item.updateView("company");
                }
            },{
                "id":"2",
                "text":"导出",
                "xtype":"button",
                "cellStyle":{
                    // "color":"black",
                    // "background-color":"#189271"
                    // "background-color":"#fff"
                    "margin-bottom": "0px"
                },
                "handler":function(vue,btn){
                    // debugger
                    // console.log(vue);
                    vue.handleDownload(vue);
                }
            }]
        }
    ]
}