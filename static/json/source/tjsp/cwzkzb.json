{
    "id":"001401",
    "text": "财务状况指标",
    "layout":{
        "xtype":"tab"
    },
    "showDims": ["year","month","company","conversion"],
    "changeCompanyBefore":function(newcompany,option){ 
        option.closeTabTaget(newcompany,option);
    },
    "changeYearBefore":function(newyear,option){
        option.closeTabTaget(newyear,option);
    },
    "changeMonthBefore":function(newmonth,option){
        debugger
        option.closeTabTaget(newmonth,option);
    },
    "__queryDataAfter":function(data,$vue){//数据的后置处理
        let me = this;
        // 是否为重点单位，只展示为“是”的公司，“否”不展示（空表）；0=否｜1=是
        let property = me.$store.getters.treeInfo.property1 ; 
        if(me.id == "001401"){
            if(property == "0")data = "" ; 
        }
        me.items[0].updateView = $vue.updateView;
        me.items[0].$vue = $vue;
        return data;
    },
    "config": {
        // 没有关联公司表
        // "sql": "WITH TT AS( SELECT SCODE,spcode, SNAME FROM DW_DIMCOMPANY WHERE PROPERTY1='1' and CISDEL='N' and SPCODE like :company || '%' or scode=:company), T1 as (select fact_a, fact_b, DIM_ITEMPOINT, DIM_COMPANY, F.SNAME from DW_FACTFINANCEPOINT E RIGHT JOIN TT F ON E.DIM_COMPANY=F.SCODE where DIM_PERIOD=:period ), T2 AS ( select t1.DIM_COMPANY,t1.SNAME, fact_a ZCZE_A, fact_b ZCZE_B, HBZJ_A, HBZJ_b,CH_A, CH_B,YSZK_A, YSZK_b,FZZE_A, FZZE_B, DQJK_A, DQJK_B, YFZK_A, YFZK_B, CQJK_A, CQJK_B,SYZQY_A, SYZQY_B from t1 left join (select DIM_COMPANY, SNAME, FACT_A HBZJ_A, FACT_B HBZJ_b from t1 where DIM_ITEMPOINT='1111001') bb on t1.DIM_COMPANY=bb.DIM_COMPANY left join (select DIM_COMPANY,SNAME, FACT_A CH_A, FACT_B CH_B from t1 where DIM_ITEMPOINT='1111401') cc on cc.DIM_COMPANY=bb.DIM_COMPANY left join (select DIM_COMPANY,SNAME, FACT_A YSZK_A, FACT_B YSZK_B from t1 where DIM_ITEMPOINT='1111122') dd on cc.DIM_COMPANY=dd.DIM_COMPANY LEFT JOIN (select DIM_COMPANY,SNAME, fact_a FZZE_A, fact_b FZZE_B from t1 where DIM_ITEMPOINT='1200100') EE ON EE.DIM_COMPANY=dd.DIM_COMPANY LEFT JOIN (select DIM_COMPANY,SNAME, FACT_A DQJK_A, FACT_B DQJK_B from t1 where DIM_ITEMPOINT='1212001') FF on EE.DIM_COMPANY=FF.DIM_COMPANY left join (select DIM_COMPANY,SNAME, FACT_A YFZK_A, FACT_B YFZK_B from t1 where DIM_ITEMPOINT='1212202') GG on FF.DIM_COMPANY=GG.DIM_COMPANY left join (select DIM_COMPANY,SNAME, FACT_A CQJK_A, FACT_B CQJK_B from t1 where DIM_ITEMPOINT='1222501') HH on GG.DIM_COMPANY=HH.DIM_COMPANY LEFT JOIN (SELECT DIM_COMPANY,SNAME, FACT_A SYZQY_A, FACT_B SYZQY_B FROM T1 WHERE DIM_ITEMPOINT='1300100') II on II.DIM_COMPANY=HH.DIM_COMPANY where DIM_ITEMPOINT='1100100' ) SELECT DIM_COMPANY GSBM,SNAME GSMC, SUM(NVL(ZCZE_B,0)) ZCZE_B,SUM(NVL(ZCZE_A,0)) ZCZE_A, SUM(NVL(HBZJ_B,0)) HBZJ_B, SUM(NVL(HBZJ_A,0)) HBZJ_A,SUM(NVL(CH_B,0)) CH_B, SUM(NVL(CH_A,0)) CH_A, SUM(NVL(YSZK_B,0)) YSZK_B, SUM(NVL(YSZK_A,0)) YSZK_A, SUM(NVL(FZZE_B,0)) FZZE_B,SUM(NVL(FZZE_A,0)) FZZE_A,SUM(NVL(DQJK_B,0)) DQJK_B, SUM(NVL(DQJK_A,0)) DQJK_A, SUM(NVL(YFZK_B,0)) YFZK_B,SUM(NVL(YFZK_A,0)) YFZK_A,SUM(NVL(CQJK_B,0)) CQJK_B, SUM(NVL(CQJK_A,0)) CQJK_A, SUM(NVL(SYZQY_B,0)) SYZQY_B, SUM(NVL(SYZQY_A,0)) SYZQY_A, CASE WHEN SUM(NVL(ZCZE_B,0))=0 THEN 0 ELSE ROUND((SUM(NVL(FZZE_B,0))/SUM(NVL(ZCZE_B,0))),4)*100 END ZCFZL_B, CASE WHEN SUM(NVL(ZCZE_A,0))=0 THEN 0 ELSE ROUND((SUM(NVL(FZZE_A,0))/SUM(NVL(ZCZE_A,0))),4)*100 END ZCFZL_A FROM T2 A GROUP BY DIM_COMPANY,SNAME ORDER BY DIM_COMPANY",
        "sql": "WITH TT AS( SELECT SCODE,spcode, SNAME FROM DW_DIMCOMPANY WHERE PROPERTY1='1' and CISDEL='N' and SPCODE like :company||'%' or scode=:company), T1 as (select fact_a, fact_b, DIM_ITEMPOINT, DIM_COMPANY, F.SNAME from DW_FACTFINANCEPOINT E RIGHT JOIN TT F ON E.DIM_COMPANY=F.SCODE where DIM_PERIOD=:period ), T2 AS ( select t1.DIM_COMPANY,t1.SNAME, fact_a ZCZE_A, fact_b ZCZE_B, HBZJ_A, HBZJ_b,CH_A, CH_B,YSZK_A, YSZK_b,FZZE_A, FZZE_B, DQJK_A, DQJK_B, YFZK_A, YFZK_B, CQJK_A, CQJK_B,SYZQY_A, SYZQY_B from t1 left join (select DIM_COMPANY, SNAME, FACT_A HBZJ_A, FACT_B HBZJ_b from t1 where DIM_ITEMPOINT='1111001') bb on t1.DIM_COMPANY=bb.DIM_COMPANY left join (select DIM_COMPANY,SNAME, FACT_A CH_A, FACT_B CH_B from t1 where DIM_ITEMPOINT='1111401') cc on cc.DIM_COMPANY=bb.DIM_COMPANY left join (select DIM_COMPANY,SNAME, FACT_A YSZK_A, FACT_B YSZK_B from t1 where DIM_ITEMPOINT='1111122') dd on cc.DIM_COMPANY=dd.DIM_COMPANY LEFT JOIN (select DIM_COMPANY,SNAME, fact_a FZZE_A, fact_b FZZE_B from t1 where DIM_ITEMPOINT='1200100') EE ON EE.DIM_COMPANY=dd.DIM_COMPANY LEFT JOIN (select DIM_COMPANY,SNAME, FACT_A DQJK_A, FACT_B DQJK_B from t1 where DIM_ITEMPOINT='1212001') FF on EE.DIM_COMPANY=FF.DIM_COMPANY left join (select DIM_COMPANY,SNAME, FACT_A YFZK_A, FACT_B YFZK_B from t1 where DIM_ITEMPOINT='1212202') GG on FF.DIM_COMPANY=GG.DIM_COMPANY left join (select DIM_COMPANY,SNAME, FACT_A CQJK_A, FACT_B CQJK_B from t1 where DIM_ITEMPOINT='1222501') HH on GG.DIM_COMPANY=HH.DIM_COMPANY LEFT JOIN (SELECT DIM_COMPANY,SNAME, FACT_A SYZQY_A, FACT_B SYZQY_B FROM T1 WHERE DIM_ITEMPOINT='1300100') II on II.DIM_COMPANY=HH.DIM_COMPANY where DIM_ITEMPOINT='1100100' ), tt1 as ( SELECT DIM_COMPANY GSBM,SNAME GSMC, SUM(NVL(ZCZE_B,0)) ZCZE_B,SUM(NVL(ZCZE_A,0)) ZCZE_A, SUM(NVL(HBZJ_B,0)) HBZJ_B, SUM(NVL(HBZJ_A,0)) HBZJ_A,SUM(NVL(CH_B,0)) CH_B, SUM(NVL(CH_A,0)) CH_A, SUM(NVL(YSZK_B,0)) YSZK_B, SUM(NVL(YSZK_A,0)) YSZK_A, SUM(NVL(FZZE_B,0)) FZZE_B,SUM(NVL(FZZE_A,0)) FZZE_A,SUM(NVL(DQJK_B,0)) DQJK_B, SUM(NVL(DQJK_A,0)) DQJK_A, SUM(NVL(YFZK_B,0)) YFZK_B,SUM(NVL(YFZK_A,0)) YFZK_A,SUM(NVL(CQJK_B,0)) CQJK_B, SUM(NVL(CQJK_A,0)) CQJK_A, SUM(NVL(SYZQY_B,0)) SYZQY_B, SUM(NVL(SYZQY_A,0)) SYZQY_A, CASE WHEN SUM(NVL(ZCZE_B,0))=0 THEN 0 ELSE ROUND((SUM(NVL(FZZE_B,0))/SUM(NVL(ZCZE_B,0))),4) END ZCFZL_B, CASE WHEN SUM(NVL(ZCZE_A,0))=0 THEN 0 ELSE ROUND((SUM(NVL(FZZE_A,0))/SUM(NVL(ZCZE_A,0))),4) END ZCFZL_A FROM T2 A GROUP BY DIM_COMPANY,SNAME ORDER BY DIM_COMPANY ) SELECT SCODE, SNAME, ZCZE_B, ZCZE_A, HBZJ_B, HBZJ_A, CH_B, CH_A, YSZK_B, YSZK_A, FZZE_B, FZZE_A, DQJK_B, DQJK_A, YFZK_B, YFZK_A, CQJK_B, CQJK_A, SYZQY_B, SYZQY_A, ZCFZL_B, ZCFZL_A FROM DW_DIMCOMPANY H left join ( select GSBM, GSMC, ZCZE_B, ZCZE_A, HBZJ_B, HBZJ_A, CH_B, CH_A, YSZK_B, YSZK_A, FZZE_B, FZZE_A, DQJK_B, DQJK_A, YFZK_B, YFZK_A, CQJK_B, CQJK_A, SYZQY_B, SYZQY_A, ZCFZL_B, ZCFZL_A from tt1) g ON h.scode = g.gsbm WHERE PROPERTY1='1' AND CISDEL='N' AND SPCODE LIKE :company||'%' OR scode=:company ORDER BY H.SCODE",
        "_cube":{
            "cubeId":4,
            "subject":"0002"
        },
        "mainDim":"itemperiod",
        "needDims":["year","month","company","conversion"],
        "random":{"min":100,"max":100000},
        "tableHeads":true,
        "type":1  
    },
    "columns": [
    {
        "id": "",
        "type": "string",
        "text": "资产负债率%",
        "children":[{
            "id": "zcfzl_b",
            "type": "decimal",
            "width":"130px",
            "text": "本期",
            "conversion":"%"
        },{
            "id": "zcfzl_a",
            "type": "decimal",
            "width":"130px",
            "text": "期初",
            "conversion":"%"
        }]
    },    
    {
        "id": "scode",
        "type": "string",
        "width":"120px",
        "fixed":true,
        "text": "公司编码"
    },
    {
        "id": "sname",
        "type": "string",
        "width":"360px",
        "fixed":true,
        "text": "公司名称"
    },{
        "id":"",
        "type":"string",
        "text":"资产总额",
        "children":[
            {
                "id": "",
                "type": "string",
                "text": "资产总额",
                "children":[{
                    "id": "zcze_b",
                    "type": "decimal",
                    "width":"170px",
                    "text": "本期"
                },{
                    "id": "zcze_a",
                    "type": "decimal",
                    "width":"170px",
                    "text": "期初"
                }]
            },{
                "id": "",
                "type": "string",
                "text": "货币资金",
                "children":[{
                    "id": "hbzj_b",
                    "type": "decimal",
                    "width":"170px",
                    "text": "本期"
                },{
                    "id": "hbzj_a",
                    "type": "decimal",
                    "width":"170px",
                    "text": "期初"
                }]
            },{
                "id": "",
                "type": "string",
                "text": "存货",
                "children":[{
                    "id": "ch_b",
                    "type": "decimal",
                    "width":"170px",
                    "text": "本期"
                },{
                    "id": "ch_a",
                    "type": "decimal",
                    "width":"170px",
                    "text": "期初"
                }]
            },{
                "id": "",
                "type": "string",
                "text": "应收账款",
                "children":[{
                    "id": "yszk_b",
                    "type": "decimal",
                    "width":"170px",
                    "text": "本期"
                },{
                    "id": "yszk_a",
                    "type": "decimal",
                    "width":"170px",
                    "text": "期初"
                }]
            }
        ]
    },{
        "id":"",
        "type":"string",
        "text":"负债总额",
        "children":[
            {
                "id": "",
                "type": "string",
                "text": "负债总额",
                "children":[{
                    "id": "fzze_b",
                    "type": "decimal",
                    "width":"170px",
                    "text": "本期"
                },{
                    "id": "fzze_a",
                    "type": "decimal",
                    "width":"170px",
                    "text": "期初"
                }]
            },{
                "id": "",
                "type": "string",
                "text": "短期借款",
                "children":[{
                    "id": "dqjk_b",
                    "type": "decimal",
                    "width":"170px",
                    "text": "本期"
                },{
                    "id": "dqjk_a",
                    "type": "decimal",
                    "width":"170px",
                    "text": "期初"
                }]
            },{
                "id": "",
                "type": "string",
                "text": "应付账款",
                "children":[{
                    "id": "yfzk_b",
                    "type": "decimal",
                    "width":"170px",
                    "text": "本期"
                },{
                    "id": "yfzk_a",
                    "type": "decimal",
                    "width":"170px",
                    "text": "期初"
                }]
            },{
                "id": "",
                "type": "string",
                "text": "长期借款",
                "children":[{
                    "id": "cqjk_b",
                    "type": "decimal",
                    "width":"170px",
                    "text": "本期"
                },{
                    "id": "cqjk_a",
                    "type": "decimal",
                    "width":"170px",
                    "text": "期初"
                }]
            }
        ]
    },
    {
        "id": "syzqy",
        "type": "string",
        "text": "所有者权益",
        "children":[{
            "id": "syzqy_b",
            "type": "decimal",
            "width":"170px",
            "text": "本期"
        },{
            "id": "syzqy_a",
            "type": "decimal",
            "width":"170px",
            "text": "期初"
        }]
    }],
    "rows": [],
    "items":[
        {
            "xtype" : "bi-table",
            "stype" : "tree",
            "id" : "cwzkzb",
            "text" : "财务状况指标",
            "toolbar":[{    
                "id":"1",
                "text":"刷新",
                "xtype":"button",
                "cellStyle":{
                    "color":"black",
                    // "background-color":"#189271"
                    "background-color":"#fff"
                },
                "handler":function(vue,btn){
                    debugger
                    console.log(vue);
                    let $vue = vue.item.$vue;
                    $vue.closeTabTaget({}, $vue);
                    vue.item.updateView("company");
                }
            },{
                "id":"2",
                "text":"导出",
                "xtype":"button",
                "cellStyle":{
                    "color":"black",
                    // "background-color":"#189271"
                    "background-color":"#fff"
                },
                "handler":function(vue,btn){
                    debugger
                    console.log(vue);
                    vue.handleDownload(vue);
                }
            }]
        }
    ]
}