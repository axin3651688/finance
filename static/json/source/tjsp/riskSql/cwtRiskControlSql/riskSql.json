{
  "code": 200,
  "sqlList": [
    {
      "id": "001",
      "text": "风险反馈普通表数据",
      "sql": "WITH riskstate AS ( SELECT SISFEEDBACK, NRELATEID， SINSTRUCTSCONTENT, SFEEDBACKSCONTENT FROM RISK_REPORTSTATE WHERE DIM_COMPANY=:company AND DIM_PERIOD=:period ) , risklist AS ( SELECT nid, DIM_COMPANY, DIM_PERIOD, DIM_DEPARTMENT , SRISKNAME， NPROBABILITY, NINFLUENCE, NGRADE, SRISKDESCRIPTION, SMEASURES, SPROPOSAL, SRISKTYPE FROM RISK_DISTINGUISH WHERE nid IN ( SELECT NRELATEID FROM riskstate) AND dim_department = :departId ) , datalist AS ( SELECT nid, dim_company, dim_period, dim_department, sriskname, sisfeedback， SINSTRUCTSCONTENT, NPROBABILITY, NINFLUENCE, NGRADE, SRISKDESCRIPTION, SMEASURES, SPROPOSAL, risk_type.sname AS SRISKTYPE , SFEEDBACKSCONTENT FROM risklist LEFT JOIN riskstate ON risklist.nid = riskstate.nrelateid LEFT JOIN ( SELECT scode, sname FROM risk_type) risk_type ON risk_type.scode=risklist.SRISKTYPE ) SELECT a.nid AS scode, rownum, sriskname AS riskname, SRISKTYPE AS risktype, b.sname AS riskprobability, d.sname AS riskdegree, c.sname AS risklevel, SRISKDESCRIPTION AS riskoverview, SMEASURES AS riskmeasure, SPROPOSAL AS risksuggest, SINSTRUCTSCONTENT AS instruction， SFEEDBACKSCONTENT AS riskfeed, ( CASE sisfeedback WHEN '-1' THEN '未反馈' WHEN '1' THEN '已反馈' ELSE '' END ) AS backState, ( CASE sisfeedback WHEN '-1' THEN '0-反馈,3-提醒' WHEN '1' THEN '1-查看,2-退回' ELSE '' END ) AS operation FROM datalist a left join RISK_PROBABILITY b on a.NPROBABILITY=b.nid left join RISK_MATRIX c on a.NGRADE=c.nid left join RISK_INFLUENCE_DEGREE d on a.NINFLUENCE=d.nid"
    },
    {
      "id": "002",
      "text": "风险追踪普通标数据",
      "sql": "WITH riskstate AS ( SELECT SISREPORT, SREPORTUSER, SREPORTTIME, SISINSTRUCTIONS, SINSTRUCTIONSUSER, SINSTRUCTIONTIME, SINSTRUCTSCONTENT， SISFEEDBACK, SFEEDBACKSUSER, SFEEDBACKTIME, SFEEDBACKSCONTENT， NRELATEID FROM RISK_REPORTSTATE WHERE DIM_COMPANY=:company AND DIM_PERIOD<=:period ) , risklist AS ( SELECT nid, DIM_COMPANY, DIM_PERIOD, DIM_DEPARTMENT, SRISKNAME， SMEASURES， SPROPOSAL， SRISKTYPE， NPROBABILITY， NINFLUENCE， NGRADE， SRISKDESCRIPTION FROM RISK_DISTINGUISH WHERE DIM_COMPANY=:company AND DIM_PERIOD<=:period AND dim_department = :departId and SISSUBMIT='Y' ) SELECT A.nid AS scode, rownum, sriskname AS riskname, aa.RISK_STATUS, (select STRUENAME from SYS_USER where SUSER=aa.SB_USER) as SB_USER, (select STRUENAME from SYS_USER where SUSER=aa.PS_USER) as PS_USER, (select STRUENAME from SYS_USER where SUSER=aa.FK_USER) as FK_USER, D.SNAME AS RISKTYPE， F.SNAME AS riskprobability， E.SNAME AS riskdegree， G.SNAME AS risklevel， SRISKDESCRIPTION AS riskoverview, SMEASURES AS riskmeasure， SPROPOSAL AS risksuggest， ( CASE SISREPORT WHEN '-1' THEN '未上报' WHEN '1' THEN '已上报' ELSE '未上报' END ) AS risk_sb, ( CASE WHEN SREPORTUSER IS NULL THEN '无' ELSE (select STRUENAME from SYS_USER where SUSER=SREPORTUSER) END ) SREPORTUSER, ( CASE WHEN SREPORTTIME IS NULL THEN '无' ELSE SREPORTTIME END ) SREPORTTIME, ( CASE SISINSTRUCTIONS WHEN '-1' THEN '未批示' WHEN '1' THEN '已批示' ELSE '未批示' END ) AS risk_ps, ( CASE WHEN SINSTRUCTIONSUSER IS NULL THEN '无' ELSE (select STRUENAME from SYS_USER where SUSER=SINSTRUCTIONSUSER) END ) SINSTRUCTIONSUSER, ( CASE WHEN SINSTRUCTIONTIME IS NULL THEN '无' ELSE SINSTRUCTIONTIME END ) SINSTRUCTIONTIME, ( CASE WHEN SINSTRUCTSCONTENT IS NULL THEN '无' ELSE SINSTRUCTSCONTENT END ) SINSTRUCTSCONTENT, ( CASE sisfeedback WHEN '-1' THEN '未反馈' WHEN '1' THEN '已反馈' ELSE '未反馈' END ) AS risk_fq, ( CASE WHEN SFEEDBACKSUSER IS NULL THEN '无' ELSE (select STRUENAME from SYS_USER where SUSER=SFEEDBACKSUSER) END ) SFEEDBACKSUSER, ( CASE WHEN SFEEDBACKTIME IS NULL THEN '无' ELSE SFEEDBACKTIME END ) SFEEDBACKTIME, ( CASE WHEN SFEEDBACKSCONTENT IS NULL THEN '无' ELSE SFEEDBACKSCONTENT END ) SFEEDBACKSCONTENT, '1-查看' AS operation FROM risklist a LEFT JOIN riskstate b ON a.nid = b.nrelateid LEFT JOIN dw_dimcompany c ON a.dim_company=c.scode LEFT JOIN ( SELECT scode, sname FROM risk_type) D ON D.scode=A.SRISKTYPE LEFT JOIN RISK_INFLUENCE_DEGREE E ON E.NID=A.NINFLUENCE LEFT JOIN RISK_PROBABILITY F ON F.NID=A.NPROBABILITY LEFT JOIN RISK_MATRIX G ON A.NGRADE=G.NID LEFT JOIN ( WITH T1 AS ( SELECT NRELATEID, DIM_COMPANY, SISREPORT, SREPORTUSER, SISINSTRUCTIONS, SINSTRUCTIONSUSER, SISFEEDBACK, SFEEDBACKSUSER FROM RISK_REPORTSTATE WHERE NRELATEID IN ( SELECT nid FROM risk_distinguish WHERE dim_company=:company AND SUBSTR(screatetime,1,6) <= :period AND DIM_DEPARTMENT = :departId and SISSUBMIT='Y' ) ) ， t2 AS ( SELECT NRELATEID, ( CASE WHEN SISREPORT='1' THEN '已上报' ELSE '未上报' END ) AS a, ( CASE WHEN SISINSTRUCTIONS='1' THEN '已批示' ELSE '未批示' END) AS b, ( CASE WHEN SISFEEDBACK='1' THEN '已反馈' ELSE '未反馈' END) AS c, '1-查看' AS operation FROM T1 WHERE NRELATEID IS NOT NULL ) , t3 AS ( SELECT t1.NRELATEID, a AS ISREPORT, b AS ISINSTRUCTIONS, c AS ISFEEDBACK, ( CASE WHEN a='未上报' AND b='未批示' AND c='未反馈' THEN '未上报' WHEN a='已上报' AND b='未批示' AND c='未反馈' THEN '未批示' WHEN a='已上报' AND b='已批示' AND c='未反馈' THEN '未反馈' WHEN a='已上报' AND b='已批示' AND c='已反馈' THEN '已反馈' ELSE '' END) AS risk_status, SREPORTUSER, SINSTRUCTIONSUSER, SFEEDBACKSUSER, operation FROM t1 LEFT JOIN t2 ON t1.NRELATEID=t2.NRELATEID ) SELECT NRELATEID AS nid, :company AS scode, a.SRISKNAME AS sname, risk_status, ( CASE WHEN risk_status='未上报' THEN '' ELSE t3.SREPORTUSER END) AS sb_user, ( CASE WHEN risk_status='未上报' THEN '' WHEN risk_status='未批示' THEN '' ELSE t3.SINSTRUCTIONSUSER END) AS ps_user, ( CASE WHEN risk_status='未上报' THEN '' WHEN risk_status='未批示' THEN '' WHEN risk_status='未反馈' THEN '' ELSE t3.SFEEDBACKSUSER END) AS fk_user, '1-查看' AS OPERATION FROM t3 LEFT JOIN ( SELECT nid, SRISKNAME FROM RISK_DISTINGUISH WHERE nid IN ( SELECT nid FROM t3) ) a ON t3.NRELATEID=a.nid ) aa ON a.nid=aa.nid"
    },
    {
      "id": "003",
      "text": "风险反馈树表数据查询",
      "sql": "SELECT a.scode AS scode, a.sname AS companyname, a.spcode AS spcode, sstate as status, operation, a.nleaf, a.nlevel FROM ( SELECT scode, sname, spcode, connect_by_isleaf AS nleaf, level AS nlevel FROM dw_dimcompany START WITH scode = :company CONNECT BY prior scode = spcode) a LEFT JOIN ( SELECT DIM_COMPANY, CASE WHEN bj>'0' THEN '未反馈' ELSE '已反馈' END AS sstate, case WHEN bj='0' THEN '1-查看,2-退回' ELSE '0-反馈,3-提醒' end as operation FROM ( SELECT DIM_COMPANY, sum((case when SISFEEDBACK='-1' then '1' else '0' end)) as bj FROM RISK_REPORTSTATE WHERE NRELATEID IN ( SELECT nid FROM risk_distinguish WHERE dim_company = :company AND SUBSTR(screatetime,1,6) <= :period ) AND SISFEEDBACK in ('-1','1' ) group by DIM_COMPANY ) ) c ON a.scode = c.dim_company"
    },
    {
      "id": "004",
      "text": "风险反馈报告具体信息查询",
      "sql": "WITH t1 AS ( SELECT DIM_COMPANY, NRELATEID, SFEEDBACKSUSER, SFEEDBACKSCONTENT, CSTRATEGY FROM RISK_REPORTSTATE WHERE dim_company = :company AND DIM_PERIOD<=:period ) , t2 AS ( SELECT nid, NGRADE, SFILLUSER, SRISKNAME, SRISKTYPE, SRISKDESCRIPTION, SMEASURES, SPROPOSAL, NPROBABILITY, NINFLUENCE FROM risk_distinguish WHERE dim_company = :company AND DIM_PERIOD<=:period ) , t3 AS ( SELECT t2. nid, DIM_COMPANY, SRISKNAME, SFILLUSER, SFEEDBACKSUSER, SFEEDBACKSCONTENT, NGRADE, t3.sname AS NGRADE_s, SRISKTYPE, t4.sname AS SRISKTYPE_s, t4.spcode, CSTRATEGY, t5.sname, t5.sdesc, SRISKDESCRIPTION, SMEASURES, SPROPOSAL, NPROBABILITY, NINFLUENCE, t7.SDESCRIPTION|| '----'||t6.SDESCRIPTION AS fxpg FROM t1 INNER JOIN t2 ON t1.NRELATEID=t2.nid LEFT JOIN RISK_MATRIX t3 ON t2.NGRADE=t3.nid LEFT JOIN RISK_TYPE t4 ON t2.SRISKTYPE=t4.scode LEFT JOIN RISK_STRATEGY t5 ON t1.CSTRATEGY=t5.nid LEFT JOIN RISK_PROBABILITY t6 ON t2.NPROBABILITY=t6.nid LEFT JOIN RISK_INFLUENCE_DEGREE t7 ON t2.NINFLUENCE=t7.nid ) SELECT t3.NID, t3.DIM_COMPANY, t11.sname AS companyname, SFILLUSER risksbuser, SFEEDBACKSCONTENT risk_feed_content , SRISKNAME as RISKNAME, NGRADE_S AS risklevel, NUM_GRADE AS riskcount, RISK_TYPE.sname AS risksptype, t3.spcode AS typespcode, SRISKTYPE_S risktype , NUM_STYPE AS risktypecount, t3.SNAME risk_ps_cl , SDESC risk_ps_content , SRISKDESCRIPTION AS risk_gs, SMEASURES AS risk_cs, SPROPOSAL AS risk_jy, FXPG AS risk_pg FROM t3 LEFT JOIN ( SELECT DIM_COMPANY, NGRADE , SUM('1') AS num_grade FROM t3 GROUP BY DIM_COMPANY, NGRADE) t8 ON t3.DIM_COMPANY=t8.DIM_COMPANY AND t3.NGRADE=t8.NGRADE LEFT JOIN ( SELECT DIM_COMPANY, spcode , SUM('1') AS num_stype FROM t3 GROUP BY DIM_COMPANY, spcode) t9 ON t3.DIM_COMPANY=t9.DIM_COMPANY AND t3.spcode=t9.spcode LEFT JOIN RISK_TYPE ON t3.spcode=RISK_TYPE.scode LEFT JOIN dw_dimcompany t11 ON t3.DIM_COMPANY=t11.scode"
    },
    {
      "id": "005",
      "text": "风险追踪树表数据查询",
      "sql": "WITH T1 AS ( SELECT NID, a.scode AS scode, a.sname AS sname, a.spcode AS spcode, a.nleaf, a.nlevel, SISREPORT, SISINSTRUCTIONS, SISFEEDBACK, SREPORTUSER, SINSTRUCTIONSUSER, SFEEDBACKSUSER FROM ( SELECT scode, sname, spcode, connect_by_isleaf AS nleaf, level AS nlevel FROM dw_dimcompany START WITH scode = :company CONNECT BY prior scode = spcode) a LEFT JOIN ( SELECT NID, DIM_COMPANY, SISREPORT, SREPORTUSER, SISINSTRUCTIONS, SINSTRUCTIONSUSER, SISFEEDBACK, SFEEDBACKSUSER FROM RISK_REPORTSTATE WHERE NRELATEID IN ( SELECT nid FROM risk_distinguish WHERE dim_company IN ( SELECT scode FROM dw_dimcompany START WITH scode = :company CONNECT BY prior scode = spcode ) AND SUBSTR(screatetime,1,6) <= :period ) ) c ON a.scode = c.dim_company ) ， t2 AS ( SELECT SCODE, ( CASE WHEN SUM(DECODE(SISREPORT，'-1'，1，0)) > '0' THEN '未上报' ELSE '已上报' END ) AS a, ( CASE WHEN SUM(DECODE(SISINSTRUCTIONS，'-1'，1，0)) > '0' THEN '未批示' ELSE '已批示' END) AS b, ( CASE WHEN SUM(DECODE(SISFEEDBACK，'-1'，1，0))> '0' THEN '未反馈' ELSE '已反馈' END) AS c, '1-查看' AS operation FROM T1 WHERE NID IS NOT NULL GROUP BY SCODE ) , t3 AS ( SELECT t1.scode AS scode, t1.sname AS sname, t1.spcode AS spcode, t1.nleaf, t1.nlevel, a AS ISREPORT, b AS ISINSTRUCTIONS, c AS ISFEEDBACK, SREPORTUSER, SINSTRUCTIONSUSER, SFEEDBACKSUSER, operation FROM t1 LEFT JOIN t2 ON t1.scode=t2.scode WHERE nid IN ( SELECT nid FROM ( SELECT MAX(nid) nid, scode FROM t1 WHERE nid IS NOT NULL GROUP BY scode)) ) SELECT tt.scode as scode, tt.sname as companyname, tt.spcode, tt.nleaf, tt.nlevel, t3.ISREPORT as sb_status, t3.SREPORTUSER as sb_user, t3.ISINSTRUCTIONS as ps_status, t3.SINSTRUCTIONSUSER as ps_user, t3.ISFEEDBACK as fk_status, t3.SFEEDBACKSUSER as fk_user, '1-查看' AS operation FROM ( ( SELECT scode, sname, spcode, connect_by_isleaf AS nleaf, level AS nlevel FROM dw_dimcompany where cisdel = 'N' START WITH scode = :company CONNECT BY prior scode = spcode ) tt ) LEFT JOIN t3 ON tt.scode=t3.scode ORDER BY tt.scode"
    },
    {
      "id": "006",
      "text": "风险追踪跳转页面数据查询",
      "sql": "WITH t1 AS ( SELECT DIM_COMPANY, NRELATEID, SFEEDBACKSCONTENT, CSTRATEGY， SISREPORT， SREPORTUSER， SREPORTTIME， SISINSTRUCTIONS, SINSTRUCTIONSUSER, SINSTRUCTIONTIME, SINSTRUCTSCONTENT, SISFEEDBACK, SFEEDBACKSUSER, SFEEDBACKTIME FROM RISK_REPORTSTATE WHERE dim_company IN ( :company) ) , t2 AS ( SELECT nid, NGRADE, SFILLUSER, SRISKNAME, SRISKTYPE, SRISKDESCRIPTION, SMEASURES, SPROPOSAL, NPROBABILITY, NINFLUENCE FROM risk_distinguish WHERE dim_company = :company AND DIM_PERIOD=:period ) , t3 AS ( SELECT t2. nid, DIM_COMPANY, t2.SFILLUSER, t2.SRISKNAME, SFEEDBACKSCONTENT, NGRADE, t3.sname AS NGRADE_s, SRISKTYPE, t4.sname AS SRISKTYPE_s, t4.spcode, CSTRATEGY, t5.sname, t5.sdesc, SRISKDESCRIPTION, SMEASURES, SPROPOSAL, NPROBABILITY, NINFLUENCE, t7.SDESCRIPTION|| '----'||t6.SDESCRIPTION AS fxpg, SISREPORT， SREPORTUSER， SREPORTTIME， SISINSTRUCTIONS, SINSTRUCTIONSUSER, SINSTRUCTIONTIME, SISFEEDBACK, SFEEDBACKSUSER, SFEEDBACKTIME, SINSTRUCTSCONTENT FROM t1 INNER JOIN t2 ON t1.NRELATEID=t2.nid LEFT JOIN RISK_MATRIX t3 ON t2.NGRADE=t3.nid LEFT JOIN RISK_TYPE t4 ON t2.SRISKTYPE=t4.scode LEFT JOIN RISK_STRATEGY t5 ON t1.CSTRATEGY=t5.nid LEFT JOIN RISK_PROBABILITY t6 ON t2.NPROBABILITY=t6.nid LEFT JOIN RISK_INFLUENCE_DEGREE t7 ON t2.NINFLUENCE=t7.nid ) SELECT t3.NID, t11.sname AS riskcompany, SRISKNAME AS riskname, SFILLUSER AS risksbuser, NGRADE_S AS risklevel, NUM_GRADE AS riskcount, RISK_TYPE.sname AS risksptype, RISK_TYPE.scode AS typespcode, SRISKTYPE_S risktype , NUM_STYPE AS risktypecount, SRISKDESCRIPTION AS risk_gs, SMEASURES AS risk_cs, SPROPOSAL AS risk_jy, FXPG AS risk_pg, ( CASE WHEN SISREPORT='1' THEN '已上报' ELSE '未上报' END) AS risk_sb_state, ( SELECT STRUENAME FROM sys_user WHERE SUSER=SREPORTUSER) AS risk_sb_user_name， SREPORTTIME AS risk_sb_time， ( CASE WHEN SISINSTRUCTIONS='1' THEN '已批示' ELSE '未批示' END) AS risk_ps_state, ( SELECT STRUENAME FROM sys_user WHERE SUSER=SINSTRUCTIONSUSER) AS risk_ps_user_name， SINSTRUCTIONTIME AS risk_ps_time， SINSTRUCTSCONTENT AS risk_ps_content, ( CASE WHEN SISFEEDBACK='1' THEN '已反馈' ELSE '未反馈' END) risk_fk_state， ( SELECT STRUENAME FROM sys_user WHERE SUSER=SFEEDBACKSUSER) AS risk_fk_user_name, SFEEDBACKTIME AS risk_fk_time, SFEEDBACKSCONTENT AS risk_fk_content FROM t3 LEFT JOIN ( SELECT DIM_COMPANY, NGRADE , SUM('1') AS num_grade FROM t3 GROUP BY DIM_COMPANY, NGRADE) t8 ON t3.DIM_COMPANY=t8.DIM_COMPANY AND t3.NGRADE=t8.NGRADE LEFT JOIN ( SELECT DIM_COMPANY, spcode , SUM('1') AS num_stype FROM t3 GROUP BY DIM_COMPANY, spcode) t9 ON t3.DIM_COMPANY=t9.DIM_COMPANY AND t3.spcode=t9.spcode LEFT JOIN RISK_TYPE ON t3.spcode=RISK_TYPE.scode LEFT JOIN dw_dimcompany t11 ON t3.DIM_COMPANY=t11.scode"
    }
  ]
}