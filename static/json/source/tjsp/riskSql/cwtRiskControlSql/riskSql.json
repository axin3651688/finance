{
  "code": 200,
  "sqlList": [
    {
      "id": "001",
      "text": "风险反馈普通表数据",
      "sql": "WITH riskstate AS ( SELECT SISFEEDBACK, SREPORTUSER, SINSTRUCTIONSUSER, NRELATEID， SINSTRUCTSCONTENT, SFEEDBACKSCONTENT, CSTRATEGY FROM RISK_REPORTSTATE WHERE DIM_COMPANY=:company AND DIM_PERIOD<=:period ) , risklist AS ( SELECT nid, DIM_COMPANY, DIM_PERIOD, DIM_DEPARTMENT , SRISKNAME， NPROBABILITY, NINFLUENCE, NGRADE, SRISKDESCRIPTION, SMEASURES, SPROPOSAL, SRISKTYPE FROM RISK_DISTINGUISH WHERE nid IN ( SELECT NRELATEID FROM riskstate) AND dim_department = :departId ) , datalist AS ( SELECT nid, dim_company, dim_period, dim_department, sriskname, CSTRATEGY, SREPORTUSER, SINSTRUCTIONSUSER, sisfeedback， SINSTRUCTSCONTENT, NPROBABILITY, NINFLUENCE, NGRADE, SRISKDESCRIPTION, SMEASURES, SPROPOSAL, risk_type.sname AS SRISKTYPE , SFEEDBACKSCONTENT FROM risklist LEFT JOIN riskstate ON risklist.nid = riskstate.nrelateid LEFT JOIN ( SELECT scode, sname FROM risk_type) risk_type ON risk_type.scode=risklist.SRISKTYPE ) , split AS ( SELECT KEY, rn, SUBSTR(str, instr(str, ',', 1, rn)+1, instr(str, ',', 1, rn+1) - instr(str, ',', 1, rn) - 1) str FROM ( SELECT CSTRATEGY KEY, ','||CSTRATEGY||',' str FROM datalist) a, ( SELECT rownum rn FROM dual CONNECT BY rownum < 10) b WHERE instr(str, ',', 1, rn+1) > 0 ) SELECT a.nid AS scode, rownum, sriskname AS riskname, ( SELECT STRUENAME FROM sys_user WHERE suser=SREPORTUSER) AS risksbuser, e.STOUSER, f.tosname, SRISKTYPE AS risktype, b.sname AS riskprobability, d.sname AS riskdegree, c.sname AS risklevel, c.COLORMARK as riskcolor, countermeasures, SRISKDESCRIPTION AS riskoverview, SMEASURES AS riskmeasure, SPROPOSAL AS risksuggest, SINSTRUCTSCONTENT AS instruction， SFEEDBACKSCONTENT AS riskfeed, ( CASE sisfeedback WHEN '1' THEN '已反馈' ELSE '未反馈' END ) AS backState, ( CASE sisfeedback WHEN '1' THEN '1-查看,2-退回' ELSE '0-反馈,3-提醒' END ) AS operation FROM datalist a LEFT JOIN RISK_PROBABILITY b ON a.NPROBABILITY=b.nid LEFT JOIN RISK_MATRIX c ON a.NGRADE=c.nid LEFT JOIN RISK_INFLUENCE_DEGREE d ON a.NINFLUENCE=d.nid LEFT JOIN ( SELECT aa.NRELATEID, SFROMUSER, STOUSER FROM ( SELECT MAX(nid) nid, NRELATEID FROM RISK_MSG WHERE SOPRATETYPE='PS' AND SOPRATESTATE='1' GROUP BY NRELATEID ) aa LEFT JOIN RISK_MSG bb ON aa.nid=bb.nid AND aa.NRELATEID = bb.NRELATEID ) e ON e.SFROMUSER=a.SINSTRUCTIONSUSER AND a.nid=e.NRELATEID LEFT JOIN ( WITH split_data AS ( SELECT KEY, rn, SUBSTR(str, instr(str, ',', 1, rn)+1, instr(str, ',', 1, rn+1) - instr(str, ',' , 1, rn) - 1) str FROM ( SELECT STOUSER KEY, ','||STOUSER||',' str FROM RISK_MSG WHERE SOPRATETYPE='PS' AND SOPRATESTATE='1') a, ( SELECT rownum rn FROM dual CONNECT BY rownum < 10) b WHERE instr(str, ',', 1, rn+1) > 0 ) SELECT KEY, SUBSTR(MAX(sys_connect_by_path（STRUENAME, ','))， 2) tosname FROM split_data a, sys_user b WHERE a.str = b.suser START WITH rn = 1 CONNECT BY KEY = prior KEY AND rn-1 = prior rn GROUP BY KEY ) f ON e.STOUSER=f.key LEFT JOIN ( SELECT KEY CSTRATEGY, SUBSTR(MAX(sys_connect_by_path（sname, ','))， 2) countermeasures FROM split a, RISK_STRATEGY b WHERE a.str = b.nid START WITH rn = 1 CONNECT BY KEY = prior KEY AND rn-1 = prior rn GROUP BY KEY) g ON a.CSTRATEGY=g.CSTRATEGY "
    },
    {
      "id": "001_1",
      "text": "风险反馈普通表数据当前期间",
      "sql": "WITH riskstate AS ( SELECT SISFEEDBACK, SREPORTUSER, SINSTRUCTIONSUSER, NRELATEID， SINSTRUCTSCONTENT, SFEEDBACKSCONTENT, CSTRATEGY FROM RISK_REPORTSTATE WHERE DIM_COMPANY=:company AND DIM_PERIOD=:period ) , risklist AS ( SELECT nid, DIM_COMPANY, DIM_PERIOD, DIM_DEPARTMENT , SRISKNAME， NPROBABILITY, NINFLUENCE, NGRADE, SRISKDESCRIPTION, SMEASURES, SPROPOSAL, SRISKTYPE FROM RISK_DISTINGUISH WHERE nid IN ( SELECT NRELATEID FROM riskstate) AND dim_department = :departId AND DIM_PERIOD=:period AND SISSUBMIT='Y' ) , datalist AS ( SELECT nid, dim_company, dim_period, dim_department, sriskname, CSTRATEGY, SREPORTUSER, SINSTRUCTIONSUSER, sisfeedback， SINSTRUCTSCONTENT, NPROBABILITY, NINFLUENCE, NGRADE, SRISKDESCRIPTION, SMEASURES, SPROPOSAL, risk_type.sname AS SRISKTYPE , SFEEDBACKSCONTENT FROM risklist LEFT JOIN riskstate ON risklist.nid = riskstate.nrelateid LEFT JOIN ( SELECT scode, sname FROM risk_type) risk_type ON risk_type.scode=risklist.SRISKTYPE ) , split AS ( SELECT KEY, rn, SUBSTR(str, instr(str, ',', 1, rn)+1, instr(str, ',', 1, rn+1) - instr(str, ',', 1, rn) - 1) str FROM ( SELECT CSTRATEGY KEY, ','||CSTRATEGY||',' str FROM datalist) a, ( SELECT rownum rn FROM dual CONNECT BY rownum < 10) b WHERE instr(str, ',', 1, rn+1) > 0 ) SELECT a.nid AS scode, rownum, sriskname AS riskname, ( SELECT STRUENAME FROM sys_user WHERE suser=SREPORTUSER) AS risksbuser, e.STOUSER, f.tosname, SRISKTYPE AS risktype, b.sname AS riskprobability, d.sname AS riskdegree, c.sname AS risklevel, c.COLORMARK as riskcolor, countermeasures, SRISKDESCRIPTION AS riskoverview, SMEASURES AS riskmeasure, SPROPOSAL AS risksuggest, SINSTRUCTSCONTENT AS instruction， SFEEDBACKSCONTENT AS riskfeed, ( CASE sisfeedback WHEN '1' THEN '已反馈' ELSE '未反馈' END ) AS backState, ( CASE sisfeedback WHEN '1' THEN '1-查看,2-退回' ELSE '0-反馈,3-提醒' END ) AS operation FROM datalist a LEFT JOIN RISK_PROBABILITY b ON a.NPROBABILITY=b.nid LEFT JOIN RISK_MATRIX c ON a.NGRADE=c.nid LEFT JOIN RISK_INFLUENCE_DEGREE d ON a.NINFLUENCE=d.nid LEFT JOIN ( SELECT aa.NRELATEID, SFROMUSER, STOUSER FROM ( SELECT MAX(nid) nid, NRELATEID FROM RISK_MSG WHERE SOPRATETYPE='PS' AND SOPRATESTATE='1' GROUP BY NRELATEID ) aa LEFT JOIN RISK_MSG bb ON aa.nid=bb.nid AND aa.NRELATEID = bb.NRELATEID ) e ON e.SFROMUSER=a.SINSTRUCTIONSUSER AND a.nid=e.NRELATEID LEFT JOIN ( WITH split_data AS ( SELECT KEY, rn, SUBSTR(str, instr(str, ',', 1, rn)+1, instr(str, ',', 1, rn+1) - instr(str, ',' , 1, rn) - 1) str FROM ( SELECT STOUSER KEY, ','||STOUSER||',' str FROM RISK_MSG WHERE SOPRATETYPE='PS' AND SOPRATESTATE='1') a, ( SELECT rownum rn FROM dual CONNECT BY rownum < 10) b WHERE instr(str, ',', 1, rn+1) > 0 ) SELECT KEY, SUBSTR(MAX(sys_connect_by_path（STRUENAME, ','))， 2) tosname FROM split_data a, sys_user b WHERE a.str = b.suser START WITH rn = 1 CONNECT BY KEY = prior KEY AND rn-1 = prior rn GROUP BY KEY ) f ON e.STOUSER=f.key LEFT JOIN ( SELECT KEY CSTRATEGY, SUBSTR(MAX(sys_connect_by_path（sname, ','))， 2) countermeasures FROM split a, RISK_STRATEGY b WHERE a.str = b.nid START WITH rn = 1 CONNECT BY KEY = prior KEY AND rn-1 = prior rn GROUP BY KEY) g ON a.CSTRATEGY=g.CSTRATEGY"
    },
    {
      "id": "002",
      "text": "风险追踪普通标数据",
      "sql": "WITH riskstate AS ( SELECT SISREPORT, SREPORTUSER, SREPORTTIME, SISINSTRUCTIONS, SINSTRUCTIONSUSER, SINSTRUCTIONTIME, SINSTRUCTSCONTENT， SISFEEDBACK, SFEEDBACKSUSER, SFEEDBACKTIME, SFEEDBACKSCONTENT， NRELATEID FROM RISK_REPORTSTATE WHERE DIM_COMPANY=:company AND DIM_PERIOD<=:period ) , risklist AS ( SELECT nid, DIM_COMPANY, DIM_PERIOD, DIM_DEPARTMENT, SRISKNAME， SMEASURES， SPROPOSAL， SRISKTYPE， NPROBABILITY， NINFLUENCE， NGRADE， SRISKDESCRIPTION FROM RISK_DISTINGUISH WHERE DIM_COMPANY=:company AND DIM_PERIOD<=:period AND dim_department = :departId and SISSUBMIT='Y' ) SELECT A.nid AS scode, rownum, sriskname AS riskname, aa.RISK_STATUS, (select STRUENAME from SYS_USER where SUSER=aa.SB_USER) as SB_USER, (select STRUENAME from SYS_USER where SUSER=aa.PS_USER) as PS_USER, (select STRUENAME from SYS_USER where SUSER=aa.FK_USER) as FK_USER, D.SNAME AS RISKTYPE， F.SNAME AS riskprobability， E.SNAME AS riskdegree， G.SNAME AS risklevel，g.COLORMARK as riskcolor, SRISKDESCRIPTION AS riskoverview, SMEASURES AS riskmeasure， SPROPOSAL AS risksuggest， ( CASE SISREPORT WHEN '-1' THEN '未上报' WHEN '1' THEN '已上报' ELSE '未上报' END ) AS risk_sb, ( CASE WHEN SREPORTUSER IS NULL THEN '无' ELSE (select STRUENAME from SYS_USER where SUSER=SREPORTUSER) END ) SREPORTUSER, ( CASE WHEN SREPORTTIME IS NULL THEN '无' ELSE SREPORTTIME END ) SREPORTTIME, ( CASE SISINSTRUCTIONS WHEN '-1' THEN '未批示' WHEN '1' THEN '已批示' ELSE '未批示' END ) AS risk_ps, ( CASE WHEN SINSTRUCTIONSUSER IS NULL THEN '无' ELSE (select STRUENAME from SYS_USER where SUSER=SINSTRUCTIONSUSER) END ) SINSTRUCTIONSUSER, ( CASE WHEN SINSTRUCTIONTIME IS NULL THEN '无' ELSE SINSTRUCTIONTIME END ) SINSTRUCTIONTIME, ( CASE WHEN SINSTRUCTSCONTENT IS NULL THEN '无' ELSE SINSTRUCTSCONTENT END ) SINSTRUCTSCONTENT, ( CASE sisfeedback WHEN '-1' THEN '未反馈' WHEN '1' THEN '已反馈' ELSE '未反馈' END ) AS risk_fq, ( CASE WHEN SFEEDBACKSUSER IS NULL THEN '无' ELSE (select STRUENAME from SYS_USER where SUSER=SFEEDBACKSUSER) END ) SFEEDBACKSUSER, ( CASE WHEN SFEEDBACKTIME IS NULL THEN '无' ELSE SFEEDBACKTIME END ) SFEEDBACKTIME, ( CASE WHEN SFEEDBACKSCONTENT IS NULL THEN '无' ELSE SFEEDBACKSCONTENT END ) SFEEDBACKSCONTENT, '1-查看' AS operation FROM risklist a LEFT JOIN riskstate b ON a.nid = b.nrelateid LEFT JOIN dw_dimcompany c ON a.dim_company=c.scode LEFT JOIN ( SELECT scode, sname FROM risk_type) D ON D.scode=A.SRISKTYPE LEFT JOIN RISK_INFLUENCE_DEGREE E ON E.NID=A.NINFLUENCE LEFT JOIN RISK_PROBABILITY F ON F.NID=A.NPROBABILITY LEFT JOIN RISK_MATRIX G ON A.NGRADE=G.NID LEFT JOIN ( WITH T1 AS ( SELECT NRELATEID, DIM_COMPANY, SISREPORT, SREPORTUSER, SISINSTRUCTIONS, SINSTRUCTIONSUSER, SISFEEDBACK, SFEEDBACKSUSER FROM RISK_REPORTSTATE WHERE NRELATEID IN ( SELECT nid FROM risk_distinguish WHERE dim_company=:company AND SUBSTR(dim_period,1,6) <= :period AND DIM_DEPARTMENT = :departId and SISSUBMIT='Y' ) ) ， t2 AS ( SELECT NRELATEID, ( CASE WHEN SISREPORT='1' THEN '已上报' ELSE '未上报' END ) AS a, ( CASE WHEN SISINSTRUCTIONS='1' THEN '已批示' ELSE '未批示' END) AS b, ( CASE WHEN SISFEEDBACK='1' THEN '已反馈' ELSE '未反馈' END) AS c, '1-查看' AS operation FROM T1 WHERE NRELATEID IS NOT NULL ) , t3 AS ( SELECT t1.NRELATEID, a AS ISREPORT, b AS ISINSTRUCTIONS, c AS ISFEEDBACK, ( CASE WHEN a='未上报' AND b='未批示' AND c='未反馈' THEN '未上报' WHEN a='已上报' AND b='未批示' AND c='未反馈' THEN '未批示' WHEN a='已上报' AND b='已批示' AND c='未反馈' THEN '未反馈' WHEN a='已上报' AND b='已批示' AND c='已反馈' THEN '已反馈' ELSE '' END) AS risk_status, SREPORTUSER, SINSTRUCTIONSUSER, SFEEDBACKSUSER, operation FROM t1 LEFT JOIN t2 ON t1.NRELATEID=t2.NRELATEID ) SELECT NRELATEID AS nid, :company AS scode, a.SRISKNAME AS sname, risk_status, ( CASE WHEN risk_status='未上报' THEN '' ELSE t3.SREPORTUSER END) AS sb_user, ( CASE WHEN risk_status='未上报' THEN '' WHEN risk_status='未批示' THEN '' ELSE t3.SINSTRUCTIONSUSER END) AS ps_user, ( CASE WHEN risk_status='未上报' THEN '' WHEN risk_status='未批示' THEN '' WHEN risk_status='未反馈' THEN '' ELSE t3.SFEEDBACKSUSER END) AS fk_user, '1-查看' AS OPERATION FROM t3 LEFT JOIN ( SELECT nid, SRISKNAME FROM RISK_DISTINGUISH WHERE nid IN ( SELECT nid FROM t3) ) a ON t3.NRELATEID=a.nid ) aa ON a.nid=aa.nid"
    },
    {
      "id": "002_1",
      "text": "风险追踪普通标数据",
      "sql": "WITH riskstate AS ( SELECT SISREPORT, SREPORTUSER, SREPORTTIME, SISINSTRUCTIONS, SINSTRUCTIONSUSER, SINSTRUCTIONTIME, SINSTRUCTSCONTENT， SISFEEDBACK, SFEEDBACKSUSER, SFEEDBACKTIME, SFEEDBACKSCONTENT， NRELATEID FROM RISK_REPORTSTATE WHERE DIM_COMPANY=:company AND DIM_PERIOD=:period ) , risklist AS ( SELECT nid, DIM_COMPANY, DIM_PERIOD, DIM_DEPARTMENT, SRISKNAME， SMEASURES， SPROPOSAL， SRISKTYPE， NPROBABILITY， NINFLUENCE， NGRADE， SRISKDESCRIPTION FROM RISK_DISTINGUISH WHERE DIM_COMPANY=:company AND DIM_PERIOD=:period AND dim_department = :departId and SISSUBMIT='Y' ) SELECT A.nid AS scode, rownum, sriskname AS riskname, aa.RISK_STATUS, (select STRUENAME from SYS_USER where SUSER=aa.SB_USER) as SB_USER, (select STRUENAME from SYS_USER where SUSER=aa.PS_USER) as PS_USER, (select STRUENAME from SYS_USER where SUSER=aa.FK_USER) as FK_USER, D.SNAME AS RISKTYPE， F.SNAME AS riskprobability， E.SNAME AS riskdegree， G.SNAME AS risklevel，g.COLORMARK as riskcolor, SRISKDESCRIPTION AS riskoverview, SMEASURES AS riskmeasure， SPROPOSAL AS risksuggest， ( CASE SISREPORT WHEN '-1' THEN '未上报' WHEN '1' THEN '已上报' ELSE '未上报' END ) AS risk_sb, ( CASE WHEN SREPORTUSER IS NULL THEN '无' ELSE (select STRUENAME from SYS_USER where SUSER=SREPORTUSER) END ) SREPORTUSER, ( CASE WHEN SREPORTTIME IS NULL THEN '无' ELSE SREPORTTIME END ) SREPORTTIME, ( CASE SISINSTRUCTIONS WHEN '-1' THEN '未批示' WHEN '1' THEN '已批示' ELSE '未批示' END ) AS risk_ps, ( CASE WHEN SINSTRUCTIONSUSER IS NULL THEN '无' ELSE (select STRUENAME from SYS_USER where SUSER=SINSTRUCTIONSUSER) END ) SINSTRUCTIONSUSER, ( CASE WHEN SINSTRUCTIONTIME IS NULL THEN '无' ELSE SINSTRUCTIONTIME END ) SINSTRUCTIONTIME, ( CASE WHEN SINSTRUCTSCONTENT IS NULL THEN '无' ELSE SINSTRUCTSCONTENT END ) SINSTRUCTSCONTENT, ( CASE sisfeedback WHEN '-1' THEN '未反馈' WHEN '1' THEN '已反馈' ELSE '未反馈' END ) AS risk_fq, ( CASE WHEN SFEEDBACKSUSER IS NULL THEN '无' ELSE (select STRUENAME from SYS_USER where SUSER=SFEEDBACKSUSER) END ) SFEEDBACKSUSER, ( CASE WHEN SFEEDBACKTIME IS NULL THEN '无' ELSE SFEEDBACKTIME END ) SFEEDBACKTIME, ( CASE WHEN SFEEDBACKSCONTENT IS NULL THEN '无' ELSE SFEEDBACKSCONTENT END ) SFEEDBACKSCONTENT, '1-查看' AS operation FROM risklist a LEFT JOIN riskstate b ON a.nid = b.nrelateid LEFT JOIN dw_dimcompany c ON a.dim_company=c.scode LEFT JOIN ( SELECT scode, sname FROM risk_type) D ON D.scode=A.SRISKTYPE LEFT JOIN RISK_INFLUENCE_DEGREE E ON E.NID=A.NINFLUENCE LEFT JOIN RISK_PROBABILITY F ON F.NID=A.NPROBABILITY LEFT JOIN RISK_MATRIX G ON A.NGRADE=G.NID LEFT JOIN ( WITH T1 AS ( SELECT NRELATEID, DIM_COMPANY, SISREPORT, SREPORTUSER, SISINSTRUCTIONS, SINSTRUCTIONSUSER, SISFEEDBACK, SFEEDBACKSUSER FROM RISK_REPORTSTATE WHERE NRELATEID IN ( SELECT nid FROM risk_distinguish WHERE dim_company=:company AND SUBSTR(dim_period,1,6) = :period AND DIM_DEPARTMENT = :departId and SISSUBMIT='Y' ) ) ， t2 AS ( SELECT NRELATEID, ( CASE WHEN SISREPORT='1' THEN '已上报' ELSE '未上报' END ) AS a, ( CASE WHEN SISINSTRUCTIONS='1' THEN '已批示' ELSE '未批示' END) AS b, ( CASE WHEN SISFEEDBACK='1' THEN '已反馈' ELSE '未反馈' END) AS c, '1-查看' AS operation FROM T1 WHERE NRELATEID IS NOT NULL ) , t3 AS ( SELECT t1.NRELATEID, a AS ISREPORT, b AS ISINSTRUCTIONS, c AS ISFEEDBACK, ( CASE WHEN a='未上报' AND b='未批示' AND c='未反馈' THEN '未上报' WHEN a='已上报' AND b='未批示' AND c='未反馈' THEN '未批示' WHEN a='已上报' AND b='已批示' AND c='未反馈' THEN '未反馈' WHEN a='已上报' AND b='已批示' AND c='已反馈' THEN '已反馈' ELSE '' END) AS risk_status, SREPORTUSER, SINSTRUCTIONSUSER, SFEEDBACKSUSER, operation FROM t1 LEFT JOIN t2 ON t1.NRELATEID=t2.NRELATEID ) SELECT NRELATEID AS nid, :company AS scode, a.SRISKNAME AS sname, risk_status, ( CASE WHEN risk_status='未上报' THEN '' ELSE t3.SREPORTUSER END) AS sb_user, ( CASE WHEN risk_status='未上报' THEN '' WHEN risk_status='未批示' THEN '' ELSE t3.SINSTRUCTIONSUSER END) AS ps_user, ( CASE WHEN risk_status='未上报' THEN '' WHEN risk_status='未批示' THEN '' WHEN risk_status='未反馈' THEN '' ELSE t3.SFEEDBACKSUSER END) AS fk_user, '1-查看' AS OPERATION FROM t3 LEFT JOIN ( SELECT nid, SRISKNAME FROM RISK_DISTINGUISH WHERE nid IN ( SELECT nid FROM t3) ) a ON t3.NRELATEID=a.nid ) aa ON a.nid=aa.nid"
    },
    {
      "id": "003",
      "text": "风险反馈树表数据查询",
      "sql": "SELECT a.scode AS scode, '('||a.scode||')'||a.sname AS companyname, a.spcode AS spcode, d.SFROMUSER, d.STOUSER, sstate AS status, operation, a.nleaf, a.nlevel FROM ( SELECT scode, sname, spcode, connect_by_isleaf AS nleaf, level AS nlevel FROM dw_dimcompany START WITH scode = :company CONNECT BY prior scode = spcode AND cisdel='N') a LEFT JOIN ( SELECT DIM_COMPANY, SINSTRUCTIONSUSER, (case when SISINSTRUCTIONS='1' then CASE WHEN bj>'0' THEN '未反馈' ELSE '已反馈' END else '' end) AS sstate, (case when SISINSTRUCTIONS='1' then CASE WHEN bj='0' THEN '1-查看,2-退回' ELSE '0-反馈,3-提醒' END else '' end ) AS operation FROM ( SELECT DIM_COMPANY, SUM(( CASE WHEN SISFEEDBACK IN ('-1', '0', '2') THEN '1' ELSE '0' END)) AS bj， SINSTRUCTIONSUSER, SISINSTRUCTIONS FROM RISK_REPORTSTATE WHERE NRELATEID IN ( SELECT nid FROM risk_distinguish WHERE dim_company IN ( SELECT scode FROM dw_dimcompany START WITH scode = :company CONNECT BY prior scode = spcode AND cisdel='N') AND SUBSTR(dim_period,1,6) = :period ) GROUP BY DIM_COMPANY，SINSTRUCTIONSUSER,SISINSTRUCTIONS ) ) c ON a.scode = c.dim_company LEFT JOIN ( SELECT SFROMUSER, STOUSER FROM RISK_MSG WHERE nid IN ( SELECT MAX(nid) AS nid FROM RISK_MSG WHERE SOPRATETYPE='PS' AND SOPRATESTATE='1' AND NRELATEID IN ( SELECT nid FROM risk_distinguish WHERE dim_company IN ( SELECT scode FROM dw_dimcompany START WITH scode = :company CONNECT BY prior scode = spcode AND cisdel='N') AND dim_period <= :period) GROUP BY SFROMUSER )) d ON c.SINSTRUCTIONSUSER = d.SFROMUSER ORDER BY a.scode "
    },
    {
      "id": "003_1",
      "text": "风险反馈树表数据查询当前期间",
      "sql": "SELECT a.scode AS scode, '('||a.scode||')'||a.sname AS companyname, a.spcode AS spcode, d.SFROMUSER, d.STOUSER, sstate AS status, operation, a.nleaf, a.nlevel FROM ( SELECT scode, sname, spcode, connect_by_isleaf AS nleaf, level AS nlevel FROM dw_dimcompany START WITH scode = :company CONNECT BY prior scode = spcode AND cisdel='N') a LEFT JOIN ( SELECT DIM_COMPANY, SINSTRUCTIONSUSER, (case when SISINSTRUCTIONS='1' then CASE WHEN bj>'0' THEN '未反馈' ELSE '已反馈' END else '' end) AS sstate, (case when SISINSTRUCTIONS='1' then CASE WHEN bj='0' THEN '1-查看,2-退回' ELSE '0-反馈,3-提醒' END else '' end ) AS operation FROM ( SELECT DIM_COMPANY, SUM(( CASE WHEN SISFEEDBACK IN ('-1', '0', '2') THEN '1' ELSE '0' END)) AS bj， SINSTRUCTIONSUSER, SISINSTRUCTIONS FROM RISK_REPORTSTATE WHERE NRELATEID IN ( SELECT nid FROM risk_distinguish WHERE dim_company IN ( SELECT scode FROM dw_dimcompany START WITH scode = :company CONNECT BY prior scode = spcode AND cisdel='N') AND SUBSTR(dim_period,1,6) = :period ) GROUP BY DIM_COMPANY，SINSTRUCTIONSUSER,SISINSTRUCTIONS ) ) c ON a.scode = c.dim_company LEFT JOIN ( SELECT SFROMUSER, STOUSER FROM RISK_MSG WHERE nid IN ( SELECT MAX(nid) AS nid FROM RISK_MSG WHERE SOPRATETYPE='PS' AND SOPRATESTATE='1' AND NRELATEID IN ( SELECT nid FROM risk_distinguish WHERE dim_company IN ( SELECT scode FROM dw_dimcompany START WITH scode = :company CONNECT BY prior scode = spcode AND cisdel='N') AND dim_period = :period) GROUP BY SFROMUSER )) d ON c.SINSTRUCTIONSUSER = d.SFROMUSER ORDER BY a.scode "
    },
    {
      "id": "004",
      "text": "风险反馈报告具体信息查询",
      "sql": "WITH t1 AS ( SELECT DIM_COMPANY, NRELATEID, SFEEDBACKSUSER, SISFEEDBACK, SFEEDBACKSCONTENT, CSTRATEGY, SINSTRUCTSCONTENT FROM RISK_REPORTSTATE WHERE dim_company = :company AND DIM_PERIOD<=:period ) , t2 AS ( SELECT nid, NGRADE, SFILLUSER, SRISKNAME, SRISKTYPE, SRISKDESCRIPTION, SMEASURES, SPROPOSAL, NPROBABILITY, NINFLUENCE FROM risk_distinguish WHERE dim_company = :company AND DIM_PERIOD=:period ) , t3 AS ( SELECT t2. nid, DIM_COMPANY, SRISKNAME, SFILLUSER, SISFEEDBACK, SFEEDBACKSUSER, SFEEDBACKSCONTENT, SINSTRUCTSCONTENT, NGRADE, t3.sname AS NGRADE_s, t3.COLORMARK AS riskcolor, SRISKTYPE, t4.sname AS SRISKTYPE_s, t4.spcode, CSTRATEGY, SRISKDESCRIPTION, SMEASURES, SPROPOSAL, NPROBABILITY, NINFLUENCE, t7.sname|| ','||t6.sname AS fxpg FROM t1 INNER JOIN t2 ON t1.NRELATEID=t2.nid LEFT JOIN RISK_MATRIX t3 ON t2.NGRADE=t3.nid LEFT JOIN RISK_TYPE t4 ON t2.SRISKTYPE=t4.scode LEFT JOIN RISK_PROBABILITY t6 ON t2.NPROBABILITY=t6.nid LEFT JOIN RISK_INFLUENCE_DEGREE t7 ON t2.NINFLUENCE=t7.nid ) , t4 AS ( SELECT KEY, rn, SUBSTR(str, instr(str, ',', 1, rn)+1, instr(str, ',', 1, rn+1) - instr(str, ',', 1, rn) - 1) str FROM ( SELECT CSTRATEGY KEY, ','||CSTRATEGY||',' str FROM t3) a, ( SELECT rownum rn FROM dual CONNECT BY rownum < 10) b WHERE instr(str, ',', 1, rn+1) > 0 ) SELECT t3.NID, t3.DIM_COMPANY, t11.sname AS companyname, SFILLUSER risksbuser, ( CASE WHEN SISFEEDBACK='1' THEN SFEEDBACKSCONTENT ELSE '' END ) risk_feed_content , SRISKNAME AS RISKNAME, NGRADE_S AS risklevel, riskcolor, NUM_GRADE AS riskcount, RISK_TYPE.sname AS risksptype, t3.spcode AS typespcode, SRISKTYPE_S risktype , NUM_STYPE AS risktypecount, risk_ps_cl , t3.SINSTRUCTSCONTENT risk_ps_content , SRISKDESCRIPTION AS risk_gs, SMEASURES AS risk_cs, SPROPOSAL AS risk_jy, FXPG AS risk_pg FROM t3 LEFT JOIN ( SELECT DIM_COMPANY, NGRADE , SUM('1') AS num_grade FROM t3 GROUP BY DIM_COMPANY, NGRADE) t8 ON t3.DIM_COMPANY=t8.DIM_COMPANY AND t3.NGRADE=t8.NGRADE LEFT JOIN ( SELECT DIM_COMPANY, spcode , SUM('1') AS num_stype FROM t3 GROUP BY DIM_COMPANY, spcode) t9 ON t3.DIM_COMPANY=t9.DIM_COMPANY AND t3.spcode=t9.spcode LEFT JOIN RISK_TYPE ON t3.spcode=RISK_TYPE.scode LEFT JOIN dw_dimcompany t11 ON t3.DIM_COMPANY=t11.scode LEFT JOIN ( SELECT KEY CSTRATEGY, SUBSTR(MAX(sys_connect_by_path（sname, ','))， 2) risk_ps_cl, SUBSTR(MAX(sys_connect_by_path（SDESC, '|'))， 2) risk_ps_content FROM t4 a, RISK_STRATEGY b WHERE a.str = b.nid START WITH rn = 1 CONNECT BY KEY = prior KEY AND rn-1 = prior rn GROUP BY KEY) t12 ON t3.CSTRATEGY=t12.CSTRATEGY"
    },
    {
      "id": "004_1",
      "text": "风险反馈报告具体信息查询当前期间",
      "sql": "WITH t1 AS ( SELECT DIM_COMPANY, NRELATEID, SFEEDBACKSUSER, SISFEEDBACK, SFEEDBACKSCONTENT, CSTRATEGY, SINSTRUCTSCONTENT FROM RISK_REPORTSTATE WHERE dim_company = :company AND DIM_PERIOD=:period ) , t2 AS ( SELECT nid, NGRADE, SFILLUSER, SRISKNAME, SRISKTYPE, SRISKDESCRIPTION, SMEASURES, SPROPOSAL, NPROBABILITY, NINFLUENCE FROM risk_distinguish WHERE dim_company = :company AND DIM_PERIOD=:period ) , t3 AS ( SELECT t2. nid, DIM_COMPANY, SRISKNAME, SFILLUSER, SISFEEDBACK, SFEEDBACKSUSER, SFEEDBACKSCONTENT, SINSTRUCTSCONTENT, NGRADE, t3.sname AS NGRADE_s, t3.COLORMARK AS riskcolor, SRISKTYPE, t4.sname AS SRISKTYPE_s, t4.spcode, CSTRATEGY, SRISKDESCRIPTION, SMEASURES, SPROPOSAL, NPROBABILITY, NINFLUENCE, t7.sname|| ','||t6.sname AS fxpg FROM t1 INNER JOIN t2 ON t1.NRELATEID=t2.nid LEFT JOIN RISK_MATRIX t3 ON t2.NGRADE=t3.nid LEFT JOIN RISK_TYPE t4 ON t2.SRISKTYPE=t4.scode LEFT JOIN RISK_PROBABILITY t6 ON t2.NPROBABILITY=t6.nid LEFT JOIN RISK_INFLUENCE_DEGREE t7 ON t2.NINFLUENCE=t7.nid ) , t4 AS ( SELECT KEY, rn, SUBSTR(str, instr(str, ',', 1, rn)+1, instr(str, ',', 1, rn+1) - instr(str, ',', 1, rn) - 1) str FROM ( SELECT CSTRATEGY KEY, ','||CSTRATEGY||',' str FROM t3) a, ( SELECT rownum rn FROM dual CONNECT BY rownum < 10) b WHERE instr(str, ',', 1, rn+1) > 0 ) SELECT t3.NID, t3.DIM_COMPANY, t11.sname AS companyname, SFILLUSER risksbuser, ( CASE WHEN SISFEEDBACK='1' THEN SFEEDBACKSCONTENT ELSE '' END ) risk_feed_content , SRISKNAME AS RISKNAME, NGRADE_S AS risklevel, riskcolor, NUM_GRADE AS riskcount, RISK_TYPE.sname AS risksptype, t3.spcode AS typespcode, SRISKTYPE_S risktype , NUM_STYPE AS risktypecount, risk_ps_cl , t3.SINSTRUCTSCONTENT risk_ps_content , SRISKDESCRIPTION AS risk_gs, SMEASURES AS risk_cs, SPROPOSAL AS risk_jy, FXPG AS risk_pg FROM t3 LEFT JOIN ( SELECT DIM_COMPANY, NGRADE , SUM('1') AS num_grade FROM t3 GROUP BY DIM_COMPANY, NGRADE) t8 ON t3.DIM_COMPANY=t8.DIM_COMPANY AND t3.NGRADE=t8.NGRADE LEFT JOIN ( SELECT DIM_COMPANY, spcode , SUM('1') AS num_stype FROM t3 GROUP BY DIM_COMPANY, spcode) t9 ON t3.DIM_COMPANY=t9.DIM_COMPANY AND t3.spcode=t9.spcode LEFT JOIN RISK_TYPE ON t3.spcode=RISK_TYPE.scode LEFT JOIN dw_dimcompany t11 ON t3.DIM_COMPANY=t11.scode LEFT JOIN ( SELECT KEY CSTRATEGY, SUBSTR(MAX(sys_connect_by_path（sname, ','))， 2) risk_ps_cl, SUBSTR(MAX(sys_connect_by_path（SDESC, '|'))， 2) risk_ps_content FROM t4 a, RISK_STRATEGY b WHERE a.str = b.nid START WITH rn = 1 CONNECT BY KEY = prior KEY AND rn-1 = prior rn GROUP BY KEY) t12 ON t3.CSTRATEGY=t12.CSTRATEGY"
    },
    {
      "id": "005",
      "text": "风险追踪树表数据查询",
      "sql": "WITH tt AS ( SELECT nid, dim_company FROM risk_distinguish WHERE dim_period <= :period AND SISSUBMIT = 'Y' AND dim_company IN ( SELECT scode FROM dw_dimcompany WHERE cisdel = 'N' START WITH scode = :company CONNECT BY prior scode = spcode AND cisdel = 'N') ) SELECT t1.scode, '('||t1.scode||')'||t1.sname AS companyname, t1.spcode, t1.nleaf, t1.nlevel, t2.maxNid, t2.countNid, ( CASE WHEN t2.countNid IS NULL THEN '' ELSE ( CASE WHEN SUM(DECODE(t3.SISREPORT，'1'，1，0)) < NVL(t2.countNid,0) THEN '未上报' ELSE '已上报' END) END ) AS sb_status, ( CASE WHEN t2.countNid IS NULL THEN '' ELSE ( CASE WHEN SUM(DECODE(t3.SISREPORT，'1'，1，0)) < NVL(t2.countNid,0) THEN '' ELSE ( SELECT '('||suser||')'||STRUENAME FROM sys_user WHERE suser= ( SELECT SREPORTUSER FROM risk_reportstate WHERE nrelateid = t2.maxNid)) END) END ) AS sb_user, ( CASE WHEN t2.countNid IS NULL THEN '' ELSE ( CASE WHEN SUM(DECODE(t3.SISINSTRUCTIONS，'1'，1，0)) < NVL(t2.countNid,0) THEN '未批示' ELSE '已批示' END) END ) AS ps_status, ( CASE WHEN t2.countNid IS NULL THEN '' ELSE ( CASE WHEN SUM(DECODE(t3.SISINSTRUCTIONS，'1'，1，0)) < NVL(t2.countNid,0) THEN '' ELSE ( SELECT '('||suser||')'||STRUENAME FROM sys_user WHERE suser= ( SELECT SINSTRUCTIONSUSER FROM risk_reportstate WHERE nrelateid = t2.maxNid)) END) END ) AS ps_user, ( CASE WHEN t2.countNid IS NULL THEN '' ELSE ( CASE WHEN SUM(DECODE(t3.SISFEEDBACK，'1'，1，0)) < NVL(t2.countNid,0) THEN '未反馈' ELSE '已反馈' END) END ) AS fk_status, ( CASE WHEN t2.countNid IS NULL THEN '' ELSE ( CASE WHEN SUM(DECODE(t3.SISFEEDBACK，'1'，1，0)) < NVL(t2.countNid,0) THEN '' ELSE ( SELECT '('||suser||')'||STRUENAME FROM sys_user WHERE suser= ( SELECT SFEEDBACKSUSER FROM risk_reportstate WHERE nrelateid = t2.maxNid)) END) END ) AS fk_user, ( CASE WHEN MAXNID IS NULL THEN NULL ELSE '1-查看' END ) AS operation FROM ( SELECT scode, sname, spcode, connect_by_isleaf AS nleaf, level AS nlevel FROM ( SELECT * FROM dw_dimcompany WHERE cisdel = 'N') START WITH scode = :company CONNECT BY prior scode = spcode) t1 LEFT JOIN ( SELECT a.nid, a.dim_company, b.maxNid, b.countNid FROM tt a LEFT JOIN ( SELECT dim_company, MAX(nid) AS maxNid, COUNT(nid)AS countNid FROM tt GROUP BY dim_company) b ON a.dim_company = b.dim_company ) t2 ON t1.scode = t2.dim_company LEFT JOIN RISK_REPORTSTATE t3 ON t2.nid = t3.nrelateid GROUP BY t1.scode, t1. sname, t1.spcode, t1.nleaf, t1.nlevel, t2.maxNid, t2.countNid ORDER BY t1.scode"
    },
    {
      "id": "005_1",
      "text": "风险追踪树表数据查询当前期间",
      "sql": "WITH tt AS ( SELECT nid, dim_company FROM risk_distinguish WHERE dim_period = :period AND SISSUBMIT = 'Y' AND dim_company IN ( SELECT scode FROM dw_dimcompany WHERE cisdel = 'N' START WITH scode = :company CONNECT BY prior scode = spcode AND cisdel = 'N') ) SELECT t1.scode, '('||t1.scode||')'||t1.sname AS companyname, t1.spcode, t1.nleaf, t1.nlevel, t2.maxNid, t2.countNid, ( CASE WHEN t2.countNid IS NULL THEN '' ELSE ( CASE WHEN SUM(DECODE(t3.SISREPORT，'1'，1，0)) < NVL(t2.countNid,0) THEN '未上报' ELSE '已上报' END) END ) AS sb_status, ( CASE WHEN t2.countNid IS NULL THEN '' ELSE ( CASE WHEN SUM(DECODE(t3.SISREPORT，'1'，1，0)) < NVL(t2.countNid,0) THEN '' ELSE ( SELECT '('||suser||')'||STRUENAME FROM sys_user WHERE suser= ( SELECT SREPORTUSER FROM risk_reportstate WHERE nrelateid = t2.maxNid)) END) END ) AS sb_user, ( CASE WHEN t2.countNid IS NULL THEN '' ELSE ( CASE WHEN SUM(DECODE(t3.SISINSTRUCTIONS，'1'，1，0)) < NVL(t2.countNid,0) THEN '未批示' ELSE '已批示' END) END ) AS ps_status, ( CASE WHEN t2.countNid IS NULL THEN '' ELSE ( CASE WHEN SUM(DECODE(t3.SISINSTRUCTIONS，'1'，1，0)) < NVL(t2.countNid,0) THEN '' ELSE ( SELECT '('||suser||')'||STRUENAME FROM sys_user WHERE suser= ( SELECT SINSTRUCTIONSUSER FROM risk_reportstate WHERE nrelateid = t2.maxNid)) END) END ) AS ps_user, ( CASE WHEN t2.countNid IS NULL THEN '' ELSE ( CASE WHEN SUM(DECODE(t3.SISFEEDBACK，'1'，1，0)) < NVL(t2.countNid,0) THEN '未反馈' ELSE '已反馈' END) END ) AS fk_status, ( CASE WHEN t2.countNid IS NULL THEN '' ELSE ( CASE WHEN SUM(DECODE(t3.SISFEEDBACK，'1'，1，0)) < NVL(t2.countNid,0) THEN '' ELSE ( SELECT '('||suser||')'||STRUENAME FROM sys_user WHERE suser= ( SELECT SFEEDBACKSUSER FROM risk_reportstate WHERE nrelateid = t2.maxNid)) END) END ) AS fk_user, ( CASE WHEN MAXNID IS NULL THEN NULL ELSE '1-查看' END ) AS operation FROM ( SELECT scode, sname, spcode, connect_by_isleaf AS nleaf, level AS nlevel FROM ( SELECT * FROM dw_dimcompany WHERE cisdel = 'N') START WITH scode = :company CONNECT BY prior scode = spcode) t1 LEFT JOIN ( SELECT a.nid, a.dim_company, b.maxNid, b.countNid FROM tt a LEFT JOIN ( SELECT dim_company, MAX(nid) AS maxNid, COUNT(nid)AS countNid FROM tt GROUP BY dim_company) b ON a.dim_company = b.dim_company ) t2 ON t1.scode = t2.dim_company LEFT JOIN RISK_REPORTSTATE t3 ON t2.nid = t3.nrelateid GROUP BY t1.scode, t1. sname, t1.spcode, t1.nleaf, t1.nlevel, t2.maxNid, t2.countNid ORDER BY t1.scode"
    },
    {
      "id": "006",
      "text": "风险追踪跳转页面数据查询",
      "sql": "WITH t1 AS ( SELECT DIM_COMPANY, NRELATEID, SFEEDBACKSCONTENT, CSTRATEGY， SISREPORT， SREPORTUSER， SREPORTTIME， SISINSTRUCTIONS, SINSTRUCTIONSUSER, SINSTRUCTIONTIME, SINSTRUCTSCONTENT, SISFEEDBACK, SFEEDBACKSUSER, SFEEDBACKTIME FROM RISK_REPORTSTATE WHERE dim_company IN ( :company) ) , t2 AS ( SELECT nid, NGRADE, SFILLUSER, SRISKNAME, SRISKTYPE, SRISKDESCRIPTION, SMEASURES, SPROPOSAL, NPROBABILITY, NINFLUENCE FROM risk_distinguish WHERE dim_company = :company AND DIM_PERIOD<=:period ) , t3 AS ( SELECT t2. nid, DIM_COMPANY, t2.SFILLUSER, t2.SRISKNAME, SFEEDBACKSCONTENT, NGRADE, t3.sname AS NGRADE_s, t3.COLORMARK as riskcolor, SRISKTYPE, t4.sname AS SRISKTYPE_s, t4.spcode, CSTRATEGY, SRISKDESCRIPTION, SMEASURES, SPROPOSAL, NPROBABILITY, NINFLUENCE, t7.sname|| ','||t6.sname AS fxpg, SISREPORT， SREPORTUSER， SREPORTTIME， SISINSTRUCTIONS, SINSTRUCTIONSUSER, SINSTRUCTIONTIME, SISFEEDBACK, SFEEDBACKSUSER, SFEEDBACKTIME, SINSTRUCTSCONTENT FROM t1 right JOIN t2 ON t1.NRELATEID=t2.nid LEFT JOIN RISK_MATRIX t3 ON t2.NGRADE=t3.nid LEFT JOIN RISK_TYPE t4 ON t2.SRISKTYPE=t4.scode LEFT JOIN RISK_PROBABILITY t6 ON t2.NPROBABILITY=t6.nid LEFT JOIN RISK_INFLUENCE_DEGREE t7 ON t2.NINFLUENCE=t7.nid ) SELECT t3.NID, t11.sname AS riskcompany, SRISKNAME AS riskname, SFILLUSER AS risksbuser, NGRADE_S AS risklevel, riskcolor, NUM_GRADE AS riskcount, RISK_TYPE.sname AS risksptype, RISK_TYPE.scode AS typespcode, SRISKTYPE_S risktype , NUM_STYPE AS risktypecount, SRISKDESCRIPTION AS risk_gs, SMEASURES AS risk_cs, SPROPOSAL AS risk_jy, FXPG AS risk_pg, ( CASE WHEN SISREPORT='1' THEN '已上报' ELSE '未上报' END) AS risk_sb_state, ( SELECT STRUENAME FROM sys_user WHERE SUSER=SREPORTUSER) AS risk_sb_user_name， SREPORTTIME AS risk_sb_time， ( CASE WHEN SISINSTRUCTIONS='1' THEN '已批示' ELSE '未批示' END) AS risk_ps_state, ( SELECT STRUENAME FROM sys_user WHERE SUSER=SINSTRUCTIONSUSER) AS risk_ps_user_name， SINSTRUCTIONTIME AS risk_ps_time， SINSTRUCTSCONTENT AS risk_ps_content, ( CASE WHEN SISFEEDBACK='1' THEN '已反馈' ELSE '未反馈' END) risk_fk_state， ( SELECT STRUENAME FROM sys_user WHERE SUSER=SFEEDBACKSUSER) AS risk_fk_user_name, SFEEDBACKTIME AS risk_fk_time, SFEEDBACKSCONTENT AS risk_fk_content FROM t3 LEFT JOIN ( SELECT DIM_COMPANY, NGRADE , SUM('1') AS num_grade FROM t3 GROUP BY DIM_COMPANY, NGRADE) t8 ON t3.DIM_COMPANY=t8.DIM_COMPANY AND t3.NGRADE=t8.NGRADE LEFT JOIN ( SELECT DIM_COMPANY, spcode , SUM('1') AS num_stype FROM t3 GROUP BY DIM_COMPANY, spcode) t9 ON t3.DIM_COMPANY=t9.DIM_COMPANY AND t3.spcode=t9.spcode LEFT JOIN RISK_TYPE ON t3.spcode=RISK_TYPE.scode LEFT JOIN dw_dimcompany t11 ON t3.DIM_COMPANY=t11.scode"
    },
    {
      "id": "006_1",
      "text": "风险追踪跳转页面数据查询当前期间",
      "sql": "WITH t1 AS ( SELECT DIM_COMPANY, NRELATEID, SFEEDBACKSCONTENT, CSTRATEGY， SISREPORT， SREPORTUSER， SREPORTTIME， SISINSTRUCTIONS, SINSTRUCTIONSUSER, SINSTRUCTIONTIME, SINSTRUCTSCONTENT, SISFEEDBACK, SFEEDBACKSUSER, SFEEDBACKTIME FROM RISK_REPORTSTATE WHERE dim_company IN ( :company) ) , t2 AS ( SELECT nid, NGRADE, SFILLUSER, SRISKNAME, SRISKTYPE, SRISKDESCRIPTION, SMEASURES, SPROPOSAL, NPROBABILITY, NINFLUENCE FROM risk_distinguish WHERE dim_company = :company AND DIM_PERIOD=:period ) , t3 AS ( SELECT t2. nid, DIM_COMPANY, t2.SFILLUSER, t2.SRISKNAME, SFEEDBACKSCONTENT, NGRADE, t3.sname AS NGRADE_s, t3.COLORMARK as riskcolor, SRISKTYPE, t4.sname AS SRISKTYPE_s, t4.spcode, CSTRATEGY, SRISKDESCRIPTION, SMEASURES, SPROPOSAL, NPROBABILITY, NINFLUENCE, t7.sname|| ','||t6.sname AS fxpg, SISREPORT， SREPORTUSER， SREPORTTIME， SISINSTRUCTIONS, SINSTRUCTIONSUSER, SINSTRUCTIONTIME, SISFEEDBACK, SFEEDBACKSUSER, SFEEDBACKTIME, SINSTRUCTSCONTENT FROM t1 right JOIN t2 ON t1.NRELATEID=t2.nid LEFT JOIN RISK_MATRIX t3 ON t2.NGRADE=t3.nid LEFT JOIN RISK_TYPE t4 ON t2.SRISKTYPE=t4.scode LEFT JOIN RISK_PROBABILITY t6 ON t2.NPROBABILITY=t6.nid LEFT JOIN RISK_INFLUENCE_DEGREE t7 ON t2.NINFLUENCE=t7.nid ) SELECT t3.NID, t11.sname AS riskcompany, SRISKNAME AS riskname, SFILLUSER AS risksbuser, NGRADE_S AS risklevel, riskcolor, NUM_GRADE AS riskcount, RISK_TYPE.sname AS risksptype, RISK_TYPE.scode AS typespcode, SRISKTYPE_S risktype , NUM_STYPE AS risktypecount, SRISKDESCRIPTION AS risk_gs, SMEASURES AS risk_cs, SPROPOSAL AS risk_jy, FXPG AS risk_pg, ( CASE WHEN SISREPORT='1' THEN '已上报' ELSE '未上报' END) AS risk_sb_state, ( SELECT STRUENAME FROM sys_user WHERE SUSER=SREPORTUSER) AS risk_sb_user_name， SREPORTTIME AS risk_sb_time， ( CASE WHEN SISINSTRUCTIONS='1' THEN '已批示' ELSE '未批示' END) AS risk_ps_state, ( SELECT STRUENAME FROM sys_user WHERE SUSER=SINSTRUCTIONSUSER) AS risk_ps_user_name， SINSTRUCTIONTIME AS risk_ps_time， SINSTRUCTSCONTENT AS risk_ps_content, ( CASE WHEN SISFEEDBACK='1' THEN '已反馈' ELSE '未反馈' END) risk_fk_state， ( SELECT STRUENAME FROM sys_user WHERE SUSER=SFEEDBACKSUSER) AS risk_fk_user_name, SFEEDBACKTIME AS risk_fk_time, SFEEDBACKSCONTENT AS risk_fk_content FROM t3 LEFT JOIN ( SELECT DIM_COMPANY, NGRADE , SUM('1') AS num_grade FROM t3 GROUP BY DIM_COMPANY, NGRADE) t8 ON t3.DIM_COMPANY=t8.DIM_COMPANY AND t3.NGRADE=t8.NGRADE LEFT JOIN ( SELECT DIM_COMPANY, spcode , SUM('1') AS num_stype FROM t3 GROUP BY DIM_COMPANY, spcode) t9 ON t3.DIM_COMPANY=t9.DIM_COMPANY AND t3.spcode=t9.spcode LEFT JOIN RISK_TYPE ON t3.spcode=RISK_TYPE.scode LEFT JOIN dw_dimcompany t11 ON t3.DIM_COMPANY=t11.scode "
    }
  ]
}