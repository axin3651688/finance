{
    "code": 200,
    "sqlList": [{
            "id": "101",
            "text": "风险控制批示",
            "sql": "with t as(select a.nid as id, sriskname fxmc, c.sname fxlx, b.sname fxdj, a.ngrade as nlevel, sriskdescription fxms, sorigin fxly, case when d.sisinstructions='1' then '批示' when d.sisinstructions='-1' then '未批示' when d.sisinstructions='0' then '提醒' when d.sisinstructions='2' then '退回' else d.sisreport end pszt, d.sisinstructions as psztid, screatetime cjsj， smeasures cqcs, sproposal ydjy, nprobability fxgl,d.cstrategy as fxydcl from risk_distinguish a left join risk_influence_degree b on a.ngrade=b.nscore left join risk_type c on a.srisktype=c.scode left join risk_reportstate d on a.nid=d.nrelateid where a.dim_company=:company and a.dim_period=:period and a.dim_department=:departId and d.sisinstructions in('-1','1') order by d.sisinstructions) , t2 as (select a.id, wm_concat(b.sname) as FXYDCLNAME, wm_concat(b.SDESC) as FXYDCLSDESC from (SELECT id, SUBSTR(FXYDCL, INSTR(FXYDCL, ',', 1, LEVEL) + 1, INSTR(FXYDCL, ',', 1, LEVEL + 1) - INSTR(FXYDCL, ',', 1, LEVEL) - 1) FXYDCL,LEVEL FROM (select id ,','||FXYDCL||',' as FXYDCL, LENGTH(FXYDCL) - LENGTH(REPLACE(FXYDCL, ','))+2 CN from t) TT CONNECT BY PRIOR id = id AND LEVEL < CN AND PRIOR DBMS_RANDOM.VALUE IS NOT NULL) a left join RISK_STRATEGY b on a.FXYDCL = b.scode group by a.id) select a.*,b. FXYDCLNAME, b.FXYDCLSDESC from t a left join t2 b on a.id = b.id "
        },
        {
            "id": "102",
            "text": "风险管控弹出框的指定下达人员的sql",
            "sql": "SELECT SCODE, SNAME, SPCODE,b.nid as usernid,b.suser as suser, b.STRUENAME,b.suser||'('||b.STRUENAME||')' username FROM DW_DIMDEPARTMENT a right join(select nid,STRUENAME,suser, SDEPARTMENTID from SYS_USER where COMPANY='1001') b on a.scode=b.SDEPARTMENTID where SCOMCODE='1001' order by scode"
        },
        {
            "id": "103",
            "text": "风险管控汇总批示树表数据",
            "sql": "select a.scode as scode , a.sname as sname,a.spcode as spcode, sstate, c.reportuser,c.reportime, c.SISINSTRUCTIONS, a.nleaf, a.nlevel from(select scode, sname, spcode, connect_by_isleaf as nleaf, level as nlevel from dw_dimcompany start with scode = '1001' connect by prior scode = spcode) a left join (select DIM_COMPANY, case when ncount > 0 then '已批示' else '未批示' end as sstate, case when ncount > 0 then 'Y' else 'N' end as SISINSTRUCTIONS, 'fuq' as reportuser, '201805' as reportime from (select DIM_COMPANY, count (*) as ncount from RISK_REPORTSTATE where NRELATEID in (select nid from risk_distinguish where dim_company = '1001' and substr(screatetime,1,6) <= '201905') and SISINSTRUCTIONS = '1' group by DIM_COMPANY)) c on a.scode = c.dim_company"
        },
        {
            "id": "104",
            "text": "汇总批示查看按钮的sql",
            "sql": "WITH riskstate AS( SELECT NRELATEID， SISINSTRUCTIONS, SREPORTUSER, SREPORTTIME, SINSTRUCTSCONTENT, CSTRATEGY FROM RISK_REPORTSTATE WHERE DIM_COMPANY='1001' AND DIM_PERIOD='201904') , risklist AS ( SELECT nid, DIM_COMPANY, DIM_PERIOD, SRISKNAME， SRISKTYPE, SRISKDESCRIPTION, SMEASURES, SPROPOSAL, NPROBABILITY, NINFLUENCE FROM RISK_DISTINGUISH WHERE nid IN ( SELECT NRELATEID FROM riskstate) ) , datalist AS ( SELECT risklist.nid, risklist.dim_company, risklist.dim_period, risklist.sriskname, risk_type.sname as SRISKTYPE, risk_type.scode as sriskscode, riskstate.SISINSTRUCTIONS, riskstate.SREPORTUSER, riskstate.SREPORTTIME, risklist.SRISKDESCRIPTION, risklist.SMEASURES, risklist.SPROPOSAL, riskstate.SINSTRUCTSCONTENT, RISK_INFLUENCE_DEGREE.SDESCRIPTION as NINFLUENCE, RISK_PROBABILITY.SDESCRIPTION as NPROBABILITY, riskstate.CSTRATEGY FROM risklist LEFT JOIN riskstate ON risklist.nid = riskstate.nrelateid left join (select scode,sname,spcode from risk_type) risk_type on risk_type.scode=risklist.SRISKTYPE left join RISK_INFLUENCE_DEGREE on risklist.NINFLUENCE=RISK_INFLUENCE_DEGREE.nid left join RISK_PROBABILITY on risklist.NPROBABILITY=RISK_PROBABILITY.nid ) SELECT dd.scode as scode, dd.spcode as spcode, dd.sname, dim_period, (CASE WHEN SISINSTRUCTIONS='1' THeN '批示' WHEN SISINSTRUCTIONS='-1' THeN '未批示' WHEN SISINSTRUCTIONS='0' THeN '提醒' WHEN SISINSTRUCTIONS='2' THeN '退回' else '' end ) as ISINSTRUCTIONS, SREPORTUSER as REPORTUSER , SREPORTTIME as REPORTTIME , sriskname, SRISKTYPE as RISKTYPE, sriskscode as riskscode, SRISKDESCRIPTION as DESCRIPTION, SMEASURES as CQCS , SPROPOSAL AS YDJY, SINSTRUCTSCONTENT as PSNR, NPROBABILITY, NINFLUENCE , CSTRATEGY FROM datalist left join (select scode, sname, spcode,connect_by_isleaf as cisleaf, level as nlevel from DW_DIMCOMPANY start with scode = '1001' connect by prior scode = spcode) dd on datalist.dim_company=dd.scode order by dd.scode"
        }
    ]
}