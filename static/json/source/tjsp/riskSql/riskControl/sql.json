{
    "code": 200,
    "sqlList": [{
            "id": "101",
            "text": "风险控制批示",
            "sql": "with t as(select a.nid as id, sriskname fxmc, c.sname fxlx, b.sname fxdj, b.colormark as fxlxcolor, a.ngrade as nlevel, sriskdescription fxms, sorigin fxly,case when d.sisinstructions='1' then '已批示' else '未批示' end pszt, d.sisinstructions as psztid, screatetime cjsj， smeasures cqcs, sproposal ydjy, nprobability fxgl,e.sname fxglmc,d.cstrategy as fxydcl, d.SINSTRUCTIONSUSER from risk_distinguish a left join risk_matrix b on a.ngrade=b.nid left join risk_type c on a.srisktype=c.scode left join risk_reportstate d on a.nid=d.nrelateid left join risk_probability e on e.nid = a.nprobability where a.dim_company=:company and a.dim_period=:period and a.dim_department=:departId and(d.sisinstructions in('-1','1')) order by d.sisinstructions) , t2 as (select a.id, wm_concat(b.sname) as FXYDCLNAME, wm_concat(b.SDESC) as FXYDCLSDESC from (SELECT id, SUBSTR(FXYDCL, INSTR(FXYDCL, ',', 1, LEVEL) + 1, INSTR(FXYDCL, ',', 1, LEVEL + 1) - INSTR(FXYDCL, ',', 1, LEVEL) - 1) FXYDCL,LEVEL FROM (select id ,','||FXYDCL||',' as FXYDCL, LENGTH(FXYDCL) - LENGTH(REPLACE(FXYDCL, ','))+2 CN from t) TT CONNECT BY PRIOR id = id AND LEVEL < CN AND PRIOR DBMS_RANDOM.VALUE IS NOT NULL) a left join RISK_STRATEGY b on a.FXYDCL = b.scode group by a.id) select a.*,b. FXYDCLNAME, b.FXYDCLSDESC from t a left join t2 b on a.id = b.id order by nlevel"
        },
        {
            "id": "102",
            "text": "风险管控弹出框的指定下达人员的sql",
            "sql": "SELECT SCODE, SNAME, SPCODE,b.nid as usernid,b.suser as suser, b.STRUENAME,b.suser||'('||b.STRUENAME||')' username FROM DW_DIMDEPARTMENT a right join(select nid,STRUENAME,suser, SDEPARTMENTID from SYS_USER where COMPANY='1001') b on a.scode=b.SDEPARTMENTID where SCOMCODE='1001' order by scode"
        },
        {
            "id": "103",
            "text": "风险管控汇总批示树表数据",
            "sql": "SELECT a.scode AS scode, a.sname AS sname, a.spcode AS spcode, sstate, c.reportuser, c.reportime, c.SINSTRUCTIONSUSER, c.SISINSTRUCTIONS, a.nleaf, a.nlevel FROM( SELECT scode, sname, spcode, connect_by_isleaf AS nleaf, level AS nlevel FROM dw_dimcompany START WITH scode = '1001' CONNECT BY prior scode = spcode) a LEFT JOIN ( SELECT DIM_COMPANY, SINSTRUCTIONSUSER, CASE WHEN ncount > 0 AND SISINSTRUCTIONS='-1' THEN '未批示' ELSE '已批示' END AS sstate, CASE WHEN ncount > 0 THEN 'Y' ELSE 'N' END AS SISINSTRUCTIONS, 'fuq' AS reportuser, '201805' AS reportime FROM ( SELECT DIM_COMPANY, SISINSTRUCTIONS, SINSTRUCTIONSUSER, COUNT (*) AS ncount FROM RISK_REPORTSTATE WHERE NRELATEID IN ( SELECT nid FROM risk_distinguish WHERE dim_company = '1001' AND SUBSTR(screatetime,1,6) <= '201905') AND SISINSTRUCTIONS IN ('-1', '1') GROUP BY DIM_COMPANY , SISINSTRUCTIONS,SINSTRUCTIONSUSER ) ) c ON a.scode = c.dim_company"
        },
        {
            "id": "104",
            "text": "汇总批示查看按钮的sql",
            "sql": "WITH riskstate AS( SELECT NRELATEID， SISINSTRUCTIONS, SREPORTUSER, SREPORTTIME, SINSTRUCTSCONTENT, CSTRATEGY FROM RISK_REPORTSTATE WHERE DIM_COMPANY='1001' AND DIM_PERIOD='201905') , risklist AS ( SELECT RISK_DISTINGUISH.nid, DIM_COMPANY, DIM_PERIOD, SRISKNAME， SRISKTYPE, SRISKDESCRIPTION, SMEASURES, SPROPOSAL, NGRADE, NPROBABILITY, NINFLUENCE, risk_matrix.sname AS levelsname FROM RISK_DISTINGUISH LEFT JOIN risk_matrix ON RISK_DISTINGUISH.ngrade = risk_matrix.nid WHERE RISK_DISTINGUISH.nid IN ( SELECT NRELATEID FROM riskstate) ) , datalist AS ( SELECT risklist.nid, risklist.dim_company, risklist.dim_period, risklist.sriskname, risk_type.sname AS SRISKTYPE, risk_type.scode AS sriskscode, riskstate.SISINSTRUCTIONS, riskstate.SREPORTUSER, riskstate.SREPORTTIME, risklist.SRISKDESCRIPTION, risklist.SMEASURES, risklist.SPROPOSAL, riskstate.SINSTRUCTSCONTENT, RISK_INFLUENCE_DEGREE.SDESCRIPTION AS NINFLUENCE, RISK_PROBABILITY.SDESCRIPTION AS NPROBABILITY, riskstate.CSTRATEGY, riskstate.NRELATEID, risklist.levelsname FROM risklist LEFT JOIN riskstate ON risklist.nid = riskstate.nrelateid LEFT JOIN ( SELECT scode, sname, spcode FROM risk_type) risk_type ON risk_type.scode=risklist.SRISKTYPE LEFT JOIN RISK_INFLUENCE_DEGREE ON risklist.NINFLUENCE=RISK_INFLUENCE_DEGREE.nid LEFT JOIN RISK_PROBABILITY ON risklist.NPROBABILITY=RISK_PROBABILITY.nid ) SELECT NRELATEID, dd.scode AS scode, dd.spcode AS spcode, dd.sname, dim_period, ( CASE WHEN SISINSTRUCTIONS='1' THEN '已批示' WHEN SISINSTRUCTIONS='-1' THEN '未批示' WHEN SISINSTRUCTIONS='0' THEN '提醒' WHEN SISINSTRUCTIONS='2' THEN '退回' ELSE '' END ) AS ISINSTRUCTIONS, SISINSTRUCTIONS AS instructionid, SREPORTUSER AS REPORTUSER , SREPORTTIME AS REPORTTIME , sriskname, SRISKTYPE AS RISKTYPE, sriskscode AS riskscode, SRISKDESCRIPTION AS DESCRIPTION, SMEASURES AS CQCS , SPROPOSAL AS YDJY, SINSTRUCTSCONTENT AS PSNR, NPROBABILITY, NINFLUENCE , CSTRATEGY, levelsname FROM datalist LEFT JOIN ( SELECT scode, sname, spcode, connect_by_isleaf AS cisleaf, level AS nlevel FROM DW_DIMCOMPANY START WITH scode = '1001' CONNECT BY prior scode = spcode) dd ON datalist.dim_company=dd.scode ORDER BY dd.scode"
        },
        {
            "id": "105",
            "text": "内部对标树表的sql",
            "sql": "with t1 as( select scode,sname,spcode from dw_dimcompany where CISDEL='N' start with SCODE='1001' CONNECT BY PRIOR scode=spcode) SELECT t1.scode,t1.sname,t1.spcode, SCORE, t3.sname as Grade fROM ( select DIM_COMPANY, DIM_GRADE,SCORE from DW_FACTINDICATOR where DIM_FACT='A' and DIM_INDICATOR= 'qypj' and DIM_PERIOD='201808' and DIM_COMPANY in (select scode from t1)) t2 right join t1 on t1.scode=t2.DIM_COMPANY left join DW_DIMGRADE t3 on t2.DIM_GRADE=t3.scode"
        },
        {
            "id": "106",
            "text": "综合评级的sql",
            "sql": "SELECT t1.scode,t1.sname,t1.spcode,t4.scode as zbid,t4.sname as zbmc, '10' as a, '7' as b, '5' as c, '4' as d, '2' as e, SCORE as qyfz,t3.sname as pj fROM( select SCORE,DIM_COMPANY,DIM_GRADE,DIM_INDICATOR from DW_FACTINDICATOR where DIM_FACT='A' and DIM_INDICATOR in ( 'qypj','zwfx', 'yyzl', 'fznl', 'ylnl')and DIM_PERIOD='201808' and DIM_COMPANY='1001') t2 left join (select scode,sname,spcode from dw_dimcompany where CISDEL='N') t1 on t1.scode=t2.DIM_COMPANY left join DW_DIMGRADE t3 on t2.DIM_GRADE=t3.scode left join DW_DIMINDICATOR t4 on t2.DIM_INDICATOR=t4.scode"
        }
    ]
}