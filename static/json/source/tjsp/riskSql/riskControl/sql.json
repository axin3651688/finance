{
    "code": 200,
    "sqlList": [{
            "id": "101",
            "text": "风险控制批示",
            "sql": "with t as(select a.nid as id, sriskname fxmc, c.sname fxlx, b.sname fxdj, b.colormark as fxlxcolor, a.ngrade as nlevel, sriskdescription fxms, sorigin fxly,case when d.sisinstructions='1' then '已批示' else '未批示' end pszt, d.sisinstructions as psztid, screatetime cjsj， smeasures cqcs, sproposal ydjy, nprobability fxgl,d.cstrategy as fxydcl, d.SINSTRUCTIONSUSER from risk_distinguish a left join risk_matrix b on a.ngrade=b.nid left join risk_type c on a.srisktype=c.scode left join risk_reportstate d on a.nid=d.nrelateid where a.dim_company=:company and a.dim_period=:period and a.dim_department=:departId and(d.sisinstructions in('-1','1')) order by d.sisinstructions) , t2 as (select a.id, wm_concat(b.sname) as FXYDCLNAME, wm_concat(b.SDESC) as FXYDCLSDESC from (SELECT id, SUBSTR(FXYDCL, INSTR(FXYDCL, ',', 1, LEVEL) + 1, INSTR(FXYDCL, ',', 1, LEVEL + 1) - INSTR(FXYDCL, ',', 1, LEVEL) - 1) FXYDCL,LEVEL FROM (select id ,','||FXYDCL||',' as FXYDCL, LENGTH(FXYDCL) - LENGTH(REPLACE(FXYDCL, ','))+2 CN from t) TT CONNECT BY PRIOR id = id AND LEVEL < CN AND PRIOR DBMS_RANDOM.VALUE IS NOT NULL) a left join RISK_STRATEGY b on a.FXYDCL = b.scode group by a.id) select a.*,b. FXYDCLNAME, b.FXYDCLSDESC from t a left join t2 b on a.id = b.id order by nlevel"
        },
        {
            "id": "102",
            "text": "风险管控弹出框的指定下达人员的sql",
            "sql": "SELECT SCODE, SNAME, SPCODE,b.nid as usernid,b.suser as suser, b.STRUENAME,b.suser||'('||b.STRUENAME||')' username FROM DW_DIMDEPARTMENT a right join(select nid,STRUENAME,suser, SDEPARTMENTID from SYS_USER where COMPANY='1001') b on a.scode=b.SDEPARTMENTID where SCOMCODE='1001' order by scode"
        },
        {
            "id": "103",
            "text": "风险管控汇总批示树表数据",
            "sql": "select a.scode as scode , a.sname as sname,a.spcode as spcode, sstate, c.reportuser,c.reportime, c.SISINSTRUCTIONS, a.nleaf, a.nlevel from(select scode, sname, spcode, connect_by_isleaf as nleaf, level as nlevel from dw_dimcompany start with scode = '1001' connect by prior scode = spcode) a left join (select DIM_COMPANY, CASE WHEN ncount > 0 THEN '未批示' ELSE '已批示' END AS sstate, case when ncount > 0 then 'Y' else 'N' end as SISINSTRUCTIONS, 'fuq' as reportuser, '201805' as reportime from (select DIM_COMPANY, count (*) as ncount from RISK_REPORTSTATE where NRELATEID in (select nid from risk_distinguish where dim_company = '1001' and substr(screatetime,1,6) <= '201905') and SISINSTRUCTIONS in ('-1') group by DIM_COMPANY)) c on a.scode = c.dim_company"
        },
        {
            "id": "104",
            "text": "汇总批示查看按钮的sql",
            "sql": "WITH riskstate AS( SELECT NRELATEID， SISINSTRUCTIONS, SREPORTUSER, SREPORTTIME, SINSTRUCTSCONTENT, CSTRATEGY FROM RISK_REPORTSTATE WHERE DIM_COMPANY='1001' AND DIM_PERIOD='201904') , risklist AS ( SELECT RISK_DISTINGUISH.nid, DIM_COMPANY, DIM_PERIOD, SRISKNAME， SRISKTYPE, SRISKDESCRIPTION, SMEASURES, SPROPOSAL, NGRADE, NPROBABILITY, NINFLUENCE, risk_matrix.sname AS levelsname FROM RISK_DISTINGUISH LEFT JOIN risk_matrix ON RISK_DISTINGUISH.ngrade = risk_matrix.nid WHERE RISK_DISTINGUISH.nid IN ( SELECT NRELATEID FROM riskstate) ) , datalist AS ( SELECT risklist.nid, risklist.dim_company, risklist.dim_period, risklist.sriskname, risk_type.sname AS SRISKTYPE, risk_type.scode AS sriskscode, riskstate.SISINSTRUCTIONS, riskstate.SREPORTUSER, riskstate.SREPORTTIME, risklist.SRISKDESCRIPTION, risklist.SMEASURES, risklist.SPROPOSAL, riskstate.SINSTRUCTSCONTENT, RISK_INFLUENCE_DEGREE.SDESCRIPTION AS NINFLUENCE, RISK_PROBABILITY.SDESCRIPTION AS NPROBABILITY, riskstate.CSTRATEGY, riskstate.NRELATEID, risklist.levelsname FROM risklist LEFT JOIN riskstate ON risklist.nid = riskstate.nrelateid LEFT JOIN ( SELECT scode, sname, spcode FROM risk_type) risk_type ON risk_type.scode=risklist.SRISKTYPE LEFT JOIN RISK_INFLUENCE_DEGREE ON risklist.NINFLUENCE=RISK_INFLUENCE_DEGREE.nid LEFT JOIN RISK_PROBABILITY ON risklist.NPROBABILITY=RISK_PROBABILITY.nid ) SELECT NRELATEID, dd.scode AS scode, dd.spcode AS spcode, dd.sname, dim_period, ( CASE WHEN SISINSTRUCTIONS='1' THEN '已批示' WHEN SISINSTRUCTIONS='-1' THEN '未批示' WHEN SISINSTRUCTIONS='0' THEN '提醒' WHEN SISINSTRUCTIONS='2' THEN '退回' ELSE '' END ) AS ISINSTRUCTIONS, SISINSTRUCTIONS AS instructionid, SREPORTUSER AS REPORTUSER , SREPORTTIME AS REPORTTIME , sriskname, SRISKTYPE AS RISKTYPE, sriskscode AS riskscode, SRISKDESCRIPTION AS DESCRIPTION, SMEASURES AS CQCS , SPROPOSAL AS YDJY, SINSTRUCTSCONTENT AS PSNR, NPROBABILITY, NINFLUENCE , CSTRATEGY, levelsname FROM datalist LEFT JOIN ( SELECT scode, sname, spcode, connect_by_isleaf AS cisleaf, level AS nlevel FROM DW_DIMCOMPANY START WITH scode = '1001' CONNECT BY prior scode = spcode) dd ON datalist.dim_company=dd.scode ORDER BY dd.scode"
        }
    ]
}