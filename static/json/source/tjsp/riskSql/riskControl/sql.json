{
    "code": 200,
    "sqlList": [{
            "id": "101",
            "text": "风险控制批示",
            "sql": "WITH t AS( SELECT a.nid AS id, sriskname fxmc, c.sname fxlx, b.sname fxdj, b.colormark AS fxlxcolor, a.ngrade AS nlevel, sriskdescription fxms, sorigin fxly, CASE WHEN d.sisinstructions='1' THEN '已批示' ELSE '未批示' END pszt, d.sisinstructions AS psztid, screatetime cjsj， smeasures cqcs, sproposal ydjy, nprobability fxgl, e.sname fxglmc, d.cstrategy AS fxydcl, d.SINSTRUCTSCONTENT AS fxydclnr, d.SINSTRUCTIONSUSER FROM risk_distinguish a LEFT JOIN risk_matrix b ON a.ngrade=b.nid LEFT JOIN risk_type c ON a.srisktype=c.scode LEFT JOIN (select * from risk_reportstate where SISREPORT = '1') d ON a.nid=d.nrelateid LEFT JOIN risk_probability e ON e.nid = a.nprobability WHERE a.dim_company=:company AND a.dim_period=:period AND a.dim_department=:departId and SISSUBMIT='Y' ORDER BY d.sisinstructions) , t2 AS ( SELECT a.id, wm_concat(b.sname) AS FXYDCLNAME, wm_concat(b.SDESC) AS FXYDCLSDESC FROM ( SELECT id, SUBSTR(FXYDCL, INSTR(FXYDCL, ',', 1, LEVEL) + 1, INSTR(FXYDCL, ',', 1, LEVEL + 1) - INSTR(FXYDCL, ',', 1, LEVEL) - 1) FXYDCL, LEVEL FROM ( SELECT id , ','||FXYDCL||',' AS FXYDCL, LENGTH(FXYDCL) - LENGTH(REPLACE(FXYDCL, ','))+2 CN FROM t) TT CONNECT BY PRIOR id = id AND LEVEL < CN AND PRIOR DBMS_RANDOM.VALUE IS NOT NULL) a LEFT JOIN RISK_STRATEGY b ON a.FXYDCL = b.scode GROUP BY a.id ) SELECT a.*, b. FXYDCLNAME, b.FXYDCLSDESC FROM t a LEFT JOIN t2 b ON a.id = b.id ORDER BY nlevel"
        },
        {
            "id": "102",
            "text": "风险管控弹出框的指定下达人员的sql",
            "sql": "SELECT SCODE, SNAME, SPCODE,b.nid as usernid,b.suser as suser, b.STRUENAME,b.suser||'('||b.STRUENAME||')' username FROM DW_DIMDEPARTMENT a right join(select nid,STRUENAME,suser, SDEPARTMENTID from SYS_USER where COMPANY=:company) b on a.scode=b.SDEPARTMENTID where SCOMCODE=:company order by scode"
        },
        {
            "id": "103",
            "text": "风险管控汇总批示树表数据",
            "sql": "SELECT a.scode AS scode, a.sname AS sname, a.spcode AS spcode, sstate, c.SREPORTUSER, c.suser, c.SISINSTRUCTIONS, C.SREPORTTIME, a.nleaf, a.nlevel FROM(SELECT scode, sname, spcode, connect_by_isleaf AS nleaf, level AS nlevel FROM dw_dimcompany START WITH scode = :company CONNECT BY prior scode = spcode) a LEFT JOIN (SELECT DIM_COMPANY, SREPORTUSER, SREPORTTIME, suser, CASE WHEN ncount > 0 AND SISINSTRUCTIONS='1' THEN '已批示' ELSE '未批示' END AS sstate, CASE WHEN ncount > 0 THEN 'Y' ELSE 'N' END AS SISINSTRUCTIONS FROM (SELECT DIM_COMPANY, SISINSTRUCTIONS, sys_user.suser as suser, '('||RISK_REPORTSTATE.SREPORTUSER||')'||sys_user.STRUENAME AS SREPORTUSER, SREPORTTIME, COUNT (*) AS ncount FROM RISK_REPORTSTATE LEFT JOIN sys_user ON RISK_REPORTSTATE.SREPORTUSER = sys_user.suser WHERE NRELATEID IN (SELECT nid FROM risk_distinguish WHERE dim_company = :company AND dim_period = :period) AND SISREPORT = '1' AND SISINSTRUCTIONS IN ('-1','1','0','2') GROUP BY DIM_COMPANY , SISINSTRUCTIONS, SREPORTUSER,SREPORTTIME,STRUENAME,suser)) c ON a.scode = c.dim_company"
        },
        {
            "id": "104",
            "text": "汇总批示查看按钮的sql",
            "sql": "WITH riskstate AS(SELECT NRELATEID， SISINSTRUCTIONS, SREPORTUSER, SREPORTTIME, SINSTRUCTSCONTENT, CSTRATEGY FROM RISK_REPORTSTATE WHERE DIM_COMPANY=:company AND dim_period = :period) , risklist AS (SELECT RISK_DISTINGUISH.nid, DIM_COMPANY, DIM_PERIOD, SRISKNAME， SRISKTYPE, SRISKDESCRIPTION, SMEASURES, SPROPOSAL, NGRADE, NPROBABILITY, SFILLUSER, NINFLUENCE, risk_matrix.sname AS levelsname, risk_matrix.nid AS levelnid, risk_matrix.colormark as reptcolor FROM RISK_DISTINGUISH LEFT JOIN risk_matrix ON RISK_DISTINGUISH.ngrade = risk_matrix.nid WHERE RISK_DISTINGUISH.nid IN (SELECT NRELATEID FROM riskstate)) , datalist AS (SELECT risklist.nid, risklist.dim_company, risklist.dim_period, risklist.sriskname, risklist.SFILLUSER, risk_type.sname AS SRISKTYPE, risk_type.scode AS sriskscode, risk_type.spcode AS sriskspcode, risk_type.spname AS sriskspname, riskstate.SISINSTRUCTIONS, riskstate.SREPORTUSER, riskstate.SREPORTTIME, risklist.SRISKDESCRIPTION, risklist.SMEASURES, risklist.SPROPOSAL, risklist.reptcolor, riskstate.SINSTRUCTSCONTENT, RISK_INFLUENCE_DEGREE.SDESCRIPTION AS NINFLUENCE, RISK_PROBABILITY.SDESCRIPTION AS NPROBABILITY, riskstate.CSTRATEGY, riskstate.NRELATEID, risklist.levelsname, risklist.levelnid FROM risklist LEFT JOIN riskstate ON risklist.nid = riskstate.nrelateid LEFT JOIN (SELECT ff.scode AS scode, ff.sname AS sname, fff.scode AS spcode, fff.sname AS spname FROM (SELECT scode, sname, spcode FROM risk_type WHERE spcode <> '00') ff LEFT JOIN (SELECT scode, sname, spcode FROM risk_type) fff ON ff.spcode = fff.scode) risk_type ON risk_type.scode=risklist.SRISKTYPE LEFT JOIN RISK_INFLUENCE_DEGREE ON risklist.NINFLUENCE=RISK_INFLUENCE_DEGREE.nid LEFT JOIN RISK_PROBABILITY ON risklist.NPROBABILITY=RISK_PROBABILITY.nid) SELECT NRELATEID, dd.scode AS scode, dd.spcode AS spcode, dd.sname, dim_period, ( CASE WHEN SISINSTRUCTIONS='1' THEN '已批示' WHEN SISINSTRUCTIONS='-1' THEN '未批示' WHEN SISINSTRUCTIONS='0' THEN '提醒' WHEN SISINSTRUCTIONS='2' THEN '退回' ELSE '' END ) AS ISINSTRUCTIONS, SISINSTRUCTIONS AS instructionid, SREPORTUSER AS REPORTUSER,SFILLUSER, SREPORTTIME AS REPORTTIME , sriskname, SRISKTYPE AS RISKTYPE, sriskscode AS riskscode, sriskspcode AS riskspcode, sriskspname AS riskspname, SRISKDESCRIPTION AS DESCRIPTION, SMEASURES AS CQCS , SPROPOSAL AS YDJY, SINSTRUCTSCONTENT AS PSNR, NPROBABILITY, NINFLUENCE , CSTRATEGY, levelsname,levelnid,reptcolor FROM datalist LEFT JOIN (SELECT scode, sname, spcode, connect_by_isleaf AS cisleaf, level AS nlevel FROM DW_DIMCOMPANY START WITH scode = :company CONNECT BY prior scode = spcode) dd ON datalist.dim_company=dd.scode WHERE sriskscode is NOT null ORDER BY riskspcode "
        },
        {
            "id": "105",
            "text": "内部对标树表的sql",
            "sql": "with t1 as( select scode,sname,spcode from dw_dimcompany where CISDEL='N' start with SCODE='1001' CONNECT BY PRIOR scode=spcode) SELECT t1.scode,t1.sname,t1.spcode, SCORE, t3.sname as Grade fROM ( select DIM_COMPANY, DIM_GRADE,SCORE from DW_FACTINDICATOR where DIM_FACT='A' and DIM_INDICATOR= 'qypj' and DIM_PERIOD='201808' and DIM_COMPANY in (select scode from t1)) t2 right join t1 on t1.scode=t2.DIM_COMPANY left join DW_DIMGRADE t3 on t2.DIM_GRADE=t3.scode"
        },
        {
            "id": "106",
            "text": "综合评级的sql",
            "sql": "SELECT t1.scode,t1.sname,t1.spcode,t4.scode as zbid,t4.sname as zbmc, '10' as a, '7' as b, '5' as c, '4' as d, '2' as e, SCORE as qyfz,t3.sname as pj fROM( select SCORE,DIM_COMPANY,DIM_GRADE,DIM_INDICATOR from DW_FACTINDICATOR where DIM_FACT='A' and DIM_INDICATOR in ( 'qypj','zwfx', 'yyzl', 'fznl', 'ylnl')and DIM_PERIOD='201808' and DIM_COMPANY='1001') t2 left join (select scode,sname,spcode from dw_dimcompany where CISDEL='N') t1 on t1.scode=t2.DIM_COMPANY left join DW_DIMGRADE t3 on t2.DIM_GRADE=t3.scode left join DW_DIMINDICATOR t4 on t2.DIM_INDICATOR=t4.scode"
        },
        {
            "id": "107",
            "text": "盈利能力的sql",
            "sql": "with t1 as( SELECT t1.scode,t1.sname,t1.spcode,VAL,DIM_INDICATOR, t3.sname as pj,SCORE as qyfz fROM ( select SCORE,DIM_COMPANY,DIM_GRADE,DIM_INDICATOR,VAL from DW_FACTINDICATOR where DIM_FACT='A' and DIM_INDICATOR in ( '19','20','53','120','21','121', '133') and DIM_PERIOD='201808' and DIM_COMPANY='1001') t2 left join (select scode,sname,spcode from dw_dimcompany where CISDEL='N')t1 on t1.scode=t2.DIM_COMPANY left join DW_DIMGRADE t3 on t2.DIM_GRADE=t3.scode), t2 as ( SELECT '1001' as scode , INDSPARA, A, B, C, D, E FROM DW_FACTINDUSTRY WHERE INDSPARA IN ( '19','20','53','120','21','121', '133') AND INDSYEAR='2018' AND INDSCLASSIFY=(select SINDCODEDETAIL from dw_dimcompany where scode='1001') AND INDSRANGE=(select SINDSRANGE from dw_dimcompany where scode='1001')) select t1.scode,t1.sname,t3.sname,t1.DIM_INDICATOR, a,b,c,d,e, t1.val,t1.pj,t1.qyfz from t1 left join t2 on t1.scode=t2.scode and t1.DIM_INDICATOR=t2.INDSPARA left join (select scode , sname from DW_DIMINDEX where STYPE='JT') t3 on t1.DIM_INDICATOR=t3.SCODE "
        },
        {
            "id": "108",
            "text": "汇总提醒人员的查询的sql",
            "sql": "SELECT SCODE, SNAME, SPCODE,b.nid as usernid,b.suser as suser, b.STRUENAME,b.suser||'('||b.STRUENAME||')' username FROM DW_DIMDEPARTMENT a right join(select nid,STRUENAME,suser, SDEPARTMENTID from SYS_USER where COMPANY=:company) b on a.scode=b.SDEPARTMENTID where SCOMCODE=:company order by scode"
        }
    ]
}