{
    "id": "001406",
    "text": "集团经营目标预测分析情况表",
    "layout": {
        "xtype": "tab"
    },
    "showDims": ["year", "month", "company", "conversion"],
    "changeCompanyBefore": function(newcompany, option) {
        option.closeTabTaget(newcompany, option);
    },
    "changeYearBefore": function(newyear, option) {
        option.closeTabTaget(newyear, option);
    },
    "changeMonthBefore": function(newmonth, option) {
        debugger
        option.closeTabTaget(newmonth, option);
    },
    "__queryDataAfter": function(data, $vue) { //数据的后置处理
        debugger
        let me = this;
        me.items[0].updateView = $vue.updateView;
        me.items[0].$vue = $vue;
        return data;
    },
    // "queryDataBefore":function(params,config,option){
    //     debugger
    // if(option.id === "001406"){
    //     // 上年
    //     let sn = params.year - 1 ;
    //     // 本年
    //     let _year = params.year ; 
    //     config.sql = config.sql2.replace(/:year/g,"'"+_year+"'").replace(/:sn/g,"'"+sn+"'") ;
    // }
    // return params ; 
    // },
    "config": {
        // "sql2": "WITH T1 AS(SELECT B.SNAME AS ASNAME,A.SCODE AS SCODE,B.SCODE INDSCODE FROM (select scode,SINDCODE from DW_DIMCOMPANY where cisdel='N' AND SINDCODE IS NOT NULL AND STYPE<>'0' START WITH SCODE=:company CONNECT BY PRIOR SCODE=SPCODE) A right JOIN (select sname,scode from DW_DIMINDUSTRY) B ON A.SINDCODE=B.SCODE order by to_number(b.sCODE)) SELECT T8.ASNAME,T8.M1,T8.M2,T8.M3, T8.M4,T8.M5,T8.M6,T8.M11, T8.M12,T8.M13,T8.M14,T8.M15,T8.M16, T9.M7,T9.M8,T9.M9,T9.M17,T9.M18,T9.M19, T9.M27,T9.M28,T9.M29 FROM ( SELECT ASNAME,SUM(KHMB)AS M1,SUM(YCWC) AS M2,SUM(WCMBJD) AS M3,SUM(SNTQWC) AS M4,SUM(ZJE) AS M5,ROUND(DECODE(SUM(SNTQWC),0,0,(SUM(ZJE))/SUM(SNTQWC)),4) AS M6 , SUM(LRZEKHMB) AS M11, SUM(LRZEYCWC) AS M12,SUM(LRZEWCMBJD) AS M13,SUM(LRZESNTQWC) AS M14,SUM(LRZEZJE) AS M15, ROUND(DECODE(SUM(LRZESNTQWC),0,0,(SUM(LRZEZJE))/SUM(LRZESNTQWC)),4) AS M16 FROM( SELECT ASNAME,KHMB,YCWC,ROUND(DECODE(YCWC,0,0,YCWC/KHMB),4) WCMBJD,SNTQWC,LJWC-SNTQWC AS ZJE,ROUND(DECODE(SNTQWC,0,0,(LJWC-SNTQWC)/SNTQWC),4) AS ZJL, 0 AS LRZEKHMB,0 AS LRZEYCWC,0 AS LRZEWCMBJD, 0 AS LRZESNTQWC,0 AS LRZEZJE, 0 AS LRZEZJL FROM ( SELECT T1.SCODE,T1.ASNAME,T2.KHMB,T3.YCWC,T4.LJWC,T4.SNTQWC FROM T1 LEFT JOIN (SELECT DIM_COMPANY,SUM(NVL(FACT_A,0)) KHMB FROM DW_FACTTARGETASSESSMENT WHERE DIM_PERIOD=:period AND DIM_COMPANY IN (SELECT SCODE FROM T1) GROUP BY DIM_COMPANY ) T2 ON T1.SCODE = T2.DIM_COMPANY LEFT JOIN (SELECT DIM_COMPANY, SUM(NVL(FACT_A,0)) YCWC FROM DW_FACTTARGETPREDICT WHERE DIM_PERIOD =:year||'06' AND DIM_COMPANY IN (SELECT SCODE FROM T1) GROUP BY DIM_COMPANY ) T3 ON T1.SCODE = T3.DIM_COMPANY LEFT JOIN ( SELECT DIM_COMPANY,SUM(CASE WHEN DIM_PERIOD=:period THEN FACT_B ELSE 0 END) AS LJWC, SUM(CASE WHEN DIM_PERIOD=:comparePeriod THEN FACT_B ELSE 0 END) AS SNTQWC FROM DW_FACTFINANCEPERIOD WHERE DIM_COMPANY IN (SELECT SCODE FROM T1) AND DIM_ITEMPERIOD IN ('1416001') AND DIM_PERIOD IN(:comparePeriod,:period) GROUP BY DIM_COMPANY ) T4 ON T1.SCODE = T4.DIM_COMPANY ) UNION ALL  SELECT ASNAME ,0 as KHMB,0 AS YCWC,0 AS WCMBJD,0 AS SNTQWC,0 AS ZJE,0 AS ZJL,LRZEKHMB ,LRZELJWC, ROUND(DECODE(LRZEKHMB,0,0,LRZELJWC/LRZEKHMB),4) LRZEWCMBJD,LRZESNTQWC, LRZELJWC-LRZESNTQWC AS LRZEZJE ,ROUND(DECODE(LRZESNTQWC,0,0,(LRZELJWC-LRZESNTQWC)/LRZESNTQWC),4) AS LRZEZJL FROM ( SELECT T1.SCODE,T1.ASNAME,T2.LRZEKHMB,T3.LRZEYCWC,T4.LRZELJWC,T4.LRZESNTQWC FROM T1 LEFT JOIN (SELECT DIM_COMPANY,SUM(NVL(FACT_A,0)) LRZEKHMB FROM DW_FACTTARGETASSESSMENT WHERE DIM_PERIOD=:period AND DIM_COMPANY IN (SELECT SCODE FROM T1) GROUP BY DIM_COMPANY ) T2 ON T1.SCODE = T2.DIM_COMPANY LEFT JOIN (SELECT DIM_COMPANY, SUM(NVL(FACT_A,0)) LRZEYCWC FROM DW_FACTTARGETPREDICT WHERE DIM_PERIOD =:year||'06' AND DIM_COMPANY IN (SELECT SCODE FROM T1) GROUP BY DIM_COMPANY ) T3 ON T1.SCODE = T3.DIM_COMPANY LEFT JOIN ( SELECT DIM_COMPANY,SUM(CASE WHEN DIM_PERIOD=:period THEN FACT_B ELSE 0 END) AS LRZELJWC, SUM(CASE WHEN DIM_PERIOD=:comparePeriod THEN FACT_B ELSE 0 END) AS LRZESNTQWC FROM DW_FACTFINANCEPERIOD WHERE DIM_COMPANY IN (SELECT SCODE FROM T1) AND DIM_ITEMPERIOD IN ('1403100') AND DIM_PERIOD IN(:comparePeriod,:period) GROUP BY DIM_COMPANY ) T4 ON T1.SCODE = T4.DIM_COMPANY ) ) GROUP BY ASNAME ) T8 -- LEFT JOIN ( SELECT ASNAME ,SUM(YCWC)AS M7,SUM(ZCZJZJE) AS M8,ROUND(DECODE(SUM(SNBNLJ),0,0,(SUM(YCWC)-SUM(SNBNLJ))/SUM(SNBNLJ)),4) AS M9, SUM(FZYCWC) AS M17, SUM(FZZJZJE) AS M18,ROUND(DECODE(SUM(FZSNBNLJ),0,0,(SUM(FZYCWC)-SUM(FZSNBNLJ))/SUM(FZSNBNLJ)),4) AS M19, SUM(QYYCWC) AS M27,SUM(QYZJZJE) AS M28,ROUND(DECODE(SUM(QYSNBNLJ),0,0,(SUM(QYYCWC)-SUM(QYSNBNLJ))/SUM(QYSNBNLJ)),4) AS M29 FROM ( SELECT ASNAME,YCWC,YCWC-SNBNLJ AS ZCZJZJE,SNBNLJ, 0 AS FZYCWC, 0 AS FZZJZJE,0 AS FZSNBNLJ, 0 AS QYYCWC,0 AS QYZJZJE,0 AS QYSNBNLJ FROM( SELECT T1.ASNAME,T5.YCWC, T6.SNBNLJ FROM T1 LEFT JOIN (SELECT DIM_COMPANY, SUM(NVL(FACT_A,0)) YCWC FROM DW_FACTTARGETPREDICT WHERE DIM_PERIOD =:year||'06' AND DIM_COMPANY IN (SELECT SCODE FROM T1) GROUP BY DIM_COMPANY )T5 ON T1.SCODE = T5.DIM_COMPANY LEFT JOIN ( SELECT SUM((CASE WHEN EXISTS(SELECT DIM_PERIOD FROM DW_FACTFINANCEPOINT WHERE DIM_PERIOD=:sn||'13' AND DIM_COMPANY IN (SELECT SCODE FROM T1) AND DIM_ITEMPOINT ='1100100') THEN (SELECT SUM(NVL(FACT_B,0)) FROM DW_FACTFINANCEPOINT WHERE DIM_PERIOD=:sn||'13' AND DIM_ITEMPOINT ='1100100' AND DIM_COMPANY IN (SELECT SCODE FROM T1)) ELSE (SELECT SUM(NVL(FACT_B,0)) AS FACT_B FROM DW_FACTFINANCEPOINT WHERE DIM_PERIOD=:comparePeriod AND DIM_ITEMPOINT ='1100100' AND DIM_COMPANY IN (SELECT SCODE FROM T1)) END)) AS SNBNLJ,DIM_COMPANY FROM DW_FACTFINANCEPOINT WHERE DIM_ITEMPOINT ='1100100' AND DIM_COMPANY IN (SELECT SCODE FROM T1) GROUP BY DIM_COMPANY ) T6 ON T6.DIM_COMPANY = T1.SCODE ) UNION ALL  SELECT ASNAME,0 AS YCWC,0 AS ZCZJZJE,0 AS SNBNLJ, FZYCWC,FZYCWC-FZSNBNLJ AS FZZJZJE,FZSNBNLJ, 0 AS QYYCWC,0 AS QYZJZJE,0 AS QYSNBNLJ FROM( SELECT T1.ASNAME,T5.FZYCWC, T6.FZSNBNLJ FROM T1 LEFT JOIN (SELECT DIM_COMPANY, SUM(NVL(FACT_A,0)) FZYCWC FROM DW_FACTTARGETPREDICT WHERE DIM_PERIOD =:period AND DIM_COMPANY IN (SELECT SCODE FROM T1) GROUP BY DIM_COMPANY )T5 ON T1.SCODE = T5.DIM_COMPANY LEFT JOIN ( SELECT SUM((CASE WHEN EXISTS(SELECT DIM_PERIOD FROM DW_FACTFINANCEPOINT WHERE DIM_PERIOD=:sn||'13' AND DIM_COMPANY IN (SELECT SCODE FROM T1) AND DIM_ITEMPOINT ='1200100') THEN (SELECT SUM(NVL(FACT_B,0)) FROM DW_FACTFINANCEPOINT WHERE DIM_PERIOD=:sn||'13' AND DIM_ITEMPOINT ='1200100' AND DIM_COMPANY IN (SELECT SCODE FROM T1)) ELSE (SELECT SUM(NVL(FACT_B,0)) AS FACT_B FROM DW_FACTFINANCEPOINT WHERE DIM_PERIOD=:comparePeriod AND DIM_ITEMPOINT ='1200100' AND DIM_COMPANY IN (SELECT SCODE FROM T1)) END)) AS FZSNBNLJ,DIM_COMPANY FROM DW_FACTFINANCEPOINT WHERE DIM_ITEMPOINT ='1200100' AND DIM_COMPANY IN (SELECT SCODE FROM T1) GROUP BY DIM_COMPANY ) T6 ON T6.DIM_COMPANY = T1.SCODE ) UNION ALL  SELECT ASNAME,0 AS YCWC,0 AS ZCZJZJE,0 AS SNBNLJ, 0 AS FZYCWC, 0 AS FZZJZJE,0 AS FZSNBNLJ, QYYCWC,QYYCWC-QYSNBNLJ AS QYZJZJE,QYSNBNLJ FROM( SELECT T1.SCODE,T1.ASNAME,T5.QYYCWC, T6.QYSNBNLJ FROM T1 LEFT JOIN (SELECT DIM_COMPANY, SUM(NVL(FACT_A,0)) QYYCWC FROM DW_FACTTARGETPREDICT WHERE DIM_PERIOD =:year||'06' AND DIM_COMPANY IN (SELECT SCODE FROM T1) GROUP BY DIM_COMPANY )T5 ON T1.SCODE = T5.DIM_COMPANY LEFT JOIN ( SELECT SUM((CASE WHEN EXISTS(SELECT DIM_PERIOD FROM DW_FACTFINANCEPOINT WHERE DIM_PERIOD=:sn||'13' AND DIM_COMPANY IN (SELECT SCODE FROM T1) AND DIM_ITEMPOINT ='1300100') THEN (SELECT SUM(NVL(FACT_B,0)) FROM DW_FACTFINANCEPOINT WHERE DIM_PERIOD=:sn||'13' AND DIM_ITEMPOINT ='1300100' AND DIM_COMPANY IN (SELECT SCODE FROM T1)) ELSE (SELECT SUM(NVL(FACT_B,0)) AS FACT_B FROM DW_FACTFINANCEPOINT WHERE DIM_PERIOD=:comparePeriod AND DIM_ITEMPOINT ='1300100' AND DIM_COMPANY IN (SELECT SCODE FROM T1)) END)) AS QYSNBNLJ,DIM_COMPANY FROM DW_FACTFINANCEPOINT WHERE DIM_ITEMPOINT ='1300100' AND DIM_COMPANY IN (SELECT SCODE FROM T1) GROUP BY DIM_COMPANY ) T6 ON T6.DIM_COMPANY = T1.SCODE ) ) GROUP BY ASNAME ) T9 ON T8.ASNAME = T9.ASNAME left join DW_DIMINDUSTRY y on y.sname = T8.ASNAME order by y.scode ",
        // "sql" : "WITH T1 AS( SELECT B.SNAME AS ASNAME, A.SCODE AS SCODE, B.SCODE INDSCODE FROM ( SELECT scode, SINDCODE FROM DW_DIMCOMPANY WHERE cisdel='N' AND SINDCODE IS NOT NULL AND STYPE<>'0' START WITH SCODE='1001' CONNECT BY PRIOR SCODE=SPCODE) A RIGHT JOIN ( SELECT sname, scode FROM DW_DIMINDUSTRY) B ON A.SINDCODE=B.SCODE ORDER BY to_number(b.sCODE)) SELECT T8.ASNAME, T8.M1, T8.M2, T8.M3, T8.M4, T8.M5, T8.M6, T8.M11, T8.M12, T8.M13, T8.M14, T8.M15, T8.M16, T9.M7, T9.M8, T9.M9, T9.M17, T9.M18, T9.M19, T9.M27, T9.M28, T9.M29 FROM ( SELECT ASNAME, SUM(KHMB) AS M1, SUM(YCWC) AS M2, SUM(WCMBJD) AS M3, SUM(SNTQWC) AS M4, SUM(ZJE) AS M5, ROUND(DECODE(SUM(SNTQWC), 0, 0, (SUM(ZJE))/SUM(SNTQWC)), 4) AS M6 , SUM(LRZEKHMB) AS M11, SUM(LRZEYCWC) AS M12, SUM(LRZEWCMBJD) AS M13, SUM(LRZESNTQWC) AS M14, SUM(LRZEZJE) AS M15, ROUND(DECODE(SUM(LRZESNTQWC), 0, 0, (SUM(LRZEZJE))/SUM(LRZESNTQWC)), 4) AS M16 FROM ( SELECT ASNAME, KHMB, YCWC, ROUND(DECODE(YCWC, 0, 0, YCWC/KHMB), 4) WCMBJD, SNTQWC, LJWC-SNTQWC AS ZJE, ROUND(DECODE(SNTQWC, 0, 0, (LJWC-SNTQWC)/SNTQWC), 4) AS ZJL, 0 AS LRZEKHMB, 0 AS LRZEYCWC, 0 AS LRZEWCMBJD, 0 AS LRZESNTQWC, 0 AS LRZEZJE, 0 AS LRZEZJL FROM ( SELECT T1.SCODE, T1.ASNAME, T2.KHMB, T3.YCWC, T4.LJWC, T4.SNTQWC FROM T1 LEFT JOIN ( SELECT DIM_COMPANY, SUM(NVL(FACT_A, 0)) KHMB FROM DW_FACTTARGETASSESSMENT WHERE DIM_PERIOD='201812' AND DIM_COMPANY IN ( SELECT SCODE FROM T1) GROUP BY DIM_COMPANY ) T2 ON T1.SCODE = T2.DIM_COMPANY LEFT JOIN ( SELECT DIM_COMPANY, SUM(NVL(FACT_A, 0)) YCWC FROM DW_FACTTARGETPREDICT WHERE DIM_PERIOD ='2018'||'06' AND DIM_COMPANY IN ( SELECT SCODE FROM T1) GROUP BY DIM_COMPANY ) T3 ON T1.SCODE = T3.DIM_COMPANY LEFT JOIN ( SELECT DIM_COMPANY, SUM( CASE WHEN DIM_PERIOD='201812' THEN FACT_B ELSE 0 END) AS LJWC, SUM( CASE WHEN DIM_PERIOD='201712' THEN FACT_B ELSE 0 END) AS SNTQWC FROM DW_FACTFINANCEPERIOD WHERE DIM_COMPANY IN ( SELECT SCODE FROM T1) AND DIM_ITEMPERIOD IN ('1416001') AND DIM_PERIOD IN('201712', '201812') GROUP BY DIM_COMPANY ) T4 ON T1.SCODE = T4.DIM_COMPANY ) UNION ALL SELECT ASNAME , 0 AS KHMB, 0 AS YCWC, 0 AS WCMBJD, 0 AS SNTQWC, 0 AS ZJE, 0 AS ZJL, LRZEKHMB , LRZELJWC, ROUND(DECODE(LRZEKHMB, 0, 0, LRZELJWC/LRZEKHMB), 4) LRZEWCMBJD, LRZESNTQWC, LRZELJWC-LRZESNTQWC AS LRZEZJE , ROUND(DECODE(LRZESNTQWC, 0, 0, (LRZELJWC-LRZESNTQWC)/LRZESNTQWC), 4) AS LRZEZJL FROM ( SELECT T1.SCODE, T1.ASNAME, T2.LRZEKHMB, T3.LRZEYCWC, T4.LRZELJWC, T4.LRZESNTQWC FROM T1 LEFT JOIN ( SELECT DIM_COMPANY, SUM(NVL(FACT_A, 0)) LRZEKHMB FROM DW_FACTTARGETASSESSMENT WHERE DIM_PERIOD='201812' AND DIM_COMPANY IN ( SELECT SCODE FROM T1) GROUP BY DIM_COMPANY ) T2 ON T1.SCODE = T2.DIM_COMPANY LEFT JOIN ( SELECT DIM_COMPANY, SUM(NVL(FACT_A, 0)) LRZEYCWC FROM DW_FACTTARGETPREDICT WHERE DIM_PERIOD ='2018'||'06' AND DIM_COMPANY IN ( SELECT SCODE FROM T1) GROUP BY DIM_COMPANY ) T3 ON T1.SCODE = T3.DIM_COMPANY LEFT JOIN ( SELECT DIM_COMPANY, SUM( CASE WHEN DIM_PERIOD='201812' THEN FACT_B ELSE 0 END) AS LRZELJWC, SUM( CASE WHEN DIM_PERIOD='201712' THEN FACT_B ELSE 0 END) AS LRZESNTQWC FROM DW_FACTFINANCEPERIOD WHERE DIM_COMPANY IN ( SELECT SCODE FROM T1) AND DIM_ITEMPERIOD IN ('1403100') AND DIM_PERIOD IN('201712', '201812') GROUP BY DIM_COMPANY ) T4 ON T1.SCODE = T4.DIM_COMPANY ) ) GROUP BY ASNAME ) T8 -- LEFT JOIN ( SELECT ASNAME , SUM(YCWC) AS M7, SUM(ZCZJZJE) AS M8, ROUND(DECODE(SUM(SNBNLJ), 0, 0, (SUM(YCWC)-SUM(SNBNLJ))/SUM(SNBNLJ)), 4) AS M9, SUM(FZYCWC) AS M17, SUM(FZZJZJE) AS M18, ROUND(DECODE(SUM(FZSNBNLJ), 0, 0, (SUM(FZYCWC)-SUM(FZSNBNLJ))/SUM(FZSNBNLJ)), 4) AS M19 , SUM(QYYCWC) AS M27, SUM(QYZJZJE) AS M28, ROUND(DECODE(SUM(QYSNBNLJ), 0, 0, (SUM(QYYCWC)-SUM(QYSNBNLJ))/SUM(QYSNBNLJ)), 4) AS M29 FROM ( SELECT ASNAME, YCWC, YCWC-SNBNLJ AS ZCZJZJE, SNBNLJ, 0 AS FZYCWC, 0 AS FZZJZJE, 0 AS FZSNBNLJ, 0 AS QYYCWC, 0 AS QYZJZJE, 0 AS QYSNBNLJ FROM ( SELECT T1.ASNAME, T5.YCWC, T6.SNBNLJ FROM T1 LEFT JOIN ( SELECT DIM_COMPANY, SUM(NVL(FACT_A, 0)) YCWC FROM DW_FACTTARGETPREDICT WHERE DIM_PERIOD ='2018'||'06' AND DIM_COMPANY IN ( SELECT SCODE FROM T1) GROUP BY DIM_COMPANY )T5 ON T1.SCODE = T5.DIM_COMPANY LEFT JOIN ( SELECT SUM(( CASE WHEN EXISTS ( SELECT DIM_PERIOD FROM DW_FACTFINANCEPOINT WHERE DIM_PERIOD='2017'||'13' AND DIM_COMPANY IN ( SELECT SCODE FROM T1) AND DIM_ITEMPOINT ='1100100') THEN ( SELECT SUM(NVL(FACT_B, 0)) FROM DW_FACTFINANCEPOINT WHERE DIM_PERIOD='2017'||'13' AND DIM_ITEMPOINT ='1100100' AND DIM_COMPANY IN ( SELECT SCODE FROM T1)) ELSE ( SELECT SUM(NVL(FACT_B, 0)) AS FACT_B FROM DW_FACTFINANCEPOINT WHERE DIM_PERIOD='201712' AND DIM_ITEMPOINT ='1100100' AND DIM_COMPANY IN ( SELECT SCODE FROM T1)) END)) AS SNBNLJ, DIM_COMPANY FROM DW_FACTFINANCEPOINT WHERE DIM_ITEMPOINT ='1100100' AND DIM_COMPANY IN ( SELECT SCODE FROM T1) GROUP BY DIM_COMPANY ) T6 ON T6.DIM_COMPANY = T1.SCODE ) UNION ALL SELECT ASNAME, 0 AS YCWC, 0 AS ZCZJZJE, 0 AS SNBNLJ, FZYCWC, FZYCWC-FZSNBNLJ AS FZZJZJE, FZSNBNLJ, 0 AS QYYCWC, 0 AS QYZJZJE, 0 AS QYSNBNLJ FROM ( SELECT T1.ASNAME, T5.FZYCWC, T6.FZSNBNLJ FROM T1 LEFT JOIN ( SELECT DIM_COMPANY, SUM(NVL(FACT_A, 0)) FZYCWC FROM DW_FACTTARGETPREDICT WHERE DIM_PERIOD ='201812' AND DIM_COMPANY IN ( SELECT SCODE FROM T1) GROUP BY DIM_COMPANY )T5 ON T1.SCODE = T5.DIM_COMPANY LEFT JOIN ( SELECT SUM(( CASE WHEN EXISTS ( SELECT DIM_PERIOD FROM DW_FACTFINANCEPOINT WHERE DIM_PERIOD='2017'||'13' AND DIM_COMPANY IN ( SELECT SCODE FROM T1) AND DIM_ITEMPOINT ='1200100') THEN ( SELECT SUM(NVL(FACT_B, 0)) FROM DW_FACTFINANCEPOINT WHERE DIM_PERIOD='2017'||'13' AND DIM_ITEMPOINT ='1200100' AND DIM_COMPANY IN ( SELECT SCODE FROM T1)) ELSE ( SELECT SUM(NVL(FACT_B, 0)) AS FACT_B FROM DW_FACTFINANCEPOINT WHERE DIM_PERIOD='201712' AND DIM_ITEMPOINT ='1200100' AND DIM_COMPANY IN ( SELECT SCODE FROM T1)) END)) AS FZSNBNLJ, DIM_COMPANY FROM DW_FACTFINANCEPOINT WHERE DIM_ITEMPOINT ='1200100' AND DIM_COMPANY IN ( SELECT SCODE FROM T1) GROUP BY DIM_COMPANY ) T6 ON T6.DIM_COMPANY = T1.SCODE ) UNION ALL SELECT ASNAME, 0 AS YCWC, 0 AS ZCZJZJE, 0 AS SNBNLJ, 0 AS FZYCWC, 0 AS FZZJZJE, 0 AS FZSNBNLJ, QYYCWC, QYYCWC-QYSNBNLJ AS QYZJZJE, QYSNBNLJ FROM ( SELECT T1.SCODE, T1.ASNAME, T5.QYYCWC, T6.QYSNBNLJ FROM T1 LEFT JOIN ( SELECT DIM_COMPANY, SUM(NVL(FACT_A, 0)) QYYCWC FROM DW_FACTTARGETPREDICT WHERE DIM_PERIOD ='2018'||'06' AND DIM_COMPANY IN ( SELECT SCODE FROM T1) GROUP BY DIM_COMPANY )T5 ON T1.SCODE = T5.DIM_COMPANY LEFT JOIN ( SELECT SUM(( CASE WHEN EXISTS ( SELECT DIM_PERIOD FROM DW_FACTFINANCEPOINT WHERE DIM_PERIOD='2017'||'13' AND DIM_COMPANY IN ( SELECT SCODE FROM T1) AND DIM_ITEMPOINT ='1300100') THEN ( SELECT SUM(NVL(FACT_B, 0)) FROM DW_FACTFINANCEPOINT WHERE DIM_PERIOD='2017'||'13' AND DIM_ITEMPOINT ='1300100' AND DIM_COMPANY IN ( SELECT SCODE FROM T1)) ELSE ( SELECT SUM(NVL(FACT_B, 0)) AS FACT_B FROM DW_FACTFINANCEPOINT WHERE DIM_PERIOD='201712' AND DIM_ITEMPOINT ='1300100' AND DIM_COMPANY IN ( SELECT SCODE FROM T1)) END)) AS QYSNBNLJ, DIM_COMPANY FROM DW_FACTFINANCEPOINT WHERE DIM_ITEMPOINT ='1300100' AND DIM_COMPANY IN ( SELECT SCODE FROM T1) GROUP BY DIM_COMPANY ) T6 ON T6.DIM_COMPANY = T1.SCODE ) ) GROUP BY ASNAME ) T9 ON T8.ASNAME = T9.ASNAME LEFT JOIN DW_DIMINDUSTRY y ON y.sname = T8.ASNAME ORDER BY y.scode",
        "sql": 13,
        "_cube": {
            "cubeId": 4,
            "subject": "1006"
        },
        "mainDim": "itemperiod",
        "needDims": ["year", "month", "company", "conversion"],
        "random": { "min": 100, "max": 100000 },
        "type": 1,
        "generateVar": { //生成变量rows
            "periodCount": 2,
            "compareType": "-1&0",
            "reverse": true
        }
    },
    "columns": [{
            "id": "",
            "type": "string",
            "text": "权益总计预测完成情况",
            "children": [{
                    "id": "qyzjycwc",
                    "type": "decimal",
                    "text": "预测完成",
                    "width": "170px"
                },
                {
                    "id": "",
                    "type": "string",
                    "text": "与年初比较",
                    "children": [{
                            "id": "qyzjzje",
                            "type": "decimal",
                            "text": "增减额",
                            "width": "170px"
                        },
                        {
                            "id": "qyzjzjl",
                            "type": "decimal",
                            "text": "增减率%",
                            "conversion": "%",
                            "width": "150px"
                        }
                    ]
                }
            ]
        },
        {
            "id": "scode",
            "type": "string",
            "hidden": true,
            "text": "编码"
        },
        {
            "id": "asname",
            "type": "string",
            "text": "行业名称",
            "width": "360px"
        },
        {
            "id": "",
            "type": "string",
            "text": "营业收入预测完成情况",
            "children": [{
                    "id": "yysrjyz",
                    "type": "decimal",
                    "text": "当年年考核目标建议值",
                    "width": "170px"
                },
                {
                    "id": "yysrycwc",
                    "type": "decimal",
                    "text": "预测完成",
                    "width": "170px"
                },
                {
                    "id": "yysrwcmb",
                    "type": "decimal",
                    "text": "完成目标进度%",
                    "conversion": "%",
                    "width": "170px"
                },
                {
                    "id": "",
                    "type": "string",
                    "text": "与上年同期比较",
                    "children": [{
                            "id": "yysrsntq",
                            "type": "decimal",
                            "text": "上年同期完成",
                            "width": "170px"
                        },
                        {
                            "id": "yysrzje",
                            "type": "decimal",
                            "text": "增减额",
                            "width": "170px"
                        },
                        {
                            "id": "yysrzjl",
                            "type": "decimal",
                            "text": "增减率%",
                            "conversion": "%",
                            "width": "150px"
                        }
                    ]
                }
            ]
        },
        {
            "id": "",
            "type": "string",
            "text": "利润总额预测完成情况",
            "children": [{
                    "id": "lrzejyz",
                    "type": "decimal",
                    "text": "当年年考核目标建议值",
                    "width": "170px"
                },
                {
                    "id": "lrzeycwc",
                    "type": "decimal",
                    "text": "预测完成",
                    "width": "170px"
                },
                {
                    "id": "lrzewcmb",
                    "type": "decimal",
                    "text": "完成目标进度%",
                    "conversion": "%",
                    "width": "170px"
                },
                {
                    "id": "",
                    "type": "string",
                    "text": "与上年同期比较",
                    "children": [{
                            "id": "lrzesntq",
                            "type": "decimal",
                            "text": "上年同期完成",
                            "width": "170px"
                        },
                        {
                            "id": "lrzezje",
                            "type": "decimal",
                            "text": "增减额",
                            "width": "170px"
                        },
                        {
                            "id": "lrzezjl",
                            "type": "decimal",
                            "text": "增减率%",
                            "conversion": "%",
                            "width": "150px"
                        }
                    ]
                }
            ]
        },
        {
            "id": "",
            "type": "string",
            "text": "资产总计预测完成情况",
            "children": [{
                    "id": "zczeycwc",
                    "type": "decimal",
                    "text": "预测完成",
                    "width": "170px"
                },
                {
                    "id": "",
                    "type": "string",
                    "text": "与年初比较",
                    "children": [{
                            "id": "zczezje",
                            "type": "decimal",
                            "text": "增减额",
                            "width": "170px"
                        },
                        {
                            "id": "zczezjl",
                            "type": "decimal",
                            "text": "增减率%",
                            "conversion": "%",
                            "width": "150px"
                        }
                    ]
                }
            ]
        },
        {
            "id": "",
            "type": "string",
            "text": "负债总计预测完成情况",
            "children": [{
                    "id": "fzzjycwc",
                    "type": "decimal",
                    "text": "预测完成",
                    "width": "170px"
                },
                {
                    "id": "",
                    "type": "string",
                    "text": "与年初比较",
                    "children": [{
                            "id": "fzzjzje",
                            "type": "decimal",
                            "text": "增减额",
                            "width": "170px"
                        },
                        {
                            "id": "fzzjzjl",
                            "type": "decimal",
                            "text": "增减率%",
                            "conversion": "%",
                            "width": "150px"
                        }
                    ]
                }
            ]
        }
    ],
    "rows": [
        // {
        //     "hymc" : "现代农牧渔业"
        // },
        // {
        //     "hymc" : "食品加工业"
        // },
        // {
        //     "hymc" : "食品贸易"
        // },
        // {
        //     "hymc" : "粮油贸易"
        // },
        // {
        //     "hymc" : "冷链仓储"
        // },
        // {
        //     "hymc" : "房地产业"
        // },
        // {
        //     "hymc" : "商品贸易"
        // },
        // {
        //     "hymc" : "钢材贸易"
        // },
        // {
        //     "hymc" : "非食品加工业"
        // },
        // {
        //     "hymc" : "金融业"
        // },
        // {
        //     "hymc" : "服务业"
        // },
        // {
        //     "hymc" : "抵消差额"
        // }

    ],
    "items": [{
        "xtype": "bi-table",
        "id": "jymbycqkhyb",
        "stype": "tree",
        "text": "集团经营目标预测分析情况表",
        "toolbar": [{
            "id": "1",
            "text": "刷新",
            "xtype": "button",
            "cellStyle": {
                "color": "black",
                "background-color": "#189271"
            },
            "handler": function(vue, btn) {
                debugger
                console.log(vue);
                let $vue = vue.item.$vue;
                $vue.closeTabTaget({}, $vue);
                vue.item.updateView("company");
            }
        }, {
            "id": "2",
            "text": "导出",
            "xtype": "button",
            "cellStyle": {
                "color": "black",
                "background-color": "#189271"
            },
            "handler": function(vue, btn) {
                debugger
                console.log(vue);
                vue.handleDownload(vue);
            }
        }]
    }]
}