{
    "id":"0022",
	"text":"二级穿透",
	"layout":{
		"xtype":"column"
	 },
	 "showDims": ["year","month","company","conversion"],
    "children":[
        {
			// "xtype": "STreeGrid",
			"xtype": "elementTree",
			"id": "lrbej",
			"stype": true,
			"isUnfold": true,// 自动展开的配置
			"text": "利润表二级",
			"weight": 24,
			"show":true,
			"config": {
				// "sql2": "SELECT D.SCODE GSBM, D.SNAME GSMC, D.SPCODE AS PID, SUM(NVL(DYSJ, 0)) DYSJ, SUM(NVL(SNTQ, 0)) SNTQ, SUM(NVL(TBZJE, 0)) TBZJE, SUM(NVL(TBZJL, 0)*100) TBZJL, SUM(NVL(LJSJ, 0)) LJSJ, SUM(NVL(SNTQ_1, 0)) SNTQ1, SUM(NVL(TBZJE_1, 0)) TBZJE1, SUM(NVL(TBZJL_1, 0)*100) TBZJL1, SUM(NVL(BNYS, 0)) BNYS, SUM(NVL(CYE, 0)) CYE, SUM(NVL(WCL, 0)*100) WCL FROM(SELECT GSBM, DYSJ, NVL(SNTQ, 0) SNTQ, (DYSJ-NVL(SNTQ, 0)) TBZJE, ( CASE WHEN (NVL(SNTQ, 0))=0 THEN 0 ELSE (DYSJ-SNTQ)/SNTQ END) TBZJL, 0 LJSJ, 0 SNTQ_1, 0 TBZJE_1, 0 TBZJL_1, 0 BNYS, 0 CYE, 0 WCL FROM (SELECT GSBM, SUM(NVL(DYSJ, 0)) DYSJ, SUM(NVL(SNTQ, 0)) SNTQ FROM (SELECT DIM_COMPANY AS GSBM, FACT_A AS DYSJ, 0 AS SNTQ FROM DW_FACTFINANCEPERIOD A WHERE A.DIM_ITEMPERIOD=':itemperiod' AND A.DIM_PERIOD=:period AND DIM_COMPANY=:company UNION ALL SELECT DIM_COMPANY AS GSBM, 0 AS DYSJ, FACT_A AS SNTQ FROM DW_FACTFINANCEPERIOD A WHERE A.DIM_ITEMPERIOD=':itemperiod' AND A.DIM_PERIOD=:comparePeriod AND DIM_COMPANY=:company) GROUP BY GSBM) UNION ALL SELECT GSBM, 0 DYSJ, 0 SNTQ, 0 TBZJE, 0TBZJL, LJSJ, NVL(SNTQ, 0) SNTQ_1, (LJSJ-NVL(SNTQ, 0)) TBZJE_1, ( CASE WHEN (NVL(SNTQ, 0))=0 THEN 0 ELSE (LJSJ-SNTQ)/SNTQ END) TBZJL_1, 0 BNYS, 0 CYE, 0 WCL FROM (SELECT GSBM, SUM(NVL(DYSJ, 0)) LJSJ, SUM(NVL(SNTQ, 0)) SNTQ FROM (SELECT DIM_COMPANY AS GSBM, FACT_B AS DYSJ, 0 AS SNTQ FROM DW_FACTFINANCEPERIOD A WHERE A.DIM_ITEMPERIOD=':itemperiod' AND A.DIM_PERIOD=:period AND DIM_COMPANY=:company UNION ALL SELECT DIM_COMPANY AS GSBM, 0 AS DYSJ, FACT_B AS SNTQ FROM DW_FACTFINANCEPERIOD A WHERE A.DIM_ITEMPERIOD=':itemperiod' AND A.DIM_PERIOD=:comparePeriod AND DIM_COMPANY=:company ) GROUP BY GSBM ) UNION ALL SELECT DIM_COMPANY GSBM, 0 DYSJ, 0 SNTQ, 0 TBZJE, 0 TBZJL, 0 LJSJ, 0 SNTQ_1, 0 TBZJE_1, 0 TBZJL_1, FACT_C BNYS, FACT_B-FACT_C CYE, ( CASE WHEN FACT_C=0 THEN 0 ELSE FACT_B/FACT_C END) WCL FROM DW_FACTFINANCEPERIOD WHERE DIM_ITEMPERIOD=':itemperiod' AND DIM_PERIOD=:period ) H RIGHT JOIN (SELECT SCODE, SPCODE, SNAME FROM DW_DIMCOMPANY WHERE CISDEL='N' AND STYPE<>'R' START WITH SCODE=:company CONNECT BY PRIOR SCODE = SPCODE) D ON D.SCODE = H.GSBM GROUP BY D.SCODE, D.SNAME, D.SPCODE ORDER BY D.SCODE",
				"sql2": "SELECT D.ROOT_SCODE SCODE, D.SNAME GSMC, D.SPCODE AS SPCODE, SUM(NVL(DYSJ, 0)) DYSJ, SUM(NVL(SNTQ, 0)) SNTQ, SUM(NVL(TBZJE, 0)) TBZJE,( CASE WHEN SUM((NVL(SNTQ, 0)))=0 THEN 0 ELSE ROUND(((SUM(DYSJ)-SUM(SNTQ))/SUM(SNTQ))*100,4) END) TBZJL, SUM(NVL(LJSJ, 0)) LJSJ, SUM(NVL(SNTQ_1, 0)) SNTQ1, SUM(NVL(TBZJE_1, 0)) TBZJE1, ( CASE WHEN SUM((NVL(SNTQ_1, 0)))=0 THEN 0 ELSE ROUND(((SUM(LJSJ)-SUM(SNTQ_1))/SUM(SNTQ_1))*100,4) END) TBZJL1, SUM(NVL(BNYS, 0)) BNYS, SUM(NVL(CYE, 0)) CYE, ( CASE WHEN SUM(BNYS)=0 THEN 0 ELSE ROUND((SUM(DYSJ)/SUM(BNYS))*100,4) END) WCL FROM ( SELECT GSBM, DYSJ, NVL(SNTQ, 0) SNTQ, (DYSJ-NVL(SNTQ, 0)) TBZJE, 0 LJSJ, 0 SNTQ_1, 0 TBZJE_1, 0 BNYS, 0 CYE FROM ( SELECT GSBM, SUM(NVL(DYSJ, 0)) DYSJ, SUM(NVL(SNTQ, 0)) SNTQ FROM ( SELECT DIM_COMPANY AS GSBM, FACT_A AS DYSJ, 0 AS SNTQ FROM DW_FACTFINANCEPERIOD A WHERE A.DIM_ITEMPERIOD=':itemperiod' AND A.DIM_PERIOD=:period AND DIM_COMPANY IN ( SELECT SCODE FROM DW_DIMCOMPANY WHERE CISDEL='N' AND STYPE IN ('1', 'R') START WITH SCODE=:company CONNECT BY PRIOR SCODE = SPCODE) UNION ALL SELECT DIM_COMPANY AS GSBM, 0 AS DYSJ, FACT_A AS SNTQ FROM DW_FACTFINANCEPERIOD A WHERE A.DIM_ITEMPERIOD=':itemperiod' AND A.DIM_PERIOD=:comparePeriod AND DIM_COMPANY IN ( SELECT SCODE FROM DW_DIMCOMPANY WHERE CISDEL='N' AND STYPE IN ('1', 'R') START WITH SCODE=:company CONNECT BY PRIOR SCODE = SPCODE)) GROUP BY GSBM) UNION ALL SELECT GSBM, 0 DYSJ, 0 SNTQ, 0 TBZJE, LJSJ, NVL(SNTQ, 0) SNTQ_1, (LJSJ-NVL(SNTQ, 0)) TBZJE_1, 0 BNYS, 0 CYE FROM ( SELECT GSBM, SUM(NVL(DYSJ, 0)) LJSJ, SUM(NVL(SNTQ, 0)) SNTQ FROM ( SELECT DIM_COMPANY AS GSBM, FACT_B AS DYSJ, 0 AS SNTQ FROM DW_FACTFINANCEPERIOD A WHERE A.DIM_ITEMPERIOD=':itemperiod' AND A.DIM_PERIOD=:period AND DIM_COMPANY IN ( SELECT SCODE FROM DW_DIMCOMPANY WHERE CISDEL='N' AND STYPE IN ('1', 'R') START WITH SCODE=:company CONNECT BY PRIOR SCODE = SPCODE) UNION ALL SELECT DIM_COMPANY AS GSBM, 0 AS DYSJ, FACT_B AS SNTQ FROM DW_FACTFINANCEPERIOD A WHERE A.DIM_ITEMPERIOD=':itemperiod' AND A.DIM_PERIOD=:comparePeriod AND DIM_COMPANY IN ( SELECT SCODE FROM DW_DIMCOMPANY WHERE CISDEL='N' AND STYPE IN ('1', 'R') START WITH SCODE=:company CONNECT BY PRIOR SCODE = SPCODE)) GROUP BY GSBM) UNION ALL SELECT DIM_COMPANY GSBM, 0 DYSJ, 0 SNTQ, 0 TBZJE, 0 LJSJ, 0 SNTQ_1, 0 TBZJE_1, FACT_C BNYS, FACT_B-FACT_C CYE FROM DW_FACTFINANCEPERIOD WHERE DIM_ITEMPERIOD=':itemperiod' AND DIM_PERIOD=:period AND DIM_COMPANY IN ( SELECT SCODE FROM DW_DIMCOMPANY WHERE CISDEL='N' AND STYPE IN ('1', 'R') START WITH SCODE=:company CONNECT BY PRIOR SCODE = SPCODE)) H RIGHT JOIN ( SELECT ROOT_SCODE, E.SCODE, F.SNAME, F.SPCODE FROM ( SELECT CONNECT_BY_ROOT(SCODE) ROOT_SCODE, SCODE FROM DW_DIMCOMPANY WHERE CISDEL='N' AND STYPE IN('1', 'R') START WITH SCODE IN ( SELECT scode FROM dw_dimcompany WHERE cisdel = 'N' START WITH scode = :company CONNECT BY prior scode = spcode ) CONNECT BY PRIOR SCODE = SPCODE) E INNER JOIN DW_DIMCOMPANY F ON E.ROOT_SCODE=F.SCODE ) D ON D.SCODE = H.GSBM GROUP BY D.ROOT_SCODE, D.SNAME, D.SPCODE ORDER BY scode",
				"sql":" ",
				"_cube": {
					"subject": "1005",
					"cubeId": 4,
					"dim_item": "1001"
				},
				"generateVar":{
					"periodCount":2,
					 "compareType":"-1&0",
					  "reverse":true
				 },
				"mainDim": "itemperiod",
				"needDims": [
					"year",
					"month",
					"company",
					"conversion"
				],
				"tableHeads":true,
				"random": {
					"min": 100,
					"max": 100000
				},
				"type": 1
			},
				"queryDataBefore":function(params,config,$vue){
					// debugger
					config.sql = config.sql2;
					let len = $vue.items.length;
					let id = $vue.items[len-1].id;
					config.sql = config.sql.replace(/:itemperiod/g, id);
					return params;

				},
				"queryDataAfter":function(data,vue){
					// debugger
					let datas = [];
					// if(data && data.length == 1)return data ; 
					// let is = data.some(res => {
					// 	return (res.dysj &&　res.dysj!=0) || (res.sntq && res.sntq!=0) || (res.tbzje && res.tbzje!=0) || 
					// 	(res.ljsj && res.ljsj!=0) || (res.sntq1 && res.sntq1!=0) || (res.tbzje1 && res.tbzje1!=0)
					// })
					// if(is) {
						
						// data.forEach(item => { // 没有数据的不显示行数据
						// 	if((item.dysj && item.dysj!=0) || (item.sntq && item.sntq!=0) || (item.tbzje && item.tbzje!=0) || 
						// 	(item.ljsj && item.ljsj!=0) || (item.sntq1 && item.sntq1!=0) || (item.tbzje1 && item.tbzje1!=0)||
						// 	(item.cye && item.cye!=0)){
						// 		datas.push(item);
						// 	}
						// });
						if(datas && datas.length>0){
							return datas;
						}else{
							return data;
						}						
					// }else{
						// return data ;
					// }
				},
				// "columns": [
				// 	{
				// 		"id":"xx",
				// 		"type":"string",
				// 		"text":"预算数",
				// 		"children":[
				// 			{
				// 				"id": "bnys",
				// 				"type":"decimal",
				// 				"text": "本年预算"
				// 			},
				// 			{
				// 				"id": "cye",
				// 				"type":"decimal",
				// 				"text": "差异额"
				// 			},
				// 			{
				// 				"id": "wcl",
				// 				"type":"decimal",
				// 				"width": "110",
				// 				"conversion":"%",
				// 				"text": "完成率（%）"
				// 			}
				// 		]
				// 	},
				// 	{
				// 		"id": "",
				// 		"type":"string",
				// 		"text": "",
				// 		"isTree":true
				// 	},
				// 	{
				// 		"id": "gsbm",
				// 		"type":"string",
				// 		"width":"120",
				// 		"fixed":true,
				// 		"text": "公司编码"
				// 	},
				// 	{
				// 		"id": "gsmc",
				// 		"type":"string",
				// 		"width":"330px",
				// 		"fixed":true,
				// 		"text": "公司名称"
				// 	},
				// 	{
				// 		"id":"xx",
				// 		"type":"string",
				// 		"text":"当月数",
				// 		"children":[
				// 			{
				// 				"id": "dysj",
				// 				"type":"decimal",
				// 				"text": "当月实际"
				// 			},
				// 			{
				// 				"id": "sntq",
				// 				"type":"decimal",
				// 				"text": "上年同期"
				// 			},
				// 			{
				// 				"id": "tbzje",
				// 				"type":"decimal",
				// 				"text": "同比增减额"
				// 			},
				// 			{
				// 				"id": "tbzjl",
				// 				"type":"decimal",
				// 				"width": "150px",
				// 				"conversion":"%",
				// 				"text": "同比增减率（%）"
				// 			}
				// 		]
				// 	},
				// 	{
				// 		"id":"xx",
				// 		"type":"string",
				// 		"text":"累计数",
				// 		"children":[
				// 			{
				// 				"id": "ljsj",
				// 				"type":"decimal",
				// 				"text": "累计实际"
				// 			},
				// 			{
				// 				"id": "sntq1",
				// 				"type":"decimal",
				// 				"text": "上年同期"
				// 			},
				// 			{
				// 				"id": "tbzje1",
				// 				"type":"decimal",
				// 				"text": "同比增减额"
				// 			},
				// 			{
				// 				"id": "tbzjl1",
				// 				"type":"decimal",
				// 				"width": "150px",
				// 				"conversion":"%",
				// 				"text": "同比增减率（%）"
				// 			}
				// 		]
				// 	}					
				// ],
				"columns": [
					
					// {
					// 	"id": "",
					// 	"type":"string",
					// 	"text": "",
					// 	"isTree":true
					// },
					{
						"id": "scode",
						"type":"string",
						"width":"180",
						"fixed":true,
						"text": "公司编码"
					},
					{
						"id": "gsmc",
						"type":"string",
						"width":"330px",
						"fixed":true,
						"text": "公司名称"
					},
					{
						"id":"xx",
						"type":"string",
						"text":"当月数",
						"children":[
							{
								"id": "dysj",
								"type":"decimal",
								"width": "160",
								"align": "right",
								"text": "当月实际"
							},
							{
								"id": "sntq",
								"type":"decimal",
								"width": "160",
								"align": "right",
								"text": "上年同期"
							},
							{
								"id": "tbzje",
								"type":"decimal",
								"width": "160",
								"align": "right",
								"text": "同比增减额"
							},
							{
								"id": "tbzjl",
								"type":"decimal",
								"width": "160",
								"align": "right",
								"conversion":"%",
								"text": "同比增减率（%）"
							}
						]
					},
					{
						"id":"xx",
						"type":"string",
						"text":"累计数",
						"children":[
							{
								"id": "ljsj",
								"type":"decimal",
								"width": "160",
								"align": "right",
								"text": "累计实际"
							},
							{
								"id": "sntq1",
								"type":"decimal",
								"width": "160",
								"align": "right",
								"text": "上年同期"
							},
							{
								"id": "tbzje1",
								"type":"decimal",
								"width": "160",
								"align": "right",
								"text": "同比增减额"
							},
							{
								"id": "tbzjl1",
								"type":"decimal",
								"width": "160",
								"align": "right",
								"conversion":"%",
								"text": "同比增减率（%）"
							}
						]
					},
					{
						"id":"xx",
						"type":"string",
						"text":"预算数",
						"children":[
							{
								"id": "bnys",
								"type":"decimal",
								"width": "160",
								"align": "right",
								"text": "本年预算"
							},
							{
								"id": "cye",
								"type":"decimal",
								"width": "160",
								"align": "right",
								"text": "差异额"
							},
							{
								"id": "wcl",
								"type":"decimal",
								"width": "120",
								"align": "right",
								"conversion":"%",
								"text": "完成率（%）"
							}
						]
					}					
				],
				"rows": [
					
				],
				"levelProperties":{gsbm:"_level"} //加缩进 可选 table
				
			}
		
    ]
}