{
    "id": "riskReport",
    "text": "风险报告树表",
    "config": {
        "sql": "SELECT D.ROOT_SCODE GSBM, D.SNAME GSMC, D.SPCODE PID, SUM(NVL(QMYE, 0)) QMYE, SUM(NVL(ZJE, 0)) ZJE,(CASE WHEN SUM(NVL(FACT_A,0))=0 THEN 0 ELSE ROUND((SUM(QMYE)-SUM(FACT_A))*100/SUM(FACT_A), 4) END) AS ZJL, SUM(NVL(SNTQ, 0)) SNTQ, SUM(QMYE-SNTQ) TBZJE, (CASE WHEN SUM(SNTQ)=0 THEN 0 ELSE ROUND((SUM(QMYE-SNTQ)/SUM(SNTQ))*100, 4) END)TBZJL, SUM(NVL(BNYS, 0)) BNYS, SUM(NVL(CYE, 0)) CYE, (CASE WHEN SUM(NVL(BNYS,0))=0 THEN 0 ELSE ROUND(((SUM(QMYE)-SUM(BNYS))*100/SUM(BNYS)), 4) END) AS CYL FROM ((SELECT A.DIM_COMPANY AS GSBM, FACT_A,A.FACT_B AS QMYE, (A.FACT_B-A.FACT_A) AS ZJE, 0 AS SNTQ, 0 AS TBZJE, 0 AS BNYS, 0 AS CYE FROM DW_FACTFINANCEPOINT A, DW_DIMCOMPANY B WHERE A.DIM_COMPANY=B.SCODE AND A.DIM_ITEMPOINT=':dimpoint' AND A.DIM_PERIOD=:period AND DIM_COMPANY IN (SELECT SCODE FROM DW_DIMCOMPANY WHERE CISDEL='N' AND STYPE IN ('1','R') START WITH SCODE=:company CONNECT BY PRIOR SCODE = SPCODE)) UNION ALL (SELECT DIM_COMPANY AS GSBM,0 FACT_A,0 AS QMYE, 0 AS ZJE, FACT_B AS SNTQ, 0 AS TBZJE,0 AS BNYS, 0 AS CYE FROM DW_FACTFINANCEPOINT, DW_DIMCOMPANY B WHERE DIM_COMPANY=B.SCODE AND DIM_ITEMPOINT=':dimpoint' AND DIM_PERIOD=:comparePeriod AND DIM_COMPANY IN (SELECT SCODE FROM DW_DIMCOMPANY WHERE CISDEL='N' AND STYPE IN ('1','R') START WITH SCODE=:company CONNECT BY PRIOR SCODE = SPCODE)) UNION ALL (SELECT DIM_COMPANY AS GSBM,0 FACT_A,0 AS QMYE, 0 AS ZJE,0 AS SNTQ,0 AS TBZJE, FACT_C AS BNYS, (FACT_B-FACT_C) AS CYE FROM DW_FACTFINANCEPOINT, DW_DIMCOMPANY B WHERE DIM_COMPANY=B.SCODE AND DIM_ITEMPOINT=':dimpoint' AND DIM_PERIOD=:period AND DIM_COMPANY IN (SELECT SCODE FROM DW_DIMCOMPANY WHERE CISDEL='N' AND STYPE IN ('1','R') START WITH SCODE=:company CONNECT BY PRIOR SCODE = SPCODE))) H RIGHT JOIN (SELECT ROOT_SCODE,E.SCODE,F.SNAME,F.SPCODE FROM (SELECT CONNECT_BY_ROOT(SCODE) ROOT_SCODE,SCODE FROM DW_DIMCOMPANY WHERE CISDEL='N' AND STYPE IN('1','R') START WITH SCODE in (select scode from dw_dimcompany where cisdel = 'N' start with scode =:company connect by prior scode = spcode) CONNECT BY PRIOR SCODE = SPCODE) E INNER JOIN DW_DIMCOMPANY F ON E.ROOT_SCODE=F.SCODE)D ON D.SCODE = H.GSBM GROUP BY D.ROOT_SCODE,D.SNAME,D.SPCODE ORDER BY GSBM"
    },
    "columns": [
        {
            "id": "gsmc",
            "text": "公司名称",
            "tepe": "string",
            "align": "left",
            "width": "460"
        },
        {
            "id": "bgzt",
            "text": "报告状态",
            "tepe": "string",
            "align": "center",
            "width": "160"
        },
        {
            "id": "sbr",
            "text": "上报人",
            "tepe": "string",
            "align": "center",
            "width": "160"
        },
        {
            "id": "cz",
            "text": "操作"
        }
    ],
    "rows": [
        
    ],
    "items": [
        {
            "id": "riskReport",
            "text": "风险报告树表",
            "index": false, // 是否显示序号
            "isTree": true, // 是否树形
            "toolbar": [
                {
                    "id": 1,
                    "text": "全部展开",
                    "styles":{
                        "marginTop": "10px"
                    },
                    "handler": function(data, btn, $vue){
                        if(data && data.length>0){
                            data.forEach(res => {
                                res._expanded = true ; 
                                if(res.children && res.children.length>0)this.handler(res.children); 
                            });
                        }else{  
                            $vue.$message('暂无数据！');
                        }
                    }
                },
                {
                    "id": 2,
                    "text": "全部收起",
                    "styles":{
                        "marginTop": "10px"
                    },
                    "handler": function(data, btn, $vue){
                        if(data && data.length>0){
                            data.forEach(res => {
                                res._expanded = false ; 
                                if(res.children && res.children.length>0)this.handler(res.children); 
                            });
                        }else{  
                            $vue.$message('暂无数据！');
                        }
                    }
                } 
            ],
            "tableBtn": [
                {
                    "id": 1,
                    "text": "上报",
                    "show": true,
                    "icon": "iconfont icon-tianjiashangbao"
                },
                {
                    "id": 2,
                    "text": "查看",
                    "show": true,
                    "icon": "iconfont icon-chakan-copy",
                    "handler": function(btn, $this){ debugger
                        let params = {
                            year: $this.$store.getters.year,        // 年
                            month:$this.$store.getters.month,       // 月
                            company: $this.$store.getters.company   // 公司
                        }
                        // 子组件向父组件传值
                        $this.$emit("showreportdetailp", params);
                    }
                },
                {
                    "id": 3,
                    "text": "退回",
                    "show": true,
                    "icon": "iconfont icon-tuihui"
                },
                {
                    "id": 4,
                    "text": "催报",
                    "show": true,
                    "icon": "iconfont icon-clock"
                }
            ],
            "queryDataAfter": function(data, $vue){
                // debugger
                data.forEach(res => {
                    if(res.bgzt == "0")res.bgzt = "未上报";
                    if(res.bgzt == "1")res.bgzt = "已上报";
                    if(res.children && res.children.length>0)this.queryDataAfter(res.children);
                });
                return data; 
            },
            "drillProperties": ["bgzt"],
            "cellStyle": function({row, column, rowIndex, columnIndex}, $vue){
                // debugger
                let css = "padding: 4px 0;";
                let pro = column.property;
                let textIndent = "" ;
                if (!pro) {
                    return css;
                }
                let drillProperties = this.drillProperties;
                if (drillProperties.indexOf(pro) != -1) {
                    if(row.bgzt == "已上报"){
                        let drill = "text-decoration: none;color: green;font-weight: bold;";
                        css = css + textIndent + drill;
                        return css;
                    }else{
                        let drill = "text-decoration: none;color: red;font-weight: bold;";
                        css = css + textIndent + drill;
                        return css;
                    }
                    
                }else{
                    return css ;
                }
            }
        }
        
    ]
}