/*!
    *
    * Wijmo Library 5.20191.603
    * http://wijmo.com/
    *
    * Copyright(c) GrapeCity, Inc.  All rights reserved.
    *
    * Licensed under the GrapeCity Commercial License.
    * sales@wijmo.com
    * wijmo.com/products/wijmo-5/license/
    *
    */

var wijmo,__extends=this&&this.__extends||function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(t,o)};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}();!function(e){!function(t){!function(t){t.softInput=function(){return e._getModule("wijmo.input")},t.softXlsx=function(){return e._getModule("wijmo.xlsx")}}(t.sheet||(t.sheet={}))}(e.grid||(e.grid={}))}(wijmo||(wijmo={})),function(e){!function(t){!function(t){"use strict";var o=function(){function o(e,t,o,n,i){if(this._showHeaderRow=!0,this._showTotalRow=!1,this._showBandedColumns=!1,this._showBandedRows=!0,this._alterFirstColumn=!1,this._alterLastColumn=!1,this._orgHeaderCellsContent=[],!t.isValid)throw"The range of this table is invalid.";this._name=e,this._range=t.clone(),this._style=o,null!=n&&n.length>0&&this._pushTableColumns(n),null!=i&&(null!=i.showHeaderRow&&(this._showHeaderRow=i.showHeaderRow),null!=i.showTotalRow&&(this._showTotalRow=i.showTotalRow),null!=i.showBandedColumns&&(this._showBandedColumns=i.showBandedColumns),null!=i.showBandedRows&&(this._showBandedRows=i.showBandedRows),null!=i.alterFirstColumn&&(this._alterFirstColumn=i.alterFirstColumn),null!=i.alterLastColumn&&(this._alterLastColumn=i.alterLastColumn))}return Object.defineProperty(o.prototype,"name",{get:function(){return this._name},set:function(e){var o,n;if(null==e||""===e)throw"The name of the Table should not be empty.";this._name.toLowerCase()!==e.toLowerCase()&&(n=this._name,this._name=e,this._owner&&(!this._owner._isUndoing&&this._owner.undoStack.stackSize>0&&(o=new t._TableSettingAction(this._owner,this)),this._owner._updateFormulasWithNameUpdating(n,e,!0),o&&(o.saveNewState(),this._owner.undoStack._addAction(o),o=null)))},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"sheet",{get:function(){return this._sheet},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"style",{get:function(){return this._style},set:function(e){var o;e.name!==this._style.name&&(this._owner&&!this._owner._isUndoing&&this._owner.undoStack.stackSize>0&&(o=new t._TableSettingAction(this._owner,this)),this._style=e,this._owner&&(o&&(o.saveNewState(),this._owner.undoStack._addAction(o),o=null),this._owner.refresh()))},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"showHeaderRow",{get:function(){return this._showHeaderRow},set:function(e){var o,n;if(e!==this._showHeaderRow&&(this._owner&&!this._owner._isUndoing&&this._owner.undoStack.stackSize>0&&(o=new t._TableSettingAction(this._owner,this)),n=this._showHeaderRow,this._showHeaderRow=e,this._owner))try{this._owner.beginUpdate(),this._adjustTableRangeWithHeaderRow(),o&&(o.saveNewState(),this._owner.undoStack._addAction(o))}catch(e){throw this._showHeaderRow=n,e}finally{o=null,this._owner.endUpdate()}},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"showTotalRow",{get:function(){return this._showTotalRow},set:function(e){var o,n;if(e!==this._showTotalRow&&(this._owner&&!this._owner._isUndoing&&this._owner.undoStack.stackSize>0&&(o=new t._TableSettingAction(this._owner,this)),n=this._showTotalRow,this._showTotalRow=e,this._owner))try{this._owner.beginUpdate(),this._adjustTableRangeWithTotalRow(),o&&(o.saveNewState(),this._owner.undoStack._addAction(o))}catch(e){throw this._showTotalRow=n,e}finally{o=null,this._owner.endUpdate()}},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"showBandedColumns",{get:function(){return this._showBandedColumns},set:function(e){var o;e!==this._showBandedColumns&&(this._owner&&!this._owner._isUndoing&&this._owner.undoStack.stackSize>0&&(o=new t._TableSettingAction(this._owner,this)),this._showBandedColumns=e,this._owner&&(o&&(o.saveNewState(),this._owner.undoStack._addAction(o),o=null),this._owner.refresh()))},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"showBandedRows",{get:function(){return this._showBandedRows},set:function(e){var o;e!==this._showBandedRows&&(this._owner&&!this._owner._isUndoing&&this._owner.undoStack.stackSize>0&&(o=new t._TableSettingAction(this._owner,this)),this._showBandedRows=e,this._owner&&(o&&(o.saveNewState(),this._owner.undoStack._addAction(o),o=null),this._owner.refresh()))},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"alterFirstColumn",{get:function(){return this._alterFirstColumn},set:function(e){var o;e!==this._alterFirstColumn&&(this._owner&&!this._owner._isUndoing&&this._owner.undoStack.stackSize>0&&(o=new t._TableSettingAction(this._owner,this)),this._alterFirstColumn=e,this._owner&&(o&&(o.saveNewState(),this._owner.undoStack._addAction(o),o=null),this._owner.refresh()))},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"alterLastColumn",{get:function(){return this._alterLastColumn},set:function(e){var o;e!==this._alterLastColumn&&(this._owner&&!this._owner._isUndoing&&this._owner.undoStack.stackSize>0&&(o=new t._TableSettingAction(this._owner,this)),this._alterLastColumn=e,this._owner&&(o&&(o.saveNewState(),this._owner.undoStack._addAction(o),o=null),this._owner.refresh()))},enumerable:!0,configurable:!0}),o.prototype.getRange=function(e,t){var o;switch(void 0===e&&(e=i.All),e){case i.Data:o=this._getDataRange();break;case i.Header:o=this._getHeaderRange();break;case i.Footer:o=this._getFooterRange();break;default:o=this._range.clone()}if(null!=t&&o){var n=this._getColumnIndex(t);if(null==n)return null;o.col=o.col2=o.leftCol+n}return o},o.prototype.getColumns=function(){return this._columns?this._columns.slice():[]},o.prototype.insertRows=function(t,o,n){void 0===n&&(n=!0);var i,l,s,r,a,h=this.getRange(),d=!1;if(null==o&&(o=1),!e.isInt(o)||o<1)return!1;if(0===t&&this._showHeaderRow||t===this._range.rowSpan-1&&this._showTotalRow||t<0||t>=this._range.rowSpan)return!1;if(this._owner){if(this._owner.beginUpdate(),r=this._sheet===this._owner.selectedSheet?this._owner:this._sheet.grid,n){if(s=new e.grid.CellRange(h.bottomRow+1,h.col,h.bottomRow+1,h.col2),this._sheet._canShiftCells(s)){if(i=this._sheet._needAddRowCountForInsertTableRows(o,h),r.collectionView){for(a=r.itemsSource instanceof e.collections.CollectionView,r.collectionView.beginUpdate(),l=0;l<i;l++)a?r.itemsSource.sourceCollection.push({}):r.itemsSource.push({});r.collectionView.endUpdate()}else for(l=0;l<i;l++)r.rows.push(new e.grid.Row);this._sheet._moveDownCells(o,s),d=!0}}else this._canInsertRowsWithoutShift(o)&&(d=!0);d&&(this._sheet._moveDownCellsWithinTable(t,o,h),this._updateTableRange(0,o,0,0)),this._owner.endUpdate()}else this._updateTableRange(0,o,0,0),d=!0;return d},o.prototype.deleteRows=function(t,o,n){void 0===n&&(n=!0);var i,l=!1,s=this.getRange();null==o&&(o=1),!e.isInt(o)||o<1||0===t&&this._showHeaderRow||t===this._range.rowSpan-1&&this._showTotalRow||t<0||t>=this._range.rowSpan||t+o>this._range.rowSpan-(this._showTotalRow?1:0)||(this._owner?(this._owner.beginUpdate(),n?(i=new e.grid.CellRange(s.bottomRow+1,s.col,s.bottomRow+1,s.col2),this._sheet._canShiftCells(i)&&(l=!0)):l=!0,l&&(this._sheet._moveUpCellsWithinTable(t,o,s),n&&this._sheet._moveUpCells(o,i),this._updateTableRange(0,-o,0,0)),this._owner.endUpdate()):this._updateTableRange(0,-o,0,0))},o.prototype._addColumn=function(e,t){var o,i=this.getRange();if(e<=0||e>this._columns.length)throw"The column index is out of range.";t=this._getUniqueColumnName(e,t),(o=new n(t))._attach(this),this._columns.splice(e,0,o),this.showHeaderRow&&this._owner&&this._sheet&&(this._sheet===this._owner.selectedSheet?this._owner:this._sheet.grid).setCellData(i.topRow,i.leftCol+e,t)},o.prototype._updateCell=function(e,t,o){var n,i=e-this._range.topRow,l=t-this._range.leftCol;null!=this._style&&(n=this._getTableCellAppliedStyles(i,l),this._applyStylesForCell(n,o))},o.prototype._updateTableRange=function(e,t,o,n){this._range.row<=this._range.row2?(this._range.row+=e,this._range.row2+=t):(this._range.row2+=e,this._range.row+=t),this._range.col<=this._range.col2?(this._range.col+=o,this._range.col2+=n):(this._range.col2+=o,this._range.col+=n)},o.prototype._setTableRange=function(e,t){var o;if(this._range=e,null!=t)for(this._columns.splice(0,this._columns.length),o=0;o<t.length;o++)this._columns.push(t[o])},o.prototype._updateColumnName=function(e,t){var o=this._columns[e];t=this._getUniqueColumnName(null,t),o.name=t,this._showHeaderRow&&this._owner&&this._sheet&&(this._sheet===this._owner.selectedSheet?this._owner:this._sheet.grid).setCellData(this._range.topRow,this._range.leftCol+e,t)},o.prototype._updateColumnTotalRowContent=function(e,t){var o,n;null==t&&(t=this._columns.indexOf(e)),t<0||(e.totalRowFunction?n=null!=(o=this._getSubtotalFunction(e.totalRowFunction.toLowerCase()))?"=subtotal("+o+",["+e.name+"])":"="===e.totalRowFunction[0]?e.totalRowFunction:"="+e.totalRowFunction:0===t?(e.totalRowLabel||(e.totalRowLabel="Total"),n=e.totalRowLabel):n=e.totalRowLabel,this._owner&&this._sheet&&(this._sheet===this._owner.selectedSheet?this._owner:this._sheet.grid).setCellData(this._range.bottomRow,this._range.leftCol+t,n,!1))},o.prototype._attachSheet=function(e){var t=this.getRange();if(!(this._sheet&&this._owner||(this._sheet=e,this._owner=e._owner,null==this._owner))){if(this._owner._containsMergedCells(this._range,e))throw"Table does not allow the merged cell within the table.";null==this._style&&(this._style=this._owner.getBuiltInTableStyle("TableStyleMedium9")),null!=this._columns&&0!==this._columns.length||this._generateColumns(this._showHeaderRow);try{this._owner.beginUpdate(),this._showHeaderRow&&1===t.rowSpan&&this._adjustTableRangeWithHeaderRow(),this._showTotalRow&&this._updateTotalRow()}finally{this._owner.endUpdate()}}},o.prototype._detachSheet=function(){this._sheet=null,this._owner=null},o.prototype._pushTableColumns=function(e){var t,o;for(this._columns=[],o=0;o<e.length;o++)(t=e[o])._attach(this),this._columns.push(t)},o.prototype._generateColumns=function(t){var o,i,l,s,r,a=this._sheet===this._owner.selectedSheet?this._owner:this._sheet.grid;if(!this._range.isValid)throw"The range of the table is invalid.";this._columns=[];for(var h=0;h<this._range.columnSpan;h++)s=this._sheet.grid.columns[this._range.leftCol+h],r=this._range.topRow*this._sheet.grid.columns.length+this._range.leftCol+h,1===this._range.rowSpan?o=this._getUniqueColumnName(h+1):(null==(o=this._sheet.grid.getCellData(this._range.topRow,this._range.leftCol+h,!1))&&(o=""),e.isString(o)&&"="===o[0]&&(o=this._owner.evaluate(o,"",this._sheet,!1)),l=this._sheet._styledCells[r],o=this._owner._formatEvaluatedResult(o,s,l?l.format:""),o=this._getUniqueColumnName(h+1,o.toString())),t&&this._range.rowSpan>1&&(this._orgHeaderCellsContent[h]=this._sheet.grid.getCellData(this._range.topRow,this._range.leftCol+h,!1),isNaN(+o)||s.format||l&&l.format||(l?l.format="@":this._sheet._styledCells[r]={format:"@"}),a.setCellData(this._range.topRow,this._range.leftCol+h,o,!1)),(i=new n(o))._attach(this),0===h?i._totalRowLabel="Total":h===this._range.columnSpan-1&&(i._totalRowFunction="Sum"),this._columns.push(i)},o.prototype._getTableCellAppliedStyles=function(e,t){var o,n={},i=!1,l=!1,s=0;return this._showHeaderRow&&(s=1),this._showHeaderRow&&0===e?i=!0:this._showTotalRow&&e===this._range.rowSpan-1&&(l=!0),this._extendStyle(n,this._style.wholeTableStyle,e,t,i,l),i||l||(!this._showBandedColumns||null==this._style.firstBandedColumnStyle&&null==this._style.secondBandedColumnStyle||(t%((o=this._style.firstBandedColumnStyle?null==this._style.firstBandedColumnStyle.size?1:this._style.firstBandedColumnStyle.size:1)+(this._style.secondBandedColumnStyle?null==this._style.secondBandedColumnStyle.size?1:this._style.secondBandedColumnStyle.size:1))>=o?this._style.secondBandedColumnStyle&&this._extendStyle(n,this._style.secondBandedRowStyle,e,t,i,l):this._style.firstBandedColumnStyle&&this._extendStyle(n,this._style.firstBandedColumnStyle,e,t,i,l)),!this._showBandedRows||null==this._style.firstBandedRowStyle&&null==this._style.secondBandedRowStyle||((e-s)%((o=this._style.firstBandedRowStyle?null==this._style.firstBandedRowStyle.size?1:this._style.firstBandedRowStyle.size:1)+(this._style.secondBandedRowStyle?null==this._style.secondBandedRowStyle.size?1:this._style.secondBandedRowStyle.size:1))>=o?this._style.secondBandedRowStyle&&this._extendStyle(n,this._style.secondBandedRowStyle,e,t,i,l):this._style.firstBandedRowStyle&&this._extendStyle(n,this._style.firstBandedRowStyle,e,t,i,l))),this._alterLastColumn&&t===this._range.columnSpan-1&&this._style.lastColumnStyle&&this._extendStyle(n,this._style.lastColumnStyle,e,t,i,l),this._alterFirstColumn&&0===t&&this._style.firstColumnStyle&&this._extendStyle(n,this._style.firstColumnStyle,e,t,i,l),i?(this._style.headerRowStyle&&this._extendStyle(n,this._style.headerRowStyle,e,t,i,l),t===this._range.columnSpan-1&&this._style.lastHeaderCellStyle&&this._extendStyle(n,this._style.lastHeaderCellStyle,e,t,i,l),0===t&&this._style.firstHeaderCellStyle&&this._extendStyle(n,this._style.firstHeaderCellStyle,e,t,i,l)):l&&(this._style.totalRowStyle&&this._extendStyle(n,this._style.totalRowStyle,e,t,i,l),t===this._range.columnSpan-1&&this._style.lastTotalCellStyle&&this._extendStyle(n,this._style.lastTotalCellStyle,e,t,i,l),0===t&&this._style.firstTotalCellStyle&&this._extendStyle(n,this._style.firstTotalCellStyle,e,t,i,l)),n},o.prototype._applyStylesForCell=function(e,t){var o,n=t.style;for(var i in e)(o=e[i])&&(n[i]=o)},o.prototype._extendStyle=function(e,t,o,n,i,l){var s;for(var r in t)null!==(s=t[r])&&(r.indexOf("borderTop")>-1?(0===o||l)&&(e[r]=s):r.indexOf("borderBottom")>-1?(o===this._range.rowSpan-1||i)&&(e[r]=s):r.indexOf("borderLeft")>-1?0===n&&(e[r]=s):r.indexOf("borderRight")>-1?n===this._range.columnSpan-1&&(e[r]=s):r.indexOf("borderHorizontal")>-1?o<this._range.rowSpan-1&&("borderHorizontalStyle"===r?e.borderBottomStyle=s:"borderHorizontalWidth"===r?e.borderBottomWidth=s:e.borderBottomColor=s):r.indexOf("borderVertical")>-1?n<this._range.columnSpan-1&&("borderVerticalStyle"===r?e.borderRightStyle=s:"borderVerticalWidth"===r?e.borderRightWidth=s:e.borderRightColor=s):e[r]=s)},o.prototype._getSubtotalFunction=function(e){switch(e){case"average":return"101";case"countnums":return"102";case"count":return"103";case"max":return"104";case"min":return"105";case"stddev":return"107";case"sum":return"109";case"var":return"110"}return null},o.prototype._checkColumnNameExist=function(e){var t,o=this.getColumns();for(t=0;t<o.length;t++)if(o[t].name.toLowerCase()===e.toLowerCase())return!0;return!1},o.prototype._adjustTableRangeWithHeaderRow=function(){var t,o,n,i,l=this._sheet===this._owner.selectedSheet?this._owner:this._sheet.grid;if(this._showHeaderRow){if(this._sheet._needMoveDownTable(this)){if(n=this.getRange(),i=new e.grid.CellRange(n.bottomRow+1,n.col,n.bottomRow+1,n.col2),!this._sheet._canShiftCells(i))throw"The operation is not allowed.  The operation is attempting to shift the cells in a table or a merged cell on the current sheet.";1===this._sheet._needAddRowCountForInsertTableRows(1,n)&&(l.collectionView?(l.collectionView.beginUpdate(),l.itemsSource instanceof e.collections.CollectionView?l.itemsSource.sourceCollection.push({}):l.itemsSource.push({}),l.collectionView.endUpdate()):l.rows.push(new e.grid.Row)),this._sheet._moveDownCells(1,i),this._sheet._moveDownTable(this)}for(this._range.row<=this._range.row2?this._range.row-=1:this._range.row2-=1,t=0;t<this._columns.length;t++)o=this._columns[t],this._orgHeaderCellsContent[t]=l.getCellData(this._range.topRow,this._range.leftCol+t,!1),l.setCellData(this._range.topRow,this._range.leftCol+t,o.name)}else{for(t=this._range.leftCol;t<=this._range.rightCol;t++)l.setCellData(this._range.topRow,t,"");this._range.row<=this._range.row2?this._range.row+=1:this._range.row2+=1}},o.prototype._adjustTableRangeWithTotalRow=function(){var t,o,n,i=this._sheet===this._owner.selectedSheet?this._owner:this._sheet.grid;if(o=this.getRange(),n=new e.grid.CellRange(o.bottomRow+1,o.col,o.bottomRow+1,o.col2),this._showTotalRow){if(this._sheet._canShiftCells(n))1===this._sheet._needAddRowCountForInsertTableRows(1,o)&&(i.collectionView?(i.collectionView.beginUpdate(),i.itemsSource instanceof e.collections.CollectionView?i.itemsSource.sourceCollection.push({}):i.itemsSource.push({}),i.collectionView.endUpdate()):i.rows.push(new e.grid.Row)),this._sheet._moveDownCells(1,n),this._owner._updateAffectedFormula(this._range.bottomRow+1,1,!0,!0,this.getRange());else if(!this._beneathRowIsEmpty())throw"The operation is not allowed.  The operation is attempting to shift the cells in a table or a merged cell on the current sheet.";this._range.row<=this._range.row2?this._range.row2+=1:this._range.row+=1,this._updateTotalRow()}else{for(t=this._range.leftCol;t<=this._range.rightCol;t++)i.setCellData(this._range.bottomRow,t,"");this._sheet._canShiftCells(n)&&(this._owner._updateAffectedFormula(this._range.bottomRow,1,!1,!0,this.getRange()),this._sheet._moveUpCells(1,n)),this._range.row<=this._range.row2?this._range.row2-=1:this._range.row-=1}},o.prototype._updateTotalRow=function(){var e;if(this.showTotalRow)for(var t=0;t<this._columns.length;t++)e=this._columns[t],this._updateColumnTotalRowContent(e,t)},o.prototype._getUniqueColumnName=function(e,t){var o,n=1;if(null!=t&&""!==t||(t="Column"+e),this._checkColumnNameExist(t)){for(o=t+n;this._checkColumnNameExist(o);)o=t+ ++n;t=o}return t},o.prototype._moveColumns=function(e,t){if(this._columns){var o=this._columns[e];this._columns.splice(e,1),t<0&&(t=this._columns.length),this._columns.splice(t,0,o)}},o.prototype._canInsertRowsWithoutShift=function(e){var t,o,n,i,l,s=this._sheet===this._owner.selectedSheet?this._owner:this._sheet.grid;if(this._range.bottomRow+e>=s.rows.length)return!1;for(t=1;t<=e;t++)for(o=this._range.bottomRow+t,n=this._range.leftCol;n<=this._range.rightCol;n++)if(i=s.getCellData(o,n,!1),l=this._sheet.getCellStyle(o,n),null!=i&&""!==i||null!=l)return!1;return!0},o.prototype._beneathRowIsEmpty=function(){var e,t,o,n=this._range.bottomRow+1,i=this._sheet===this._owner.selectedSheet?this._owner:this._sheet.grid;if(n>=i.rows.length)return!1;for(e=this._range.leftCol;e<=this._range.rightCol;e++){if(null!=(t=i.getCellData(this._range.bottomRow+1,e,!1))&&""!==t)return!1;if(null!=this._sheet.getCellStyle(this._range.bottomRow+1,e))return!1;if(null!=this._sheet.findTable(n,e))return null;if(o=n*i.columns.length+e,null!=this._sheet._mergedRanges[o])return!1}return!0},o.prototype._getDataRange=function(){var t=this._range.topRow,o=this._range.bottomRow;return this._showHeaderRow&&(t+=1),this._showTotalRow&&(o-=1),new e.grid.CellRange(t,this._range.leftCol,o,this._range.rightCol)},o.prototype._getHeaderRange=function(){return this._showHeaderRow?new e.grid.CellRange(this._range.topRow,this._range.leftCol,this._range.topRow,this._range.rightCol):null},o.prototype._getFooterRange=function(){return this._showTotalRow?new e.grid.CellRange(this._range.bottomRow,this._range.leftCol,this._range.bottomRow,this._range.rightCol):null},o.prototype._getColumnIndex=function(t){var o,i,l;if(e.isInt(t)&&t>=0&&t<this._columns.length)o=t;else{t instanceof n?i=t.name.toLowerCase():e.isString(t)&&""!==t&&(i=t.toLowerCase()),l=this.getColumns();for(var s=0;s<l.length;s++)if(l[s].name.toLowerCase()===i){o=s;break}}return o},o}();t.Table=o;var n=function(){function e(e,t,o,n){void 0===n&&(n=!0),this._name=e,this._totalRowLabel=t,this._totalRowFunction=o,null!=n&&(this._showFilterButton=n)}return Object.defineProperty(e.prototype,"table",{get:function(){return this._table},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"name",{get:function(){return this._name},set:function(e){e!==this._name&&(this._name=e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"totalRowLabel",{get:function(){return this._totalRowLabel},set:function(e){e!==this._totalRowLabel&&(this._totalRowLabel=e,this._updateTableTotalInfo())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"totalRowFunction",{get:function(){return this._totalRowFunction},set:function(e){e!==this._totalRowFunction&&(this._totalRowFunction=e,this._updateTableTotalInfo())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"showFilterButton",{get:function(){return this._showFilterButton},set:function(e){this._showFilterButton!==e&&(this._showFilterButton=e)},enumerable:!0,configurable:!0}),e.prototype._attach=function(e){this._table=e},e.prototype._updateTableTotalInfo=function(){this._table&&this._table.showTotalRow&&(this._table._updateColumnTotalRowContent(this),this._table._owner&&this._table._owner.refresh())},e}();t.TableColumn=n;var i,l=function(){function e(e,t){void 0===t&&(t=!1),this._name=e,this._isBuiltIn=t}return Object.defineProperty(e.prototype,"name",{get:function(){return this._name},set:function(e){e!==this._name&&(this._name=e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"wholeTableStyle",{get:function(){return this._wholeTableStyle},set:function(e){this._wholeTableStyle=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"firstBandedColumnStyle",{get:function(){return this._firstBandedColumnStyle},set:function(e){this._firstBandedColumnStyle=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"secondBandedColumnStyle",{get:function(){return this._secondBandedColumnStyle},set:function(e){this._secondBandedColumnStyle=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"firstBandedRowStyle",{get:function(){return this._firstBandedRowStyle},set:function(e){this._firstBandedRowStyle=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"secondBandedRowStyle",{get:function(){return this._secondBandedRowStyle},set:function(e){this._secondBandedRowStyle=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"firstColumnStyle",{get:function(){return this._firstColumnStyle},set:function(e){this._firstColumnStyle=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"lastColumnStyle",{get:function(){return this._lastColumnStyle},set:function(e){this._lastColumnStyle=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"headerRowStyle",{get:function(){return this._headerRowStyle},set:function(e){this._headerRowStyle=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"totalRowStyle",{get:function(){return this._totalRowStyle},set:function(e){this._totalRowStyle=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"firstHeaderCellStyle",{get:function(){return this._firstHeaderCellStyle},set:function(e){this._firstHeaderCellStyle=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"lastHeaderCellStyle",{get:function(){return this._lastHeaderCellStyle},set:function(e){this._lastHeaderCellStyle=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"firstTotalCellStyle",{get:function(){return this._firstTotalCellStyle},set:function(e){this._firstTotalCellStyle=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"lastTotalCellStyle",{get:function(){return this._lastTotalCellStyle},set:function(e){this._lastTotalCellStyle=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isBuiltIn",{get:function(){return this._isBuiltIn},enumerable:!0,configurable:!0}),e}();t.TableStyle=l,function(e){e[e.All=0]="All",e[e.Data=1]="Data",e[e.Header=2]="Header",e[e.Footer=3]="Footer"}(i=t.TableSection||(t.TableSection={}))}(t.sheet||(t.sheet={}))}(e.grid||(e.grid={}))}(wijmo||(wijmo={})),function(e){!function(t){!function(t){"use strict";var o=function(){function e(e){this._owner=e,this._sheetIndex=e.selectedSheetIndex}return Object.defineProperty(e.prototype,"sheetIndex",{get:function(){return this._sheetIndex},enumerable:!0,configurable:!0}),e.prototype.undo=function(){throw"This abstract method must be overridden."},e.prototype.redo=function(){throw"This abstract method must be overridden."},e.prototype.saveNewState=function(){throw"This abstract method must be overridden."},e}();t._UndoAction=o;var n=function(e){function t(t,o){var n=e.call(this,t)||this;return n._isPaste=!1,n._selections=o?[o]:t.selectedSheet.selectionRanges.length>0?t.selectedSheet.selectionRanges.slice():[t.selection.clone()],n._mergeAction=new h(t),n._cellStyleAction=new a(t),n._saveValues(!0),n}return __extends(t,e),Object.defineProperty(t.prototype,"isPaste",{get:function(){return this._isPaste},enumerable:!0,configurable:!0}),t.prototype.undo=function(){this._handleUndoRedo(!0)},t.prototype.redo=function(){this._handleUndoRedo(!1)},t.prototype.saveNewState=function(){return!!this._saveValues(!1)&&(this._mergeAction.saveNewState(),this._cellStyleAction.saveNewState(),this._checkActionState())},t.prototype.markIsPaste=function(){this._isPaste=!0},t.prototype.updateForPasting=function(e){var t=this._selections[this._selections.length-1],o=this._owner.getCellData(e.row,e.col,!!this._owner.columns[e.col].dataMap);t||(t=this._owner.selection,this._selections=[t]),o=null==o?"":o,this._oldValues["r"+e.row+"_c"+e.col]={row:e.row,col:e.col,value:o},t.row=Math.min(t.topRow,e.topRow),t.row2=Math.max(t.bottomRow,e.bottomRow),t.col=Math.min(t.leftCol,e.leftCol),t.col2=Math.max(t.rightCol,e.rightCol)},t.prototype._storeDeletedTables=function(e){null==this._deletedTables&&(this._deletedTables=[]),this._deletedTables.push(e)},t.prototype._checkActionState=function(){var e=this,t=!1;return Object.keys(e._oldValues).forEach(function(o){var n,i;t||(n=e._oldValues[o],i=e._newValues[o],n&&i&&n.value!==i.value&&(t=!0))}),t||e._mergeAction._checkActionState()||e._cellStyleAction._checkActionState()},t.prototype._saveValues=function(e){var t,o,n,i,l,s,r={};for(t=0;t<this._selections.length;t++)for(i=(o=this._selections[t]).topRow;i<=o.bottomRow;i++)for(l=o.leftCol;l<=o.rightCol;l++){if(!(n=this._owner.columns[l]))return!1;s=null==(s=this._owner.getCellData(i,l,!!n.dataMap))?"":s,r["r"+i+"_c"+l]={row:i,col:l,value:s}}return e?this._oldValues=r:this._newValues=r,!0},t.prototype._handleUndoRedo=function(e){var t=this;t._owner._clearCalcEngine(),t._owner.selectedSheet.selectionRanges.clear(),t._owner.deferUpdate(function(){var o,n,i,l,s,r,a,h=e?t._oldValues:t._newValues;if(t._deletedTables&&t._deletedTables.length>0)for(o=0;o<t._deletedTables.length;o++)n=t._deletedTables[o],e?t._owner.selectedSheet.tables.push(n):t._owner.selectedSheet.tables.remove(n);for(i=0;i<t._selections.length;i++)l=t._selections[i],t._owner.selectedSheet.selectionRanges.push(l);if(Object.keys(h).forEach(function(e){var o=h[e];t._owner.setCellData(o.row,o.col,o.value)}),t._affectedFormulas&&(s=e?t._affectedFormulas.oldFormulas:t._affectedFormulas.newFormulas),s&&s.length>0)for(a=0;a<s.length;a++)r=s[a],t._owner.setCellData(r.point.x,r.point.y,r.formula);e?(t._mergeAction.undo(),t._cellStyleAction.undo()):(t._mergeAction.redo(),t._cellStyleAction.redo()),t._owner.refresh(!1)})},t}(o);t._EditAction=n;var i=function(e){function t(t,o,n){var i=e.call(this,t)||this;return i._panel=o,i._colIndex=n,i._oldColWidth=o.columns[n].width,i}return __extends(t,e),t.prototype.undo=function(){this._handleUndoRedo(!0)},t.prototype.redo=function(){this._handleUndoRedo(!1)},t.prototype.saveNewState=function(){return this._newColWidth=this._panel.columns[this._colIndex].width,this._oldColWidth!==this._newColWidth},t.prototype._handleUndoRedo=function(e){var t=this._panel.columns[this._colIndex];t&&(t.width=e?this._oldColWidth:this._newColWidth)},t}(o);t._ColumnResizeAction=i;var l=function(e){function t(t,o,n){var i=e.call(this,t)||this;return i._panel=o,i._rowIndex=n,i._oldRowHeight=o.rows[n].height,i}return __extends(t,e),t.prototype.undo=function(){this._handleUndoRedo(!0)},t.prototype.redo=function(){this._handleUndoRedo(!1)},t.prototype.saveNewState=function(){return this._newRowHeight=this._panel.rows[this._rowIndex].height,this._oldRowHeight!==this._newRowHeight},t.prototype._handleUndoRedo=function(e){var t=this._panel.rows[this._rowIndex];t&&(t.height=e?this._oldRowHeight:this._newRowHeight)},t}(o);t._RowResizeAction=l;var s=function(e){function t(t,o,n,i){var l=e.call(this,t)||this;return l._columnIndex=o,l._count=n,l._isAdding=i,l._saveValues(!0),l}return __extends(t,e),t.prototype.undo=function(){this._handleUndoRedo(!0)},t.prototype.redo=function(){this._handleUndoRedo(!1)},t.prototype.saveNewState=function(){return this._saveValues(!1),!0},t.prototype._saveValues=function(e){var t,o,n,i,l=[],s=[];if(null==this._isAdding)for(t=0;t<this._owner.columns.length;t++)l.push(this._owner.columns[t]);else if(e&&!this._isAdding||!e&&this._isAdding)for(t=this._columnIndex;t<this._columnIndex+this._count&&t<this._owner.columns.length;t++)l.push(this._owner.columns[t]);if(this._owner.selectedSheet.tables&&this._owner.selectedSheet.tables.length>0)for(o=0;o<this._owner.selectedSheet.tables.length;o++)(n=this._owner.selectedSheet.tables[o])&&n.sheet.name===this._owner.selectedSheet.name&&s.push({name:n.name,range:n.getRange(),columns:n.getColumns()});i={columns:l,sortList:this._owner.sortManager._cloneSortList(this._owner.sortManager._committedList),styledCells:this._owner.selectedSheet?this._owner._cloneObject(this._owner.selectedSheet._styledCells):null,mergedCells:this._owner.selectedSheet?this._owner.selectedSheet._cloneMergedCells():null,tableRanges:s,selection:this._owner.selection,filterDef:this._owner.selectedSheet._filterDefinition},e?this._oldValue=i:this._newValue=i},t.prototype._handleUndoRedo=function(e){var t,o,n,i,l,s,r,a,h,d,c,u,_=this,g=e?_._oldValue:_._newValue;_._owner.selectedSheet&&(_._owner.deferUpdate(function(){var f;if(_._owner._isUndoing=!0,_._owner._clearCalcEngine(),_._owner.finishEditing(),null==_._isAdding&&(_._owner.columns.clear(),_._columnIndex=0),_._owner.selectedSheet._styledCells=null,_._owner.selectedSheet._mergedRanges.length=0,_._owner.columns.beginUpdate(),g.columns&&g.columns.length>0)for(t=0;t<g.columns.length;t++)(o=g.columns[t])&&o.isVisible&&(_._owner.columns.insert(_._columnIndex+t,o),_._owner.itemsSource&&(f=_._owner.allowAddNew&&_._owner.newRowAtTop?_._owner.rows[1]:_._owner.rows[0])&&(f._ubv||(f._ubv={}),f._ubv[o._hash]=o.header));else for(t=_._columnIndex+_._count-1;t>=_._columnIndex;t--)(o=_._owner.columns[t])&&o.isVisible&&_._owner.columns.removeAt(t);for(_._owner.columns.endUpdate(),_._owner.selectedSheet._styledCells=_._owner._cloneObject(g.styledCells),u=0;u<g.mergedCells.length;u++)_._owner.selectedSheet._mergedRanges[u]=g.mergedCells[u];for(i=0;i<g.tableRanges.length;i++)l=g.tableRanges[i],(s=_._owner._getTable(l.name))&&s._setTableRange(l.range,l.columns);if(_._affectedFormulas&&(a=e?_._affectedFormulas.oldFormulas:_._affectedFormulas.newFormulas),a&&a.length>0)for(n=0;n<a.length;n++)null!=(r=a[n]).point?r.sheet.name===_._owner.selectedSheet.name?_._owner.setCellData(r.point.x,r.point.y,r.formula):r.sheet.grid.setCellData(r.point.x,r.point.y,r.formula):r.row._ubv[r.column._hash]=r.formula;if(_._deletedTables&&_._deletedTables.length>0)for(i=0;i<_._deletedTables.length;i++)s=_._deletedTables[i],e?_._owner.selectedSheet.tables.push(s):_._owner.selectedSheet.tables.remove(s);if(_._affectedDefinedNameVals&&(h=e?_._affectedDefinedNameVals.oldDefinedNameVals:_._affectedDefinedNameVals.newDefinedNameVals),h&&h.length>0)for(n=0;n<h.length;n++)d=h[n],(c=_._owner._getDefinedNameIndexByName(d.name))>-1&&(_._owner.definedNames[c].value=d.value);_._owner.selectedSheet.grid.wj_sheetInfo.styledCells=_._owner.selectedSheet._styledCells,_._owner.selectedSheet.grid.wj_sheetInfo.mergedRanges=_._owner.selectedSheet._mergedRanges,_._owner._isUndoing=!1}),_._owner._copyColumnsToSelectedSheet(),_._owner.sortManager.sortDescriptions.sourceCollection=g.sortList.slice(),_._owner.selectedSheet._filterDefinition=g.filterDef,_._owner.sortManager.commitSort(!1),_._owner.selection=g.selection)},t}(o);t._ColumnsChangedAction=s;var r=function(t){function o(e,o,n,i){var l=t.call(this,e)||this;return l._rowIndex=o,l._count=n,l._isAdding=i,l._saveValues(!0),l}return __extends(o,t),o.prototype.undo=function(){this._handleUndoRedo(!0)},o.prototype.redo=function(){this._handleUndoRedo(!1)},o.prototype.saveNewState=function(){return this._saveValues(!1),!0},o.prototype._saveValues=function(t){var o,n,i,l,s,r,a,h,d=[],c=[],u=[];if(null==this._isAdding)if(this._owner.itemsSource)for(r=this._owner.itemsSource instanceof e.collections.CollectionView?this._owner.itemsSource.sourceCollection.slice():this._owner.itemsSource.slice(),i=0;i<this._owner.columns.length;i++)c.push(this._owner.columns[i]);else for(o=0;o<this._owner.rows.length;o++)d.push(this._owner.rows[o]);else{if(t&&!this._isAdding||!t&&this._isAdding)for(o=this._rowIndex;o<this._rowIndex+this._count&&o<this._owner.rows.length;o++)(n=this._owner.rows[o]).isVisible||this._isAdding?d.push(n):d.push(null);this._owner.collectionView&&this._owner.collectionView.sortDescriptions.length>0&&(a=this._owner.collectionView._view.slice())}if(this._owner.selectedSheet.tables&&this._owner.selectedSheet.tables.length>0)for(l=0;l<this._owner.selectedSheet.tables.length;l++)(s=this._owner.selectedSheet.tables[l])&&s.sheet.name===this._owner.selectedSheet.name&&u.push({name:s.name,range:s.getRange(),setting:{showHeaderRow:s.showHeaderRow,showTotalRow:s.showTotalRow}});h={rows:d,columns:c,itemsSource:r,styledCells:this._owner.selectedSheet?this._owner._cloneObject(this._owner.selectedSheet._styledCells):null,mergedCells:this._owner.selectedSheet?this._owner.selectedSheet._cloneMergedCells():null,tableSettings:u,selection:this._owner.selection,dataView:a,scrollPosition:this._owner.scrollPosition},t?this._oldValue=h:this._newValue=h},o.prototype._handleUndoRedo=function(t){var o,n,i,l,s,r,a,h,d,c,u,_,g,f,p,w,m,C=this,b=this,S=!!b._owner.itemsSource,y=t?b._oldValue:b._newValue;b._owner.selectedSheet&&(b._owner.deferUpdate(function(){if(b._owner._isUndoing=!0,b._owner._clearCalcEngine(),b._owner.finishEditing(),null==b._isAdding&&(b._owner.itemsSource&&b._owner.columns.clear(),b._owner.rows.clear(),b._rowIndex=0),b._owner.selectedSheet._styledCells=null,b._owner.selectedSheet._mergedRanges.length=0,null==C._isAdding&&S){for(p=b._owner.autoGenerateColumns,b._owner.autoGenerateColumns=!1,b._owner.collectionView.beginUpdate(),b._owner.itemsSource instanceof e.collections.CollectionView?(f=[0,b._owner.itemsSource.sourceCollection.length].concat(y.itemsSource),Array.prototype.splice.apply(b._owner.itemsSource.sourceCollection,f)):b._owner.itemsSource=y.itemsSource.slice(),b._owner.columns.beginUpdate(),i=0;i<y.columns.length;i++)b._owner.columns.push(y.columns[i]);b._owner.columns.endUpdate(),b._owner.collectionView.endUpdate(),b._owner.autoGenerateColumns=p}else{if(S?(p=b._owner.autoGenerateColumns,b._owner.autoGenerateColumns=!1,w=b._rowIndex-(b._owner.allowAddNew&&b._owner.newRowAtTop?2:1),b._owner.collectionView.beginUpdate()):b._owner.rows.beginUpdate(),y.rows&&y.rows.length>0)for(o=0;o<y.rows.length;o++)(n=y.rows[o])&&(S&&n.dataItem?(m=null!=n.dataItem._itemIdx?n.dataItem._itemIdx:w+o,b._owner.itemsSource instanceof e.collections.CollectionView?(b._owner._updateItemIndexForInsertingRow(b._owner.itemsSource.sourceCollection,m,1),b._owner.itemsSource.sourceCollection.splice(m,0,n.dataItem)):(b._owner._updateItemIndexForInsertingRow(b._owner.itemsSource,m,1),b._owner.itemsSource.splice(m,0,n.dataItem))):b._owner.rows.insert(b._rowIndex+o,n));else for(o=b._rowIndex+b._count-1;o>=b._rowIndex;o--)(n=b._owner.rows[o])&&(S&&n.dataItem?(m=null!=n.dataItem._itemIdx?n.dataItem._itemIdx:o-(b._owner.allowAddNew&&b._owner.newRowAtTop?2:1),b._owner.itemsSource instanceof e.collections.CollectionView?(b._owner.itemsSource.sourceCollection.splice(m,1),b._owner._updateItemIndexForRemovingRow(b._owner.itemsSource.sourceCollection,m)):(b._owner.itemsSource.splice(m,1),b._owner._updateItemIndexForRemovingRow(b._owner.itemsSource,m))):b._owner.rows.removeAt(o));S?(b._owner._lastCount=b._owner.collectionView.itemCount,b._owner.collectionView.endUpdate(),y.dataView&&y.dataView.length>0&&(b._owner.collectionView._view=y.dataView,b._owner.collectionView._pgView=b._owner.collectionView._getPageView(),b._owner.itemsSource instanceof e.collections.CollectionView||(b._owner.selectedSheet.grid.collectionView._view=y.dataView,b._owner.selectedSheet.grid.collectionView._pgView=b._owner.selectedSheet.grid.collectionView._getPageView()),b._owner._bindGrid(!1),b._owner.selectedSheet.grid._bindGrid(!1)),b._owner.autoGenerateColumns=p):b._owner.rows.endUpdate()}for(b._owner.selectedSheet._styledCells=b._owner._cloneObject(y.styledCells),g=0;g<y.mergedCells.length;g++)b._owner.selectedSheet._mergedRanges[g]=y.mergedCells[g];for(s=0;s<y.tableSettings.length;s++)r=y.tableSettings[s],(a=b._owner._getTable(r.name))&&(a._showHeaderRow=r.setting.showHeaderRow,a._showTotalRow=r.setting.showTotalRow,a._setTableRange(r.range));if(b._affectedFormulas&&(d=t?b._affectedFormulas.oldFormulas:b._affectedFormulas.newFormulas),d&&d.length>0)for(l=0;l<d.length;l++)null!=(h=d[l]).point?h.sheet.name===b._owner.selectedSheet.name?b._owner.setCellData(h.point.x,h.point.y,h.formula):h.sheet.grid.setCellData(h.point.x,h.point.y,h.formula):h.row._ubv[h.column._hash]=h.formula;if(b._deletedTables&&b._deletedTables.length>0)for(s=0;s<b._deletedTables.length;s++)a=b._deletedTables[s],t?b._owner.selectedSheet.tables.push(a):b._owner.selectedSheet.tables.remove(a);if(b._affectedDefinedNameVals&&(c=t?b._affectedDefinedNameVals.oldDefinedNameVals:b._affectedDefinedNameVals.newDefinedNameVals),c&&c.length>0)for(l=0;l<c.length;l++)u=c[l],(_=b._owner._getDefinedNameIndexByName(u.name))>-1&&(b._owner.definedNames[_].value=u.value);b._owner.selectedSheet.grid.wj_sheetInfo.styledCells=b._owner.selectedSheet._styledCells,b._owner.selectedSheet.grid.wj_sheetInfo.mergedRanges=b._owner.selectedSheet._mergedRanges,b._owner.selection=y.selection,b._owner.scrollPosition=y.scrollPosition,b._owner._isUndoing=!1}),b._owner._copyRowsToSelectedSheet())},o}(o);t._RowsChangedAction=r;var a=function(e){function t(t,o){var n=e.call(this,t)||this;return n._oldStyledCells=o?t._cloneObject(o):t.selectedSheet?t._cloneObject(t.selectedSheet._styledCells):null,n}return __extends(t,e),t.prototype.undo=function(){this._handleUndoRedo(!0)},t.prototype.redo=function(){this._handleUndoRedo(!1)},t.prototype.saveNewState=function(){return this._newStyledCells=this._owner.selectedSheet?this._owner._cloneObject(this._owner.selectedSheet._styledCells):null,!0},t.prototype._checkActionState=function(){return null!=this._oldStyledCells&&null==this._newStyledCells||null==this._oldStyledCells&&null!=this._newStyledCells||null!=this._oldStyledCells&&null!=this._newStyledCells&&this._oldStyledCells.length!==this._newStyledCells.length},t.prototype._handleUndoRedo=function(e){var t;this._owner.selectedSheet&&(t=e?this._oldStyledCells:this._newStyledCells,this._owner.selectedSheet._styledCells=this._owner._cloneObject(t),this._owner.selectedSheet.grid.wj_sheetInfo.styledCells=this._owner.selectedSheet._styledCells,this._owner.refresh(!1))},t}(o);t._CellStyleAction=a;var h=function(e){function t(t){var o=e.call(this,t)||this;return o._oldMergedCells=t.selectedSheet?t.selectedSheet._cloneMergedCells():null,o}return __extends(t,e),t.prototype.undo=function(){this._handleUndoRedo(!0)},t.prototype.redo=function(){this._handleUndoRedo(!1)},t.prototype.saveNewState=function(){return this._newMergedCells=this._owner.selectedSheet?this._owner.selectedSheet._cloneMergedCells():null,!0},t.prototype._handleUndoRedo=function(e){var t,o;if(this._owner.selectedSheet){if(t=e?this._oldMergedCells:this._newMergedCells,this._owner._clearCalcEngine(),t)for(this._owner.selectedSheet._mergedRanges.length=0,o=0;o<t.length;o++)this._owner.selectedSheet._mergedRanges[o]=t[o];this._owner.selectedSheet.grid.wj_sheetInfo.mergedRanges=this._owner.selectedSheet._mergedRanges,this._owner.refresh(!0)}},t.prototype._checkActionState=function(){var e,t,o;if(null!=this._oldMergedCells&&null==this._newMergedCells||null==this._oldMergedCells&&null!=this._newMergedCells)return!0;if(null!=this._oldMergedCells&&null!=this._newMergedCells&&this._oldMergedCells.length!==this._newMergedCells.length)return!0;if(null!=this._oldMergedCells&&null!=this._newMergedCells&&this._oldMergedCells.length===this._newMergedCells.length)for(e=0;e<this._oldMergedCells.length;e++)if(o=this._oldMergedCells[e],t=this._oldMergedCells[e],!o.equals(t))return!0;return!1},t}(o);t._CellMergeAction=h;var d=function(t){function o(e){var o=t.call(this,e)||this;return o._saveValues(!0),o}return __extends(o,t),o.prototype.undo=function(){this._handleUndoRedo(!0)},o.prototype.redo=function(){this._handleUndoRedo(!1)},o.prototype.saveNewState=function(){return this._saveValues(!1),!0},o.prototype._saveValues=function(e){var t,o,n,i,l,s,r,a,h,d=[];for(o=0;o<this._owner.columns.length;o++)d.push(this._owner.columns[o]);if(this._owner.itemsSource){i=this._owner.allowAddNew&&this._owner.newRowAtTop?2:1,l=[];for(var c=0;c<this._owner.rows.length-i;c++)(r=(s=this._owner.rows[c+i]).dataItem)&&(l[null!=r._itemIdx?r._itemIdx:c]=s.visible);e&&(h=this._owner.collectionView._view.slice())}else for(n=[],t=0;t<this._owner.rows.length;t++)n.push(this._owner.rows[t]);a={sortList:this._owner.sortManager._committedList.slice(),rows:n,columns:d,selection:this._owner.selection.clone(),formulas:this._owner._scanFormulas(),styledCells:this._owner.selectedSheet?this._owner._cloneObject(this._owner.selectedSheet._styledCells):null,rowsVisible:l,dataView:h},e?this._oldValue=a:this._newValue=a},o.prototype._handleUndoRedo=function(t){var o,n,i,l,s=this,r=t?s._oldValue:s._newValue,a=!!s._owner.itemsSource,h=this._owner.itemsSource instanceof e.collections.CollectionView;s._owner.selectedSheet&&(s._owner._isUndoing=!0,s._owner.deferUpdate(function(){if(s._owner._clearCalcEngine(),s._owner.sortManager.sortDescriptions.sourceCollection=r.sortList.slice(),s._owner.sortManager.commitSort(!1),s._owner.selectedSheet._styledCells=s._owner._cloneObject(r.styledCells),a)r.dataView&&r.dataView.length>0&&(s._owner.collectionView._view=r.dataView,s._owner.collectionView._pgView=s._owner.collectionView._getPageView(),h||(s._owner.selectedSheet.grid.collectionView._view=r.dataView,s._owner.selectedSheet.grid.collectionView._pgView=s._owner.selectedSheet.grid.collectionView._getPageView()),s._owner._bindGrid(!1),s._owner.selectedSheet.grid._bindGrid(!1));else{for(s._owner.rows.clear(),s._owner.selectedSheet.grid.rows.clear(),o=0;o<r.rows.length;o++)i=r.rows[o],s._owner.selectedSheet.grid.rows.push(i),s._owner.rows.push(i);for(s._owner.columns.clear(),n=0;n<r.columns.length;n++)l=r.columns[n],s._owner.columns.push(l);s._owner._resetFormulas(r.formulas)}s._owner._isUndoing=!1}))},o}(o);t._SortColumnAction=d;var c=function(t){function o(e,o,n,i){var l=t.call(this,e)||this;return e.selectedSheet?(0===o.topRow&&o.bottomRow===e.rows.length-1?l._isDraggingColumns=!0:l._isDraggingColumns=!1,l._isCopyCells=i,l._dragRange=o,l._dropRange=n,l._saveValues(!0),l):l}return __extends(o,t),o.prototype.undo=function(){this._handleUndoRedo(!0)},o.prototype.redo=function(){this._handleUndoRedo(!1)},o.prototype.saveNewState=function(){return!!this._owner.selectedSheet&&(!!this._dropRange&&(this._saveValues(!1),!0))},o.prototype._saveValues=function(e){var t,o,n,i,l,s,r,a,h,d,c,u;for(c=[],u={},t=this._dropRange.topRow;t<=this._dropRange.bottomRow;t++)for(o=this._dropRange.leftCol;o<=this._dropRange.rightCol;o++)this._isDraggingColumns&&(u[o]||(u[o]={dataType:this._owner.columns[o].dataType,align:this._owner.columns[o].align,format:this._owner.columns[o].format})),n=t*this._owner.columns.length+o,l=this._owner.selectedSheet._styledCells[n]?this._owner._cloneObject(this._owner.selectedSheet._styledCells[n]):null,i=this._owner.getCellData(t,o,!1),c.push({rowIndex:t,columnIndex:o,cellContent:i,cellStyle:l});if(e?(this._oldDroppingCells=c,this._oldDroppingColumnSetting=u):(this._newDroppingCells=c,this._newDroppingColumnSetting=u),this._isCopyCells){if(this._isDraggingColumns)if(e)for(t=this._dragRange.topRow;t<=this._dragRange.bottomRow;t++)for(o=this._dragRange.leftCol;o<=this._dragRange.rightCol;o++)(a=this._owner.selectedSheet.findTable(t,o))&&(h=a.getRange(),d=a.getColumns(),a.showHeaderRow&&t===h.topRow&&(this._draggingTableColumns||(this._draggingTableColumns=[]),this._draggingTableColumns.push({rowIndex:t,columnIndex:o,cellContent:d[o-h.leftCol].name})));else if(this._draggingTableColumns&&this._draggingTableColumns.length>0&&this._draggingTableColumns&&this._draggingTableColumns.length>0)for(s=0;s<this._draggingTableColumns.length;s++)r=this._draggingTableColumns[s],(a=this._owner.selectedSheet.findTable(r.rowIndex,r.columnIndex))&&(h=a.getRange(),d=a.getColumns(),a.showHeaderRow&&r.rowIndex===h.topRow&&(r.updatedCellContent=d[r.columnIndex-h.leftCol].name))}else if(e)for(this._draggingCells=[],this._draggingColumnSetting={},t=this._dragRange.topRow;t<=this._dragRange.bottomRow;t++)for(o=this._dragRange.leftCol;o<=this._dragRange.rightCol;o++)this._isDraggingColumns&&(this._draggingColumnSetting[o]||(this._draggingColumnSetting[o]={dataType:this._owner.columns[o].dataType,align:this._owner.columns[o].align,format:this._owner.columns[o].format})),n=t*this._owner.columns.length+o,l=this._owner.selectedSheet._styledCells[n]?this._owner._cloneObject(this._owner.selectedSheet._styledCells[n]):null,i=this._owner.getCellData(t,o,!1),this._draggingCells.push({rowIndex:t,columnIndex:o,cellContent:i,cellStyle:l});else if(this._isDraggingColumns&&this._draggingCells&&this._draggingCells.length>0)for(s=0;s<this._draggingCells.length;s++)r=this._draggingCells[s],(a=this._owner.selectedSheet.findTable(r.rowIndex,r.columnIndex))&&(h=a.getRange(),d=a.getColumns(),a.showHeaderRow&&r.rowIndex===h.topRow&&(r.updatedCellContent=d[r.columnIndex-h.leftCol].name))},o.prototype._handleUndoRedo=function(t){var o,n,i,l,s,r,a,h,d,c,u=this,_=t?u._oldDroppingCells:u._newDroppingCells,g=t?u._oldDroppingColumnSetting:u._newDroppingColumnSetting;u._owner.selectedSheet&&(u._owner._clearCalcEngine(),u._owner.deferUpdate(function(){var f,p,w;if(u._affectedFormulas&&(r=t?u._affectedFormulas.oldFormulas:u._affectedFormulas.newFormulas),r&&r.length>0)for(o=0;o<r.length;o++)(a=r[o]).sheet.name===u._owner.selectedSheet.name?u._owner.setCellData(a.point.x,a.point.y,a.formula):a.sheet.grid.setCellData(a.point.x,a.point.y,a.formula);if(u._affectedDefinedNameVals&&(h=t?u._affectedDefinedNameVals.oldDefinedNameVals:u._affectedDefinedNameVals.newDefinedNameVals),h&&h.length>0)for(o=0;o<h.length;o++)d=h[o],(c=u._owner._getDefinedNameIndexByName(d.name))>-1&&(u._owner.definedNames[c].value=d.value);for(o=0;o<_.length;o++)n=_[o],u._owner.setCellData(n.rowIndex,n.columnIndex,n.cellContent),(f=u._owner.selectedSheet.findTable(n.rowIndex,n.columnIndex))&&(p=f.getRange(),w=f.getColumns(),f.showHeaderRow&&n.rowIndex===p.topRow&&(w[n.columnIndex-p.leftCol].name=n.cellContent)),i=n.rowIndex*u._owner.columns.length+n.columnIndex,n.cellStyle?u._owner.selectedSheet._styledCells[i]=n.cellStyle:delete u._owner.selectedSheet._styledCells[i];if(u._isDraggingColumns&&g&&Object.keys(g).forEach(function(t){u._owner.columns[+t].dataType=g[+t].dataType?g[+t].dataType:e.DataType.Object,u._owner.columns[+t].align=g[+t].align,u._owner.columns[+t].format=g[+t].format}),u._isCopyCells){if(u._draggingTableColumns&&u._draggingTableColumns.length>0)for(o=0;o<u._draggingTableColumns.length;o++)n=u._draggingTableColumns[o],(f=u._owner.selectedSheet.findTable(n.rowIndex,n.columnIndex))&&(p=f.getRange(),w=f.getColumns(),f.showHeaderRow&&n.rowIndex===p.topRow&&(u._owner.setCellData(n.rowIndex,n.columnIndex,t?n.cellContent:n.updatedCellContent),w[n.columnIndex-p.leftCol].name=t?n.cellContent:n.updatedCellContent))}else{for(o=0;o<u._draggingCells.length;o++)n=u._draggingCells[o],(f=u._owner.selectedSheet.findTable(n.rowIndex,n.columnIndex))?(p=f.getRange(),w=f.getColumns(),f.showHeaderRow&&n.rowIndex===p.topRow?(u._owner.setCellData(n.rowIndex,n.columnIndex,t?n.cellContent:n.updatedCellContent),w[n.columnIndex-p.leftCol].name=t?n.cellContent:n.updatedCellContent):u._owner.setCellData(n.rowIndex,n.columnIndex,t?n.cellContent:null)):u._owner.setCellData(n.rowIndex,n.columnIndex,t?n.cellContent:null),i=n.rowIndex*u._owner.columns.length+n.columnIndex,t?n.cellStyle&&(u._owner.selectedSheet._styledCells[i]=n.cellStyle):u._owner.selectedSheet._styledCells[i]&&delete u._owner.selectedSheet._styledCells[i];if(u._isDraggingColumns&&u._draggingColumnSetting&&Object.keys(u._draggingColumnSetting).forEach(function(o){u._owner.columns[+o].dataType=t&&u._draggingColumnSetting[+o].dataType?u._draggingColumnSetting[+o].dataType:e.DataType.Object,u._owner.columns[+o].align=t?u._draggingColumnSetting[+o].align:null,u._owner.columns[+o].format=t?u._draggingColumnSetting[+o].format:null}),t){if(u._isDraggingColumns)if(u._dragRange.leftCol<u._dropRange.leftCol)for(s=u._dragRange.leftCol,l=u._dropRange.leftCol;l<=u._dropRange.rightCol;l++)u._owner._updateColumnFiler(l,s),s++;else for(s=u._dragRange.rightCol,l=u._dropRange.rightCol;l>=u._dropRange.leftCol;l--)u._owner._updateColumnFiler(l,s),s--}else if(u._isDraggingColumns)if(u._dragRange.leftCol>u._dropRange.leftCol)for(s=u._dropRange.leftCol,l=u._dragRange.leftCol;l<=u._dragRange.rightCol;l++)u._owner._updateColumnFiler(l,s),s++;else for(s=u._dropRange.rightCol,l=u._dragRange.rightCol;l>=u._dragRange.leftCol;l--)u._owner._updateColumnFiler(l,s),s--}}))},o}(o);t._MoveCellsAction=c;var u=function(t){function o(o){var n=t.call(this,o)||this;return n._oldValues=[],n._mergeAction=new h(o),n._celltyleAction=new a(o),n._cutSheet=o._copiedSheet,n._selection=o.selection,n._cutSelection=o.selectionMode===e.grid.SelectionMode.ListBox?o._getSelectionForListBoxMode(n._cutSheet.grid):o._copiedRanges[0],n._saveCutValues(!0),n}return __extends(o,t),o.prototype.undo=function(){this._handleUndoRedo(!0)},o.prototype.redo=function(){this._handleUndoRedo(!1)},o.prototype.saveNewState=function(){var e,t,o;this._cutSheet===this._owner.selectedSheet?this._owner:this._cutSheet.grid;for(this._saveCutValues(!1),this._newValues=[],e=this._selection.topRow;e<=this._selection.bottomRow;e++)for(t=this._selection.leftCol;t<=this._selection.rightCol;t++){if(!this._owner.columns[t])return!1;o=null==(o=this._owner.getCellData(e,t,!!this._owner.columns[t].dataMap))?"":o,this._newValues.push({row:e,col:t,value:o})}return this._mergeAction.saveNewState(),this._celltyleAction.saveNewState(),!0},o.prototype.updateForPasting=function(e){var t=this._owner.getCellData(e.row,e.col,!!this._owner.columns[e.col].dataMap);t=null==t?"":t,this._oldValues.push({row:e.row,col:e.col,value:t}),this._selection.row=Math.min(this._selection.topRow,e.topRow),this._selection.row2=Math.max(this._selection.bottomRow,e.bottomRow),this._selection.col=Math.min(this._selection.leftCol,e.leftCol),this._selection.col2=Math.max(this._selection.rightCol,e.rightCol)},o.prototype._saveCutValues=function(e){var t,o,n,i=this._cutSheet===this._owner.selectedSheet?this._owner:this._cutSheet.grid,l=[];for(t=this._cutSelection.topRow;t<=this._cutSelection.bottomRow;t++)if(null!=i.rows[t])for(o=this._cutSelection.leftCol;o<=this._cutSelection.rightCol;o++)n=null==(n=i.getCellData(t,o,!!i.columns[o].dataMap))?"":n,l.push({row:t,col:o,value:n});e?this._oldCutValues=l:this._newCutValues=l},o.prototype._handleUndoRedo=function(e){var t=this,o=e?t._oldCutValues:t._newCutValues,n=e?t._oldValues:t._newValues;t._owner._clearCalcEngine(),t._owner.selectedSheet.selectionRanges.clear(),t._owner.deferUpdate(function(){var i,l,s=t._cutSheet===t._owner.selectedSheet?t._owner:t._cutSheet.grid;for(t._owner.selectedSheet.selectionRanges.push(t._selection),i=0;i<o.length;i++)l=o[i],s.setCellData(l.row,l.col,l.value);for(i=0;i<n.length;i++)l=n[i],t._owner.setCellData(l.row,l.col,l.value);e?(t._mergeAction.undo(),t._celltyleAction.undo()):(t._mergeAction.redo(),t._celltyleAction.redo()),t._owner.refresh(!1)})},o}(o);t._CutAction=u;var _=function(e){function t(t,o){var n=e.call(this,t)||this;return n._table=o,n._saveValues(!0),n}return __extends(t,e),t.prototype.undo=function(){this._handleUndoRedo(!0)},t.prototype.redo=function(){this._handleUndoRedo(!1)},t.prototype.saveNewState=function(){return this._saveValues(!1),!0},t.prototype._saveValues=function(e){var t={name:this._table.name,style:this._table.style,showHeaderRow:this._table.showHeaderRow,showTotalRow:this._table.showTotalRow,showbandedRows:this._table.showBandedRows,showBandedColumns:this._table.showBandedColumns,alterFirstColumn:this._table.alterFirstColumn,alterLastColumn:this._table.alterLastColumn};e?this._oldTableSetting=t:this._newTableSetting=t},t.prototype._handleUndoRedo=function(e){var t=e?this._oldTableSetting:this._newTableSetting;this._owner.beginUpdate(),this._owner._isUndoing=!0,this._table.name=t.name,this._table.style=t.style,this._table.showHeaderRow=t.showHeaderRow,this._table.showTotalRow=t.showTotalRow,this._table.showBandedRows=t.showbandedRows,this._table.showBandedColumns=t.showBandedColumns,this._table.alterFirstColumn=t.alterFirstColumn,this._table.alterLastColumn=t.alterLastColumn,this._owner._isUndoing=!1,this._owner.endUpdate()},t}(o);t._TableSettingAction=_;var g=function(e){function t(t,o){var n=e.call(this,t)||this;return n._addedTable=o,o.showHeaderRow&&(n._orgHeaderCellsContent=o._orgHeaderCellsContent.slice()),n}return __extends(t,e),t.prototype.undo=function(){this._handleUndoRedo(!0)},t.prototype.redo=function(){this._handleUndoRedo(!1)},t.prototype._handleUndoRedo=function(e){var t,o,n;if(e?this._owner.selectedSheet.tables.remove(this._addedTable):this._owner.selectedSheet.tables.push(this._addedTable),this._addedTable.showHeaderRow)for(o=this._addedTable.getRange(),n=this._addedTable.getColumns(),t=0;t<o.columnSpan;t++)this._owner.setCellData(o.topRow,o.leftCol+t,e?this._orgHeaderCellsContent[t]:n[t].name);this._owner.refresh()},t}(o);t._TableAction=g;var f=function(e){function t(t){var o=e.call(this,t)||this;return o._oldFilterDefinition=t.filter.filterDefinition,o._oldRowsVisible=o._getRowsVisible(),o}return __extends(t,e),t.prototype.undo=function(){this._handleUndoRedo(!0)},t.prototype.redo=function(){this._handleUndoRedo(!1)},t.prototype.saveNewState=function(){return this._newFilterDefinition=this._owner.filter.filterDefinition,this._newRowsVisible=this._getRowsVisible(),!0},t.prototype._handleUndoRedo=function(e){var t=e?this._oldFilterDefinition:this._newFilterDefinition;this._owner.filter.filterDefinition!==t?(this._owner._isUndoing=!0,this._owner.selectedSheet._filterDefinition=t,this._owner.selectedSheet._applyFilterSetting(),this._owner._isUndoing=!1,this._owner.filter.apply()):this._setRowVisible(e)},t.prototype._getRowsVisible=function(){for(var e,t=[],o=0;o<this._owner.rows.length;o++)(e=this._owner.rows[o])&&t.push(e.visible);return t},t.prototype._setRowVisible=function(e){for(var t,o=e?this._oldRowsVisible:this._newRowsVisible,n=0;n<o.length;n++)(t=this._owner.rows[n])&&(t.visible=o[n])},t}(o);t._FilteringAction=f;var p=function(t){function o(e,o){var n=t.call(this,e)||this;return n._fillSource=o.clone(),n._oldCellSettings=e._orgCellSettings,n}return __extends(o,t),o.prototype.undo=function(){this._handleUndoRedo(!0)},o.prototype.redo=function(){this._handleUndoRedo(!1)},o.prototype.saveNewState=function(){return this._fillRange=this._owner.selection.clone(),this._newCellSettings=this._owner._getCellSettingsForFill(this._fillSource,this._fillRange),!0},o.prototype._handleUndoRedo=function(t){var o,n,i,l,s,r,a=t?this._oldCellSettings:this._newCellSettings,h=t?this._fillSource:this._fillRange;if(this._owner.beginUpdate(),r=this._fillRange.topRow<this._fillSource.topRow?new e.grid.CellRange(this._fillRange.topRow,this._fillRange.col,this._fillSource.topRow-1,this._fillRange.col2):this._fillRange.leftCol===this._fillSource.leftCol&&this._fillRange.rightCol===this._fillSource.rightCol?new e.grid.CellRange(this._fillSource.bottomRow+1,this._fillRange.col,this._fillRange.bottomRow,this._fillRange.col2):this._fillRange.leftCol<this._fillSource.leftCol?new e.grid.CellRange(this._fillRange.row,this._fillRange.leftCol,this._fillRange.row2,this._fillSource.leftCol-1):new e.grid.CellRange(this._fillRange.row,this._fillSource.rightCol+1,this._fillRange.row2,this._fillRange.rightCol),this._owner._resetMergedRange(r),a&&a.length>0)for(o=0;o<a.length;o++)i=(n=a[o]).row,l=n.col,s=i*this._owner.columns.length+l,this._owner.selectedSheet._styledCells[s]=n.style,this._owner.setCellData(i,l,n.value),n.mergedCell&&this._owner.mergeRange(n.mergedCell);this._owner.selection=h,this._owner.endUpdate()},o}(o);t._FillAction=p}(t.sheet||(t.sheet={}))}(e.grid||(e.grid={}))}(wijmo||(wijmo={})),function(e){!function(t){!function(t){"use strict";var o=function(){function o(t){this._owner=t,this._sortDescriptions=new e.collections.CollectionView,this._committedList=[new n(-1,!0)],this._sortDescriptions.newItemCreator=function(){return new n(-1,!0)}}return Object.defineProperty(o.prototype,"sortDescriptions",{get:function(){return this._sortDescriptions},set:function(e){this._sortDescriptions=e,this.commitSort()},enumerable:!0,configurable:!0}),o.prototype.addSortLevel=function(t,o){void 0===o&&(o=!0);var n=this._sortDescriptions.addNew();null!=t&&!isNaN(t)&&e.isInt(t)&&(n.columnIndex=t),n.ascending=o,this._sortDescriptions.commitNew()},o.prototype.deleteSortLevel=function(e){var t;(t=null!=e?this._getSortItem(e):this._sortDescriptions.currentItem)&&this._sortDescriptions.remove(t)},o.prototype.copySortLevel=function(){var e=this._sortDescriptions.currentItem;if(e){var t=this._sortDescriptions.addNew();t.columnIndex=parseInt(e.columnIndex),t.ascending=e.ascending,this._sortDescriptions.commitNew()}},o.prototype.editSortLevel=function(e,t){null!=e&&(this._sortDescriptions.currentItem.columnIndex=e),null!=t&&(this._sortDescriptions.currentItem.ascending=t)},o.prototype.moveSortLevel=function(e){var t=this._sortDescriptions.currentItem;if(t){var o=this._sortDescriptions.sourceCollection,n=o.indexOf(t),i=n+e;n>-1&&i>-1&&(o.splice(n,1),o.splice(i,0,t),this._sortDescriptions.refresh(),this._sortDescriptions.moveCurrentTo(t))}},o.prototype.checkSortItemExists=function(e){for(var t=0,o=this._sortDescriptions.itemCount;t<o;t++)if(+this._sortDescriptions.items[t].columnIndex===e)return t;return-1},o.prototype.commitSort=function(o){void 0===o&&(o=!0);var i,l,s,r,a,h,d,c,u,_,g,f,p,w,m,C,b,S=this._owner,y=this._owner.itemsSource instanceof e.collections.CollectionView,R=null==this._owner.selectedSheet.grid.collectionView,v={};if(this._owner.selectedSheet&&0!==this._owner.columns.length){if(S._needCopyToSheet=!1,h=S.selectedSheet._unboundSortDesc,o&&S.undoStack.stackSize>0&&(d=new t._SortColumnAction(S)),this._sortDescriptions.itemCount>0?this._committedList=this._cloneSortList(this._sortDescriptions.items):this._committedList=[new n(-1,!0)],_=S.selectedSheet._filterDefinition,S.collectionView){for(S._isSorting=!0,S.beginUpdate(),(c=S.editableCollectionView)&&c.currentEditItem&&-1!==c.items.indexOf(c.currentEditItem)&&!this._isEmpty(c.currentEditItem)&&c.commitEdit(),S.collectionView.beginUpdate(),R||S.selectedSheet.grid.collectionView.beginUpdate(),(s=S.collectionView.sortDescriptions).clear(),u=S.selection.clone(),C=S.allowAddNew&&S.newRowAtTop?S.rows[1]:S.rows[0],b=(S.allowAddNew&&S.newRowAtTop?1:0)+(C instanceof t.HeaderRow?1:0),f=[],a=0;a<S.rows.length-b;a++)(m=(w=S.rows[a+b]).dataItem)&&(f[p=null!=m._itemIdx?m._itemIdx:a]=w.visible);for(y||(r=R?S.collectionView.sortDescriptions:S.selectedSheet.grid.collectionView.sortDescriptions).clear(),S.collectionView.sourceCollection.map(function(e,t){null==e._itemIdx&&(e._itemIdx=t)}),S.selection=u,navigator.userAgent.toLowerCase().indexOf("chrome")>-1&&(S.collectionView.useStableSort=!0,y||R||(S.selectedSheet.grid.collectionView.useStableSort=!0)),a=0;a<this._sortDescriptions.itemCount;a++)(i=this._sortDescriptions.items[a]).columnIndex>-1&&i.columnIndex<S.columns.length&&(l=new e.collections.SortDescription(S.columns[i.columnIndex].binding,i.ascending),s.push(l),y||(S.collectionView.sortDescriptions.push(l),r.push(l)));for(S.selectedSheet.selectionRanges.clear(),S.collectionView.endUpdate(),R||S.selectedSheet.grid.collectionView.endUpdate(),u=S.selection.clone(),g=S.collectionView._view.slice(),a=0;a<g.length;a++)a!==(m=g[a])._itemIdx&&S._updateFormulaForReorderingRows(m._itemIdx+b,a+b),S._updateCellStyleForReorderingRows(m._itemIdx+b,a+b,v);for(a=0;a<S.rows.length-b;a++)(m=(w=S.rows[a+b]).dataItem)&&(p=null!=m._itemIdx?m._itemIdx:a,w.visible=f[p]);g.map(function(e,t){e._itemIdx=t}),S.selectedSheet._styledCells=v,S.selection=u,S.endUpdate(),S._copyColumnsToSelectedSheet(),S._isSorting=!1}else{for(h.clear(),a=0;a<this._sortDescriptions.itemCount;a++)(i=this._sortDescriptions.items[a]).columnIndex>-1&&h.push(new t._UnboundSortDescription(S.columns[i.columnIndex],i.ascending));setTimeout(function(){_&&(S.filter.filterDefinition=_)},10)}d&&(d.saveNewState(),S.undoStack._addAction(d)),S._copiedRanges=null,S._needCopyToSheet=!0}},o.prototype.cancelSort=function(){this._sortDescriptions.sourceCollection=this._committedList.slice()},o.prototype.clearSort=function(){this._sortDescriptions.sourceCollection=[],this.commitSort()},o.prototype._getSortItem=function(e){var t=this.checkSortItemExists(e);if(t>-1)return this._sortDescriptions.items[t]},o.prototype._cloneSortList=function(e){for(var t=[],o=0;o<e.length;o++)t[o]=e[o].clone();return t},o.prototype._updateSortSortDescription=function(e,t,o){var n,i;for(void 0===o&&(o=!0),n=this._sortDescriptions.items.length-1;n>=0;n--)i=this._sortDescriptions.items[n],o?i.columnIndex>e&&(i.columnIndex+=t):i.columnIndex>=e+t?i.columnIndex-=t:i.columnIndex>=e&&this._sortDescriptions.remove(i)},o.prototype._isEmpty=function(e){var t=Object.prototype.hasOwnProperty;if(null==e)return!0;if(e.length>0)return!1;if(0===e.length)return!0;for(var o in e)if(t.call(e,o))return!1;return!0},o}();t.SortManager=o;var n=function(){function e(e,t){this._columnIndex=e,this._ascending=t}return Object.defineProperty(e.prototype,"columnIndex",{get:function(){return this._columnIndex},set:function(e){this._columnIndex=+e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ascending",{get:function(){return this._ascending},set:function(e){this._ascending=e},enumerable:!0,configurable:!0}),e.prototype.clone=function(){return new e(this._columnIndex,this._ascending)},e}();t.ColumnSortDescription=n}(t.sheet||(t.sheet={}))}(e.grid||(e.grid={}))}(wijmo||(wijmo={})),function(e){var t;(function(t){"use strict";e._addCultureInfo("FlexSheet",{insertRow:"Insert Row",deleteRow:"Delete Rows",insertCol:"Insert Column",deleteCol:"Delete Columns",convertTable:"Convert To Table",insertSheet:"Insert",deleteSheet:"Delete",renameSheet:"Rename",copyCells:"Copy Cells",fillSeries:"Fill Series",fillFormat:"Fill Formatting Only",fillWithoutFormat:"Fill Without Formatting"});var o=[{name:"abs",description:"Returns the absolute value of a number."},{name:"acos",description:"Returns the arccosine of a number."},{name:"address",description:"Obtains the address of a cell in a worksheet by given specified row and column numbers."},{name:"and",description:"Returns TRUE if all of its arguments are TRUE."},{name:"asin",description:"Returns the arcsine of a number."},{name:"atan",description:"Returns the arctangent of a number."},{name:"atan2",description:"Returns the arctangent from x- and y-coordinates."},{name:"average",description:"Returns the average of its arguments."},{name:"ceiling",description:"Rounds a number to the nearest integer or to the nearest multiple of significance."},{name:"char",description:"Returns the character specified by the code number."},{name:"choose",description:"Chooses a value from a list of values."},{name:"code",description:"Returns a numeric code for the first character in a text string."},{name:"column",description:"Returns the column number of a reference."},{name:"columns",description:"Returns the number of columns in a reference."},{name:"concatenate",description:"Joins several text items into one text item."},{name:"cos",description:"Returns the cosine of a number."},{name:"count",description:"Counts how many numbers are in the list of arguments."},{name:"counta",description:"Counts how many values are in the list of arguments."},{name:"countblank",description:"Counts the number of blank cells within a range."},{name:"countif",description:"Counts the number of cells within a range that meet the given criteria."},{name:"countifs",description:"Counts the number of cells within a range that meet multiple criteria."},{name:"date",description:"Returns the serial number of a particular date."},{name:"datedif",description:"Calculates the number of days, months, or years between two dates."},{name:"day",description:"Converts a serial number to a day of the month."},{name:"dcount",description:"Counts the cells that contain numbers in a database."},{name:"exp",description:"Returns e raised to the power of a given number."},{name:"false",description:"Returns the logical value FALSE."},{name:"find",description:"Finds one text value within another (case-sensitive)."},{name:"floor",description:"Rounds a number down, toward zero."},{name:"hlookup",description:"Looks in the top row of an array and returns the value of the indicated cell."},{name:"hour",description:"Converts a serial number to an hour."},{name:"if",description:"Specifies a logical test to perform."},{name:"index",description:"Uses an index to choose a value from a reference."},{name:"indirect",description:"Returns the reference specified by a text string. References are immediately evaluated to display their contents."},{name:"left",description:"Returns the leftmost characters from a text value."},{name:"len",description:"Returns the number of characters in a text string."},{name:"ln",description:"Returns the natural logarithm of a number."},{name:"lower",description:"Converts text to lowercase."},{name:"max",description:"Returns the maximum value in a list of arguments."},{name:"mid",description:"Returns a specific number of characters from a text string starting at the position you specify."},{name:"min",description:"Returns the minimum value in a list of arguments."},{name:"mod",description:"Returns the remainder from division."},{name:"month",description:"Converts a serial number to a month."},{name:"not",description:"Reverses the logic of its argument."},{name:"now",description:"Returns the serial number of the current date and time."},{name:"or",description:"Returns TRUE if any argument is TRUE."},{name:"pi",description:"Returns the value of pi."},{name:"power",description:"Returns the result of a number raised to a power."},{name:"product",description:"Multiplies its arguments."},{name:"proper",description:"Capitalizes the first letter in each word of a text value."},{name:"rand",description:"Returns a random number between 0 and 1."},{name:"rank",description:"Returns the rank of a number in a list of numbers."},{name:"rate",description:"Returns the interest rate per period of an annuity."},{name:"replace",description:"Replaces characters within text."},{name:"rept",description:"Repeats text a given number of times."},{name:"right",description:"Returns the rightmost characters from a text value."},{name:"round",description:"Rounds a number to a specified number of digits."},{name:"rounddown",description:"Rounds a number down, toward zero."},{name:"roundup",description:"Rounds a number up, away from zero."},{name:"row",description:"Returns the row number of a reference."},{name:"rows",description:"Returns the number of rows in a reference."},{name:"search",description:"Finds one text value within another (not case-sensitive)."},{name:"sin",description:"Returns the sine of the given angle."},{name:"sqrt",description:"Returns a positive square root."},{name:"stdev",description:"Estimates standard deviation based on a sample."},{name:"stdevp",description:"Calculates standard deviation based on the entire population."},{name:"substitute",description:"Substitutes new text for old text in a text string."},{name:"subtotal",description:"Returns a subtotal in a list or database."},{name:"sum",description:"Adds its arguments."},{name:"sumif",description:"Adds the cells specified by a given criteria."},{name:"sumifs",description:"Adds the cells in a range that meet multiple criteria."},{name:"sumproduct",description:"Multiplies corresponding components in the given arrays, and returns the sum of those products."},{name:"tan",description:"Returns the tangent of a number."},{name:"text",description:"Formats a number and converts it to text."},{name:"time",description:"Returns the serial number of a particular time."},{name:"today",description:"Returns the serial number of today's date."},{name:"trim",description:"Removes spaces from text."},{name:"true",description:"Returns the logical value TRUE."},{name:"trunc",description:"Truncates a number to an integer."},{name:"upper",description:"Converts text to uppercase."},{name:"value",description:"Converts a text argument to a number."},{name:"var",description:"Estimates variance based on a sample."},{name:"varp",description:"Calculates variance based on the entire population."},{name:"year",description:"Converts a serial number to a year."}],n=function(n){function s(o,i){var l=n.call(this,o,i)||this;return l._selectedSheetIndex=-1,l._columnHeaderClicked=!1,l._addingSheet=!1,l._mouseMoveHdl=l._mouseMove.bind(l),l._clickHdl=l._click.bind(l),l._touchStartHdl=l._touchStart.bind(l),l._touchEndHdl=l._touchEnd.bind(l),l._keydownHdl=l._keydown.bind(l),l._isContextMenuKeyDown=!1,l._isClicking=!1,l._definedNames=new e.collections.ObservableArray,l._builtInTableStylesCache=null,l._needCopyToSheet=!0,l._isSorting=!1,l._fillingData=!1,l._endDragFillOperationHdl=l._endDragFillOperation.bind(l),l._enableDragDrop=!0,l._enableFormulas=!0,l._headerRowRemoved=!1,l.selectedSheetChanged=new e.Event,l.draggingRowColumn=new e.Event,l.droppingRowColumn=new e.Event,l.beginDroppingRowColumn=new e.Event,l.endDroppingRowColumn=new e.Event,l.loaded=new e.Event,l.unknownFunction=new e.Event,l.sheetCleared=new e.Event,l.prepareChangingRow=new e.Event,l.prepareChangingColumn=new e.Event,l.rowChanged=new e.Event,l.columnChanged=new e.Event,l._needCopyToSheet=!1,l._colorThemes=["FFFFFF","000000","EEECE1","1F497D","4F818D","C0504D","9BBB59","8064A2","4BACC6","F79646"],l._eCt.style.backgroundColor="white",e.addClass(l.hostElement,"wj-flexsheet"),e.setCss(l.hostElement,{fontFamily:"Arial"}),l._cf=new t._FlexSheetCellFactory,l._bndSortConverter=l._sheetSortConverter.bind(l),l.quickAutoSize=!1,l._init(),l.showSort=!1,l.allowSorting=!1,l.showGroups=!1,l.showMarquee=!0,l.showSelectedHeaders=e.grid.HeadersVisibility.All,l.allowResizing=e.grid.AllowResizing.Both,l.allowDragging=e.grid.AllowDragging.None,l.keyActionTab=e.grid.KeyAction.CycleOut,l._needCopyToSheet=!0,l}return __extends(s,n),s.prototype._getProductInfo=function(){return"R20I,FlexSheet"},Object.defineProperty(s.prototype,"sheets",{get:function(){return this._sheets||(this._sheets=new t.SheetCollection,this._sheets.selectedSheetChanged.addHandler(this._selectedSheetChange,this),this._sheets.collectionChanged.addHandler(this._sourceChange,this),this._sheets.sheetVisibleChanged.addHandler(this._sheetVisibleChange,this),this._sheets.sheetCleared.addHandler(this.onSheetCleared,this)),this._sheets},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"selectedSheetIndex",{get:function(){return this._selectedSheetIndex},set:function(e){e!==this._selectedSheetIndex&&(this._showSheet(e),this._sheets.selectedIndex=e)},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"selectedSheet",{get:function(){return this._sheets[this._selectedSheetIndex]},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"isFunctionListOpen",{get:function(){return this._functionListHost&&"none"!==this._functionListHost.style.display},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"isTabHolderVisible",{get:function(){return this._tabHolder.visible},set:function(e){e!==this._tabHolder.visible&&(e?(this._divContainer.style.height=this._divContainer.parentElement.clientHeight-this._tabHolder.getSheetBlanketSize()+"px",this._eFocus.removeAttribute("tabindex")):(this._divContainer.style.height=this._divContainer.parentElement.clientHeight+"px",this._eFocus.tabIndex=this._orgTabIndex),this._tabHolder.visible=e)},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"undoStack",{get:function(){return this._undoStack},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"sortManager",{get:function(){return this._sortManager},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"filter",{get:function(){return this._filter},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"showFilterIcons",{get:function(){return!!this._filter&&this._filter.showFilterIcons},set:function(e){this._filter&&this._filter.showFilterIcons!==e&&(this._filter.showFilterIcons=e)},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"definedNames",{get:function(){return this._definedNames},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"enableDragDrop",{get:function(){return this._enableDragDrop},set:function(e){this._enableDragDrop=e},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"enableFormulas",{get:function(){return this._enableFormulas},set:function(e){this._enableFormulas!==e&&(this._enableFormulas=e,this.refresh())},enumerable:!0,configurable:!0}),s.prototype.onSelectedSheetChanged=function(e){this.selectedSheetChanged.raise(this,e)},s.prototype.onDraggingRowColumn=function(e){this.draggingRowColumn.raise(this,e)},s.prototype.onDroppingRowColumn=function(t){e._deprecated("droppingRowColumn","beginDroppingRowColumn and endDroppingRowColumn"),this.droppingRowColumn.raise(this,new e.EventArgs)},s.prototype.onBeginDroppingRowColumn=function(e){this.beginDroppingRowColumn.raise(this,e)},s.prototype.onEndDroppingRowColumn=function(e){this.endDroppingRowColumn.raise(this,e)},s.prototype.onLoaded=function(t){var o=this;o._toRefresh&&(clearTimeout(o._toRefresh),o._toRefresh=null),o._toRefresh=setTimeout(function(){o._setFlexSheetToDirty(),o.invalidate()},10),o.loaded.raise(this,new e.EventArgs)},s.prototype.onUnknownFunction=function(e){this.unknownFunction.raise(this,e)},s.prototype.onSheetCleared=function(t){this.sheetCleared.raise(this,new e.EventArgs)},s.prototype.onPrepareChangingRow=function(e){this.prepareChangingRow.raise(this,e)},s.prototype.onPrepareChangingColumn=function(e){this.prepareChangingColumn.raise(this,e)},s.prototype.onRowChanged=function(e){this.rowChanged.raise(this,e)},s.prototype.onColumnChanged=function(e){this.columnChanged.raise(this,e)},s.prototype.refresh=function(e){var t,o,i;if(void 0===e&&(e=!0),this._divContainer.style.height=this._divContainer.parentElement.clientHeight-(this.isTabHolderVisible?this._tabHolder.getSheetBlanketSize():0)+"px",!this.preserveSelectedState&&this.selectedSheet&&(this.selectedSheet.selectionRanges.clear(),this.selectedSheet.selectionRanges.push(this.selection)),e&&this._clearCalcEngine(),this._lastVisibleFrozenRow=-1,this.frozenRows>0)for(var l=this.frozenRows-1;l>=0;l--)if(this.rows[l]&&this.rows[l].isVisible){this._lastVisibleFrozenRow=l;break}if(this._lastVisibleFrozenColumn=-1,this.frozenColumns>0)for(var s=this.frozenColumns-1;s>=0;s--)if(this.columns[s]&&this.columns[s].isVisible){this._lastVisibleFrozenColumn=s;break}if(this.selectedSheet){if(this.selectedSheet._freezeHiddenRows&&this.selectedSheet._freezeHiddenRows.length>0)for(t=0;t<this.selectedSheet._freezeHiddenRows.length;t++)(o=this.rows[t])instanceof h||!this.selectedSheet._freezeHiddenRows[t]||(o.visible=!1);if(this.selectedSheet._freezeHiddenCols&&this.selectedSheet._freezeHiddenCols.length>0)for(i=0;i<this.selectedSheet._freezeHiddenCols.length;i++)this.selectedSheet._freezeHiddenCols[i]&&(this.columns[i].visible=!1)}n.prototype.refresh.call(this,e),this._tabHolder.adjustSize()},s.prototype.setCellData=function(t,o,n,i,l){void 0===i&&(i=!1),void 0===l&&(l=!0);var s=e.isString(n)&&n.length>1&&"="===n[0];return this._clearCalcEngine(),this.cells.setCellData(t,o,n,i&&!s,l)||this._getHasValidation()},s.prototype.containsFocus=function(){return this.isFunctionListOpen||n.prototype.containsFocus.call(this)},s.prototype.addUnboundSheet=function(e,t,o,n,i){var l=this._addSheet(e,t,o,n,i);return 0===l.selectionRanges.length&&l.selectionRanges.push(this.selection),l},s.prototype.addBoundSheet=function(e,t,o,n){var i=this._addSheet(e,0,0,o,n);return t&&(i.itemsSource=t,this.childItemsPath&&(i.grid.childItemsPath=this.childItemsPath)),0===i.selectionRanges.length&&i.selectionRanges.push(this.selection),i},s.prototype.applyCellsStyle=function(e,o,n){void 0===n&&(n=!1);var i,l,s,r,a,h=null!=o&&o.length>0,d=o||[this.selection];if(this.selectedSheet){if(!e&&this._cloneStyle)return this.selectedSheet._styledCells=this._cloneObject(this._cloneStyle),this._cloneStyle=null,void this.refresh(!1);if(d){for(o||n?n&&!this._cloneStyle&&(this._cloneStyle=this._cloneObject(this.selectedSheet._styledCells)):(this.undoStack.stackSize>0&&(a=new t._CellStyleAction(this,this._cloneStyle)),this._cloneStyle=null),r=0;r<d.length;r++)for(i=(s=d[r]).topRow;i<=s.bottomRow;i++)for(l=s.leftCol;l<=s.rightCol;l++)this._applyStyleForCell(i,l,e,h);a&&(a.saveNewState(),this._undoStack._addAction(a))}o||this.refresh(!1)}},s.prototype.freezeAtCursor=function(){var e,t,o,n,i,l,s=this;if(s.selectedSheet){if(this.selectedSheet._freezeHiddenRows=null,this.selectedSheet._freezeHiddenCols=null,s.selection&&0===s.frozenRows&&0===s.frozenColumns){if(s._ptScrl.y<0)for(this.selectedSheet._freezeHiddenRows=[],e=0;e<s.selection.topRow-1;e++)if(!((i=s.rows[e])instanceof h)){if(!(i._pos+s._ptScrl.y<0&&i.visible))break;i.visible=!1,this.selectedSheet._freezeHiddenRows[e]=!0}if(s._ptScrl.x<0)for(this.selectedSheet._freezeHiddenCols=[],t=0;t<s.selection.leftCol-1&&(l=s.columns[t])._pos+s._ptScrl.x<0&&l.visible;t++)l.visible=!1,this.selectedSheet._freezeHiddenCols[t]=!0;o=s.selection.leftCol>0?s.selection.leftCol:0,n=s.selection.topRow>0?s.selection.topRow:0}else{for(e=0;e<s.frozenRows-1;e++)s.rows[e].visible=!0;for(t=0;t<s.frozenColumns-1;t++)s.columns[t].visible=!0;s._filter.apply(),o=0,n=0}s.frozenRows=s.selectedSheet.grid.frozenRows=n,s.frozenColumns=s.selectedSheet.grid.frozenColumns=o,setTimeout(function(){s._setFlexSheetToDirty(),s.invalidate(),s.scrollIntoView(s.selection.topRow,s.selection.leftCol)},10)}},s.prototype.showColumnFilter=function(){var e=this.selection.col>0?this.selection.col:0;this.columns.length>0&&this._filter.editColumnFilter(this.columns[e])},s.prototype.clear=function(){this.beginUpdate(),this.selection=new e.grid.CellRange,this.sheets.clear(),this._selectedSheetIndex=-1,this.columns.clear(),this.rows.clear(),this.columnHeaders.columns.clear(),this.rowHeaders.rows.clear(),this._undoStack.clear(),this._ptScrl=new e.Point,this._clearCalcEngine(),this._definedNames.clear(),this._builtInTableStylesCache=null,this._copiedRanges=null,this._copiedSheet=null,this._isCutting=!1,this._cutValue=null,this._reservedContent=null,this._lastVisibleFrozenRow=-1,this._lastVisibleFrozenColumn=-1,this.addUnboundSheet(),this.endUpdate()},s.prototype.getSelectionFormatState=function(){var e,t,o=this.rows.length,n=this.columns.length,i={isBold:!1,isItalic:!1,isUnderline:!1,textAlign:"left",isMergedCell:!1};if(0===o||0===n)return i;if(this.selection){if(this.selection.row>=o||this.selection.row2>=o||this.selection.col>=n||this.selection.col2>=n)return i;for(e=this.selection.topRow;e<=this.selection.bottomRow;e++)for(t=this.selection.leftCol;t<=this.selection.rightCol;t++)this._checkCellFormat(e,t,i)}return i},s.prototype.insertRows=function(o,n){var i,l,s,a,d,c,u,_,g,f=this,p=e.isNumber(o)&&o>=0?o:f.selection&&f.selection.topRow>-1?f.selection.topRow:0,w=e.isNumber(n)?n:1,m=f.rows[p],C=!1;if(f.selectedSheet){if(f.rows.length>0?p>=f.rows.length&&(p=f.rows.length-1):p=0,f._clearCalcEngine(),f.finishEditing(),0===p&&m&&m.constructor===h&&(p=1),f.onPrepareChangingRow(new r(p,w,!0)),f.undoStack.stackSize>0&&(i=new t._RowsChangedAction(f,p,w,!0)),f._updateCellsForUpdatingRow(f.rows.length,p,w),(!f.collectionView||0===f.collectionView.sortDescriptions.length)&&(l=f._updateAffectedFormula(p,w,!0,!0),s=f._updateAffectedNamedRanges(p,w,!0,!0)),i&&(i._affectedFormulas=l,i._affectedDefinedNameVals=s),f.collectionView){for(f.selectedSheet._dataView=f.collectionView._view.slice(),C=!0,d=f.itemsSource instanceof e.collections.CollectionView,_=f.autoGenerateColumns,f.autoGenerateColumns=!1,f.collectionView.beginUpdate(),d||(g=f.selectedSheet.grid.autoGenerateColumns,f.selectedSheet.grid.autoGenerateColumns=!1,f.selectedSheet.grid.collectionView.beginUpdate()),a=0;a<w;a++)u=p-(f.allowAddNew&&f.newRowAtTop?2:1),d?(c=f.itemsSource.newItemCreator?f.itemsSource.newItemCreator():{},f.itemsSource.sourceCollection.splice(u,0,c)):(c={},f.itemsSource.splice(u,0,c),f.itemsSource!==f.selectedSheet.grid.itemsSource&&f.selectedSheet.grid.itemsSource.splice(u,0,c)),f.selectedSheet._dataView.splice(u,0,c);f._updateItemIndexForInsertingRow(f.collectionView.sourceCollection,u,w),d||(f.selectedSheet.grid.collectionView.endUpdate(),f.selectedSheet.grid.autoGenerateColumns=g),f.collectionView.endUpdate(),f.collectionView.sortDescriptions.length>0&&(f.collectionView._view=f.selectedSheet._dataView,f.collectionView._pgView=f.collectionView._getPageView(),d||(f.selectedSheet.grid.collectionView._view=f.selectedSheet._dataView,f.selectedSheet.grid.collectionView._pgView=f.selectedSheet.grid.collectionView._getPageView()),f._bindGrid(!1),f.selectedSheet.grid._bindGrid(!1)),setTimeout(function(){f._filter.apply()}),f.autoGenerateColumns=_}else{for(f.rows.beginUpdate(),a=0;a<w;a++)f.rows.insert(p,new e.grid.Row);f.rows.endUpdate()}f._updateTablesForUpdatingRow(p,w),f.selection&&-1!==f.selection.row&&-1!==f.selection.col||(f.selection=new e.grid.CellRange(0,0)),i&&(i.saveNewState(),f._undoStack._addAction(i)),f.onRowChanged(new r(p,w,!0)),C&&f.refresh()}},s.prototype.deleteRows=function(o,n){var i,l,s,a,d,c,u,_,g,f,p,w,m,C=e.isNumber(n)&&n>=0?n:this.selection&&this.selection.topRow>-1?this.selection.bottomRow-this.selection.topRow+1:1,b=e.isNumber(o)&&o>=0?o:this.selection&&this.selection.topRow>-1?this.selection.topRow:-1,S=e.isNumber(o)&&o>=0?o+C-1:this.selection&&this.selection.topRow>-1?this.selection.bottomRow:-1,y=!1;if(this.selectedSheet&&!(b>=this.rows.length)&&(S=Math.min(S,this.rows.length-1),this._clearCalcEngine(),this.finishEditing(),b>-1&&S>-1)){for(this.onPrepareChangingRow(new r(b,C,!1)),this.undoStack.stackSize>0&&(i=new t._RowsChangedAction(this,b,C,!1)),this._updateCellsForUpdatingRow(this.rows.length,b,C,!0),s=this._updateAffectedFormula(S,S-b+1,!1,!0),a=this._updateAffectedNamedRanges(S,S-b+1,!1,!0),d=this._updateTablesForUpdatingRow(b,C,!0),i&&(i._affectedFormulas=s,i._affectedDefinedNameVals=a,i._deletedTables=d),l=C===this.rows.length,p=(y=!!this.collectionView)&&this.itemsSource instanceof e.collections.CollectionView,this.rows.beginUpdate(),y&&(this.selectedSheet._dataView=this.collectionView._view.slice(),w=this.autoGenerateColumns,this.autoGenerateColumns=!1,this.collectionView.beginUpdate(),p||(m=this.selectedSheet.grid.autoGenerateColumns,this.selectedSheet.grid.autoGenerateColumns=!1,this.selectedSheet.grid.collectionView.beginUpdate()));S>=b;S--)(!(c=this.rows[S])||(c.constructor!==h||l)&&c.isVisible)&&(c.dataItem&&this.collectionView?(u=this._getCvIndex(S))>-1&&(_=this.collectionView.items[u],p?(g=this.itemsSource.sourceCollection.indexOf(_),this.itemsSource.sourceCollection.splice(g,1)):(g=this.itemsSource.indexOf(_),this.itemsSource.splice(g,1),this.itemsSource!==this.selectedSheet.grid.itemsSource&&this.selectedSheet.grid.itemsSource.splice(g,1)),this.selectedSheet._dataView.splice(this.selectedSheet._dataView.indexOf(_),1),this._updateItemIndexForRemovingRow(this.collectionView.sourceCollection,g)):this.rows.removeAt(S));y&&(p||(this.selectedSheet.grid.collectionView.endUpdate(),this.selectedSheet.grid.autoGenerateColumns=m),this.collectionView.endUpdate(),this.collectionView.sortDescriptions.length>0&&(this.collectionView._view=this.selectedSheet._dataView,this.collectionView._pgView=this.collectionView._getPageView(),p||(this.selectedSheet.grid.collectionView._view=this.selectedSheet._dataView,this.selectedSheet.grid.collectionView._pgView=this.selectedSheet.grid.collectionView._getPageView()),this._bindGrid(!1),this.selectedSheet.grid._bindGrid(!1)),this.autoGenerateColumns=w),this.rows.endUpdate(),f=this.rows.length,this.selectedSheet.selectionRanges.clear(),0===f?(this.select(new e.grid.CellRange),"move"===this.hostElement.style.cursor&&(this.hostElement.style.cursor="default")):S===f-1?this.select(new e.grid.CellRange(S,0,S,this.columns.length-1)):this.select(new e.grid.CellRange(this.selection.topRow,this.selection.col,this.selection.topRow,this.selection.col2)),i&&(i.saveNewState(),this._undoStack._addAction(i)),this.onRowChanged(new r(b,C,!1)),y&&this.refresh()}},s.prototype.insertColumns=function(o,n){var i,l,s,a,h,d,c=e.isNumber(o)&&o>=0?o:this.selection&&this.selection.leftCol>-1?this.selection.leftCol:0,u=e.isNumber(n)?n:1;if(this.selectedSheet){for(this.columns.length>0?c>=this.columns.length&&(c=this.columns.length-1):c=0,this._clearCalcEngine(),this.finishEditing(),this.onPrepareChangingColumn(new r(c,u,!0)),this.undoStack.stackSize>0&&(i=new t._ColumnsChangedAction(this,c,u,!0)),this._updateCellsForUpdatingColumn(this.columns.length,c,u),h=this._updateAffectedFormula(c,u,!0,!1),d=this._updateAffectedNamedRanges(c,u,!0,!1),i&&(i._affectedFormulas=h,i._affectedDefinedNameVals=d),this.columns.beginUpdate(),s=0;s<u;s++)(l=new e.grid.Column).isRequired=!1,this.itemsSource&&(l.binding=this._getUniqueColumnName(),(a=this.allowAddNew&&this.newRowAtTop?this.rows[1]:this.rows[0])&&(a._ubv||(a._ubv={}),a._ubv[l._hash]=e.toHeaderCase(l.binding))),this.columns.insert(c,l);this.columns.endUpdate(),this.selectedSheet._filterDefinition=this._filter.filterDefinition,this._sortManager._updateSortSortDescription(c,u),this._sortManager.commitSort(!1),this._updateTablesForUpdatingColumn(c,u),this.selection&&-1!==this.selection.row&&-1!==this.selection.col||(this.selection=new e.grid.CellRange(0,0)),i&&(i.saveNewState(),this._undoStack._addAction(i)),this.onColumnChanged(new r(c,u,!0))}},s.prototype.deleteColumns=function(o,n){var i,l,s,a,h,d=e.isNumber(n)&&n>=0?n:this.selection&&this.selection.leftCol>-1?this.selection.rightCol-this.selection.leftCol+1:1,c=e.isNumber(o)&&o>=0?o:this.selection&&this.selection.leftCol>-1?this.selection.leftCol:-1,u=e.isNumber(o)&&o>=0?o+d-1:this.selection&&this.selection.leftCol>-1?this.selection.rightCol:-1;if(this.selectedSheet&&!(c>=this.columns.length)&&(u=Math.min(u,this.columns.length-1),this._clearCalcEngine(),this.finishEditing(),c>-1&&u>-1)){for(this.onPrepareChangingColumn(new r(c,d,!1)),this.undoStack.stackSize>0&&(l=new t._ColumnsChangedAction(this,c,d,!1)),this._updateCellsForUpdatingColumn(this.columns.length,c,d,!0),s=this._updateAffectedFormula(u,u-c+1,!1,!1),a=this._updateAffectedNamedRanges(u,u-c+1,!1,!1),h=this._updateTablesForUpdatingColumn(c,d,!0),l&&(l._affectedFormulas=s,l._affectedDefinedNameVals=a,l._deletedTables=h),this.columns.beginUpdate();u>=c;u--)this.columns[u].isVisible&&(this.columns.removeAt(u),this._sortManager.deleteSortLevel(u));this.columns.endUpdate(),this.selectedSheet._filterDefinition=this._filter.filterDefinition,this._sortManager._updateSortSortDescription(c,d,!1),this._sortManager.commitSort(!1),i=this.columns.length,this.selectedSheet.selectionRanges.clear(),0===i?(this.select(new e.grid.CellRange),"move"===this.hostElement.style.cursor&&(this.hostElement.style.cursor="default")):u===i-1?this.select(new e.grid.CellRange(0,u,this.rows.length-1,u)):this.select(new e.grid.CellRange(this.selection.row,this.selection.leftCol,this.selection.row2,this.selection.leftCol)),l&&(l.saveNewState(),this._undoStack._addAction(l)),this.onColumnChanged(new r(c,d,!1))}},s.prototype.mergeRange=function(o,n){void 0===n&&(n=!1);var i,l,s,r,a,h=o||this.selection,d=-1,c=-1;if(this.selectedSheet){if(h){if(1===h.rowSpan&&1===h.columnSpan)return;for(i=h.topRow;i<=h.bottomRow;i++)for(l=h.leftCol;l<=h.rightCol;l++)if(this.selectedSheet.findTable(i,l))return;if(o||n||(this.undoStack.stackSize>0&&(a=new t._CellMergeAction(this)),this.hostElement.focus()),!this._resetMergedRange(h)){for(i=h.topRow;i<=h.bottomRow;i++)if((s=this.rows[i])&&s.isVisible){d=i;break}for(l=h.leftCol;l<=h.rightCol;l++)if((r=this.columns[l])&&r.isVisible){c=l;break}d>-1&&c>-1&&this.selectedSheet._mergedRanges.push(new e.grid.CellRange(d,c,h.bottomRow,h.rightCol))}a&&(a.saveNewState(),this._undoStack._addAction(a))}o||this.refresh()}},s.prototype.getMergedRange=function(t,o,i,l){void 0===l&&(l=!0);var s,r,a,h,d=this.selectedSheet?this.selectedSheet._getMergedRange(o,i):null;return t===this.cells&&d?!d.isSingleCell&&(this.frozenRows>0||this.frozenColumns>0)&&(d.topRow<this.frozenRows&&d.bottomRow>=this.frozenRows||d.leftCol<this.frozenColumns&&d.rightCol>=this.frozenColumns)?(s=d.topRow,r=d.bottomRow,a=d.leftCol,h=d.rightCol,o>=this.frozenRows&&d.topRow<this.frozenRows&&(s=this.frozenRows),o<this.frozenRows&&d.bottomRow>=this.frozenRows&&(r=this.frozenRows-1),r>=this.rows.length&&(r=this.rows.length-1),i>=this.frozenColumns&&d.leftCol<this.frozenColumns&&(a=this.frozenColumns),i<this.frozenColumns&&d.rightCol>=this.frozenColumns&&(h=this.frozenColumns-1),h>=this.columns.length&&(h=this.columns.length-1),new e.grid.CellRange(s,a,r,h)):d.bottomRow>=this.rows.length?new e.grid.CellRange(d.topRow,d.leftCol,this.rows.length-1,d.rightCol):d.rightCol>=this.columns.length?new e.grid.CellRange(d.topRow,d.leftCol,d.bottomRow,this.columns.length-1):d.clone():i>=0&&this.columns&&this.columns.length>i&&o>=0&&this.rows&&this.rows.length>o?n.prototype.getMergedRange.call(this,t,o,i,l):null},s.prototype.evaluate=function(t,o,n,i){void 0===i&&(i=!0);var l=this._evaluate(t,o,n);return i&&null!=l&&!e.isPrimitive(l)?l.value:l},s.prototype.getCellValue=function(t,o,n,i){void 0===n&&(n=!1);var l,s,r=i&&i!==this.selectedSheet?i.grid.columns[o]:this.columns[o],a=this._getCellStyle(t,o,i);return l=a&&a.format?a.format:"",s=i&&i!==this.selectedSheet?i.grid.getCellData(t,o,!1):this.getCellData(t,o,!1),e.isString(s)&&"="===s[0]&&(s=this._evaluate(s,n?l:"",i,t,o)),n?(l||null==s||e.isPrimitive(s)||(l=s.format),s=this._formatEvaluatedResult(s,r,l)):null==s||e.isPrimitive(s)||(s=s.value),null==s?"":s},s.prototype.showFunctionList=function(t){var o,n,i=this,l=i._cumulativeOffset(t),s=i._cumulativeOffset(i._root);i._enableFormulas&&(i._functionTarget=e.tryCast(t,HTMLInputElement),i._functionTarget&&i._functionTarget.value&&"="===i._functionTarget.value[0]?(i._functionList._cv.filter=function(e){var t,o=e.actualvalue.toLowerCase(),n=i._getCurrentFormulaIndex(i._functionTarget.value);return-1===n&&(n=0),(t=i._functionTarget.value.substr(n+1).trim().toLowerCase()).length>0&&0===o.indexOf(t)||"="===i._functionTarget.value},i._functionList.selectedIndex=0,o=l.y+t.clientHeight+2+(e.hasClass(t,"wj-grid-editor")?this._ptScrl.y:0),n=l.x+(e.hasClass(t,"wj-grid-editor")?this._ptScrl.x:0),e.setCss(i._functionListHost,{height:i._functionList._cv.items.length>5?"218px":"auto",display:i._functionList._cv.items.length>0?"block":"none",top:"",left:""}),i._functionListHost.scrollTop=0,i._functionListHost.offsetHeight+o>s.y+i._root.offsetHeight?o=o-t.clientHeight-i._functionListHost.offsetHeight-5:o+=5,i._functionListHost.offsetWidth+n>s.x+i._root.offsetWidth&&(n=s.x+i._root.offsetWidth-i._functionListHost.offsetWidth),e.setCss(i._functionListHost,{top:o,left:n})):i.hideFunctionList())},s.prototype.hideFunctionList=function(){this._functionListHost.style.display="none"},s.prototype.selectPreviousFunction=function(){this._functionList.selectedIndex>0&&this._functionList.selectedIndex--},s.prototype.selectNextFunction=function(){this._functionList.selectedIndex<this._functionList.itemsSource.length&&this._functionList.selectedIndex++},s.prototype.applyFunctionToCell=function(){var e;this._functionTarget&&(-1===(e=this._getCurrentFormulaIndex(this._functionTarget.value))?e=this._functionTarget.value.indexOf("="):e+=1,this._functionTarget.value=this._functionTarget.value.substring(0,e)+this._functionList.selectedValue+"(","="!==this._functionTarget.value[0]&&(this._functionTarget.value="="+this._functionTarget.value),this._functionTarget.focus(),this.hideFunctionList())},s.prototype.save=function(e,t){var o=this._saveToWorkbook(t);return e&&o.save(e),o},s.prototype.saveAsync=function(e,t,o,n){var i=this._saveToWorkbook(n);return i.saveAsync(e,t,o),i},s.prototype.saveToWorkbookOM=function(e){return this._saveToWorkbook(e)._serialize()},s.prototype.load=function(t){var o,n,i=this;if(t instanceof Blob)(n=new FileReader).onload=function(){var t=n.result;t=e.xlsx.Workbook._base64EncArr(new Uint8Array(t)),(o=new e.xlsx.Workbook).load(t),i._loadFromWorkbook(o)},n.readAsArrayBuffer(t);else if(t instanceof e.xlsx.Workbook)i._loadFromWorkbook(t);else{if(t instanceof ArrayBuffer)t=e.xlsx.Workbook._base64EncArr(new Uint8Array(t));else if(!e.isString(t))throw"Invalid workbook.";(o=new e.xlsx.Workbook).load(t),i._loadFromWorkbook(o)}},s.prototype.loadAsync=function(t,o,n){var i,l=this;if(t instanceof Blob)(i=new FileReader).onload=function(){var t=i.result;t=e.xlsx.Workbook._base64EncArr(new Uint8Array(t)),(new e.xlsx.Workbook).loadAsync(t,function(e){l._loadFromWorkbook(e),o&&o(e)},n)},i.readAsArrayBuffer(t);else if(t instanceof e.xlsx.Workbook)l._loadFromWorkbook(t),o&&o(t);else{if(t instanceof ArrayBuffer)t=e.xlsx.Workbook._base64EncArr(new Uint8Array(t));else if(!e.isString(t))throw"Invalid workbook.";(new e.xlsx.Workbook).loadAsync(t,function(e){l._loadFromWorkbook(e),o&&o(e)},n)}},s.prototype.loadFromWorkbookOM=function(t){var o;t instanceof e.xlsx.Workbook?o=t:(o=new e.xlsx.Workbook)._deserialize(t),this._loadFromWorkbook(o)},s.prototype.undo=function(){var e=this;setTimeout(function(){e._undoStack.undo()},100)},s.prototype.redo=function(){var e=this;setTimeout(function(){e._undoStack.redo()},100)},s.prototype.select=function(t,o){var i,l,s;if(void 0===o&&(o=!0),e.isNumber(t)&&e.isNumber(o)&&(t=new e.grid.CellRange(t,o),o=!0),t.rowSpan!==this.rows.length&&t.columnSpan!==this.columns.length)for(l=t.topRow;l<=t.bottomRow;l++)for(s=t.leftCol;s<=t.rightCol;s++)(i=this.getMergedRange(this.cells,l,s))&&!t.equals(i)&&(t.row<=t.row2?(t.row=Math.min(t.topRow,i.topRow),t.row2=Math.max(t.bottomRow,i.bottomRow)):(t.row=Math.max(t.bottomRow,i.bottomRow),t.row2=Math.min(t.topRow,i.topRow)),t.col<=t.col2?(t.col=Math.min(t.leftCol,i.leftCol),t.col2=Math.max(t.rightCol,i.rightCol)):(t.col=Math.max(t.rightCol,i.rightCol),t.col2=Math.min(t.leftCol,i.leftCol)));this._isPasting&&this.collectionView&&(this.collectionView._pendingRefresh=!1),this._enableMulSel||this.selectedSheet.selectionRanges.clear(),n.prototype.select.call(this,t,o)},s.prototype.addCustomFunction=function(t,o,n,i,l){e._deprecated("addCustomFunction","addFunction"),this._calcEngine.addCustomFunction(t,o,i,l),this._addCustomFunctionDescription(t,n)},s.prototype.addFunction=function(e,t,o,n,i){this._calcEngine.addFunction(e,t,n,i),this._addCustomFunctionDescription(e,o)},s.prototype.dispose=function(){var e=window.navigator.userAgent;this._needCopyToSheet=!1,this.removeEventListener(document.body,"mousemove",this._mouseMoveHdl),this.removeEventListener(document.body,"keydown",this._keydownHdl),this.removeEventListener(document.body,"click",this._clickHdl),(e.match(/iPad/i)||e.match(/iPhone/i))&&(this.removeEventListener(document.body,"touchstart",this._touchStartHdl),this.removeEventListener(document.body,"touchend",this._touchEndHdl)),this.hideFunctionList(),n.prototype.dispose.call(this)},s.prototype.getClipString=function(t){var o,i,l,s,r,a,h="",d=!0;if(!this.selectedSheet)return n.prototype.getClipString.call(this,t);if(this._isCutting=!1,!t)if(this.selectedSheet.selectionRanges.length>1){if(this._isMultipleRowsSelected()){for(h="",0===(o=this.selectedSheet.selectionRanges.slice(0)).length&&(o=[this.selection]),o.sort(this._sortByRow),l=0;l<o.length;l++)h&&(h+="\n"),h+=this.getClipString(o[l]);return h}if(this._isMultipleColumnsSelected()){for(h="",0===(o=this.selectedSheet.selectionRanges.slice(0)).length&&(o=[this.selection]),o.sort(this._sortByColumn),i=(s=o[0]).topRow,d=!0;i<=s.bottomRow;i++)for(d||(h+="\n"),d=!1,l=0,g=!0;l<o.length;l++)r=o[l],g||(h+="\t"),g=!1,h+=this.getClipString(new e.grid.CellRange(i,r.col,i,r.col2));return h}e.assert(!1,"Copy or Cut operation cannot be used on multiple selections.")}else switch(t=this.selection,this.selectionMode){case e.grid.SelectionMode.Row:case e.grid.SelectionMode.RowRange:t.col=0,t.col2=this.columns.length-1;break;case e.grid.SelectionMode.ListBox:t.col=0,t.col2=this.columns.length-1;for(var c=0;c<this.rows.length;c++)this.rows[c].isSelected&&this.rows[c].isVisible&&(t.row=t.row2=c,h&&(h+="\n"),h+=this.getClipString(t));return h}if(!(t=e.asType(t,e.grid.CellRange)).isValid)return"";var u=t.topRow;for(d=!0;u<=t.bottomRow;u++)if(this.rows[u].isVisible){d||(h+="\n"),d=!1;for(var _=t.leftCol,g=!0;_<=t.rightCol;_++)this.columns[_].isVisible&&(g||(h+="\t"),g=!1,(a=(a=this.getCellValue(u,_,!0).toString()).replace(/\t/g," ")).indexOf("\n")>-1&&(a='"'+a.replace(/"/g,'""')+'"'),h+=a)}return h},s.prototype.setClipString=function(t,o){var i,l,s,r,a,h,d,c,u,_,g,f,p,w,m,C,b,S,y,R,v,x,T,I,k=null==o,E=!1,A=this.editableCollectionView;if(this.selectedSheet){if(o=o?e.asType(o,e.grid.CellRange):this.selection,(t=e.asString(t).replace(/\r\n/g,"\n").replace(/\r/g,"\n"))&&"\n"==t[t.length-1]&&(t=t.substring(0,t.length-1)),x=t,c=this._edtHdl._parseClipString(e.asString(t)),k&&!o.isSingleCell&&c.length&&this._edtHdl._expandClipRows(c,o),y=this._containsMultiLineText(c),(!this._copiedRanges||0===this._copiedRanges.length||x.trim()!==this._getRangeString(this._copiedRanges,this._copiedSheet).trim()&&!this._containsRandFormula(this._copiedRanges,this._copiedSheet)||this._cutValue)&&!y)return x!==this._cutValue&&(this._cutValue=null,n.prototype.setClipString.call(this,t)),this._copiedRanges=null,void(this._copiedSheet=null);if(T=this._getRangeString(this._copiedRanges,this._copiedSheet,!1),(T=e.asString(T).replace(/\r\n/g,"\n").replace(/\r/g,"\n"))&&"\n"==T[T.length-1]&&(T=T.substring(0,T.length-1)),c=this._edtHdl._parseClipString(e.asString(T)),k&&!o.isSingleCell&&c.length&&this._edtHdl._expandClipRows(c,o),(r=o.topRow+c.length-1)>=this.rows.length&&(r=this.rows.length-1),(a=o.leftCol+c[0].length-1)>=this.columns.length&&(a=this.columns.length-1),i=new e.grid.CellRange(o.topRow,o.leftCol,r,a),!this.onPasting(new e.grid.CellRangeEventArgs(this.cells,i)))return this._cutValue=null,this._copiedRanges=null,this._copiedSheet=null,!1;if(this.beginUpdate(),y||!this._copiedRanges||this._copiedRanges.length>1||0===this._copiedRanges.length)for(l=o.topRow,h=(S=this._copiedRanges&&this._copiedRanges.length>1?this._copiedRanges[0]:new e.grid.CellRange).topRow,g=0;g<c.length&&l<this.rows.length;g++,l++)if(this.rows[l].isVisible){for(u=c[g],d=S.leftCol,w=(s=o.leftCol)-d,f=0;f<u.length&&s<this.columns.length;f++,s++)this.columns[s].isVisible?(_=u[f],this.columns[s].isReadOnly||this.rows[l].isReadOnly||(E=this._postSetClipStringProcess(_,l,s,h,d,A),i.row2=Math.max(i.row2,l),i.col2=Math.max(i.col2,s)),d>=0&&d++):f--;h>=0&&h++}else g--;else if(this._copiedRanges&&1===this._copiedRanges.length)for(R=0,S=this.selectionMode===e.grid.SelectionMode.ListBox?this._getSelectionForListBoxMode(this._copiedSheet.grid):this._copiedRanges[0],l=o.topRow,g=0;g<c.length&&l<this.rows.length;g++,l++)if(v=0,this.rows[l].isVisible){for(;this._copiedSheet.grid.rows[S.topRow+R]&&!this._copiedSheet.grid.rows[S.topRow+R].isVisible;)R++;if(R>=S.rowSpan&&(R%=S.rowSpan),!this._copiedSheet.grid.rows[S.topRow+R])break;for(p=l-S.topRow-R,u=c[g],s=o.leftCol,f=0;f<u.length&&s<this.columns.length;f++,s++)if(this.columns[s]&&this.columns[s].isVisible){if(v>=S.columnSpan&&(v%=S.columnSpan),!this._copiedSheet.grid.columns[S.leftCol+v])break;if(w=s-S.leftCol-v,!this.columns[s].isReadOnly&&!this.rows[l].isReadOnly){if(_=u[f],I=this._getCellStyle(S.topRow+R,S.leftCol+v,this._copiedSheet),_&&"string"==typeof _&&"="===_[0]&&(0!==p||0!==w))try{m=this._calcEngine._parse(_),C=new e.grid.CellRange(S.topRow+R,S.leftCol+v),b=new e.grid.CellRange(S.topRow+R+p,S.leftCol+v+w),m._moveCellRangeExp(this.selectedSheetIndex,C,b,!1,!0)&&(_="="+m._getStringExpression())}catch(e){}this._copiedSheet.grid.columns[S.leftCol+v].format&&!this.columns[s].format&&(I?I.format||(I.format=this._copiedSheet.grid.columns[S.leftCol+v].format):I={format:this._copiedSheet.grid.columns[S.leftCol+v].format}),E=this._postSetClipStringProcess(_,l,s,S.topRow+R,S.leftCol+v,A,I),i.row2=Math.max(i.row2,l),i.col2=Math.max(i.col2,s)}v++}else f--;R++}else g--;this._isCutting&&(this._delCutData(c.length,c[0].length),this._isCutting=!1,this._cutValue=x,this._copiedRanges=null,this._copiedSheet=null),this.endUpdate(),this.collectionView&&E&&this.collectionView.refresh(),this.select(i),this.onPasted(new e.grid.CellRangeEventArgs(this.cells,i))}else n.prototype.setClipString.call(this,t,o)},s.prototype.getBuiltInTableStyle=function(e){var t;return null==this._builtInTableStylesCache&&(this._builtInTableStylesCache={}),null==(t=this._builtInTableStylesCache[e.toLowerCase()])&&(t=this._createBuiltInTableStyle(e),Object.freeze(t),this._builtInTableStylesCache[e.toLowerCase()]=t),t},s.prototype._getCvIndex=function(e){return e>-1&&this.collectionView?this.rows[e]instanceof h?e:n.prototype._getCvIndex.call(this,e):-1},s.prototype._bindGrid=function(e){this.itemsSource&&n.prototype._bindGrid.call(this,e)},s.prototype._init=function(){var o=this,n=this,i=window.navigator.userAgent,l=function(e){document.removeEventListener("mouseup",l),n._mouseUp(e)};n.hostElement.setAttribute("tabindex","-1"),n._divContainer=n.hostElement.querySelector('[wj-part="container"]'),n._tabHolder=new t._TabHolder(n.hostElement.querySelector('[wj-part="tab-holder"]'),n),n._contextMenu=new t._SheetContextMenu(n.hostElement.querySelector('[wj-part="context-menu"]'),n),n._gpCells=new a(n,e.grid.CellType.Cell,n.rows,n.columns,n._eCt),n._gpCHdr=new a(n,e.grid.CellType.ColumnHeader,n._hdrRows,n.columns,n._eCHdrCt),n._gpRHdr=new a(n,e.grid.CellType.RowHeader,n.rows,n._hdrCols,n._eRHdrCt),n._gpTL=new a(n,e.grid.CellType.TopLeft,n._hdrRows,n._hdrCols,n._eTLCt),n._syncSelection=n._flexSheetSyncSelection.bind(n),n._sortManager=new t.SortManager(n),n._filter=new t.FlexSheetFilter(n),n._filter.filterApplied.addHandler(function(){n.selectedSheet&&(n.selectedSheet._filterDefinition=n._filter.filterDefinition,n.selectedSheet.itemsSource&&(n.selectedSheet._storeRowSettings(),n.selectedSheet._setRowSettings()))}),n._calcEngine=new t._CalcEngine(n),n._calcEngine.unknownFunction.addHandler(function(e,t){n.onUnknownFunction(t)},n),n._initFuncsList(),n._undoStack=new t.UndoStack(n),n.loadedRows.addHandler(function(){if(n.collectionView&&!(n.rows[0]instanceof h)&&!n._headerRowRemoved){var t,o=new h;o.isReadOnly=!0;for(var i=0;i<n.columns.length;i++)t=n.columns[i],o._ubv||(o._ubv={}),o._ubv[t._hash]=e.toHeaderCase(t.binding);n.rows[0]instanceof e.grid._NewRowTemplate&&n.newRowAtTop?n.rows.insert(1,o):n.rows.insert(0,o)}n._filter&&n._filter.apply()}),n.itemsSourceChanged.addHandler(function(){var e;for(e=0;e<n.columns.length;e++)n.columns[e].isRequired=!1;n.collectionView&&n.collectionView.currentChanged.removeHandler(o._cvCurrentChanged,o)}),n.copied.addHandler(function(t,o){var i;n.selectedSheet&&(n._copiedSheet=n.selectedSheet,n._needCopyToSheet=!0,n.selectedSheet.selectionRanges.length>1?n._isMultipleRowsSelected()?((i=n.selectedSheet.selectionRanges.slice(0)).sort(n._sortByRow),n._copiedRanges=i):n._isMultipleColumnsSelected()?((i=n.selectedSheet.selectionRanges.slice(0)).sort(n._sortByColumn),n._copiedRanges=i):e.assert(!1,"Copy operation cannot be used on multiple selections."):n._copiedRanges=[o.range])}),n.rows.collectionChanged.addHandler(function(t,o){n._clearForEmptySheet("rows"),n.itemsSource||!n.selectedSheet||!n._needCopyToSheet||n._isCopying||n._isUndoing||o.item instanceof e.grid._NewRowTemplate||n._copyRowsToSelectedSheet(),n.itemsSource&&n.selectedSheet&&o.action===e.collections.NotifyCollectionChangedAction.Remove&&o.item instanceof h&&(n._headerRowRemoved=!0)},n),n.columns.collectionChanged.addHandler(function(e,t){n._clearForEmptySheet("columns"),n.selectedSheet&&n._needCopyToSheet&&!n._isCopying&&!n._isUndoing&&n._copyColumnsToSelectedSheet()},n),n.definedNames.collectionChanged.addHandler(function(t,o){if(o.action===e.collections.NotifyCollectionChangedAction.Add||o.action===e.collections.NotifyCollectionChangedAction.Change){var i=o.action===e.collections.NotifyCollectionChangedAction.Add?"inserted":"updated";if(!(o.item instanceof c))throw n.definedNames.remove(o.item),"Invalid defined name item object was "+i+".  The DefinedName instance should be "+i+" in the definedNames array.";if(!o.item||!o.item.name||null==o.item.value)throw n.definedNames.remove(o.item),"Invalid defined name was "+i+".";if(null!=o.item.sheetName&&!n._validateSheetName(o.item.sheetName))throw n.definedNames.remove(o.item),"The sheet name ("+o.item.sheetName+") does not exist in FlexSheet.";if(n._checkExistDefinedName(o.item.name,o.item.sheetName,o.index))throw n.definedNames.remove(o.item),"The "+o.item.name+" already existed in definedNames."}}),n.addEventListener(n.hostElement,"mousedown",function(e){document.addEventListener("mouseup",l),n._isDescendant(n._divContainer,e.target)&&n._mouseDown(e)},!0),n.addEventListener(n.hostElement,"drop",function(){n._columnHeaderClicked=!1,n._htDown=null}),n.addEventListener(n.hostElement,"contextmenu",function(t){var o,i,l,s,r,a,h,d,c;if(!t.defaultPrevented&&n.selectedSheet){if(!n.activeEditor&&(n._isContextMenuKeyDown&&n.selection.row>-1&&n.selection.col>-1&&n.rows.length>0&&n.columns.length>0?(l=n.columns[n.selection.col],i=n.rows[n.selection.row],h=n._cumulativeOffset(n.hostElement),d=n._cumulativeScrollOffset(n.hostElement),s=l.pos+n._eCt.offsetLeft+h.x+l.renderSize/2+n._ptScrl.x,r=i.pos+n._eCt.offsetTop+h.y+i.renderSize/2+n._ptScrl.y,a=new e.Point(s-d.x,r-d.y),o=n.hitTest(s,r)):o=n.hitTest(t),t.preventDefault(),o&&o.cellType!==e.grid.CellType.None)){switch(o.cellType){case e.grid.CellType.TopLeft:c=new e.grid.CellRange(0,0,n.rows.length-1,n.columns.length-1);break;case e.grid.CellType.RowHeader:c=new e.grid.CellRange(o.row,0,o.row,n.columns.length-1);break;case e.grid.CellType.ColumnHeader:c=new e.grid.CellRange(n.itemsSource&&n.rows[0]&&!n.rows[0].isVisible?1:0,o.col,n.rows.length-1,o.col);break;case e.grid.CellType.Cell:c=new e.grid.CellRange(o.row,o.col)}n.selection.contains(c)&&(c=null),c&&(n.selectedSheet&&(n.selectedSheet.selectionRanges.clear(),n.selectedSheet.selectionRanges.push(c)),n.selection=c),n._contextMenu.show(t,a)}n._isContextMenuKeyDown=!1}}),n.prepareCellForEdit.addHandler(n._prepareCellForEditHandler,n),n.cellEditEnded.addHandler(function(e,t){(!t.data||46!==t.data.keyCode&&8!==t.data.keyCode)&&setTimeout(function(){n.hideFunctionList()},200)}),n.cellEditEnding.addHandler(function(e,o){var i,l,s;(!o.data||46!==o.data.keyCode&&8!==o.data.keyCode)&&(i=n.getCellData(o.row,o.col,!1),l=n.cellFactory.getEditorValue(n),null!=i&&""!==i||null==l||""===l||isNaN(+l)||(s=n._updateFormulaBoundaryForEditingCell(o.row,o.col),n._undoStack._pendingAction&&n._undoStack._pendingAction instanceof t._EditAction&&(n._undoStack._pendingAction._affectedFormulas=s)),n._clearCalcEngine())}),n.rowEditEnding.addHandler(function(e,t){var o=n.collectionView;o&&(n._orgRowVisible=n.rows[t.row].visible,o.sortDescriptions.length>0&&(n.selectedSheet._dataView=o._view.slice(),n.selectedSheet._scrollPosition=n.scrollPosition))}),n.rowEditEnded.addHandler(function(t,o){var i=n.collectionView;i&&(i.sortDescriptions.length>0&&(i._view=n.selectedSheet._dataView,i._pgView=i._getPageView(),n.itemsSource instanceof e.collections.CollectionView||(n.selectedSheet.grid.collectionView._view=n.selectedSheet._dataView,n.selectedSheet.grid.collectionView._pgView=n.selectedSheet.grid.collectionView._getPageView()),n._bindGrid(!1),n.selectedSheet.grid._bindGrid(!1),n.scrollPosition=n.selectedSheet._scrollPosition),n.rows[o.row].visible=n._orgRowVisible)}),n.pasting.addHandler(function(){n._needCopyToSheet=!1,n._isPasting=!0}),n.pasted.addHandler(function(){n.selection,n._needCopyToSheet=!0,n._isPasting=!1,n._clearCalcEngine()}),n.resizingColumn.addHandler(function(){n._resizing=!0}),n.resizingRow.addHandler(function(){n._resizing=!0}),n.resizedColumn.addHandler(function(){n._resizing=!1}),n.resizedRow.addHandler(function(){n._resizing=!1}),n.selectionChanged.addHandler(function(){var t=n.selection;n._isCopying||!t.isValid||n.containsFocus()||n.hostElement.focus(),t.rightCol>=n.columns.length&&(n.selection=new e.grid.CellRange(t.row,Math.min(t.col,n.columns.length-1),t.row2,Math.min(n.selection.col2,n.columns.length-1))),n._enableMulSel||n._isCopying||!n.selectedSheet||n.selectedSheet.selectionRanges.clear()}),n.addEventListener(n.hostElement,"keydown",function(t){var o,i,l=!1,s=!1;if(t.ctrlKey){if(89===t.keyCode&&(n.finishEditing(),n.redo(),t.preventDefault()),90===t.keyCode&&(n.finishEditing(),n.undo(),t.preventDefault()),n.selectedSheet&&65===t.keyCode&&(n.selectedSheet.selectionRanges.clear(),n.selectedSheet.selectionRanges.push(n.selection)),67!==t.keyCode&&45!=t.keyCode||(n.activeEditor&&(n._copiedRanges=null,n._copiedSheet=null),n._cutValue=null),88===t.keyCode&&!n.activeEditor){if(t.stopPropagation(),n.selectionMode===e.grid.SelectionMode.ListBox)for(var r=0;r<n.rows.length;r++)if(n.rows[r].isSelected)if(l){if(s)continue;e.assert(!1,"Cut operation cannot be used on multiple selections.")}else l=!0,s=!0;else s&&(s=!1);n.selectedSheet.selectionRanges.length>1?e.assert(!1,"Cut operation cannot be used on multiple selections."):(n.finishEditing(),o=new e.grid.CellRangeEventArgs(n.cells,n.selection),n.onCopying(o)&&(n._cutValue=null,i=n.getClipString(),n._isCutting=!0,e.Clipboard.copy(i),n.onCopied(o)))}t.keyCode===e.Key.Space&&n.selection.isValid&&n.selectionMode===e.grid.SelectionMode.CellRange&&n.select(new e.grid.CellRange(0,n.selection.col,n.rows.length-1,n.selection.col))}t.keyCode===e.Key.Escape&&n._hideContextMenu(),(93===t.keyCode||t.shiftKey&&121===t.keyCode)&&(n._contextMenu.visible&&!e.isFirefox()?n._isContextMenuKeyDown=!1:n._isContextMenuKeyDown=!0)}),n.addEventListener(document.body,"keydown",n._keydownHdl,!0),n.addEventListener(document.body,"click",n._clickHdl),n.addEventListener(document.body,"mousemove",n._mouseMoveHdl),(i.match(/iPad/i)||i.match(/iPhone/i))&&(n.addEventListener(document.body,"touchstart",n._touchStartHdl),n.addEventListener(document.body,"touchend",n._touchEndHdl))},s.prototype._flexSheetSyncSelection=function(t){if(this.collectionView&&this.selectionMode!=e.grid.SelectionMode.None){var o=this.selection,n=o.row>-1&&o.row<this.rows.length?this.rows[o.row]:null,i=n?n.dataItem:null;if((n instanceof h||this.newRowAtTop&&n instanceof e.grid._NewRowTemplate||i instanceof e.collections.CollectionViewGroup)&&(i=null),(i!=this.collectionView.currentItem||t)&&(!this.editableCollectionView||!this.editableCollectionView.currentAddItem)){var l=this._getRowIndex(this.collectionView.currentPosition);l!=o.row&&(o.row=o.row2=l,this.select(o,!1),this.selectionMode&&this.scrollIntoView(o.row,-1))}}},s.prototype._initFuncsList=function(){var t=this;t._functionListHost=document.createElement("div"),e.addClass(t._functionListHost,"wj-flexsheet-formula-list"),document.querySelector("body").appendChild(t._functionListHost),t._functionListHost.style.display="none",t._functionListHost.style.position="absolute",t._functionList=new e.input.ListBox(t._functionListHost),t._functionList.isContentHtml=!0,t._functionList.itemsSource=t._getFunctions(),t._functionList.displayMemberPath="displayValue",t._functionList.selectedValuePath="actualvalue",t.addEventListener(t._functionListHost,"click",t.applyFunctionToCell.bind(t)),t.addEventListener(t._functionListHost,"keydown",function(o){o.keyCode===e.Key.Escape&&(t.hideFunctionList(),t.hostElement.focus(),o.preventDefault()),o.keyCode===e.Key.Enter&&(t.applyFunctionToCell(),t.hostElement.focus(),o.preventDefault(),o.stopPropagation())})},s.prototype._getFunctions=function(){for(var e,t=[],n=0;n<o.length;n++)e=o[n],t.push({displayValue:'<div class="wj-flexsheet-formula-name">'+e.name+'</div><div class="wj-flexsheet-formula-description">'+e.description+"</div>",actualvalue:e.name});return t},s.prototype._addCustomFunctionDescription=function(e,t){for(var o={displayValue:'<div class="wj-flexsheet-formula-name">'+e+"</div>"+(t?'<div class="wj-flexsheet-formula-description">'+t+"</div>":""),actualvalue:e},n=this._functionList.itemsSource,i=-1,l=0;l<n.length;l++)if(n[l].actualvalue===e){i=l;break}i>-1?n.splice(i,1,o):n.push(o)},s.prototype._getCurrentFormulaIndex=function(e){var t=-1;return["+","-","*","/","^","(","&"].forEach(function(o){var n=e.lastIndexOf(o);n>t&&(t=n)}),t},s.prototype._prepareCellForEditHandler=function(){var t=this,o=t._edtHdl._edt;o&&(t.addEventListener(o,"keydown",function(o){if(t.isFunctionListOpen)switch(o.keyCode){case e.Key.Up:t.selectPreviousFunction(),o.preventDefault(),o.stopPropagation();break;case e.Key.Down:t.selectNextFunction(),o.preventDefault(),o.stopPropagation();break;case e.Key.Tab:case e.Key.Enter:t.applyFunctionToCell(),o.preventDefault(),o.stopPropagation();break;case e.Key.Escape:t.hideFunctionList(),o.preventDefault(),o.stopPropagation()}}),t.addEventListener(o,"keyup",function(n){(n.keyCode>40||n.keyCode<32)&&n.keyCode!==e.Key.Tab&&n.keyCode!==e.Key.Escape&&setTimeout(function(){t.showFunctionList(o)},0)}))},s.prototype._addSheet=function(e,o,n,i,l){var s=this,r=new t.Sheet(s,l,e,o,n);return s.sheets.isValidSheetName(r)||r._setValidName(s.sheets.getValidSheetName(r)),r.nameChanged.addHandler(function(e,t){s._updateDefinedNameWithSheetRefUpdating(t.oldValue,t.newValue)}),"number"==typeof i?(i<0&&(i=0),i>=s.sheets.length&&(i=s.sheets.length)):i=s.sheets.length,s.sheets.insert(i,r),r},s.prototype._showSheet=function(e){!this.sheets||!this.sheets.length||e>=this.sheets.length||e<0||e===this.selectedSheetIndex||this.sheets[e]&&!this.sheets[e].visible||(this.finishEditing(),this._clearCalcEngine(),this._isCopying=!0,this.selectedSheetIndex>-1&&this.selectedSheetIndex<this.sheets.length&&!this._sheets._exchangingPosition&&this._copyTo(this.sheets[this.selectedSheetIndex]),this.sheets[e]&&(this._selectedSheetIndex=e,this._copyFrom(this.sheets[e])),this._isCopying=!1,this._filter.closeEditor())},s.prototype._selectedSheetChange=function(e,t){this._showSheet(t.newValue),this.invalidate(!0),this.onSelectedSheetChanged(t)},s.prototype._sourceChange=function(t,o){if(!this.sheets._exchangingPosition){if(o.action===e.collections.NotifyCollectionChangedAction.Add||o.action===e.collections.NotifyCollectionChangedAction.Change)o.item._attachOwner(this),o.action===e.collections.NotifyCollectionChangedAction.Add?(this._addingSheet=!0,o.index<=this.selectedSheetIndex&&(this._selectedSheetIndex+=1)):o.index===this.selectedSheetIndex&&this._copyFrom(o.item,!0),this.selectedSheetIndex=o.index;else if(o.action===e.collections.NotifyCollectionChangedAction.Reset){for(var n=0;n<this.sheets.length;n++)this.sheets[n]._attachOwner(this);this.sheets.length>0?(0===this.selectedSheetIndex&&this._copyFrom(this.selectedSheet,!0),this.selectedSheetIndex=0):(this.rows.clear(),this.columns.clear(),this._selectedSheetIndex=-1)}else this.sheets.length>0?this.selectedSheetIndex>=this.sheets.length?this.selectedSheetIndex=0:this.selectedSheetIndex>o.index&&(this._selectedSheetIndex-=1):(this.rows.clear(),this.columns.clear(),this._selectedSheetIndex=-1);this.invalidate(!0)}},s.prototype._sheetVisibleChange=function(e,t){t.item.visible||t.index===this.selectedSheetIndex&&(this.selectedSheetIndex===this.sheets.length-1?this.selectedSheetIndex=t.index-1:this.selectedSheetIndex=t.index+1)},s.prototype._applyStyleForCell=function(e,t,o,n){void 0===n&&(n=!1);var i,l,s,r=this.rows[e];null==r||r instanceof h||!r.isVisible&&!n||(s=e*this.columns.length+t,(l=this.selectedSheet._getMergedRange(e,t))&&(s=l.topRow*this.columns.length+l.leftCol),(i=this.selectedSheet._styledCells[s])?(i.className="normal"===o.className?"":o.className||i.className,i.textAlign=o.textAlign||i.textAlign,i.verticalAlign=o.verticalAlign||i.verticalAlign,i.fontFamily=o.fontFamily||i.fontFamily,i.fontSize=o.fontSize||i.fontSize,i.backgroundColor=o.backgroundColor||i.backgroundColor,i.color=o.color||i.color,i.fontStyle="none"===o.fontStyle?"":o.fontStyle||i.fontStyle,i.fontWeight="none"===o.fontWeight?"":o.fontWeight||i.fontWeight,i.textDecoration="none"===o.textDecoration?"":o.textDecoration||i.textDecoration,i.format=o.format||i.format,i.whiteSpace=o.whiteSpace||i.whiteSpace,i.borderTopColor=o.borderTopColor||i.borderTopColor,i.borderTopStyle=o.borderTopStyle||i.borderTopStyle,i.borderTopWidth=o.borderTopWidth||i.borderTopWidth,i.borderBottomColor=o.borderBottomColor||i.borderBottomColor,i.borderBottomStyle=o.borderBottomStyle||i.borderBottomStyle,i.borderBottomWidth=o.borderBottomWidth||i.borderBottomWidth,i.borderLeftColor=o.borderLeftColor||i.borderLeftColor,i.borderLeftStyle=o.borderLeftStyle||i.borderLeftStyle,i.borderLeftWidth=o.borderLeftWidth||i.borderLeftWidth,i.borderRightColor=o.borderRightColor||i.borderRightColor,i.borderRightStyle=o.borderRightStyle||i.borderRightStyle,i.borderRightWidth=o.borderRightWidth||i.borderRightWidth):this.selectedSheet._styledCells[s]={className:o.className,textAlign:o.textAlign,verticalAlign:o.verticalAlign,fontStyle:o.fontStyle,fontWeight:o.fontWeight,fontFamily:o.fontFamily,fontSize:o.fontSize,textDecoration:o.textDecoration,backgroundColor:o.backgroundColor,color:o.color,format:o.format,whiteSpace:o.whiteSpace,borderTopColor:o.borderTopColor,borderTopStyle:o.borderTopStyle,borderTopWidth:o.borderTopWidth,borderBottomColor:o.borderBottomColor,borderBottomStyle:o.borderBottomStyle,borderBottomWidth:o.borderBottomWidth,borderLeftColor:o.borderLeftColor,borderLeftStyle:o.borderLeftStyle,borderLeftWidth:o.borderLeftWidth,borderRightColor:o.borderRightColor,borderRightStyle:o.borderRightStyle,borderRightWidth:o.borderRightWidth})},s.prototype._checkCellFormat=function(e,t,o){var n,i,l=e*this.columns.length+t;this.selectedSheet&&((n=this.selectedSheet._getMergedRange(e,t))&&(o.isMergedCell=!0,l=n.topRow*this.columns.length+n.leftCol),(i=this.selectedSheet._styledCells[l])&&(o.isBold=o.isBold||"bold"===i.fontWeight,o.isItalic=o.isItalic||"italic"===i.fontStyle,o.isUnderline=o.isUnderline||"underline"===i.textDecoration),e===this.selection.row&&t===this.selection.col&&(i&&i.textAlign?o.textAlign=i.textAlign:t>-1&&(o.textAlign=this.columns[t].getAlignment()||o.textAlign)))},s.prototype._resetMergedRange=function(e){var t,o,n,i,l=!1;for(t=e.topRow;t<=e.bottomRow;t++)for(o=e.leftCol;o<=e.rightCol;o++)(i=this.selectedSheet._getMergedRange(t,o))&&(l=!0,n=this.selectedSheet._mergedRanges.indexOf(i),this.selectedSheet._mergedRanges.splice(n,1));return l},s.prototype._updateCellsForUpdatingRow=function(e,t,o,n){var i,l,s,r,a,h,d,c=e*this.columns.length;if(n)for(l=i=t*this.columns.length;l<c;l++)s=l-o*this.columns.length,(r=this.selectedSheet._styledCells[l])&&(l>=(t+o)*this.columns.length&&(this.selectedSheet._styledCells[s]=r),delete this.selectedSheet._styledCells[l]);else for(i=t*this.columns.length-1,l=c-1;l>i;l--)s=l+this.columns.length*o,(r=this.selectedSheet._styledCells[l])&&(this.selectedSheet._styledCells[s]=r,delete this.selectedSheet._styledCells[l]);if(this.selectedSheet._mergedRanges.length>0)for(h=this.selectedSheet._mergedRanges.length-1;h>=0;h--)a=this.selectedSheet._mergedRanges[h],n?(d=t+o-1)<a.topRow?(a.row-=o,a.row2-=o):d>=a.topRow&&d<=a.bottomRow?t<=a.topRow&&d>=a.bottomRow?this.selectedSheet._mergedRanges.splice(h,1):t<a.topRow?a.row<=a.row2?(a.row+=t-a.topRow,a.row2-=o):(a.row2+=t-a.topRow,a.row-=o):t===a.topRow&&o===a.rowSpan?this.selectedSheet._mergedRanges.splice(h,1):a.row<=a.row2?a.row2-=o:a.row-=o:t<=a.topRow?this.selectedSheet._mergedRanges.splice(h,1):t<=a.bottomRow&&(a.row<=a.row2?a.row2+=t-a.bottomRow-1:a.row+=t-a.bottomRow-1):t<=a.topRow?(a.row+=o,a.row2+=o):t>a.topRow&&t<=a.bottomRow&&(a.row<=a.row2?a.row2+=o:a.row+=o)},s.prototype._updateCellsForUpdatingColumn=function(e,t,o,n){var i,l,s,r,a,h,d,c=this.rows.length*e;if(n)for(i=t;i<c;i++)l=i-o*(Math.floor(i/e)+((r=i%e)>=t?1:0)),(s=this.selectedSheet._styledCells[i])&&((r<t||r>=t+o)&&(this.selectedSheet._styledCells[l]=s),delete this.selectedSheet._styledCells[i]);else for(i=c-1;i>=t;i--)l=i+Math.floor(i/e)*o+((r=i%e)>=t?1:0),(s=this.selectedSheet._styledCells[i])&&(this.selectedSheet._styledCells[l]=s,delete this.selectedSheet._styledCells[i]);if(this.selectedSheet._mergedRanges.length>0)for(h=this.selectedSheet._mergedRanges.length-1;h>=0;h--)a=this.selectedSheet._mergedRanges[h],n?(d=t+o-1)<a.leftCol?(a.col-=o,a.col2-=o):d>=a.leftCol&&d<=a.rightCol?t<=a.leftCol&&d>=a.rightCol?this.selectedSheet._mergedRanges.splice(h,1):t<a.leftCol?a.col<=a.col2?(a.col+=t-a.leftCol,a.col2-=o):(a.col2+=t-a.leftCol,a.col-=o):t===a.leftCol&&o===a.columnSpan?this.selectedSheet._mergedRanges.splice(h,1):a.col<=a.col2?a.col2-=o:a.col-=o:t<=a.leftCol?this.selectedSheet._mergedRanges.splice(h,1):t<=a.rightCol&&(a.col<=a.col2?a.col2-=a.rightCol-t+1:a.col-=a.rightCol-t+1):t<=a.leftCol?(a.col+=o,a.col2+=o):t>a.leftCol&&t<=a.rightCol&&(a.col<=a.col2?a.col2+=o:a.col+=o)},s.prototype._cloneObject=function(t){var o;if(null==t||!e.isObject(t))return t;for(var n in o={},t)t.hasOwnProperty(n)&&null!=t[n]&&(t[n].clone?o[n]=t[n].clone():o[n]=this._cloneObject(t[n]));return o},s.prototype._evaluate=function(e,t,o,n,i){return e&&e.length>1&&this._enableFormulas?(e="="===e[0]?e:"="+e,this._calcEngine.evaluate(e,t,o,n,i)):e},s.prototype._copyTo=function(t){var o,n,i,l=this,s=t.grid.autoGenerateColumns;if(t._storeRowSettings(),i=this.selection.clone(),t.grid.selection=new e.grid.CellRange,t.grid.rows.clear(),t.grid.columns.clear(),t.grid.columnHeaders.columns.clear(),t.grid.rowHeaders.rows.clear(),t._ownerHeaderRowRemoved=l._headerRowRemoved,l.itemsSource)t.grid.autoGenerateColumns=!1,t.itemsSource=l.itemsSource,l.collectionView.sortDescriptions.length>0&&(t._dataView=l.collectionView._view.slice()),t.grid.collectionView.beginUpdate();else for(t.itemsSource=null,n=0;n<l.rows.length;n++)t.grid.rows.push(l.rows[n]);for(t._sortList=l.sortManager._committedList.slice(),t._getFilterSetting(),o=0;o<l.columns.length;o++)t.grid.columns.push(l.columns[o]);t.grid.collectionView&&(l._resetMappedColumns(t.grid),t.grid.collectionView.endUpdate()),t.grid.autoGenerateColumns=s,t.grid.frozenRows=l.frozenRows,t.grid.frozenColumns=l.frozenColumns,t.grid.allowAddNew=l.allowAddNew,null!=l.newRowAtTop&&(t.grid.newRowAtTop=l.newRowAtTop),t.grid.selection=i,t._scrollPosition=l.scrollPosition,setTimeout(function(){l._setFlexSheetToDirty(),l.refresh(!0)},10)},s.prototype._copyFrom=function(t,o){void 0===o&&(o=!0);var n,i,l,s,r,a,d,c=this,u=c.autoGenerateColumns;if(c._isCopying=!0,c._dragable=!1,c.itemsSource=null,c.rows.clear(),c.columns.clear(),c.columnHeaders.columns.clear(),c.rowHeaders.rows.clear(),a=t.grid.selection.clone(),c.selection=new e.grid.CellRange,t.selectionRanges.length>1&&c.selectionMode===e.grid.SelectionMode.CellRange&&(c._enableMulSel=!0),c._headerRowRemoved=t._ownerHeaderRowRemoved,t.itemsSource)c.autoGenerateColumns=!1,c.itemsSource=t.itemsSource,c.collectionView.beginUpdate();else for(i=0;i<t.grid.rows.length;i++)c.rows.push(t.grid.rows[i]);for(c.sortManager.sortDescriptions.sourceCollection=t._sortList.slice(),c.sortManager._committedList=t._sortList.slice(),n=0;n<t.grid.columns.length;n++)(s=t.grid.columns[n]).isRequired=!1,c.columns.push(s);for(c.collectionView&&(c.collectionView.moveCurrentToPosition(c._getCvIndex(a.row)),c._resetMappedColumns(c),c.collectionView.endUpdate(),t._dataView&&(c.collectionView._view=t._dataView,c.collectionView._pgView=c.collectionView._getPageView(),c.itemsSource instanceof e.collections.CollectionView||(t.grid.collectionView._view=t._dataView,t.grid.collectionView._pgView=t.grid.collectionView._getPageView()),c._bindGrid(!1),t.grid._bindGrid(!1)),c.collectionView.collectionChanged.addHandler(function(t,o){o.action===e.collections.NotifyCollectionChangedAction.Reset&&setTimeout(function(){c.invalidate()},10)},c)),c.rows.length&&c.columns.length&&(c.selection=a),t._applyFilterSetting(),i=0;i<c.rows.length;i++)(l=t._rowSettings[i])&&(d=(r=c.rows[i])instanceof h,r.height=l.height,r.allowMerging=l.allowMerging,r.visible=l.visible,r instanceof e.grid.GroupRow&&(r.isCollapsed=!!l.isCollapsed),r.isSelected=!!l.isSelected,r.isReadOnly=d||!!l.readOnly);c.autoGenerateColumns=u,c.frozenRows=t.grid.frozenRows,c.frozenColumns=t.grid.frozenColumns,c._isCopying=!1,c._addingSheet?(c._toRefresh&&(clearTimeout(c._toRefresh),c._toRefresh=null),c._toRefresh=setTimeout(function(){c._setFlexSheetToDirty(),c.invalidate()},10),c._addingSheet=!1):o&&c.refresh(),c.scrollPosition=t._scrollPosition,c._ptScrl=t._scrollPosition},s.prototype._resetMappedColumns=function(e){var t,o,n=0;if(e._mappedColumns=null,e.collectionView)for(o=e.collectionView.sortDescriptions;n<o.length;n++)(t=e.columns.getColumn(o[n].property))&&t.dataMap&&(e._mappedColumns||(e._mappedColumns={}),e._mappedColumns[t.binding]=t.dataMap)},s.prototype._loadFromWorkbook=function(t){var o,n,i,l,s=0;if(null!=t.sheets&&0!==t.sheets.length){if(this.beginUpdate(),this.clear(),this._reservedContent=t.reservedContent,o=t.sheets.length,t.colorThemes&&t.colorThemes.length>0)for(l=0;l<this._colorThemes.length;l++)this._colorThemes[l]=t.colorThemes[l];for(;s<o;s++){if(s>0&&this.addUnboundSheet(),this.selectedSheet.grid.wj_sheetInfo={},e.grid.xlsx.FlexGridXlsxConverter.load(this.selectedSheet.grid,t,{sheetIndex:s,includeColumnHeaders:!1}),this.selectedSheet.name=this.selectedSheet.grid.wj_sheetInfo.name,this.selectedSheet.visible=this.selectedSheet.grid.wj_sheetInfo.visible,this.selectedSheet._styledCells=this.selectedSheet.grid.wj_sheetInfo.styledCells,this.selectedSheet.grid.wj_sheetInfo.mergedRanges)for(i=0;i<this.selectedSheet.grid.wj_sheetInfo.mergedRanges.length;i++)this.selectedSheet._mergedRanges[i]=this.selectedSheet.grid.wj_sheetInfo.mergedRanges[i];if(this._copyFrom(this.selectedSheet,!1),null!=this.selectedSheet.grid.wj_sheetInfo.tables&&this.selectedSheet.grid.wj_sheetInfo.tables.length>0)for(l=0;l<this.selectedSheet.grid.wj_sheetInfo.tables.length;l++)this._parseFromWorkbookTable(this.selectedSheet.grid.wj_sheetInfo.tables[l],this.selectedSheet)}if(null!=t.activeWorksheet&&t.activeWorksheet>-1&&t.activeWorksheet<this.sheets.length?this.selectedSheetIndex=t.activeWorksheet:this.selectedSheetIndex=0,t.definedNames&&t.definedNames.length>0)for(l=0;l<t.definedNames.length;l++)n=t.definedNames[l],this.definedNames.push(new c(this,n.name,n.value,n.sheetName));this.endUpdate(),this.onLoaded()}},s.prototype._saveToWorkbook=function(t){var o,n,i,l,s,r,a=this,h=!(!t||!t.includeFormulaValues),d=function(e){return a.evaluate(e,null,l)};if(0===a.sheets.length)throw"The flexsheet is empty.";if(l=a.sheets[0],h&&(l.grid.wj_sheetInfo.evaluateFormula=d),0===a.selectedSheetIndex&&(l._storeRowSettings(),l.itemsSource instanceof e.collections.CollectionView||a._copyRowsToSelectedSheet()),l._setRowSettings(),l.tables.length>0)for(l.grid.wj_sheetInfo.tables=[],r=0;r<l.tables.length;r++)l.grid.wj_sheetInfo.tables.push(a._parseToWorkbookTable(l.tables[r]));for(o=e.grid.xlsx.FlexGridXlsxConverter.save(l.grid,{sheetName:l.name,sheetVisible:l.visible,includeColumnHeaders:!1}),a._checkTableHeaderRow(l.tables,o),l.grid.wj_sheetInfo.evaluateFormula&&(l.grid.wj_sheetInfo.evaluateFormula=null),o.reservedContent=a._reservedContent,s=1;s<a.sheets.length;s++){if(l=a.sheets[s],h&&(l.grid.wj_sheetInfo.evaluateFormula=d),a.selectedSheetIndex===s&&(l._storeRowSettings(),l.itemsSource instanceof e.collections.CollectionView||a._copyRowsToSelectedSheet()),l._setRowSettings(),l.tables.length>0)for(l.grid.wj_sheetInfo.tables=[],r=0;r<l.tables.length;r++)l.grid.wj_sheetInfo.tables.push(a._parseToWorkbookTable(l.tables[r]));n=e.grid.xlsx.FlexGridXlsxConverter.save(l.grid,{sheetName:l.name,sheetVisible:l.visible,includeColumnHeaders:!1}),a._checkTableHeaderRow(l.tables,n),l.grid.wj_sheetInfo.evaluateFormula&&(l.grid.wj_sheetInfo.evaluateFormula=null),o._addWorkSheet(n.sheets[0],s)}for(o.activeWorksheet=a.selectedSheetIndex,r=0;r<a.definedNames.length;r++){var c=a.definedNames[r];(i=new e.xlsx.DefinedName).name=c.name,i.value=c.value,i.sheetName=c.sheetName,o.definedNames.push(i)}if(a._colorThemes&&a._colorThemes.length>0)for(r=0;r<a._colorThemes.length;r++)o.colorThemes[r]=a._colorThemes[r];return o},s.prototype._mouseDown=function(t){var o,n,l=window.navigator.userAgent,s=this.hitTest(t);if(this.columns,this.selectedSheet&&(this.selectedSheet._scrollPosition=this.scrollPosition),s.cellType!==e.grid.CellType.None&&(this._isClicking=!0),this._dragable)return this._isDragging=!0,this._draggingMarker=document.createElement("div"),e.setCss(this._draggingMarker,{position:"absolute",display:"none",borderStyle:"dotted",cursor:"move"}),document.body.appendChild(this._draggingMarker),this._draggingTooltip=new e.Tooltip,this._draggingCells=this.selection,this.selectedSheet&&this.selectedSheet.selectionRanges.clear(),this.onDraggingRowColumn(new i(this.selection.clone(),this._draggingRow,t.shiftKey)),void t.preventDefault();if("crosshair"===this.hostElement.style.cursor&&null==this._fillingMarker)return this.finishEditing(),this._fillingData=!0,this._fillingPoint=new e.Point(t.clientX-this.scrollPosition.x,t.clientY-this.scrollPosition.y),this._fillingSource=this.selection.clone(),this._fillingMarker=document.createElement("div"),e.setCss(this._fillingMarker,{position:"absolute",display:"none",border:"2px dashed"}),this._root.appendChild(this._fillingMarker),this._fillingTooltip=new e.Tooltip,void t.preventDefault();if(this.selectionMode===e.grid.SelectionMode.CellRange?t.ctrlKey?this._enableMulSel||(this._enableMulSel=!0,0===this.selectedSheet.selectionRanges.length&&this.selectedSheet.selectionRanges.push(this.selection)):s.cellType!==e.grid.CellType.None&&(this.selectedSheet&&this.selectedSheet.selectionRanges.clear(),this._enableMulSel&&this.refresh(!1),this._enableMulSel=!1):(this._enableMulSel=!1,this.selectedSheet&&this.selectedSheet.selectionRanges.clear()),this._htDown=s,0!==this.rows.length&&0!==this.columns.length&&(l.match(/iPad/i)||l.match(/iPhone/i)||this._hideContextMenu(),3!==t.which&&this.selectionMode===e.grid.SelectionMode.CellRange&&(s.cellType===e.grid.CellType.ColumnHeader||s.cellType===e.grid.CellType.None)&&!(s.col>-1&&this.columns[s.col].isSelected)&&e.hasClass(t.target,"wj-cell")&&!s.edgeRight)){if(this._columnHeaderClicked=!0,n=this.itemsSource&&this.rows[0]&&!this.rows[0].isVisible?1:0,t.shiftKey)this._multiSelectColumns(s);else{if(o=new e.grid.CellRange(n,s.col,this.rows.length-1,s.col),3===t.which&&this.selection.contains(o))return;this.select(o)}this._eCt.children[n]&&this._eCt.children[n].children[s.col]&&this._eCt.children[n].children[s.col].focus(),t.preventDefault()}},s.prototype._mouseMove=function(t){var o,n=this.hitTest(t),i=this.selection.clone(),l=this.rows.length,s=this.columns.length,r=this.hostElement.style.cursor;if(0===this.rows.length||0===this.columns.length)return this._dragable=!1,void(n.cellType===e.grid.CellType.Cell&&(this.hostElement.style.cursor="default"));if(this._isDragging)return this.hostElement.style.cursor="move",void this._showDraggingMarker(t);if(!this._isClicking&&n.edgeBottom&&n.edgeRight&&n.row===i.bottomRow&&n.col===i.rightCol)this.hostElement.style.cursor="crosshair";else{if(this._fillingData)return this.hostElement.style.cursor="crosshair",void this._showFillMarker(t);o=this.itemsSource?0===i.topRow||1===i.topRow:0===i.topRow,this._isClicking||!i||n.cellType===e.grid.CellType.None||this.itemsSource||this.isReadOnly||!this._enableDragDrop||(this._draggingColumn=o&&i.bottomRow===l-1,this._draggingRow=0===i.leftCol&&i.rightCol===s-1,n.cellType===e.grid.CellType.Cell?(this._draggingColumn&&((n.col===i.leftCol-1||n.col===i.rightCol)&&n.edgeRight||n.row===l-1&&n.edgeBottom)&&(r="move"),this._draggingRow&&!this._containsGroupRows(i)&&((n.row===i.topRow-1||n.row===i.bottomRow)&&n.edgeBottom||n.col===s-1&&n.edgeRight)&&(r="move")):n.cellType===e.grid.CellType.ColumnHeader?n.edgeBottom&&(this._draggingColumn&&n.col>=i.leftCol&&n.col<=i.rightCol?r="move":this._draggingRow&&0===i.topRow&&(r="move")):n.cellType===e.grid.CellType.RowHeader&&n.edgeRight&&(this._draggingColumn&&0===i.leftCol?r="move":this._draggingRow&&n.row>=i.topRow&&n.row<=i.bottomRow&&!this._containsGroupRows(i)&&(r="move")),this._dragable="move"===r,this.hostElement.style.cursor=r),this._htDown&&this._htDown.panel&&(n=new e.grid.HitTestInfo(this._htDown.panel,t),this._multiSelectColumns(n),n.cellType===e.grid.CellType.Cell&&this.scrollIntoView(n.row,n.col))}},s.prototype._mouseUp=function(o){try{if(this._isDragging){if(!this._draggingCells.equals(this._dropRange)){var n=new l(this._dropRange.clone(),this._draggingRow),i=new e.CancelEventArgs;this.onBeginDroppingRowColumn(n),i.cancel=n.cancel,n.cancel||this._handleDropping(o),this.onEndDroppingRowColumn(i)}}else if(this._fillingData){var s=d.CopyContent,r=this._fillingRange,a=this._fillingSource,h=void 0;this._orgCellSettings=null,this._fillingRange&&this._fillingRange.isValid&&(e.assert(this._canDoFillOperation(),"To do this, all the merged cells need be the same size."),a.leftCol===r.leftCol&&a.rightCol===r.rightCol?a.row!==a.row2&&(s=d.FillSeries):a.col!==a.col2&&(s=d.FillSeries),this._orgCellSettings=this._getCellSettingsForFill(),h=new t._FillAction(this,this._fillingSource),this._undoStack._addAction(h),s=d.CopyFormat|s,this._fillData(s),this._showFillMenuSmartTag(s))}}finally{this._isDragging&&(this._draggingCells=null,this._dropRange=null,document.body.removeChild(this._draggingMarker),this._draggingMarker=null,this._draggingTooltip.hide(),this._draggingTooltip=null,this._isDragging=!1,this._draggingColumn=!1,this._draggingRow=!1),this._htDown&&this._htDown.cellType!==e.grid.CellType.None&&this.selectedSheet&&(this._htDown.cellType===e.grid.CellType.TopLeft&&this.selectionMode===e.grid.SelectionMode.CellRange&&(this.selection=new e.grid.CellRange(0,0,this.rows.length-1,this.columns.length-1)),this.selection.isValid&&this.selectedSheet._addSelection(this.selection),this._enableMulSel=!1),this._fillingData&&(this._fillingData=!1,this._fillingPoint=null,this._fillingRange=null,this._root.removeChild(this._fillingMarker),this._fillingMarker=null,this._fillingTooltip.hide(),this._fillingTooltip=null,this.hostElement.style.cursor="default"),this._isClicking=!1,this._columnHeaderClicked=!1,this._htDown=null}},s.prototype._click=function(){var e=this,t=window.navigator.userAgent;t.match(/iPad/i)||t.match(/iPhone/i)||e._hideContextMenu(),setTimeout(function(){e.hideFunctionList()},200)},s.prototype._touchStart=function(t){var o=this;e.hasClass(t.target,"wj-context-menu-item")||o._hideContextMenu(),o._longClickTimer=setTimeout(function(){var n;o._isDescendant(o._divContainer,t.target)&&(n=o.hitTest(t))&&n.cellType!==e.grid.CellType.None&&!o._resizing&&(n.cellType===e.grid.CellType.TopLeft&&(o.selection=new e.grid.CellRange(0,0,o.rows.length-1,o.columns.length-1),o.selectedSheet&&(o.selectedSheet.selectionRanges.clear(),o.selectedSheet.selectionRanges.push(o.selection))),o._contextMenu.show(null,new e.Point(t.pageX+10,t.pageY+10)))},500)},s.prototype._touchEnd=function(){clearTimeout(this._longClickTimer)},s.prototype._keydown=function(t){this._endDragFillOperation(t),!this._isDescendant(this.hostElement,t.target)&&this.hostElement!==t.target||this._edtHdl.activeEditor||!this.selectedSheet||t.keyCode!==e.Key.Delete&&t.keyCode!==e.Key.Back||(this._delSeletionContent(t),t.preventDefault());var o=this._contextMenu.visible?this._contextMenu:this._tabHolder.sheetControl._contextMenu.visible?this._tabHolder.sheetControl._contextMenu:null;o&&(t.keyCode===e.Key.Down&&o.moveToNext(),t.keyCode===e.Key.Up&&o.moveToPrev(),t.keyCode===e.Key.Home&&o.moveToFirst(),t.keyCode===e.Key.End&&o.moveToLast(),t.keyCode===e.Key.Enter&&o.handleContextMenu(),t.preventDefault())},s.prototype._showDraggingMarker=function(t){var o,n,i,l,r,a,h,d,c,u=new e.grid.HitTestInfo(this.cells,t),_=this.selection,g=this.columns.length,f=this.rows.length,p=this._cumulativeScrollOffset(this.hostElement),w=this._root.getBoundingClientRect(),m=w.left+p.x,C=w.top+p.y;if(this.scrollIntoView(u.row,u.col),this._draggingColumn){for(n=_.rightCol-_.leftCol+1,r=0,((i=u.col)<0||i+n>g)&&(i=g-n),o=this.cells.getCellBoundingRect(0,i),a=this._root.offsetHeight-this._eCHdr.offsetHeight,l=(l=this.cells.height)>a?a:l,h=0;h<n;h++)r+=this.columns[i+h].renderSize;d=s.convertNumberToAlpha(i)+" : "+s.convertNumberToAlpha(i+n-1),this._dropRange?(this._dropRange.col=i,this._dropRange.col2=i+n-1):this._dropRange=new e.grid.CellRange(0,i,this.rows.length-1,i+n-1)}else if(this._draggingRow){for(n=_.bottomRow-_.topRow+1,l=0,((i=u.row)<0||i+n>f)&&(i=f-n),o=this.cells.getCellBoundingRect(i,0),a=this._root.offsetWidth-this._eRHdr.offsetWidth,h=0;h<n;h++)l+=this.rows[i+h].renderSize;r=(r=this.cells.width)>a?a:r,d=i+1+" : "+(i+n),this._dropRange?(this._dropRange.row=i,this._dropRange.row2=i+n-1):this._dropRange=new e.grid.CellRange(i,0,i+n-1,this.columns.length-1)}if(o){if(c={display:"inline",zIndex:"9999",opacity:.5,top:o.top-(this._draggingColumn?this._ptScrl.y:0)+p.y,left:o.left-(this._draggingRow?this._ptScrl.x:0)+p.x,height:l,width:r},o.top=o.top-(this._draggingColumn?this._ptScrl.y:0),o.left=o.left-(this._draggingRow?this._ptScrl.x:0),this.rightToLeft&&this._draggingRow&&(c.left=c.left-r+o.width+2*this._ptScrl.x,o.left=o.left+2*this._ptScrl.x),this._draggingRow){if(m+this._eRHdr.offsetWidth!==c.left||C+this._root.offsetHeight+1<c.top+c.height)return}else if(C+this._eCHdr.offsetHeight!==c.top||m+this._root.offsetWidth+1<c.left+c.width)return;e.setCss(this._draggingMarker,c),this._draggingTooltip.show(this.hostElement,d,o)}},s.prototype._showFillMarker=function(t){var o,n,i,l,s,r,a,h,d=new e.grid.HitTestInfo(this.cells,t);d.row>-1&&d.col>-1&&(o=t.clientX-this.scrollPosition.x-this._fillingPoint.x,n=t.clientY-this.scrollPosition.y-this._fillingPoint.y,Math.abs(o)>=Math.abs(n)?(i=this._fillingSource.topRow,s=this._fillingSource.bottomRow,l=o>=0?this._fillingSource.leftCol:d.col,r=o>=0?d.col:this._fillingSource.rightCol):(i=n>=0?this._fillingSource.topRow:d.row,s=n>=0?d.row:this._fillingSource.bottomRow,l=this._fillingSource.leftCol,r=this._fillingSource.rightCol),a=this.cells.getCellBoundingRect(i,l,!0),h=this.cells.getCellBoundingRect(s,r,!0),e.setCss(this._fillingMarker,{left:a.left+this.cells.hostElement.offsetLeft-2,top:a.top+this.cells.hostElement.offsetTop-2,width:h.right-a.left+4,height:h.bottom-a.top+4,display:"",zIndex:"9999"}),this._fillingRange=new e.grid.CellRange(i,l,s,r),this.scrollIntoView(d.row,d.col),this._showFillTooltip())},s.prototype._showFillTooltip=function(){var t,o,n,i,l,s,r,a,h,d,c,u,_=this._fillingSource,g=this._fillingRange;this._fillingTooltip.hide(),g.equals(_)||_.contains(g)||((o=_.leftCol===g.leftCol&&_.rightCol===g.rightCol)?(g.bottomRow>_.bottomRow?((t=this.cells.getCellBoundingRect(g.bottomRow,g.rightCol)).top=t.bottom+10,n=g.bottomRow-_.topRow):((t=this.cells.getCellBoundingRect(g.topRow,g.rightCol)).top+=10,n=g.topRow-_.topRow),t.left=t.right,(i=n%_.rowSpan)<0&&(i+=_.rowSpan),_.row===_.row2&&(l=!0),h=this.selectedSheet.getCellStyle(_.topRow+i,_.leftCol),d=this.getMergedRange(this.cells,_.topRow+i,_.leftCol),c=this.columns[_.leftCol],u=h&&h.format?h.format:c.format,l?(a=this.getCellData(d?d.topRow:_.topRow+i,_.leftCol,!1),a=e.isString(a)&&"="===a[0]?"":e.Globalize.format(a,u)):(s=this.getCellData(_.topRow+i,_.leftCol,!1),e.isNumber(s)||e.isDate(s)?(r=this._getFillSeries(o,0,i))?(a=this._getFillData(i,n,_,o,r,!0),a=e.Globalize.format(a,u)):a="":(a=s,e.isString(a)&&"="===a[0]&&(a="")))):(g.rightCol>_.rightCol?(t=this.cells.getCellBoundingRect(g.bottomRow,g.rightCol),n=g.rightCol-_.leftCol):(t=this.cells.getCellBoundingRect(g.bottomRow,g.leftCol),n=g.leftCol-_.leftCol),t.top=t.bottom+10,(i=n%_.columnSpan)<0&&(i+=_.columnSpan),_.col===_.col2&&(l=!0),h=this.selectedSheet.getCellStyle(_.topRow,_.leftCol+i),d=this.getMergedRange(this.cells,_.topRow,_.leftCol+i),c=this.columns[_.leftCol+i],u=h&&h.format?h.format:c.format,l?(a=this.getCellData(_.topRow,d?d.leftCol:_.leftCol+i,!1),a=e.isString(a)&&"="===a[0]?"":e.Globalize.format(a,u)):(s=this.getCellData(_.topRow,_.leftCol+i,!1),e.isNumber(s)||e.isDate(s)?(r=this._getFillSeries(o,0,i))?(a=this._getFillData(i,n,_,o,r,!0),a=e.Globalize.format(a,u)):a="":(a=s,e.isString(a)&&"="===a[0]&&(a="")))),t.top+=this.cells.hostElement.offsetTop,this._fillingTooltip.show(this.hostElement,a,t))},s.prototype._showFillMenuSmartTag=function(t){var o=this,n=document.createElement("img"),i=document.createElement("img"),l=o.selection,s=o.cells.getCellBoundingRect(l.bottomRow,l.rightCol,!0),r=s.right+o.cells.hostElement.offsetLeft,a=s.bottom+o.cells.hostElement.offsetTop;o.addEventListener(document.body,"mousedown",o._endDragFillOperationHdl,!0),o._fillSmartTagHost=document.createElement("div"),e.addClass(o._fillSmartTagHost,"wj-flexsheet-smart-tag"),r+o._ptScrl.x+32+(o.cells.hostElement.offsetHeight>o._root.offsetHeight?17:0)>o._root.offsetWidth&&(r-=32),a+o._ptScrl.y+18+(o.cells.hostElement.offsetWidth>o._root.offsetWidth?17:0)>o._root.offsetHeight&&(a-=18),e.setCss(o._fillSmartTagHost,{left:r,top:a}),n.setAttribute("src","data:image/png;base64, iVBORw0KGgoAAAANSUhEUgAAABIAAAASCAYAAABWzo5XAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAKT2lDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVNnVFPpFj333vRCS4iAlEtvUhUIIFJCi4AUkSYqIQkQSoghodkVUcERRUUEG8igiAOOjoCMFVEsDIoK2AfkIaKOg6OIisr74Xuja9a89+bN/rXXPues852zzwfACAyWSDNRNYAMqUIeEeCDx8TG4eQuQIEKJHAAEAizZCFz/SMBAPh+PDwrIsAHvgABeNMLCADATZvAMByH/w/qQplcAYCEAcB0kThLCIAUAEB6jkKmAEBGAYCdmCZTAKAEAGDLY2LjAFAtAGAnf+bTAICd+Jl7AQBblCEVAaCRACATZYhEAGg7AKzPVopFAFgwABRmS8Q5ANgtADBJV2ZIALC3AMDOEAuyAAgMADBRiIUpAAR7AGDIIyN4AISZABRG8lc88SuuEOcqAAB4mbI8uSQ5RYFbCC1xB1dXLh4ozkkXKxQ2YQJhmkAuwnmZGTKBNA/g88wAAKCRFRHgg/P9eM4Ors7ONo62Dl8t6r8G/yJiYuP+5c+rcEAAAOF0ftH+LC+zGoA7BoBt/qIl7gRoXgugdfeLZrIPQLUAoOnaV/Nw+H48PEWhkLnZ2eXk5NhKxEJbYcpXff5nwl/AV/1s+X48/Pf14L7iJIEyXYFHBPjgwsz0TKUcz5IJhGLc5o9H/LcL//wd0yLESWK5WCoU41EScY5EmozzMqUiiUKSKcUl0v9k4t8s+wM+3zUAsGo+AXuRLahdYwP2SycQWHTA4vcAAPK7b8HUKAgDgGiD4c93/+8//UegJQCAZkmScQAAXkQkLlTKsz/HCAAARKCBKrBBG/TBGCzABhzBBdzBC/xgNoRCJMTCQhBCCmSAHHJgKayCQiiGzbAdKmAv1EAdNMBRaIaTcA4uwlW4Dj1wD/phCJ7BKLyBCQRByAgTYSHaiAFiilgjjggXmYX4IcFIBBKLJCDJiBRRIkuRNUgxUopUIFVIHfI9cgI5h1xGupE7yAAygvyGvEcxlIGyUT3UDLVDuag3GoRGogvQZHQxmo8WoJvQcrQaPYw2oefQq2gP2o8+Q8cwwOgYBzPEbDAuxsNCsTgsCZNjy7EirAyrxhqwVqwDu4n1Y8+xdwQSgUXACTYEd0IgYR5BSFhMWE7YSKggHCQ0EdoJNwkDhFHCJyKTqEu0JroR+cQYYjIxh1hILCPWEo8TLxB7iEPENyQSiUMyJ7mQAkmxpFTSEtJG0m5SI+ksqZs0SBojk8naZGuyBzmULCAryIXkneTD5DPkG+Qh8lsKnWJAcaT4U+IoUspqShnlEOU05QZlmDJBVaOaUt2ooVQRNY9aQq2htlKvUYeoEzR1mjnNgxZJS6WtopXTGmgXaPdpr+h0uhHdlR5Ol9BX0svpR+iX6AP0dwwNhhWDx4hnKBmbGAcYZxl3GK+YTKYZ04sZx1QwNzHrmOeZD5lvVVgqtip8FZHKCpVKlSaVGyovVKmqpqreqgtV81XLVI+pXlN9rkZVM1PjqQnUlqtVqp1Q61MbU2epO6iHqmeob1Q/pH5Z/YkGWcNMw09DpFGgsV/jvMYgC2MZs3gsIWsNq4Z1gTXEJrHN2Xx2KruY/R27iz2qqaE5QzNKM1ezUvOUZj8H45hx+Jx0TgnnKKeX836K3hTvKeIpG6Y0TLkxZVxrqpaXllirSKtRq0frvTau7aedpr1Fu1n7gQ5Bx0onXCdHZ4/OBZ3nU9lT3acKpxZNPTr1ri6qa6UbobtEd79up+6Ynr5egJ5Mb6feeb3n+hx9L/1U/W36p/VHDFgGswwkBtsMzhg8xTVxbzwdL8fb8VFDXcNAQ6VhlWGX4YSRudE8o9VGjUYPjGnGXOMk423GbcajJgYmISZLTepN7ppSTbmmKaY7TDtMx83MzaLN1pk1mz0x1zLnm+eb15vft2BaeFostqi2uGVJsuRaplnutrxuhVo5WaVYVVpds0atna0l1rutu6cRp7lOk06rntZnw7Dxtsm2qbcZsOXYBtuutm22fWFnYhdnt8Wuw+6TvZN9un2N/T0HDYfZDqsdWh1+c7RyFDpWOt6azpzuP33F9JbpL2dYzxDP2DPjthPLKcRpnVOb00dnF2e5c4PziIuJS4LLLpc+Lpsbxt3IveRKdPVxXeF60vWdm7Obwu2o26/uNu5p7ofcn8w0nymeWTNz0MPIQ+BR5dE/C5+VMGvfrH5PQ0+BZ7XnIy9jL5FXrdewt6V3qvdh7xc+9j5yn+M+4zw33jLeWV/MN8C3yLfLT8Nvnl+F30N/I/9k/3r/0QCngCUBZwOJgUGBWwL7+Hp8Ib+OPzrbZfay2e1BjKC5QRVBj4KtguXBrSFoyOyQrSH355jOkc5pDoVQfujW0Adh5mGLw34MJ4WHhVeGP45wiFga0TGXNXfR3ENz30T6RJZE3ptnMU85ry1KNSo+qi5qPNo3ujS6P8YuZlnM1VidWElsSxw5LiquNm5svt/87fOH4p3iC+N7F5gvyF1weaHOwvSFpxapLhIsOpZATIhOOJTwQRAqqBaMJfITdyWOCnnCHcJnIi/RNtGI2ENcKh5O8kgqTXqS7JG8NXkkxTOlLOW5hCepkLxMDUzdmzqeFpp2IG0yPTq9MYOSkZBxQqohTZO2Z+pn5mZ2y6xlhbL+xW6Lty8elQfJa7OQrAVZLQq2QqboVFoo1yoHsmdlV2a/zYnKOZarnivN7cyzytuQN5zvn//tEsIS4ZK2pYZLVy0dWOa9rGo5sjxxedsK4xUFK4ZWBqw8uIq2Km3VT6vtV5eufr0mek1rgV7ByoLBtQFr6wtVCuWFfevc1+1dT1gvWd+1YfqGnRs+FYmKrhTbF5cVf9go3HjlG4dvyr+Z3JS0qavEuWTPZtJm6ebeLZ5bDpaql+aXDm4N2dq0Dd9WtO319kXbL5fNKNu7g7ZDuaO/PLi8ZafJzs07P1SkVPRU+lQ27tLdtWHX+G7R7ht7vPY07NXbW7z3/T7JvttVAVVN1WbVZftJ+7P3P66Jqun4lvttXa1ObXHtxwPSA/0HIw6217nU1R3SPVRSj9Yr60cOxx++/p3vdy0NNg1VjZzG4iNwRHnk6fcJ3/ceDTradox7rOEH0x92HWcdL2pCmvKaRptTmvtbYlu6T8w+0dbq3nr8R9sfD5w0PFl5SvNUyWna6YLTk2fyz4ydlZ19fi753GDborZ752PO32oPb++6EHTh0kX/i+c7vDvOXPK4dPKy2+UTV7hXmq86X23qdOo8/pPTT8e7nLuarrlca7nuer21e2b36RueN87d9L158Rb/1tWeOT3dvfN6b/fF9/XfFt1+cif9zsu72Xcn7q28T7xf9EDtQdlD3YfVP1v+3Njv3H9qwHeg89HcR/cGhYPP/pH1jw9DBY+Zj8uGDYbrnjg+OTniP3L96fynQ89kzyaeF/6i/suuFxYvfvjV69fO0ZjRoZfyl5O/bXyl/erA6xmv28bCxh6+yXgzMV70VvvtwXfcdx3vo98PT+R8IH8o/2j5sfVT0Kf7kxmTk/8EA5jz/GMzLdsAAAAgY0hSTQAAeiUAAICDAAD5/wAAgOkAAHUwAADqYAAAOpgAABdvkl/FRgAAAFJJREFUeNrclEEKACAIBOfp/Xy7i4WSRnRYBIVRVhFJVIhyEAxllQa5E/wBSnsU6Rza2nugqNmASi57C/KKNg/Iqn+iVWzx6M4bOdUEAAD//wMAAYRMfiNaiqEAAAAASUVORK5CYII="),e.setCss(n,{float:"left",height:18,margin:0}),i.setAttribute("src","data:image/png;base64, iVBORw0KGgoAAAANSUhEUgAAAAcAAAASCAYAAACXScT7AAAACXBIWXMAAA7DAAAOwwHHb6hkAAAKTWlDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVN3WJP3Fj7f92UPVkLY8LGXbIEAIiOsCMgQWaIQkgBhhBASQMWFiApWFBURnEhVxILVCkidiOKgKLhnQYqIWotVXDjuH9yntX167+3t+9f7vOec5/zOec8PgBESJpHmomoAOVKFPDrYH49PSMTJvYACFUjgBCAQ5svCZwXFAADwA3l4fnSwP/wBr28AAgBw1S4kEsfh/4O6UCZXACCRAOAiEucLAZBSAMguVMgUAMgYALBTs2QKAJQAAGx5fEIiAKoNAOz0ST4FANipk9wXANiiHKkIAI0BAJkoRyQCQLsAYFWBUiwCwMIAoKxAIi4EwK4BgFm2MkcCgL0FAHaOWJAPQGAAgJlCLMwAIDgCAEMeE80DIEwDoDDSv+CpX3CFuEgBAMDLlc2XS9IzFLiV0Bp38vDg4iHiwmyxQmEXKRBmCeQinJebIxNI5wNMzgwAABr50cH+OD+Q5+bk4eZm52zv9MWi/mvwbyI+IfHf/ryMAgQAEE7P79pf5eXWA3DHAbB1v2upWwDaVgBo3/ldM9sJoFoK0Hr5i3k4/EAenqFQyDwdHAoLC+0lYqG9MOOLPv8z4W/gi372/EAe/tt68ABxmkCZrcCjg/1xYW52rlKO58sEQjFu9+cj/seFf/2OKdHiNLFcLBWK8ViJuFAiTcd5uVKRRCHJleIS6X8y8R+W/QmTdw0ArIZPwE62B7XLbMB+7gECiw5Y0nYAQH7zLYwaC5EAEGc0Mnn3AACTv/mPQCsBAM2XpOMAALzoGFyolBdMxggAAESggSqwQQcMwRSswA6cwR28wBcCYQZEQAwkwDwQQgbkgBwKoRiWQRlUwDrYBLWwAxqgEZrhELTBMTgN5+ASXIHrcBcGYBiewhi8hgkEQcgIE2EhOogRYo7YIs4IF5mOBCJhSDSSgKQg6YgUUSLFyHKkAqlCapFdSCPyLXIUOY1cQPqQ28ggMor8irxHMZSBslED1AJ1QLmoHxqKxqBz0XQ0D12AlqJr0Rq0Hj2AtqKn0UvodXQAfYqOY4DRMQ5mjNlhXIyHRWCJWBomxxZj5Vg1Vo81Yx1YN3YVG8CeYe8IJAKLgBPsCF6EEMJsgpCQR1hMWEOoJewjtBK6CFcJg4Qxwicik6hPtCV6EvnEeGI6sZBYRqwm7iEeIZ4lXicOE1+TSCQOyZLkTgohJZAySQtJa0jbSC2kU6Q+0hBpnEwm65Btyd7kCLKArCCXkbeQD5BPkvvJw+S3FDrFiOJMCaIkUqSUEko1ZT/lBKWfMkKZoKpRzame1AiqiDqfWkltoHZQL1OHqRM0dZolzZsWQ8ukLaPV0JppZ2n3aC/pdLoJ3YMeRZfQl9Jr6Afp5+mD9HcMDYYNg8dIYigZaxl7GacYtxkvmUymBdOXmchUMNcyG5lnmA+Yb1VYKvYqfBWRyhKVOpVWlX6V56pUVXNVP9V5qgtUq1UPq15WfaZGVbNQ46kJ1Bar1akdVbupNq7OUndSj1DPUV+jvl/9gvpjDbKGhUaghkijVGO3xhmNIRbGMmXxWELWclYD6yxrmE1iW7L57Ex2Bfsbdi97TFNDc6pmrGaRZp3mcc0BDsax4PA52ZxKziHODc57LQMtPy2x1mqtZq1+rTfaetq+2mLtcu0W7eva73VwnUCdLJ31Om0693UJuja6UbqFutt1z+o+02PreekJ9cr1Dund0Uf1bfSj9Rfq79bv0R83MDQINpAZbDE4Y/DMkGPoa5hpuNHwhOGoEctoupHEaKPRSaMnuCbuh2fjNXgXPmasbxxirDTeZdxrPGFiaTLbpMSkxeS+Kc2Ua5pmutG003TMzMgs3KzYrMnsjjnVnGueYb7ZvNv8jYWlRZzFSos2i8eW2pZ8ywWWTZb3rJhWPlZ5VvVW16xJ1lzrLOtt1ldsUBtXmwybOpvLtqitm63Edptt3xTiFI8p0in1U27aMez87ArsmuwG7Tn2YfYl9m32zx3MHBId1jt0O3xydHXMdmxwvOuk4TTDqcSpw+lXZxtnoXOd8zUXpkuQyxKXdpcXU22niqdun3rLleUa7rrStdP1o5u7m9yt2W3U3cw9xX2r+00umxvJXcM970H08PdY4nHM452nm6fC85DnL152Xlle+70eT7OcJp7WMG3I28Rb4L3Le2A6Pj1l+s7pAz7GPgKfep+Hvqa+It89viN+1n6Zfgf8nvs7+sv9j/i/4XnyFvFOBWABwQHlAb2BGoGzA2sDHwSZBKUHNQWNBbsGLww+FUIMCQ1ZH3KTb8AX8hv5YzPcZyya0RXKCJ0VWhv6MMwmTB7WEY6GzwjfEH5vpvlM6cy2CIjgR2yIuB9pGZkX+X0UKSoyqi7qUbRTdHF09yzWrORZ+2e9jvGPqYy5O9tqtnJ2Z6xqbFJsY+ybuIC4qriBeIf4RfGXEnQTJAntieTE2MQ9ieNzAudsmjOc5JpUlnRjruXcorkX5unOy553PFk1WZB8OIWYEpeyP+WDIEJQLxhP5aduTR0T8oSbhU9FvqKNolGxt7hKPJLmnVaV9jjdO31D+miGT0Z1xjMJT1IreZEZkrkj801WRNberM/ZcdktOZSclJyjUg1plrQr1zC3KLdPZisrkw3keeZtyhuTh8r35CP5c/PbFWyFTNGjtFKuUA4WTC+oK3hbGFt4uEi9SFrUM99m/ur5IwuCFny9kLBQuLCz2Lh4WfHgIr9FuxYji1MXdy4xXVK6ZHhp8NJ9y2jLspb9UOJYUlXyannc8o5Sg9KlpUMrglc0lamUycturvRauWMVYZVkVe9ql9VbVn8qF5VfrHCsqK74sEa45uJXTl/VfPV5bdra3kq3yu3rSOuk626s91m/r0q9akHV0IbwDa0b8Y3lG19tSt50oXpq9Y7NtM3KzQM1YTXtW8y2rNvyoTaj9nqdf13LVv2tq7e+2Sba1r/dd3vzDoMdFTve75TsvLUreFdrvUV99W7S7oLdjxpiG7q/5n7duEd3T8Wej3ulewf2Re/ranRvbNyvv7+yCW1SNo0eSDpw5ZuAb9qb7Zp3tXBaKg7CQeXBJ9+mfHvjUOihzsPcw83fmX+39QjrSHkr0jq/dawto22gPaG97+iMo50dXh1Hvrf/fu8x42N1xzWPV56gnSg98fnkgpPjp2Snnp1OPz3Umdx590z8mWtdUV29Z0PPnj8XdO5Mt1/3yfPe549d8Lxw9CL3Ytslt0utPa49R35w/eFIr1tv62X3y+1XPK509E3rO9Hv03/6asDVc9f41y5dn3m978bsG7duJt0cuCW69fh29u0XdwruTNxdeo94r/y+2v3qB/oP6n+0/rFlwG3g+GDAYM/DWQ/vDgmHnv6U/9OH4dJHzEfVI0YjjY+dHx8bDRq98mTOk+GnsqcTz8p+Vv9563Or59/94vtLz1j82PAL+YvPv655qfNy76uprzrHI8cfvM55PfGm/K3O233vuO+638e9H5ko/ED+UPPR+mPHp9BP9z7nfP78L/eE8/sl0p8zAAAAIGNIUk0AAHolAACAgwAA+f8AAIDpAAB1MAAA6mAAADqYAAAXb5JfxUYAAAGCSURBVHjafNFPKKRxHAbw5/v7GYdBYUQjLm5SkoNykCQHtcx431/KgdKumJvSrAO7Nwc3RQ5kd3OkHJC/hUJREluonVcToqRh3sRFPA6M1Mbhc3z6Pj1fkMRHQNJL0uPeul731lU37o1y49cqHr8GvvgWQRLBsmpM/P0j4XAXiooKcXl1CZDEzl4EJBEwAZBUwWAQsVgsFSRR11gmM8trimSa3WypzZ31l5v2/vfk/4oAcv9aSGyUSz4gg/AIAOET0YQswIQWaNrnH+2OeSaY0BJN2+wDTi/OpCrwkxX1vW8q63p5cnaaB+Z/09u7x0nFJTVMiEajPsNCQaC6Ryb8THKcw/Tikho6zj//0RGUNV6gMZ1H8fmpH5iTHDlwsiOhO7FrN5RdP6aBIUj/pvJ2bkFbkxAzBzELELNCQQqgrJ5ST1/jqmYOJcHa7dYYGV5TrQ3d+vfUU+b7IfrOIRCGBYD0o1VGmaHaB6DZkqvMD2hUfF1UAISkvE/+yqbCZ89+HgBtwgFOrBUzJgAAAABJRU5ErkJggg=="),e.setCss(i,{float:"left",margin:0,height:18,display:"none"}),o._fillSmartTagHost.appendChild(n),o._fillSmartTagHost.appendChild(i),o._root.appendChild(o._fillSmartTagHost),o.addEventListener(o._fillSmartTagHost,"mouseover",function(){o._fillSmartTagHost.style.width="32px",i.style.display=""}),o.addEventListener(o._fillSmartTagHost,"mouseleave",function(){o._fillMenuHost||(o._fillSmartTagHost.style.width="18px",i.style.display="none")}),o.addEventListener(o._fillSmartTagHost,"mousedown",function(n){e.hasClass(o._fillSmartTagHost,"wj-flexsheet-smart-tag-active")?(e.removeClass(o._fillSmartTagHost,"wj-flexsheet-smart-tag-active"),o._fillMenuHost.style.display="none"):(e.addClass(o._fillSmartTagHost,"wj-flexsheet-smart-tag-active"),o._showFillMenu(t),t=null),n.preventDefault()},!0)},s.prototype._showFillMenu=function(t){var o,n,i=e.culture.FlexSheet,l=this,s=l._fillSmartTagHost.offsetLeft,r=l._fillSmartTagHost.offsetTop+18;if(!l._fillMenuHost){l._fillMenuHost=document.createElement("div"),e.setCss(l._fillMenuHost,{display:"none",zIndex:100}),l._fillMenuHost.innerHTML='<div class="wj-flexsheet-fill-menu-item">'+i.copyCells+'</div><div class="wj-flexsheet-fill-menu-item">'+i.fillSeries+'</div><div class="wj-flexsheet-fill-menu-item">'+i.fillFormat+'</div><div class="wj-flexsheet-fill-menu-item">'+i.fillWithoutFormat+"</div>",e.addClass(l._fillMenuHost,"wj-flexsheet-fill-menu"),l._root.appendChild(l._fillMenuHost);for(var a=function(t){o=l._fillMenuHost.childNodes[t],l.addEventListener(o,"mousedown",function(o){var n;switch(l._removeActiveStyleForFillMenuItem(),e.addClass(o.target,"wj-flexsheet-fill-menu-item-active"),t){case 0:n=d.CopyFormat|d.CopyContent;break;case 1:n=d.CopyFormat|d.FillSeries;break;case 2:n=d.CopyFormat;break;case 3:n=d.FillSeries}l._fillData(n),l._fillMenuHost.style.display="none",e.removeClass(l._fillSmartTagHost,"wj-flexsheet-smart-tag-active"),o.preventDefault()},!0)},h=0;h<l._fillMenuHost.childElementCount;h++)a(h)}if(t){switch(l._removeActiveStyleForFillMenuItem(),t){case d.CopyFormat|d.CopyContent:n=0;break;case d.CopyFormat|d.FillSeries:n=1;break;case d.CopyFormat:n=2;break;case d.FillSeries:n=3}e.addClass(l._fillMenuHost.childNodes[n],"wj-flexsheet-fill-menu-item-active")}e.setCss(l._fillMenuHost,{display:""}),s+l._ptScrl.x+l._fillMenuHost.offsetWidth+(l.cells.hostElement.offsetHeight>l._root.offsetHeight?17:0)>l._root.offsetWidth&&(s=s-l._fillMenuHost.offsetWidth+l._fillSmartTagHost.offsetWidth),r+l._ptScrl.y+l._fillMenuHost.offsetHeight+ +(l.cells.hostElement.offsetWidth>l._root.offsetWidth?17:0)>l._root.offsetHeight&&(r=l._fillSmartTagHost.offsetTop-l._fillMenuHost.offsetHeight),l._fillMenuHost.style.left=s+"px",l._fillMenuHost.style.top=r+"px"},s.prototype._endDragFillOperation=function(e){this._fillSmartTagHost&&(e instanceof MouseEvent&&(e.target===this._fillSmartTagHost||this._isDescendant(this._fillSmartTagHost,e.target)||e.target===this._fillMenuHost||this._isDescendant(this._fillMenuHost,e.target))||(this.removeEventListener(document.body,"mousedown",this._endDragFillOperationHdl),this._disposeFillSmartTag(),this._fillMenuHost&&this._disposeFillMenu(),this._undoStack._updateCurrentAction(t._FillAction)))},s.prototype._removeActiveStyleForFillMenuItem=function(){for(var t,o=0;o<this._fillMenuHost.childElementCount;o++)t=this._fillMenuHost.childNodes[o],e.removeClass(t,"wj-flexsheet-fill-menu-item-active")},s.prototype._disposeFillSmartTag=function(){this.removeEventListener(this._fillSmartTagHost),this._root.removeChild(this._fillSmartTagHost),this._fillSmartTagHost=null,this._orgCellSettings=null},s.prototype._disposeFillMenu=function(){for(var e,t=0;t<this._fillMenuHost.childElementCount;t++)e=this._fillMenuHost.childNodes[t],this.removeEventListener(e);this._root.removeChild(this._fillMenuHost),this._fillMenuHost=null},s.prototype._handleDropping=function(o){var n,i,l,s,r,a,h;if(this.selectedSheet&&this._draggingCells&&this._dropRange&&!this._containsMergedCells(this._draggingCells)&&!this._containsMergedCells(this._dropRange)){if(this._clearCalcEngine(),this._draggingColumn&&this._draggingCells.leftCol>this._dropRange.leftCol||this._draggingRow&&this._draggingCells.topRow>this._dropRange.topRow)if(o.shiftKey){if(!this._allowExchangeCells(this._draggingRow,!0))return void console.warn("Can not complete operation: You are attempting to change a position of table row or column in a way that is not allowed.");if(this._draggingColumn){for(s=this._dropRange.leftCol,i=this._draggingCells.leftCol;i<=this._draggingCells.rightCol;i++)this.columns.moveElement(i,s),s++;this._exchangeTableColumns(!0)}else if(this._draggingRow)for(l=this._dropRange.topRow,n=this._draggingCells.topRow;n<=this._draggingCells.bottomRow;n++)this.rows.moveElement(n,l),l++;this._exchangeCellStyle(!0)}else{for(this.undoStack.stackSize>0&&(r=new t._MoveCellsAction(this,this._draggingCells,this._dropRange,o.ctrlKey)),l=this._dropRange.topRow,n=this._draggingCells.topRow;n<=this._draggingCells.bottomRow;n++){for(s=this._dropRange.leftCol,i=this._draggingCells.leftCol;i<=this._draggingCells.rightCol;i++)this._moveCellContent(n,i,l,s,o.ctrlKey),this._draggingColumn&&l===this._dropRange.topRow&&(this.columns[s].dataType=this.columns[i].dataType?this.columns[i].dataType:e.DataType.Object,this.columns[s].align=this.columns[i].align,this.columns[s].format=this.columns[i].format,o.ctrlKey||(this.columns[i].dataType=e.DataType.Object,this.columns[i].align=null,this.columns[i].format=null)),s++;l++}if(this._draggingColumn&&!o.ctrlKey)for(s=this._dropRange.leftCol,i=this._draggingCells.leftCol;i<=this._draggingCells.rightCol;i++)this._updateColumnFiler(i,s),s++}else if(this._draggingColumn&&this._draggingCells.leftCol<this._dropRange.leftCol||this._draggingRow&&this._draggingCells.topRow<this._dropRange.topRow)if(o.shiftKey){if(!this._allowExchangeCells(this._draggingRow,!1))return void console.warn("Can not complete operation: You are attempting to change a position of table row or column in a way that is not allowed.");if(this._draggingColumn){for(s=this._dropRange.rightCol,i=this._draggingCells.rightCol;i>=this._draggingCells.leftCol;i--)this.columns.moveElement(i,s),s--;this._exchangeTableColumns(!1)}else if(this._draggingRow)for(l=this._dropRange.bottomRow,n=this._draggingCells.bottomRow;n>=this._draggingCells.topRow;n--)this.rows.moveElement(n,l),l--;this._exchangeCellStyle(!1)}else{for(this.undoStack.stackSize>0&&(r=new t._MoveCellsAction(this,this._draggingCells,this._dropRange,o.ctrlKey)),l=this._dropRange.bottomRow,n=this._draggingCells.bottomRow;n>=this._draggingCells.topRow;n--){for(s=this._dropRange.rightCol,i=this._draggingCells.rightCol;i>=this._draggingCells.leftCol;i--)this._moveCellContent(n,i,l,s,o.ctrlKey),this._draggingColumn&&l===this._dropRange.bottomRow&&(this.columns[s].dataType=this.columns[i].dataType?this.columns[i].dataType:e.DataType.Object,this.columns[s].align=this.columns[i].align,this.columns[s].format=this.columns[i].format,o.ctrlKey||(this.columns[i].dataType=e.DataType.Object,this.columns[i].align=null,this.columns[i].format=null)),s--;l--}if(this._draggingColumn&&!o.ctrlKey)for(s=this._dropRange.rightCol,i=this._draggingCells.rightCol;i>=this._draggingCells.leftCol;i--)this._updateColumnFiler(i,s),s--}o.ctrlKey||(a=this._updateFormulaForDropping(o.shiftKey),h=this._updateNamedRangesForDropping(o.shiftKey)),r&&r.saveNewState()&&(r._affectedFormulas=a,r._affectedDefinedNameVals=h,this._undoStack._addAction(r)),this._undoStack._pendingAction&&(this._undoStack._pendingAction._affectedFormulas=a,this._undoStack._pendingAction._affectedDefinedNameVals=h),this.select(this._dropRange),this.selectedSheet._addSelection(this.selection),this.hostElement.focus()}},s.prototype._moveCellContent=function(t,o,n,i,l){var s,r,a,h,d,c,u,_,g,f=this.getCellData(t,o,!1),p=t*this.columns.length+o,w=n*this.columns.length+i,m=this.selectedSheet._styledCells[p],C=!0;if((r=this.selectedSheet.findTable(n,i))&&(u=r.getRange(),_=r.getColumns(),r.showHeaderRow&&n===u.topRow&&(d=_[h=i-u.leftCol].name,null==f||""===f?C=!1:_[h].name=f)),C){if(l&&f&&"string"==typeof f&&"="===f[0]&&w-p!=0)try{(g=this._calcEngine._parse(f))._moveCellRangeExp(this.selectedSheetIndex,new e.grid.CellRange(t,o),new e.grid.CellRange(n,i),!1,!0)&&(f="="+g._getStringExpression())}catch(e){}this.setCellData(n,i,f)}else C=!0;if(m?this.selectedSheet._styledCells[w]=this._cloneObject(m):delete this.selectedSheet._styledCells[w],l)(s=this.selectedSheet.findTable(t,o))&&(c=s.getRange(),s===r&&t===n&&s.showHeaderRow&&t===c.topRow&&(a=o-c.leftCol,s._updateColumnName(a,f)));else{if(delete this.selectedSheet._styledCells[p],s=this.selectedSheet.findTable(t,o)){if(c=s.getRange(),s===r&&t===n&&s.showHeaderRow&&t===c.topRow)return a=o-c.leftCol,void s._updateColumnName(a,d);if(s.showHeaderRow&&t===c.topRow)return}this.setCellData(t,o,null)}},s.prototype._allowExchangeCells=function(o,n){var i,l,s,r,a,h=this.selectedSheet.tables;for(i=0;i<h.length;i++)if(l=h[i],o?(s=l.getRange(t.TableSection.Data),this._draggingCells.rowSpan,r=new e.grid.CellRange(this._draggingCells.topRow,s.leftCol,this._draggingCells.bottomRow,s.rightCol),a=new e.grid.CellRange(this._dropRange.topRow,s.leftCol,this._dropRange.bottomRow,s.rightCol)):(s=l.getRange(),this._draggingCells.columnSpan,r=new e.grid.CellRange(s.topRow,this._draggingCells.leftCol,s.bottomRow,this._draggingCells.rightCol),a=new e.grid.CellRange(s.topRow,this._dropRange.leftCol,s.bottomRow,this._dropRange.rightCol)),s.intersects(r)&&!s.contains(r)||s.intersects(a)&&!s.contains(a)||s.contains(r)&&!s.contains(a)||!s.contains(r)&&s.contains(a))return!1;return!0},s.prototype._exchangeTableColumns=function(e){var t,o,n,i,l,s,r=this.selectedSheet.tables;for(t=0;t<r.length;t++)if((n=(o=r[t]).getRange()).leftCol<=this._draggingCells.leftCol&&n.rightCol>=this._draggingCells.rightCol)for(i=(e?this._draggingCells.leftCol:this._draggingCells.rightCol)-n.leftCol,l=(e?this._dropRange.leftCol:this._dropRange.rightCol)-n.leftCol,s=0;s<this._draggingCells.columnSpan;s++)o._moveColumns(i,l),e?(i++,l++):(i--,l--)},s.prototype._exchangeCellStyle=function(e){var t,o,n,i,l,s=0,r=[];for(t=this._draggingCells.topRow;t<=this._draggingCells.bottomRow;t++)for(o=this._draggingCells.leftCol;o<=this._draggingCells.rightCol;o++)n=t*this.columns.length+o,this.selectedSheet._styledCells[n]?(r.push(this._cloneObject(this.selectedSheet._styledCells[n])),delete this.selectedSheet._styledCells[n]):r.push(void 0);if(e){if(this._draggingColumn)for(l=this._draggingCells.rightCol-this._draggingCells.leftCol+1,o=this._draggingCells.leftCol-1;o>=this._dropRange.leftCol;o--)for(t=0;t<this.rows.length;t++)n=t*this.columns.length+o,i=t*this.columns.length+o+l,this.selectedSheet._styledCells[n]?(this.selectedSheet._styledCells[i]=this._cloneObject(this.selectedSheet._styledCells[n]),delete this.selectedSheet._styledCells[n]):delete this.selectedSheet._styledCells[i];else if(this._draggingRow)for(l=this._draggingCells.bottomRow-this._draggingCells.topRow+1,t=this._draggingCells.topRow-1;t>=this._dropRange.topRow;t--)for(o=0;o<this.columns.length;o++)n=t*this.columns.length+o,i=(t+l)*this.columns.length+o,this.selectedSheet._styledCells[n]?(this.selectedSheet._styledCells[i]=this._cloneObject(this.selectedSheet._styledCells[n]),delete this.selectedSheet._styledCells[n]):delete this.selectedSheet._styledCells[i]}else if(this._draggingColumn)for(l=this._draggingCells.rightCol-this._draggingCells.leftCol+1,o=this._draggingCells.rightCol+1;o<=this._dropRange.rightCol;o++)for(t=0;t<this.rows.length;t++)n=t*this.columns.length+o,i=t*this.columns.length+o-l,this.selectedSheet._styledCells[n]?(this.selectedSheet._styledCells[i]=this._cloneObject(this.selectedSheet._styledCells[n]),delete this.selectedSheet._styledCells[n]):delete this.selectedSheet._styledCells[i];else if(this._draggingRow)for(l=this._draggingCells.bottomRow-this._draggingCells.topRow+1,t=this._draggingCells.bottomRow+1;t<=this._dropRange.bottomRow;t++)for(o=0;o<this.columns.length;o++)n=t*this.columns.length+o,i=(t-l)*this.columns.length+o,this.selectedSheet._styledCells[n]?(this.selectedSheet._styledCells[i]=this._cloneObject(this.selectedSheet._styledCells[n]),delete this.selectedSheet._styledCells[n]):delete this.selectedSheet._styledCells[i];for(t=this._dropRange.topRow;t<=this._dropRange.bottomRow;t++)for(o=this._dropRange.leftCol;o<=this._dropRange.rightCol;o++)n=t*this.columns.length+o,r[s]?this.selectedSheet._styledCells[n]=r[s]:delete this.selectedSheet._styledCells[n],s++},s.prototype._containsMergedCells=function(e,t){var o,n;if(!(t=t||this.selectedSheet))return!1;for(o=0;o<t._mergedRanges.length;o++)if(n=t._mergedRanges[o],e.intersects(n))return!0;return!1},s.prototype._multiSelectColumns=function(t){var o;t&&this._columnHeaderClicked&&((o=new e.grid.CellRange(t.row,t.col)).row=this.itemsSource&&this.rows[0]&&!this.rows[0].isVisible?1:0,o.row2=this.rows.length-1,o.col2=this.selection.col2,this.select(o))},s.prototype._cumulativeOffset=function(t){var o=0,n=0;do{o+=t.offsetTop||0,n+=t.offsetLeft||0,t=t.offsetParent}while(t);return new e.Point(n,o)},s.prototype._cumulativeScrollOffset=function(t){var o=0,n=0;do{o+=t.scrollTop||0,n+=t.scrollLeft||0,t=t.offsetParent}while(t&&!(t instanceof HTMLBodyElement));return o+=document.body.scrollTop||document.documentElement.scrollTop,n+=document.body.scrollLeft||document.documentElement.scrollLeft,new e.Point(n,o)},s.prototype._checkHitWithinSelection=function(t){var o;if(null!=t&&t.cellType===e.grid.CellType.Cell){if((o=this.getMergedRange(this.cells,t.row,t.col))&&o.contains(this.selection))return!0;if(this.selection.row===t.row&&this.selection.col===t.col)return!0}return!1},s.prototype._clearForEmptySheet=function(t){this.selectedSheet&&0===this[t].length&&!0!==this._isCopying&&!0!==this._isUndoing&&!0!==this._isSorting&&(this.selectedSheet._mergedRanges.length=0,this.selectedSheet._styledCells=null,this.select(new e.grid.CellRange))},s.prototype._containsGroupRows=function(t){var o;for(o=t.topRow;o<=t.bottomRow;o++)if(this.rows[o]instanceof e.grid.GroupRow)return!0;return!1},s.prototype._delSeletionContent=function(o){var n,i,l,s,r,a,h,d,c,u,_,g=this.selectedSheet.selectionRanges.slice(),f=!1,p=new t._EditAction(this),w=this.editableCollectionView,m=!1,C=this.scrollPosition;if(!this.isReadOnly)if(this.allowDelete&&this.selection.isValid&&0===this.selection.leftCol&&this.selection.rightCol===this.columns.length-1)this.deleteRows(this.selection.topRow,this.selection.rowSpan);else{for(this.beginUpdate(),this.undoStack.stackSize>0&&(p=new t._EditAction(this)),null!=g&&0!==g.length||(g=[this.selection]),l=0;l<g.length;l++){if(n=g[l],i=new e.grid.CellRange,u=new e.grid.CellEditEndingEventArgs(this.cells,i,o),(d=this.selectedSheet.tables.length)>0)for(a=d-1;a>=0;a--)h=this.selectedSheet.tables[a],n.contains(h.getRange())&&(p&&p._storeDeletedTables(h),this.selectedSheet.tables.remove(h));for(r=n.topRow;r<=n.bottomRow;r++)if((_=this.rows[r])&&!_.isReadOnly&&(_.visible||this.selectedSheet._freezeHiddenRows&&this.selectedSheet._freezeHiddenRows[r]))for(s=n.leftCol;s<=n.rightCol;s++)(c=this._getBindingColumn(this.cells,r,this.columns[s]))&&!c.isReadOnly&&(!1===c.isRequired||null==c.isRequired&&c.dataType==e.DataType.String)&&(c.visible||this.selectedSheet._freezeHiddenCols[s])&&this.getCellData(r,s,!0)&&(i.setRange(r,s),u.cancel=!1,this.onBeginningEdit(u)&&(w&&(m||(m=!0,w.beginUpdate()),w.editItem(_.dataItem),this._edtHdl._edItem=w.currentEditItem),this.setCellData(r,s,"",!0),f=!0,this.onCellEditEnding(u),this.onCellEditEnded(u)));m&&(w.endUpdate(),w._pendingRefresh=!1,n.rowSpan>1&&w.commitEdit())}f&&p&&(p.saveNewState(),this._undoStack._addAction(p)),this.selection=n,this.scrollPosition=C,this.endUpdate()}},s.prototype._updateAffectedFormula=function(t,o,n,i,l){var s,r,a,h,d,c,u,_,g,f=[],p=[],w=this.selection.clone();for(this.selectedSheet._storeRowSettings(),this.beginUpdate(),s=0;s<this.sheets.length;s++)for(a=(r=this.sheets[s]).grid,h=0;h<a.rows.length;h++)for(d=0;d<a.columns.length;d++)if((_=a.getCellData(h,d,!1))&&e.isString(_)&&"="===_[0]&&(g=this._updateCellRef(_,s,t,o,n,i,l))){if(f.push({sheet:r,point:new e.Point(h,d),formula:_}),c=h,u=d,s===this.selectedSheetIndex&&(i?h>=t&&(n?c+=o:c-=o):d>=t&&(n?u+=o:u-=o),!n&&(i&&h<=t&&h>=t-o+1||!i&&d<=t&&d>=t-o+1)))continue;a.setCellData(h,d,g,!1),p.push({sheet:r,point:new e.Point(c,u),formula:g})}return this.selection=w,this.endUpdate(),{oldFormulas:f,newFormulas:p}},s.prototype._updateAffectedNamedRanges=function(t,o,n,i){var l,s,r,a,h=[],d=[];for(l=0;l<this.definedNames.length;l++)(r=(s=this.definedNames[l]).value)&&e.isString(r)&&(a=this._updateCellRef(r,this.selectedSheetIndex,t,o,n,i))&&(h.push({name:s.name,value:r}),s.value=a,d.push({name:s.name,value:a}));return{oldDefinedNameVals:h,newDefinedNameVals:d}},s.prototype._updateFormulaBoundaryForEditingCell=function(t,o){var n,i,l,s,r=[],a=[];for(this.beginUpdate(),n=t;n<this.rows.length;n++)(l=this.getCellData(n,o,!1))&&e.isString(l)&&"="===l[0]&&(s=this._updateCellBoundary(l,t,o))&&(r.push({point:new e.Point(n,o),formula:l}),this.setCellData(n,o,s,!1),a.push({point:new e.Point(n,o),formula:s}));for(i=o;i<this.columns.length;i++)(l=this.getCellData(t,i,!1))&&e.isString(l)&&"="===l[0]&&(s=this._updateCellBoundary(l,t,o))&&(r.push({point:new e.Point(t,i),formula:l}),this.setCellData(t,i,s,!1),a.push({point:new e.Point(t,i),formula:s}));return this.endUpdate(),{oldFormulas:r,newFormulas:a}},s.prototype._updateColumnFiler=function(e,t){for(var o=JSON.parse(this._filter.filterDefinition),n=0;n<o.filters.length;n++){var i=o.filters[n];if(i.columnIndex===e){i.columnIndex=t;break}}this._filter.filterDefinition=JSON.stringify(o)},s.prototype._isDescendant=function(e,t){for(var o=t.parentNode;null!=o;){if(o===e)return!0;o=o.parentNode}return!1},s.prototype._clearCalcEngine=function(){this._calcEngine._clearExpressionCache()},s.prototype._getRangeString=function(t,o,n){void 0===n&&(n=!0);var i,l,s,r,a,h="",d=!0,c=o===this.selectedSheet?this:o.grid;if(e.isArray(t))if(t.length>1){if(this._isMultipleRowsSelected(t,o)){for(h="",l=0;l<t.length;l++)h&&(h+="\n"),h+=this._getRangeString(t[l],o);return h}if(!this._isMultipleColumnsSelected(t,o))return"";for(h="",i=0,d=!0;i<c.rows.length;i++){for(d||(h+="\n"),d=!1,l=0,f=!0;l<t.length;l++)(s=t[l].clone()).row=s.row2=i,f||(h+="\t"),f=!1,h+=this._getRangeString(t[l],o);return h}}else switch(a=t[0],this.selectionMode){case e.grid.SelectionMode.Row:case e.grid.SelectionMode.RowRange:a.col=0,a.col2=o.grid.columns.length-1;break;case e.grid.SelectionMode.ListBox:a.col=0,a.col2=o.grid.columns.length-1;for(var u=0;u<o.grid.rows.length;u++)o.grid.rows[u].isSelected&&o.grid.rows[u].isVisible&&(a.row=a.row2=u,h&&(h+="\n"),h+=this._getRangeString(a,o));return h}for(var _=(a=e.asType(e.isArray(t)?t[0]:t,e.grid.CellRange)).topRow;_<=a.bottomRow;_++)if(c.rows[_]&&c.rows[_].isVisible){d||(h+="\n"),d=!1;for(var g=a.leftCol,f=!0;g<=a.rightCol;g++)if(c.columns[g]&&c.columns[g].isVisible){f||(h+="\t"),f=!1;var p=this._getCellStyle(_,g,o),w=p?p.format:"",m=c.columns[g];n?(r=c.getCellData(_,g,!1),e.isString(r)&&"="===r[0]&&(r=this._evaluate(r,w,o,_,g)),r=this._formatEvaluatedResult(r,m,w)):(r=c.getCellData(_,g,!1),e.isDate(r)&&(r=e.Globalize.format(r,m.format)),m.dataMap&&(r=m.dataMap.getDisplayValue(r))),(r=(r=null==r?"":r.toString()).replace(/\t/g," ")).indexOf("\n")>-1&&(r='"'+r.replace(/"/g,'""')+'"'),h+=r}}return h},s.prototype._getSelectionForListBoxMode=function(t){for(var o,n=0;n<t.rows.length;n++)t.rows[n].isSelected&&(o?o.row2=n:o=new e.grid.CellRange(n,0,n,t.columns.length-1));return o},s.prototype._containsRandFormula=function(t,o){for(var n=0;n<t.length;n++)for(var i=t[n],l=i.topRow;l<=i.bottomRow&&l<o.grid.rows.length;l++)for(var s=i.leftCol;s<=i.rightCol&&s<o.grid.columns.length;s++){var r=o.grid.getCellData(l,s,!1);if(e.isString(r)&&"="===r[0]&&-1!==r.search(/rand/i))return!0}return!1},s.prototype._isMultipleRowsSelected=function(e,t){var o,n,i;e&&e.length>1?i=e:this.selectedSheet.selectionRanges.length>1&&(i=this.selectedSheet.selectionRanges),o=i[0];for(var l=1;l<i.length;l++)if((n=i[l]).leftCol!==o.leftCol||n.rightCol!==o.rightCol)return!1;return!0},s.prototype._isMultipleColumnsSelected=function(e,t){var o,n,i;e&&e.length>1?i=e:this.selectedSheet.selectionRanges.length>1&&(i=this.selectedSheet.selectionRanges),o=i[0];for(var l=0;l<i.length;l++)if((n=i[l]).topRow!==o.topRow||n.bottomRow!==o.bottomRow)return!1;return!0},s.prototype._postSetClipStringProcess=function(t,o,n,i,l,s,r){var a,h,d,c,u,_,g,f=!1;if(c=new e.grid.CellRangeEventArgs(this.cells,new e.grid.CellRange(o,n),t),this.onPastingCell(c)){if(i>=0&&l>=0&&this._copiedSheet&&(a=this._copiedSheet._getMergedRange(i,l))&&a.topRow===i&&a.leftCol===l){h=(h=o+a.rowSpan-1)<this.rows.length?h:this.rows.length-1,d=(d=n+a.columnSpan-1)<this.columns.length?d:this.columns.length-1;for(var p=new e.grid.CellRange(o,n,h,d),w=p.topRow;w<=p.bottomRow;w++)for(var m=p.leftCol;m<=p.rightCol;m++){var C=this.getMergedRange(this.cells,w,m);if(null!=C&&!C.equals(p))return console.error("We can't paste the merged cell to another merged cell."),!1}this.mergeRange(new e.grid.CellRange(o,n,h,d),!0)}s&&s.editItem(this.rows[o].dataItem),this.cells.setCellData(o,n,c.data)&&(e.isString(c.data)&&(u=c.data.match(/\n/g))&&u.length>0&&(r?r.whiteSpace="pre":r={whiteSpace:"pre"},this.rows[o].height=this.rows.defaultSize*(u.length+1)),_=o*this.columns.length+n,(a=this.selectedSheet._getMergedRange(o,n))&&(_=a.topRow*this.columns.length+a.leftCol),r&&(g=this._cloneObject(r)),this.selectedSheet._styledCells[_]=g,this.onPastedCell(c),f=!0)}return f},s.prototype._delCutData=function(t,o){var n,i,l,s,r=this._copiedSheet===this.selectedSheet?this:this._copiedSheet.grid;for(n=(s=this.selectionMode===e.grid.SelectionMode.ListBox?this._getSelectionForListBoxMode(r):this._copiedRanges[0]).topRow;n<=s.bottomRow;n++)if(null!=r.rows[n])for(i=s.leftCol;i<=s.rightCol;i++)(this._copiedSheet!==this.selectedSheet||n<this.selection.topRow||n>this.selection.topRow+t-1||i<this.selection.leftCol||i>this.selection.leftCol+o-1)&&(0==(l=r._getBindingColumn(r.cells,n,r.columns[i])).isRequired||null==l.isRequired&&l.dataType==e.DataType.String)&&r.getCellData(n,i,!0)&&r.setCellData(n,i,"",!0)},s.prototype._containsMultiLineText=function(e){for(var t=0;t<e.length;t++)for(var o=e[t],n=0;n<o.length;n++)if(o[n].indexOf("\n")>=0)return!0;return!1},s.prototype._sortByRow=function(e,t){return e.topRow>t.topRow?1:e.topRow<t.topRow?-1:0},s.prototype._sortByColumn=function(e,t){return e.leftCol>t.leftCol?1:e.leftCol<t.leftCol?-1:0},s.prototype._setFlexSheetToDirty=function(){this.columns._dirty=!0,this.rows._dirty=!0,this.rowHeaders.columns._dirty=!0,this.rowHeaders.rows._dirty=!0,this.columnHeaders.columns._dirty=!0,this.columnHeaders.rows._dirty=!0},s.convertNumberToAlpha=function(e){var t,o,n="";if(e>=0)do{t=Math.floor(e/26),o=e%26,n=String.fromCharCode(o+65)+n,e=t-1}while(t);return n},s.prototype._updateFormulaForReorderingRows=function(e,t,o){void 0===o&&(o=!1);var n,i,l=o?e-t:t-e;this.beginUpdate();for(var s=0;s<this.columns.length;s++)if((n=this.getCellData(t,s,!1))&&"string"==typeof n&&"="===n[0]&&0!==l){try{i=this._calcEngine._parse(n)}catch(e){continue}i._updateCellRangeExpForReorderingRows(l)&&this.setCellData(t,s,"="+i._getStringExpression())}this.endUpdate()},s.prototype._updateFormulaForDropping=function(t){var o,n,i,l,s,r,a,h,d,c=[],u=[];for(this.beginUpdate(),i=0;i<this.sheets.length;i++)for(n=(o=this.sheets[i]).grid,l=0;l<n.rows.length;l++)for(r=0;r<n.columns.length;r++)(h=n.getCellData(l,r,!1))&&"string"==typeof h&&"="===h[0]&&(d=this._updateCellRefForDropping(h,i,t))&&(n.setCellData(l,r,d,!1),t&&i===this.selectedSheetIndex?(s=n.rows[l],a=n.columns[r],c.push({sheet:o,row:s,column:a,formula:h}),u.push({sheet:o,row:s,column:a,formula:d})):(c.push({sheet:o,point:new e.Point(l,r),formula:h}),u.push({sheet:o,point:new e.Point(l,r),formula:d})));return this.endUpdate(),{oldFormulas:c,newFormulas:u}},s.prototype._updateNamedRangesForDropping=function(t){var o,n,i,l,s=[],r=[];for(o=0;o<this.definedNames.length;o++)(i=(n=this.definedNames[o]).value)&&e.isString(i)&&(l=this._updateCellRefForDropping(i,this.selectedSheetIndex,t))&&(s.push({name:n.name,value:i}),n.value=l,r.push({name:n.name,value:l}));return{oldDefinedNameVals:s,newDefinedNameVals:r}},s.prototype._updateCellRefForDropping=function(e,t,o){var n;void 0===o&&(o=!1);try{n=this._calcEngine._parse(e)}catch(e){return null}return n._moveCellRangeExp(t,this._draggingCells,this._dropRange,o)?"="+n._getStringExpression():null},s.prototype._updateCellStyleForReorderingRows=function(e,t,o){var n,i,l=this.columns.length;for(n=0;n<l;n++)(i=this._getCellStyle(e,n))&&(o[t*l+n]=i)},s.prototype._scanFormulas=function(){for(var t=[],o=0;o<this.rows.length;o++)for(var n=0;n<this.columns.length;n++){var i=this.getCellData(o,n,!1);i&&e.isString(i)&&"="===i[0]&&t.push({row:o,column:n,formula:i})}return t},s.prototype._resetFormulas=function(e){var t=this;e&&t.deferUpdate(function(){for(var o=0;o<e.length;o++){var n=e[o];t.setCellData(n.row,n.column,n.formula)}})},s.prototype._getCellStyle=function(e,t,o){return(o=o||this.selectedSheet)?o.getCellStyle(e,t):null},s.prototype._validateSheetName=function(e){for(var t=0;t<this.sheets.length;t++)if(this.sheets[t].name===e)return!0;return!1},s.prototype._checkExistDefinedName=function(e,t,o){void 0===o&&(o=-1);for(var n=0;n<this.definedNames.length;n++)if(this.definedNames[n].name===e&&this.definedNames[n].sheetName===t&&n!==o)return!0;return!1},s.prototype._updateDefinedNameWithSheetRefUpdating=function(e,t){for(var o,n,i,l=0;l<this.definedNames.length;l++)if((o=this.definedNames[l]).sheetName===e&&null!=o.sheetName&&(o._sheetName=t),(n=o.value.match(/(\w+)\!\$?[A-Za-z]+\$?\d+/g))&&n.length>0)for(var s=0;s<n.length;s++)(i=n[s]).substring(0,i.indexOf("!"))===e&&(o.value=o.value.replace(i,i.replace(e,t)))},s.prototype._updateFormulasWithNameUpdating=function(e,t,o){void 0===o&&(o=!1);var n,i,l,s,r,a,h,d,c,u,_=this.selection.clone(),g=!1;for(u=o?/\[/:/\w/,this.selectedSheet._storeRowSettings(),this.beginUpdate(),n=0;n<this.sheets.length;n++)for(s=this.sheets[n].grid,i=0;i<s.rows.length;i++)for(l=0;l<s.columns.length;l++)if((r=s.getCellData(i,l,!1))&&"string"==typeof r&&"="===r[0]){for(g=!1,a=r.indexOf(e),c=new RegExp(e,"g");a>-1;)h="",d="",a>0&&(h=r[a-1]),a+e.length<r.length&&(d=r[a+e.length]),!/\w/.test(h)&&(o&&u.test(d)||!o&&!u.test(d))&&(r=r.replace(c,function(o,n){return n===a?t:e}),g=!0),a=r.indexOf(e,a+e.length);g&&s.setCellData(i,l,r,!1)}this.selection=_,this.endUpdate()},s.prototype._getDefinedNameIndexByName=function(e){for(var t=0;t<this.definedNames.length;t++)if(this.definedNames[t].name===e)return t;return-1},s.prototype._updateTablesForUpdatingRow=function(e,t,o){var n,i,l,s,r;if(this.selectedSheet.tables.length>0)for(n=this.selectedSheet.tables.length-1;n>=0;n--)if(l=(i=this.selectedSheet.tables[n]).getRange(),o)if((s=e+t-1)<l.topRow)i._updateTableRange(-t,-t,0,0);else if(s>=l.topRow&&s<=l.bottomRow){if(e<=l.topRow&&s===l.bottomRow){null==r&&(r=[]),r.push(i),this.selectedSheet.tables.remove(i);continue}e<l.topRow?(i.showHeaderRow&&(i._showHeaderRow=!1),i._updateTableRange(e-l.topRow,-t,0,0)):(e===l.topRow&&i.showHeaderRow&&(i._showHeaderRow=!1),s===l.bottomRow&&i.showTotalRow&&(i._showTotalRow=!1),i._updateTableRange(0,-t,0,0))}else e<=l.topRow?(null==r&&(r=[]),r.push(i),this.selectedSheet.tables.remove(i)):e<=l.bottomRow&&(i.showTotalRow&&(i._showTotalRow=!1),i._updateTableRange(0,e-l.bottomRow-1,0,0));else e<=l.topRow?i._updateTableRange(t,t,0,0):e>l.topRow&&e<=l.bottomRow&&i._updateTableRange(0,t,0,0);return r},s.prototype._updateTablesForUpdatingColumn=function(e,t,o){var n,i,l,s,r,a,h,d;if(this.selectedSheet.tables.length>0)for(n=this.selectedSheet.tables.length-1;n>=0;n--)if(l=(i=this.selectedSheet.tables[n]).getRange(),o)if((s=e+t-1)<l.leftCol)i._updateTableRange(0,0,-t,-t);else if(s>=l.leftCol&&s<=l.rightCol){if(e<=l.leftCol&&s===l.rightCol){null==d&&(d=[]),d.push(i),this.selectedSheet.tables.remove(i);continue}e<l.leftCol?(r=t-l.leftCol+e,a=l.leftCol,i._updateTableRange(0,0,e-l.leftCol,-t)):(r=t,a=e,i._updateTableRange(0,0,0,-r)),i._columns.splice(a-l.leftCol,r)}else e<=l.leftCol?(null==d&&(d=[]),d.push(i),this.selectedSheet.tables.remove(i)):e<=l.rightCol&&(r=l.rightCol-e+1,i._updateTableRange(0,0,0,-r),i._columns.splice(e,r));else if(e<=l.leftCol)i._updateTableRange(0,0,t,t);else if(e>l.leftCol&&e<=l.rightCol)for(i._updateTableRange(0,0,0,t),a=e-l.leftCol,h=0;h<t;h++)i._addColumn(a+h);return d},s.prototype._isDisableDeleteRow=function(e,t){var o,n,i;if(this.selectedSheet.tables.length>0)for(o=0;o<this.selectedSheet.tables.length;o++)if(i=(n=this.selectedSheet.tables[o]).getRange(),n.showHeaderRow&&i.topRow>=e&&i.topRow<=t)return!0;return!1},s.prototype._copy=function(t,o){var i,l;if("columns"==t){if(n.prototype._copy.call(this,t,o),this.itemsSource&&(i=this.rows[0])instanceof h){i._ubv=null,i._ubv={};for(var s=0;s<this.columns.length;s++)l=this.columns[s],i._ubv[l._hash]=e.toHeaderCase(l.binding)}return!0}return!1},s.prototype._getTableSheetIndex=function(e,t){this.sheets;for(var o=0;o<e.length;o++)if(e[o].indexOf(t)>-1)return o;return-1},s.prototype._sheetSortConverter=function(t,o,i,l){return i=n.prototype._sortConverter.call(this,t,o,i,l),e.isString(i)&&i.length>0&&"="===i[0]&&(i=this.evaluate(i)),i},s.prototype._formatEvaluatedResult=function(t,o,n){return e.isPrimitive(t)?(o.dataMap&&(t=o.dataMap.getDisplayValue(t)),!e.isInt(t)||o.format||o.dataMap||n?((n&&"@"!==n||o.format&&"@"!==o.format)&&e.isString(t)&&(+t).toString()===t&&(t=+t),t=null!=t?e.Globalize.format(t,n||o.format):""):t=t.toString()):t&&(!e.isInt(t.value)||o.format||o.dataMap||n||t.format?(e.isString(t.value)&&(+t.value).toString()===t.value&&(t.value=+t.value),t=null!=t.value?e.Globalize.format(t.value,n||t.format||o.format):""):t=t.value.toString()),t},s.prototype._updateCellRef=function(e,t,o,n,i,l,s){var r;try{r=this._calcEngine._parse(e)}catch(e){return null}return r._updateCellRangeExp(t,o,n,i,l,s)?"="+r._getStringExpression():null},s.prototype._updateCellBoundary=function(e,o,n){var i;try{i=this._calcEngine._parse(e)}catch(e){return null}return i instanceof t._FunctionExpression&&i._updateCellBoundary(o,n)?"="+i._getStringExpression():null},s.prototype._fillData=function(t){var o,n,i,l,s,r,a,h,c,u,_,g,f,p,w,m,C,b=this._fillingRange||this.selection,S=this._fillingSource,y=!t||0!=(t&d.CopyFormat),R=!!t&&0!=(t&d.CopyContent),v=!t||0!=(t&d.FillSeries),x=S.leftCol===b.leftCol&&S.rightCol===b.rightCol,T=[];for(this.beginUpdate(),this._resetCellsForFillRange(t),o=0;o<b.rowSpan;o++)for((i=(h=(s=b.topRow+o)-S.topRow)%S.rowSpan)<0&&(i+=S.rowSpan),n=0;n<b.columnSpan;n++)c=(r=b.leftCol+n)-S.leftCol,h>=0&&h<S.rowSpan&&c>=0&&c<S.columnSpan||((l=c%S.columnSpan)<0&&(l+=S.columnSpan),p=!1,(f=this.getMergedRange(this.cells,S.topRow+i,S.leftCol+l))&&(p=f.topRow===S.topRow+i&&f.leftCol===S.leftCol+l)&&(this.getMergedRange(this.cells,s,r)||this.mergeRange(new e.grid.CellRange(s,r,s+f.rowSpan-1,r+f.columnSpan-1))),y&&(g=null,(_=this.selectedSheet.getCellStyle(S.topRow+i,S.leftCol+l))&&(g=this._cloneObject(_)),a=s*this.columns.length+r,this.selectedSheet._styledCells[a]=g),f&&!p||this.isReadOnly||this.rows[s].isReadOnly||this.columns[r].isReadOnly||(R?(u=this.getCellData(S.topRow+i,S.leftCol+l,!1))&&e.isString(u)&&"="===u[0]?this._fillFormula(u,S.topRow+i,S.leftCol+l,s,r):this.setCellData(s,r,u):v&&(x?(w=n,m=i):(w=o,m=l),null==(u=this.getCellData(S.topRow+i,S.leftCol+l,!1))||e.isString(u)?(u&&e.isString(u)&&"="===u[0]?this._fillFormula(u,S.topRow+i,S.leftCol+l,s,r):this.setCellData(s,r,u),T[w]=null):(T[w]||(T[w]=this._getFillSeries(x,w,m)),(C=T[w])&&(C.items,x?(u=this._getFillData(i,h,S,x,C,null!=t||0===w),C.endIndex===S.topRow+i&&(T[w]=null)):(u=this._getFillData(l,c,S,x,C,null!=t||0===w),C.endIndex===S.leftCol+l&&(T[w]=null)),this.setCellData(s,r,u))))));this._fillingRange&&this.select(this._fillingRange,!1),this.endUpdate()},s.prototype._getFillData=function(e,t,o,n,i,l){var r,a,h=i.items;return 1!==h.length||l?(r=n?Math.floor(t/o.rowSpan)*i.itemIndexes[i.itemIndexes.length-1]+o.topRow+e-i.startIndex+1:Math.floor(t/o.columnSpan)*i.itemIndexes[i.itemIndexes.length-1]+o.leftCol+e-i.startIndex+1,a=this._getLinearBestFitTrendData(h,i.itemIndexes,r),"date"===i.type&&(a=s._fromOADate(a)),a):h[0]},s.prototype._fillFormula=function(t,o,n,i,l){var s,r,a;try{s=this._calcEngine._parse(t),r=new e.grid.CellRange(o,n),a=new e.grid.CellRange(i,l),s._moveCellRangeExp(this.selectedSheetIndex,r,a,!1,!0)&&(t="="+s._getStringExpression())}catch(e){}finally{this.setCellData(i,l,t)}},s.prototype._getFillSeries=function(t,o,n){var i,l,r,a,h,d,c,u,_=this._fillingSource,g=[],f=[];if(t)for(n=_.topRow+n,a=0,h=_.topRow;h<=_.bottomRow;h++){if(d=this.getMergedRange(this.cells,h,_.leftCol+o))if(c&&!d.equals(c)){if(a+=c.rowSpan,c=d,d.leftCol!==_.leftCol+o)continue}else{if(d.topRow!==h||d.leftCol!==_.leftCol+o)continue;a+=1,c=d}else c?(a+=c.rowSpan,c=null):a+=1;if(null!=(u=this.getCellData(h,_.leftCol+o,!1))&&""!==u)if(e.isNumber(u)||e.isDate(u))if(i=e.isNumber(u)?"number":"date",e.isDate(u)&&(u=s._toOADate(u)),0===g.length)r=h,l=i,g.push(u),f.push(a);else if(i===l)g.push(u),f.push(a);else{if(n>=r&&n<=h)return{type:l,startIndex:r,endIndex:h-1,items:g,itemIndexes:f};g.splice(0,g.length),f.splice(0,f.length)}else if(g.length>0){if(n>=r&&n<=h)return{type:l,startIndex:r,endIndex:h-1,items:g,itemIndexes:f};g.splice(0,g.length),f.splice(0,f.length)}}else for(n=_.leftCol+n,a=0,h=_.leftCol;h<=_.rightCol;h++){if(d=this.getMergedRange(this.cells,_.topRow+o,h))if(c&&!d.equals(c)){if(a+=c.columnSpan,c=d,d.topRow!==_.topRow+o)continue}else{if(d.leftCol!==h||d.topRow!==_.topRow+o)continue;a+=1,c=d}else c?(a+=c.columnSpan,c=null):a+=1;if(null!=(u=this.getCellData(_.topRow+o,h,!1))&&""!==u)if(e.isNumber(u)||e.isDate(u))if(i=e.isNumber(u)?"number":"date",e.isDate(u)&&(u=s._toOADate(u)),0===g.length)r=h,l=i,g.push(u),f.push(a);else if(i===l)g.push(u),f.push(a);else{if(n>=r&&n<=h)return{type:l,startIndex:r,endIndex:h-1,items:g,itemIndexes:f};g.splice(0,g.length),f.splice(0,f.length)}else if(g.length>0){if(n>=r&&n<=h)return{type:l,startIndex:r,endIndex:h-1,items:g,itemIndexes:f};g.splice(0,g.length),f.splice(0,f.length)}}return g.length>0?{type:l,startIndex:r,endIndex:h-1,items:g,itemIndexes:f}:null},s.prototype._getLinearBestFitTrendData=function(e,t,o){var n,i,l,s,r=0,a=0,h=0,d=0;if(1===(s=e.length))return e[0]+o-1;for(n=0;n<t.length;n++)r+=i=t[n],h+=i*i,a+=l=e[n],d+=i*l;return o*((s*d-r*a)/(s*h-r*r))+(a*h-r*d)/(s*h-r*r)},s.prototype._getCellSettingsForFill=function(e,t){var o,n,i,l,s,r;for(e||(e=this._fillingSource),t||(t=this._fillingRange),s=[],o=t.topRow;o<=t.bottomRow;o++)for(n=t.leftCol;n<=t.rightCol;n++)o>=e.topRow&&o<=e.bottomRow&&n>=e.leftCol&&n<=e.rightCol||(i=this.getCellData(o,n,!1),l=this._cloneObject(this.selectedSheet.getCellStyle(o,n)),(r=this.getMergedRange(this.cells,o,n))&&r.topRow===o&&r.leftCol===n||(r=null),s.push({row:o,col:n,value:i,style:l,mergedCell:r?r.clone():null}));return s},s.prototype._resetCellsForFillRange=function(e){var t,o,n,i,l,s=!e||0!=(e&d.CopyFormat),r=!!e&&0!=(e&d.CopyContent),a=!e||0!=(e&d.FillSeries);if(this._orgCellSettings&&this._orgCellSettings.length>0)for(t=0;t<this._orgCellSettings.length;t++)n=(o=this._orgCellSettings[t]).row,i=o.col,s||(l=n*this.columns.length+i,this.selectedSheet._styledCells[l]=o.style),r||a||this.setCellData(n,i,o.value)},s.prototype._canDoFillOperation=function(){var e,t,o,n,i,l,s,r,a,h,d,c,u,_,g,f=this._fillingSource,p=this._fillingRange,w=!1;for(e=f.topRow;e<=f.bottomRow;e++)for(t=f.leftCol;t<=f.rightCol;t++)if(h=this.getMergedRange(this.cells,e,t),d){if(!h||!d.equals(h)){w=!0;break}}else d=h;for(o=p.topRow;o<=p.bottomRow;o++)for((n=(i=o-f.topRow)%f.rowSpan)<0&&(n+=f.rowSpan),n+=f.topRow,l=p.leftCol;l<=p.rightCol;l++)if(r=l-f.leftCol,!(i>=0&&i<f.rowSpan&&r>=0&&r<f.columnSpan)&&((s=r%f.columnSpan)<0&&(s+=f.columnSpan),s+=f.leftCol,h=this.getMergedRange(this.cells,n,s),a=this.getMergedRange(this.cells,o,l))){if(w||!h)return!1;if(c=a?o-a.topRow:NaN,u=a?l-a.leftCol:NaN,_=h?n-h.topRow:NaN,g=h?s-h.leftCol:NaN,c!==_||u!==g)return!1}return!0},s.prototype._updateItemIndexForInsertingRow=function(e,t,o){var n,i;for(n=0;n<e.length;n++)(i=e[n])&&null!=i._itemIdx&&i._itemIdx>=t&&(i._itemIdx+=o)},s.prototype._updateItemIndexForRemovingRow=function(e,t){var o,n;for(o=0;o<e.length;o++)(n=e[o])&&null!=n._itemIdx&&n._itemIdx>=t&&(n._itemIdx-=1)},s.prototype._copyRowsToSelectedSheet=function(){var e,t=this;if(t.selectedSheet){for(t.selectedSheet.grid.rows.clear(),e=0;e<t.rows.length;e++)t.selectedSheet.grid.rows.push(t.rows[e]);setTimeout(function(){t._setFlexSheetToDirty(),t.invalidate()},10)}},s.prototype._copyColumnsToSelectedSheet=function(){var e,t=this;if(t.selectedSheet){for(t.selectedSheet.grid.columns.clear(),e=0;e<t.columns.length;e++)t.selectedSheet.grid.columns.push(t.columns[e]);setTimeout(function(){t._setFlexSheetToDirty(),t.invalidate()},10)}},s.prototype._getUniqueColumnName=function(){for(var e=1;null!=this.columns.getColumn("col"+e);)e++;return"col"+e},s.prototype._hideContextMenu=function(){this._contextMenu.hide(),this._tabHolder.sheetControl._contextMenu.hide()},s.prototype._parseFromWorkbookTable=function(o,n){var i,l,s,r,a,h,d,c,u,_,g,f=n===this.selectedSheet?this:n.grid;if(s=(l=o.range.split(":"))[0],r=l[1],a=e.xlsx.Workbook.tableAddress(s),i=new e.grid.CellRange(a.row,a.col),h=e.xlsx.Workbook.tableAddress(r),i.row2=h.row,i.col2=h.col,i.bottomRow>=n.rowCount)for(g=i.bottomRow-n.rowCount+1,p=0;p<g;p++)f.rows.push(new e.grid.Row);if(i.rightCol>=n.columnCount)for(g=i.rightCol-n.columnCount+1,p=0;p<g;p++)f.columns.push(new e.grid.Column);if(o.columns&&o.columns.length>0){d=[];for(var p=0;p<o.columns.length;p++)c=o.columns[p],d[p]=new t.TableColumn(c.name,c.totalRowLabel,c.totalRowFunction,c.showFilterButton)}return null!=o.style&&(u=this._isBuiltInStyleName(o.style.name)?this.getBuiltInTableStyle(o.style.name):this._parseFromWorkbookTableStyle(o.style)),_=new t.Table(o.name,i,u,d,{showHeaderRow:o.showHeaderRow,showTotalRow:o.showTotalRow,showBandedColumns:o.showBandedColumns,showBandedRows:o.showBandedRows,alterFirstColumn:o.alterFirstColumn,alterLastColumn:o.alterLastColumn}),n.tables.push(_),_},s.prototype._parseFromWorkbookTableStyle=function(e){var o=new t.TableStyle(e.name);return null!=e.firstBandedColumnStyle&&(o.firstBandedColumnStyle=this._parseFromWorkbookTableStyleElement(e.firstBandedColumnStyle)),null!=e.firstBandedRowStyle&&(o.firstBandedRowStyle=this._parseFromWorkbookTableStyleElement(e.firstBandedRowStyle)),null!=e.firstColumnStyle&&(o.firstColumnStyle=this._parseFromWorkbookTableStyleElement(e.firstColumnStyle)),null!=e.firstHeaderCellStyle&&(o.firstHeaderCellStyle=this._parseFromWorkbookTableStyleElement(e.firstHeaderCellStyle)),null!=e.firstTotalCellStyle&&(o.firstTotalCellStyle=this._parseFromWorkbookTableStyleElement(e.firstTotalCellStyle)),null!=e.headerRowStyle&&(o.headerRowStyle=this._parseFromWorkbookTableStyleElement(e.headerRowStyle)),null!=e.lastColumnStyle&&(o.lastColumnStyle=this._parseFromWorkbookTableStyleElement(e.lastColumnStyle)),null!=e.lastHeaderCellStyle&&(o.lastHeaderCellStyle=this._parseFromWorkbookTableStyleElement(e.lastHeaderCellStyle)),null!=e.lastTotalCellStyle&&(o.lastTotalCellStyle=this._parseFromWorkbookTableStyleElement(e.lastTotalCellStyle)),null!=e.secondBandedColumnStyle&&(o.secondBandedColumnStyle=this._parseFromWorkbookTableStyleElement(e.secondBandedColumnStyle)),null!=e.secondBandedRowStyle&&(o.secondBandedRowStyle=this._parseFromWorkbookTableStyleElement(e.secondBandedRowStyle)),null!=e.totalRowStyle&&(o.totalRowStyle=this._parseFromWorkbookTableStyleElement(e.totalRowStyle)),null!=e.wholeTableStyle&&(o.wholeTableStyle=this._parseFromWorkbookTableStyleElement(e.wholeTableStyle)),o},s.prototype._parseFromWorkbookTableStyleElement=function(t){var o;return o={fontWeight:t.font&&t.font.bold?"bold":"none",fontStyle:t.font&&t.font.italic?"italic":"none",textDecoration:t.font&&t.font.underline?"underline":"none",fontFamily:t.font&&t.font.family?t.font.family:"",fontSize:t.font&&t.font.size?t.font.size+"px":"",color:t.font&&t.font.color?t.font.color:"",backgroundColor:t.fill&&t.fill.color?t.fill.color:""},t.borders&&(t.borders.left&&(e.grid.xlsx.FlexGridXlsxConverter._parseBorderStyle(t.borders.left.style,"Left",o),o.borderLeftColor=t.borders.left.color),t.borders.right&&(e.grid.xlsx.FlexGridXlsxConverter._parseBorderStyle(t.borders.right.style,"Right",o),o.borderRightColor=t.borders.right.color),t.borders.top&&(e.grid.xlsx.FlexGridXlsxConverter._parseBorderStyle(t.borders.top.style,"Top",o),o.borderTopColor=t.borders.top.color),t.borders.bottom&&(e.grid.xlsx.FlexGridXlsxConverter._parseBorderStyle(t.borders.bottom.style,"Bottom",o),o.borderBottomColor=t.borders.bottom.color),t.borders.vertical&&(e.grid.xlsx.FlexGridXlsxConverter._parseBorderStyle(t.borders.vertical.style,"Vertical",o),o.borderVerticalColor=t.borders.vertical.color),t.borders.horizontal&&(e.grid.xlsx.FlexGridXlsxConverter._parseBorderStyle(t.borders.horizontal.style,"Horizontal",o),o.borderHorizontalColor=t.borders.horizontal.color)),null!=t.size&&(o.size=t.size),o},s.prototype._parseToWorkbookTable=function(t){var o,n,i=new e.xlsx.WorkbookTable,l=t.getRange(),s=t.getColumns();i.name=t.name,o=e.xlsx.Workbook.xlsxAddress(l.topRow,l.leftCol),n=e.xlsx.Workbook.xlsxAddress(l.bottomRow,l.rightCol),i.range=o+":"+n,null!=t.style&&(t.style.isBuiltIn?(i.style=new e.xlsx.WorkbookTableStyle,i.style.name=t.style.name):i.style=this._parseToWorkbookTableStyle(t.style)),i.showBandedColumns=t.showBandedColumns,i.showBandedRows=t.showBandedRows,i.showHeaderRow=t.showHeaderRow,i.showTotalRow=t.showTotalRow,i.alterFirstColumn=t.alterFirstColumn,i.alterLastColumn=t.alterLastColumn;for(var r=0;r<s.length;r++){var a=s[r],h=new e.xlsx.WorkbookTableColumn;h.name=a.name,h.totalRowLabel=a.totalRowLabel,h.totalRowFunction=a.totalRowFunction,h.showFilterButton=a.showFilterButton,i.columns.push(h)}return i},s.prototype._parseToWorkbookTableStyle=function(t){var o=new e.xlsx.WorkbookTableStyle;return o.name=t.name,null!=t.firstBandedColumnStyle&&(o.firstBandedColumnStyle=this._parseToWorkbookTableStyleElement(t.firstBandedColumnStyle,!0)),null!=t.firstBandedRowStyle&&(o.firstBandedRowStyle=this._parseToWorkbookTableStyleElement(t.firstBandedRowStyle,!0)),null!=t.firstColumnStyle&&(o.firstColumnStyle=this._parseToWorkbookTableStyleElement(t.firstColumnStyle)),null!=t.firstHeaderCellStyle&&(o.firstHeaderCellStyle=this._parseToWorkbookTableStyleElement(t.firstHeaderCellStyle)),null!=t.firstTotalCellStyle&&(o.firstTotalCellStyle=this._parseToWorkbookTableStyleElement(t.firstTotalCellStyle)),null!=t.headerRowStyle&&(o.headerRowStyle=this._parseToWorkbookTableStyleElement(t.headerRowStyle)),null!=t.lastColumnStyle&&(o.lastColumnStyle=this._parseToWorkbookTableStyleElement(t.lastColumnStyle)),null!=t.lastHeaderCellStyle&&(o.lastHeaderCellStyle=this._parseToWorkbookTableStyleElement(t.lastHeaderCellStyle)),null!=t.lastTotalCellStyle&&(o.lastTotalCellStyle=this._parseToWorkbookTableStyleElement(t.lastTotalCellStyle)),null!=t.secondBandedColumnStyle&&(o.secondBandedColumnStyle=this._parseToWorkbookTableStyleElement(t.secondBandedColumnStyle,!0)),null!=t.secondBandedRowStyle&&(o.secondBandedRowStyle=this._parseToWorkbookTableStyleElement(t.secondBandedRowStyle,!0)),null!=t.totalRowStyle&&(o.totalRowStyle=this._parseToWorkbookTableStyleElement(t.totalRowStyle)),null!=t.wholeTableStyle&&(o.wholeTableStyle=this._parseToWorkbookTableStyleElement(t.wholeTableStyle)),o},s.prototype._parseToWorkbookTableStyleElement=function(t,o){void 0===o&&(o=!1);var n,i=e.grid.xlsx.FlexGridXlsxConverter._parseCellStyle(t,!0);return o?(n=new e.xlsx.WorkbookTableBandedStyle).size=t.size:n=new e.xlsx.WorkbookTableCommonStyle,n._deserialize(i),n},s.prototype._isBuiltInStyleName=function(e){var t;if(0===e.search(/TableStyleLight/i)){if(t=+e.substring(15),!isNaN(t)&&t>=1&&t<=21)return!0}else if(0===e.search(/TableStyleMedium/i)){if(t=+e.substring(16),!isNaN(t)&&t>=1&&t<=28)return!0}else if(0===e.search(/TableStyleDark/i)&&(t=+e.substring(14),!isNaN(t)&&t>=1&&t<=11))return!0;return!1},s.prototype._getTable=function(e){for(var t,o,n,i=0;i<this.sheets.length;i++)for(o=this.sheets[i].tables,n=0;n<o.length;n++)if((t=o[n]).name.toLowerCase()===e.toLowerCase())return t;return null},s.prototype._checkTableHeaderRow=function(e,o){var n,i,l,s,r;for(i=0;i<e.length;i++)if((n=e[i]).showHeaderRow)for(l=(r=n.getRange(t.TableSection.Header)).row,s=r.leftCol;s<=r.rightCol;s++)o.sheets[0].rows[l].cells[s].isDate=!1},s.prototype._getThemeColor=function(t,o){var n,i=this._colorThemes[t];return null!=o?((n=new e.Color("#"+i).getHsl())[2]=o<0?n[2]*(1+o):n[2]*(1-o)+(1-1*(1-o)),e.Color.fromHsl(n[0],n[1],n[2]).toString()):"#"+i},s.prototype._createBuiltInTableStyle=function(e){var t;if(0===e.search(/TableStyleLight/i)){if(t=+e.substring(15),!isNaN(t)&&t>=1&&t<=21)return t<=7?this._generateTableLightStyle1(t-1,e,!0):t<=14?this._generateTableLightStyle2(t-8,e):this._generateTableLightStyle1(t-15,e,!1)}else if(0===e.search(/TableStyleMedium/i)){if(t=+e.substring(16),!isNaN(t)&&t>=1&&t<=28)return t<=7?this._generateTableMediumStyle1(t-1,e):t<=14?this._generateTableMediumStyle2(t-8,e):t<=21?this._generateTableMediumStyle3(t-15,e):this._generateTableMediumStyle4(t-22,e)}else if(0===e.search(/TableStyleDark/i)&&(t=+e.substring(14),!isNaN(t)&&t>=1&&t<=11))return t<=7?this._generateTableDarkStyle1(t-1,e):this._generateTableDarkStyle2(t-8,e);return null},s.prototype._generateTableLightStyle1=function(e,o,n){var i=new t.TableStyle(o,!0),l=0===e?1:e+3,s=n?"1px":"2px",r=n?"solid":"double",a=n?"1px":"3px";return i.wholeTableStyle={borderTopColor:this._getThemeColor(l),borderTopStyle:"solid",borderTopWidth:"1px",borderBottomColor:this._getThemeColor(l),borderBottomStyle:"solid",borderBottomWidth:"1px"},i.firstColumnStyle={fontWeight:"bold"},i.lastColumnStyle={fontWeight:"bold"},i.headerRowStyle={borderBottomColor:this._getThemeColor(l),borderBottomStyle:"solid",borderBottomWidth:s,fontWeight:"bold"},i.totalRowStyle={borderTopColor:this._getThemeColor(l),borderTopStyle:r,borderTopWidth:a,fontWeight:"bold"},0===e?(i.wholeTableStyle.color=this._getThemeColor(l),i.firstColumnStyle.color=this._getThemeColor(l),i.lastColumnStyle.color=this._getThemeColor(l),i.headerRowStyle.color=this._getThemeColor(l),i.totalRowStyle.color=this._getThemeColor(l),i.firstBandedRowStyle={backgroundColor:this._getThemeColor(0,-.15)},i.firstBandedColumnStyle={backgroundColor:this._getThemeColor(0,-.15)}):(n?(i.wholeTableStyle.color=this._getThemeColor(l,-.25),i.firstColumnStyle.color=this._getThemeColor(l,-.25),i.lastColumnStyle.color=this._getThemeColor(l,-.25),i.headerRowStyle.color=this._getThemeColor(l,-.25),i.totalRowStyle.color=this._getThemeColor(l,-.25)):(i.wholeTableStyle.color=this._getThemeColor(1),i.firstColumnStyle.color=this._getThemeColor(1),i.lastColumnStyle.color=this._getThemeColor(1),i.headerRowStyle.color=this._getThemeColor(1),i.totalRowStyle.color=this._getThemeColor(1)),i.firstBandedRowStyle={backgroundColor:this._getThemeColor(l,.8)},i.firstBandedColumnStyle={backgroundColor:this._getThemeColor(l,.8)}),n||(i.wholeTableStyle.borderLeftColor=this._getThemeColor(l),i.wholeTableStyle.borderLeftStyle="solid",i.wholeTableStyle.borderLeftWidth="1px",i.wholeTableStyle.borderRightColor=this._getThemeColor(l),i.wholeTableStyle.borderRightStyle="solid",i.wholeTableStyle.borderRightWidth="1px",i.wholeTableStyle.borderHorizontalColor=this._getThemeColor(l),i.wholeTableStyle.borderHorizontalStyle="solid",i.wholeTableStyle.borderHorizontalWidth="1px",i.wholeTableStyle.borderVerticalColor=this._getThemeColor(l),i.wholeTableStyle.borderVerticalStyle="solid",i.wholeTableStyle.borderVerticalWidth="1px"),i},s.prototype._generateTableLightStyle2=function(e,o){var n=new t.TableStyle(o,!0),i=0===e?1:e+3;return n.wholeTableStyle={borderTopColor:this._getThemeColor(i),borderTopStyle:"solid",borderTopWidth:"1px",borderBottomColor:this._getThemeColor(i),borderBottomStyle:"solid",borderBottomWidth:"1px",borderLeftColor:this._getThemeColor(i),borderLeftStyle:"solid",borderLeftWidth:"1px",borderRightColor:this._getThemeColor(i),borderRightStyle:"solid",borderRightWidth:"1px",color:this._getThemeColor(1)},n.firstBandedRowStyle={borderTopColor:this._getThemeColor(i),borderTopStyle:"solid",borderTopWidth:"1px"},n.secondBandedRowStyle={borderTopColor:this._getThemeColor(i),borderTopStyle:"solid",borderTopWidth:"1px"},n.firstBandedColumnStyle={borderLeftColor:this._getThemeColor(i),borderLeftStyle:"solid",borderLeftWidth:"1px"},n.secondBandedColumnStyle={borderLeftColor:this._getThemeColor(i),borderLeftStyle:"solid",borderLeftWidth:"1px"},n.firstColumnStyle={fontWeight:"bold",color:this._getThemeColor(1)},n.lastColumnStyle={fontWeight:"bold",color:this._getThemeColor(1)},n.headerRowStyle={backgroundColor:this._getThemeColor(i),fontWeight:"bold",color:this._getThemeColor(0)},n.totalRowStyle={borderTopColor:this._getThemeColor(i),borderTopStyle:"double",borderTopWidth:"3px",fontWeight:"bold",color:this._getThemeColor(1)},n},s.prototype._generateTableMediumStyle1=function(e,o){var n=new t.TableStyle(o,!0),i=0===e?1:e+3;return n.wholeTableStyle={borderTopStyle:"solid",borderTopWidth:"1px",borderBottomStyle:"solid",borderBottomWidth:"1px",borderLeftStyle:"solid",borderLeftWidth:"1px",borderRightStyle:"solid",borderRightWidth:"1px",borderHorizontalStyle:"solid",borderHorizontalWidth:"1px",color:this._getThemeColor(1)},0===e?(n.wholeTableStyle.borderTopColor=this._getThemeColor(i),n.wholeTableStyle.borderBottomColor=this._getThemeColor(i),n.wholeTableStyle.borderLeftColor=this._getThemeColor(i),n.wholeTableStyle.borderRightColor=this._getThemeColor(i),n.wholeTableStyle.borderHorizontalColor=this._getThemeColor(i),n.firstBandedRowStyle={backgroundColor:this._getThemeColor(0,-.15)},n.firstBandedColumnStyle={backgroundColor:this._getThemeColor(0,-.15)}):(n.wholeTableStyle.borderTopColor=this._getThemeColor(i,.4),n.wholeTableStyle.borderBottomColor=this._getThemeColor(i,.4),n.wholeTableStyle.borderLeftColor=this._getThemeColor(i,.4),n.wholeTableStyle.borderRightColor=this._getThemeColor(i,.4),n.wholeTableStyle.borderHorizontalColor=this._getThemeColor(i,.4),n.firstBandedRowStyle={backgroundColor:this._getThemeColor(i,.8)},n.firstBandedColumnStyle={backgroundColor:this._getThemeColor(i,.8)}),n.firstColumnStyle={fontWeight:"bold",color:this._getThemeColor(1)},n.lastColumnStyle={fontWeight:"bold",color:this._getThemeColor(1)},n.headerRowStyle={backgroundColor:this._getThemeColor(i),fontWeight:"bold",color:this._getThemeColor(0)},n.totalRowStyle={borderTopColor:this._getThemeColor(i),borderTopStyle:"double",borderTopWidth:"3px",fontWeight:"bold",color:this._getThemeColor(1)},n},s.prototype._generateTableMediumStyle2=function(e,o){var n=new t.TableStyle(o,!0),i=0===e?1:e+3;return n.wholeTableStyle={borderVerticalStyle:"solid",borderVerticalWidth:"1px",borderVerticalColor:this._getThemeColor(0),borderHorizontalStyle:"solid",borderHorizontalWidth:"1px",borderHorizontalColor:this._getThemeColor(0),color:this._getThemeColor(1)},0===e?(n.wholeTableStyle.backgroundColor=this._getThemeColor(0,-.15),n.firstBandedRowStyle={backgroundColor:this._getThemeColor(0,-.35)},n.firstBandedColumnStyle={backgroundColor:this._getThemeColor(0,-.35)}):(n.wholeTableStyle.backgroundColor=this._getThemeColor(i,.8),n.firstBandedRowStyle={backgroundColor:this._getThemeColor(i,.6)},n.firstBandedColumnStyle={backgroundColor:this._getThemeColor(i,.6)}),n.firstColumnStyle={fontWeight:"bold",color:this._getThemeColor(0),backgroundColor:this._getThemeColor(i)},n.lastColumnStyle={fontWeight:"bold",color:this._getThemeColor(0),backgroundColor:this._getThemeColor(i)},n.headerRowStyle={borderBottomColor:this._getThemeColor(0),borderBottomStyle:"solid",borderBottomWidth:"3px",backgroundColor:this._getThemeColor(i),fontWeight:"bold",color:this._getThemeColor(0)},n.totalRowStyle={borderTopColor:this._getThemeColor(0),borderTopStyle:"solid",borderTopWidth:"3px",backgroundColor:this._getThemeColor(i),fontWeight:"bold",color:this._getThemeColor(0)},n},s.prototype._generateTableMediumStyle3=function(e,o){var n=new t.TableStyle(o,!0),i=0===e?1:e+3;return n.wholeTableStyle={borderTopStyle:"solid",borderTopWidth:"2px",borderTopColor:this._getThemeColor(1),borderBottomStyle:"solid",borderBottomWidth:"2px",borderBottomColor:this._getThemeColor(1),color:this._getThemeColor(1)},0===e&&(n.wholeTableStyle.borderLeftColor=this._getThemeColor(1),n.wholeTableStyle.borderLeftStyle="solid",n.wholeTableStyle.borderLeftWidth="1px",n.wholeTableStyle.borderRightColor=this._getThemeColor(1),n.wholeTableStyle.borderRightStyle="solid",n.wholeTableStyle.borderRightWidth="1px",n.wholeTableStyle.borderVerticalColor=this._getThemeColor(1),n.wholeTableStyle.borderVerticalStyle="solid",n.wholeTableStyle.borderVerticalWidth="1px",n.wholeTableStyle.borderHorizontalColor=this._getThemeColor(1),n.wholeTableStyle.borderHorizontalStyle="solid",n.wholeTableStyle.borderHorizontalWidth="1px"),n.firstBandedRowStyle={backgroundColor:this._getThemeColor(0,-.35)},n.firstBandedColumnStyle={backgroundColor:this._getThemeColor(0,-.35)},n.firstColumnStyle={fontWeight:"bold",color:this._getThemeColor(0),backgroundColor:this._getThemeColor(i)},n.lastColumnStyle={fontWeight:"bold",color:this._getThemeColor(0),backgroundColor:this._getThemeColor(i)},n.headerRowStyle={borderBottomColor:this._getThemeColor(1),borderBottomStyle:"solid",borderBottomWidth:"2px",backgroundColor:this._getThemeColor(i),fontWeight:"bold",color:this._getThemeColor(0)},n.totalRowStyle={borderTopColor:this._getThemeColor(1),borderTopStyle:"double",borderTopWidth:"3px"},n},s.prototype._generateTableMediumStyle4=function(e,o){var n=new t.TableStyle(o,!0),i=0===e?1:e+3;return n.wholeTableStyle={borderTopStyle:"solid",borderTopWidth:"1px",borderBottomStyle:"solid",borderBottomWidth:"1px",borderLeftStyle:"solid",borderLeftWidth:"1px",borderRightStyle:"solid",borderRightWidth:"1px",borderVerticalStyle:"solid",borderVerticalWidth:"1px",borderHorizontalStyle:"solid",borderHorizontalWidth:"1px",color:this._getThemeColor(1)},0===e?(n.wholeTableStyle.borderTopColor=this._getThemeColor(i),n.wholeTableStyle.borderBottomColor=this._getThemeColor(i),n.wholeTableStyle.borderLeftColor=this._getThemeColor(i),n.wholeTableStyle.borderRightColor=this._getThemeColor(i),n.wholeTableStyle.borderVerticalColor=this._getThemeColor(i),n.wholeTableStyle.borderHorizontalColor=this._getThemeColor(i),n.wholeTableStyle.backgroundColor=this._getThemeColor(0,-.15),n.firstBandedRowStyle={backgroundColor:this._getThemeColor(0,-.35)},n.firstBandedColumnStyle={backgroundColor:this._getThemeColor(0,-.35)}):(n.wholeTableStyle.borderTopColor=this._getThemeColor(i,.4),n.wholeTableStyle.borderBottomColor=this._getThemeColor(i,.4),n.wholeTableStyle.borderLeftColor=this._getThemeColor(i,.4),n.wholeTableStyle.borderRightColor=this._getThemeColor(i,.4),n.wholeTableStyle.borderVerticalColor=this._getThemeColor(i,.4),n.wholeTableStyle.borderHorizontalColor=this._getThemeColor(i,.4),n.wholeTableStyle.backgroundColor=this._getThemeColor(i,.8),n.firstBandedRowStyle={backgroundColor:this._getThemeColor(i,.6)},n.firstBandedColumnStyle={backgroundColor:this._getThemeColor(i,.6)}),n.firstColumnStyle={fontWeight:"bold",color:this._getThemeColor(1)},n.lastColumnStyle={fontWeight:"bold",color:this._getThemeColor(1)},n.headerRowStyle={fontWeight:"bold",color:this._getThemeColor(1)},n.totalRowStyle={borderTopColor:this._getThemeColor(i),borderTopStyle:"solid",borderTopWidth:"2px",fontWeight:"bold",color:this._getThemeColor(1)},n},s.prototype._generateTableDarkStyle1=function(e,o){var n=new t.TableStyle(o,!0),i=0===e?1:e+3,l=0===e?.25:-.25;return n.wholeTableStyle={color:this._getThemeColor(0)},n.firstBandedRowStyle={backgroundColor:this._getThemeColor(i,l)},n.firstBandedColumnStyle={backgroundColor:this._getThemeColor(i,l)},n.firstColumnStyle={borderRightColor:this._getThemeColor(0),borderRightStyle:"solid",borderRightWidth:"2px",fontWeight:"bold",color:this._getThemeColor(0),backgroundColor:this._getThemeColor(i,l)},n.lastColumnStyle={borderLeftColor:this._getThemeColor(0),borderLeftStyle:"solid",borderLeftWidth:"2px",fontWeight:"bold",color:this._getThemeColor(0),backgroundColor:this._getThemeColor(i,l)},n.headerRowStyle={borderBottomColor:this._getThemeColor(0),borderBottomStyle:"solid",borderBottomWidth:"2px",fontWeight:"bold",color:this._getThemeColor(0),backgroundColor:this._getThemeColor(1)},n.totalRowStyle={borderTopColor:this._getThemeColor(0),borderTopStyle:"solid",borderTopWidth:"2px",fontWeight:"bold",color:this._getThemeColor(0)},0===e?(n.wholeTableStyle.backgroundColor=this._getThemeColor(i,.5),n.totalRowStyle.backgroundColor=this._getThemeColor(i,.15)):(n.wholeTableStyle.backgroundColor=this._getThemeColor(i),n.totalRowStyle.backgroundColor=this._getThemeColor(i,-.5)),n},s.prototype._generateTableDarkStyle2=function(e,o){var n=new t.TableStyle(o,!0),i=0===e?0:2*e+2,l=0===e?1:2*e+3,s=0===e?-.15:.8;return n.wholeTableStyle={backgroundColor:this._getThemeColor(i,s)},n.firstBandedRowStyle={backgroundColor:this._getThemeColor(i,s-.2)},n.firstBandedColumnStyle={backgroundColor:this._getThemeColor(i,s-.2)},n.firstColumnStyle={fontWeight:"bold",color:this._getThemeColor(1)},n.lastColumnStyle={fontWeight:"bold",color:this._getThemeColor(1)},n.headerRowStyle={color:this._getThemeColor(0),backgroundColor:this._getThemeColor(l)},n.totalRowStyle={borderTopColor:this._getThemeColor(1),borderTopStyle:"double",borderTopWidth:"3px",fontWeight:"bold",color:this._getThemeColor(1)},n},s._toOADate=function(e){var t,o=new Date(1900,0,0),n=Date.UTC(1900,0,0),i=o.getTime()-n-6e4*o.getTimezoneOffset(),l=6e4*(e.getTimezoneOffset()-o.getTimezoneOffset());return t=(e.getTime()-o.getTime()-(0!==l?l-i:0))/864e5,t+=t>59?1:0},s._fromOADate=function(e){var t,o,n,i=new Date(1900,0,0),l=Date.UTC(1900,0,0),s=i.getTime()-l-6e4*i.getTimezoneOffset();return o=e>59?1:0,0!=(t=6e4*((n=new Date(i.getTime()+864e5*(e-o))).getTimezoneOffset()-i.getTimezoneOffset()))?new Date(i.getTime()+t-s+864e5*(e-o)):n},s.controlTemplate='<div style="width:100%;height:100%"><div wj-part="container" style="width:100%">'+e.grid.FlexGrid.controlTemplate+'</div><div wj-part="tab-holder" class="wj-tabholder" style="width:100%; min-width:100px"></div><div wj-part="context-menu" style="display:none;z-index:100"></div></div>',s}(e.grid.FlexGrid);t.FlexSheet=n;var i=function(e){function t(t,o,n){var i=e.call(this)||this;return i._draggingRange=t,i._isDraggingRows=o,i._isShiftKey=n,i}return __extends(t,e),Object.defineProperty(t.prototype,"draggingRange",{get:function(){return this._draggingRange},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isDraggingRows",{get:function(){return this._isDraggingRows},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isShiftKey",{get:function(){return this._isShiftKey},enumerable:!0,configurable:!0}),t}(e.EventArgs);t.DraggingRowColumnEventArgs=i;var l=function(e){function t(t,o){var n=e.call(this)||this;return n._droppingRange=t,n._isDroppingRows=o,n}return __extends(t,e),Object.defineProperty(t.prototype,"droppingRange",{get:function(){return this._droppingRange},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isDroppingRows",{get:function(){return this._isDroppingRows},enumerable:!0,configurable:!0}),t}(e.CancelEventArgs);t.DroppingRowColumnEventArgs=l;var s=function(e){function t(t,o){var n=e.call(this)||this;return n._funcName=t,n._params=o,n}return __extends(t,e),Object.defineProperty(t.prototype,"funcName",{get:function(){return this._funcName},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"params",{get:function(){return this._params},enumerable:!0,configurable:!0}),t}(e.EventArgs);t.UnknownFunctionEventArgs=s;var r=function(t){function o(e,o,n){var i=t.call(this)||this;return i._index=e,i._count=o,i._added=n,i}return __extends(o,t),Object.defineProperty(o.prototype,"index",{get:function(){return this._index},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"count",{get:function(){return this._count},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"added",{get:function(){return this._added},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"isAdd",{get:function(){return e._deprecated("RowColumnChangedEventArgs.isAdd","RowColumnChangedEventArgs.added"),this._added},enumerable:!0,configurable:!0}),o}(e.EventArgs);t.RowColumnChangedEventArgs=r;var a=function(o){function n(e,t,n,i,l){return o.call(this,e,t,n,i,l)||this}return __extends(n,o),n.prototype.getSelectedState=function(t,n,i){var l,s,r,a,h,d;if(this.grid){if(d=this.grid.getMergedRange(this,t,n),l=this.grid.selectedSheet?this.grid.selectedSheet.selectionRanges:null,h=o.prototype.getSelectedState.call(this,t,n,i),s=l?l.length:0,h===e.grid.SelectedState.None&&s>0)for(r=0;r<l.length;r++)if((a=l[r])&&a instanceof e.grid.CellRange){if(this.cellType===e.grid.CellType.Cell){if(d){if(d.contains(a.row,a.col))return r!==s-1||this.grid._isClicking?e.grid.SelectedState.Selected:this.grid.showMarquee?e.grid.SelectedState.None:e.grid.SelectedState.Cursor;if(d.intersects(a))return e.grid.SelectedState.Selected}if(a.row===t&&a.col===n)return r!==s-1||this.grid._isClicking?e.grid.SelectedState.Selected:this.grid.showMarquee?e.grid.SelectedState.None:e.grid.SelectedState.Cursor;if(a.contains(t,n))return e.grid.SelectedState.Selected}if(this.grid.showSelectedHeaders&e.grid.HeadersVisibility.Row&&this.cellType===e.grid.CellType.RowHeader&&a.containsRow(t))return e.grid.SelectedState.Selected;if(this.grid.showSelectedHeaders&e.grid.HeadersVisibility.Column&&this.cellType===e.grid.CellType.ColumnHeader&&a.containsColumn(n))return e.grid.SelectedState.Selected}return h}},n.prototype.getCellData=function(t,n,i){var l,s,r,a,h,d;if(e.isString(n)&&(n=this.columns.indexOf(n))<0)throw"Invalid column name or binding.";return t>=this.rows.length||e.asNumber(n,!1,!0)>=this.columns.length?null:(l=o.prototype.getCellData.call(this,t,n,i),s=this.columns[e.asNumber(n,!1,!0)],r=this.grid?this.grid._getBindingColumn(this,t,s):s,i&&(h=o.prototype.getCellData.call(this,t,n,!1),a=this.grid?this.grid._getCellStyle(t,n):null,e.isNumber(h)&&0!==h&&(r&&r.dataMap||(""===(d=a?a.format:"")&&(d=r?r.format:""),l=e.Globalize.format(h,d)))),l)},n.prototype.setCellData=function(n,i,l,s,r){if(void 0===s&&(s=!0),void 0===r&&(r=!0),n>=this.rows.length||i>=this.columns.length)return!1;var a,d,c,u,_,g=this.getCellData(n,i,!1),f=this.grid._isPasting,p=this.columns[i],w=this.grid?this.grid._getBindingColumn(this,n,p):p,m=this.rows[n],C=this.grid?this.grid._getCellStyle(n,i):null,b=e.getType(g),S=e.culture.Globalize.numberFormat.currency.symbol,y=!1,R=!1;if(this.grid&&(c=this.grid.selectedSheet.findTable(n,i))&&c.showHeaderRow&&n===(u=c.getRange(t.TableSection.Header)).row&&i>=u.leftCol&&i<=u.rightCol){if(null==l||e.isString(l)&&e.isNullOrWhiteSpace(l))return;if(!(m instanceof h))return o.prototype.setCellData.call(this,n,i,l.toString(),!1,r);m._ubv[w._hash]=l.toString()}if(s&&l&&e.isString(l)&&"'"!==l[0]&&"="!==l[0]){if(this.getCellData(n,i,!0)===l)return!1;var v=C?C.format:"";/[hsmt\:]/.test(v)||(v=""),(a=e.Globalize.parseDate(l,v))?l=a:(_=new RegExp("[^\\d,\\.]","g"),y=l[0]===S,R="%"===l[l.length-1],w.dataType===e.DataType.String||e.isNullOrWhiteSpace(l)||null!=g&&b!==e.DataType.Number||_.test(l)&&!y&&!R?w.dataType===e.DataType.Boolean&&(l=e.changeType(l,e.DataType.Boolean,null)):(d=e.changeType(l,e.DataType.Number,""),e.isNumber(d)?(l=d,v||(y?this.grid.applyCellsStyle({format:"C"+(e.isInt(l)?"0":"")},[new e.grid.CellRange(n,i)]):R&&this.grid.applyCellsStyle({format:"P"+(e.isInt(100*l)?"0":"")},[new e.grid.CellRange(n,i)]))):s=!1))}if((l&&e.isString(l)&&("="===l[0]||"'"===l[0])||!w.dataType)&&(s=!1),!(m instanceof h))return o.prototype.setCellData.call(this,n,i,l,s&&!f,r);m._ubv[w._hash]=l},n.prototype._renderCell=function(t,n,i,l,s,r){var a,h,d,c,u=n*this.grid.columns.length+i,_=this.grid.getMergedRange(this,n,i);return c=o.prototype._renderCell.call(this,t,n,i,l,s,r),this.cellType!==e.grid.CellType.Cell?c:_&&u>_.topRow*this.grid.columns.length+_.leftCol?c:this.columns[i].renderSize<=0&&(!_||_.getRenderSize(this).width<=0)?c:((a=t.childNodes[r])&&(null!=this.grid.editRange&&this.grid.editRange.contains(n,i)||this.grid.selectedSheet&&(d=this.grid.selectedSheet.findTable(n,i))&&d._updateCell(n,i,a),e.hasClass(a,"wj-state-selected")||e.hasClass(a,"wj-state-multi-selected")?(a.style.backgroundColor="",a.style.color=""):this.grid.selectedSheet&&(h=this.grid.selectedSheet._styledCells[u])&&(""!==h.backgroundColor&&(a.style.backgroundColor=h.backgroundColor),""!==h.color&&(a.style.color=h.color))),c)},n}(e.grid.GridPanel);t.FlexSheetPanel=a;var h=function(e){function t(){var t=e.call(this)||this;return t.isReadOnly=!0,t}return __extends(t,e),t}(e.grid.Row);t.HeaderRow=h;var d,c=function(){function e(e,t,o,n){if(this._owner=e,this._name=t,this._value=o,null!=n){if(!e._validateSheetName(n))throw"The sheet name:("+n+") does not exist in FlexSheet.";this._sheetName=n}}return Object.defineProperty(e.prototype,"name",{get:function(){return this._name},set:function(e){var t;if(this._name!==e){if(this._owner._checkExistDefinedName(name,this._sheetName))throw"The "+name+" already existed in definedNames.";t=this._name,this._name=e,this._owner._updateFormulasWithNameUpdating(t,this._name)}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"value",{get:function(){return this._value},set:function(e){this._value!==e&&(this._value=e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"sheetName",{get:function(){return this._sheetName},enumerable:!0,configurable:!0}),e}();t.DefinedName=c,function(e){e[e.CopyFormat=1]="CopyFormat",e[e.CopyContent=2]="CopyContent",e[e.FillSeries=4]="FillSeries"}(d||(d={}))})((t=e.grid||(e.grid={})).sheet||(t.sheet={}))}(wijmo||(wijmo={})),function(e){!function(t){!function(t){"use strict";var o=function(){function o(o){this.MAX_STACK_SIZE=500,this._stack=[],this._pointer=-1,this._resizingTriggered=!1,this.undoStackChanged=new e.Event;var n=this;n._owner=o,n._owner.prepareCellForEdit.addHandler(n._initCellEditAction,n),n._owner.cellEditEnded.addHandler(function(e,o){n._pendingAction&&(!o.data||46!==o.data.keyCode&&8!==o.data.keyCode)&&n._pendingAction instanceof t._EditAction&&!n._pendingAction.isPaste&&n._afterProcessCellEditAction(n)},n),n._owner.pasting.addHandler(n._initCellEditActionForPasting,n),n._owner.pastingCell.addHandler(function(e,o){n._pendingAction&&(n._pendingAction instanceof t._EditAction?n._pendingAction.updateForPasting(o.range):n._pendingAction instanceof t._CutAction&&n._pendingAction.updateForPasting(o.range))},n),n._owner.pasted.addHandler(function(){n._pendingAction&&(n._pendingAction instanceof t._EditAction&&n._pendingAction.isPaste?n._afterProcessCellEditAction(n):n._pendingAction instanceof t._CutAction&&(n._pendingAction.saveNewState(),n._addAction(n._pendingAction),n._pendingAction=null))},n),n._owner.resizingColumn.addHandler(function(e,o){0!==n.stackSize&&n._owner.selectedSheet&&(n._resizingTriggered||(n._pendingAction=new t._ColumnResizeAction(n._owner,o.panel,o.col),n._resizingTriggered=!0))},n),n._owner.resizedColumn.addHandler(function(e,o){n._pendingAction instanceof t._ColumnResizeAction&&n._pendingAction.saveNewState()&&n._addAction(n._pendingAction),n._pendingAction=null,n._resizingTriggered=!1},n),n._owner.resizingRow.addHandler(function(e,o){0!==n.stackSize&&n._owner.selectedSheet&&(n._resizingTriggered||(n._pendingAction=new t._RowResizeAction(n._owner,o.panel,o.row),n._resizingTriggered=!0))},n),n._owner.resizedRow.addHandler(function(e,o){n._pendingAction instanceof t._RowResizeAction&&n._pendingAction.saveNewState()&&n._addAction(n._pendingAction),n._pendingAction=null,n._resizingTriggered=!1},n),n._owner.draggingRowColumn.addHandler(function(e,o){0!==n.stackSize&&n._owner.selectedSheet&&o.isShiftKey&&(o.isDraggingRows?n._pendingAction=new t._RowsChangedAction(n._owner):n._pendingAction=new t._ColumnsChangedAction(n._owner))},n),n._owner.endDroppingRowColumn.addHandler(function(e){!e.cancel&&n._pendingAction&&n._pendingAction.saveNewState()&&n._addAction(n._pendingAction),n._pendingAction=null},n)}return Object.defineProperty(o.prototype,"stackSize",{get:function(){return null==this._stackSize?this.MAX_STACK_SIZE:this._stackSize},set:function(t){e.isNumber(t)&&(t<0?this._stackSize=0:t>this.MAX_STACK_SIZE?this._stackSize=this.MAX_STACK_SIZE:this._stackSize=Math.floor(t))},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"canUndo",{get:function(){return this._pointer>-1&&this._pointer<this._stack.length},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"canRedo",{get:function(){return this._pointer+1>-1&&this._pointer+1<this._stack.length},enumerable:!0,configurable:!0}),o.prototype.onUndoStackChanged=function(){this.undoStackChanged.raise(this)},o.prototype.undo=function(){var e;this.canUndo&&(e=this._stack[this._pointer],this._beforeUndoRedo(e),e.undo(),this._pointer--,this.onUndoStackChanged())},o.prototype.redo=function(){var e;this.canRedo&&(this._pointer++,e=this._stack[this._pointer],this._beforeUndoRedo(e),e.redo(),this.onUndoStackChanged())},o.prototype.clear=function(){this._stack.length=0},o.prototype._addAction=function(e){this._stack.length>0&&this._stack.length>this._pointer+1&&this._stack.splice(this._pointer+1,this._stack.length-this._pointer-1),this._stack.length>=this.stackSize&&this._stack.splice(0,this._stack.length-this.stackSize+1),this._pointer=this._stack.length,this._stack.push(e),this.onUndoStackChanged()},o.prototype._pop=function(){var e;return this._pointer<0?null:(e=this._stack[this._pointer],this._pointer--,e)},o.prototype._updateCurrentAction=function(e){var t;this._pointer<0||(t=this._stack[this._pointer])instanceof e&&t.saveNewState()},o.prototype._initCellEditAction=function(e,o){0!==this.stackSize&&this._owner.selectedSheet&&(this._pendingAction=new t._EditAction(this._owner,o.range))},o.prototype._initCellEditActionForPasting=function(){0!==this.stackSize&&this._owner.selectedSheet&&(this._owner._isCutting?this._pendingAction=new t._CutAction(this._owner):(this._pendingAction=new t._EditAction(this._owner),this._pendingAction.markIsPaste()))},o.prototype._afterProcessCellEditAction=function(e){e._pendingAction&&(e._pendingAction instanceof t._EditAction&&e._pendingAction.saveNewState()&&e._addAction(this._pendingAction),e._pendingAction=null)},o.prototype._beforeUndoRedo=function(e){this._owner.selectedSheetIndex=e.sheetIndex},o}();t.UndoStack=o}(t.sheet||(t.sheet={}))}(e.grid||(e.grid={}))}(wijmo||(wijmo={})),function(e){!function(t){!function(t){"use strict";var o=function(o){function n(){return null!==o&&o.apply(this,arguments)||this}return __extends(n,o),n.prototype.updateEditor=function(){var n,i,l,s,r,a,h,d,c,u=this.filter.column,_=u.grid,g=u.index,f=[],p={};if(this.filter.uniqueValues||null!=_.itemsSource&&null!=_.childItemsPath)o.prototype.updateEditor.call(this);else{for(var w=0;w<_.rows.length;w++)r=this.filter.apply(w),s=this.filter.showValues,this.filter.showValues=null,a=_.filter._filter(w),this.filter.showValues=s,(!(i=_.getMergedRange(_.cells,w,g))||w===i.topRow&&g===i.leftCol)&&((n=_.rows[w])instanceof t.HeaderRow||n instanceof e.grid.GroupRow||n instanceof e.grid._NewRowTemplate||!(n.visible||!r&&a)||(l=_.getCellValue(w,g),h=this.filter.dataMap?this.filter.dataMap.getDisplayValue(l):_.getCellValue(w,g,!0),l=""===l?null:l,d=_.getCellData(w,g,!0),p[h]||(p[h]=!0,c=d&&"="===d[0]?w+"_"+g:"",f.push({value:l,text:h,cellRef:c}))));var m=this.filter.showValues;if(m&&0!=Object.keys(m).length){for(var C in m)for(w=0;w<f.length;w++)if(m[C]&&""!==f[w].cellRef&&f[w].cellRef===m[C].cellRef)m[f[w].text]={show:!0,cellRef:f[w].cellRef},f[w].show=!0,delete m[C];else if(f[w].text==C){f[w].show=!0;break}}else for(var w=0;w<f.length;w++)f[w].show=!0;this._lbValues.isContentHtml=u.isContentHtml,this._cmbFilter.text=this.filter.filterText,this._filterText=this._cmbFilter.text.toLowerCase(),this._view.pageSize=this.filter.maxValues,this._view.sourceCollection=f,this._view.moveCurrentToPosition(-1)}},n.prototype.updateFilter=function(){var e=null,t=this._view.items;if(this._filterText||this._cbSelectAll.indeterminate){e={};for(var o=0;o<t.length;o++){var n=t[o];n.show&&(e[n.text]={show:!0,cellRef:n.cellRef})}}this._filter.showValues=e,this._filter.filterText=this._filterText},n}(e.grid.filter.ValueFilterEditor);t.FlexSheetValueFilterEditor=o}(t.sheet||(t.sheet={}))}(e.grid||(e.grid={}))}(wijmo||(wijmo={})),function(e){!function(t){!function(t){"use strict";var o=function(o){function n(e){return o.call(this,e)||this}return __extends(n,o),n.prototype.apply=function(o){var n,i,l,s,r=this.column,a=r.grid,h=this.condition1,d=this.condition2;if(!(a instanceof t.FlexSheet))return!0;if(!this.isActive)return!0;if(a.rows[o]instanceof e.grid._NewRowTemplate)return!0;""===(n=a.getCellValue(o,r.index))&&r.dataType!==e.DataType.String&&(n=null),i=l=n,(s=this.dataMap||r.dataMap)?i=l=n=s.getDisplayValue(n):e.isDate(n)?(e.isString(h.value)||e.isString(d.value))&&(i=l=n=a.getCellValue(o,r.index,!0)):e.isNumber(n)?(i=l=n=e.Globalize.parseFloat(a.getCellValue(o,r.index,!0)),0!==n||r.dataType||(h.isActive&&""===h.value&&(i=n.toString()),d.isActive&&""===d.value&&(l=l.toString()))):null==n&&(h.isActive&&e.isNumber(h.value)&&(i=NaN),d.isActive&&e.isNumber(d.value)&&(l=NaN));var c=h.apply(i),u=d.apply(l);return h.isActive&&d.isActive?this.and?c&&u:c||u:h.isActive?c:!d.isActive||u},n}(e.grid.filter.ConditionFilter);t.FlexSheetConditionFilter=o}(t.sheet||(t.sheet={}))}(e.grid||(e.grid={}))}(wijmo||(wijmo={})),function(e){!function(t){!function(t){"use strict";var o=function(o){function n(e){return o.call(this,e)||this}return __extends(n,o),n.prototype.apply=function(o){var n,i=this.column.grid;return!(i instanceof t.FlexSheet)||(!this.showValues||!Object.keys(this.showValues).length||(i.rows[o]instanceof e.grid._NewRowTemplate||(o=(n=this.dataMap||this.column.dataMap)?n.getDisplayValue(i.getCellValue(o,this.column.index)):i.getCellValue(o,this.column.index,!0),void 0!=this.showValues[o])))},n}(e.grid.filter.ValueFilter);t.FlexSheetValueFilter=o}(t.sheet||(t.sheet={}))}(e.grid||(e.grid={}))}(wijmo||(wijmo={})),function(e){!function(t){!function(t){"use strict";var o=function(e){function o(o,n){var i=e.call(this,o,n)||this;return i._valueFilter=new t.FlexSheetValueFilter(n),i._valueFilter.exclusiveValueSearch=o.exclusiveValueSearch,i._conditionFilter=new t.FlexSheetConditionFilter(n),i}return __extends(o,e),o}(e.grid.filter.ColumnFilter);t.FlexSheetColumnFilter=o}(t.sheet||(t.sheet={}))}(e.grid||(e.grid={}))}(wijmo||(wijmo={})),function(e){!function(t){!function(t){"use strict";var o=function(o){function n(e,t,n){void 0===n&&(n=!0);var i,l,s=o.call(this,e,t,n)||this,r=s;return n&&(s._divSort.style.display=""),i=s.cloneElement(s._btnAsc),l=s.cloneElement(s._btnDsc),s._btnAsc.parentNode.replaceChild(i,s._btnAsc),s._btnDsc.parentNode.replaceChild(l,s._btnDsc),i.addEventListener("click",function(e){r._sortBtnClick(e,!0)}),l.addEventListener("click",function(e){r._sortBtnClick(e,!1)}),s}return __extends(n,o),n.prototype._showFilter=function(n){n==e.grid.filter.FilterType.Value&&null==this._edtVal&&(this._edtVal=new t.FlexSheetValueFilterEditor(this._divEdtVal,this.filter.valueFilter)),o.prototype._showFilter.call(this,n)},n.prototype._sortBtnClick=function(e,t){var o,n,i=this.filter.column,l=i.grid.sortManager;e.preventDefault(),e.stopPropagation(),(o=l.checkSortItemExists(i.index))>-1?(l.sortDescriptions.moveCurrentToPosition(o),l.sortDescriptions.currentItem.ascending=t,n=-o):(l.addSortLevel(i.index,t),n=-(l.sortDescriptions.items.length-1)),l.moveSortLevel(n),l.commitSort(),this.onButtonClicked()},n.prototype.cloneElement=function(e){for(var t=e.cloneNode();e.firstChild;)t.appendChild(e.lastChild);return t},n}(e.grid.filter.ColumnFilterEditor);t.FlexSheetColumnFilterEditor=o}(t.sheet||(t.sheet={}))}(e.grid||(e.grid={}))}(wijmo||(wijmo={})),function(e){!function(t){!function(t){"use strict";var o=function(o){function n(){return null!==o&&o.apply(this,arguments)||this}return __extends(n,o),Object.defineProperty(n.prototype,"filterDefinition",{get:function(){for(var e={filters:[]},t=0;t<this._filters.length;t++){var o=this._filters[t];if(o&&o.column&&this.grid.columns.indexOf(o.column)>-1)if(o.conditionFilter.isActive){var n=o.conditionFilter;e.filters.push({columnIndex:o.column.index,type:"condition",condition1:{operator:n.condition1.operator,value:n.condition1.value},and:n.and,condition2:{operator:n.condition2.operator,value:n.condition2.value}})}else if(o.valueFilter.isActive){var i=o.valueFilter;e.filters.push({columnIndex:o.column.index,type:"value",filterText:i.filterText,showValues:i.showValues})}}return JSON.stringify(e)},set:function(t){var o=JSON.parse(e.asString(t));this.clear();for(var n=0;n<o.filters.length;n++){var i=o.filters[n],l=this.grid.columns[i.columnIndex],s=this.getColumnFilter(l,!0);if(s)switch(i.type){case"condition":var r=s.conditionFilter;r.condition1.value=l.dataType==e.DataType.Date?e.changeType(i.condition1.value,l.dataType,null):i.condition1.value,r.condition1.operator=i.condition1.operator,r.and=i.and,r.condition2.value=l.dataType==e.DataType.Date?e.changeType(i.condition2.value,l.dataType,null):i.condition2.value,r.condition2.operator=i.condition2.operator;break;case"value":var a=s.valueFilter;a.filterText=i.filterText,a.showValues=i.showValues}}this.apply()},enumerable:!0,configurable:!0}),n.prototype.apply=function(){var o=this;o.grid.deferUpdate(function(){for(var n,i,l,s=-1,r=0;r<o.grid.rows.length;r++)if(!((n=o.grid.rows[r])instanceof t.HeaderRow||r<=s))if(s=-1,i=o._filter(r),n instanceof e.grid.GroupRow){if(l=n.getCellRange(),null==n.dataItem||n.dataItem instanceof e.collections.CollectionViewGroup)n.visible=o._checkGroupVisible(l);else if(n.visible=i,s=l.bottomRow,l.isValid)for(var a=l.topRow;a<=l.bottomRow;a++)o.grid.rows[a].visible=i}else n.visible=i;o.grid._isCopying||o.grid._isUndoing||o.grid._isSorting||o.onFilterApplied()})},n.prototype.editColumnFilter=function(o,n){var i=this,l=i.grid;i.closeEditor(),o=i._asColumn(o);var s=document.createElement("div"),r=i.getColumnFilter(o),a=new t.FlexSheetColumnFilterEditor(s,r,i.showSortButtons);e.addClass(s,"wj-dropdown-panel"),i._divEdt=s,i._edtCol=o;var h=new e.grid.CellRangeEventArgs(l.cells,new e.grid.CellRange(-1,o.index));if(i.onFilterChanging(h),h.cancel)return i._divEdt=null,void(i._edtCol=null);h.cancel=!0,l.undoStack.stackSize>0&&(i._undoAcion=new t._FilteringAction(l)),l.rightToLeft&&(s.dir="rtl"),a.filterChanged.addHandler(function(){h.cancel=!1,i._filterChanged=!0,setTimeout(function(){h.cancel||(i.apply(),i._undoAcion&&(i._undoAcion.saveNewState(),l.undoStack._addAction(i._undoAcion),i._undoAcion=null))})}),a.buttonClicked.addHandler(function(){i.closeEditor(),l.focus(),i.onFilterChanged(h)}),a.lostFocus.addHandler(function(){setTimeout(function(){var t=e.Control.getControl(i._divEdt);t&&!t.containsFocus()&&i.closeEditor()},10)}),l._edtHdl._commitRowEdits(),l.scrollIntoView(-1,o.index,!0);var d=i.grid.columnHeaders,c=n?n.row:d.rows.length-1,u=n?n.col:o.index,_=d.getCellBoundingRect(c,u),g=document.elementFromPoint(_.left+_.width/2,_.top+_.height/2);(g=e.closest(g,".wj-cell"))?e.showPopup(s,g,!1,!1,!1):e.showPopup(s,_),i._setAriaExpanded(g,!0),i._setAriaExpanded(l.cells.getCellElement(-1,u),!0);for(var f=a.hostElement.querySelectorAll("input"),p=0;p<f.length;p++){var w=f[p];if(w.offsetHeight>0&&w.tabIndex>-1&&!w.disabled){w.focus();break}}a.containsFocus()||a.focus()},n.prototype.closeEditor=function(){this._undoAcion&&!this._filterChanged&&(this._undoAcion=null),o.prototype.closeEditor.call(this)},n.prototype.getColumnFilter=function(o,n){if(void 0===n&&(n=!0),e.isString(o)?o=this.grid.columns.getColumn(o):e.isNumber(o)&&(o=this.grid.columns[o]),!o)return null;o=e.asType(o,e.grid.Column);for(var i=0;i<this._filters.length;i++)if(this._filters[i].column==o)return this._filters[i];if(n){var l=new t.FlexSheetColumnFilter(this,o);return this._filters.push(l),l}return null},n.prototype._checkGroupVisible=function(t){for(var o,n=!0,i=t.topRow+1;i<=t.bottomRow;i++)if(o=this.grid.rows[i])if(o instanceof e.grid.GroupRow)n=this._checkGroupVisible(o.getCellRange());else if(n=this._filter(i))break;return n},n}(e.grid.filter.FlexGridFilter);t.FlexSheetFilter=o}(t.sheet||(t.sheet={}))}(e.grid||(e.grid={}))}(wijmo||(wijmo={})),function(e){!function(t){!function(t){"use strict";var o=function(t){function o(e,o){var n=t.call(this,e)||this;return n._idx=-1,n._owner=o,n}return __extends(o,t),Object.defineProperty(o.prototype,"visible",{get:function(){return"none"!==this.hostElement.style.display},enumerable:!0,configurable:!0}),o.prototype.show=function(e,t){if(this._owner.selectedSheet){var o=(t?t.x:e.clientX)+(e?window.pageXOffset:0),n=(t?t.y:e.clientY)+(e?window.pageYOffset:0);this.hostElement.style.position="absolute",this.hostElement.style.display="inline",n+this.hostElement.clientHeight>window.innerHeight+(e?window.pageYOffset:0)&&(n-=this.hostElement.clientHeight),o+this.hostElement.clientWidth>window.innerWidth+(e?window.pageXOffset:0)&&(o-=this.hostElement.clientWidth),this.hostElement.style.top=n+"px",this.hostElement.style.left=o+"px"}},o.prototype.hide=function(){this._idx=-1;var e=this.hostElement.querySelectorAll(".wj-context-menu-item");this._removeSelectedState(e),this.hostElement.style.display="none"},o.prototype.moveToNext=function(){var t=this.hostElement.querySelectorAll(".wj-context-menu-item");for(this._removeSelectedState(t),this._idx++;t[this._idx]&&("none"===t[this._idx].style.display||e.hasClass(t[this._idx],"wj-state-disabled"));)this._idx++;this._idx>=t.length&&(this._idx=0),e.addClass(t[this._idx],"wj-context-menu-item-selected")},o.prototype.moveToPrev=function(){var t=this.hostElement.querySelectorAll(".wj-context-menu-item");for(this._removeSelectedState(t),this._idx--,this._idx<0&&(this._idx=t.length-1);this._idx>0&&("none"===t[this._idx].style.display||e.hasClass(t[this._idx],"wj-state-disabled"));)this._idx--;e.addClass(t[this._idx],"wj-context-menu-item-selected")},o.prototype.moveToFirst=function(){var t=this.hostElement.querySelectorAll(".wj-context-menu-item");this._removeSelectedState(t),this._idx=0,e.addClass(t[this._idx],"wj-context-menu-item-selected")},o.prototype.moveToLast=function(){var t=this.hostElement.querySelectorAll(".wj-context-menu-item");this._removeSelectedState(t),this._idx=t.length-1,t[this._idx]&&"none"===t[this._idx].style.display&&this._idx--,e.addClass(t[this._idx],"wj-context-menu-item-selected")},o.prototype.handleContextMenu=function(){if(-1===this._idx)this.moveToNext();else{var e=this.hostElement.querySelectorAll(".wj-context-menu-item");this._handleMenuItemOperation(e),this.hide(),this._owner.hostElement.focus()}},o.prototype._init=function(){var e=this,t=e.hostElement.querySelectorAll(".wj-context-menu-item");e.hostElement.style.zIndex="9999",document.body.appendChild(e.hostElement),e.addEventListener(document.body,"mousemove",function(){e._removeSelectedState(t)}),e.addEventListener(e.hostElement,"contextmenu",function(e){e.preventDefault()})},o.prototype._handleMenuItemOperation=function(e){},o.prototype._removeSelectedState=function(t){for(var o=0;o<t.length;o++)e.removeClass(t[o],"wj-context-menu-item-selected")},o}(e.Control);t._ContextMenu=o;var n=function(o){function n(e,t){var n=o.call(this,e,t)||this;return n._isDisableDelRow=!1,n._isDisableConvertTable=!1,n.applyTemplate("",n.getTemplate(),{_insRows:"insert-rows",_delRows:"delete-rows",_insCols:"insert-columns",_delCols:"delete-columns",_splitter:"splitter",_convertTable:"convert-table"}),n._init(),n}return __extends(n,o),n.prototype.show=function(t,n){this._owner.selectedSheet&&(this._owner._isDisableDeleteRow(this._owner.selection.topRow,this._owner.selection.bottomRow)&&(this._isDisableDelRow=!0,e.addClass(this._delRows,"wj-state-disabled")),this._showTableOperation(),this._owner.selection.isValid||(this._isDisableConvertTable=!0,e.addClass(this._convertTable,"wj-state-disabled")),o.prototype.show.call(this,t,n))},n.prototype.hide=function(){o.prototype.hide.call(this),this._isDisableDelRow=!1,this._isDisableConvertTable=!1,e.removeClass(this._delRows,"wj-state-disabled"),e.removeClass(this._convertTable,"wj-state-disabled")},n.prototype._init=function(){var t=e.culture.FlexSheet,n=this;n._insRows.textContent=t.insertRow,n._delRows.textContent=t.deleteRow,n._insCols.textContent=t.insertCol,n._delCols.textContent=t.deleteCol,n._convertTable.textContent=t.convertTable,o.prototype._init.call(this),n.addEventListener(n._insRows,"click",function(e){n._owner.insertRows(),n.hide(),n._owner.hostElement.focus()}),n.addEventListener(n._delRows,"click",function(e){n._isDisableDelRow||n._owner.deleteRows(),n.hide(),n._owner.hostElement.focus()}),n.addEventListener(n._insCols,"click",function(e){n._owner.insertColumns(),n.hide(),n._owner.hostElement.focus()}),n.addEventListener(n._delCols,"click",function(e){n._owner.deleteColumns(),n.hide(),n._owner.hostElement.focus()}),n.addEventListener(n._convertTable,"click",function(e){n._isDisableConvertTable||n._addTable(),n.hide(),n._owner.hostElement.focus()})},n.prototype._handleMenuItemOperation=function(e){switch(e[this._idx]){case this._insCols:this._owner.insertColumns();break;case this._insRows:this._owner.insertRows();break;case this._delCols:this._owner.deleteColumns();break;case this._delRows:this._isDisableDelRow||this._owner.deleteRows();break;case this._convertTable:this._addTable()}},n.prototype._showTableOperation=function(){var e,t,o=this._owner.selection;for(e=o.topRow;e<=o.bottomRow;e++)for(t=o.leftCol;t<=o.rightCol;t++)if(null!=this._owner.selectedSheet.findTable(e,t))return this._convertTable.style.display="none",void(this._splitter.style.display="none");o.isSingleCell||this._owner._containsMergedCells(o)?(this._convertTable.style.display="none",this._splitter.style.display="none"):(this._convertTable.style.display="",this._splitter.style.display="")},n.prototype._addTable=function(){var e,o;if(e=this._owner.selectedSheet._addTable(this._owner.selection)){if(0===this._owner.undoStack.stackSize)return;o=new t._TableAction(this._owner,e),this._owner.undoStack._addAction(o)}},n.controlTemplate='<div class="wj-context-menu wj-control wj-flexsheet-context-menu" width="150px"><div class="wj-context-menu-item" wj-part="insert-rows"></div><div class="wj-context-menu-item" wj-part="delete-rows"></div><div class="wj-context-menu-item" wj-part="insert-columns"></div><div class="wj-context-menu-item" wj-part="delete-columns"></div><div class="wj-state-disabled" wj-part="splitter" style="width:100%;height:1px;background-color:lightgray;"></div><div class="wj-context-menu-item" wj-part="convert-table"></div></div>',n}(o);t._SheetContextMenu=n;var i=function(t){function o(e,o){var n=t.call(this,e,o)||this;return n.applyTemplate("",n.getTemplate(),{_insSheet:"insert-sheet",_delSheet:"delete-sheet",_renameSheet:"rename-sheet"}),n._init(),n}return __extends(o,t),o.prototype._init=function(){var o=e.culture.FlexSheet,n=this;n._insSheet.textContent=o.insertSheet,n._delSheet.textContent=o.deleteSheet,n._renameSheet.textContent=o.renameSheet,t.prototype._init.call(this),n.addEventListener(n._insSheet,"click",function(e){n._owner.addUnboundSheet(null,null,null,n._owner.selectedSheetIndex),n.hide(),n._owner.hostElement.focus()}),n.addEventListener(n._delSheet,"click",function(e){n._owner.sheets.removeAt(n._owner.selectedSheetIndex),n.hide(),n._owner.hostElement.focus()}),n.addEventListener(n._renameSheet,"click",function(e){n._owner._tabHolder.sheetControl._startEditingSheetName(n._owner.selectedSheetIndex),n.hide()})},o.prototype._handleMenuItemOperation=function(e){switch(e[this._idx]){case this._insSheet:this._owner.addUnboundSheet(null,null,null,this._owner.selectedSheetIndex);break;case this._delSheet:this._owner.sheets.removeAt(this._owner.selectedSheetIndex);break;case this._renameSheet:this._owner._tabHolder.sheetControl._startEditingSheetName(this._owner.selectedSheetIndex)}},o.controlTemplate='<div class="wj-context-menu wj-control wj-flexsheet-context-menu" width="150px"><div class="wj-context-menu-item" wj-part="insert-sheet"></div><div class="wj-context-menu-item" wj-part="delete-sheet"></div><div class="wj-context-menu-item" wj-part="rename-sheet"></div><div>',o}(o);t._SheetTabContextMenu=i}(t.sheet||(t.sheet={}))}(e.grid||(e.grid={}))}(wijmo||(wijmo={})),function(e){var t;(function(t){"use strict";var o=function(){function o(o,n,i,s,r){this._visible=!0,this._unboundSortDesc=new e.collections.ObservableArray,this._currentStyledCells={},this._currentMergedRanges=[],this._isEmptyGrid=!1,this._rowSettings=[],this._scrollPosition=new e.Point,this._showDefaultHeader=!1,this._ownerHeaderRowRemoved=!1,this.nameChanged=new e.Event,this.visibleChanged=new e.Event;var a=this;a._owner=o,a._name=i,a._sortList=[new t.ColumnSortDescription(-1,!0)],e.isNumber(s)&&!isNaN(s)&&s>=0?a._rowCount=s:a._rowCount=200,e.isNumber(r)&&!isNaN(r)&&r>=0?a._columnCount=r:a._columnCount=20,n?(a._showDefaultHeader=!0,a._grid=n,a._addHeaderRow(!0)):a._grid=this._createGrid(),a._grid.loadedRows.addHandler(function(){a._addHeaderRow(),a._setRowSettings()}),a._grid.itemsSourceChanged.addHandler(this._gridItemsSourceChanged,this),a._unboundSortDesc.collectionChanged.addHandler(function(){var t,o,n=a._unboundSortDesc,i={};for(t=0;t<n.length;t++)if(!e.tryCast(n[t],l))throw"sortDescriptions array must contain SortDescription objects.";if(a._owner){if(a._owner.rows.beginUpdate(),a._owner.rows.sort(a._compareRows()),!a._owner._isUndoing){for(t=0;t<a._owner.rows.length;t++)t!==(o=a._owner.rows[t])._idx&&a._owner._updateFormulaForReorderingRows(o._idx,t),a._owner._updateCellStyleForReorderingRows(o._idx,t,i);a._currentStyledCells=i}a._owner.rows.endUpdate(),a._owner.rows._dirty=!0,a._owner.rows._update(),a._owner.selectedSheet&&(a._owner._copyTo(a._owner.selectedSheet),a._owner._copyFrom(a._owner.selectedSheet))}}),a.tables.collectionChanged.addHandler(function(o,n){if(null!=n.item&&!(n.item instanceof t.Table))throw"The tables only allows to handle Table instance.";if(a._owner)if(n.action===e.collections.NotifyCollectionChangedAction.Add||n.action===e.collections.NotifyCollectionChangedAction.Change){if(n.item){var i=void 0,l=void 0,s=n.item,r=s.getRange(),h=a===a._owner.selectedSheet?a._owner:a.grid;try{if(r.topRow>=h.rows.length||r.leftCol>=h.columns.length)throw"";if(r.leftCol+r.columnSpan>h.columns.length)throw"";if(r.topRow+r.rowSpan>h.rows.length)throw"";for(i=r.topRow;i<=r.bottomRow;i++)for(l=r.leftCol;l<=r.rightCol;l++)if(a.findTable(i,l)!==s)throw"";s._attachSheet(a)}catch(e){a.tables.removeAt(n.index)}}}else n.action===e.collections.NotifyCollectionChangedAction.Remove&&n.item&&n.item._detachSheet()})}return Object.defineProperty(o.prototype,"grid",{get:function(){return null==this._grid.wj_sheetInfo&&(this._grid.wj_sheetInfo={}),this._grid},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"name",{get:function(){return this._name},set:function(t){if(!e.isNullOrWhiteSpace(t)&&(this._name&&this._name.toLowerCase()!==t.toLowerCase()||!this._name)){var o=new e.PropertyChangedEventArgs("sheetName",this._name,t);this._name=t,this.grid.wj_sheetInfo.name=t,this.onNameChanged(o)}},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"visible",{get:function(){return this._visible},set:function(t){this._visible!==t&&(this._visible=t,this.grid.wj_sheetInfo.visible=t,this.onVisibleChanged(new e.EventArgs))},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"rowCount",{get:function(){return null!=this._grid?this._grid.rows.length:0},set:function(t){var o;if(!this.itemsSource&&e.isNumber(t)&&!isNaN(t)&&t>=0&&this._rowCount!==t){if(this._rowCount<t)for(o=0;o<t-this._rowCount;o++)this.grid.rows.push(new e.grid.Row);else this.grid.rows.splice(t,this._rowCount-t);this._rowCount=t,this._owner&&this._owner.selectedSheet&&this._name===this._owner.selectedSheet.name&&this._owner._copyFrom(this,!0)}},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"columnCount",{get:function(){return null!=this._grid?this._grid.columns.length:0},set:function(t){var o;if(!this.itemsSource&&e.isNumber(t)&&!isNaN(t)&&t>=0&&this._columnCount!==t){if(this._columnCount<t)for(o=0;o<t-this._columnCount;o++)this._grid.columns.push(new e.grid.Column);else this._grid.columns.splice(t,this._columnCount-t);this._columnCount=t,this._owner&&this._owner.selectedSheet&&this._name===this._owner.selectedSheet.name&&this._owner._copyFrom(this,!0)}},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"selectionRanges",{get:function(){var t=this;return this._selectionRanges||(this._selectionRanges=new e.collections.ObservableArray,this._selectionRanges.collectionChanged.addHandler(function(){var o,n;t._owner&&!t._owner._isClicking&&((o=t._selectionRanges.length)>0&&(n=t._selectionRanges[o-1])&&n instanceof e.grid.CellRange&&(t._owner.selection=n),o>1&&(t._owner._enableMulSel=!0,t._owner.refresh(!1)),t._owner._enableMulSel=!1)},this)),this._selectionRanges},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"itemsSource",{get:function(){return null!=this._grid?this._grid.itemsSource:null},set:function(e){null==this._grid&&(this._createGrid(),this._grid.itemsSourceChanged.addHandler(this._gridItemsSourceChanged,this)),this._owner&&this._owner._isCopying||(this._dataView=null),this._isEmptyGrid&&this._clearGrid(),this._grid.itemsSource=e},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"filterSetting",{get:function(){return this._owner&&this===this._owner.selectedSheet&&this._getFilterSetting(),this._filterSetting},set:function(e){this._filterSetting=e,this._owner&&this===this._owner.selectedSheet&&this._applyFilterSetting()},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"tables",{get:function(){return null==this._tables&&(this._tables=new e.collections.ObservableArray),this._tables},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"_styledCells",{get:function(){return this._currentStyledCells||(this._currentStyledCells={}),this._currentStyledCells},set:function(e){this._currentStyledCells=e},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"_mergedRanges",{get:function(){return this._currentMergedRanges||(this._currentMergedRanges=[]),this._currentMergedRanges},enumerable:!0,configurable:!0}),o.prototype.onNameChanged=function(e){this.nameChanged.raise(this,e)},o.prototype.onVisibleChanged=function(e){this.visibleChanged.raise(this,e)},o.prototype.dispose=function(){if(this._clearGrid(),this._grid.wj_sheetInfo=null,this._grid.dispose(),this._grid=null,null!=this._tables){for(var e=0;e<this._tables.length;e++)this._tables[e]=null;this._tables=null}},o.prototype.getCellStyle=function(e,t){var o,n=this._grid.rows.length,i=this._grid.columns.length;return e>=n||t>=i?null:(o=e*i+t,this._styledCells[o])},o.prototype.addTableFromArray=function(o,n,i,l,s,r,a,h){void 0===h&&(h=!0);var d,c,u,_,g,f,p,w,m,C,b,S,y=!1;if(this._owner){if(b=this===this._owner.selectedSheet?this._owner:this.grid,null==i||0===i.length)throw"Invalid array to load.";if(!(null!=l&&0!==l.length||null!=(l=Object.keys(i[0]))&&0!==l.length))throw"Invalid array to load.";if(o>=this.rowCount||n>=this.columnCount)return null;var R=null==(a&&a.showHeaderRow)||a.showHeaderRow,v=!(!a||!a.showTotalRow),x=o+(R?1:0),T=x+i.length-1+(v?1:0);for(d=[],m=0;m<l.length;m++)C=l[m],c=new t.TableColumn(C),0===m?c._totalRowLabel="Total":m===l.length-1&&(c._totalRowFunction="Sum"),d.push(c);if(u=new e.grid.CellRange(o,n,T,n+l.length-1),0!==(_=this._needShiftForTable(u))){if(!h)return null;if(!this._canShiftCells(u))return null;if(g=this._needAddRowCountForAddTable(_,u),b.collectionView){for(S=b.itemsSource instanceof e.collections.CollectionView,b.collectionView.beginUpdate(),p=0;p<g;p++)S?b.itemsSource.sourceCollection.push({}):b.itemsSource.push({});b.collectionView.endUpdate()}else for(p=0;p<g;p++)b.rows.push(new e.grid.Row);y=!0}if(n+l.length>=b.columns.length){if(!h)return null;if(f=n+l.length-b.columns.length+1,this.itemsSource&&f>0)return null;for(b.columns.beginUpdate(),p=0;p<f;p++)b.columns.push(new e.grid.Column);b.columns.endUpdate()}if(b.beginUpdate(),y&&this._moveDownCells(_,u),R)for(m=0;m<l.length;m++)C=l[m],b.setCellData(o,n+m,C);for(w=0;w<i.length;w++)for(m=0;m<l.length;m++)C=l[m],b.setCellData(x+w,n+m,i[w][C]);return b.endUpdate(),this._addTable(u,s,r,d,a)}},o.prototype.findTable=function(e,t){var o,n;if(this._tables&&this._tables.length>0)for(var i=0;i<this._tables.length;i++)if(e>=(n=(o=this._tables[i]).getRange()).topRow&&e<=n.bottomRow&&t>=n.leftCol&&t<=n.rightCol)return o;return null},o.prototype._attachOwner=function(e){this._owner!==e&&(this._owner=e)},o.prototype._setValidName=function(e){this._name=e,this.grid.wj_sheetInfo.name=e},o.prototype._storeRowSettings=function(){var t,o=0;if(this._owner)for(this._rowSettings=[];o<this._grid.rows.length;o++)(t=this._owner.rows[o])&&(this._rowSettings[o]={height:t.height,allowMerging:t.allowMerging,isCollapsed:t instanceof e.grid.GroupRow?t.isCollapsed:null,visible:t.visible,isSelected:t.isSelected,readOnly:t.isReadOnly})},o.prototype._setRowSettings=function(){for(var o,n,i,l=0;l<this._rowSettings.length;l++)(n=this._rowSettings[l])&&(o=this._grid.rows[l])&&(i=o instanceof t.HeaderRow,o.height=n.height,o.allowMerging=n.allowMerging,o.visible=n.visible,o instanceof e.grid.GroupRow&&(o.isCollapsed=!!n.isCollapsed),o.isSelected=!!n.isSelected,o.isReadOnly=i||!!n.readOnly)},o.prototype._addTable=function(e,o,n,i,l){return e.isValid&&this._owner?(null!=o&&null==this._owner._getTable(o)||(o=this._getUniqueTableName()),s=new t.Table(o,e,n,i,l),this.tables.push(s),s):null;var s},o.prototype._addSelection=function(e){var t,o;for(this.selectionRanges.beginUpdate(),o=this.selectionRanges.length-1;o>=0;o--)t=this.selectionRanges[o],e.contains(t)&&this.selectionRanges.removeAt(o);e.isValid&&this.selectionRanges.push(e),this.selectionRanges.endUpdate()},o.prototype._compareRows=function(){var t=this,o=this._unboundSortDesc;return function(n,i){for(var l=0;l<o.length;l++){var s=o[l],r=n._ubv&&s.column?n._ubv[s.column._hash]:"",a=i._ubv&&s.column?i._ubv[s.column._hash]:"";if(e.isString(r)&&"="===r[0]&&(r=t._owner.evaluate(r)),e.isString(a)&&"="===a[0]&&(a=t._owner.evaluate(a)),r!=r&&(r=null),a!=a&&(a=null),e.isString(r)&&(r=r.toLowerCase()+r),e.isString(a)&&(a=a.toLowerCase()+a),""===r||null==r)return 1;if(""===a||null==a)return-1;var h=r<a?-1:r>a?1:0;if(e.isString(r)&&e.isNumber(a)&&(h=1),e.isString(a)&&e.isNumber(r)&&(h=-1),0!==h)return s.ascending?+h:-h}return 0}},o.prototype._createGrid=function(){var t,o,n,i,l=document.createElement("div");for(this._isEmptyGrid=!0,l.style.visibility="hidden",document.body.appendChild(l),t=new e.grid.FlexGrid(l),document.body.removeChild(l),i=0;i<this._rowCount;i++)t.rows.push(new e.grid.Row);for(n=0;n<this._columnCount;n++)(o=new e.grid.Column).isRequired=!1,t.columns.push(o);return t.wj_sheetInfo={name:this.name,visible:this.visible,styledCells:this._styledCells,mergedRanges:this._mergedRanges},t},o.prototype._clearGrid=function(){this._grid.rows.clear(),this._grid.columns.clear(),this._grid.columnHeaders.columns.clear(),this._grid.rowHeaders.rows.clear()},o.prototype._gridItemsSourceChanged=function(){var e=this;e._owner&&!e._owner._isCopying&&e._owner.selectedSheet&&e._name===e._owner.selectedSheet.name&&(e._owner.filter.clear(),e._owner._copyFrom(e,!1),setTimeout(function(){e._owner._setFlexSheetToDirty(),e._owner.invalidate()},10))},o.prototype._addHeaderRow=function(o){if(void 0===o&&(o=!1),this._needAddHeaderRow()||o){var n,i;(n=new t.HeaderRow).isReadOnly=!0;for(var l=0;l<this._grid.columns.length;l++)i=this._grid.columns[l],n._ubv||(n._ubv={}),n._ubv[i._hash]=e.toHeaderCase(i.binding);this._grid.rows.insert(0,n)}},o.prototype._needAddHeaderRow=function(){var e=this._grid.allowAddNew&&this._grid.newRowAtTop?this._grid.rows[1]:this._grid.rows[0];return!(!this._grid.collectionView||this._grid.collectionView.isEmpty||e instanceof t.HeaderRow)&&(null==this._owner||(this._owner.allowAddNew&&this._owner.newRowAtTop?this._owner.rows[1]:this._owner.rows[0])instanceof t.HeaderRow)},o.prototype._getUniqueTableName=function(){for(var e="Table1",t=2;null!=this._owner._getTable(e);)e="Table"+t,t+=1;return e},o.prototype._needShiftForTable=function(e){var t,o,n,i=0,l=0,s=this===this._owner.selectedSheet?this._owner:this.grid;for(t=e.topRow;t<=e.bottomRow;t++){if(t>=s.rows.length)return i=e.rowSpan-l;for(o=e.leftCol;o<=e.rightCol&&o<s.columns.length;o++)if(null!=(n=s.getCellData(t,o,!1))&&""!==n)return i=e.rowSpan-l;l++}return i},o.prototype._needAddRowCountForAddTable=function(e,t){var o,n,i,l,s,r=this===this._owner.selectedSheet?this._owner:this.grid;for(o=1;o<=e;o++)for(n=r.rows.length-o,i=t.leftCol;i<=t.rightCol&&i<r.columns.length;i++)if(l=r.getCellData(n,i,!1),s=this.getCellStyle(n,i),null!=l&&""!==l||null!=s)return e-o+1;return 0},o.prototype._moveDownTable=function(e){var t,o,n,i,l=e.getRange(),s=this===this._owner.selectedSheet?this._owner:this.grid;for(t=l.bottomRow;t>=l.topRow;t--)for(o=l.leftCol;o<=l.rightCol;o++)i=null!=s.columns[o].dataMap,n=s.getCellData(t,o,i),s.setCellData(t+1,o,n),s.setCellData(t,o,"");e._updateTableRange(1,1,0,0)},o.prototype._moveDownCells=function(e,t){var o,n,i,l,s,r,a,h,d,c,u=this===this._owner.selectedSheet?this._owner:this.grid;for(o=u.rows.length-1-e;o>=t.topRow;o--)for(n=t.leftCol;n<=t.rightCol&&n<u.columns.length;n++)c=null!=u.columns[n].dataMap,i=u.getCellData(o,n,c),u.setCellData(o+e,n,i),u.setCellData(o,n,""),l=this.getCellStyle(o,n),r=(o+e)*u.columns.length+n,s=o*u.columns.length+n,l&&(this._styledCells[r]=l,this._styledCells[s]=null),(a=this._mergedRanges[s])&&(a.row+=e,a.row2+=e,this._mergedRanges[r]=a,this._mergedRanges[s]=null),(h=this.findTable(o,n))&&(d=h.getRange()).topRow===o&&d.leftCol===n&&h._updateTableRange(e,e,0,0)},o.prototype._moveUpCells=function(e,t){var o,n,i,l,s,r,a,h,d,c,u=this===this._owner.selectedSheet?this._owner:this.grid;for(o=t.topRow;o<u.rows.length;o++)for(n=t.leftCol;n<=t.rightCol&&n<u.columns.length;n++)c=null!=u.columns[n].dataMap,i=u.getCellData(o,n,c),u.setCellData(o-e,n,i),u.setCellData(o,n,""),l=this.getCellStyle(o,n),r=(o-e)*u.columns.length+n,s=o*u.columns.length+n,l&&(this._styledCells[r]=l,this._styledCells[s]=null),(a=this._mergedRanges[s])&&(a.row-=e,a.row2-=e,this._mergedRanges[r]=a,this._mergedRanges[s]=null),(h=this.findTable(o,n))&&(d=h.getRange()).topRow===o&&d.leftCol===n&&h._updateTableRange(-e,-e,0,0)},o.prototype._moveDownCellsWithinTable=function(e,t,o){var n,i,l,s,r=this===this._owner.selectedSheet?this._owner:this.grid;for(n=o.bottomRow;n>o.topRow+e;n--)for(i=o.leftCol;i<=o.rightCol;i++)s=null!=r.columns[i].dataMap,l=r.getCellData(n,i,s),r.setCellData(n+t,i,l),r.setCellData(n,i,""),r.columns.length,r.columns.length},o.prototype._moveUpCellsWithinTable=function(e,t,o){var n,i,l,s,r=o.topRow+e,a=this===this._owner.selectedSheet?this._owner:this.grid;for(n=r;n<=o.bottomRow;n++)for(i=o.leftCol;i<=o.rightCol;i++)n>=r+t&&(s=null!=a.columns[i].dataMap,l=a.getCellData(n,i,s),a.setCellData(n-t,i,l)),a.setCellData(n,i,""),a.columns.length,a.columns.length},o.prototype._canShiftCells=function(e){var t,o,n,i,l,s,r=this===this._owner.selectedSheet?this._owner:this.grid;for(t=e.topRow;t<r.rows.length;t++)for(o=e.leftCol;o<=e.rightCol&&o<r.columns.length;o++){if((l=this.findTable(t,o))&&((s=l.getRange()).leftCol<e.leftCol||s.rightCol>e.rightCol))return!1;if(n=t*r.columns.length+o,(i=this._mergedRanges[n])&&(i.leftCol<e.leftCol||i.rightCol>e.rightCol))return!1}return!0},o.prototype._needMoveDownTable=function(e){var t,o,n=e.getRange(),i=e.getColumns(),l=this===this._owner.selectedSheet?this._owner:this.grid;if(0===n.topRow)return!0;for(t=0;t<i.length;t++)if(null!=(o=l.getCellData(n.topRow-1,n.leftCol+t,!1))&&""!==o)return!0;return!1},o.prototype._needAddRowCountForInsertTableRows=function(e,t){var o,n,i,l,s,r=this===this._owner.selectedSheet?this._owner:this.grid;for(o=1;o<=e;o++){if((n=r.rows.length-o)<=t.bottomRow)return e;for(i=t.leftCol;i<=t.rightCol&&i<r.columns.length;i++)if(l=r.getCellData(n,i,!1),s=this.getCellStyle(n,i),null!=l&&""!==l||null!=s)return e-o+1}return 0},o.prototype._getFilterSetting=function(){var e,t=0;for(this._filterDefinition=this._owner.filter.filterDefinition,this._filterSetting={},this._filterSetting.filterColumns=this._owner.filter.filterColumns,this._filterSetting.columnFilterSettings||(this._filterSetting.columnFilterSettings=[]);t<this._owner.filter._filters.length;t++)(e=this._owner.filter._filters[t])&&this._filterSetting.columnFilterSettings.push({column:e.column,filterType:e.filterType,dataMap:e.dataMap,valueFilterSetting:{maxValues:e.valueFilter.maxValues,uniqueValues:e.valueFilter.uniqueValues,sortValues:e.valueFilter.sortValues,dataMap:e.valueFilter.dataMap,exclusiveValueSearch:e.valueFilter.exclusiveValueSearch},conditionFilterSetting:{dataMap:e.conditionFilter.dataMap}})},o.prototype._applyFilterSetting=function(){var e,t,o,n,i,l,s,r,a,h,d=0;if(null==this._filterSetting)this._clearFilterSetting();else if(this._owner.filter.filterColumns=this._filterSetting.filterColumns,this._filterDefinition&&(this._owner.filter.filterDefinition=this._filterDefinition),null!=(e=this._filterSetting.columnFilterSettings)&&e.length>0)for(;d<e.length;d++)(t=e[d])&&null!=t.column&&(i=this._owner.filter.getColumnFilter(t.column))&&(l=i.valueFilter.showValues,s=i.valueFilter.filterText,r={operator:i.conditionFilter.condition1.operator,value:i.conditionFilter.condition1.value},a={operator:i.conditionFilter.condition2.operator,value:i.conditionFilter.condition2.value},h=i.conditionFilter.and,null!=t.dataMap&&(i.dataMap=t.dataMap),null!=t.filterType&&(i.filterType=t.filterType),(o=t.valueFilterSetting)&&(o.dataMap&&(i.valueFilter.dataMap=o.dataMap),null!=o.maxValues&&(i.valueFilter.maxValues=o.maxValues),null!=o.sortValues&&(i.valueFilter.sortValues=o.sortValues),o.uniqueValues&&(i.valueFilter.uniqueValues=o.uniqueValues),i.valueFilter.exclusiveValueSearch=o.exclusiveValueSearch),(n=t.conditionFilterSetting)&&n.dataMap&&(i.conditionFilter.dataMap=n.dataMap),i.valueFilter.showValues=l,i.valueFilter.filterText=s,i.conditionFilter.condition1.operator=r.operator,i.conditionFilter.condition1.value=r.value,i.conditionFilter.condition2.operator=a.operator,i.conditionFilter.condition2.value=a.value,i.conditionFilter.and=h)},o.prototype._clearFilterSetting=function(){this._owner.filter._filters=[],this._owner.filter.filterColumns=null,this._filterDefinition&&(this._owner.filter.filterDefinition=this._filterDefinition)},o.prototype._cloneMergedCells=function(){for(var e,t=0,o=[];t<this._mergedRanges.length;t++)e=this._mergedRanges[t],o.push(e.clone());return o},o.prototype._getMergedRange=function(e,t){var o,n;for(o=0;o<this._mergedRanges.length;o++)if(e>=(n=this._mergedRanges[o]).topRow&&e<=n.bottomRow&&t>=n.leftCol&&t<=n.rightCol)return n;return null},o}();t.Sheet=o;var n=function(t){function o(){var o=null!==t&&t.apply(this,arguments)||this;return o._current=-1,o.sheetCleared=new e.Event,o.selectedSheetChanged=new e.Event,o.sheetNameChanged=new e.Event,o.sheetVisibleChanged=new e.Event,o}return __extends(o,t),o.prototype.onSheetCleared=function(){this.sheetCleared.raise(this,new e.EventArgs)},Object.defineProperty(o.prototype,"selectedIndex",{get:function(){return this._current},set:function(e){this._moveCurrentTo(+e)},enumerable:!0,configurable:!0}),o.prototype.onSelectedSheetChanged=function(e){this.selectedSheetChanged.raise(this,e)},o.prototype.insert=function(e,o){var n;(n=o.name?this.getValidSheetName(o):this._getUniqueName())!==o.name&&(o.name=n),t.prototype.insert.call(this,e,o),this._postprocessSheet(o)},o.prototype.push=function(){for(var e=[],o=0;o<arguments.length;o++)e[o]=arguments[o];this.length;for(var n,i=0;i<e.length;i++)(n=e[i].name?this.getValidSheetName(e[i]):this._getUniqueName())!==e[i].name&&(e[i].name=n),t.prototype.push.call(this,e[i]),this._postprocessSheet(e[i]);return this.length},o.prototype.splice=function(e,o,n){var i;return n?((i=n.name?this.getValidSheetName(n):this._getUniqueName())!==n.name&&(n.name=i),this._postprocessSheet(n),t.prototype.splice.call(this,e,o,n)):t.prototype.splice.call(this,e,o,n)},o.prototype.removeAt=function(e){this.hide(e)&&(t.prototype.removeAt.call(this,e),e<this.selectedIndex&&(this._current-=1))},o.prototype.onSheetNameChanged=function(e){this.sheetNameChanged.raise(this,e)},o.prototype.onSheetVisibleChanged=function(e){this.sheetVisibleChanged.raise(this,e)},o.prototype.selectFirst=function(){return this._moveCurrentTo(0)},o.prototype.selectLast=function(){return this._moveCurrentTo(this.length-1)},o.prototype.selectPrevious=function(){return this._moveCurrentTo(this._current-1)},o.prototype.selectNext=function(){return this._moveCurrentTo(this._current+1)},o.prototype.hide=function(e){return!(e<0&&e>=this.length||!this[e].visible||(this[e].visible=!1,0))},o.prototype.show=function(e){return!(e<0&&e>=this.length||(this[e].visible=!0,this._moveCurrentTo(e),0))},o.prototype.clear=function(){for(var e=0;e<this.length;e++)this[e].dispose();t.prototype.clear.call(this),this._current=-1,this.onSheetCleared()},o.prototype.isValidSheetName=function(e){var t=this._getSheetIndexFrom(e.name),o=this.indexOf(e);return-1===t||t===o},o.prototype.getValidSheetName=function(e){for(var t,o=e.name,n=1,i=this.indexOf(e);-1!==(t=this._getSheetIndexFrom(o))&&t!==i;)o=e.name.concat((n+1).toString()),n+=1;return o},o.prototype._moveCurrentTo=function(t){var o,n=t;if(t<0||t>=this.length)return!1;if(this._current<n||0===n)for(;n<this.length&&!this[n].visible;)n++;else if(this._current>n)for(;n>=0&&!this[n].visible;)n--;if(n===this.length)for(n=t;n>=0&&!this[n].visible;)n--;return!(n<0||(n!==this._current&&(o=new e.PropertyChangedEventArgs("sheetIndex",this._current,n),this._current=n,this.onSelectedSheetChanged(o)),0))},o.prototype._getSheetIndexFrom=function(e){var t;if(!e)return-1;e=e.toLowerCase();for(var o=0;o<this.length;o++)if(((t=this[o]).name?t.name.toLowerCase():"")===e)return o;return-1},o.prototype._postprocessSheet=function(t){var o=this;t.nameChanged.removeHandler(null),t.nameChanged.addHandler(function(){var n,i=o._getSheetIndexFrom(t.name);o.isValidSheetName(t)||t._setValidName(o.getValidSheetName(t)),n=new e.collections.NotifyCollectionChangedEventArgs(e.collections.NotifyCollectionChangedAction.Change,t,e.isNumber(i)?i:o.length-1),o.onSheetNameChanged(n)}),t.visibleChanged.removeHandler(null),t.visibleChanged.addHandler(function(){var n=o._getSheetIndexFrom(t.name),i=new e.collections.NotifyCollectionChangedEventArgs(e.collections.NotifyCollectionChangedAction.Change,t,e.isNumber(n)?n:o.length-1);o.onSheetVisibleChanged(i)})},o.prototype._getUniqueName=function(){for(var e="Sheet1",t=2;-1!==this._getSheetIndexFrom(e);)e="Sheet"+t,t+=1;return e},o}(e.collections.ObservableArray);t.SheetCollection=n;var i=function(o){function n(e,t,n){var i=o.call(this,e,n)||this;i._rtl=!1,i._sheetTabClicked=!1;var l=i;return l._owner=t,l._sheets=t.sheets,l._rtl="rtl"==getComputedStyle(l._owner.hostElement).direction,l._initControl(),l.deferUpdate(function(){n&&l.initialize(n)}),i}return __extends(n,o),n.prototype.refresh=function(e){this._tabContainer.innerHTML="",this._tabContainer.innerHTML=this._getSheetTabs(),this._rtl&&this._adjustSheetsPosition(),this._adjustSize()},n.prototype._sourceChanged=function(t,o){void 0===o&&(o=e.collections.NotifyCollectionChangedEventArgs.reset);var n=o;switch(n.action){case e.collections.NotifyCollectionChangedAction.Add:n.index,this._tabContainer.innerHTML="",this._tabContainer.innerHTML=this._getSheetTabs(),this._rtl&&this._adjustSheetsPosition(),this._adjustSize();break;case e.collections.NotifyCollectionChangedAction.Remove:this._tabContainer.removeChild(this._tabContainer.children[n.index]),this._tabContainer.hasChildNodes()&&this._updateTabActive(n.index,!0),this._adjustSize();break;default:this.invalidate()}},n.prototype._selectedSheetChanged=function(e,t){this._updateTabActive(t.oldValue,!1),this._updateTabActive(t.newValue,!0),this._sheetTabClicked?this._sheetTabClicked=!1:this._scrollToActiveSheet(t.newValue,t.oldValue),this._adjustSize()},n.prototype._initControl=function(){var e=this,o=e.hostElement;e.applyTemplate("",e.getTemplate(),{_sheetContainer:"sheet-container",_tabContainer:"container",_sheetPage:"sheet-page",_newSheet:"new-sheet",_contextMenuHost:"context-menu"}),e._contextMenu=new t._SheetTabContextMenu(e._contextMenuHost,e._owner),e._rtl&&(e._sheetPage.style.right="0px",e._tabContainer.parentElement.style.right=e._sheetPage.clientWidth+"px",e._tabContainer.style.right="0px",e._tabContainer.style.cssFloat="right",e._newSheet.style.right=e._sheetPage.clientWidth+e._tabContainer.parentElement.clientWidth+"px"),e._adjustNavigationButtons(e._rtl),e.addEventListener(o,"mousedown",function(){e._owner._mouseHdl._htDown=null}),e.addEventListener(o,"dragstart",function(t){t.target instanceof HTMLLIElement&&e._owner._isDescendant(e._tabContainer,t.target)?e._dragSrcIdx=e._getItemIndex(e._tabContainer,t.target):e._dragSrcIdx=-1}),e.addEventListener(o,"dragover",function(e){e.dataTransfer.dropEffect="move",e.preventDefault(),e.stopPropagation()}),e.addEventListener(o,"drop",function(t){var o,n,i;e._dragSrcIdx>-1&&(t.target instanceof HTMLLIElement&&e._owner._isDescendant(e._tabContainer,t.target)?o=e._getItemIndex(e._tabContainer,t.target):(i=e._tabContainer.getBoundingClientRect(),o=t.clientX<i.left?0:t.clientX>i.right?e._sheets.length-1:-1),o!==e._dragSrcIdx&&(n=e._sheets[e._dragSrcIdx],e._sheets._exchangingPosition=!0,e._sheets.beginUpdate(),e._sheets.splice(e._dragSrcIdx,1),e._sheets.splice(o,0,n),e._sheets.endUpdate(),e._owner.selectedSheetIndex=o,e._sheets._exchangingPosition=!1)),e._dragSrcIdx=-1,t.preventDefault(),t.stopPropagation()}),e.addEventListener(e._newSheet,"click",function(t){var o=e._owner.selectedSheetIndex;e._owner.addUnboundSheet(),e._scrollToActiveSheet(e._owner.selectedSheetIndex,o)}),e._sheets.collectionChanged.addHandler(e._sourceChanged,e),e._sheets.selectedSheetChanged.addHandler(e._selectedSheetChanged,e),e._sheets.sheetNameChanged.addHandler(e._updateSheetName,e),e._sheets.sheetVisibleChanged.addHandler(e._updateTabShown,e),e._initSheetPage(),e._initSheetTab()},n.prototype._initSheetTab=function(){var e=this;e.addEventListener(e._tabContainer,"mousedown",function(t){var o,n=t.target;n instanceof HTMLLIElement&&(e._sheetTabClicked=!0,o=e._getItemIndex(e._tabContainer,n),e._scrollSheetTabContainer(n),o>-1&&(e._sheets.selectedIndex=o))}),e.addEventListener(e._tabContainer,"dblclick",function(t){var o,n=t.target;n instanceof HTMLLIElement&&(o=e._getItemIndex(e._tabContainer,n),e._scrollSheetTabContainer(n),o>-1&&e._startEditingSheetName(o))}),e.addEventListener(e._tabContainer,"contextmenu",function(t){t.preventDefault(),e._contextMenu.show(t)})},n.prototype._initSheetPage=function(){var e=this;e.hostElement.querySelector("div.wj-sheet-page").addEventListener("click",function(t){var o="[object HTMLButtonElement]"===t.target.toString()?t.target:t.target.parentElement,n=e._getItemIndex(e._sheetPage,o);if(0!==e._sheets.length)switch(n){case 0:e._sheets.selectFirst();break;case 1:e._sheets.selectPrevious();break;case 2:e._sheets.selectNext();break;case 3:e._sheets.selectLast()}})},n.prototype._getSheetTabs=function(){var e,t="";for(e=0;e<this._sheets.length;e++)t+=this._getSheetElement(this._sheets[e],this._sheets.selectedIndex===e);return t},n.prototype._getSheetElement=function(e,t){void 0===t&&(t=!1);var o="<li";return e.visible?t&&(o+=' class="active"'):o+=' class="hidden"',o+=' draggable="true">'+e.name+"</li>"},n.prototype._updateTabActive=function(t,o){t<0||t>=this._tabContainer.children.length||(o?e.addClass(this._tabContainer.children[t],"active"):e.removeClass(this._tabContainer.children[t],"active"))},n.prototype._updateTabShown=function(t,o){o.index<0||o.index>=this._tabContainer.children.length||(o.item.visible?e.removeClass(this._tabContainer.children[o.index],"hidden"):e.addClass(this._tabContainer.children[o.index],"hidden"),this._adjustSize())},n.prototype._adjustSize=function(){var e,t,o,n=this._tabContainer.childElementCount,i=0;if("none"!==this.hostElement.style.display){for(o=this._tabContainer.parentElement.scrollLeft,this._tabContainer.parentElement.style.width="",this._tabContainer.style.width="",this._sheetPage.parentElement.style.width="",e=0;e<n;e++)i+=this._tabContainer.children[e].offsetWidth+1;t=this.hostElement.offsetWidth-this._sheetPage.offsetWidth-this._newSheet.offsetWidth-2,this._tabContainer.parentElement.style.width=(i>t?t:i)+"px",this._tabContainer.style.width=i+"px",this._sheetPage.parentElement.style.width=this._sheetPage.offsetWidth+this._newSheet.offsetWidth+this._tabContainer.parentElement.offsetWidth+3+"px",this._tabContainer.parentElement.scrollLeft=o}},n.prototype._getItemIndex=function(e,t){for(var o=0;o<e.children.length;o++)if(e.children[o]===t)return o;return-1},n.prototype._updateSheetName=function(e,t){this._tabContainer.querySelectorAll("li")[t.index].textContent=t.item.name,this._adjustSize()},n.prototype._scrollSheetTabContainer=function(t){var o,n=this._tabContainer.parentElement.scrollLeft,i=this._sheetPage.offsetWidth,l=this._newSheet.offsetWidth,s=this._tabContainer.parentElement.offsetWidth;if(this._rtl)switch(e.grid.FlexGrid._getRtlMode()){case"rev":(o=-this._tabContainer.offsetLeft)+t.offsetLeft+t.offsetWidth>s+n?this._tabContainer.parentElement.scrollLeft+=t.offsetWidth:o+t.offsetLeft<n&&(this._tabContainer.parentElement.scrollLeft-=t.offsetWidth);break;case"neg":t.offsetLeft<n?this._tabContainer.parentElement.scrollLeft-=t.offsetWidth:t.offsetLeft+t.offsetWidth>s+n&&(this._tabContainer.parentElement.scrollLeft+=t.offsetWidth);break;default:t.offsetLeft-l+n<0?this._tabContainer.parentElement.scrollLeft+=t.offsetWidth:t.offsetLeft+t.offsetWidth-l+n>s&&(this._tabContainer.parentElement.scrollLeft-=t.offsetWidth)}else t.offsetLeft+t.offsetWidth-i>s+n?this._tabContainer.parentElement.scrollLeft+=t.offsetWidth:t.offsetLeft-i<n&&(this._tabContainer.parentElement.scrollLeft-=t.offsetWidth)},n.prototype._adjustSheetsPosition=function(){var e,t,o=this._tabContainer.querySelectorAll("li"),n=0;for(t=0;t<o.length;t++)(e=o[t]).style.cssFloat="right",e.style.right=n+"px",n+=o[t].clientWidth},n.prototype._scrollToActiveSheet=function(t,o){var n,i,l,s=this._tabContainer.querySelectorAll("li");if(i=this._tabContainer.clientWidth>this._tabContainer.parentElement.clientWidth?this._tabContainer.clientWidth-this._tabContainer.parentElement.clientWidth:0,s.length>0&&t<s.length&&o<s.length){if(0===t&&!this._rtl||t===s.length-1&&this._rtl){if(this._rtl)switch(e.grid.FlexGrid._getRtlMode()){case"rev":this._tabContainer.parentElement.scrollLeft=0;break;case"neg":this._tabContainer.parentElement.scrollLeft=-i;break;default:this._tabContainer.parentElement.scrollLeft=i}else this._tabContainer.parentElement.scrollLeft=0;return}if(0===t&&this._rtl||t===s.length-1&&!this._rtl){if(this._rtl)switch(e.grid.FlexGrid._getRtlMode()){case"rev":this._tabContainer.parentElement.scrollLeft=i;break;case"neg":default:this._tabContainer.parentElement.scrollLeft=0}else this._tabContainer.parentElement.scrollLeft=i;return}if(t>=o)for(l=o+1;l<=t;l++)n=s[l],this._scrollSheetTabContainer(n);else for(l=o-1;l>=t;l--)n=s[l],this._scrollSheetTabContainer(n)}},n.prototype._adjustNavigationButtons=function(t){var o,n=this.hostElement.querySelectorAll(".wj-sheet-page button");n&&4===n.length&&(t?(o=n[0].querySelector("span"),e.removeClass(o,"wj-glyph-step-backward"),e.addClass(o,"wj-glyph-step-forward"),o=n[1].querySelector("span"),e.removeClass(o,"wj-glyph-left"),e.addClass(o,"wj-glyph-right"),o=n[2].querySelector("span"),e.removeClass(o,"wj-glyph-right"),e.addClass(o,"wj-glyph-left"),o=n[3].querySelector("span"),e.removeClass(o,"wj-glyph-step-forward"),e.addClass(o,"wj-glyph-step-backward")):(o=n[0].querySelector("span"),e.removeClass(o,"wj-glyph-step-forward"),e.addClass(o,"wj-glyph-step-backward"),o=n[1].querySelector("span"),e.removeClass(o,"wj-glyph-right"),e.addClass(o,"wj-glyph-left"),o=n[2].querySelector("span"),e.removeClass(o,"wj-glyph-left"),e.addClass(o,"wj-glyph-right"),o=n[3].querySelector("span"),e.removeClass(o,"wj-glyph-step-backward"),e.addClass(o,"wj-glyph-step-forward")))},n.prototype._startEditingSheetName=function(t){var o,n=this,i=n._tabContainer.children[t],l=i.textContent;n._editingSheetTab=i,n._measureEle=document.createElement("span"),n._measureEle.setAttribute(e.grid.FlexGrid._WJS_MEASURE,"true"),n._measureEle.style.visibility="hidden",n.hostElement.appendChild(n._measureEle),i.innerHTML='<input type="text" style="width: '+(i.offsetWidth-40)+'px;"/>',o=i.children[0],e.addClass(o,"wj-sheet-name-editor wj-form-control"),o.value=l,e.setSelectionRange(o,0,l.length),n.addEventListener(o,"keydown",function(t){t.keyCode===e.Key.Enter?n._commitSheetName():n._measureInputWidth(t.key)}),n.addEventListener(o,"blur",n._commitSheetName.bind(n))},n.prototype._commitSheetName=function(){var t,o,n;this._editingSheetTab&&(n=this._editingSheetTab.children[0],this.removeEventListener(n),t=n.value,o=this._getItemIndex(this._tabContainer,this._editingSheetTab),null!=t&&""!==t&&-1===this._sheets._getSheetIndexFrom(t)?(this._sheets[o].name=t,this._editingSheetTab.textContent=t):this._editingSheetTab.textContent=this._sheets[o].name,this._editingSheetTab=null,e.removeChild(this._measureEle),this._measureEle=null,this._adjustSize())},n.prototype._measureInputWidth=function(e){var t,o,n,i;!this._editingSheetTab||e.length>1||(o=(t=this._editingSheetTab.children[0]).selectionStart,n=t.selectionEnd,null!=(i=(i=t.value).substring(0,o)+e+i.substring(n))&&""!==i&&(this._measureEle.textContent=i,t.style.width=this._measureEle.offsetWidth+"px",this._adjustSize()))},n.controlTemplate='<div wj-part="sheet-container" class="wj-sheet" style="height:100%;position:relative"><div wj-part="sheet-page" class="wj-btn-group wj-sheet-page"><button type="button" class="wj-btn wj-btn-default"><span class="wj-sheet-icon wj-glyph-step-backward"></span></button><button type="button" class="wj-btn wj-btn-default"><span class="wj-sheet-icon wj-glyph-left"></span></button><button type="button" class="wj-btn wj-btn-default"><span class="wj-sheet-icon wj-glyph-right"></span></button><button type="button" class="wj-btn wj-btn-default"><span class="wj-sheet-icon wj-glyph-step-forward"></span></button></div><div class="wj-sheet-tab" style="height:100%;overflow:hidden"><ul wj-part="container"></ul></div><div wj-part="new-sheet" class="wj-new-sheet"><span class="wj-sheet-icon wj-glyph-file"></span></div><div wj-part="context-menu" style="display:none;z-index:100"></div></div>',n}(e.Control);t._SheetTabs=i;var l=function(){function e(e,t){this._column=e,this._ascending=t}return Object.defineProperty(e.prototype,"column",{get:function(){return this._column},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ascending",{get:function(){return this._ascending},enumerable:!0,configurable:!0}),e}();t._UnboundSortDescription=l})((t=e.grid||(e.grid={})).sheet||(t.sheet={}))}(wijmo||(wijmo={})),function(e){!function(t){!function(t){"use strict";var o=function(e){function o(t,o){var n=e.call(this,t)||this;return n._splitterMousedownHdl=n._splitterMousedownHandler.bind(n),n._owner=o,n.applyTemplate("",n.getTemplate(),{_divSheet:"left",_divSplitter:"splitter",_divRight:"right"}),n._init(),n}return __extends(o,e),Object.defineProperty(o.prototype,"sheetControl",{get:function(){return this._sheetControl},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"visible",{get:function(){return"none"!==this.hostElement.style.display},set:function(e){this.hostElement.style.display=e?"block":"none",this._divSheet.style.display=e?"block":"none"},enumerable:!0,configurable:!0}),o.prototype.getSheetBlanketSize=function(){return 20},o.prototype.adjustSize=function(){var e=this._owner.scrollSize.width-this._owner.clientSize.width,t=(this._owner.scrollSize.height,this._owner.clientSize.height,this._divSplitter.parentElement);e<=0?(t.style.minWidth="100px",this._divSplitter.style.display="none",this._divRight.style.display="none",this._divSheet.style.width="100%",this._divSplitter.removeEventListener("mousedown",this._splitterMousedownHdl,!0)):(t.style.minWidth="300px",this._divSplitter.style.display="none",this._divRight.style.display="none",this._divSheet.style.width="100%",this._divSplitter.removeEventListener("mousedown",this._splitterMousedownHdl,!0),this._divSplitter.addEventListener("mousedown",this._splitterMousedownHdl,!0)),this._sheetControl._adjustSize()},o.prototype._init=function(){var e=this;e._funSplitterMousedown=function(t){e._splitterMouseupHandler(t)},e._divSplitter.parentElement.style.height=e.getSheetBlanketSize()+"px",e._sheetControl=new t._SheetTabs(e._divSheet,this._owner)},o.prototype._splitterMousedownHandler=function(e){this._startPos=e.pageX,document.addEventListener("mousemove",this._splitterMousemoveHandler.bind(this),!0),document.addEventListener("mouseup",this._funSplitterMousedown,!0),e.preventDefault()},o.prototype._splitterMousemoveHandler=function(e){null!==this._startPos&&void 0!==this._startPos&&this._adjustDis(e.pageX-this._startPos)},o.prototype._splitterMouseupHandler=function(e){document.removeEventListener("mousemove",this._splitterMousemoveHandler,!0),document.removeEventListener("mouseup",this._funSplitterMousedown,!0),this._adjustDis(e.pageX-this._startPos),this._startPos=null},o.prototype._adjustDis=function(e){var t=this._divRight.offsetWidth-e,o=this._divSheet.offsetWidth+e;t<=100?(t=100,e=this._divRight.offsetWidth-t,o=this._divSheet.offsetWidth+e):o<=100&&(e=(o=100)-this._divSheet.offsetWidth,t=this._divRight.offsetWidth-e),0!=e&&(this._divRight.style.width=t+"px",this._divSheet.style.width=o+"px",this._startPos=this._startPos+e)},o.controlTemplate='<div><div wj-part="left" style ="float:left;height:100%;overflow:hidden"></div><div wj-part="splitter" style="float:left;height:100%;width:6px;background-color:#e9eaee;padding:2px;cursor:e-resize"><div style="background-color:#8a9eb2;height:100%"></div></div><div wj-part="right" style="float:left;height:100%;background-color:#e9eaee"></div></div>',o}(e.Control);t._TabHolder=o}(t.sheet||(t.sheet={}))}(e.grid||(e.grid={}))}(wijmo||(wijmo={})),function(e){!function(t){!function(t){"use strict";var o=function(){function o(e){e?e instanceof t._Token?this._token=e:this._token=new t._Token(e,t._TokenID.ATOM,t._TokenType.LITERAL):this._token=new t._Token(null,t._TokenID.ATOM,t._TokenType.IDENTIFIER)}return Object.defineProperty(o.prototype,"token",{get:function(){return this._token},enumerable:!0,configurable:!0}),o.prototype.evaluate=function(e,o,n){if(this._token.tokenType!==t._TokenType.LITERAL)throw"Bad expression.";return this._token.value},o.toString=function(t,o,n,i){var l=t.evaluate(o,n,i);return e.isPrimitive(l)||(l=l.value),null!=l?l.toString():""},o.toNumber=function(o,n,i,l){var s=o.evaluate(n,i,l);return e.isPrimitive(s)||(s=s.value),e.isNumber(s)?s:e.isBoolean(s)?s?1:0:e.isDate(s)?t.FlexSheet._toOADate(s):e.isString(s)?s?isNaN(+s)?this.isDateValue(s)?t.FlexSheet._toOADate(new Date(s)):e.changeType(s,e.DataType.Number,""):+s:0:e.changeType(s,e.DataType.Number,"")},o.toBoolean=function(t,o,n,i){var l=t.evaluate(o,n,i);return e.isPrimitive(l)||(l=l.value),e.isBoolean(l)?l:e.isNumber(l)?0!==l:e.changeType(l,e.DataType.Boolean,"")},o.toDate=function(o,n,i,l){var s=o.evaluate(n,i,l);return e.isPrimitive(s)||(s=s.value),e.isDate(s)?s:e.isNumber(s)?t.FlexSheet._fromOADate(s):e.changeType(s,e.DataType.Date,"")},o.isDateValue=function(t){var o,n=["January","February","March","April","May","June","July","August","September","October","November","December","Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];if(e.isPrimitive(t)||(t=t.value),!(o=e.isDate(t))&&e.isString(t))for(var i in n)if(t.indexOf(n[i])>-1){o=!0;break}return o},o.prototype._updateCellRangeExp=function(e,t,o,n,i,l){return!1},o.prototype._moveCellRangeExp=function(e,t,o,n,i){return void 0===n&&(n=!1),void 0===i&&(i=!1),!1},o.prototype._updateCellRangeExpForReorderingRows=function(e){return!1},o.prototype._updateCellBoundary=function(e,t){return!1},o.prototype._getStringExpression=function(){return null==this._token.value?"":e.isString(this._token.value)?'"'+this._token.value+'"':this._token.value.toString()},o}();t._Expression=o;var n=function(e){function n(t,o){var n=e.call(this,t)||this;return n._expr=o,n}return __extends(n,e),n.prototype.evaluate=function(e,n,i){if(this.token.tokenID===t._TokenID.SUB)return null==this._evaluatedValue&&(this._evaluatedValue=-o.toNumber(this._expr,e,n,i)),this._evaluatedValue;if(this.token.tokenID===t._TokenID.ADD)return null==this._evaluatedValue&&(this._evaluatedValue=+o.toNumber(this._expr,e,n,i)),this._evaluatedValue;throw"Bad expression."},n.prototype._updateCellRangeExp=function(e,t,o,n,i,l){return this._expr._updateCellRangeExp(e,t,o,n,i,l)},n.prototype._moveCellRangeExp=function(e,t,o,n,i){return void 0===n&&(n=!1),void 0===i&&(i=!1),this._expr._moveCellRangeExp(e,t,o,n,i)},n.prototype._updateCellRangeExpForReorderingRows=function(e){return this._expr._updateCellRangeExpForReorderingRows(e)},n.prototype._getStringExpression=function(){return this.token.tokenID===t._TokenID.SUB?(this._inGroup?"(":"")+"-"+this._expr._getStringExpression()+(this._inGroup?")":""):this.token.tokenID===t._TokenID.ADD?(this._inGroup?"(":"")+"+"+this._expr._getStringExpression()+(this._inGroup?")":""):""},n}(o);t._UnaryExpression=n;var i=function(n){function i(e,t,o){var i=n.call(this,e)||this;return i._leftExpr=t,i._rightExpr=o,i}return __extends(i,n),i.prototype.evaluate=function(n,i,l){var s,r,a,h,d,c,u,_,g,f;if(null!=this._evaluatedValue)return this._evaluatedValue;if(s=o.toString(this._leftExpr,n,i,l),r=o.toString(this._rightExpr,n,i,l),this.token.tokenType===t._TokenType.CONCAT)return this._evaluatedValue=s+r,this._evaluatedValue;if(a=this._leftExpr.evaluate(n,i,l),e.isPrimitive(a)||(d=a.format,a=a.value),h=this._rightExpr.evaluate(n,i,l),e.isPrimitive(h)||(c=h.format,h=h.value),(f=o.isDateValue(a)||o.isDateValue(h))?(u=e.isDate(a)?t.FlexSheet._toOADate(a):e.isNumber(a)?a:t.FlexSheet._toOADate(new Date(a)),_=e.isDate(h)?t.FlexSheet._toOADate(h):e.isNumber(h)?h:t.FlexSheet._toOADate(new Date(h))):(u=o.toNumber(this._leftExpr,n,i,l),_=o.toNumber(this._rightExpr,n,i,l)),g=u-_,this.token.tokenType===t._TokenType.COMPARE)switch(this.token.tokenID){case t._TokenID.GT:return g>0;case t._TokenID.LT:return g<0;case t._TokenID.GE:return g>=0;case t._TokenID.LE:return g<=0;case t._TokenID.EQ:return isNaN(g)?(this._evaluatedValue=s.toLowerCase()===r.toLowerCase(),this._evaluatedValue):(this._evaluatedValue=0===g,this._evaluatedValue);case t._TokenID.NE:return isNaN(g)?(this._evaluatedValue=s.toLowerCase()!==r.toLowerCase(),this._evaluatedValue):(this._evaluatedValue=0!==g,this._evaluatedValue)}switch(this.token.tokenID){case t._TokenID.ADD:this._evaluatedValue=u+_;break;case t._TokenID.SUB:this._evaluatedValue=u-_;break;case t._TokenID.MUL:this._evaluatedValue=u*_;break;case t._TokenID.DIV:this._evaluatedValue=u/_;break;case t._TokenID.DIVINT:this._evaluatedValue=Math.floor(u/_);break;case t._TokenID.MOD:this._evaluatedValue=Math.floor(u%_);break;case t._TokenID.POWER:0===_&&(this._evaluatedValue=1),.5===_&&(this._evaluatedValue=Math.sqrt(u)),1===_&&(this._evaluatedValue=u),2===_&&(this._evaluatedValue=u*u),3===_&&(this._evaluatedValue=u*u*u),4===_&&(this._evaluatedValue=u*u*u*u),this._evaluatedValue=Math.pow(u,_);break;default:this._evaluatedValue=NaN}if(!isNaN(this._evaluatedValue))return f&&(this._evaluatedValue={value:t.FlexSheet._fromOADate(this._evaluatedValue),format:d||c}),this._evaluatedValue;throw"Bad expression."},i.prototype._updateCellRangeExp=function(e,t,o,n,i,l){var s,r=!1;return s=this._leftExpr._updateCellRangeExp(e,t,o,n,i,l),r=r||s,s=this._rightExpr._updateCellRangeExp(e,t,o,n,i,l),r||s},i.prototype._moveCellRangeExp=function(e,t,o,n,i){void 0===n&&(n=!1),void 0===i&&(i=!1);var l,s=!1;return l=this._leftExpr._moveCellRangeExp(e,t,o,n,i),s=s||l,l=this._rightExpr._moveCellRangeExp(e,t,o,n,i),s||l},i.prototype._updateCellRangeExpForReorderingRows=function(e){var t,o=!1;return t=this._leftExpr._updateCellRangeExpForReorderingRows(e),o=o||t,t=this._rightExpr._updateCellRangeExpForReorderingRows(e),o||t},i.prototype._getStringExpression=function(){var e;switch(this.token.tokenID){case t._TokenID.GT:e=">";break;case t._TokenID.LT:e="<";break;case t._TokenID.GE:e=">=";break;case t._TokenID.LE:e="<=";break;case t._TokenID.EQ:e="=";break;case t._TokenID.NE:e="<>";break;case t._TokenID.ADD:e="+";break;case t._TokenID.SUB:e="-";break;case t._TokenID.MUL:e="*";break;case t._TokenID.DIV:e="/";break;case t._TokenID.DIVINT:e="\\";break;case t._TokenID.POWER:e="^";break;case t._TokenID.CONCAT:e="&";break;default:return""}return(this._inGroup?"(":"")+this._leftExpr._getStringExpression()+e+this._rightExpr._getStringExpression()+(this._inGroup?")":"")},i}(o);t._BinaryExpression=i;var l=function(t){function o(o,n,i,l,s,r,a,h,d){void 0===l&&(l=!0),void 0===s&&(s=!1),void 0===r&&(r=!1),void 0===a&&(a=!1),void 0===h&&(h=!1);var c=t.call(this)||this;return c._cells=new e.grid.CellRange(o.topRow,o.leftCol,o.bottomRow,o.rightCol),c._sheetRef=n,c._flex=i,c._evalutingRange={},c._isCellRange=l,c._absRow=s,c._absCol=r,c._absRow2=a,c._absCol2=h,c._isWholeRow=d,c}return __extends(o,t),o.prototype.evaluate=function(e,t,o){var n=this._cells.clone();return null==this._evaluatedValue&&(null!=this._isWholeRow&&(this._isWholeRow?(n.col=0,n.col2=o?o.grid.columns.length-1:this._flex.columns.length-1):(n.row=0,n.row2=o?o.grid.rows.length-1:this._flex.rows.length-1)),this._evaluatedValue=this._getCellValue(n,o,e,t)),this._evaluatedValue},o.prototype.getValues=function(t,o,n){void 0===t&&(t=!0);var i,l,s,r,a,h=[],d=0;if(!(n=this._getSheet()||n||this._flex.selectedSheet))return null;for(a=this._cells.clone(),null!=this._isWholeRow&&(this._isWholeRow?(a.col=0,a.col2=n.grid.columns.length-1):(a.row=0,a.row2=n.grid.rows.length-1)),s=null==o||isNaN(+o)?a.leftCol:o,r=null==o||isNaN(+o)?a.rightCol:o,l=a.topRow;l<=a.bottomRow&&l<n.grid.rows.length;l++)if(t||!1!==n.grid.rows[l].isVisible)for(o=s;o<=r&&o<n.grid.columns.length;o++)i=this._getCellValue(new e.grid.CellRange(l,o),n),e.isPrimitive(i)||(i=i.value),h[d]=i,d++;return h},o.prototype.getValuseWithTwoDimensions=function(t,o){void 0===t&&(t=!0);var n,i,l,s,r,a=[],h=0,d=0;if(!(o=this._getSheet()||o||this._flex.selectedSheet))return null;for(r=this._cells.clone(),null!=this._isWholeRow&&(this._isWholeRow?(r.col=0,r.col2=o.grid.columns.length-1):(r.row=0,r.row2=o.grid.rows.length-1)),l=r.topRow;l<=r.bottomRow&&l<o.grid.rows.length;l++)if(t||!1!==o.grid.rows[l].isVisible){for(i=[],d=0,s=r.leftCol;s<=r.rightCol&&s<o.grid.columns.length;s++)t||!1!==o.grid.columns[s].isVisible?(n=this._getCellValue(new e.grid.CellRange(l,s),o),e.isPrimitive(n)||(n=n.value),i[d]=n,d++):d++;a[h]=i,h++}else h++;return a},Object.defineProperty(o.prototype,"cells",{get:function(){return this._cells},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"sheetRef",{get:function(){return this._sheetRef},enumerable:!0,configurable:!0}),o.prototype._getCellValue=function(e,t,o,n){var i,l,s,r,a;if(!(t=this._getSheet()||t||this._flex.selectedSheet))return null;if(e.isSingleCell?(l=e.row,s=e.col):(null!=o&&o>=e.topRow&&o<=e.bottomRow&&e.col===e.col2&&(l=o,s=e.col),null!=n&&n>=e.leftCol&&n<=e.rightCol&&e.row===e.row2&&(l=e.row,s=n)),null==l||null==s)throw"Invalid Cell Reference.";if(i=t.name+":"+l+","+s+"-"+l+","+s,this._evalutingRange[i])throw"Circular Reference";try{if(this._flex)return this._evalutingRange[i]=!0,l<t.rowCount&&s<t.columnCount?(r=t.grid.columns[s],a=this._flex.getCellValue(l,s,!1,t),r.dataMap&&(a=r.dataMap.getDisplayValue(a)),a):0}finally{delete this._evalutingRange[i]}},o.prototype._getSheet=function(){var e,t=0;if(!this._sheetRef)return null;for(;t<this._flex.sheets.length;t++)if((e=this._flex.sheets[t]).name.toLowerCase()===this._sheetRef)return e;throw"Invalid sheet reference"},o.prototype._updateCellRangeExp=function(e,t,o,n,i,l){var s=this._cells,r=!1;if(this._tableParams&&this._tableParams.length>0)return!1;if(e===this._flex.selectedSheetIndex){if(this._sheetRef&&this._sheetRef.toLowerCase()!==this._flex.selectedSheet.name.toLowerCase())return!1}else if(!this._sheetRef||this._sheetRef.toLowerCase()!==this._flex.selectedSheet.name.toLowerCase())return!1;if(i){if(null==this._isWholeRow||this._isWholeRow){if(l&&(s.leftCol>l.rightCol||s.rightCol<l.leftCol))return!1;n?s.topRow>=t?(s.row+=o,s.row2+=o,r=!0):s.topRow<t&&s.bottomRow>=t&&(s.row2+=o,r=!0):s.topRow>t?(s.row-=o,s.row2-=o,r=!0):s.isSingleCell?s.row>=t-o+1&&(s.row=t-o+1,s.row2=t-o+1,r=!0):s.topRow>=t-o+1?(s.row=t-o+1,s.row2-=o,r=!0):s.topRow<t-o+1&&s.bottomRow>=t-o+1&&(s.bottomRow>t?s.row2-=o:s.row2=t-o,r=!0)}}else if(null==this._isWholeRow||!this._isWholeRow){if(l&&(s.topRow>l.bottomRow||s.bottomRow<l.topRow))return!1;n?s.leftCol>=t?(s.col+=o,s.col2+=o,r=!0):s.leftCol<t&&s.rightCol>=t&&(s.col2+=o,r=!0):s.leftCol>t?(s.col-=o,s.col2-=o,r=!0):s.isSingleCell?s.col>=t-o+1&&(s.col=t-o+1,s.col2=t-o+1,r=!0):s.leftCol>=t-o+1?(s.col=t-o+1,s.col2-=o,r=!0):s.leftCol<t-o+1&&s.rightCol>=t-o+1&&(s.rightCol>t?s.col2-=o:s.col2=t-o,r=!0)}return r},o.prototype._moveCellRangeExp=function(e,t,o,n,i){void 0===n&&(n=!1),void 0===i&&(i=!1);var l,s,r=this._cells,a=!1;return!(this._tableParams&&this._tableParams.length>0)&&(l=o.topRow-t.topRow,s=o.leftCol-t.leftCol,i?(0===l||null!=this._isWholeRow&&!this._isWholeRow||(r.row+=i&&this._absRow?0:l,r.row2+=this._isCellRange?i&&this._absRow2?0:l:i&&this._absRow?0:l,a=!0),0===s||null!=this._isWholeRow&&this._isWholeRow||(r.col+=i&&this._absCol?0:s,r.col2+=this._isCellRange?i&&this._absCol2?0:s:i&&this._absCol?0:s,a=!0),a):(t.contains(r)?(0===l||null!=this._isWholeRow&&!this._isWholeRow||(r.row+=l,r.row2+=l,a=!0),0===s||null!=this._isWholeRow&&this._isWholeRow||(r.col+=s,r.col2+=s,a=!0)):t.intersects(r)?(t.intersectsRow(r)&&(0===l||null!=this._isWholeRow&&!this._isWholeRow||(t.topRow<=r.topRow?l<0?(r.row+=l,a=!0):l>0&&n&&(t.topRow<r.topRow&&(r.row-=r.topRow-t.topRow),r.row2-=t.rowSpan,a=!0):t.bottomRow>=r.bottomRow?l>0?(r.row2+=l,a=!0):l<0&&n&&(t.bottomRow>r.bottomRow&&(r.row2+=t.bottomRow-r.bottomRow),r.row+=t.rowSpan,a=!0):n&&(l<0&&o.topRow<r.topRow&&(r.row+=t.rowSpan),l>0&&o.bottomRow>r.bottomRow&&(r.row2-=t.rowSpan),a=!0))),t.intersectsColumn(r)&&(0===s||null!=this._isWholeRow&&this._isWholeRow||(t.leftCol<=r.leftCol?s<0?(r.col+=s,a=!0):s>0&&n&&(t.leftCol<r.leftCol&&(r.col-=r.leftCol-t.leftCol),r.col2-=t.columnSpan,a=!0):t.rightCol>=r.rightCol?s>0?(r.col2+=s,a=!0):s<0&&n&&(t.rightCol>r.rightCol&&(r.col2+=t.rightCol-r.rightCol),r.col+=t.columnSpan,a=!0):n&&(s<0?r.col+=t.columnSpan:r.col2-=t.columnSpan,a=!0)))):n&&((null==this._isWholeRow||this._isWholeRow)&&(r.topRow>=o.topRow&&r.topRow<t.topRow&&l<0&&(r.row+=o.rowSpan,r.row2+=o.rowSpan,a=!0),r.topRow>t.bottomRow&&r.bottomRow<=o.bottomRow&&l>0&&(r.row-=o.rowSpan,r.row2-=o.rowSpan,a=!0)),null!=this._isWholeRow&&this._isWholeRow||(r.leftCol>=o.leftCol&&r.leftCol<t.leftCol&&s<0&&(r.col+=o.columnSpan,r.col2+=o.columnSpan,a=!0),r.leftCol>t.rightCol&&r.rightCol<=o.rightCol&&s>0&&(r.col-=o.columnSpan,r.col2-=o.columnSpan,a=!0))),a))},o.prototype._updateCellRangeExpForReorderingRows=function(e){var t,o=this._cells;return(null==this._isWholeRow||this._isWholeRow)&&((t=this._cells.row+e)<0?t=0:t>=this._flex.rows.length&&(t=this._flex.rows.length-1),o.row=t,this._isCellRange&&((t=this._cells.row2+e)<0?t=0:t>=this._flex.rows.length&&(t=this._flex.rows.length-1)),o.row2=t),!0},o.prototype._updateCellBoundary=function(e,t){var o=this._cells;return(!this._sheetRef||this._sheetRef.toLowerCase()===this._flex.selectedSheet.name.toLowerCase())&&(o.row===o.row2&&o.row===e&&t===o.col2+1?(o.col2+=1,!0):o.col===o.col2&&o.col===t&&e===o.row2+1&&(o.row2+=1,!0))},o.prototype._getStringExpression=function(){return this._tableParams&&this._tableParams.length>0?this._getTableParamsStringExpression():(this._sheetRef?this._sheetRef+"!":"")+e.xlsx.Workbook.xlsxAddress(this._cells.row,this._cells.col,this._absRow,this._absCol,this._isWholeRow)+(this._isCellRange?":"+e.xlsx.Workbook.xlsxAddress(this._cells.row2,this._cells.col2,this._absRow2,this._absCol2,this._isWholeRow):"")},o.prototype._getTableParamsStringExpression=function(){for(var e,t=0,o="",n=this._tableParams.length,i=!1;t<n;t++)"#"===(e=this._tableParams[t])[0]?(o+="["+e+"]",t<n-1&&(o+=", ")):i?o+=": ["+e+"]":(o+="["+e+"]",i=!0);return n>1&&(o="["+o+"]"),this._tableName&&(o=this._tableName+o),o},o}(o);t._CellRangeExpression=l;var s=function(e){function t(t,o,n,i){void 0===i&&(i=!0);var l=e.call(this)||this;return l._funcId=t,l._funcDefinition=o,l._params=n,l._needCacheEvaluatedVal=i,l}return __extends(t,e),t.prototype.evaluate=function(e,t,o){return this._needCacheEvaluatedVal?(null==this._evaluatedValue&&(this._evaluatedValue=this._funcDefinition.func(this._params,o,e,t)),this._evaluatedValue):this._funcDefinition.func(this._params,o,e,t)},t.prototype._updateCellRangeExp=function(e,t,o,n,i,l){var s,r,a=!1;if(this._params&&this._params.length>0)for(s=0;s<this._params.length;s++)r=this._params[s]._updateCellRangeExp(e,t,o,n,i,l),a||(a=a||r);return a},t.prototype._moveCellRangeExp=function(e,t,o,n,i){void 0===n&&(n=!1),void 0===i&&(i=!1);var l,s,r=!1;if(this._params&&this._params.length>0)for(l=0;l<this._params.length;l++)s=this._params[l]._moveCellRangeExp(e,t,o,n,i),r||(r=r||s);return r},t.prototype._updateCellRangeExpForReorderingRows=function(e){var t,o,n=!1;if(this._params&&this._params.length>0)for(t=0;t<this._params.length;t++)o=this._params[t]._updateCellRangeExpForReorderingRows(e),n||(n=n||o);return n},t.prototype._updateCellBoundary=function(e,t){var o;return!!(this._params&&1===this._params.length&&(o=this._params[0])instanceof l)&&o._updateCellBoundary(e,t)},t.prototype._getStringExpression=function(){return this._funcId+this._parseParamsExpToString()},t.prototype._parseParamsExpToString=function(){var e,t,o;if(this._params&&this._params.length>0){for(o="",e=0;e<this._params.length;e++)t=this._params[e],0===e&&(o+="("),o+=t._getStringExpression(),e<this._params.length-1?o+=", ":o+=")";return o}return"()"},t}(o);t._FunctionExpression=s}(t.sheet||(t.sheet={}))}(e.grid||(e.grid={}))}(wijmo||(wijmo={})),function(e){!function(t){!function(t){"use strict";var o=function(){function o(t){this._expressionCache={},this._idChars="$:!",this._functionTable={},this._cacheSize=0,this._tableRefStart=!1,this.unknownFunction=new e.Event,this._owner=t,this._buildSymbolTable(),this._registerAggregateFunction(),this._registerMathFunction(),this._registerLogicalFunction(),this._registerTextFunction(),this._registerDateFunction(),this._registLookUpReferenceFunction(),this._registFinacialFunction(),this._registAddressRelatedFunction()}return o.prototype.onUnknownFunction=function(e,o){var n,i;if(o&&o.length>0){n=[];for(var l=0;l<o.length;l++)n[l]=o[l].evaluate(this._rowIndex,this._columnIndex)}if(i=new t.UnknownFunctionEventArgs(e,n),this.unknownFunction.raise(this,i),null!=i.value)return new t._Expression(i.value);throw'The function "'+e+'" has not supported in FlexSheet yet.'},o.prototype.evaluate=function(o,n,i,l,s){var r;if(!this._owner.enableFormulas)return o;try{if(o&&o.length>1&&"="===o[0]){for(this._containsCellRef=!1,this._rowIndex=l,this._columnIndex=s,this._sheet=i||this._owner.selectedSheet,r=this._checkCache(o).evaluate(l,s,i);r instanceof t._Expression;)r=r.evaluate(l,s,i);return n&&e.isPrimitive(r)?e.Globalize.format(r,n):r}return o||""}catch(e){return"Error: "+e}},o.prototype.addCustomFunction=function(e,o,n,i){var l=this;e=e.toLowerCase(),this._functionTable[e]=new a(function(e){var n,i=[];if(e&&e.length>0)for(var s=0;s<e.length;s++)(n=e[s])instanceof t._CellRangeExpression?i[s]=n.cells:i[s]=n.evaluate(l._rowIndex,l._columnIndex);return o.apply(l,i)},i,n)},o.prototype.addFunction=function(e,o,n,i){var l=this;e=e.toLowerCase(),this._functionTable[e]=new a(function(e){var n,i=[];if(e&&e.length>0)for(var s=0;s<e.length;s++)(n=e[s])instanceof t._CellRangeExpression?i[s]=n.getValuseWithTwoDimensions():i[s]=[[n.evaluate(l._rowIndex,l._columnIndex)]];return o.apply(l,i)},i,n)},o.prototype._clearExpressionCache=function(){this._expressionCache=null,this._expressionCache={},this._cacheSize=0},o.prototype._parse=function(e){return this._expression=e,this._expressLength=e?e.length:0,this._pointer=0,this._expressLength>0&&"="===this._expression[0]&&this._pointer++,this._parseExpression()},o.prototype._buildSymbolTable=function(){this._tokenTable||(this._tokenTable={},this._addToken("+",l.ADD,i.ADDSUB),this._addToken("-",l.SUB,i.ADDSUB),this._addToken("(",l.OPEN,i.GROUP),this._addToken(")",l.CLOSE,i.GROUP),this._addToken("*",l.MUL,i.MULDIV),this._addToken(",",l.COMMA,i.GROUP),this._addToken(".",l.PERIOD,i.GROUP),this._addToken("/",l.DIV,i.MULDIV),this._addToken("\\",l.DIVINT,i.MULDIV),this._addToken("=",l.EQ,i.COMPARE),this._addToken(">",l.GT,i.COMPARE),this._addToken("<",l.LT,i.COMPARE),this._addToken("^",l.POWER,i.POWER),this._addToken("<>",l.NE,i.COMPARE),this._addToken(">=",l.GE,i.COMPARE),this._addToken("<=",l.LE,i.COMPARE),this._addToken("&",l.CONCAT,i.CONCAT),this._addToken("[",l.OPEN,i.SQUAREBRACKETS),this._addToken("]",l.CLOSE,i.SQUAREBRACKETS))},o.prototype._registerAggregateFunction=function(){var t=this;t._functionTable.sum=new a(function(o,n){return t._getAggregateResult(e.Aggregate.Sum,o,n)}),t._functionTable.average=new a(function(o,n){return t._getAggregateResult(e.Aggregate.Avg,o,n)}),t._functionTable.max=new a(function(o,n){return t._getAggregateResult(e.Aggregate.Max,o,n)}),t._functionTable.min=new a(function(o,n){return t._getAggregateResult(e.Aggregate.Min,o,n)}),t._functionTable.var=new a(function(o,n){return t._getAggregateResult(e.Aggregate.Var,o,n)}),t._functionTable.varp=new a(function(o,n){return t._getAggregateResult(e.Aggregate.VarPop,o,n)}),t._functionTable.stdev=new a(function(o,n){return t._getAggregateResult(e.Aggregate.Std,o,n)}),t._functionTable.stdevp=new a(function(o,n){return t._getAggregateResult(e.Aggregate.StdPop,o,n)}),t._functionTable.count=new a(function(e,o){return t._getFlexSheetAggregateResult(s.Count,e,o)}),t._functionTable.counta=new a(function(e,o){return t._getFlexSheetAggregateResult(s.CountA,e,o)}),t._functionTable.countblank=new a(function(e,o){return t._getFlexSheetAggregateResult(s.ConutBlank,e,o)}),t._functionTable.countif=new a(function(e,o){return t._getFlexSheetAggregateResult(s.CountIf,e,o)},2,2),t._functionTable.countifs=new a(function(e,o){return t._getFlexSheetAggregateResult(s.CountIfs,e,o)},254,2),t._functionTable.sumif=new a(function(e,o){return t._getFlexSheetAggregateResult(s.SumIf,e,o)},3,2),t._functionTable.sumifs=new a(function(e,o){return t._getFlexSheetAggregateResult(s.SumIfs,e,o)},255,2),t._functionTable.rank=new a(function(e,o){return t._getFlexSheetAggregateResult(s.Rank,e,o)},3,2),t._functionTable.product=new a(function(e,o){return t._getFlexSheetAggregateResult(s.Product,e,o)},255,1),t._functionTable.subtotal=new a(function(e,o){return t._handleSubtotal(e,o)},255,2),t._functionTable.dcount=new a(function(e,o){return t._handleDCount(e,o)},3,3),t._functionTable.sumproduct=new a(function(e,o){return t._getSumProduct(e,o)},255,1)},o.prototype._registerMathFunction=function(){var e=this;e._functionTable.pi=new a(function(){return Math.PI},0,0),e._functionTable.rand=new a(function(){return Math.random()},0,0),e._functionTable.power=new a(function(o,n){return Math.pow(t._Expression.toNumber(o[0],e._rowIndex,e._columnIndex,n),t._Expression.toNumber(o[1],e._rowIndex,e._columnIndex,n))},2,2),e._functionTable.atan2=new a(function(o,n){var i=t._Expression.toNumber(o[0],e._rowIndex,e._columnIndex,n),l=t._Expression.toNumber(o[1],e._rowIndex,e._columnIndex,n);if(0===i&&0===l)throw"The x number and y number can't both be zero for the atan2 function";return Math.atan2(l,i)},2,2),e._functionTable.mod=new a(function(o,n){var i=t._Expression.toNumber(o[0],e._rowIndex,e._columnIndex,n),l=t._Expression.toNumber(o[1],e._rowIndex,e._columnIndex,n),s=Math.abs(i)%Math.abs(l);return l<0&&(s=-s),s},2,2),e._functionTable.trunc=new a(function(o,n){var i,l,s,r=t._Expression.toNumber(o[0],e._rowIndex,e._columnIndex,n),a=2===o.length?t._Expression.toNumber(o[1],e._rowIndex,e._columnIndex,n):0;if(0===a?(s="n0",l=r>=0?Math.floor(r):Math.ceil(r)):(s="n"+((a=a>0?Math.floor(a):Math.ceil(a))>0?a:0),i=Math.pow(10,a),l=r>=0?Math.floor(r*i)/i:Math.ceil(r*i)/i),null!=l)return{value:l,format:s}},2,1),["ceiling","floor"].forEach(function(o){e._functionTable[o]=new a(function(n,i){var l,s,r=t._Expression.toNumber(n[0],e._rowIndex,e._columnIndex,i),a=2===n.length?t._Expression.toNumber(n[1],e._rowIndex,e._columnIndex,i):1;if(isNaN(r))throw"Invalid Number!";if(isNaN(a))throw"Invalid Significance!";if(r>0&&a<0)throw"The significance has to be positive, if the number is positive.";if(0===r||0===a)return 0;if(s=1,0!==(l=a-Math.floor(a)))for(;l<1;)s*=10,l*=10;return a*s*("ceiling"===o?Math.ceil(r/a):Math.floor(r/a))/s},2,1)}),["round","rounddown","roundup"].forEach(function(o){e._functionTable[o]=new a(function(n,i){var l,s,r,a,h=t._Expression.toNumber(n[0],e._rowIndex,e._columnIndex,i),d=t._Expression.toNumber(n[1],e._rowIndex,e._columnIndex,i);if(0===d){switch(o){case"rounddown":l=h>=0?Math.floor(h):Math.ceil(h);break;case"roundup":l=h>=0?Math.ceil(h):Math.floor(h);break;case"round":a=h>=0?0:.1,l=Math.round(h-a);break;default:l=Math.floor(h)}s="n0"}else{switch(d=d>0?Math.floor(d):Math.ceil(d),r=Math.pow(10,d),o){case"rounddown":l=h>=0?Math.floor(h*r)/r:Math.ceil(h*r)/r;break;case"roundup":l=h>=0?Math.ceil(h*r)/r:Math.floor(h*r)/r;break;case"round":a=h>=0?0:1*r/10,l=Math.round(h*r-a)/r}s="n"+(d>0?d:0)}if(null!=l)return{value:l,format:s}},2,2)}),["abs","acos","asin","atan","cos","exp","ln","sin","sqrt","tan"].forEach(function(o){e._functionTable[o]=new a(function(n,i){return"ln"===o?Math.log(t._Expression.toNumber(n[0],e._rowIndex,e._columnIndex,i)):Math[o](t._Expression.toNumber(n[0],e._rowIndex,e._columnIndex,i))},1,1)})},o.prototype._registerLogicalFunction=function(){var e=this;e._functionTable.and=new a(function(o,n){var i,l=!0;for(i=0;i<o.length&&(l=l&&t._Expression.toBoolean(o[i],e._rowIndex,e._columnIndex,n));i++);return l},Number.MAX_VALUE,1),e._functionTable.or=new a(function(o,n){var i,l=!1;for(i=0;i<o.length&&!(l=l||t._Expression.toBoolean(o[i],e._rowIndex,e._columnIndex,n));i++);return l},Number.MAX_VALUE,1),e._functionTable.not=new a(function(o,n){return!t._Expression.toBoolean(o[0],e._rowIndex,e._columnIndex,n)},1,1),e._functionTable.if=new a(function(o,n){return 3===o.length?t._Expression.toBoolean(o[0],e._rowIndex,e._columnIndex,n)?o[1].evaluate(e._rowIndex,e._columnIndex,n):o[2].evaluate(e._rowIndex,e._columnIndex,n):!!t._Expression.toBoolean(o[0],e._rowIndex,e._columnIndex,n)&&o[1].evaluate(e._rowIndex,e._columnIndex,n)},3,2),e._functionTable.true=new a(function(){return!0},0,0),e._functionTable.false=new a(function(){return!1},0,0)},o.prototype._registerTextFunction=function(){var o=this;o._functionTable.char=new a(function(e,n){var i,l="";for(i=0;i<e.length;i++)l+=String.fromCharCode(t._Expression.toNumber(e[i],o._rowIndex,o._columnIndex,n));return l},Number.MAX_VALUE,1),o._functionTable.code=new a(function(e,n){var i=t._Expression.toString(e[0],o._rowIndex,o._columnIndex,n);return i&&i.length>0?i.charCodeAt(0):-1},1,1),o._functionTable.concatenate=new a(function(e,n){var i,l="";for(i=0;i<e.length;i++)l=l.concat(t._Expression.toString(e[i],o._rowIndex,o._columnIndex,n));return l},Number.MAX_VALUE,1),o._functionTable.left=new a(function(e,n){var i=t._Expression.toString(e[0],o._rowIndex,o._columnIndex,n),l=null==e[1]?1:Math.floor(t._Expression.toNumber(e[1],o._rowIndex,o._columnIndex,n));return i&&i.length>0?i.slice(0,l):null},2,1),o._functionTable.right=new a(function(e,n){var i=t._Expression.toString(e[0],o._rowIndex,o._columnIndex,n),l=null==e[1]?1:Math.floor(t._Expression.toNumber(e[1],o._rowIndex,o._columnIndex,n));return i&&i.length>0?i.slice(-l):null},2,1),o._functionTable.find=new a(function(n,i){var l,s=t._Expression.toString(n[0],o._rowIndex,o._columnIndex,i),r=t._Expression.toString(n[1],o._rowIndex,o._columnIndex,i),a=null!=n[2]?e.asInt(t._Expression.toNumber(n[2],o._rowIndex,o._columnIndex,i)):0;return null!=r&&null!=s&&(l=!isNaN(a)&&a>0&&a<r.length?r.indexOf(s,a):r.indexOf(s))>-1?l+1:-1},3,2),o._functionTable.search=new a(function(n,i){var l,s,r,a=t._Expression.toString(n[0],o._rowIndex,o._columnIndex,i),h=t._Expression.toString(n[1],o._rowIndex,o._columnIndex,i),d=null!=n[2]?e.asInt(t._Expression.toNumber(n[2],o._rowIndex,o._columnIndex,i)):0;return null!=h&&null!=a&&(s=new RegExp(a,"i"),!isNaN(d)&&d>0&&d<h.length?(h=h.substring(d),l=d+1):l=1,(r=h.search(s))>-1)?r+l:-1},3,2),o._functionTable.len=new a(function(e,n){var i=t._Expression.toString(e[0],o._rowIndex,o._columnIndex,n);return i?i.length:-1},1,1),o._functionTable.mid=new a(function(e,n){var i=t._Expression.toString(e[0],o._rowIndex,o._columnIndex,n),l=Math.floor(t._Expression.toNumber(e[1],o._rowIndex,o._columnIndex,n)),s=Math.floor(t._Expression.toNumber(e[2],o._rowIndex,o._columnIndex,n));return i&&i.length>0&&l>0?i.substr(l-1,s):null},3,3),o._functionTable.lower=new a(function(e,n){var i=t._Expression.toString(e[0],o._rowIndex,o._columnIndex,n);return i&&i.length>0?i.toLowerCase():null},1,1),o._functionTable.upper=new a(function(e,n){var i=t._Expression.toString(e[0],o._rowIndex,o._columnIndex,n);return i&&i.length>0?i.toUpperCase():null},1,1),o._functionTable.proper=new a(function(e,n){var i=t._Expression.toString(e[0],o._rowIndex,o._columnIndex,n);return i&&i.length>0?i.replace(/\b[\w']+\b/g,function(e){return e&&e.length>0?e[0].toUpperCase()+e.substring(1).toLowerCase():e}):null},1,1),o._functionTable.trim=new a(function(e,n){var i=t._Expression.toString(e[0],o._rowIndex,o._columnIndex,n);return i&&i.length>0?i.trim():null},1,1),o._functionTable.replace=new a(function(e,n){var i=t._Expression.toString(e[0],o._rowIndex,o._columnIndex,n),l=Math.floor(t._Expression.toNumber(e[1],o._rowIndex,o._columnIndex,n)),s=Math.floor(t._Expression.toNumber(e[2],o._rowIndex,o._columnIndex,n)),r=t._Expression.toString(e[3],o._rowIndex,o._columnIndex,n);return i&&i.length>0&&l>0?i.substring(0,l-1)+r+i.slice(l-1+s):null},4,4),o._functionTable.substitute=new a(function(e,n){var i,l=t._Expression.toString(e[0],o._rowIndex,o._columnIndex,n),s=t._Expression.toString(e[1],o._rowIndex,o._columnIndex,n),r=t._Expression.toString(e[2],o._rowIndex,o._columnIndex,n),a=4===e.length?t._Expression.toNumber(e[3],o._rowIndex,o._columnIndex,n):null,h=0;if(null!=a&&a<1||isNaN(a))throw"Invalid instance number.";return l&&l.length>0&&s&&s.length>0?(i=new RegExp(s,"g"),l.replace(i,function(e){return h++,null!=a?(a=Math.floor(a),h===a?r:e):r})):null},4,3),o._functionTable.rept=new a(function(e,n){var i,l=t._Expression.toString(e[0],o._rowIndex,o._columnIndex,n),s=Math.floor(t._Expression.toNumber(e[1],o._rowIndex,o._columnIndex,n)),r="";if(l&&l.length>0&&s>0)for(i=0;i<s;i++)r=r.concat(l);return r},2,2),o._functionTable.text=new a(function(n,i){var l,s=n[0].evaluate(o._rowIndex,o._columnIndex,i),r=t._Expression.toString(n[1],o._rowIndex,o._columnIndex,i);if(!e.isPrimitive(s)&&s&&(s=s.value),e.isDate(s))r=r.replace(/\[\$\-.+\]/g,"").replace(/(\\)(.)/g,"$2").replace(/H+/g,function(e){return e.toLowerCase()}).replace(/m+/g,function(e){return e.toUpperCase()}).replace(/S+/g,function(e){return e.toLowerCase()}).replace(/AM\/PM/gi,"tt").replace(/A\/P/gi,"t").replace(/\.000/g,".fff").replace(/\.00/g,".ff").replace(/\.0/g,".f").replace(/\\[\-\s,]/g,function(e){return e.substring(1)}).replace(/Y+/g,function(e){return e.toLowerCase()}).replace(/D+/g,function(e){return e.toLowerCase()}).replace(/M+:?|:?M+/gi,function(e){return e.indexOf(":")>-1?e.toLowerCase():e}).replace(/g+e/gi,function(e){return e.substring(0,e.length-1)+"yy"});else{if(!e.isNumber(s))return s;if((l=r.match(/^(\d+)(\.\d+)?\E\+(\d+)(\.\d+)?$/))&&5===l.length)return o._parseToScientificValue(s,l[1],l[2],l[3],l[4]);/M{1,4}|d{1,4}|y{1,4}/.test(r)?s=new Date(1900,0,s-1):r&&!/[ncpfdg]\d?/i.test(r)&&(r=e.xlsx.Workbook.fromXlsxFormat(r)[0])}if(e.isDate(s))switch(r){case"d":return s.getDate();case"M":return s.getMonth()+1;case"y":r="yy";break;case"yyy":r="yyyy"}return e.Globalize.format(s,r)},2,2),o._functionTable.value=new a(function(n,i){var l,s=t._Expression.toString(n[0],o._rowIndex,o._columnIndex,i);if((s=s.replace(/(\,\d{3})/g,function(e){return e.substring(1)})).length>0){if(s[0]===e.culture.Globalize.numberFormat.currency.symbol)return+(s=s.substring(1));if("%"===s[s.length-1])return+(s=s.substring(0,s.length-1))/100}return l=+s,isNaN(l)?t._Expression.toNumber(n[0],o._rowIndex,o._columnIndex,i):l},1,1)},o.prototype._registerDateFunction=function(){var o=this;o._functionTable.now=new a(function(){return{value:new Date,format:"M/d/yyyy h:mm"}},0,0),o._functionTable.today=new a(function(){var e=new Date;return{value:new Date(e.getFullYear(),e.getMonth(),e.getDate()),format:"M/d/yyyy"}},0,0),o._functionTable.year=new a(function(n,i){var l=t._Expression.toDate(n[0],o._rowIndex,o._columnIndex,i);return!e.isPrimitive(l)&&l?l.value:e.isDate(l)?l.getFullYear():1900},1,1),o._functionTable.month=new a(function(n,i){var l=t._Expression.toDate(n[0],o._rowIndex,o._columnIndex,i);return!e.isPrimitive(l)&&l?l.value:e.isDate(l)?l.getMonth()+1:1},1,1),o._functionTable.day=new a(function(n,i){var l=t._Expression.toDate(n[0],o._rowIndex,o._columnIndex,i);return!e.isPrimitive(l)&&l?l.value:e.isDate(l)?l.getDate():0},1,1),o._functionTable.hour=new a(function(n,i){var l=n[0].evaluate(o._rowIndex,o._columnIndex,i);if(e.isNumber(l)&&!isNaN(l))return Math.floor(24*(l-Math.floor(l)));if(e.isDate(l))return l.getHours();if(l=t._Expression.toDate(n[0],o._rowIndex,o._columnIndex,i),!e.isPrimitive(l)&&l&&(l=l.value),e.isDate(l))return l.getHours();throw"Invalid parameter."},1,1),o._functionTable.time=new a(function(t,n){var i=t[0].evaluate(o._rowIndex,o._columnIndex,n),l=t[1].evaluate(o._rowIndex,o._columnIndex,n),s=t[2].evaluate(o._rowIndex,o._columnIndex,n);if(e.isNumber(i)&&e.isNumber(l)&&e.isNumber(s))return i%=24,l%=60,s%=60,{value:new Date(0,0,0,i,l,s),format:"h:mm tt"};throw"Invalid parameters."},3,3),o._functionTable.date=new a(function(t,n){var i=t[0].evaluate(o._rowIndex,o._columnIndex,n),l=t[1].evaluate(o._rowIndex,o._columnIndex,n),s=t[2].evaluate(o._rowIndex,o._columnIndex,n);if(e.isNumber(i)&&e.isNumber(l)&&e.isNumber(s))return{value:new Date(i,l-1,s),format:"M/d/yyyy"};throw"Invalid parameters."},3,3),o._functionTable.datedif=new a(function(n,i){var l,s,r,a,h,d=t._Expression.toDate(n[0],o._rowIndex,o._columnIndex,i),c=t._Expression.toDate(n[1],o._rowIndex,o._columnIndex,i),u=n[2].evaluate(o._rowIndex,o._columnIndex,i);if(!e.isPrimitive(d)&&d&&(d=d.value),!e.isPrimitive(c)&&c&&(c=c.value),e.isDate(d)&&e.isDate(c)&&e.isString(u)){if((l=d.getTime())>(s=c.getTime()))throw"Start date is later than end date.";switch(r=c.getDate()-d.getDate(),a=c.getMonth()-d.getMonth(),h=c.getFullYear()-d.getFullYear(),u.toUpperCase()){case"Y":return a>0?h:a<0?h-1:r>=0?h:h-1;case"M":return r>=0?12*h+a:12*h+a-1;case"D":return(s-l)/864e5;case"YM":return(a=r>=0?12*h+a:12*h+a-1)%12;case"YD":return a>0?(new Date(d.getFullYear(),c.getMonth(),c.getDate()).getTime()-d.getTime())/864e5:a<0?(new Date(d.getFullYear()+1,c.getMonth(),c.getDate()).getTime()-d.getTime())/864e5:r>=0?r:(new Date(d.getFullYear()+1,c.getMonth(),c.getDate()).getTime()-d.getTime())/864e5;case"MD":return r>=0?r:r=new Date(c.getFullYear(),c.getMonth(),0).getDate()-new Date(c.getFullYear(),c.getMonth()-1,1).getDate()+1+r;default:throw"Invalid unit."}}throw"Invalid parameters."},3,3)},o.prototype._registLookUpReferenceFunction=function(){var o=this;o._functionTable.column=new a(function(e,n,i,l){var s;if(null==e)return l+1;if(s=e[0],(s=o._ensureNonFunctionExpression(s,n))instanceof t._CellRangeExpression)return s.cells.col+1;throw"Invalid Cell Reference."},1,0),o._functionTable.columns=new a(function(e,n){var i=e[0];if((i=o._ensureNonFunctionExpression(i,n))instanceof t._CellRangeExpression)return i.cells.columnSpan;throw"Invalid Cell Reference."},1,1),o._functionTable.row=new a(function(e,n,i,l){var s;if(null==e)return i+1;if(s=e[0],(s=o._ensureNonFunctionExpression(s,n))instanceof t._CellRangeExpression)return s.cells.row+1;throw"Invalid Cell Reference."},1,0),o._functionTable.rows=new a(function(e,n){var i=e[0];if((i=o._ensureNonFunctionExpression(i,n))instanceof t._CellRangeExpression)return i.cells.rowSpan;throw"Invalid Cell Reference."},1,1),o._functionTable.choose=new a(function(e,n){var i=t._Expression.toNumber(e[0],o._rowIndex,o._columnIndex,n);if(isNaN(i))throw"Invalid index number.";if(i<1||i>=e.length)throw"The index number is out of the list range.";return e[i=Math.floor(i)].evaluate(o._rowIndex,o._columnIndex,n)},255,2),o._functionTable.index=new a(function(n,i){var l,s=n[0],r=t._Expression.toNumber(n[1],o._rowIndex,o._columnIndex,i),a=null!=n[2]?t._Expression.toNumber(n[2],o._rowIndex,o._columnIndex,i):0;if(isNaN(r)||r<0)throw"Invalid Row Number.";if(isNaN(a)||a<0)throw"Invalid Column Number.";if((s=o._ensureNonFunctionExpression(s,i))instanceof t._CellRangeExpression){if(r>(l=s.cells).rowSpan||a>l.columnSpan)throw"Index is out of the cell range.";if(r>0&&a>0)return o._owner.getCellValue(l.topRow+r-1,l.leftCol+a-1,!0,i);if(0===r&&0===a)return s;if(0===r)return new t._CellRangeExpression(new e.grid.CellRange(l.topRow,l.leftCol+a-1,l.bottomRow,l.leftCol+a-1),s.sheetRef,o._owner);if(0===a)return new t._CellRangeExpression(new e.grid.CellRange(l.topRow+r-1,l.leftCol,l.topRow+r-1,l.rightCol),s.sheetRef,o._owner)}throw"Invalid Cell Reference."},4,2),o._functionTable.hlookup=new a(function(e,t){return o._handleHLookup(e,t)},4,3)},o.prototype._registFinacialFunction=function(){var e=this;e._functionTable.rate=new a(function(t,o){return{value:e._calculateRate(t,o),format:"p2"}},6,3)},o.prototype._registAddressRelatedFunction=function(){var o=this;o._functionTable.indirect=new a(function(n,i){var l,s,r,a,h,d,c,u,_=o._ensureNonFunctionExpression(n[0],i);if(_ instanceof t._CellRangeExpression?(l=_.cells,s=_.evaluate(l.row,l.col,i)):s=_.evaluate(o._rowIndex,o._columnIndex,i),e.isString(s)){if(2===(r=s.split("!")).length?(a=r[0].toLowerCase(),h=r[1].toLowerCase()):h=r[0].toLowerCase(),d=o._getDefinedName(h,a||o._sheet.name.toLowerCase()),i=i||o._owner.selectedSheet,d){if(d.sheetName&&d.sheetName.toLowerCase()!==i.name.toLowerCase())throw"Invalid Cell Reference.";s=d.value}if(c=o._getCellRange(s)){if(c.sheetRef){for(var g=0;g<o._owner.sheets.length;g++)if(o._owner.sheets[g].name.toLowerCase()===c.sheetRef.toLowerCase()){u=o._owner.sheets[g];break}}else u=o._owner.selectedSheet;if(u)return o._owner.getCellValue(c.cellRef.cellRange.row,c.cellRef.cellRange.col,!0,i)}}throw"Invalid Cell Reference."},2,1),o._functionTable.address=new a(function(n,i){var l,s,r=t._Expression.toNumber(n[0],o._rowIndex,o._columnIndex,i),a=t._Expression.toNumber(n[1],o._rowIndex,o._columnIndex,i),h=!1,d=!1;if(isNaN(r)||!e.isInt(r)||r<1||r>1048576)throw"Invalid row number.";if(isNaN(a)||!e.isInt(a)||a<1||a>16384)throw"Invalid column number.";if(null!=n[2]&&(l=t._Expression.toNumber(n[2],o._rowIndex,o._columnIndex,i),isNaN(l)||!e.isInt(l)||l<1||l>4))throw"Invalid absolute type.";return null!=n[4]&&(s=t._Expression.toString(n[4],o._rowIndex,o._columnIndex,i)),null==l||1===l?(h=!0,d=!0):2===l?h=!0:3===l&&(d=!0),(null!=s?s+"!":"")+(d?"$":"")+o._numAlpha(a)+(h?"$":"")+r.toString()},5,2)},o.prototype._addToken=function(e,t,o){var i=new n(e,t,o);this._tokenTable[e]=i},o.prototype._parseExpression=function(){return this._getToken(),this._parseCompareOrConcat()},o.prototype._parseCompareOrConcat=function(){for(var e,o,n=this._parseAddSub();this._token.tokenType===i.COMPARE||this._token.tokenType===i.CONCAT;)e=this._token,this._getToken(),o=this._parseAddSub(),n=new t._BinaryExpression(e,n,o);return n},o.prototype._parseAddSub=function(){for(var e,o,n=this._parseMulDiv();this._token.tokenType===i.ADDSUB;)e=this._token,this._getToken(),o=this._parseMulDiv(),n=new t._BinaryExpression(e,n,o);return n},o.prototype._parseMulDiv=function(){for(var e,o,n=this._parsePower();this._token.tokenType===i.MULDIV;)e=this._token,this._getToken(),o=this._parsePower(),n=new t._BinaryExpression(e,n,o);return n},o.prototype._parsePower=function(){for(var e,o,n=this._parseUnary();this._token.tokenType===i.POWER;)e=this._token,this._getToken(),o=this._parseUnary(),n=new t._BinaryExpression(e,n,o);return n},o.prototype._parseUnary=function(){var e,o;return this._token.tokenID===l.ADD||this._token.tokenID===l.SUB?(e=this._token,this._getToken(),o=this._parseAtom(),new t._UnaryExpression(e,o)):this._parseAtom()},o.prototype._parseAtom=function(){var e,o,n,s,r,a,h,d,c,u,_,g,f,p=null;switch(this._token.tokenType){case i.LITERAL:p=new t._Expression(this._token);break;case i.IDENTIFIER:if(e=this._token.value.toString().toLowerCase(),o=this._functionTable[e]){if(n=this._getParameters(),this._token.tokenType===i.GROUP&&this._token.tokenID===l.CLOSE){if(s=n?n.length:0,-1!==o.paramMin&&s<o.paramMin)throw"Too few parameters.";if(-1!==o.paramMax&&s>o.paramMax)throw"Too many parameters.";"rand"===e&&(this._containsCellRef=!0),p=new t._FunctionExpression(e,o,n);break}if("true"===e||"false"===e){p=new t._FunctionExpression(e,o,n,!1);break}}if(2===(u=e.split("!")).length?(g=u[0],_=u[1]):_=u[0],a=this._getDefinedName(_,g||this._sheet.name.toLowerCase())){if(a.sheetName&&a.sheetName!==this._sheet.name&&a.sheetName.toLowerCase()!==g)throw"The defined name item works in "+a.sheetName+".  It does not work in current sheet.";c=this._pointer,d=this._expressLength,h=this._expression,this._pointer=0,p=this._checkCache(a.value),this._pointer=c,this._expressLength=d,this._expression=h;break}if(g="",null!=(f=this._owner._getTable(e))){if(""===(g=f.sheet.name))throw"The Table("+e+") is not located in any sheet.";if(this._getToken(),this._token.tokenType!==i.SQUAREBRACKETS||this._token.tokenID!==l.OPEN)throw"Invalid Table Reference.";this._tableRefStart=!0,p=this._getTableReference(f,g);break}if(r=this._getCellRange(e)){this._containsCellRef=!0,p=new t._CellRangeExpression(r.cellRef.cellRange,r.sheetRef,this._owner,e.indexOf(":")>-1,r.cellRef.absRow,r.cellRef.absCol,r.cellRef.absRow2,r.cellRef.absCol2,r.isWholeRow);break}n=this._getParameters(),p=this.onUnknownFunction(e,n);break;case i.GROUP:if(this._token.tokenID!==l.OPEN)throw"Expression expected.";if(this._getToken(),p=this._parseCompareOrConcat(),this._token.tokenID!==l.CLOSE)throw"Unbalanced parenthesis.";p._inGroup=!0;break;case i.SQUAREBRACKETS:if(this._token.tokenID!==l.OPEN)throw"Table References expected.";null!=(f=this._sheet.findTable(this._rowIndex,this._columnIndex))&&(g=f.sheet.name,this._tableRefStart=!0,p=this._getTableReference(f,g,!1))}if(null===p)throw"";return this._getToken(),p},o.prototype._getToken=function(){for(var e,t,o,s,r,a,h="",d="",c=new RegExp("[　-〿぀-ゟ゠-ヿ＀-ﾟ一-龯㐀-䶿]");this._pointer<this._expressLength&&" "===this._expression[this._pointer];)this._pointer++;if(this._pointer>=this._expressLength)this._token=new n(null,l.END,i.GROUP);else{if(r=(t=this._expression[this._pointer])>="a"&&t<="z"||t>="A"&&t<="Z"||c.test(t),a=t>="0"&&t<="9"||"."==t,!r&&!a){var u=this._tokenTable[t];if(u)return this._token=u,this._pointer++,void(this._pointer<this._expressLength&&(">"===t||"<"===t)&&(u=this._tokenTable[this._expression.substring(this._pointer-1,this._pointer+1)])&&(this._token=u,this._pointer++))}if(a){if(s=this._pointer,this._parseDigit(),":"!==this._expression[this._pointer])return;this._pointer=s}if('"'!==t){if("'"!==t||(d=this._parseSheetRef()))if("#"!==t){if(!r&&!a&&"_"!==t&&this._idChars.indexOf(t)<0&&!d)throw"Identifier expected.";for(e=1;e+this._pointer<this._expressLength;e++)if(r=(t=this._expression[this._pointer+e])>="a"&&t<="z"||t>="A"&&t<="Z"||c.test(t),a=t>="0"&&t<="9","'"!==t||":"!==o){if(o=t,!r&&!a&&"_"!==t&&this._idChars.indexOf(t)<0)break}else h=d+this._expression.substring(this._pointer,this._pointer+e),this._pointer+=e,d=this._parseSheetRef(),e=0;h+=d+this._expression.substring(this._pointer,this._pointer+e),this._pointer+=e,this._token=new n(h,l.ATOM,i.IDENTIFIER)}else this._parseDate()}else this._parseString()}},o.prototype._getTableToken=function(){for(var e,t,o,s="",r=!1;this._pointer<this._expressLength&&" "===this._expression[this._pointer];)this._pointer++;for("@"===(t=this._expression[this._pointer])&&(s=t,this._pointer++),"["===(t=this._expression[this._pointer])&&(r=!0),e=1;e+this._pointer<this._expressLength;e++){if(t=this._expression[this._pointer+e],r&&","===t)throw"Invalid table reference.";if("]"===t)break}o=s+this._expression.substring(this._pointer+(r?1:0),this._pointer+e),this._pointer+=e+(r?1:0),this._token=new n(o,l.ATOM,i.IDENTIFIER)},o.prototype._parseDigit=function(){var e,t,o=-1,s=!1,r=!1,a=0;for(e=0;e+this._pointer<this._expressLength;e++)if((t=this._expression[this._pointer+e])>="0"&&t<="9")a=10*a+(+t-0),o>-1&&(o*=10);else if("."===t&&o<0)o=1;else{if("E"!==t&&"e"!==t||s){if("%"===t){r=!0,e++;break}break}s=!0,"+"!==(t=this._expression[this._pointer+e+1])&&"-"!==t||e++}s?a=+this._expression.substring(this._pointer,this._pointer+e):(o>1&&(a/=o),r&&(a/=100)),this._token=new n(a,l.ATOM,i.LITERAL),this._pointer+=e},o.prototype._parseString=function(){var e,t,o;for(e=1;e+this._pointer<this._expressLength;e++)if('"'===(t=this._expression[this._pointer+e])){if('"'!==(e+this._pointer<this._expressLength-1?this._expression[this._pointer+e+1]:" "))break;e++}if('"'!==t)throw"Can't find final quote.";if(o=this._expression.substring(this._pointer+1,this._pointer+e),this._pointer+=e+1,"!"===this._expression[this._pointer])throw"Illegal cross sheet reference.";this._token=new n(o.replace('""','"'),l.ATOM,i.LITERAL)},o.prototype._parseDate=function(){var e,t,o;for(e=1;e+this._pointer<this._expressLength&&"#"!==(t=this._expression[this._pointer+e]);e++);if("#"!==t)throw'Can\'t find final date delimiter ("#").';o=this._expression.substring(this._pointer+1,this._pointer+e),this._pointer+=e+1,this._token=new n(Date.parse(o),l.ATOM,i.LITERAL)},o.prototype._parseSheetRef=function(){var e,t,o;for(e=1;e+this._pointer<this._expressLength;e++)if("'"===(t=this._expression[this._pointer+e])){if("'"!==(e+this._pointer<this._expressLength-1?this._expression[this._pointer+e+1]:" "))break;e++}if("'"!==t)throw"Can't find final quote.";return o=this._expression.substring(this._pointer+1,this._pointer+e),this._pointer+=e+1,"!"===this._expression[this._pointer]?o.replace(/\'\'/g,"'"):""},o.prototype._getCellRange=function(e){var t,o,n,i,l;if(e&&(t=e.split(":")).length>0&&t.length<3){if(null==(o=this._parseCell(t[0])).cellRef)return null;if(i=o.cellRef.cellRange,null!=o.cellRef.isWholeRow&&1===t.length)return null;if(i&&2===t.length){if(l=(n=this._parseCell(t[1])).cellRef.cellRange,null!=o.cellRef.isWholeRow&&o.cellRef.isWholeRow!==n.cellRef.isWholeRow)return null;if(o.sheetRef&&!n.sheetRef&&(n.sheetRef=o.sheetRef),o.sheetRef!==n.sheetRef)throw"The cell reference must be in the same sheet!";l?(i.col2=l.col,i.row2=l.row):i=null}}return null==i?null:{cellRef:{cellRange:i,absRow:o.cellRef.absRow,absCol:o.cellRef.absCol,absRow2:n?n.cellRef.absRow:null,absCol2:n?n.cellRef.absCol:null},sheetRef:o.sheetRef,isWholeRow:o.cellRef.isWholeRow}},o.prototype._parseCellRange=function(t){var o,n,i,l,s=-1,r=-1,a=!1,h=!1;for(o=0;o<t.length;o++)if("$"!==(i=t[o])||a){if(!(i>="a"&&i<="z"||i>="A"&&i<="Z"))break;s<0&&(s=0),s=26*s+(i.toUpperCase().charCodeAt(0)-"A".charCodeAt(0)+1)}else a=!0;for(;o<t.length;o++)if("$"!==(i=t[o])||h){if(!(i>="0"&&i<="9"))break;r<0&&(r=0),r=10*r+(+i-0)}else h=!0;return o<t.length?null:(r>-1&&s>-1?n=new e.grid.CellRange(r-1,s-1):-1===s?(l=!0,n=new e.grid.CellRange(r-1,0)):-1===r&&(l=!1,n=new e.grid.CellRange(0,s-1)),{cellRange:n,absRow:h,absCol:a,isWholeRow:l})},o.prototype._parseCell=function(e){var t,o,n;if((t=e.lastIndexOf("!"))>0&&t<e.length-1)n=e.substring(0,t),o=e.substring(t+1);else{if(!(t<=0))return null;o=e}return{cellRef:this._parseCellRange(o),sheetRef:n}},o.prototype._getParameters=function(){var e,t,o=this._pointer,n=this._token;if(this._getToken(),this._token.tokenType!==i.SQUAREBRACKETS||this._token.tokenID!==l.OPEN){if(this._token.tokenID!==l.OPEN)return this._pointer=o,this._token=n,null;if(o=this._pointer,this._getToken(),this._token.tokenID===l.CLOSE)return null;for(this._pointer=o,e=new Array,t=this._parseExpression(),e.push(t);this._token.tokenID===l.COMMA;)t=this._parseExpression(),e.push(t);if(this._token.tokenID!==l.CLOSE)throw"Syntax error.";return e}},o.prototype._getTableReference=function(e,o,n){void 0===n&&(n=!0);var s,r,a=[],h=this._getTableParameter(),d=!1;if(null==h)throw"Invalid table reference.";for(a.push(h);this._tableRefStart&&(this._token.tokenID===l.COMMA||":"===this._token.value);){if(":"===this._token.value&&(d=!0),null==(h=this._getTableParameter()))throw"Invalid table reference.";d?(a[a.length-1]+=":"+h,d=!1):a.push(h)}if(this._token.tokenType!==i.SQUAREBRACKETS||this._token.tokenID!==l.CLOSE)throw"Unbalanced square brackets.";return this._tableRefStart=!1,s=this._getTableRange(e,a),this._containsCellRef=!0,(r=new t._CellRangeExpression(s,o.toLowerCase(),this._owner))._tableParams=a,n&&(r._tableName=e.name),r},o.prototype._getTableParameter=function(){var e;for(this._pointer;this._pointer<this._expressLength&&" "===this._expression[this._pointer];)this._pointer++;return"]"===this._expression[this._pointer]?(this._tableRefStart=!1,null):(this._getTableToken(),e=this._token.value,this._getToken(),e)},o.prototype._getTableRange=function(o,n){for(var i,l,s,r,a,h,d=0;d<n.length;d++){if(l)throw"Invalid Table Refernce.";if(a=null,"#"===(i=n[d].toLowerCase())[0]){switch(i){case"#all":a=o.getRange();break;case"#data":a=o.getRange(t.TableSection.Data);break;case"#headers":a=o.getRange(t.TableSection.Header);break;case"#totals":a=o.getRange(t.TableSection.Footer);break;case"#this row":if(r=o.getRange(),!(this._rowIndex>=r.topRow&&this._rowIndex<=r.bottomRow))throw"The row is out of the table ("+o.name+") range.";a=new e.grid.CellRange(this._rowIndex,r.leftCol,this._rowIndex,r.rightCol);break;default:throw"Invalid Table Refernce."}if(null==a)throw"Invalid Table Refernce.";null==s?s=a:(s.row=s.topRow<a.topRow?s.topRow:a.topRow,s.row2=s.bottomRow>a.bottomRow?s.bottomRow:a.bottomRow)}else{l=!0,h=i.split(":");for(var c=0;c<h.length;c++){if(h.length>2)throw"Invalid Table Column Refernce.";if("@"===(i=h[c])[0]){if(null==(a=o.getRange(t.TableSection.Data,i.substring(1))))throw"Invalid Table Refernce.";if(!(this._rowIndex>=a.topRow&&this._rowIndex<=a.bottomRow))throw"The row is out of the table ("+o.name+") range.";a.row=this._rowIndex,a.row2=this._rowIndex}else if(null==(a=o.getRange(t.TableSection.Data,i)))throw"Invalid Table Refernce.";0===c&&(null==s?s=a:s.col=a.col),s.col2=a.col,a=null}}}return s},o.prototype._getAggregateResult=function(t,o,n){var i,l=this._getItemList(o,n);return i=e.getAggregate(t,l.items),l.isDate&&(i={value:i=new Date(i),format:l.format||"M/d/yyyy"}),i},o.prototype._getFlexSheetAggregateResult=function(e,o,n){var i,l,r,a;switch(e){case s.Count:return i=this._getItemList(o,n,!0,!1),this._countNumberCells(i.items);case s.CountA:return(i=this._getItemList(o,n,!1,!1)).items.length;case s.ConutBlank:return i=this._getItemList(o,n,!1,!0),this._countBlankCells(i.items);case s.Rank:if(r=t._Expression.toNumber(o[0],this._rowIndex,this._columnIndex,n),a=o[2]?t._Expression.toNumber(o[2],this._rowIndex,this._columnIndex,n):0,isNaN(r))throw"Invalid number.";if(isNaN(a))throw"Invalid order.";if(o[1]=this._ensureNonFunctionExpression(o[1],n),o[1]instanceof t._CellRangeExpression)return i=this._getItemList([o[1]],n),this._getRankOfCellRange(r,i.items,a);throw"Invalid Cell Reference.";case s.CountIf:if(o[0]=this._ensureNonFunctionExpression(o[0],n),o[0]instanceof t._CellRangeExpression)return i=this._getItemList([o[0]],n,!1),this._countCellsByCriterias([i.items],[o[1]],n);throw"Invalid Cell Reference.";case s.CountIfs:return this._handleCountIfs(o,n);case s.SumIf:if(o[0]=this._ensureNonFunctionExpression(o[0],n),o[0]instanceof t._CellRangeExpression)return i=this._getItemList([o[0]],n,!1),o[2]=this._ensureNonFunctionExpression(o[2],n),null!=o[2]&&o[2]instanceof t._CellRangeExpression&&(l=this._getItemList([o[2]],n)),this._sumCellsByCriterias([i.items],[o[1]],l?l.items:null,n);throw"Invalid Cell Reference.";case s.SumIfs:return this._handleSumIfs(o,n);case s.Product:return i=this._getItemList(o,n),this._getProductOfNumbers(i.items)}throw"Invalid aggregate type."},o.prototype._getItemList=function(o,n,i,l,s,r){void 0===i&&(i=!0),void 0===l&&(l=!1),void 0===s&&(s=!0);var a,h,d,c,u,_,g,f,p,w,m,C=new Array;for(h=0;h<o.length;h++)if(u=o[h],(u=this._ensureNonFunctionExpression(u,n))instanceof t._CellRangeExpression){c=u.getValues(s,r,n),0===h&&((p=(f=u._getSheet()||n||this._sheet).getCellStyle(u.cells.topRow,u.cells.leftCol))&&(g=p.format),g||(w=f.grid.columns[u.cells.leftCol])&&(g=w.format));e:for(d=0;d<c.length;d++)if(a=c[d],null==_&&null!=a&&!e.isString(a)){_=e.isDate(a);break e}for(d=0;d<c.length;d++)if(a=c[d],l||null!=a&&""!==a){if(e.isString(a)&&0===a.indexOf("Error: ")){C=[0];break}m=e.isString(a)?_?e.changeType(a,e.DataType.Date,""):e.changeType(a,e.DataType.Number,""):a,i&&!e.isBoolean(m)?isNaN(+m)||C.push(+m):C.push(a)}}else{if(a=u instanceof t._Expression?u.evaluate(this._rowIndex,this._columnIndex,n):u,e.isPrimitive(a)||(a=a.value),!l&&(null==a||""===a))continue;if(e.isString(a)&&0===a.indexOf("Error: ")){C=[0];break}i?isNaN(+a)||C.push(+a):C.push(a),null==_&&C.length>0&&(_=a instanceof Date)}return 0===C.length&&(_=!1),{isDate:_,items:C,format:g}},o.prototype._countBlankCells=function(t){for(var o,n=0,i=0;n<t.length;n++)(null==(o=t[n])||e.isString(o)&&""===o||e.isNumber(o)&&isNaN(o))&&i++;return i},o.prototype._countNumberCells=function(t){for(var o,n=0,i=0;n<t.length;n++)null!=(o=t[n])&&e.isNumber(o)&&!isNaN(o)&&i++;return i},o.prototype._getRankOfCellRange=function(e,t,o){void 0===o&&(o=0);var n,i=0,l=0;for(o?t.sort(function(e,t){return isNaN(e)||isNaN(t)?-1:e-t}):t.sort(function(e,t){return isNaN(e)||isNaN(t)?1:t-e});i<t.length;i++)if(n=t[i],!isNaN(n)&&(l++,e===n))return l;throw e+" is not in the cell range."},o.prototype._handleCountIfs=function(e,o){var n,i,l,s,r=0,a=[],h=[];if(e.length%2!=0)throw"Invalid params.";for(;r<e.length/2;r++){if(i=e[2*r],!((i=this._ensureNonFunctionExpression(i,o))instanceof t._CellRangeExpression))throw"Invalid Cell Reference.";if(0===r){if(!i.cells)throw"Invalid Cell Reference.";l=i.cells.rowSpan,s=i.cells.columnSpan}else{if(!i.cells)throw"Invalid Cell Reference.";if(i.cells.rowSpan!==l||i.cells.columnSpan!==s)throw"The row span and column span of each cell range has to be same with each other."}n=this._getItemList([i],o,!1),a[r]=n.items,h[r]=e[2*r+1]}return this._countCellsByCriterias(a,h,o)},o.prototype._countCellsByCriterias=function(o,n,i,l){for(var s,r,a,h,d=0,c=0,u=0,_=o[0].length,g=[];c<n.length;c++)"*"===(h=t._Expression.toString(n[c],this._rowIndex,this._columnIndex,i))?g.push(h):g.push(this._parseRightExpr(h));for(;d<_;d++){s=!1;e:for(c=0;c<o.length;c++)if(a=o[c][d],"string"==typeof(h=g[c])){if("*"!==h&&(null==a||""===a)){s=!1;break e}if(!(s="*"===h||this.evaluate(this._combineExpr(a,h),null,i,this._rowIndex,this._columnIndex)))break e}else if(!(s=s=h.reg.test(a.toString())===h.checkMathces))break e;s&&(l?null!=(r=l[d])&&e.isNumber(r)&&!isNaN(r)&&u++:u++)}return u},o.prototype._handleSumIfs=function(e,o){var n,i,l,s,r,a,h=1,d=[],c=[];if(e.length%2!=1)throw"Invalid params.";if(l=e[0],!((l=this._ensureNonFunctionExpression(l,o))instanceof t._CellRangeExpression))throw"Invalid Sum Cell Reference.";if(!l.cells)throw"Invalid Sum Cell Reference.";for(r=l.cells.rowSpan,a=l.cells.columnSpan,i=this._getItemList([l],o,!1);h<(e.length+1)/2;h++){if(s=e[2*h-1],!((s=this._ensureNonFunctionExpression(s,o))instanceof t._CellRangeExpression))throw"Invalid Criteria Cell Reference.";if(!s.cells)throw"Invalid Criteria Cell Reference.";if(s.cells.rowSpan!==r||s.cells.columnSpan!==a)throw"The row span and column span of each cell range has to be same with each other.";n=this._getItemList([s],o,!1),d[h-1]=n.items,c[h-1]=e[2*h]}return this._sumCellsByCriterias(d,c,i.items,o)},o.prototype._sumCellsByCriterias=function(o,n,i,l){var s,r,a,h,d=0,c=0,u=0,_=o[0].length,g=[];for(null==i&&(i=o[0]);c<n.length;c++)"*"===(h=t._Expression.toString(n[c],this._rowIndex,this._columnIndex,l))?g.push(h):g.push(this._parseRightExpr(h));for(;d<_;d++){r=!1,s=i[d];e:for(c=0;c<o.length;c++)if(a=o[c][d],"string"==typeof(h=g[c])){if("*"!==h&&(null==a||""===a)){r=!1;break e}if(!(r="*"===h||this.evaluate(this._combineExpr(a,h),null,l,this._rowIndex,this._columnIndex)))break e}else if(!(r=h.reg.test(a.toString())===h.checkMathces))break e;r&&e.isNumber(+s)&&!isNaN(+s)&&(u+=+s)}return u},o.prototype._getProductOfNumbers=function(t){var o,n=0,i=1,l=!1;if(t)for(;n<t.length;n++)o=t[n],e.isNumber(o)&&!isNaN(o)&&(i*=o,l=!0);return l?i:0},o.prototype._handleSubtotal=function(o,n){var i,l,s,a,h=!0,d=!0;if((i=t._Expression.toNumber(o[0],this._rowIndex,this._columnIndex,n))>=1&&i<=11||i>=101&&i<=111){switch(i>=101&&i<=111&&(h=!1),(i=e.asEnum(i,r))!==r.CountA&&i!==r.CountAWithoutHidden||(d=!1),l=this._getItemList(o.slice(1),n,d,!1,h),i){case r.Count:case r.CountWithoutHidden:return this._countNumberCells(l.items);case r.CountA:case r.CountAWithoutHidden:return l.items.length;case r.Product:case r.ProductWithoutHidden:return this._getProductOfNumbers(l.items);case r.Average:case r.AverageWithoutHidden:s=e.Aggregate.Avg;break;case r.Max:case r.MaxWithoutHidden:s=e.Aggregate.Max;break;case r.Min:case r.MinWithoutHidden:s=e.Aggregate.Min;break;case r.Std:case r.StdWithoutHidden:s=e.Aggregate.Std;break;case r.StdPop:case r.StdPopWithoutHidden:s=e.Aggregate.StdPop;break;case r.Sum:case r.SumWithoutHidden:s=e.Aggregate.Sum;break;case r.Var:case r.VarWithoutHidden:s=e.Aggregate.Var;break;case r.VarPop:case r.VarPopWithoutHidden:s=e.Aggregate.VarPop}return a=e.getAggregate(s,l.items),l.isDate&&(a=new Date(a)),a}throw"Invalid Subtotal function."},o.prototype._handleDCount=function(e,o){var n,i,l,s=e[0],r=e[2];if(s=this._ensureNonFunctionExpression(s,o),r=this._ensureNonFunctionExpression(r,o),s instanceof t._CellRangeExpression&&r instanceof t._CellRangeExpression&&(n=e[1].evaluate(this._rowIndex,this._columnIndex,o),i=this._getColumnIndexByField(s,n),(l=this._getItemList([s],o,!0,!1,!0,i)).items&&l.items.length>1))return this._DCountWithCriterias(l.items.slice(1),s,r);throw"Invalid Count Cell Reference."},o.prototype._DCountWithCriterias=function(e,o,n){var i,l,s,r,a,h,d,c,u,_,g,f=n.cells,p=0;if(i=this._getSheet(o.sheetRef),l=this._getSheet(n.sheetRef),f.rowSpan>1){for(s=f.topRow,r=f.bottomRow;r>f.topRow;r--){for(_=[],g=[],a=f.leftCol;a<=f.rightCol;a++)if(null!=(d=this._owner.getCellValue(r,a,!1,l))&&""!==d){if(g.push(new t._Expression(d)),c=this._owner.getCellValue(s,a,!1,l),h=this._getColumnIndexByField(o,c),!(null!=(u=this._getItemList([o],i,!1,!1,!0,h)).items&&u.items.length>1))throw"Invalid Count Cell Reference.";_.push(u.items.slice(1))}p+=this._countCellsByCriterias(_,g,i,e)}return p}throw"Invalid Criteria Cell Reference."},o.prototype._getColumnIndexByField=function(t,o){var n,i,l,s,r;if(-1===(r=(n=t.cells).topRow))throw"Invalid Count Cell Reference.";if(e.isInt(o)&&!isNaN(o)){if(o>=1&&o<=n.columnSpan)return l=n.leftCol+o-1}else for(i=this._getSheet(t.sheetRef),l=n.leftCol;l<=n.rightCol;l++)if(s=this._owner.getCellValue(r,l,!1,i),(o=e.isString(o)?o.toLowerCase():o)===(s=e.isString(s)?s.toLowerCase():s))return l;throw"Invalid field."},o.prototype._getSumProduct=function(e,t){var o,n,i,l=0,s=this._getItemListForSumProduct(e,t);if(s.length>0){n=s[0].length,i=s.length;for(var r=0;r<n;r++){o=1;for(var a=0;a<i;a++)o*=s[a][r];l+=o}}return l},o.prototype._getItemListForSumProduct=function(e,o){var n,i,l,s,r,a,h=[new Array];for(l=0;l<e.length;l++){if(a=e[l],n=new Array,(a=this._ensureNonFunctionExpression(a,o))instanceof t._CellRangeExpression)for(r=a.getValues(!0,null,o),s=0;s<r.length;s++)i=r[s],n.push(+i);else i=a instanceof t._Expression?a.evaluate(this._rowIndex,this._columnIndex,o):a,n.push(+i);if(l>0&&n.length!==h[0].length)throw"The cell ranges of the sumProduct formula must have the same dimensions.";h[l]=n}return h},o.prototype._getSheet=function(e){var t,o=0;if(e)for(;o<this._owner.sheets.length&&(t=this._owner.sheets[o]).name!==e;o++);return t},o.prototype._parseRightExpr=function(e){var t,o,n=!1;if(e.indexOf("?")>-1||e.indexOf("*")>-1){if(null==(t=e.match(/=?([\?\*]*)(\w*)([\?\*]*)(\w*)([\?\*]*)/))||6!==t.length)throw"Invalid Criteria.";return o=new RegExp("^"+(t[1].length>0?this._parseRegCriteria(t[1]):"")+t[2]+(t[3].length>0?this._parseRegCriteria(t[3]):"")+t[4]+(t[5].length>0?this._parseRegCriteria(t[5]):"")+"$","i"),/^[<>=]/.test(e)?"="===e.trim()[0]&&(n=!0):n=!0,{reg:o,checkMathces:n}}if(isNaN(+e))if(/^\w/.test(e))e='="'+e+'"';else{if(!/^[<>=]{1,2}\s*-?.+$/.test(e))throw"Invalid Criteria.";e=e.replace(/([<>=]{1,2})\s*(-?.+)/,'$1"$2"')}else e="="+ +e;return e},o.prototype._combineExpr=function(t,o){return(e.isString(t)||e.isDate(t))&&(t='"'+t+'"'),(t="="+t)+o},o.prototype._parseRegCriteria=function(e){for(var t=0,o=0,n="";t<e.length;t++)"*"===e[t]?(o>0&&(n+="\\w{"+o+"}",o=0),n+="\\w*"):"?"===e[t]&&o++;return o>0&&(n+="\\w{"+o+"}"),n},o.prototype._calculateRate=function(e,o){var n,i,l,s,r,a,h,d,c,u,_=0,g=0;for(l=t._Expression.toNumber(e[0],this._rowIndex,this._columnIndex,o),s=t._Expression.toNumber(e[1],this._rowIndex,this._columnIndex,o),r=t._Expression.toNumber(e[2],this._rowIndex,this._columnIndex,o),a=null!=e[3]?t._Expression.toNumber(e[3],this._rowIndex,this._columnIndex,o):0,h=null!=e[4]?t._Expression.toNumber(e[4],this._rowIndex,this._columnIndex,o):0,i=null!=e[5]?t._Expression.toNumber(e[5],this._rowIndex,this._columnIndex,o):.1,Math.abs(i)<1e-7?r*(1+l*i)+s*(1+i*h)*l+a:r*(d=Math.exp(l*Math.log(1+i)))+s*(1/i+h)*(d-1)+a,c=r+s*l+a,u=r*d+s*(1/i+h)*(d-1)+a,n=i;Math.abs(c-u)>1e-7&&_<20;)i=(u*g-c*n)/(u-c),g=n,n=i,c=u,u=Math.abs(i)<1e-7?r*(1+l*i)+s*(1+i*h)*l+a:r*(d=Math.exp(l*Math.log(1+i)))+s*(1/i+h)*(d-1)+a,++_;if(Math.abs(c-u)>1e-7&&20===_)throw"It is not able to calculate the rate with current parameters.";return i},o.prototype._handleHLookup=function(e,o){var n,i,l=e[0].evaluate(this._rowIndex,this._columnIndex,o),s=e[1],r=t._Expression.toNumber(e[2],this._rowIndex,this._columnIndex,o),a=null==e[3]||t._Expression.toBoolean(e[3],this._rowIndex,this._columnIndex,o);if(null==l||""==l)throw"Invalid lookup value.";if(isNaN(r)||r<0)throw"Invalid row index.";if((s=this._ensureNonFunctionExpression(s,o))instanceof t._CellRangeExpression){if(r>(n=s.cells).rowSpan)throw"Row index is out of the cell range.";if(a?-1===(i=this._exactMatch(l,n,o,!1))&&(i=this._approximateMatch(l,n,o)):i=this._exactMatch(l,n,o),-1===i)throw"Lookup Value is not found.";return this._owner.getCellValue(n.topRow+r-1,i,!1,o)}throw"Invalid Cell Reference."},o.prototype._exactMatch=function(t,o,n,i){void 0===i&&(i=!0);var l,s,r,a,h=o.topRow;if(e.isString(t)&&(t=t.toLowerCase()),i&&e.isString(t)&&(t.indexOf("?")>-1||t.indexOf("*")>-1)){if(null==(r=t.match(/([\?\*]*)(\w+)([\?\*]*)(\w+)([\?\*]*)/))||6!==r.length)throw"Invalid lookup value.";a=new RegExp("^"+(r[1].length>0?this._parseRegCriteria(r[1]):"")+r[2]+(r[3].length>0?this._parseRegCriteria(r[3]):"")+r[4]+(r[5].length>0?this._parseRegCriteria(r[5]):"")+"$","i")}for(l=o.leftCol;l<=o.rightCol;l++)if(s=this._owner.getCellValue(h,l,!1,n),null!=a){if(a.test(s))return l}else if(e.isString(s)&&(s=s.toLowerCase()),t===s)return l;return-1},o.prototype._approximateMatch=function(t,o,n){var i,l,s=o.topRow,r=[],a=0;for(e.isString(t)&&(t=t.toLowerCase()),l=o.leftCol;l<=o.rightCol;l++)i=this._owner.getCellValue(s,l,!1,n),i=isNaN(+i)?i:+i,r.push({value:i,index:l});for(r.sort(function(t,o){return e.isString(t.value)&&(t.value=t.value.toLowerCase()),e.isString(o.value)&&(o.value=o.value.toLowerCase()),t.value>o.value?-1:t.value===o.value?o.index-t.index:1});a<r.length;a++)if(i=r[a],e.isString(i.value)&&(i.value=i.value.toLowerCase()),t>i.value)return i.index;throw"Lookup Value is not found."},o.prototype._parseToScientificValue=function(t,o,n,i,l){var s,r,a,h,d=0;if(Math.abs(t)>=1)for(r="+",s=Math.pow(10,o.length);t>s;)t/=s,d+=o.length;else for(r="-",s=Math.pow(10,o.length);t*s<s;)t*=s,d+=o.length;if(a=e.Globalize.format(t,"D"+o.length),n)for((a+=e.Globalize.format(t-Math.floor(t),o+n).substring(1)).indexOf(".")>-1?h=a.length-1-a.indexOf("."):(a+=".",h=0);h<n.length-1;)a+="0",h++;if(a+="E"+r+e.Globalize.format(d,"D"+i.length),l){a+=".";for(var c=1;c<l.length;c++)a+="0"}return a},o.prototype._checkCache=function(e,t,o,n){null!=t&&(this._sheet=this._owner.sheets[t]),null!=o&&(this._rowIndex=o),null!=n&&(this._columnIndex=n);var s=this._expressionCache[this._sheet.name+":"+e]||this._expressionCache[this._sheet.name+"_"+this._rowIndex+"_"+this._columnIndex+":"+e];if(s)return s;if(s=this._parse(e),this._token.tokenID!==l.END||this._token.tokenType!==i.GROUP)throw"Invalid Expression: "+e;return this._cacheSize>1e4&&this._clearExpressionCache(),this._expressionCache[this._sheet.name+(this._containsCellRef?"_"+this._rowIndex+"_"+this._columnIndex:"")+":"+e]=s,this._cacheSize++,s},o.prototype._ensureNonFunctionExpression=function(e,o){for(;e instanceof t._FunctionExpression;)e=e.evaluate(this._rowIndex,this._columnIndex,o);return e},o.prototype._getDefinedName=function(e,t){for(var o,n,i=0;i<this._owner.definedNames.length;i++)if((o=this._owner.definedNames[i]).name.toLowerCase()===e)if(o.sheetName){if(o.sheetName.toLowerCase()===t)return o}else n=o;return n},o.prototype._numAlpha=function(e){var t=Math.floor((e-1)/26);return(t>0?this._numAlpha(t):"")+String.fromCharCode((e-1)%26+65)},o}();t._CalcEngine=o;var n=function(){function e(e,t,o){this._value=e,this._tokenID=t,this._tokenType=o}return Object.defineProperty(e.prototype,"value",{get:function(){return this._value},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"tokenID",{get:function(){return this._tokenID},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"tokenType",{get:function(){return this._tokenType},enumerable:!0,configurable:!0}),e}();t._Token=n;var i,l,s,r,a=function(){function t(t,o,n){this._paramMax=Number.MAX_VALUE,this._paramMin=Number.MIN_VALUE,this._func=t,e.isNumber(o)&&!isNaN(o)&&(this._paramMax=o),e.isNumber(n)&&!isNaN(n)&&(this._paramMin=n)}return Object.defineProperty(t.prototype,"paramMax",{get:function(){return this._paramMax},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"paramMin",{get:function(){return this._paramMin},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"func",{get:function(){return this._func},enumerable:!0,configurable:!0}),t}();t._FunctionDefinition=a,function(e){e[e.COMPARE=0]="COMPARE",e[e.ADDSUB=1]="ADDSUB",e[e.MULDIV=2]="MULDIV",e[e.POWER=3]="POWER",e[e.CONCAT=4]="CONCAT",e[e.GROUP=5]="GROUP",e[e.LITERAL=6]="LITERAL",e[e.IDENTIFIER=7]="IDENTIFIER",e[e.SQUAREBRACKETS=8]="SQUAREBRACKETS"}(i=t._TokenType||(t._TokenType={})),function(e){e[e.GT=0]="GT",e[e.LT=1]="LT",e[e.GE=2]="GE",e[e.LE=3]="LE",e[e.EQ=4]="EQ",e[e.NE=5]="NE",e[e.ADD=6]="ADD",e[e.SUB=7]="SUB",e[e.MUL=8]="MUL",e[e.DIV=9]="DIV",e[e.DIVINT=10]="DIVINT",e[e.MOD=11]="MOD",e[e.POWER=12]="POWER",e[e.CONCAT=13]="CONCAT",e[e.OPEN=14]="OPEN",e[e.CLOSE=15]="CLOSE",e[e.END=16]="END",e[e.COMMA=17]="COMMA",e[e.PERIOD=18]="PERIOD",e[e.ATOM=19]="ATOM"}(l=t._TokenID||(t._TokenID={})),function(e){e[e.Count=0]="Count",e[e.CountA=1]="CountA",e[e.ConutBlank=2]="ConutBlank",e[e.CountIf=3]="CountIf",e[e.CountIfs=4]="CountIfs",e[e.Rank=5]="Rank",e[e.SumIf=6]="SumIf",e[e.SumIfs=7]="SumIfs",e[e.Product=8]="Product"}(s||(s={})),function(e){e[e.Average=1]="Average",e[e.Count=2]="Count",e[e.CountA=3]="CountA",e[e.Max=4]="Max",e[e.Min=5]="Min",e[e.Product=6]="Product",e[e.Std=7]="Std",e[e.StdPop=8]="StdPop",e[e.Sum=9]="Sum",e[e.Var=10]="Var",e[e.VarPop=11]="VarPop",e[e.AverageWithoutHidden=101]="AverageWithoutHidden",e[e.CountWithoutHidden=102]="CountWithoutHidden",e[e.CountAWithoutHidden=103]="CountAWithoutHidden",e[e.MaxWithoutHidden=104]="MaxWithoutHidden",e[e.MinWithoutHidden=105]="MinWithoutHidden",e[e.ProductWithoutHidden=106]="ProductWithoutHidden",e[e.StdWithoutHidden=107]="StdWithoutHidden",e[e.StdPopWithoutHidden=108]="StdPopWithoutHidden",e[e.SumWithoutHidden=109]="SumWithoutHidden",e[e.VarWithoutHidden=110]="VarWithoutHidden",e[e.VarPopWithoutHidden=111]="VarPopWithoutHidden"}(r||(r={}))}(t.sheet||(t.sheet={}))}(e.grid||(e.grid={}))}(wijmo||(wijmo={})),function(e){!function(t){!function(t){"use strict";var o=function(o){function n(){return null!==o&&o.apply(this,arguments)||this}return __extends(n,o),n.prototype.updateCell=function(n,i,l,s,r){var a,h,d,c,u,_,g,f,p,w,m,C,b,S,y,R=n.grid,v=null,x=null;switch(n.cellType===e.grid.CellType.Cell&&this._resetCellStyle(s),o.prototype.updateCell.call(this,n,i,l,s,r),r&&!r.isSingleCell&&(i=r.row,l=r.col,r.row2,r.col2),y=R.selectedSheet,w=R._getBindingColumn(n,i,n.columns[l]),n.cellType){case e.grid.CellType.RowHeader:s.textContent=i+1+"";break;case e.grid.CellType.ColumnHeader:a=null==y.itemsSource&&null==R.itemsSource?y&&y._showDefaultHeader||null==w.header?t.FlexSheet.convertNumberToAlpha(l):w.header:y&&y._showDefaultHeader||null==w._hdr||w._hdr===w.binding||w._hdr===e.toHeaderCase(w.binding)?t.FlexSheet.convertNumberToAlpha(l):w._hdr,s.textContent?s.innerHTML=s.innerHTML.replace(e.escapeHtml(s.textContent),a).replace(s.textContent,a):s.innerHTML+=a,s.style.textAlign="center";break;case e.grid.CellType.Cell:if(h=i*R.columns.length+l,g=y&&y._styledCells?y._styledCells[h]:null,x=this._checkNeedBottomRightBorder(R,y,i,l),r&&!r.isSingleCell&&(i=(C=this._getFirstVisibleCell(R,r)).row,l=C.col,v=this._getBottomRightBordersForMergeCells(R,y,r),x=this._checkNeedBottomRightBorder(R,y,r.bottomRow,r.rightCol)),n.rows[i]instanceof t.HeaderRow)n.columns[l].dataType===e.DataType.Boolean?1===s.childElementCount&&s.firstElementChild instanceof HTMLInputElement&&"checkbox"===s.firstElementChild.type&&(s.innerHTML=e.escapeHtml(R.getCellValue(i,l))):s.innerHTML||(s.innerHTML=e.escapeHtml(R.getCellValue(i,l))),e.addClass(s,"wj-header-row");else{if(c=R.getCellValue(i,l,!1),_=null!=(u=R.getCellData(i,l,!1))&&"string"==typeof u&&"="===u[0],b=n.rows[i]instanceof e.grid.GroupRow,m=(g?g.format:null)||(b?null:w.format),R.editRange&&R.editRange.contains(i,l)?!e.isNumber(c)||w.dataMap||_||(m&&(c=this._getFormattedValue(c,m)),(p=s.querySelector("input"))&&(p.value=c)):n.columns[l].dataType===e.DataType.Boolean?(f=s.querySelector('[type="checkbox"]'))&&(f.checked=R.getCellValue(i,l),f.disabled=f.disabled||!R.canEditCell(i,l)):w.dataMap&&!b?(c=R.getCellValue(i,l,!0),(d=s.firstChild)&&3===d.nodeType&&d.nodeValue!==c&&(d.nodeValue=c)):0===s.childElementCount&&s.textContent===R.getCellData(i,l,!0)&&(""!==(c=R.getCellValue(i,l,!0))&&e.isNumber(+c)&&!isNaN(+c)&&/[hsmy\:]/i.test(m)&&(S=t.FlexSheet._fromOADate(+c),isNaN(S.getTime())||(c=e.Globalize.formatDate(S,m))),!m&&b||(c=e.isString(c)?c.replace(/^(\')(\s*[\w|=])/,"$2"):c,e.isString(c)?c&&this._isURL(c)?s.innerHTML='<a href="'+c+'" target="_blank">'+e.escapeHtml(c)+"</a>":s.innerHTML=e.escapeHtml(c):s.innerHTML=c)),g){var T,I=s.style;for(var k in g)if("className"===k)g.className&&e.addClass(s,g.className);else if("format"!==k&&(T=g[k]))if(!e.hasClass(s,"wj-state-selected")&&!e.hasClass(s,"wj-state-multi-selected")||"color"!==k&&"backgroundColor"!==k)if("whiteSpace"===k&&"normal"===T)I[k]="";else{if(!x.needBottomBorder&&-1!==k.indexOf("borderBottom")||!x.needRightBorder&&-1!==k.indexOf("borderRight"))continue;I[k]=T}else I[k]=""}if(v){var E=void 0;for(var A in v)if(E=v[A]){if(!x.needBottomBorder&&-1!==A.indexOf("borderBottom")||!x.needRightBorder&&-1!==A.indexOf("borderRight"))continue;s.style[A]=E}}}(s.style.backgroundColor||s.style.color)&&(g||(g={},y&&y._styledCells[h]),s.style.backgroundColor&&(g.backgroundColor=s.style.backgroundColor),s.style.color&&(g.color=s.style.color))}n.cellType===e.grid.CellType.Cell&&(i!==R._lastVisibleFrozenRow||e.hasClass(s,"wj-frozen-row")||e.addClass(s,"wj-frozen-row"),l!==R._lastVisibleFrozenColumn||e.hasClass(s,"wj-frozen-col")||e.addClass(s,"wj-frozen-col"))},n.prototype._resetCellStyle=function(e){["fontFamily","fontSize","fontStyle","fontWeight","textDecoration","textAlign","verticalAlign","backgroundColor","color","whiteSpace","borderLeftStyle","borderLeftColor","borderLeftWidth","borderRightStyle","borderRightColor","borderRightWidth","borderTopStyle","borderTopColor","borderTopWidth","borderBottomStyle","borderBottomColor","borderBottomWidth"].forEach(function(t){e.style[t]=""})},n.prototype._getFormattedValue=function(t,o){return t!==Math.round(t)&&(o=o.replace(/([a-z])(\d*)(.*)/gi,"$0112$3")),e.Globalize.formatNumber(t,o,!0)},n.prototype._getFirstVisibleCell=function(t,o){var n,i;for(n=o.topRow;n<=o.bottomRow&&!t.rows[n].isVisible;n++);for(i=o.leftCol;i<=o.rightCol&&!t.columns[i].isVisible;i++);return new e.grid.CellRange(n,i)},n.prototype._isURL=function(e){return new RegExp("^(https|http|ftp|rtsp|mms)://(([0-9a-z_!~*'().&=+$%-]+: )?[0-9a-z_!~*'().&=+$%-]+@)?(([0-9]{1,3}.){3}[0-9]{1,3}|([0-9a-z_!~*'()-]+.)*([0-9a-z][0-9a-z-]{0,61})?[0-9a-z].[a-z]{2,6})(:[0-9]{1,4})?(/($|[a-zA-Z0-9.,?'\\+&amp;%$#=~_-]+))*").test(e)},n.prototype._getBottomRightBordersForMergeCells=function(e,t,o){var n=o.bottomRow*e.columns.length+o.rightCol,i=t&&t._styledCells?t._styledCells[n]:null;return i?{borderBottomColor:i.borderBottomColor,borderBottomWidth:i.borderBottomWidth,borderBottomStyle:i.borderBottomStyle,borderRightColor:i.borderRightColor,borderRightWidth:i.borderRightWidth,borderRightStyle:i.borderRightStyle}:null},n.prototype._checkNeedBottomRightBorder=function(e,t,o,n){var i={needBottomBorder:!0,needRightBorder:!0};if(o<e.rows.length-1){var l=(o+1)*e.columns.length+n,s=t&&t._styledCells?t._styledCells[l]:null;s&&(s.borderTopColor||s.borderTopWidth||s.borderTopStyle)&&(i.needBottomBorder=!1)}if(n<e.columns.length-1){var r=o*e.columns.length+n+1,a=t&&t._styledCells?t._styledCells[r]:null;a&&(a.borderLeftColor||a.borderLeftWidth||a.borderLeftStyle)&&(i.needRightBorder=!1)}return i},n}(e.grid.CellFactory);t._FlexSheetCellFactory=o}(t.sheet||(t.sheet={}))}(e.grid||(e.grid={}))}(wijmo||(wijmo={})),function(e){!function(t){t.sheet||(t.sheet={}),e._registerModule("wijmo.grid.sheet",e.grid.sheet)}(e.grid||(e.grid={}))}(wijmo||(wijmo={}));