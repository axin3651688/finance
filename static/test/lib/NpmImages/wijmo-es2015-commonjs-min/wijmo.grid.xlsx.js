/*!
    *
    * Wijmo Library 5.20191.603
    * http://wijmo.com/
    *
    * Copyright(c) GrapeCity, Inc.  All rights reserved.
    *
    * Licensed under the GrapeCity Commercial License.
    * sales@wijmo.com
    * wijmo.com/products/wijmo-5/license/
    *
    */

"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const wijmo_1=require("wijmo/wijmo"),wijmo_grid_1=require("wijmo/wijmo.grid"),mXlsx=require("wijmo/wijmo.xlsx"),selfModule=require("wijmo/wijmo.grid.xlsx");function softDetail(){return wijmo_1._getModule("wijmo.grid.detail")}function softMultiRow(){return wijmo_1._getModule("wijmo.grid.multirow")}exports.softDetail=softDetail,exports.softMultiRow=softMultiRow;class FlexGridXlsxConverter{static save(e,l,o){var t=this._saveFlexGridToWorkbook(e,l);return o&&t.save(o),t}static saveAsync(e,l,o,t,r){var s=this._saveFlexGridToWorkbook(e,l);return o&&s.saveAsync(o,t,r),s}static load(e,l,o){if(l instanceof Blob){var t=new FileReader;t.onload=(()=>{var l=mXlsx.Workbook._base64EncArr(new Uint8Array(t.result)),r=new mXlsx.Workbook;r.load(l),l=null,e.deferUpdate(()=>{this._loadToFlexGrid(e,r,o),r=null})}),t.readAsArrayBuffer(l)}else if(l instanceof mXlsx.Workbook)e.deferUpdate(()=>{this._loadToFlexGrid(e,l,o),l=null});else{if(l instanceof ArrayBuffer)l=mXlsx.Workbook._base64EncArr(new Uint8Array(l));else if(!wijmo_1.isString(l))throw"Invalid workbook.";var r=new mXlsx.Workbook;r.load(l),l=null,e.deferUpdate(()=>{this._loadToFlexGrid(e,r,o),r=null})}}static loadAsync(e,l,o,t,r){if(l instanceof Blob){var s=new FileReader;s.onload=(()=>{var l=mXlsx.Workbook._base64EncArr(new Uint8Array(s.result)),i=new mXlsx.Workbook;i.loadAsync(l,r=>{l=null,i=null,e.deferUpdate(()=>{this._loadToFlexGrid(e,r,o),t&&t(r),r=null})},r)}),s.readAsArrayBuffer(l)}else if(l instanceof mXlsx.Workbook)e.deferUpdate(()=>{this._loadToFlexGrid(e,l,o),t&&t(l),l=null});else{if(l instanceof ArrayBuffer)l=mXlsx.Workbook._base64EncArr(new Uint8Array(l));else if(!wijmo_1.isString(l))throw"Invalid workbook.";(new mXlsx.Workbook).loadAsync(l,r=>{l=null,e.deferUpdate(()=>{this._loadToFlexGrid(e,r,o),t&&t(r),r=null})},r)}}static _saveFlexGridToWorkbook(e,l){var o,t,r,s,i,n,a,d,u,m,c,h,w,f,g=new mXlsx.Workbook,p=new mXlsx.WorkSheet,_=(new mXlsx.WorkbookStyle,new mXlsx.WorkbookFrozenPane),x=!l||null==l.includeColumnHeaders||l.includeColumnHeaders,b=!(!l||null==l.includeRowHeaders)&&l.includeRowHeaders,y=!l||null==l.includeCellStyles||l.includeCellStyles,C=l?l.activeWorksheet:null,k=l?l.includeColumns:null,v=l?l.formatItem:null,S=0,j=0,R=0,T=[];if(null==this.hasCssText&&(this.hasCssText="cssText"in document.body.style),m=e.wj_sheetInfo,p.name=l?l.sheetName:"",p.visible=!l||!1!==l.sheetVisible,m&&m.tables&&m.tables.length>0)for(var W=0;W<m.tables.length;W++)p.tables.push(m.tables[W]);if(n=[],m||!y&&!v||((c=document.createElement("div")).style.visibility="hidden",c.setAttribute(wijmo_grid_1.FlexGrid._WJS_MEASURE,"true"),e.hostElement.appendChild(c)),b){for(d=0,a=0;a<e.rowHeaders.rows.length;a++)if(!(e.rowHeaders.rows[a].renderSize<=0)){for(n[d]=[],u=0;u<e.rowHeaders.columns.length;u++)r=e._getBindingColumn(e.rowHeaders,a,e.rowHeaders.columns[u]),(s=this._getColumnSetting(r,u,e.columnHeaders.columns))&&(n[d][u]=s,0===d&&((i=new mXlsx.WorkbookColumn)._deserialize(s),p._addWorkbookColumn(i,u)));d++}R=u}if(e.columnHeaders.rows.length>0){for(d=0,a=0;a<e.columnHeaders.rows.length;a++)if(!(e.columnHeaders.rows[a].renderSize<=0)){for(n[d]||(n[d]=[]),u=0;u<e.columnHeaders.columns.length;u++)r=e._getBindingColumn(e.columnHeaders,a,e.columnHeaders.columns[u]),(s=this._getColumnSetting(r,u,e.columnHeaders.columns))&&(n[d][R+u]=s,0===d&&(k&&!k(r)||((i=new mXlsx.WorkbookColumn)._deserialize(s),p._addWorkbookColumn(i,R+u))));x&&(R=0,o={},t=new mXlsx.WorkbookRow,b&&(R=this._parseFlexGridRowToSheetRow(e.topLeftCells,o,a,0,n,y,c,T,!1,0,k,v)),this._parseFlexGridRowToSheetRow(e.columnHeaders,o,a,R,n,y,c,T,!1,0,k,v),o.cells.length>0&&(t._deserialize(o),p._addWorkbookRow(t,d))),d++}j=x?d:0}for(a=0;a<e.cells.rows.length;a++)R=0,o={},t=new mXlsx.WorkbookRow,(h=e.rows[a])instanceof wijmo_grid_1._NewRowTemplate||((w=h instanceof wijmo_grid_1.GroupRow)?S=wijmo_1.tryCast(h,wijmo_grid_1.GroupRow).level:e.rows.maxGroupLevel>-1&&(S=e.rows.maxGroupLevel+1),b&&(R=this._parseFlexGridRowToSheetRow(e.rowHeaders,o,a,0,n,y,c,T,w,S,k,v)),this._parseFlexGridRowToSheetRow(e.cells,o,a,R,n,y,c,T,w,S,k,v),o.cells.length>0&&(t._deserialize(o),p._addWorkbookRow(t,j+a)));for(f=e.cells.rows.length,a=0;a<e.columnFooters.rows.length;a++)R=0,o={},t=new mXlsx.WorkbookRow,w=(h=e.columnFooters.rows[a])instanceof wijmo_grid_1.GroupRow,b&&(R=this._parseFlexGridRowToSheetRow(e.rowHeaders,o,a,0,n,y,c,T,w,0,k,v)),this._parseFlexGridRowToSheetRow(e.columnFooters,o,a,R,n,y,c,T,w,0,k,v),o.cells.length>0&&(t._deserialize(o),p._addWorkbookRow(t,j+f+a));return _.rows=x?e.frozenRows+j:e.frozenRows,_.columns=b?e.frozenColumns+R:e.frozenColumns,p.frozenPane=_,g._addWorkSheet(p),m||!y&&!v||(e.hostElement.removeChild(c),T.forEach(e=>e.forEach(e=>{e&&e.parentElement&&e.parentElement.removeChild(e)}))),g.activeWorksheet=C,g}static _loadToFlexGrid(e,l,o){var t,r,s,i,n,a,d,u,m,c,h,w,f,g,p,_,x,b,y,C,k,v,S,j,R,T,W,X,A,F,D,B,H=!o||null==o.includeColumnHeaders||o.includeColumnHeaders,N=!o||null==o.includeColumnHeaders||o.includeColumnHeaders,E=o&&null!=o.sheetIndex&&!isNaN(o.sheetIndex)?o.sheetIndex:0,I=o?o.sheetName:null,G=!o||o.sheetVisible,M=null!=e.wj_sheetInfo,z=0,L=0,O=!1,P={};if(e.itemsSource=null,e.columns.clear(),e.rows.clear(),e.frozenColumns=0,e.frozenRows=0,T={},W=[],L=0,s=[],X=[],E<0||E>=l.sheets.length)throw"The sheet index option is out of the sheet range of current workbook.";if(null!=I)for(t=0;t<l.sheets.length;t++)if(I===l.sheets[t].name){h=l.sheets[t];break}if(null!=(h=h||l.sheets[E]).rows){for(H&&(L=1,h.rows.length<=1&&(N=!1,L=0),d=h.rows[0]),f=this._getColumnCount(h.rows),w=this._getRowCount(h.rows,f),b=h.summaryBelow,r=h.columns,z=0;z<f;z++)e.columns.push(new wijmo_grid_1.Column),r[z]&&(isNaN(+r[z].width)||(e.columns[z].width=+r[z].width),r[z].visible||null==r[z].visible||(e.columns[z].visible=!!r[z].visible),r[z].style&&r[z].style.wordWrap&&(e.columns[z].wordWrap=r[z].style.wordWrap));for(;L<w;L++){if(g=!1,B=null,c=h.rows[L])for(_=L+1;_<h.rows.length;){if(x=h.rows[_]){(isNaN(c.groupLevel)&&!isNaN(x.groupLevel)||!isNaN(c.groupLevel)&&c.groupLevel<x.groupLevel)&&(g=!0);break}_++}for(g&&!b?(C&&(C.isCollapsed=O),(C=new wijmo_grid_1.GroupRow).isReadOnly=!1,O=null!=c.collapsed&&c.collapsed,C.level=isNaN(c.groupLevel)?0:c.groupLevel,P[C.level]=O,this._checkParentCollapsed(P,C.level)&&C._setFlag(wijmo_grid_1.RowColFlags.ParentCollapsed,!0),e.rows.push(C)):(y=new wijmo_grid_1.Row,c&&this._checkParentCollapsed(P,c.groupLevel)&&y._setFlag(wijmo_grid_1.RowColFlags.ParentCollapsed,!0),e.rows.push(y)),c&&c.height&&!isNaN(c.height)&&(e.rows[N?L-1:L].height=c.height),z=0;z<f;z++)if(c){if((S=(p=c.cells[z])?p.formula:null)&&"="!==S[0]&&(S="="+S),p&&p.textRuns&&p.textRuns.length>0?(e.rows[N?L-1:L].isContentHtml=!0,e.setCellData(N?L-1:L,z,this._parseTextRunsToHTML(p.textRuns))):e.setCellData(N?L-1:L,z,S&&M?S:this._getItemValue(p)),g||this._setColumn(s,z,p),j=L*f+z,R=p?p.style:null,A=mXlsx.Workbook._parseExcelFormat(p),R){if(B=null==B?!!R.wordWrap:B&&!!R.wordWrap,F=this._getItemType(p),R.hAlign)D=mXlsx.Workbook._parseHAlignToString(wijmo_1.asEnum(R.hAlign,mXlsx.HAlign));else switch(F){case wijmo_1.DataType.Number:D="right";break;case wijmo_1.DataType.Boolean:D="center";break;default:D=A&&0===A.search(/[n,c,p]/i)?"right":"left"}T[j]={fontWeight:R.font&&R.font.bold?"bold":"none",fontStyle:R.font&&R.font.italic?"italic":"none",textDecoration:R.font&&R.font.underline?"underline":"none",textAlign:D,fontFamily:R.font&&R.font.family?R.font.family:"",fontSize:R.font&&R.font.size?R.font.size+"px":"",color:R.font&&R.font.color?R.font.color:"",backgroundColor:R.fill&&R.fill.color?R.fill.color:"",whiteSpace:R.wordWrap?"pre-wrap":"normal",format:A},R.borders&&(R.borders.left&&(this._parseBorderStyle(R.borders.left.style,"Left",T[j]),T[j].borderLeftColor=R.borders.left.color),R.borders.right&&(this._parseBorderStyle(R.borders.right.style,"Right",T[j]),T[j].borderRightColor=R.borders.right.color),R.borders.top&&(this._parseBorderStyle(R.borders.top.style,"Top",T[j]),T[j].borderTopColor=R.borders.top.color),R.borders.bottom&&(this._parseBorderStyle(R.borders.bottom.style,"Bottom",T[j]),T[j].borderBottomColor=R.borders.bottom.color)),R.font&&-1===X.indexOf(R.font.family)&&X.push(R.font.family)}p&&wijmo_1.isNumber(p.rowSpan)&&p.rowSpan>0&&wijmo_1.isNumber(p.colSpan)&&p.colSpan>0&&(p.rowSpan>1||p.colSpan>1)&&W.push(new wijmo_grid_1.CellRange(L,z,L+p.rowSpan-1,z+p.colSpan-1))}c&&(this._checkParentCollapsed(P,c.groupLevel)||c.visible||null==c.visible||(e.rows[N?L-1:L].visible=c.visible),e.rows[N?L-1:L].wordWrap=!!c.style&&!!c.style.wordWrap||!!B)}for(C&&(C.isCollapsed=O),h.frozenPane&&(k=h.frozenPane.columns,wijmo_1.isNumber(k)&&!isNaN(k)&&(e.frozenColumns=k),v=h.frozenPane.rows,wijmo_1.isNumber(v)&&!isNaN(v)&&(e.frozenRows=N&&v>0?v-1:v)),z=0;z<e.columnHeaders.columns.length;z++)i=s[z],(n=e.columns[z]).isRequired=!1,N&&((u=d?d.cells[z]:null)&&u.value?(m=mXlsx.Workbook._parseExcelFormat(u),a=wijmo_1.Globalize.format(u.value,m)):a=""),n.header=a,i&&(i.dataType===wijmo_1.DataType.Boolean&&(n.dataType=i.dataType),n.format=i.format,n.align=i.hAlign,n.wordWrap=n.wordWrap||!!i.wordWrap);M&&(e.wj_sheetInfo.name=h.name,e.wj_sheetInfo.visible=!0===G||!1!==h.visible,e.wj_sheetInfo.styledCells=T,e.wj_sheetInfo.mergedRanges=W,e.wj_sheetInfo.fonts=X,e.wj_sheetInfo.tables=h.tables)}}static _parseFlexGridRowToSheetRow(e,l,o,t,r,s,i,n,a,d,u,m){var c,h,w,f,g,p,_,x,b,y,C,k,v,S,j,R,T,W,X,A,F,D,B,H,N,E,I,G,M,z,L=!1,O=!1;for((X=(c=e.grid).wj_sheetInfo)&&(A=X.evaluateFormula),null==(h=e.rows[o]).recordIndex?(H=0,e.cellType===wijmo_grid_1.CellType.ColumnHeader&&e.rows.length>1&&(H=o===r.length?o-1:o)):H=h.recordIndex,l.cells||(l.cells=[]),l.visible=h.isVisible,l.height=h.renderHeight||e.rows.defaultSize,l.groupLevel=d,a&&(l.collapsed=h.isCollapsed),h.wordWrap&&(l.style={wordWrap:h.wordWrap}),(h.constructor===wijmo_grid_1.Row||h.constructor===wijmo_grid_1._NewRowTemplate||softDetail()&&h.constructor===softDetail().DetailRow||softMultiRow()&&h.constructor===softMultiRow()._MultiRow)&&(L=!0),softDetail()&&h.constructor===softDetail().DetailRow&&(O=!0),f=0;f<e.columns.length;f++)if(g=null,W=1,T=1,M=0,B=!1,j=null,I=null,E=null,x=null,D=c._getBindingColumn(e,o,e.columns[f]),R=null,X&&e===c.cells?(S=o*e.columns.length+f,X.mergedRanges&&(R=this._getMergedRange(o,f,X.mergedRanges)),X.styledCells&&(j=X.styledCells[S])):s&&(E=this._getMeasureCell(e,f,i,n),j=(R=c.getMergedRange(e,o,f,!1))?this._getCellStyle(e,E,R.bottomRow,R.rightCol)||{}:this._getCellStyle(e,E,o,f)||{}),R||(R=c.getMergedRange(e,o,f,!1)),R?o===R.topRow&&f===R.leftCol&&(T=R.bottomRow-R.topRow+1,W=this._getColSpan(e,R,u),B=!0):B=!0,!u||u(D)){if(w=r[H]?r[H][f+t]:null,L||a?(_=B?e.getCellData(o,f,!0):null,b=B?e.getCellData(o,f,!1):null,C=!1,v=null,_&&wijmo_1.isString(_)&&_.length>1&&"="===_[0]&&(C=!0),F=wijmo_1.isDate(b),j&&j.format&&null!=b?(g=j.format,/[hsmyt\:]/i.test(g)&&(F=!0),p=mXlsx.Workbook._parseCellFormat(j.format,F)):w&&w.style&&w.style.format?(g=D.format,p=w.style.format):p=null,C&&null!=A&&wijmo_1.isFunction(A)&&(v=A(_)),p||(F?p="m/d/yyyy":wijmo_1.isNumber(b)&&!D.dataMap?p=wijmo_1.isInt(b)?"#,##0":"#,##0.00":C?(k=_.toLowerCase()).indexOf("now()")>-1?(p="m/d/yyyy h:mm",F=!0):k.indexOf("today()")>-1||k.indexOf("date(")>-1?(p="m/d/yyyy",F=!0):k.indexOf("time(")>-1&&(p="h:mm AM/PM",F=!0):p="General")):(_=B?c.columnHeaders.getCellData(0,f,!0):null,p="General"),wijmo_1.isString(_)&&-1!==_.indexOf("<span")&&(x=this._parseToTextRuns(_),_=null),I=this._parseCellStyle(j)||{},e===c.cells&&a&&h.hasChildren&&f===c.columns.firstVisibleIndex){if(C&&null!=v?y=v:_?y=_:B&&(y=h.getGroupHeader().replace(/<\/?\w+>/g,"").replace(/&#39;/g,"'")),null==y&&!j)continue;!(F=wijmo_1.isDate(y))&&g&&"d"===g.toLowerCase()&&wijmo_1.isInt(y)&&(p="0"),y=wijmo_1.isString(y)?mXlsx.Workbook._unescapeXML(y):y,f===c.columns.firstVisibleIndex&&c.treeIndent&&(M=d),N={value:y,isDate:F,formula:C?this._parseToExcelFormula(_,F):null,colSpan:W,rowSpan:T,style:this._extend(I,{format:p,font:{bold:!0},hAlign:mXlsx.HAlign.Left,indent:M}),textRuns:x}}else _=wijmo_1.isString(_)?mXlsx.Workbook._unescapeXML(_):_,b=wijmo_1.isString(b)?mXlsx.Workbook._unescapeXML(b):b,!F&&g&&"d"===g.toLowerCase()&&wijmo_1.isInt(b)&&(p="0"),G=I&&I.hAlign?I.hAlign:w&&w.style&&null!=w.style.hAlign?wijmo_1.asEnum(w.style.hAlign,mXlsx.HAlign,!0):wijmo_1.isDate(b)?mXlsx.HAlign.Left:mXlsx.HAlign.General,f!==c.columns.firstVisibleIndex||!c.treeIndent||G!==mXlsx.HAlign.Left&&G!==mXlsx.HAlign.General||(M=d),N={value:C?v:"General"===p?_:b,isDate:F,formula:C?this._parseToExcelFormula(_,F):null,colSpan:f<c.columns.firstVisibleIndex?1:W,rowSpan:T,style:this._extend(I,{format:p,hAlign:G,vAlign:T>1?e===c.cells||!1===c.centerHeadersVertically?mXlsx.VAlign.Top:mXlsx.VAlign.Center:null,indent:M}),textRuns:x},O&&(z=e.getCellElement(o,f))&&z.appendChild(h.detail);m&&m(new XlsxFormatItemEventArgs(e,new wijmo_grid_1.CellRange(o,f),E,i,n,N)),l.cells.push(N)}return t+f}static _parseCellStyle(e,l=!1){if(null==e)return null;var o=e.fontSize;o=o?+o.substring(0,o.indexOf("px")):null,isNaN(o)&&(o=null);var t=e.fontWeight;t="bold"===t||+t>=700;var r="italic"===e.fontStyle,s=e.textDecorationStyle;null==s&&(s=e.textDecoration),s="underline"===s;var i=e.whiteSpace;return i=!!i&&i.indexOf("pre")>-1,{font:{bold:t,italic:r,underline:s,family:this._parseToExcelFontFamily(e.fontFamily),size:o,color:e.color},fill:{color:e.backgroundColor},borders:this._parseBorder(e,l),hAlign:mXlsx.Workbook._parseStringToHAlign(e.textAlign),wordWrap:i}}static _parseBorder(e,l){var o={};return o.left=this._parseEgdeBorder(e,"Left"),o.right=this._parseEgdeBorder(e,"Right"),o.top=this._parseEgdeBorder(e,"Top"),o.bottom=this._parseEgdeBorder(e,"Bottom"),l&&(o.vertical=this._parseEgdeBorder(e,"Vertical"),o.horizontal=this._parseEgdeBorder(e,"Horizontal")),o}static _parseEgdeBorder(e,l){var o,t=e["border"+l+"Style"],r=e["border"+l+"Width"];if(r&&r.length>2&&(r=+r.substring(0,r.length-2)),t&&"none"!==t&&"hidden"!==t){switch(o={},t=t.toLowerCase()){case"dotted":o.style=r>1?mXlsx.BorderStyle.MediumDashDotted:mXlsx.BorderStyle.Dotted;break;case"dashed":o.style=r>1?mXlsx.BorderStyle.MediumDashed:mXlsx.BorderStyle.Dashed;break;case"double":o.style=mXlsx.BorderStyle.Double;break;default:o.style=r>2?mXlsx.BorderStyle.Thick:r>1?mXlsx.BorderStyle.Medium:mXlsx.BorderStyle.Thin}o.color=e["border"+l+"Color"]}return o}static _parseBorderStyle(e,l,o){var t="border"+l+"Style",r="border"+l+"Width";switch(e){case mXlsx.BorderStyle.Dotted:case mXlsx.BorderStyle.Hair:o[t]="dotted",o[r]="1px";break;case mXlsx.BorderStyle.Dashed:case mXlsx.BorderStyle.ThinDashDotDotted:case mXlsx.BorderStyle.ThinDashDotted:o[t]="dashed",o[r]="1px";break;case mXlsx.BorderStyle.MediumDashed:case mXlsx.BorderStyle.MediumDashDotDotted:case mXlsx.BorderStyle.MediumDashDotted:case mXlsx.BorderStyle.SlantedMediumDashDotted:o[t]="dashed",o[r]="2px";break;case mXlsx.BorderStyle.Double:o[t]="double",o[r]="3px";break;case mXlsx.BorderStyle.Medium:o[t]="solid",o[r]="2px";break;default:o[t]="solid",o[r]="1px"}}static _parseToExcelFontFamily(e){var l;return e&&(l=e.split(","))&&l.length>0&&(e=l[0].replace(/\"|\'/g,"")),e}static _parseToExcelFormula(e,l){var o,t,r,s,i,n,a,d=/\"?\w+\"?\s*\,\s*\"(\w+)\"/i;if(o=e.match(/(floor|ceiling)\([+-]?\d+\.?\d*\)/gi))for(i=0;i<o.length;i++)a=(n=o[i]).substring(0,n.lastIndexOf(")"))+", 1)",e=e.replace(n,a);if(o=null,o=e.match(/text\(\"?\w+\"?\s*\,\s*\"\w+\"\)/gi))for(i=0;i<o.length;i++)(t=(n=o[i]).match(d))&&2===t.length&&(r=t[1],/^d{1,4}?$/.test(r)||(s=mXlsx.Workbook._parseCellFormat(r,l),a=n.replace(r,s),e=e.replace(n,a)));return e}static _parseToTextRuns(e){var l,o,t,r=e.split("<span "),s=[];for(l=0;l<r.length;l++)t=-1!==(o=r[l]).indexOf("</span>")?{text:o.substring(o.indexOf(">")+1,o.indexOf("</span>")),font:this._parseToTextRunFont(o.substring(o.indexOf('style="')+7,o.indexOf(';"')))}:{text:o},s.push(t);return s}static _parseToTextRunFont(e){var l,o,t,r,s,i,n,a,d,u=e.split(";");if(u.length>0){for(l=0;l<u.length;l++)if(2===(o=u[l].split(":")).length)switch(o[1]=o[1].trim(),o[0]){case"font-size":i=+o[1].substring(0,o[1].indexOf("px")),isNaN(i)&&(i=null);break;case"font-weight":t="bold"===o[1]||+o[1]>=700;break;case"font-style":r="italic"===o[1];break;case"text-decoration-style":case"text-decoration":s="underline"===o[1];break;case"font-family":n=this._parseToExcelFontFamily(o[1]);break;case"color":a=o[1]}d={bold:t,italic:r,underline:s,family:n,size:i,color:a}}return d}static _getMeasureCell(e,l,o,t){let r=t[e.cellType],s=r&&r[l],i=null==s;if(s){if(this.hasCssText){s.style;s.style.cssText="",s.style.visibility="hidden"}}else r||(t[e.cellType]=r=[]),r[l]=s=o.cloneNode();return!i&&s.parentElement||(e.hostElement.children.length>0?e.hostElement.children[0].appendChild(s):e.hostElement.appendChild(s)),s}static _getColumnSetting(e,l,o){return null!=e.colspan&&(e=this._getRenderColumn(l,o)),e?{autoWidth:!0,width:e.renderWidth||o.defaultSize,visible:e.visible,style:{format:e.format?mXlsx.Workbook._parseCellFormat(e.format,e.dataType===wijmo_1.DataType.Date):"",hAlign:mXlsx.Workbook._parseStringToHAlign(this._toExcelHAlign(e.getAlignment())),wordWrap:e.wordWrap}}:null}static _toExcelHAlign(e){return(e=e?e.trim().toLowerCase():e)?e.indexOf("center")>-1?"center":e.indexOf("right")>-1||e.indexOf("end")>-1?"right":e.indexOf("justify")>-1?"justify":"left":e}static _getColumnCount(e){for(var l,o=0,t=0,r=0;r<e.length;r++)(l=e[r]&&e[r].cells?e[r].cells:[])&&l.length>0&&(t=l.length,wijmo_1.isInt(l[t-1].colSpan)&&l[t-1].colSpan>1&&(t=t+l[t-1].colSpan-1),t>o&&(o=t));return o}static _getRowCount(e,l){for(var o,t,r=e.length,s=r-1,i=0;i<l;i++)e:for(;s>=0;s--)if((t=((o=e[s])&&o.cells?o.cells:[])[i])&&(null!=t.value&&""!==t.value||wijmo_1.isInt(t.rowSpan)&&t.rowSpan>1)){wijmo_1.isInt(t.rowSpan)&&t.rowSpan>1&&s+t.rowSpan>r&&(r=s+t.rowSpan);break e}return r}static _numAlpha(e){var l=Math.floor(e/26)-1;return(l>-1?this._numAlpha(l):"")+String.fromCharCode(65+e%26)}static _getItemType(e){return null==e||null==e.value||isNaN(e.value)?null:wijmo_1.getType(e.value)}static _setColumn(e,l,o){var t,r,s,i=e[l];i?(t=this._getItemType(o),i.dataType!==t&&i.dataType===wijmo_1.DataType.Boolean&&t!==wijmo_1.DataType.Boolean&&(i.dataType=t),!o||null==o.value||wijmo_1.isString(o.value)&&wijmo_1.isNullOrWhiteSpace(o.value)||(r=mXlsx.Workbook._parseExcelFormat(o))&&i.format!==r&&"General"!==r&&(i.format=r),o&&o.style&&(o.style.hAlign&&(s=mXlsx.Workbook._parseHAlignToString(wijmo_1.asEnum(o.style.hAlign,mXlsx.HAlign))),null==i.wordWrap?i.wordWrap=!!o.style.wordWrap:i.wordWrap=i.wordWrap&&!!o.style.wordWrap),s||t!==wijmo_1.DataType.Number||(s="right"),i.hAlign=s):e[l]={dataType:this._getItemType(o),format:mXlsx.Workbook._parseExcelFormat(o),hAlign:"",wordWrap:null}}static _getItemValue(e){if(null==e||null==e.value)return null;var l=e.value;return wijmo_1.isNumber(l)&&isNaN(l)?"":l instanceof Date&&isNaN(l.getTime())?"":l}static _getCellStyle(e,l,o,t){try{e.grid.cellFactory.updateCell(e,o,t,l),l.className=l.className.replace("wj-state-selected",""),l.className=l.className.replace("wj-state-multi-selected","")}catch(e){return null}return window.getComputedStyle(l)}static _parseTextRunsToHTML(e){var l,o,t,r;for(t="",r=0;r<e.length;r++)t+=(o=(l=e[r]).font)?'<span style="'+(o.bold?"font-weight: bold;":"")+(o.italic?"font-style: italic;":"")+(o.underline?"text-decoration: underline;":"")+(o.family?"font-family: "+o.family+";":"")+(null!=o.size?"font-size: "+o.size+"px;":"")+(o.color?"color: "+o.color+";":"")+'">'+l.text+"</span>":l.text;return t}static _extend(e,l){for(var o in l){var t=l[o];wijmo_1.isObject(t)&&e[o]?wijmo_1.copy(e[o],t):e[o]=t}return e}static _checkParentCollapsed(e,l){var o=!1;return Object.keys(e).forEach(t=>{!0===e[t]&&!1===o&&!isNaN(l)&&+t<l&&(o=!0)}),o}static _getColSpan(e,l,o){for(var t=0,r=l.leftCol;r<=l.rightCol;r++)o&&!o(e.columns[r])||t++;return t}static _getRenderColumn(e,l){return e>=l.length?null:l[e]}static _getMergedRange(e,l,o){let t,r;for(t=0;t<o.length;t++)if(e>=(r=o[t]).topRow&&e<=r.bottomRow&&l>=r.leftCol&&l<=r.rightCol)return r;return null}}exports.FlexGridXlsxConverter=FlexGridXlsxConverter;class XlsxFormatItemEventArgs extends wijmo_grid_1.CellRangeEventArgs{constructor(e,l,o,t,r,s){super(e,l),this._cell=o,this._patternCell=t,this._xlsxCell=s,this._cellsCache=r}get cell(){return this._cell}get xlsxCell(){return this._xlsxCell}set xlsxCell(e){this._xlsxCell=e}getFormattedCell(){return this._cell||(this._cell=FlexGridXlsxConverter._getMeasureCell(this.panel,this.col,this._patternCell,this._cellsCache),FlexGridXlsxConverter._getCellStyle(this.panel,this._cell,this.row,this.col)),this._cell}}exports.XlsxFormatItemEventArgs=XlsxFormatItemEventArgs,wijmo_1._registerModule("wijmo.grid.xlsx",selfModule);