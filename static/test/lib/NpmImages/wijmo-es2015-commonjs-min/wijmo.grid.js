/*!
    *
    * Wijmo Library 5.20191.603
    * http://wijmo.com/
    *
    * Copyright(c) GrapeCity, Inc.  All rights reserved.
    *
    * Licensed under the GrapeCity Commercial License.
    * sales@wijmo.com
    * wijmo.com/products/wijmo-5/license/
    *
    */

"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const wijmo_1=require("wijmo/wijmo"),mInput=require("wijmo/wijmo.input"),selfModule=require("wijmo/wijmo.grid");class DataMap{constructor(e,t,i){if(this.mapChanged=new wijmo_1.Event,wijmo_1.isArray(e)&&!t&&!i){let s=[];for(let t=0;t<e.length;t++)s.push({value:e[t]});e=s,t=i="value"}this._cv=wijmo_1.asCollectionView(e),this._keyPath=wijmo_1.asString(t,!1),this._displayPath=wijmo_1.asString(i,!1),this._cv.collectionChanged.addHandler(this.onMapChanged,this)}get sortByDisplayValues(){return 1!=this._sortByKey}set sortByDisplayValues(e){this._sortByKey=!wijmo_1.asBoolean(e)}get collectionView(){return this._cv}get selectedValuePath(){return this._keyPath}get displayMemberPath(){return this._displayPath}getKeyValue(e){let t=this._displayPath,i=this._indexOf(e,t,!0);return i<0&&(i=this._indexOf(e,t,!1)),i>-1?this._cv.sourceCollection[i][this._keyPath]:null}getDisplayValue(e){if(!this._hash){this._hash={};let e=this._cv.sourceCollection;if(e&&this._keyPath&&this._displayPath)for(let t=e.length-1;t>=0;t--){let i=e[t],s=i[this._keyPath],l=i[this._displayPath];this._hash[s]=l}}let t=this._hash[e];return null!=t?t:e}getDisplayValues(e){let t=[];if(this._cv&&this._displayPath){let e=this._cv.items;for(let i=0;i<e.length;i++)t.push(e[i][this._displayPath])}return t}getKeyValues(){let e=[];if(this._cv&&this._keyPath){let t=this._cv.items;for(let i=0;i<t.length;i++)e.push(t[i][this._keyPath])}return e}get isEditable(){return this._editable}set isEditable(e){this._editable=wijmo_1.asBoolean(e)}onMapChanged(e){this._hash=null,this.mapChanged.raise(this,e)}_indexOf(e,t,i){let s=-1,l=-1;if(this._cv&&t){let o=null!=e?e.toString():"",n=i?o:o.toLowerCase(),r=this._cv.sourceCollection;for(let a=0;a<r.length;a++){let h=r[a],d=h[t];if(d==e?s=a:i||d.length!=n.length||d.toLowerCase()!=n?null!=d&&d.toString()==o&&(s=a):s=a,s==a){if(!this._cv.filter||this._cv.filter(h))return s;l<0&&(l=s)}}}return l}}exports.DataMap=DataMap;class CellRange{constructor(e=-1,t=-1,i=e,s=t){this.setRange(e,t,i,s)}setRange(e=-1,t=-1,i=e,s=t){this._row=wijmo_1.asInt(e),this._col=wijmo_1.asInt(t),this._row2=wijmo_1.asInt(i),this._col2=wijmo_1.asInt(s)}get row(){return this._row}set row(e){this._row=wijmo_1.asInt(e)}get col(){return this._col}set col(e){this._col=wijmo_1.asInt(e)}get row2(){return this._row2}set row2(e){this._row2=wijmo_1.asInt(e)}get col2(){return this._col2}set col2(e){this._col2=wijmo_1.asInt(e)}clone(){return new CellRange(this._row,this._col,this._row2,this._col2)}copy(e){this.setRange(e._row,e._col,e._row2,e._col2)}get rowSpan(){return Math.abs(this._row2-this._row)+1}get columnSpan(){return Math.abs(this._col2-this._col)+1}get topRow(){return Math.min(this._row,this._row2)}get bottomRow(){return Math.max(this._row,this._row2)}get leftCol(){return Math.min(this._col,this._col2)}get rightCol(){return Math.max(this._col,this._col2)}get isValid(){return this._row>-1&&this._col>-1&&this._row2>-1&&this._col2>-1}get isSingleCell(){return this._row==this._row2&&this._col==this._col2}contains(e,t){let i=wijmo_1.tryCast(e,CellRange);if(i)return i.topRow>=this.topRow&&i.bottomRow<=this.bottomRow&&i.leftCol>=this.leftCol&&i.rightCol<=this.rightCol;if(wijmo_1.isInt(e)&&wijmo_1.isInt(t))return e>=this.topRow&&e<=this.bottomRow&&t>=this.leftCol&&t<=this.rightCol;throw"contains expects a CellRange or row/column indices."}containsRow(e){return wijmo_1.asInt(e)>=this.topRow&&e<=this.bottomRow}containsColumn(e){return wijmo_1.asInt(e)>=this.leftCol&&e<=this.rightCol}intersects(e){return this.intersectsRow(e)&&this.intersectsColumn(e)}intersectsRow(e){return e&&!(this.bottomRow<e.topRow||this.topRow>e.bottomRow)}intersectsColumn(e){return e&&!(this.rightCol<e.leftCol||this.leftCol>e.rightCol)}getRenderSize(e){let t=new wijmo_1.Size(0,0);if(this.isValid){for(let i=this.topRow;i<=this.bottomRow;i++)t.height+=e.rows[i].renderSize;for(let i=this.leftCol;i<=this.rightCol;i++)t.width+=e.columns[i].renderSize}return t}equals(e){return e instanceof CellRange&&this._row==e._row&&this._col==e._col&&this._row2==e._row2&&this._col2==e._col2}}exports.CellRange=CellRange;class CellRangeEventArgs extends wijmo_1.CancelEventArgs{constructor(e,t,i){super(),this._p=wijmo_1.asType(e,GridPanel,!0),this._rng=wijmo_1.asType(t,CellRange,!0),this._data=i}get panel(){return this._p}get range(){return this._rng.clone()}get row(){return this._rng.row}get col(){return this._rng.col}get data(){return this._data}set data(e){this._data=e}}exports.CellRangeEventArgs=CellRangeEventArgs;class FormatItemEventArgs extends CellRangeEventArgs{constructor(e,t,i){super(e,t),this._cell=wijmo_1.asType(i,HTMLElement)}get cell(){return this._cell}}exports.FormatItemEventArgs=FormatItemEventArgs;class CellEditEndingEventArgs extends CellRangeEventArgs{constructor(){super(...arguments),this._stayInEditMode=!1,this._refresh=!0}get stayInEditMode(){return this._stayInEditMode}set stayInEditMode(e){this._stayInEditMode=wijmo_1.asBoolean(e)}get refresh(){return this._refresh}set refresh(e){this._refresh=wijmo_1.asBoolean(e)}}var SelectionMode,SelectedState,SelMove,RowColFlags,HeadersVisibility,KeyAction,CellType,AllowMerging;exports.CellEditEndingEventArgs=CellEditEndingEventArgs,function(e){e[e.None=0]="None",e[e.Cell=1]="Cell",e[e.CellRange=2]="CellRange",e[e.Row=3]="Row",e[e.RowRange=4]="RowRange",e[e.ListBox=5]="ListBox"}(SelectionMode=exports.SelectionMode||(exports.SelectionMode={})),function(e){e[e.None=0]="None",e[e.Selected=1]="Selected",e[e.Cursor=2]="Cursor",e[e.Active=3]="Active"}(SelectedState=exports.SelectedState||(exports.SelectedState={})),function(e){e[e.None=0]="None",e[e.Next=1]="Next",e[e.Prev=2]="Prev",e[e.NextPage=3]="NextPage",e[e.PrevPage=4]="PrevPage",e[e.Home=5]="Home",e[e.End=6]="End",e[e.NextCell=7]="NextCell",e[e.PrevCell=8]="PrevCell"}(SelMove=exports.SelMove||(exports.SelMove={}));class _SelectionHandler{constructor(e){this._sel=new CellRange(0,0),this._mode=SelectionMode.CellRange,this._rng=new CellRange(0,0),this._g=e,this._e=new CellRangeEventArgs(e.cells,this._rng)}get selectionMode(){return this._mode}set selectionMode(e){if(e!=this._mode){let t=SelectionMode;switch(e!=t.ListBox&&this._mode!=t.ListBox||this._g.rows.forEach((t,i)=>{let s=e==SelectionMode.ListBox&&this._sel.containsRow(i);t._setFlag(RowColFlags.Selected,s,!0)}),e){case t.None:this._sel.setRange(-1,-1);break;case t.Cell:this._sel.row2=this._sel.row,this._sel.col2=this._sel.col;break;case t.Row:this._sel.row2=this._sel.row}this._mode=e,this._g.invalidate()}}get selection(){return this._sel}set selection(e){this.select(e)}select(e,t=!0){wijmo_1.isNumber(e)&&wijmo_1.isNumber(t)?(this._rng.setRange(e,t),t=!0):e instanceof CellRange?this._rng.copy(e):wijmo_1.assert(!1,"CellRange expected");let i=this._g,s=this._sel,l=this._rng,o=!1,n=SelectionMode;switch(i.selectionMode){case n.Cell:l.row2=l.row,l.col2=l.col;break;case n.Row:l.row2=l.row;break;case n.ListBox:o=!0}let r=l.equals(s);if(o&&l.row>-1&&!i.rows[l.row].isSelected&&(r=!1),r)return void(t&&this._showSelection());let a=this._e;if(a._rng=l,a.cancel=!1,i.onSelectionChanging(a)){if(o&&(l.row!=s.row||l.rowSpan>1||s.rowSpan>1)&&i.rows.forEach((e,t)=>{e._setFlag(RowColFlags.Selected,l.containsRow(t),!0)}),l.row=Math.min(l.row,i.rows.length-1),l.row2=Math.min(l.row2,i.rows.length-1),this._sel.copy(l),i.refreshCells(!1,!0,!0),t&&this._showSelection(),i.collectionView){let e=i._getCvIndex(l.row);i.collectionView.moveCurrentToPosition(e)}i.onSelectionChanged(a)}}moveSelection(e,t,i){let s=this._g,l=this._sel,o=i&&s.anchorCursor?new CellRange(l.row2,l.col2):new CellRange(l.row,l.col);this._adjustReferenceCell(o,e,t);let n=o.row,r=o.col,a=s.rows,h=s.columns,d=Math.max(0,s._szClient.height-s.columnHeaders.height),_=SelMove;switch(t){case _.NextCell:(r=h.getNextCell(r,_.Next,d))==o.col&&(n=a.getNextCell(n,_.Next,d))>o.row&&(r=h.getNextCell(0,_.Next,d),r=h.getNextCell(r,_.Prev,d)),s.select(n,r);break;case _.PrevCell:(r=h.getNextCell(o.col,_.Prev,d))==o.col&&(n=a.getNextCell(n,_.Prev,d))<o.row&&(r=h.getNextCell(h.length-1,_.Prev,d),r=h.getNextCell(r,_.Next,d)),s.select(n,r);break;default:n=a.getNextCell(n,e,d),r=h.getNextCell(r,t,d),i?s.selection=s.anchorCursor?new CellRange(l.row,l.col,n,r):new CellRange(n,r,l.row2,l.col2):s.select(n,r)}}_showSelection(){let e=this._g,t=this._sel;e.anchorCursor?e.scrollIntoView(t.row2,t.col2):e.scrollIntoView(t.row,t.col)}_adjustReferenceCell(e,t,i){let s=this._g,l=s.getMergedRange(s.cells,e.row,e.col);if(l&&!l.isSingleCell){let s=SelMove;switch(t){case s.Next:case s.NextCell:e.row=l.bottomRow;break;case s.Prev:case s.PrevCell:e.row=l.topRow}switch(i){case s.Next:case s.NextCell:e.col=l.rightCol;break;case s.Prev:case s.PrevCell:e.col=l.leftCol}}}}exports._SelectionHandler=_SelectionHandler,function(e){e[e.Visible=1]="Visible",e[e.AllowResizing=2]="AllowResizing",e[e.AllowDragging=4]="AllowDragging",e[e.AllowMerging=8]="AllowMerging",e[e.AllowSorting=16]="AllowSorting",e[e.AutoGenerated=32]="AutoGenerated",e[e.Collapsed=64]="Collapsed",e[e.ParentCollapsed=128]="ParentCollapsed",e[e.Selected=256]="Selected",e[e.ReadOnly=512]="ReadOnly",e[e.HtmlContent=1024]="HtmlContent",e[e.WordWrap=2048]="WordWrap",e[e.MultiLine=4096]="MultiLine",e[e.HasTemplate=8192]="HasTemplate",e[e.RowDefault=3]="RowDefault",e[e.ColumnDefault=23]="ColumnDefault"}(RowColFlags=exports.RowColFlags||(exports.RowColFlags={}));class RowCol{constructor(){this._pos=0,this._idx=-1,this._vidx=-1,this.gridChanged=new wijmo_1.Event}get dataType(){return this._type}set dataType(e){e=wijmo_1.asEnum(e,wijmo_1.DataType,!0),this._type!=e&&(this._type=e,this.grid&&this.grid.invalidate())}get inputType(){return this._inpType}set inputType(e){this._inpType=wijmo_1.asString(e,!0)}get mask(){return this._mask}set mask(e){this._mask=wijmo_1.asString(e,!0)}get maxLength(){return this._maxLen}set maxLength(e){this._maxLen=wijmo_1.asNumber(e,!0,!0)}get align(){return this._align}set align(e){this._align!=e&&(this._align=e,this.onPropertyChanged())}get format(){return this._fmt}set format(e){this._fmt!=e&&(this._fmt=e,this.onPropertyChanged())}get dataMap(){return this._map}set dataMap(e){this._map!=e&&(this._map&&this._map.mapChanged.removeHandler(this.onPropertyChanged,this),wijmo_1.isArray(e)&&(e=new DataMap(e,null,null)),this._map=wijmo_1.asType(e,DataMap,!0),this._map&&this._map.mapChanged.addHandler(this.onPropertyChanged,this),this.onPropertyChanged())}get showDropDown(){return this._showDropDown}set showDropDown(e){e!=this._showDropDown&&(this._showDropDown=wijmo_1.asBoolean(e,!0),this.grid&&this.grid.invalidate())}get dropDownCssClass(){return this._ddCssClass}set dropDownCssClass(e){this._ddCssClass=wijmo_1.asString(e)}get visible(){return this._getFlag(RowColFlags.Visible)}set visible(e){this._setFlag(RowColFlags.Visible,e)}get isVisible(){return!!this._getFlag(RowColFlags.Visible)&&(!this._getFlag(RowColFlags.ParentCollapsed)||this instanceof _NewRowTemplate)}get pos(){return this._list&&this._list._dirty&&this._list._update(),this._pos}get index(){return this._list&&this._list._dirty&&this._list._update(),this._idx}get visibleIndex(){return this._list&&this._list._dirty&&this._list._update(),this.isVisible?this._vidx:-1}get size(){return this._sz}set size(e){e!=this._sz&&(this._sz=wijmo_1.asNumber(e,!0),this.onPropertyChanged())}get renderSize(){let e=0,t=this._list;return this.isVisible&&((null==(e=this._sz)||e<0)&&(e=t?t.defaultSize:0),t&&null!=t.minSize&&e<t.minSize&&(e=t.minSize),t&&null!=t.maxSize&&e>t.maxSize&&(e=t.maxSize),null!=this._szMin&&e<this._szMin&&(e=this._szMin),null!=this._szMax&&e>this._szMax&&(e=this._szMax)),e}get allowResizing(){return this._getFlag(RowColFlags.AllowResizing)}set allowResizing(e){this._setFlag(RowColFlags.AllowResizing,e)}get allowDragging(){return this._getFlag(RowColFlags.AllowDragging)}set allowDragging(e){this._setFlag(RowColFlags.AllowDragging,e)}get allowMerging(){return this._getFlag(RowColFlags.AllowMerging)}set allowMerging(e){this._setFlag(RowColFlags.AllowMerging,e)}get isSelected(){return this._getFlag(RowColFlags.Selected)}set isSelected(e){if(this._setFlag(RowColFlags.Selected,e,!0)){let e=this.grid;e&&e.refreshCells(!1,!0,!0)}}get isReadOnly(){return this._getFlag(RowColFlags.ReadOnly)}set isReadOnly(e){this._setFlag(RowColFlags.ReadOnly,e)}get isRequired(){return this._required}set isRequired(e){this._required=wijmo_1.asBoolean(e,!0)}get isContentHtml(){return this._getFlag(RowColFlags.HtmlContent)}set isContentHtml(e){this.isContentHtml!=e&&(this._setFlag(RowColFlags.HtmlContent,e),this.grid&&this.grid.invalidate())}get wordWrap(){return this._getFlag(RowColFlags.WordWrap)}set wordWrap(e){this._setFlag(RowColFlags.WordWrap,e)}get multiLine(){return this._getFlag(RowColFlags.MultiLine)}set multiLine(e){this._setFlag(RowColFlags.MultiLine,e)}get cssClass(){return this._cssClass}set cssClass(e){e!=this._cssClass&&(this._cssClass=wijmo_1.asString(e),this.grid&&this.grid.invalidate())}get cssClassAll(){return this._cssClassAll}set cssClassAll(e){e!=this._cssClassAll&&(this._cssClassAll=wijmo_1.asString(e),this.grid&&this.grid.invalidate())}get grid(){return this._list?this._list._g:null}get collectionView(){return this.grid?this.grid.collectionView:null}onPropertyChanged(){this._list&&(this._list._dirty=!0,this.grid.invalidate())}onGridChanged(e){this.gridChanged.raise(this,e)}_setList(e){e!=this._list&&(this._list=e,this.onGridChanged())}_getFlag(e){return 0!=(this._f&e)}_setFlag(e,t,i){return t!=this._getFlag(e)&&(this._f=t?this._f|e:this._f&~e,i||this.onPropertyChanged(),!0)}}exports.RowCol=RowCol;class Column extends RowCol{constructor(e){super(),this._f=RowColFlags.ColumnDefault,this._hash=Column._ctr.toString(36),Column._ctr++,e&&wijmo_1.copy(this,e)}get name(){return this._name}set name(e){this._name=e}get binding(){return this._binding?this._binding.path:null}set binding(e){if(e!=this.binding){let t=wijmo_1.asString(e);if(this._binding=t?new wijmo_1.Binding(t):null,!this._type&&this.grid&&this._binding){let e=this.grid.collectionView;if(e&&e.sourceCollection&&e.sourceCollection.length){let t=e.sourceCollection[0];this._type=wijmo_1.getType(this._binding.getValue(t))}}this.onPropertyChanged()}}get sortMemberPath(){return this._bindingSort?this._bindingSort.path:null}set sortMemberPath(e){if(e!=this.sortMemberPath){let t=wijmo_1.asString(e);this._bindingSort=t?new wijmo_1.Binding(t):null,this.onPropertyChanged()}}get width(){return null!=this._szStar?this._szStar:this.size}set width(e){null!=Column._parseStarSize(e)?(this._szStar=e,this.onPropertyChanged()):(this._szStar=null,this.size=wijmo_1.asNumber(e,!0))}get minWidth(){return this._szMin}set minWidth(e){e!=this._szMin&&(this._szMin=wijmo_1.asNumber(e,!0,!0),this.onPropertyChanged())}get maxWidth(){return this._szMax}set maxWidth(e){e!=this._szMax&&(this._szMax=wijmo_1.asNumber(e,!0,!0),this.onPropertyChanged())}get quickAutoSize(){return this._quickSize}set quickAutoSize(e){this._quickSize=wijmo_1.asBoolean(e,!0)}_getQuickAutoSize(){return!!this.grid._getQuickAutoSize()&&(wijmo_1.isBoolean(this._quickSize)?this._quickSize:!(this.isContentHtml||this.wordWrap||this.multiLine||this._getFlag(RowColFlags.HasTemplate)))}get renderWidth(){return this.renderSize}get header(){return this._hdr?this._hdr:this.binding}set header(e){this._hdr!=e&&(this._hdr=e,this.onPropertyChanged())}get allowSorting(){return this._getFlag(RowColFlags.AllowSorting)}set allowSorting(e){this._setFlag(RowColFlags.AllowSorting,e)}get currentSort(){let e=this.grid?this.grid.collectionView:null,t=e?e.sortDescriptions:null,i=t&&t.length?this._getBindingSort():null;if(i)for(let e=0;e<t.length;e++)if(t[e].property==i)return t[e].ascending?"+":"-";return null}get aggregate(){return null!=this._agg?this._agg:wijmo_1.Aggregate.None}set aggregate(e){(e=wijmo_1.asEnum(e,wijmo_1.Aggregate))!=this._agg&&(this._agg=e,this.onPropertyChanged())}get describedById(){return this._descById}set describedById(e){e!=this._descById&&(this._descById=wijmo_1.asString(e),this.grid&&this.grid.invalidate())}getIsRequired(e){return null!=this._required?this._required:e&&null!=e.isRequired?e.isRequired:this.dataType==wijmo_1.DataType.String?null!=this.dataMap||null!=this._mask&&this._mask.length>0:!e||e.dataType!=wijmo_1.DataType.String||(null!=e.dataMap||null!=e.mask&&e.mask.length>0)}getAlignment(e){if(null!=this._align)return this._align;if(e&&null!=e.align)return e.align;if(!this._map)switch(this.dataType){case wijmo_1.DataType.Boolean:return"center";case wijmo_1.DataType.Number:return"right"}if(e&&!e.dataMap)switch(e.dataType){case wijmo_1.DataType.Boolean:return"center";case wijmo_1.DataType.Number:return"right"}return""}_getBindingSort(){return this.sortMemberPath?this.sortMemberPath:this.binding?this.binding:null}static _parseStarSize(e){if(wijmo_1.isString(e)&&e.length>0&&"*"==e[e.length-1]){let t=1==e.length?1:1*e.substr(0,e.length-1);if(t>0&&!isNaN(t))return t}return null}}Column._ctr=0,exports.Column=Column;class Row extends RowCol{constructor(e){super(),this._f=RowColFlags.ColumnDefault,this._data=e}get dataItem(){return this._data}set dataItem(e){this._data=e}get height(){return this.size}set height(e){this.size=e}get renderHeight(){return this.renderSize}}exports.Row=Row;class GroupRow extends Row{constructor(){super(),this._level=-1,this.isReadOnly=!0}get level(){return this._level}set level(e){wijmo_1.asInt(e),e!=this._level&&(this._level=e,this.onPropertyChanged())}get hasChildren(){if(null!=this.grid&&null!=this._list){this._list._update();let e=this.index<this._list.length-1?this._list[this.index+1]:null,t=wijmo_1.tryCast(e,GroupRow),i=wijmo_1.tryCast(e,_NewRowTemplate);return null!=e&&null==i&&(null==t||t.level>this.level)}return!0}get isCollapsed(){return this._getFlag(RowColFlags.Collapsed)}set isCollapsed(e){wijmo_1.asBoolean(e),e!=this.isCollapsed&&null!=this._list&&this._setCollapsed(e)}getGroupHeader(){let e=this.grid,t=e.groupHeaderFormat||wijmo_1.culture.FlexGrid.groupHeaderFormat,i=wijmo_1.tryCast(this.dataItem,wijmo_1.CollectionViewGroup);if(i&&t&&e.showGroups&&!e.childItemsPath){let s=i.groupDescription.propertyName,l=i.name,o=e.getColumn(s),n=this.isContentHtml;o?(n=n||o.isContentHtml,o.header&&(s=o.header),o.dataMap?l=o.dataMap.getDisplayValue(l):o.format&&(l=wijmo_1.Globalize.format(l,o.format))):s=wijmo_1.toHeaderCase(s);let r=i.getAggregate(wijmo_1.Aggregate.CntAll,null,e.collectionView);return wijmo_1.format(t,{name:wijmo_1.escapeHtml(s),value:n?l:wijmo_1.escapeHtml(l),level:i.level,count:r})}return""}_setCollapsed(e){let t=this.grid,i=t.rows,s=this.getCellRange(),l=new CellRangeEventArgs(t.cells,new CellRange(this.index,-1));t.onGroupCollapsedChanging(l)&&(t.deferUpdate(()=>{i.deferUpdate(()=>{this._setFlag(RowColFlags.Collapsed,e,!0);for(let t=s.topRow+1;t<=s.bottomRow&&t>-1&&t<i.length;t++){i[t]._setFlag(RowColFlags.ParentCollapsed,e,!0);let s=i[t];s instanceof GroupRow&&s.isCollapsed&&(t=s.getCellRange().bottomRow)}})}),t.onGroupCollapsedChanged(l))}getCellRange(){let e=this._list,t=this.index,i=e.length-1;for(let s=t+1;s<=i;s++){let t=wijmo_1.tryCast(e[s],GroupRow);if(null!=t&&t.level<=this.level){i=s-1;break}}return new CellRange(t,0,i,this.grid.columns.length-1)}}exports.GroupRow=GroupRow;class RowColCollection extends wijmo_1.ObservableArray{constructor(e,t){super(),this._frozen=0,this._lastFrozen=-1,this._firstVisible=-1,this._vlen=0,this._szDef=28,this._szTot=0,this._szCustom=!1,this._dirty=!1,this._g=wijmo_1.asType(e,FlexGrid),this._szDef=wijmo_1.asNumber(t,!1,!0)}get grid(){return this._g}get defaultSize(){return this._szDef}set defaultSize(e){this._szCustom=!0,this._szDef!=e&&(this._szDef=wijmo_1.asNumber(e,!1,!0),this._dirty=!0,this._g.invalidate())}get frozen(){return this._frozen}set frozen(e){e!=this._frozen&&(this._frozen=wijmo_1.asNumber(e,!1,!0),this._dirty=!0,this._g.invalidate())}isFrozen(e){return e<this.frozen}get minSize(){return this._szMin}set minSize(e){e!=this._szMin&&(this._szMin=wijmo_1.asNumber(e,!0,!0),this._dirty=!0,this._g.invalidate())}get maxSize(){return this._szMax}set maxSize(e){e!=this._szMax&&(this._szMax=wijmo_1.asNumber(e,!0,!0),this._dirty=!0,this._g.invalidate())}getTotalSize(){return this._dirty&&this._update(),this._szTot}get visibleLength(){return this._dirty&&this._update(),this._vlen}getItemAt(e){if(this._dirty&&this._update(),e<=0&&this.length>0&&this[0].renderSize)return 0;e=Math.round(e);let t,i,s=this.length,l=0,o=s-1;for(;l<=o;)if((i=this[t=l+o>>>1])._pos>e&&t>0)o=t-1;else{if(!(i._pos+i.renderSize<=e&&t<s-1)){for(;t>0&&!this[t].renderSize;)t--;for(;t<s-1&&!this[t].renderSize;)t++;return t}l=t+1}return o}getNextCell(e,t,i){let s,l=SelMove;switch(t){case l.Next:for(s=e+1;s<this.length;s++)if(this[s].renderSize>0)return s;break;case l.Prev:for(s=e-1;s>=0;s--)if(this[s].renderSize>0)return s;break;case l.End:for(s=this.length-1;s>=0;s--)if(this[s].renderSize>0)return s;break;case l.Home:for(s=0;s<this.length;s++)if(this[s].renderSize>0)return s;break;case l.NextPage:return(s=this.getItemAt(this[e].pos+this[e].renderSize+i))<0?this.getNextCell(e,SelMove.End,i):s==e&&s<this.length-1&&this[s+1].renderSize?s+1:s;case l.PrevPage:return(s=this.getItemAt(this[e].pos-i))<0?this.getNextCell(e,SelMove.Home,i):s==e&&s>0&&this[s-1].renderSize?s-1:s}return e}canMoveElement(e,t){if(t==e)return!1;if(e<0||e>=this.length||t>=this.length)return!1;t<0&&(t=this.length-1);let i=Math.min(e,t),s=Math.max(e,t);for(let e=i;e<=s;e++)if(!this[e].allowDragging)return!1;return!(this[t]instanceof _NewRowTemplate)}moveElement(e,t){if(this.canMoveElement(e,t)){let i=this[e];this.removeAt(e),t<0&&(t=this.length),this.insert(t,i)}}onCollectionChanged(e=wijmo_1.NotifyCollectionChangedEventArgs.reset){this._dirty=!0,this._g.invalidate(),super.onCollectionChanged(e)}push(e){return e._setList(this),super.push(e)}splice(e,t,i){for(let i=0;i<t;i++){let t=this[e+i];t&&t._setList(null)}return i&&i._setList(this),super.splice(e,t,i)}beginUpdate(){this._update(),super.beginUpdate()}_setDefaultSize(e){this._szCustom||(this.defaultSize=e,this._szCustom=!1)}_update(){if(this._dirty&&!this.isUpdating){this._dirty=!1,this._lastFrozen=-1,this._firstVisible=-1;let e,t,i=0,s=0;for(let l=0;l<this.length;l++)(t=this[l])._idx=l,t._vidx=i,t._pos=s,t._setList(this),(e=t.renderSize)>0&&(s+=e,i++,l<this._frozen&&(this._lastFrozen=l)),this._firstVisible<0&&t.visible&&(this._firstVisible=l);return this._vlen=i,this._szTot=s,!0}return!1}}exports.RowColCollection=RowColCollection;class ColumnCollection extends RowColCollection{getColumn(e){let t=wijmo_1.isNumber(e)?e:this.indexOf(e);return t>-1?this[t]:null}indexOf(e){if(e instanceof Column)return super.indexOf(e);for(let t=0;t<this.length;t++)if(this[t].name==e)return t;for(let t=0;t<this.length;t++)if(this[t].binding==e)return t;return-1}get describedById(){return this._descById}set describedById(e){e!=this._descById&&(this._descById=wijmo_1.asString(e),this._g&&this._g.invalidate())}get firstVisibleIndex(){return this._dirty&&this._update(),this._firstVisible}_updateStarSizes(e){let t,i=0;for(let s=0;s<this.length;s++){let l=this[s];l.isVisible&&(l._szStar?(i+=Column._parseStarSize(l._szStar),t=l):e-=l.renderWidth)}if(t){let s=e;for(let l=0;l<this.length;l++){let o=this[l];o.isVisible&&o._szStar&&(o==t&&s>0?o._sz=s:(o._sz=Math.max(0,Math.round(Column._parseStarSize(o._szStar)/i*e)),s-=o.renderWidth))}return this._dirty=!0,this._update(),!0}return!1}}exports.ColumnCollection=ColumnCollection;class RowCollection extends RowColCollection{constructor(){super(...arguments),this._maxLevel=-1}get ariaLabel(){return this._ariaLabel}set ariaLabel(e){e!=this.ariaLabel&&(this._ariaLabel=wijmo_1.asString(e),this._g&&this._g.refresh())}get maxGroupLevel(){return this._dirty&&this._update(),this._maxLevel}_update(){if(super._update()){this._maxLevel=-1;for(let e=0;e<this.length;e++){let t=wijmo_1.tryCast(this[e],GroupRow);t&&t.level>this._maxLevel&&(this._maxLevel=t.level)}return!0}return!1}}exports.RowCollection=RowCollection,wijmo_1._addCultureInfo("FlexGrid",{groupHeaderFormat:"{name}: <b>{value}</b> ({count:n0} items)",ariaLabels:{toggleDropDown:"Toggle Dropdown",toggleGroup:"Toggle Group"}}),function(e){e[e.None=0]="None",e[e.Column=1]="Column",e[e.Row=2]="Row",e[e.All=3]="All"}(HeadersVisibility=exports.HeadersVisibility||(exports.HeadersVisibility={}));class FlexGrid extends wijmo_1.Control{constructor(e,t){super(e,null,!0),this._szClient=new wijmo_1.Size(0,0),this._ptScrl=new wijmo_1.Point(0,0),this._cellPadLeft=3,this._cellPadVert=0,this._clipToScreen=!1,this._autoGenCols=!0,this._autoClipboard=!0,this._autoScroll=!0,this._autoSearch=!1,this._readOnly=!1,this._indent=14,this._autoSizeMode=AutoSizeMode.Both,this._hdrVis=HeadersVisibility.All,this._alSorting=!0,this._alAddNew=!1,this._alDelete=!1,this._alResizing=AllowResizing.Columns,this._alDragging=AllowDragging.Columns,this._alMerging=AllowMerging.None,this._ssHdr=HeadersVisibility.None,this._shSort=!0,this._shGroups=!0,this._altStep=1,this._shErr=!0,this._shDropDown=!0,this._valEdt=!0,this._deferResizing=!1,this._pSel=!0,this._pOutline=!0,this._stickyHdr=!1,this._anchorCursor=!1,this._vt=0,this._vtRows=0,this._vtCols=0,this._reorderCells=!0,this._refreshOnEdit=!0,this._lazyRender=!1,this.itemsSourceChanging=new wijmo_1.Event,this.itemsSourceChanged=new wijmo_1.Event,this.scrollPositionChanged=new wijmo_1.Event,this.selectionChanging=new wijmo_1.Event,this.selectionChanged=new wijmo_1.Event,this.loadingRows=new wijmo_1.Event,this.loadedRows=new wijmo_1.Event,this.updatingLayout=new wijmo_1.Event,this.updatedLayout=new wijmo_1.Event,this.resizingColumn=new wijmo_1.Event,this.resizedColumn=new wijmo_1.Event,this.autoSizingColumn=new wijmo_1.Event,this.autoSizedColumn=new wijmo_1.Event,this.draggingColumn=new wijmo_1.Event,this.draggingColumnOver=new wijmo_1.Event,this.draggedColumn=new wijmo_1.Event,this.resizingRow=new wijmo_1.Event,this.resizedRow=new wijmo_1.Event,this.autoSizingRow=new wijmo_1.Event,this.autoSizedRow=new wijmo_1.Event,this.draggingRow=new wijmo_1.Event,this.draggingRowOver=new wijmo_1.Event,this.draggedRow=new wijmo_1.Event,this.groupCollapsedChanging=new wijmo_1.Event,this.groupCollapsedChanged=new wijmo_1.Event,this.sortingColumn=new wijmo_1.Event,this.sortedColumn=new wijmo_1.Event,this.beginningEdit=new wijmo_1.Event,this.prepareCellForEdit=new wijmo_1.Event,this.cellEditEnding=new wijmo_1.Event,this.cellEditEnded=new wijmo_1.Event,this.rowEditStarting=new wijmo_1.Event,this.rowEditStarted=new wijmo_1.Event,this.rowEditEnding=new wijmo_1.Event,this.rowEditEnded=new wijmo_1.Event,this.rowAdded=new wijmo_1.Event,this.deletingRow=new wijmo_1.Event,this.deletedRow=new wijmo_1.Event,this.copying=new wijmo_1.Event,this.copied=new wijmo_1.Event,this.pasting=new wijmo_1.Event,this.pasted=new wijmo_1.Event,this.pastingCell=new wijmo_1.Event,this.pastedCell=new wijmo_1.Event,this.formatItem=new wijmo_1.Event(()=>{this.invalidate()}),this.updatingView=new wijmo_1.Event,this.updatedView=new wijmo_1.Event,this._mappedColumns=null;let i=this.hostElement;wijmo_1.isIE()&&(i.style.borderRadius="0");let s=this.getTemplate();this.applyTemplate("wj-control wj-content wj-flexgrid",s,{_root:"root",_eSz:"sz",_eCt:"cells",_fCt:"fcells",_eTL:"tl",_eBL:"bl",_eCHdr:"ch",_eRHdr:"rh",_eCFtr:"cf",_eTLCt:"tlcells",_eBLCt:"blcells",_eCHdrCt:"chcells",_eCFtrCt:"cfcells",_eRHdrCt:"rhcells",_eMarquee:"marquee",_eFocus:"focus"});[this._eRHdr,this._eCFtr,this._eCHdr,this._eBL,this._eTL].forEach(e=>{wijmo_1.setAttribute(e,"aria-hidden",!0),wijmo_1.setCss(e,{position:"absolute",overflow:"hidden",outline:"none"}),wijmo_1.setCss(e.firstElementChild,{position:"relative"})}),[this._eFocus,this._eMarquee,this._fCt,this._eSz].forEach(e=>{wijmo_1.setAttribute(e,"aria-hidden",!0)}),i.tabIndex=-1,this.deferUpdate(()=>{let e=this._getDefaultRowHeight();this._rows=new RowCollection(this,e),this._cols=new ColumnCollection(this,4*e),this._hdrRows=new RowCollection(this,e),this._hdrCols=new ColumnCollection(this,Math.round(1.25*e)),this._ftrRows=new RowCollection(this,e);let i=CellType;this._gpTL=new GridPanel(this,i.TopLeft,this._hdrRows,this._hdrCols,this._eTLCt),this._gpCHdr=new GridPanel(this,i.ColumnHeader,this._hdrRows,this._cols,this._eCHdrCt),this._gpRHdr=new GridPanel(this,i.RowHeader,this._rows,this._hdrCols,this._eRHdrCt),this._gpCells=new GridPanel(this,i.Cell,this._rows,this._cols,this._eCt),this._gpBL=new GridPanel(this,i.BottomLeft,this._ftrRows,this._hdrCols,this._eBLCt),this._gpCFtr=new GridPanel(this,i.ColumnFooter,this._ftrRows,this._cols,this._eCFtrCt),this._hdrRows.push(new Row),this._hdrCols.push(new Column({align:"center"})),this._cf=new CellFactory,this._keyHdl=new _KeyboardHandler(this),this._mouseHdl=new _MouseHandler(this),this._edtHdl=new _EditHandler(this),this._selHdl=new _SelectionHandler(this),this._addHdl=new _AddNewHandler(this),this._mrgMgr=new MergeManager(this),this._bndSortConverter=this._sortConverter.bind(this),this._errorTip=new wijmo_1.Tooltip({isContentHtml:!1,showDelay:0,cssClass:"wj-error-tip"}),wijmo_1.setAttribute(this.cells.hostElement,"role","grid"),this.selectionMode=SelectionMode.CellRange,this.initialize(t)}),this.addEventListener(this._root,"scroll",e=>{this._updateScrollPosition()&&(this.finishEditing(),this._updateContent(!0))}),this.addEventListener(i,"focus",e=>{if(i.tabIndex>-1){let t=e.target;if(t instanceof HTMLElement&&t.tabIndex<0)return void this._setFocus(!0)}},!0)}_handleResize(){this._rcBounds=null,super._handleResize()}get headersVisibility(){return this._hdrVis}set headersVisibility(e){(e=wijmo_1.asEnum(e,HeadersVisibility))!=this._hdrVis&&(this._hdrVis=e,this.invalidate())}get stickyHeaders(){return this._stickyHdr}set stickyHeaders(e){e!=this._stickyHdr&&(this._stickyHdr=wijmo_1.asBoolean(e),this._updateStickyHeaders(),this.invalidate())}get preserveSelectedState(){return this._pSel}set preserveSelectedState(e){this._pSel=wijmo_1.asBoolean(e)}get preserveOutlineState(){return this._pOutline}set preserveOutlineState(e){this._pOutline=wijmo_1.asBoolean(e)}get anchorCursor(){return this._anchorCursor}set anchorCursor(e){this._anchorCursor=wijmo_1.asBoolean(e)}get virtualizationThreshold(){return this._vt}set virtualizationThreshold(e){this._vt=e,wijmo_1.isNumber(e)?this._vtRows=this._vtCols=wijmo_1.asNumber(e):e?wijmo_1.isArray(e)&&2==e.length?(this._vtRows=wijmo_1.asNumber(e[0]),this._vtCols=wijmo_1.asNumber(e[1])):wijmo_1.assert(!1,"virtualizationThreshold should be a number or an array with two numbers."):this._vtRows=this._vtCols=0}get autoGenerateColumns(){return this._autoGenCols}set autoGenerateColumns(e){this._autoGenCols=wijmo_1.asBoolean(e)}get autoClipboard(){return this._autoClipboard}set autoClipboard(e){this._autoClipboard=wijmo_1.asBoolean(e)}get autoScroll(){return this._autoScroll}set autoScroll(e){this._autoScroll=wijmo_1.asBoolean(e)}get autoSearch(){return this._autoSearch}set autoSearch(e){this._autoSearch=wijmo_1.asBoolean(e)}get columnLayout(){let e=FlexGrid._getSerializableProperties(Column),t=new Column,i=[];return this.columns.forEach(s=>{let l={};e.forEach(e=>{let i=s[e];i!=t[e]&&wijmo_1.isPrimitive(i)&&"size"!=e&&(l[e]=i)}),i.push(l)}),JSON.stringify({columns:i})}set columnLayout(e){let t=JSON.parse(wijmo_1.asString(e));if(!t||null==t.columns)throw"Invalid columnLayout data.";this.columns.clear(),this.initialize(t)}get isReadOnly(){return this._readOnly}set isReadOnly(e){e!=this._readOnly&&(this._readOnly=wijmo_1.asBoolean(e),this.finishEditing(),this.invalidate(!0),this._addHdl.updateNewRowTemplate(),wijmo_1.toggleClass(this.hostElement,"wj-state-readonly",this.isReadOnly),this._setAria("readonly",this.isReadOnly?"true":null))}get imeEnabled(){return null!=this._imeHdl}set imeEnabled(e){if(wijmo_1.asBoolean(e)!=this.imeEnabled&&this.finishEditing()){let t=this.containsFocus();this._imeHdl&&(this._imeHdl.dispose(),this._imeHdl=null),e&&(this._imeHdl=new _ImeHandler(this)),t&&this.focus()}}get allowResizing(){return this._alResizing}set allowResizing(e){this._alResizing=wijmo_1.asEnum(e,AllowResizing)}get deferResizing(){return this._deferResizing}set deferResizing(e){this._deferResizing=wijmo_1.asBoolean(e)}get autoSizeMode(){return this._autoSizeMode}set autoSizeMode(e){this._autoSizeMode=wijmo_1.asEnum(e,AutoSizeMode)}get quickAutoSize(){return this._quickSize}set quickAutoSize(e){this._quickSize=wijmo_1.asBoolean(e,!0)}_getQuickAutoSize(){return wijmo_1.isBoolean(this._quickSize)?this._quickSize:!this.formatItem.hasHandlers&&null==this.itemFormatter}get allowSorting(){return this._alSorting}set allowSorting(e){this._alSorting=wijmo_1.asBoolean(e)}get allowAddNew(){return this._alAddNew}set allowAddNew(e){e!=this._alAddNew&&(this._alAddNew=wijmo_1.asBoolean(e),this._addHdl.updateNewRowTemplate())}get newRowAtTop(){return this._addHdl.newRowAtTop}set newRowAtTop(e){this._addHdl.newRowAtTop=wijmo_1.asBoolean(e)}get allowDelete(){return this._alDelete}set allowDelete(e){e!=this._alDelete&&(this._alDelete=wijmo_1.asBoolean(e))}get allowMerging(){return this._alMerging}set allowMerging(e){(e=wijmo_1.asEnum(e,AllowMerging))!=this._alMerging&&(this._alMerging=e,this.invalidate())}get showSelectedHeaders(){return this._ssHdr}set showSelectedHeaders(e){(e=wijmo_1.asEnum(e,HeadersVisibility))!=this._ssHdr&&(this._ssHdr=e,this.invalidate())}get showMarquee(){return!this._eMarquee.style.display}set showMarquee(e){if(e!=this.showMarquee){let t=this._eMarquee.style;t.visibility="collapse",t.display=wijmo_1.asBoolean(e)?"":"none",this.invalidate()}}get showSort(){return this._shSort}set showSort(e){e!=this._shSort&&(this._shSort=wijmo_1.asBoolean(e),this.invalidate())}get showGroups(){return this._shGroups}set showGroups(e){e!=this._shGroups&&(this._shGroups=wijmo_1.asBoolean(e),this._bindGrid(!1))}get alternatingRowStep(){return this._altStep}set alternatingRowStep(e){e!=this._altStep&&(this._altStep=wijmo_1.asInt(e,!1,!0),this.invalidate())}get showAlternatingRows(){return this._altStep>0}set showAlternatingRows(e){wijmo_1._deprecated("showAlternatingRows","alternatingRowStep"),this.alternatingRowStep=e?1:0}get showErrors(){return this._shErr}set showErrors(e){e!=this._shErr&&(this._clearCells(),this._shErr=wijmo_1.asBoolean(e))}get errorTip(){return this._errorTip}set errorTip(e){e!=this._errorTip&&(this._clearCells(),this._errorTip=wijmo_1.asType(e,wijmo_1.Tooltip,!0))}get itemValidator(){return this._itemValidator}set itemValidator(e){e!=this.itemValidator&&(this._itemValidator=wijmo_1.asFunction(e),this.invalidate())}get validateEdits(){return this._valEdt}set validateEdits(e){this._valEdt=wijmo_1.asBoolean(e)}get groupHeaderFormat(){return this._gHdrFmt}set groupHeaderFormat(e){e!=this._gHdrFmt&&(this._gHdrFmt=wijmo_1.asString(e),this._bindGrid(!1))}get allowDragging(){return this._alDragging}set allowDragging(e){(e=wijmo_1.asEnum(e,AllowDragging))!=this._alDragging&&(this._alDragging=e,this.invalidate())}get itemsSource(){return this._items}set itemsSource(e){if(e!=this._items){let t=new wijmo_1.CancelEventArgs;if(this.onItemsSourceChanging(t)){if(this._cv){let e=wijmo_1.tryCast(this._cv,wijmo_1.CollectionView);e&&e.sortConverter==this._bndSortConverter&&(e.sortConverter=null),this._cv.currentChanged.removeHandler(this._cvCurrentChanged,this),this._cv.collectionChanged.removeHandler(this._cvCollectionChanged,this),this._cv=null}if(this._items=e,this._cv=this._getCollectionView(e),this._lastCount=0,this._cv){this._cv.currentChanged.addHandler(this._cvCurrentChanged,this),this._cv.collectionChanged.addHandler(this._cvCollectionChanged,this);let e=wijmo_1.tryCast(this._cv,wijmo_1.CollectionView);e&&!e.sortConverter&&(e.sortConverter=this._bndSortConverter)}this._bindGrid(!0);let i=SelectionMode;this.selectionMode==i.ListBox&&(this.selectionMode=i.CellRange,this.selectionMode=i.ListBox),this.onItemsSourceChanged(t)}}}get collectionView(){return this._cv}get editableCollectionView(){return wijmo_1.tryCast(this._cv,"IEditableCollectionView")}get childItemsPath(){return this._childItemsPath}set childItemsPath(e){e!=this._childItemsPath&&(wijmo_1.assert(null==e||wijmo_1.isArray(e)||wijmo_1.isString(e),"childItemsPath should be an array or a string."),this._childItemsPath=e,this._bindGrid(!0))}get rowHeaderPath(){return this._rowHdrPath?this._rowHdrPath.path:null}set rowHeaderPath(e){e!=this.rowHeaderPath&&(e=wijmo_1.asString(e),this._rowHdrPath=e?new wijmo_1.Binding(e):null,this.invalidate())}get cells(){return this._gpCells}get columnHeaders(){return this._gpCHdr}get columnFooters(){return this._gpCFtr}get rowHeaders(){return this._gpRHdr}get topLeftCells(){return this._gpTL}get bottomLeftCells(){return this._gpBL}get rows(){return this._rows}get columns(){return this._cols}getColumn(e){return this.columns.getColumn(e)}get frozenRows(){return this.rows.frozen}set frozenRows(e){this.rows.frozen=e}get frozenColumns(){return this.columns.frozen}set frozenColumns(e){this.columns.frozen=e}get cloneFrozenCells(){return this._fzClone}set cloneFrozenCells(e){e!=this.cloneFrozenCells&&(wijmo_1.setText(this._fCt,null),this._fzClone=wijmo_1.asBoolean(e,!0),this.invalidate())}get sortRowIndex(){return this._sortRowIndex}set sortRowIndex(e){e!=this._sortRowIndex&&(this._sortRowIndex=wijmo_1.asNumber(e,!0),this.invalidate())}get editColumnIndex(){return this._editColIndex}set editColumnIndex(e){e!=this._editColIndex&&(this._editColIndex=wijmo_1.asNumber(e,!0),this.invalidate())}get scrollPosition(){return this._ptScrl.clone()}set scrollPosition(e){let t=this._root,i=-e.x;if(this.rightToLeft)switch(FlexGrid._getRtlMode()){case"rev":i=t.scrollWidth-t.clientWidth+e.x;break;case"neg":i=e.x;break;default:i=-e.x}t.scrollLeft=i,t.scrollTop=-e.y}get clientSize(){return this._szClient}get controlRect(){return this._rcBounds||(this._rcBounds=wijmo_1.getElementRect(this._root)),this._rcBounds}get scrollSize(){return new wijmo_1.Size(this._gpCells.width,this._heightBrowser)}get viewRange(){return this._gpCells.viewRange}get cellFactory(){return this._cf}set cellFactory(e){e!=this._cf&&(this._clearCells(),this._cf=wijmo_1.asType(e,CellFactory,!1))}get itemFormatter(){return this._itemFormatter}set itemFormatter(e){e!=this._itemFormatter&&(this._clearCells(),this._itemFormatter=wijmo_1.asFunction(e))}canEditCell(e,t){return this._edtHdl._allowEditing(e,t)}getCellData(e,t,i){return this.cells.getCellData(e,t,i)}getCellBoundingRect(e,t,i){return this.cells.getCellBoundingRect(e,t,i)}setCellData(e,t,i,s=!0,l=!0){return this.cells.setCellData(e,t,i,s,l)}hitTest(e,t){return wijmo_1.isNumber(e)&&wijmo_1.isNumber(t)&&(e=new wijmo_1.Point(e,t)),wijmo_1.isBoolean(t)&&t&&(this._rcBounds=null),new HitTestInfo(this,e)}getClipString(e,t,i,s){return this._edtHdl.getClipString(e,t,i,s)}setClipString(e,t){this._edtHdl.setClipString(e,t)}focus(){this._setFocus(!1)}dispose(){this.finishEditing(!0),this.itemsSource=null,super.dispose()}refresh(e=!0){if(super.refresh(e),this.finishEditing(),e){this._updateColumnTypes(),this.scrollPosition=this._ptScrl;let e=this._getDefaultRowHeight();this._rows._setDefaultSize(e),this._cols._setDefaultSize(4*e),this._hdrRows._setDefaultSize(e),this._hdrCols._setDefaultSize(Math.round(1.25*e)),this._ftrRows._setDefaultSize(e),this._toInv&&(clearTimeout(this._toInv),this._toInv=null)}this.refreshCells(e)}refreshCells(e,t,i){this.isUpdating||(e?this._updateLayout():this._updateContent(t,i))}autoSizeColumn(e,t=!1,i=4){this.autoSizeColumns(e,e,t,i)}autoSizeColumns(e,t,i=!1,s=4){let l=0,o=i?this.topLeftCells:this.columnHeaders,n=i?this.bottomLeftCells:this.columnFooters,r=i?this.rowHeaders:this.cells,a=this.viewRange;e=null==e?0:wijmo_1.asInt(e),t=null==t?r.columns.length-1:wijmo_1.asInt(t),a.row=Math.max(0,a.row-1e3),a.row2=Math.min(a.row2+1e3,this.rows.length-1),this.finishEditing()&&this.columns.deferUpdate(()=>{wijmo_1.setCss(this._eCt,{width:this._gpCells.width});let i=wijmo_1.createElement('<div style="visibility: hidden" '+FlexGrid._WJS_MEASURE+'="true"/>',r.hostElement),h=this._getCanvasContext();for(let d=e;d<=t&&d>-1&&d<r.columns.length;d++){let e=r.columns[d];if(e.isVisible){if(l=0,this.autoSizeMode&AutoSizeMode.Headers){for(let e=0;e<o.rows.length;e++)o.rows[e].isVisible&&(l=Math.max(this._getDesiredWidth(o,e,d,i),l));for(let e=0;e<n.rows.length;e++)n.rows[e].isVisible&&(l=Math.max(this._getDesiredWidth(n,e,d,i),l))}if(this.autoSizeMode&AutoSizeMode.Cells&&a.isValid)if(e._getQuickAutoSize()){let e=this._getWidestRow(r,a,d,h);l=Math.max(this._getDesiredWidth(r,e,d,i),l)}else for(let e=a.row;e<=a.row2&&e<r.rows.length;e++)r.rows[e].isVisible&&(l=Math.max(this._getDesiredWidth(r,e,d,i),l));l>0&&(e.width=l+s+2)}}this.cellFactory.disposeCell(i),wijmo_1.removeChild(i)})}autoSizeRow(e,t=!1,i=0){this.autoSizeRows(e,e,t,i)}autoSizeRows(e,t,i=!1,s=0){let l=0,o=i?this.topLeftCells:this.rowHeaders,n=i?this.columnHeaders:this.cells;if(i=wijmo_1.asBoolean(i),s=wijmo_1.asNumber(s),e=null==e?0:wijmo_1.asInt(e),t=null==t?n.rows.length-1:wijmo_1.asInt(t),this.finishEditing()){wijmo_1.setCss(this._eCt,{width:this._gpCells.width});let i=wijmo_1.createElement('<div style="visibility: hidden" '+FlexGrid._WJS_MEASURE+'="true"/>',n.hostElement);this.rows.deferUpdate(()=>{let r={};for(let a=e;a<=t&&a>-1&&a<n.rows.length;a++){n.rows[a].isVisible&&(l=0,this.autoSizeMode&AutoSizeMode.Headers&&(l=this._getDesiredRowHeight(o,a,i,r)),this.autoSizeMode&AutoSizeMode.Cells&&(l=Math.max(this._getDesiredRowHeight(n,a,i,r),l)),l>0&&(n.rows[a].height=l+s))}}),this.cellFactory.disposeCell(i),wijmo_1.removeChild(i)}}get treeIndent(){return this._indent}set treeIndent(e){e!=this._indent&&(this._indent=wijmo_1.asNumber(e,!1,!0),this.columns.onCollectionChanged())}collapseGroupsToLevel(e){this.finishEditing()&&this.deferUpdate(()=>{let t=this.rows;t.deferUpdate(()=>{for(let i=0;i<t.length;i++){let s=t[i];s instanceof GroupRow&&(s.isCollapsed=s.level>=e)}})})}get selectionMode(){return this._selHdl.selectionMode}set selectionMode(e){(e=wijmo_1.asEnum(e,SelectionMode))!=this.selectionMode&&(this._clearCells(),this._selHdl.selectionMode=e)}get selection(){return this._selHdl.selection.clone()}set selection(e){this._selHdl.selection=e}select(e,t=!0){this._selHdl.select(e,t)}getSelectedState(e,t){return this.cells.getSelectedState(e,t,null)}get selectedRows(){let e=[];if(this.selectionMode==SelectionMode.ListBox)for(let t=0;t<this.rows.length;t++)this.rows[t].isSelected&&e.push(this.rows[t]);else if(this.rows.length){let t=this.selection;for(let i=t.topRow;i>-1&&i<=t.bottomRow;i++)e.push(this.rows[i])}return e}set selectedRows(e){wijmo_1.assert(this.selectionMode==SelectionMode.ListBox,"This property can be set only in ListBox mode."),e=wijmo_1.asArray(e),this.deferUpdate(()=>{for(let t=0,i=!0;t<this.rows.length;t++){let s=this.rows[t],l=e&&e.indexOf(s)>-1;l&&i&&(i=!1,this.select(t,this.selection.col)),s.isSelected=l}})}get selectedItems(){let e=this.selectedRows;for(let t=0;t<e.length;t++)e[t]=e[t].dataItem;return e}set selectedItems(e){wijmo_1.assert(this.selectionMode==SelectionMode.ListBox,"This property can be set only in ListBox mode."),e=wijmo_1.asArray(e),this.deferUpdate(()=>{for(let t=0,i=!0;t<this.rows.length;t++){let s=this.rows[t],l=e&&e.indexOf(s.dataItem)>-1;l&&i&&(i=!1,this.select(t,this.selection.col)),s.isSelected=l}})}scrollIntoView(e,t,i){(null==this._maxOffsetY||this._rows._dirty||this._cols._dirty)&&this._updateLayout();let s=this.scrollPosition,l=this._szClient.width,o=this._szClient.height-this._gpCFtr.rows.getTotalSize(),n=this.cells._getFrozenPos();if((e=wijmo_1.asInt(e))>-1&&e<this._rows.length&&e>=this._rows.frozen){let t=this._rows[e],i=this.cells.height>o?Math.round(t.pos/(this.cells.height-o)*100)/100:0,l=Math.round(this._maxOffsetY*i),r=t.pos-l,a=r+t.renderSize;a>o-s.y&&(s.y=Math.max(-r,o-a)),r-n.y<-s.y&&(s.y=-(r-n.y))}if((t=wijmo_1.asInt(t))>-1&&t<this._cols.length&&t>=this._cols.frozen){let e=this._cols[t],i=e.pos+e.renderSize;i>-s.x+l&&(s.x=Math.max(-e.pos,l-i)),e.pos-n.x<-s.x&&(s.x=-(e.pos-n.x))}return!s.equals(this._ptScrl)&&(this.scrollPosition=s,i&&(this._updateScrollPosition(),this.refresh()),!0)}isRangeValid(e){return e.isValid&&e.bottomRow<this.rows.length&&e.rightCol<this.columns.length}startEditing(e=!0,t,i,s){return this._edtHdl.startEditing(e,t,i,s)}finishEditing(e){return this._edtHdl.finishEditing(e)}get activeEditor(){return this._edtHdl.activeEditor}get editRange(){return this._edtHdl.editRange}get mergeManager(){return this._mrgMgr}set mergeManager(e){e!=this._mrgMgr&&(this._mrgMgr=wijmo_1.asType(e,MergeManager,!0),this.invalidate())}getMergedRange(e,t,i,s=!0){return this._mrgMgr?this._mrgMgr.getMergedRange(e,t,i,s):null}get keyActionTab(){return this._keyHdl._kaTab}set keyActionTab(e){this._keyHdl._kaTab=wijmo_1.asEnum(e,KeyAction)}get keyActionEnter(){return this._keyHdl._kaEnter}set keyActionEnter(e){this._keyHdl._kaEnter=wijmo_1.asEnum(e,KeyAction)}get showDropDown(){return this._shDropDown}set showDropDown(e){e!=this._shDropDown&&(this._shDropDown=wijmo_1.asBoolean(e,!0),this.invalidate())}toggleDropDownList(){this._tglDropDown||(this._tglDropDown=!0,this._edtHdl._toggleListBox(null),this._tglDropDown=!1)}onItemsSourceChanging(e){return this.itemsSourceChanging.raise(this,e),!e.cancel}onItemsSourceChanged(e){this.itemsSourceChanged.raise(this,e)}onScrollPositionChanged(e){this.scrollPositionChanged.raise(this,e)}onSelectionChanging(e){return this.selectionChanging.raise(this,e),!e.cancel}onSelectionChanged(e){this.selectionChanged.raise(this,e)}onLoadingRows(e){return this.loadingRows.raise(this,e),!e.cancel}onLoadedRows(e){this.loadedRows.raise(this,e)}onUpdatingLayout(e){return this.updatingLayout.raise(this,e),!e.cancel}onUpdatedLayout(e){this.updatedLayout.raise(this,e)}onResizingColumn(e){return this.resizingColumn.raise(this,e),!e.cancel}onResizedColumn(e){this.resizedColumn.raise(this,e)}onAutoSizingColumn(e){return this.autoSizingColumn.raise(this,e),!e.cancel}onAutoSizedColumn(e){this.autoSizedColumn.raise(this,e)}onDraggingColumn(e){return this.draggingColumn.raise(this,e),!e.cancel}onDraggingColumnOver(e){return this.draggingColumnOver.raise(this,e),!e.cancel}onDraggedColumn(e){this.draggedColumn.raise(this,e)}onResizingRow(e){return this.resizingRow.raise(this,e),!e.cancel}onResizedRow(e){this.resizedRow.raise(this,e)}onAutoSizingRow(e){return this.autoSizingRow.raise(this,e),!e.cancel}onAutoSizedRow(e){this.autoSizedRow.raise(this,e)}onDraggingRow(e){return this.draggingRow.raise(this,e),!e.cancel}onDraggingRowOver(e){return this.draggingRowOver.raise(this,e),!e.cancel}onDraggedRow(e){this.draggedRow.raise(this,e)}onGroupCollapsedChanging(e){return this.groupCollapsedChanging.raise(this,e),!e.cancel}onGroupCollapsedChanged(e){this.groupCollapsedChanged.raise(this,e)}onSortingColumn(e){return this.sortingColumn.raise(this,e),!e.cancel}onSortedColumn(e){this.sortedColumn.raise(this,e)}onBeginningEdit(e){return this.beginningEdit.raise(this,e),!e.cancel}onPrepareCellForEdit(e){this.prepareCellForEdit.raise(this,e)}onCellEditEnding(e){return this.cellEditEnding.raise(this,e),!e.cancel&&!e.stayInEditMode}onCellEditEnded(e){this.cellEditEnded.raise(this,e)}onRowEditStarting(e){this.rowEditStarting.raise(this,e)}onRowEditStarted(e){this.rowEditStarted.raise(this,e)}onRowEditEnding(e){this.rowEditEnding.raise(this,e)}onRowEditEnded(e){this.rowEditEnded.raise(this,e)}onRowAdded(e){return this.rowAdded.raise(this,e),!e.cancel}onDeletingRow(e){return this.deletingRow.raise(this,e),!e.cancel}onDeletedRow(e){this.deletedRow.raise(this,e)}onCopying(e){return this.copying.raise(this,e),!e.cancel}onCopied(e){this.copied.raise(this,e)}onPasting(e){return this.pasting.raise(this,e),!e.cancel}onPasted(e){this.pasted.raise(this,e)}onPastingCell(e){return this.pastingCell.raise(this,e),!e.cancel}onPastedCell(e){this.pastedCell.raise(this,e)}onFormatItem(e){this.formatItem.raise(this,e)}onUpdatingView(e){return this.updatingView.raise(this,e),!e.cancel}onUpdatedView(e){this.updatedView.raise(this,e)}_getShowErrors(){return this.showErrors&&this._hasValidation}_getHasValidation(){return this._hasValidation}_getError(e,t,i){if(wijmo_1.isFunction(this.itemValidator)){if(e==this.cells)return this.itemValidator(t,i);if(e==this.rowHeaders)for(i=0;i<this.columns.length;i++){let e=this.itemValidator(t,i);if(e)return e}}let s=this._cv,l=s?s.getError:null;if(wijmo_1.isFunction(l)){let s=e.rows,o=this.columns,n=s[t].dataItem;if(n&&!(n instanceof wijmo_1.CollectionViewGroup))for(;t<s.length&&s[t].dataItem==n;t++){if(e==this.cells){return l(n,this._getBindingColumn(this.cells,t,o[i]).binding)}if(e==this.rowHeaders)for(i=0;i<o.length;i++){let e=l(n,this._getBindingColumn(this.cells,t,o[i]).binding);if(e)return e}}}return null}_setAria(e,t){wijmo_1.setAttribute(this.cells.hostElement,"aria-"+e,t)}_setFocus(e){if(this.hostElement&&(e||!this.containsFocus())){let e=wijmo_1.getActiveElement(),t=this.activeEditor,i=this._activeCell,s=this._eFocus;t?wijmo_1.contains(t,e)||(t.focus(),s.tabIndex=-1):i?wijmo_1.contains(i,e)||e!=this._root&&(i.tabIndex=this._orgTabIndex,i.focus(),s.tabIndex=-1):wijmo_1.contains(s,e)||e==this._root||(s.tabIndex=this._orgTabIndex,s.focus()),this.containsFocus()||(s.tabIndex=this._orgTabIndex,s.focus())}}_setFocusNoScroll(e){if(e.tabIndex=this._orgTabIndex,wijmo_1.supportsFocusOptions())e.focus({preventScroll:!0});else{let t=this.scrollPosition,i=e.style,s=i.position,l=i.opacity;i.opacity="0",i.position="fixed",e.focus(),i.position=s,i.opacity=l,this.scrollPosition=t}}_getDefaultRowHeight(){let e=this.hostElement,t=this._eFocus,i=null;t.offsetHeight||(i=wijmo_1.createElement('<div><div class="wj-cell">0</div></div>',document.body),e&&i.setAttribute("class",e.getAttribute("class")),t=i.children[0]);let s=t.offsetHeight;return(isNaN(s)||s<=6)&&(s=28),wijmo_1.removeChild(i),s}_getCollectionView(e){return wijmo_1.asCollectionView(e)}_getCanvasContext(){let e=document.createElement("canvas").getContext("2d"),t=getComputedStyle(this.hostElement);return e.font=t.fontSize+" "+t.fontFamily.split(",")[0],e}_getWidestRow(e,t,i,s){let l=0,o=0,n=e.columns[i].dataType==wijmo_1.DataType.Boolean;for(let r=t.row;r<=t.row2;r++)if(e.rows[r].isVisible){let t=e.getCellData(r,i,!0),a=s.measureText(t).width,h=this.getMergedRange(e,r,i,!1);if(h&&h.columnSpan>1&&(a/=h.columnSpan),a>o&&(o=a,l=r),n)break}return l}_getDesiredWidth(e,t,i,s){let l=this.getMergedRange(e,t,i,!1),o=s.style;return this.cellFactory.updateCell(e,t,i,s,l),o.width=o.top=o.left="",s.offsetWidth/(l&&l.columnSpan>1?l.columnSpan:1)}_getDesiredHeight(e,t,i,s){let l=s.style,o=this.getMergedRange(e,t,i,!1),n=o?o.rowSpan:1;return this.cellFactory.updateCell(e,t,i,s,o),s.innerHTML.trim()||(s.innerHTML="&nbsp;"),l.height=l.top=l.left="",s.offsetHeight/n}_getDesiredRowHeight(e,t,i,s){let l=0;for(let o=0;o<e.columns.length;o++){let n=e.columns[o];if(n.isVisible){let r,a=this.getMergedRange(e,t,o,!1);if(this._getQuickAutoSize()){let l={ct:e.cellType,col:o,rng:a&&a.rowSpan>1?a.rowSpan:1,content:n.dataType==wijmo_1.DataType.Number?"1":e.getCellData(t,o,!0)},h=JSON.stringify(l);null==(r=s[h])&&(r=this._getDesiredHeight(e,t,o,i),s[h]=r)}else r=this._getDesiredHeight(e,t,o,i);l=Math.max(r,l)}}return l}_getSortRowIndex(){return null!=this._sortRowIndex?this._sortRowIndex:this.columnHeaders.rows.length-1}_getEditColumnIndex(){return null!=this._editColIndex?this._editColIndex:this.rowHeaders.columns.length-1}_sortConverter(e,t,i,s){let l;if(s){if(this._mappedColumns=null,this._cv){let e=this._cv.sortDescriptions;for(let t=0;t<e.length;t++)(l=this.getColumn(e[t].property))&&l.dataMap&&(this._mappedColumns||(this._mappedColumns={}),this._mappedColumns[l.binding]=l.dataMap)}this._mouseHdl._htDown&&this._mouseHdl._htDown.col>-1&&(l=this.columns[this._mouseHdl._htDown.col],this._mappedColumns&&l.dataMap&&(this._mappedColumns[l.binding]=l.dataMap))}if(this._mappedColumns){let t=this._mappedColumns[e.property];t&&t.sortByDisplayValues&&(i=t.getDisplayValue(i))}return i}_bindGrid(e){if(this.finishEditing(),this.deferUpdate(()=>{this.autoGenerateColumns&&0==this._lastCount&&wijmo_1.hasItems(this._cv)&&(e=!0);let t,i,s=this.selectionMode==SelectionMode.ListBox;if(this.preserveSelectedState&&s&&(t=this.selectedItems),this.preserveOutlineState&&wijmo_1.isFunction(window.Map)&&this.rows.maxGroupLevel>-1){i=new Map;for(let e=0;e<this.rows.length;e++){let t=this.rows[e];if(t instanceof GroupRow&&t.isCollapsed&&t.dataItem){let e=t.dataItem;e instanceof wijmo_1.CollectionViewGroup&&(e=e._path),i.set(e,!0)}}}e&&this.columns.deferUpdate(()=>{this._bindColumns()});let l=new wijmo_1.CancelEventArgs;this.onLoadingRows(l)&&(this.rows.deferUpdate(()=>{this._bindRows()}),this.onLoadedRows(l));let o=0;if(t&&t.length)for(let e=0;e<this.rows.length&&o<t.length;e++)t.indexOf(this.rows[e].dataItem)>-1&&(this.rows[e].isSelected=!0,o++);if(s&&0==o&&this._lastCount>0){let e=this.selection;for(let t=e.topRow;t<=e.bottomRow&&t>-1&&t<this.rows.length;t++)this.rows[t].isSelected=!0}i&&this.rows.deferUpdate(()=>{for(let e=0;e<this.rows.length;e++){let t=this.rows[e];if(t instanceof GroupRow){let e=t.dataItem;e instanceof wijmo_1.CollectionViewGroup&&(e=e._path),i.get(e)&&(t.isCollapsed=!0)}}}),!this._lastCount&&this._cv&&this._cv.items&&(this._lastCount=this._cv.items.length)}),!this.rows.length){let e=this._selHdl.selection;e.row=e.row2=-1}this._cv&&this._syncSelection(e)}_cvCollectionChanged(e,t){if(this.autoGenerateColumns&&0==this.columns.length)return void this._bindGrid(!0);let i=wijmo_1.NotifyCollectionChangedAction;if(this.childItemsPath&&t.action!=i.Change)this._bindGrid(!1);else{switch(t.action){case i.Change:return void this.invalidate();case i.Add:if(t.index==this._cv.items.length-1){let e=this.rows.length;return this.rows[e-1]instanceof _NewRowTemplate&&e--,void this.rows.insert(e,new Row(t.item))}wijmo_1.assert(!1,"added item should be the last one.");break;case i.Remove:let e=this._findRow(t.item);if(e>-1)return this.rows.removeAt(e),void this._syncSelection(!1);wijmo_1.assert(!1,"removed item not found on grid.")}this._bindGrid(!1)}}_cvCurrentChanged(e,t){this._syncSelection(!1)}_syncSelection(e){if(this._cv&&this.selectionMode!=SelectionMode.None){let t=this._selHdl.selection,i=t.row>-1&&t.row<this.rows.length?this.rows[t.row]:null,s=i?i.dataItem:null;if(this.newRowAtTop&&i instanceof _NewRowTemplate&&(s=null),s instanceof wijmo_1.CollectionViewGroup&&(s=null),(s!=this._cv.currentItem||e)&&(!this.childItemsPath||!this.editableCollectionView||!this.editableCollectionView.currentAddItem)){let e=this._getRowIndex(this._cv.currentPosition);e==t.row&&this.childItemsPath||(t=new CellRange(e,t.col,e,t.col2),this.select(t,!1),this.selectionMode&&this.scrollIntoView(t.row,-1))}}}_getRowIndex(e){if(this._cv){if(e>-1){let t=this._cv.items[e];for(;e<this.rows.length;e++)if(this.rows[e].dataItem===t)return e;return-1}{if(1==this.rows.length&&this.rows[0]instanceof _NewRowTemplate)return 0;let e=this.selection.row,t=e>-1?this.rows[e]:null;return t&&(t instanceof GroupRow||null==t.dataItem)?e:-1}}return this.selection.row}_getCvIndex(e){if(this._cv&&e>-1&&e<this.rows.length){let t=this._cv.items,i=this.rows[e].dataItem;for(e=Math.min(e,t.length-1);e>-1;e--)if(t[e]===i)return e}return-1}_findRow(e){for(let t=0;t<this.rows.length;t++)if(this.rows[t].dataItem==e)return t;return-1}_updateLayout(){let e=new wijmo_1.CancelEventArgs;if(!this.onUpdatingLayout(e))return;let t=this._hdrVis&HeadersVisibility.Row?this._hdrCols.getTotalSize():0,i=this._hdrVis&HeadersVisibility.Column?this._hdrRows.getTotalSize():0,s=this._ftrRows.getTotalSize(),l=this._rows.getTotalSize()+s;l<1&&(l=1),this._heightBrowser=Math.min(l,FlexGrid._getMaxSupportedCssHeight()),this._maxOffsetY=Math.max(0,l-this._heightBrowser);let o=getComputedStyle(this._eFocus);this._cellPadLeft=parseInt(this.rightToLeft?o.paddingRight:o.paddingLeft),this._cellPadVert=parseInt(o.paddingTop)+parseInt(o.paddingBottom);let n=this._heightBrowser+i-s,r=this._gpCells.width,a=this._heightBrowser;!r&&this.rows.length&&(r=.1),!a&&this.columns.length&&(a=.1),this.rightToLeft?(wijmo_1.setCss(this._eTL,{right:0,top:0,width:t,height:i}),wijmo_1.setCss(this._eCHdr,{right:t,top:0,height:i}),wijmo_1.setCss(this._eRHdr,{right:0,top:i,width:t}),wijmo_1.setCss(this._eCt,{right:t,top:i,width:r,height:a}),wijmo_1.setCss(this._fCt,{right:t,top:i}),wijmo_1.setCss(this._eBL,{right:0,top:n,width:t,height:s}),wijmo_1.setCss(this._eCFtr,{right:t,top:n,height:s})):(wijmo_1.setCss(this._eTL,{left:0,top:0,width:t,height:i}),wijmo_1.setCss(this._eCHdr,{left:t,top:0,height:i}),wijmo_1.setCss(this._eRHdr,{left:0,top:i,width:t}),wijmo_1.setCss(this._eCt,{left:t,top:i,width:r,height:a}),wijmo_1.setCss(this._fCt,{left:t,top:i}),wijmo_1.setCss(this._eBL,{left:0,top:n,width:t,height:s}),wijmo_1.setCss(this._eCFtr,{left:t,top:n,height:s})),this._stickyHdr&&this._updateStickyHeaders();let h=this.frozenRows||this.frozenColumns?"3":"";wijmo_1.setCss([this._eTL,this._eBL,this._eCHdr,this._eCFtr,this._eRHdr,this._eMarquee],{zIndex:h});let d=this._root,_=d.offsetWidth-d.clientWidth,g=d.offsetHeight-d.clientHeight;wijmo_1.setCss(this._eSz,{width:t+_+this._gpCells.width,height:i+g+this._heightBrowser});let c=null;this.columns._updateStarSizes(d.clientWidth-t)&&(c=d.clientWidth,wijmo_1.setCss(this._eCt,{width:this._gpCells.width})),this._szClient=new wijmo_1.Size(d.clientWidth-t,d.clientHeight-i),this._rcBounds=null,this._updateScrollHandler(),this._updateContent(!1),_=d.offsetWidth-d.clientWidth,g=d.offsetHeight-d.clientHeight,wijmo_1.setCss(this._eSz,{width:t+_+this._gpCells.width,height:i+g+this._heightBrowser}),this._szClient=new wijmo_1.Size(d.clientWidth-t,d.clientHeight-i),c&&c!=d.clientWidth&&this.columns._updateStarSizes(d.clientWidth-t)&&(wijmo_1.setCss(this._eCt,{width:this._gpCells.width}),this._updateContent(!1)),wijmo_1.setCss([this._eCHdr,this._eCFtr,this._fCt],{width:this._szClient.width}),wijmo_1.setCss([this._eRHdr,this._fCt],{height:this._szClient.height}),s&&(n=Math.min(n,this._szClient.height+i-s),wijmo_1.setCss([this._eBL,this._eCFtr],{top:n})),this.onUpdatedLayout(e)}_updateStickyHeaders(){let e=!1,t=0;if(this._stickyHdr){let i=0,s=null;for(let e=this.hostElement;e;e=e.parentElement){let t=e.getBoundingClientRect();null==s&&(s=t.top),i=Math.max(i,t.top)}t=-(s=Math.max(0,i-s-1)),e=s>0,this._rcBounds=null}this._eTL.style.top=this._eCHdr.style.top=e?-t+"px":"",wijmo_1.toggleClass(this._eTL,FlexGrid._WJS_STICKY,e),wijmo_1.toggleClass(this._eCHdr,FlexGrid._WJS_STICKY,e)}_updateScrollHandler(){this._clipToScreen=this._getClipToScreen();let e=this._stickyHdr||this._clipToScreen;e!=this._scrollHandlerAttached&&(this._scrollHandlerAttached=e,e?this.addEventListener(window,"scroll",this._scroll.bind(this),!0):this.removeEventListener(window,"scroll"))}_getClipToScreen(){if(this.rows.length<=FlexGrid._MIN_VIRT_ROWS)return!1;if(this._root.clientHeight!=this._root.scrollHeight)return!1;for(let e=this.hostElement;e&&e!=document.documentElement;e=e.parentElement){if("auto"==getComputedStyle(e).overflow)return!1}return!0}_scroll(e){wijmo_1.contains(e.target,this.hostElement)&&(this._clipToScreen&&(this._afClip&&cancelAnimationFrame(this._afClip),this._afClip=requestAnimationFrame(()=>{this._afClip=null,this.finishEditing(),this._updateContent(!0)})),this._stickyHdr&&(this._afSticky&&cancelAnimationFrame(this._afSticky),this._afSticky=requestAnimationFrame(()=>{this._afSticky=null;let e=new wijmo_1.CancelEventArgs;this.onUpdatingLayout(e)&&(this._updateStickyHeaders(),this.onUpdatedLayout(e))})))}_updateScrollPosition(){let e=this._root,t=e.scrollTop,i=e.scrollLeft;this.rightToLeft&&"rev"==FlexGrid._getRtlMode()&&(i=e.scrollWidth-e.clientWidth-i);let s=new wijmo_1.Point(-Math.abs(i),-t);return!this._ptScrl.equals(s)&&(this._ptScrl=s,this.onScrollPositionChanged(),!0)}_updateContent(e,t){let i=this._root,s=this.hostElement,l=this.cells.hostElement,o=wijmo_1.getActiveElement(),n=wijmo_1.contains(s,o)?o:null,r=this._activeCell,a=new wijmo_1.CancelEventArgs;if(!this.onUpdatingView(a))return;wijmo_1.setAttribute(l,"role",this.rows.maxGroupLevel<0?"grid":"treegrid"),this._hasValidation=wijmo_1.isFunction(this._itemValidator)||this._cv&&wijmo_1.isFunction(this._cv.getError);let h=!t&&this._errorTip&&this._errorTip._tips.length;if(this._offsetY=0,this._heightBrowser>this._szClient.height){let e=Math.round(-this._ptScrl.y/(this._heightBrowser-this._szClient.height)*100)/100;this._offsetY=Math.round(this._maxOffsetY*e)}this._updateScrollPosition();let d=this._gpCells._updateContent(e,t,this._offsetY);if(this._hdrVis&HeadersVisibility.Column&&(!t||this._ssHdr&HeadersVisibility.Column)&&this._gpCHdr._updateContent(e,t,0),this._hdrVis&HeadersVisibility.Row&&(!t||this._ssHdr&HeadersVisibility.Row)&&this._gpRHdr._updateContent(e,t,this._offsetY),this._hdrVis&&!t&&this._gpTL._updateContent(e,t,0),this._gpCFtr.rows.length&&(this._gpBL._updateContent(e,t,0),this._gpCFtr._updateContent(e,t,0)),this.showMarquee){let e=this._selHdl.selection,t=this._eMarquee;if(this.isRangeValid(e)){let i=this._getMarqueeRect(e),s=t.firstChild,o=t.offsetWidth-s.offsetWidth,n=t.offsetHeight-s.offsetHeight;wijmo_1.setCss(t,{left:i.left+l.offsetLeft-o/2,top:i.top+l.offsetTop-n/2,width:i.width+o,height:i.height+n,visibility:i.width>0&&i.height>0?"":"collapse"})}else wijmo_1.setCss(t,{left:0,top:0,width:0,height:0,visibility:"collapse"})}if(h&&this._errorTip&&this._errorTip._tips.length&&(this._toErrorTips&&clearTimeout(this._toErrorTips),this._toErrorTips=setTimeout(()=>{this._errorTip.hide();let e=this._errorTip._tips;for(let i=0;i<e.length;i++){var t=e[i].element;t.offsetHeight&&wijmo_1.hasClass(t,"wj-state-invalid")||(this._errorTip.setTooltip(t,null),i--)}},250)),this._useFrozenDiv()&&(this._updateFrozenCells(t),d&&wijmo_1.hasClass(d,"wj-frozen")&&(d=null)),this._fCt.style.display=this._fCt.childElementCount?"":"none",this._activeCell=d,n)if(n!=i&&n!=this._eFocus&&wijmo_1.contains(s,n)&&!wijmo_1.contains(l,n)){if(wijmo_1.getActiveElement()!==n&&n.focus(),wijmo_1.isIE()&&n instanceof HTMLInputElement&&!n.type.match(/checkbox|radio|range/i)){let e=n.selectionStart,t=n.selectionEnd;n.setSelectionRange(e,t)}}else{let e=d!==r;this._setFocus(e)}!n&&d&&(d.tabIndex=this._orgTabIndex),r&&r!=d&&(r.tabIndex=-1),this._rcBounds=null,this.onUpdatedView(a)}_clearCells(){for(let e in this)if("_"==e[0]){let t=this[e];t instanceof GridPanel&&t._clearCells()}this.invalidate()}_useFrozenDiv(){return wijmo_1.isBoolean(this._fzClone)?this._fzClone:wijmo_1.isIE()||wijmo_1.isFirefox()||wijmo_1.isSafari()||wijmo_1.isMobile()}_updateFrozenCells(e){let t=this._fCt;if(this.frozenRows||this.frozenColumns){let i=this._eCt.querySelectorAll(".wj-frozen");if(e&&t.children.length==i.length){for(let e=0;e<i.length;e++)t.children[e].className=i[e].className;return}if(wijmo_1.setText(t,null),!this.activeEditor){let e=this._errorTip;for(let s=0;s<i.length;s++){let l=i[s];if(wijmo_1.closest(l,".wj-flexgrid")==this.hostElement&&(l=i[s].cloneNode(!0),t.appendChild(l),e)){let t=e.getTooltip(i[s]);t&&e.setTooltip(l,t)}}}}else wijmo_1.setText(t,null)}_getMarqueeRect(e){let t=this.getMergedRange(this.cells,e.topRow,e.leftCol)||new CellRange(e.topRow,e.leftCol),i=this.getMergedRange(this.cells,e.bottomRow,e.rightCol)||new CellRange(e.bottomRow,e.rightCol),s=this.cells.getCellBoundingRect(t.topRow,t.leftCol,!0),l=this.cells.getCellBoundingRect(i.bottomRow,i.rightCol,!0);if(this.rows.frozen){let t=Math.min(this.rows.length,this.rows.frozen),i=this.cells.getCellBoundingRect(t-1,0,!0);e.topRow>=t&&s.top<i.bottom&&(s.top=i.bottom),e.bottomRow>=t&&l.bottom<i.bottom&&(l.height=i.bottom-l.top)}if(this.columns.frozen){let t=Math.min(this.columns.length,this.columns.frozen),i=this.cells.getCellBoundingRect(0,t-1,!0);this.rightToLeft?(e.leftCol>=t&&s.right>i.left&&(s.left=i.left-s.width),e.rightCol>=t&&l.left>i.left&&(l.left=i.left)):(e.leftCol>=t&&s.left<i.right&&(s.left=i.right),e.rightCol>=t&&l.right<i.right&&(l.width=i.right-l.left))}return this.rightToLeft?new wijmo_1.Rect(l.left,s.top,s.right-l.left,l.bottom-s.top):new wijmo_1.Rect(s.left,s.top,l.right-s.left,l.bottom-s.top)}_bindColumns(){for(let e=0;e<this.columns.length;e++){this.columns[e]._getFlag(RowColFlags.AutoGenerated)&&(this.columns.removeAt(e),e--)}let e=this._cv,t=e?e.sourceCollection:null;t&&t.length&&this.autoGenerateColumns&&wijmo_1.getTypes(t).forEach(e=>{let t=new Column(e);t._setFlag(RowColFlags.AutoGenerated,!0),t.name=e.binding,t.header=wijmo_1.toHeaderCase(e.binding),t.dataType==wijmo_1.DataType.Number&&(t.width=80),this.columns.push(t)}),this._updateColumnTypes()}_updateColumnTypes(){let e=this._cv;if(wijmo_1.hasItems(e)){let t=e.items[0],i=this.columns;for(let e=0;e<i.length;e++){let s=i[e];null==s.dataType&&s._binding&&(s.dataType=wijmo_1.getType(s._binding.getValue(t)))}}}_getBindingColumn(e,t,i){return i}_getRowHeaderPath(){return this._rowHdrPath}_bindRows(){this.rows.clear();let e=this._cv;if(e&&e.items){let t=e.items,i=e.groups;if(this.childItemsPath)for(let e=0;e<t.length;e++)this._addNode(t,e,0);else if(null!=i&&i.length>0&&this.showGroups)for(let e=0;e<i.length;e++)this._addGroup(i[e]);else for(let e=0;e<t.length;e++)this._addBoundRow(t,e)}}_addBoundRow(e,t){this.rows.push(new Row(e[t]))}_addNode(e,t,i){let s=new GroupRow,l=this.childItemsPath,o=wijmo_1.isArray(l)?l[i]:l,n=e[t],r=n[o];if(s.dataItem=n,s.level=i,this.rows.push(s),wijmo_1.isArray(r))for(let e=0;e<r.length;e++)this._addNode(r,e,i+1)}_addGroup(e){let t=new GroupRow;if(t.level=e.level,t.dataItem=e,this.rows.push(t),e.isBottomLevel){let t=e.items;for(let e=0;e<t.length;e++)this._addBoundRow(t,e)}else for(let t=0;t<e.groups.length;t++)this._addGroup(e.groups[t])}static _getSerializableProperties(e){let t=[];for(e=e.prototype;e!=Object.prototype;e=Object.getPrototypeOf(e)){let i=Object.getOwnPropertyNames(e);for(let s=0;s<i.length;s++){let l=i[s],o=Object.getOwnPropertyDescriptor(e,l);o&&o.set&&o.get&&"_"!=l[0]&&!l.match(/disabled|required/)&&t.push(l)}}return t}_copy(e,t){if("columns"==e){this.columns.clear();let e=wijmo_1.asArray(t);for(let t=0;t<e.length;t++){let i=new Column;wijmo_1.copy(i,e[t]),this.columns.push(i)}return!0}return!1}_isInputElement(e){if(e instanceof HTMLElement&&!wijmo_1.hasClass(e,"wj-btn-glyph")){if("true"==e.contentEditable)return!0;let t=e.tagName.match(/^(BUTTON|A|INPUT|TEXTAREA|SELECT|OPTION)$/i);return t&&t.length>0}return!1}_wantsInput(e){return this._isInputElement(e)&&!this.activeEditor&&!this._edtHdl._isNativeCheckbox(e)&&!wijmo_1.hasClass(e,"wj-grid-ime")&&wijmo_1.contains(document.body,e)}static _getMaxSupportedCssHeight(){if(!FlexGrid._maxCssHeight){let e=335e5;wijmo_1.isIE()?e=15e5:wijmo_1.isFirefox()&&(e=175e5),FlexGrid._maxCssHeight=e}return FlexGrid._maxCssHeight}static _getRtlMode(){if(!FlexGrid._rtlMode){let e=wijmo_1.createElement('<div dir="rtl" style="visibility:hidden;width:100px;height:100px;overflow:auto"><div style="width:2000px;height:2000px"></div></div>');document.body.appendChild(e);let t=e.scrollLeft;e.scrollLeft=-1e3;let i=e.scrollLeft;wijmo_1.removeChild(e),FlexGrid._rtlMode=i<0?"neg":t>0?"rev":"std"}return FlexGrid._rtlMode}}FlexGrid._WJS_STICKY="wj-state-sticky",FlexGrid._WJS_MEASURE="wj-state-measuring",FlexGrid._WJS_UPDATING="wj-state-updating",FlexGrid._MIN_VIRT_ROWS=200,FlexGrid.controlTemplate='<div style="position:relative;width:100%;height:100%;overflow:hidden;max-width:inherit;max-height:inherit"><div wj-part="root" style="position:absolute;left:0;top:0;width:100%;height:100%;overflow:auto;max-width:inherit;max-height:inherit;-webkit-overflow-scrolling:touch;"><div wj-part="cells" class="wj-cells" style="position:absolute"></div><div wj-part="marquee" class="wj-marquee" style="display:none;pointer-events:none;"><div style="width:100%;height:100%"></div></div></div><div wj-part="fcells" aria-hidden="true" class="wj-cells wj-frozen-clone" style="position:absolute;top:0;left:0;pointer-events:none;overflow:hidden"></div><div wj-part="rh"><div wj-part="rhcells" class="wj-rowheaders"></div></div><div wj-part="cf"><div wj-part="cfcells" class="wj-colfooters"></div></div><div wj-part="ch"><div wj-part="chcells" class="wj-colheaders"></div></div><div wj-part="bl"><div wj-part="blcells" class="wj-bottomleft"></div></div><div wj-part="tl"><div wj-part="tlcells" class="wj-topleft"></div></div><div wj-part="focus" class="wj-cell" style="position:fixed;left:-32000px">0</div><div wj-part="sz" style="position:relative;visibility:hidden"></div></div>',exports.FlexGrid=FlexGrid,function(e){e[e.None=0]="None",e[e.MoveDown=1]="MoveDown",e[e.MoveAcross=2]="MoveAcross",e[e.Cycle=3]="Cycle",e[e.CycleOut=4]="CycleOut"}(KeyAction=exports.KeyAction||(exports.KeyAction={}));class _KeyboardHandler{constructor(e){this._kaTab=KeyAction.None,this._kaEnter=KeyAction.MoveDown,this._g=e;let t=e.hostElement;e.addEventListener(t,"keypress",this._keypress.bind(this)),e.addEventListener(t,"keydown",this._keydown.bind(this))}_keydown(e){let t=this._g,i=t._edtHdl,s=t.selection,l=e.ctrlKey||e.metaKey,o=e.shiftKey,n=e.target,r=!0;if(this._altDown=!1,t._wantsInput(n))return;let a=e.defaultPrevented&&!(n instanceof HTMLInputElement);if(!t.isRangeValid(s)||a)return;if(t.activeEditor&&i._keydown(e))return;let h=wijmo_1.tryCast(t.rows[s.row],GroupRow),d=t.editableCollectionView,_=t._getKeyCode(e);if(t.autoClipboard){if(l&&(67==_||45==_)){let i=new CellRangeEventArgs(t.cells,s);if(t.onCopying(i)){let e=t.getClipString()+"\r\n";wijmo_1.Clipboard.copy(e),t.onCopied(i)}return void e.stopPropagation()}if(l&&86==_||o&&45==_)return t.isReadOnly||wijmo_1.Clipboard.paste(e=>{t.setClipString(e)}),void e.stopPropagation()}(o||l)&&"Space"==e.code&&(_=wijmo_1.Key.Space);let g=SelMove,c=SelectionMode;switch(_){case wijmo_1.Key.Space:if(o&&s.isValid)switch(t.selectionMode){case c.CellRange:case c.Row:case c.RowRange:case c.ListBox:t.select(new CellRange(s.row,0,s.row,t.columns.length-1))}else if(l&&s.isValid)switch(t.selectionMode){case c.CellRange:t.select(new CellRange(0,s.col,t.rows.length-1,s.col))}else(r=this._startEditing(!0,e))&&setTimeout(()=>{let e=t.activeEditor;e&&(e.disabled||e.readOnly?t.finishEditing():"checkbox"==e.type&&(e.checked=!e.checked,t.finishEditing()))});break;case 65:if(l)switch(t.selectionMode){case c.CellRange:case c.Row:case c.RowRange:case c.ListBox:t.select(new CellRange(0,0,t.rows.length-1,t.columns.length-1))}else r=!1;break;case wijmo_1.Key.Left:l||e.altKey?r=!1:s.isValid&&0==s.leftCol&&null!=h&&!h.isCollapsed&&h.hasChildren?h.isCollapsed=!0:this._moveSel(g.None,l?g.Home:g.Prev,o);break;case wijmo_1.Key.Right:l||e.altKey?r=!1:s.isValid&&0==s.leftCol&&null!=h&&h.isCollapsed?h.isCollapsed=!1:this._moveSel(g.None,l?g.End:g.Next,o);break;case wijmo_1.Key.Up:l?r=!1:(this._altDown=e.altKey,e.altKey?r=i._toggleListBox(e):this._moveSel(g.Prev,g.None,o));break;case wijmo_1.Key.Down:l?r=!1:(this._altDown=e.altKey,e.altKey?r=i._toggleListBox(e):this._moveSel(g.Next,g.None,o));break;case wijmo_1.Key.PageUp:if(this._altDown=e.altKey,this._moveSel(e.altKey?g.Home:g.PrevPage,g.None,o),t.rows.frozen&&t.selection.row<t.rows.frozen){let e=t.scrollPosition;e.y&&(t.scrollPosition=new wijmo_1.Point(e.x,0))}break;case wijmo_1.Key.PageDown:this._altDown=e.altKey,this._moveSel(e.altKey?g.End:g.NextPage,g.None,o);break;case wijmo_1.Key.Home:this._moveSel(l?g.Home:g.None,g.Home,o);break;case wijmo_1.Key.End:this._moveSel(l?g.End:g.None,g.End,o);break;case wijmo_1.Key.Tab:r=this._performKeyAction(t.keyActionTab,o);break;case wijmo_1.Key.Enter:r=this._performKeyAction(t.keyActionEnter,o),!o&&d&&null!=d.currentEditItem&&i._commitRowEdits();break;case wijmo_1.Key.Escape:if(r=!1,d&&(d.currentAddItem||d.currentEditItem)){let e=new CellRangeEventArgs(t.cells,t.selection);e.cancel=!0,t.onRowEditEnding(e),d.currentAddItem&&d.cancelNew(),d.currentEditItem&&d.cancelEdit(),t.onRowEditEnded(e),r=!0}t._mouseHdl.resetMouseState();break;case wijmo_1.Key.Delete:case wijmo_1.Key.Back:r=this._deleteSel(e);break;case wijmo_1.Key.F2:r=this._startEditing(!0,e);break;case wijmo_1.Key.F4:r=i._toggleListBox(e);break;default:r=!1}r&&(t.containsFocus()||t.focus(),e.preventDefault(),e.stopPropagation())}_performKeyAction(e,t){let i=KeyAction,s=SelMove;switch(e){case i.MoveDown:return this._moveSel(t?s.Prev:s.Next,s.None,!1),!0;case i.MoveAcross:return this._moveSel(s.None,t?s.Prev:s.Next,!1),!0;case i.Cycle:return this._moveSel(s.None,t?s.PrevCell:s.NextCell,!1),!0;case i.CycleOut:let l=this._g.selection;return this._moveSel(s.None,t?s.PrevCell:s.NextCell,!1),!l.equals(this._g.selection)}return!1}_keypress(e){let t=this._g;if(t._wantsInput(e.target)||e.defaultPrevented)return;if(this._altDown)return void e.preventDefault();let i=t._edtHdl;if(t.activeEditor)i._keypress(e);else if(e.charCode>wijmo_1.Key.Space)if(this._startEditing(!1,e)&&t.activeEditor){let s=wijmo_1.getActiveElement();if(s instanceof HTMLInputElement&&"checkbox"!=s.type||s instanceof HTMLTextAreaElement){let l=t._selHdl.selection,o=t.getCellData(l.row,l.col,!0),n=t.getCellData(l.row,l.col,!1),r=wijmo_1.culture.Globalize.numberFormat["%"]||"%",a=String.fromCharCode(e.charCode),h=wijmo_1.isNumber(n)&&o.indexOf(r)>-1||""==o&&s.value==r;s.value=a+(h?r:""),wijmo_1.setSelectionRange(s,1),s.dispatchEvent(i._evtInput),i._keypress(e),i._edtValue=s.value!=o?s.value:null,e.preventDefault()}}else if(t.autoSearch){let i=!1,s=t._selHdl.selection;if(e.charCode>32||32==e.charCode&&this._search){e.preventDefault(),this._search+=String.fromCharCode(e.charCode).toLowerCase(),this._toSearch&&clearTimeout(this._toSearch),this._toSearch=setTimeout(()=>{this._toSearch=null,this._search=""},wijmo_1.Control._SEARCH_DELAY);let l=this._findNext(s.row,s.col);l<0&&this._search.length>1&&(this._search=this._search[this._search.length-1],l=this._findNext(s.row,s.col)),l>-1&&(i=!0,t.select(l,s.col))}i||(this._search="")}}_findNext(e,t){let i=this._g,s=i.rows.length;(e<0||1==this._search.length)&&e++;for(let l=0;l<s;l++){let o=(e+l)%s;if(0==i.getCellData(o,t,!0).trim().toLowerCase().indexOf(this._search))return o}return-1}_moveSel(e,t,i){this._g.selectionMode!=SelectionMode.None&&this._g._selHdl.moveSelection(e,t,i)}_deleteSel(e){let t=this._g,i=t.editableCollectionView,s=t.selection,l=t.rows,o=[],n=new CellRange,r=new CellEditEndingEventArgs(t.cells,n,e),a=SelectionMode;if(t.allowDelete&&!t.isReadOnly&&(null==i||i.canRemove&&!i.isAddingNew&&!i.isEditingItem))switch(t.selectionMode){case a.CellRange:if(0==s.leftCol&&s.rightCol==t.columns.length-1)for(let e=s.topRow;e>-1&&e<=s.bottomRow;e++)o.push(l[e]);break;case a.ListBox:for(let e=0;e<l.length;e++)l[e].isSelected&&o.push(l[e]);break;case a.Row:s.topRow>-1&&o.push(l[s.topRow]);break;case a.RowRange:for(let e=s.topRow;e>-1&&e<=s.bottomRow;e++)o.push(l[e])}if(o.length>0){if(t.deferUpdate(()=>{i&&i.beginUpdate();for(let e=o.length-1;e>=0;e--){let s=o[e];n.setRange(s.index,-1),t.onDeletingRow(r)&&(i&&s.dataItem?i.remove(s.dataItem):t.rows.removeAt(s.index),t.onDeletedRow(r))}i&&i.endUpdate()}),t.selectionMode==a.ListBox){let e=t.selection.row;e>-1&&e<t.rows.length&&(t.rows[e].isSelected=!0)}return t.childItemsPath&&t.collectionView&&t.collectionView.refresh(),!0}if(!t.isReadOnly&&0==o.length){let e=!1,l=t.scrollPosition;return t.deferUpdate(()=>{for(let l=s.topRow;l<=s.bottomRow;l++){let o=t.rows[l];if(!o.isReadOnly)for(let a=s.leftCol;a<=s.rightCol;a++){let s=t._getBindingColumn(t.cells,l,t.columns[a]);if(!s.getIsRequired(o)&&!s.isReadOnly&&!o.isReadOnly&&t.getCellData(l,a,!0)&&(n.setRange(l,a),r.cancel=!1,t.onBeginningEdit(r))){if(i){let s=i.currentEditItem;!e&&s&&s!=o.dataItem&&(e=!0,i.beginUpdate()),s=o.dataItem,i.editItem(s),t._edtHdl._edItem=s}t.setCellData(l,a,"",!0,!1),t.onCellEditEnding(r),t.onCellEditEnded(r)}}}t.selection=s,t.scrollPosition=l,e&&i.endUpdate()}),!0}return!1}_startEditing(e,t,i,s){return this._g._edtHdl.startEditing(e,i,s,!0,t)}}exports._KeyboardHandler=_KeyboardHandler;class _ImeHandler{constructor(e){this._updateImeFocusBnd=this._updateImeFocus.bind(this),this._cmpstartBnd=this._compositionstart.bind(this),this._mousedownBnd=this._mousedown.bind(this),this._mouseupBnd=this._mouseup.bind(this),this._keydownBnd=this._keydown.bind(this),this._ignoreKey=!1,this._g=e;let t=wijmo_1.createElement('<textarea class="wj-grid-editor wj-form-control wj-grid-ime" aria-hidden="true"/>');wijmo_1.disableAutoComplete(t),wijmo_1.setCss(t,_ImeHandler._cssHidden),this._tbx=t,e._root.appendChild(t),this._updateImeFocus();let i=e.hostElement,s=e.addEventListener.bind(e);s(t,"compositionstart",this._cmpstartBnd),s(i,"blur",this._updateImeFocusBnd,!0),s(i,"focus",this._updateImeFocusBnd),s(i,"mousedown",this._mousedownBnd,!0),s(i,"mouseup",this._mouseupBnd,!0),s(i,"keydown",this._keydownBnd,!0),e.cellEditEnded.addHandler(this._cellEditEnded,this),e.selectionChanged.addHandler(this._updateImeFocus,this)}dispose(){let e=this._g,t=e.hostElement,i=this._tbx,s=e.removeEventListener.bind(e);s(i,"compositionstart",this._cmpstartBnd),s(t,"blur",this._updateImeFocusBnd),s(t,"focus",this._updateImeFocusBnd),s(t,"mousedown",this._mousedownBnd),s(t,"mouseup",this._mouseupBnd),s(t,"keydown",this._keydownBnd),e.cellEditEnded.removeHandler(this._cellEditEnded),e.selectionChanged.removeHandler(this._updateImeFocus),wijmo_1.removeChild(i)}_keydown(e){let t=this._g;this._ignoreKey=!1,t.activeEditor||"Space"!=e.code||(this._tbx.value="",e.shiftKey||e.ctrlKey?this._ignoreKey=!0:this._compositionstart())}_compositionstart(){let e=this._g;if(!e.activeEditor&&!this._ignoreKey){let t=e._selHdl.selection;if(e.startEditing(!1,t.row,t.col,!1)&&e.activeEditor){t=e.editRange;let i=e.activeEditor,s=this._tbx,l=e.cells.hostElement,o=e.columns[t.col].pos+l.offsetLeft,n=e.rows[t.row].pos+l.offsetTop,r=e.getCellBoundingRect(t.row,t.col),a=wijmo_1.closest(i,".wj-cell");r.width=a.offsetWidth,r.height=a.offsetHeight,t.row<e.frozenRows&&(n+=e._root.scrollTop),t.col<e.frozenColumns&&(o+=e._root.scrollLeft);let h=a.querySelector(".wj-btn.wj-right");h&&(r.width-=h.offsetWidth),"minLength,maxLength,pattern".split(",").forEach(e=>{wijmo_1.setAttribute(s,e,i.getAttribute(e))});let d=i instanceof HTMLTextAreaElement;wijmo_1.setAttribute(s,"wrap",d?"soft":"off");let _=getComputedStyle(a),g=_.paddingTop;if(t.rowSpan>1&&!d){let e=parseFloat(_.lineHeight);isNaN(e)&&(e=1.2*parseFloat(_.fontSize)),g=Math.max(0,(r.height-e)/2)+"px"}wijmo_1.setCss(s,{position:"absolute",left:o,top:n,width:r.width-1,height:r.height-1,paddingTop:g,paddingLeft:_.paddingLeft,paddingRight:_.paddingRight,textAlign:_.textAlign,zIndex:a.style.zIndex}),e._edtHdl._edt=s;let c=i.value;setTimeout(()=>{"　"!=s.value&&" "!=s.value||(s.value=c,wijmo_1.setSelectionRange(s,c.length))},20),i.value=""}}}_cellEditEnded(){wijmo_1.setCss(this._tbx,_ImeHandler._cssHidden),setTimeout(()=>{this._tbx.value=""})}_mousedown(e){this._isMouseDown=!0,this._updateImeFocus()}_mouseup(e){this._isMouseDown=!1,this._updateImeFocus()}_updateImeFocus(){let e=this._g,t=this._tbx,i=wijmo_1.getActiveElement();e.activeEditor||wijmo_1.closest(i,".wj-flexgrid")!=e.hostElement||(this._enableIme()?i!=t&&(t.disabled=!1,t.select(),t.focus()):(t.disabled=!0,t.value=""))}_enableIme(){let e=this._g,t=e._selHdl.selection;if(!e.canEditCell(t.row,t.col))return!1;let i=t.isValid?e._getBindingColumn(e.cells,t.row,e.columns[t.col]):null;return!(!i||i.dataType==wijmo_1.DataType.Boolean)}}_ImeHandler._cssHidden={position:"fixed",left:-10,top:-10,width:"1px",overflow:"hidden"},exports._ImeHandler=_ImeHandler;class _AddNewHandler{constructor(e){this._nrt=new _NewRowTemplate,this._g=e,this._keydownBnd=this._keydown.bind(this),this._attach()}get newRowAtTop(){return this._top}set newRowAtTop(e){e!=this.newRowAtTop&&(this._top=wijmo_1.asBoolean(e),this.updateNewRowTemplate())}updateNewRowTemplate(){let e=this._g,t=e.editableCollectionView,i=e.rows,s=this._nrt,l=t&&t.canAddNew&&e.allowAddNew&&!e.isReadOnly,o=i.indexOf(s),n=this._top?0:i.length-1,r=!1;if(!l&&o>-1){let t=e.selection;t.row==o&&e.select(t.row-1,t.col),i.removeAt(o)}else l&&(o<0?r=!0:o!=n&&(i.removeAt(o),r=!0),r&&(this._top?i.insert(0,s):i.push(s)),s&&(s._setFlag(RowColFlags.ParentCollapsed,!1),this._top&&e.selectionMode==SelectionMode.ListBox||s._setFlag(RowColFlags.Selected,!1)))}_attach(){let e=this._g;e&&(e.beginningEdit.addHandler(this._beginningEdit,this),e.pastingCell.addHandler(this._beginningEdit,this),e.rowEditEnded.addHandler(this._rowEditEnded,this),e.loadedRows.addHandler(this.updateNewRowTemplate,this),e.hostElement.addEventListener("keydown",this._keydownBnd,!0))}_detach(){let e=this._g;e&&(e.beginningEdit.removeHandler(this._beginningEdit),e.pastingCell.removeHandler(this._beginningEdit),e.rowEditEnded.removeHandler(this._rowEditEnded),e.loadedRows.removeHandler(this.updateNewRowTemplate),e.hostElement.removeEventListener("keydown",this._keydownBnd,!0))}_keydown(e){e.defaultPrevented||e.keyCode!=wijmo_1.Key.Escape||null==this._g.activeEditor&&this._top&&this._nrt.dataItem&&(this._nrt.dataItem=null,this._g.invalidate())}_beginningEdit(e,t){if(!t.cancel){let i=e.rows[t.row];if(wijmo_1.tryCast(i,_NewRowTemplate)){let s=e.editableCollectionView;if(s&&s.canAddNew)if(this._top){if(null==this._nrt.dataItem){let e=null,t=s.sourceCollection,i=s.newItemCreator;e=wijmo_1.isFunction(i)?i():t&&t.length?new t[0].constructor:{},this._nrt.dataItem=e}}else{let l=s.currentAddItem&&s.currentAddItem==i.dataItem?s.currentAddItem:s.addNew();s.moveCurrentTo(l),this.updateNewRowTemplate(),e.refresh(!0),e.onRowAdded(t),t.cancel&&s.cancelNew()}}}}_rowEditEnded(e,t){let i=e.editableCollectionView,s=this._nrt.dataItem;if(i&&!this._committing)if(i.isAddingNew)i.commitNew();else if(s&&!t.cancel){this._committing=!0,this._nrt.dataItem=null;let l=i.addNew();for(let e in s)l[e]=s[e];e.onRowAdded(t),t.cancel?i.cancelNew():i.commitNew(),setTimeout(()=>{e.select(0,e.columns.firstVisibleIndex),this.updateNewRowTemplate()},20),this._committing=!1}}}exports._AddNewHandler=_AddNewHandler;class _NewRowTemplate extends Row{}exports._NewRowTemplate=_NewRowTemplate,function(e){e[e.None=0]="None",e[e.Cell=1]="Cell",e[e.ColumnHeader=2]="ColumnHeader",e[e.RowHeader=3]="RowHeader",e[e.TopLeft=4]="TopLeft",e[e.ColumnFooter=5]="ColumnFooter",e[e.BottomLeft=6]="BottomLeft"}(CellType=exports.CellType||(exports.CellType={}));class GridPanel{constructor(e,t,i,s,l){this._offsetY=0,this._rng=new CellRange,this._g=wijmo_1.asType(e,FlexGrid),this._ct=wijmo_1.asInt(t),this._rows=wijmo_1.asType(i,RowCollection),this._cols=wijmo_1.asType(s,ColumnCollection),this._e=wijmo_1.asType(l,HTMLElement),this._vrb=new CellRange}get grid(){return this._g}get cellType(){return this._ct}get viewRange(){return this._getViewRange()}get width(){return this._cols.getTotalSize()}get height(){return this._rows.getTotalSize()}get rows(){return this._rows}get columns(){return this._cols}getCellData(e,t,i){let s,l=this._g,o=this._rows[wijmo_1.asNumber(e,!1,!0)],n=null;if(wijmo_1.isString(t)&&(t=this._cols.indexOf(t))<0)throw"Invalid column name or binding.";s=this._cols[wijmo_1.asNumber(t,!1,!0)];let r=l?l._getBindingColumn(this,e,s):s,a=null;if(o instanceof GroupRow&&o.dataItem instanceof wijmo_1.CollectionViewGroup&&!l.childItemsPath&&(a=o.dataItem),r.binding&&o.dataItem&&!a?n=r._binding.getValue(o.dataItem):o._ubv&&(n=o._ubv[s._hash]),null==n)switch(this._ct){case CellType.ColumnHeader:e!=this._rows.length-1&&r==s||(n=r.header);break;case CellType.ColumnFooter:if(r.aggregate!=wijmo_1.Aggregate.None&&o instanceof GroupRow){let e=this._g.collectionView;if(e){let t=wijmo_1.tryCast(e,wijmo_1.CollectionView);n=t?t.getAggregate(r.aggregate,r.binding):wijmo_1.getAggregate(r.aggregate,e.items,r.binding)}}break;case CellType.Cell:r.aggregate!=wijmo_1.Aggregate.None&&o instanceof GroupRow&&a&&(n=a.getAggregate(r.aggregate,r.binding,this._g.collectionView))}return i&&(this.cellType==CellType.Cell&&r.dataMap&&(n=r.dataMap.getDisplayValue(n)),n=null!=n?wijmo_1.Globalize.format(n,r.format||o.format):""),n}setCellData(e,t,i,s=!0,l=!0){let o,n=this._rows[wijmo_1.asNumber(e,!1,!0)];if(wijmo_1.isString(t)&&(t=this._cols.indexOf(t))<0)throw"Invalid column name or binding.";o=this._cols[wijmo_1.asNumber(t,!1,!0)];let r=this._g?this._g._getBindingColumn(this,e,o):o;if(this._ct==CellType.Cell){if(r.dataMap&&null!=i&&(r.isRequired||""!=i)){let e=r.dataMap,t=e.getKeyValue(i);if(null==t&&null==e.getDisplayValue(null)){if(e.getDisplayValue(i)!=i);else if(!e.isEditable||e.displayMemberPath!=e.selectedValuePath)return!1}else i=t}let l=wijmo_1.DataType.Object,o=r.dataType||n.dataType;if(o)l=o;else{let i=this.getCellData(e,t,!1);l=wijmo_1.getType(i)}let a=r.getIsRequired(n),h=""===i||null==i;if(!a&&h)l!=wijmo_1.DataType.String&&(i=null),s=!1;else if(a&&h&&s)return!1;if(s&&(i=wijmo_1.changeType(i,l,r.format||n.format),l!=wijmo_1.DataType.Object&&wijmo_1.getType(i)!=l))return!1}if(n.dataItem&&r.binding){let e=r._binding,t=n.dataItem,s=e.getValue(t);if(i!==s&&!wijmo_1.DateTime.equals(i,s)){e.setValue(t,i);let s=this._g.collectionView;if(s instanceof wijmo_1.CollectionView&&t!=s.currentEditItem){let e=new wijmo_1.NotifyCollectionChangedEventArgs(wijmo_1.NotifyCollectionChangedAction.Change,t,s.items.indexOf(t));s.onCollectionChanged(e)}}}else n._ubv||(n._ubv={}),n._ubv[o._hash]=i;return l&&this._g&&this._g.invalidate(),!0}getCellBoundingRect(e,t,i){let s=this._g,l=this.rows[e],o=this.columns[t],n=new wijmo_1.Rect(o.pos,l.pos,o.renderSize,l.renderSize);if(s.rightToLeft&&(n.left=this.hostElement.clientWidth-n.right,wijmo_1.isIE()||wijmo_1.isFirefox()||(n.left-=s._root.offsetWidth-s._root.clientWidth)),!i){let e=this.hostElement.getBoundingClientRect();n.left+=e.left,n.top+=e.top-this._offsetY}return e<this.rows.frozen&&(n.top-=s.scrollPosition.y),t<this.columns.frozen&&(n.left-=s.scrollPosition.x*(s.rightToLeft?-1:1)),n}getCellElement(e,t){let i=this.hostElement.children,s=Math.min(e+2,i.length);for(let l=0;l<s;l++){let s=i[l].children,o=Math.min(t+2,s.length);for(let i=0;i<o;i++){let l=s[i],o=l[GridPanel._INDEX_KEY];if(o&&(o.row==e&&o.col==t||o.rng&&o.rng.contains(e,t)))return l}}return null}getSelectedState(e,t,i){let s=this._g,l=s.selectionMode,o=s._selHdl.selection,n=SelectionMode,r=SelectedState;if(l==n.None)return r.None;switch(this._ct){case CellType.Cell:if(i||(i=s.getMergedRange(this,e,t)),i){if(i.contains(o.row,o.col))return s.showMarquee?r.Active:r.Cursor;if(i.intersects(o))return r.Selected}if(o.row==e&&o.col==t)return s.showMarquee?r.Active:r.Cursor;if(s.rows[e].isSelected||s.columns[t].isSelected)return r.Selected;if(i)switch(l){case n.Row:case n.RowRange:case n.ListBox:if(i.containsRow(o.row))return r.Selected}return l==SelectionMode.ListBox?r.None:(o=this._getAdjustedSelection(o)).containsRow(e)&&o.containsColumn(t)?r.Selected:r.None;case CellType.ColumnHeader:if(s.showSelectedHeaders&HeadersVisibility.Column&&(s.columns[t].isSelected||o.containsColumn(t)||o.intersectsColumn(i))&&(i&&(e=i.bottomRow),e==this.rows.length-1))return r.Selected;break;case CellType.RowHeader:if(s.showSelectedHeaders&HeadersVisibility.Row&&(s.rows[e].isSelected||o.containsRow(e)||o.intersectsRow(i))&&(i&&(t=i.rightCol),t==this.columns.length-1))return r.Selected}return r.None}get hostElement(){return this._e}_getAdjustedSelection(e){let t=this._g,i=this._rng,s=SelectionMode;switch(t.selectionMode){case s.Cell:i.setRange(e.row,e.col,e.row,e.col);break;case s.Row:i.setRange(e.row,0,e.row,t.columns.length-1);break;case s.RowRange:case s.ListBox:i.setRange(e.row,0,e.row2,t.columns.length-1);break;default:i.copy(e)}return i}_getOffsetY(){return this._offsetY}_updateContent(e,t,i){let s=this._g,l=this._e,o=this._rows,n=this._cols,r=this._ct;if(r==CellType.ColumnHeader||r==CellType.ColumnFooter||r==CellType.RowHeader){let e=s._ptScrl,t=l.style;r==CellType.RowHeader?t.top=e.y+"px":s.rightToLeft?t.right=e.x+"px":t.left=e.x+"px"}this._offsetY!=i&&(e=!1,this._offsetY=i);let a=this._getViewRange(),h=a;if(h.isValid){let e=o.length<=s._vtRows?o.length:0,t=n.length<=s._vtCols?n.length:0;h=new CellRange(Math.max(a.row-e,o.frozen),Math.max(a.col-t,n.frozen),Math.min(a.row2+e,o.length-1),Math.min(a.col2+t,n.length-1))}if(e&&!t&&this._vrb.contains(a)&&!o.frozen&&!n.frozen)return this._activeCell;e&&h.equals(this._vrb)||(t=!1),e&&!t&&this._ct!=CellType.TopLeft&&this._reorderCells(h,this._vrb),this._activeCell=null,this._vru=a,this._vrb=h,this._cf=s.cellFactory,this._recycle=e;let d=0;this._ct==CellType.Cell&&(d=this._renderColHdrRow(h,t));for(let e=0;e<o.frozen&&e<o.length;e++)d=this._renderRow(e,h,t,d);for(let e=h.topRow;e<=h.bottomRow&&e>-1;e++)d=this._renderRow(e,h,t,d);for(;l.childElementCount>d;){let e=l.lastElementChild;l.removeChild(e),this._removeExtraCells(e,0)}return this._activeCell}_clearCells(){let e=this.hostElement;for(let t=e.childElementCount-1;t>=0;t--){let i=e.children[t];e.removeChild(i);for(let e=i.childElementCount-1;e>=0;e--)this._cf.disposeCell(i.children[e])}}_reorderCells(e,t){if(this._g._reorderCells&&t.isValid&&e.isValid&&e.intersects(t)){if(e.row!=t.row){let i=this._e,s=e.row-t.row,l=Math.max(1,e.rowSpan-1);if(0!=s&&Math.abs(s)<l){let e=this._ct==CellType.Cell?1:0,t=i.childElementCount;if(e+=this.rows.frozen,s>0){let l=e,o=Math.min(e+s,t-1),n=this._createRange(i,l,o);n&&o<t-1&&i.appendChild(n.extractContents())}if(s<0){let l=t,o=Math.max(e,l+s),n=this._createRange(i,o,l);if(n&&o>e){let t=i.children[e];i.insertBefore(n.extractContents(),t)}}}}if(e.col!=t.col){let i=this._e,s=e.col-t.col,l=Math.max(1,e.columnSpan-1);if(0!=s&&Math.abs(s)<l){let e=this._ct==CellType.Cell&&this._g.rowHeaderPath?1:0;e+=this.columns.frozen;for(let t=0;t<i.children.length;t++){let l=i.children[t],o=l.children.length;if(wijmo_1.hasClass(l,"wj-row")){if(s>0){let t=e,i=Math.min(e+s,o-1),n=this._createRange(l,t,i);n&&i<o-1&&l.appendChild(n.extractContents())}if(s<0){let t=o,i=Math.max(e,t+s),n=this._createRange(l,i,t);if(n&&i>e){let t=l.children[e];l.insertBefore(n.extractContents(),t)}}}}}}}}_createRange(e,t,i){if(i>t&&i<=e.children.length&&t>-1){this._docRange||(this._docRange=document.createRange());let s=this._docRange;return s.setStart(e,t),s.setEnd(e,i),s}return null}_renderColHdrRow(e,t){if(t)return 1;let i=this._e.children[0];i||(i=wijmo_1.createElement('<div class="wj-row" role="row"></div>',this._e));let s=this._g,l=s?s.columnHeaders.rows.ariaLabel:null;wijmo_1.setAttribute(i,"aria-label",l),wijmo_1.setAttribute(i,"aria-selected",null);let o=0,n=this._g._getRowHeaderPath();n&&(o=this._renderRowHdrCell(i,-1,n.path));for(let s=0;s<this.columns.frozen&&s<this.columns.length;s++)o=this._renderColHdrCell(i,s,e,t,o);for(let s=e.leftCol;s<=e.rightCol&&s>-1;s++)o=this._renderColHdrCell(i,s,e,t,o);return this._removeExtraCells(i,o),1}_renderColHdrCell(e,t,i,s,l){let o=this.grid,n=this.columns[t];if(n.renderSize<=0)return l;if(s)return l+1;let r=e.children[l];if(r||(r=wijmo_1.createElement('<div class="wj-cell" tabindex="-1"></div>',e)),wijmo_1.setAttribute(r,"role","columnheader"),r&&this._recycle&&o._lazyRender){let e=r[GridPanel._INDEX_KEY];if(e&&-1==e.row&&e.col==t&&t>=this.columns.frozen)return l+1}if(r.textContent=this.columns[t].header,wijmo_1.setCss(r,{position:"fixed",left:n.pos,top:-32e3,width:n.renderSize,height:.1,overflow:"hidden",opacity:"0",pointerEvents:"none"}),n.describedById||this.columns.describedById){let e=[n.describedById,this.columns.describedById].join(" ").trim();wijmo_1.setAttribute(r,"aria-describedby",e||null)}if(o.allowSorting){let e="none";switch(o._getBindingColumn(this,0,n).currentSort){case"+":e="ascending";break;case"-":e="descending"}wijmo_1.setAttribute(r,"aria-sort",e)}return o.isReadOnly||(wijmo_1.setAttribute(r,"aria-readonly",n.isReadOnly),wijmo_1.setAttribute(r,"aria-required",n.getIsRequired())),r[GridPanel._INDEX_KEY]={row:-1,col:t,panel:this},l+1}_renderRowHdrCell(e,t,i){let s=e.children[0];return s||(s=wijmo_1.createElement('<div class="wj-cell" tabindex="-1"></div>',e)),s.setAttribute("role",t<0?"columnheader":"rowheader"),s.textContent=i?i.toString():"",wijmo_1.setCss(s,{position:"fixed",left:-32e3,top:-32e3,width:.1,height:.1,overflow:"hidden",opacity:"0"}),s[GridPanel._INDEX_KEY]={row:t,col:-1,panel:this},1}_renderRow(e,t,i,s){let l=this._g,o=this.rows[e];if(o.renderSize<=0)return s;let n=this._e.children[s];if(n||(n=wijmo_1.createElement('<div class="wj-row"></div>',this._e)),this._ct==CellType.Cell){n.setAttribute("role","row");let t=SelectionMode;switch(l.selectionMode){case t.Row:case t.RowRange:case t.ListBox:let i=o.isSelected||this._g._selHdl.selection.containsRow(e);wijmo_1.setAttribute(n,"aria-selected",!!i)}wijmo_1.setAttribute(n,"aria-level",o instanceof GroupRow?o.level+1:null),wijmo_1.setAttribute(n,"aria-expanded",o instanceof GroupRow?!o.isCollapsed:null),this.rows.ariaLabel&&wijmo_1.setAttribute(n,"aria-label",this.rows.ariaLabel)}let r=0;if(this._ct==CellType.Cell){let t=this._g._getRowHeaderPath();t&&(r=this._renderRowHdrCell(n,e,t.getValue(o.dataItem)))}for(let s=0;s<this.columns.frozen&&s<this.columns.length;s++)r=this._renderCell(n,e,s,t,i,r);for(let s=t.leftCol;s<=t.rightCol&&s>-1;s++)r=this._renderCell(n,e,s,t,i,r);return this._removeExtraCells(n,r),s+1}_renderCell(e,t,i,s,l,o){let n=this._g,r=n.getMergedRange(this,t,i);if(r){for(let e=Math.max(s.row,r.row);e<t;e++)if(this.rows[e].isVisible)return o;for(let e=Math.max(s.col,r.col);e<i;e++)if(this.columns[e].isVisible)return o}let a=this.columns[i];if(a.renderSize<=0&&(!r||r.getRenderSize(this).width<=0))return o;let h=e.children[o];if(h&&!l&&this._recycle&&n._lazyRender&&!n.activeEditor){let e=h[GridPanel._INDEX_KEY];e&&e.row==t&&e.col==i&&e.rng==r&&t>=this.rows.frozen&&i>=this.columns.frozen&&(l=!0)}let d=SelectedState,_=this.getSelectedState(t,i,r),g=_==d.Cursor||_==d.Active;return h&&l?(wijmo_1.toggleClass(h,"wj-state-active",g),wijmo_1.toggleClass(h,"wj-state-selected",_==d.Cursor),wijmo_1.toggleClass(h,"wj-state-multi-selected",_==d.Selected),wijmo_1.setAttribute(h,"aria-selected",g||_!=d.None),g&&(this._activeCell=h),o+1):(h||((h=document.createElement("div")).tabIndex=-1,e.appendChild(h)),g&&(this._activeCell=h),this._ct==CellType.Cell&&(wijmo_1.setAttribute(h,"role","gridcell"),wijmo_1.setAttribute(h,"aria-selected",_!=d.None||g),wijmo_1.setAttribute(h,"aria-readonly",!n.canEditCell(t,i)||null),wijmo_1.setAttribute(h,"aria-required",a.getIsRequired())),n.cellFactory.updateCell(this,t,i,h,r),h[GridPanel._INDEX_KEY]={row:t,col:i,rng:r,panel:this},o+1)}_removeExtraCells(e,t){for(;e.childElementCount>t;){let t=e.lastElementChild;e.removeChild(t),this._cf.disposeCell(t)}}_getViewRange(){let e=this._g,t=e._ptScrl,i=this._rows,s=this._cols,l=new CellRange(0,0,i.length-1,s.length-1);if(this._ct==CellType.Cell||this._ct==CellType.RowHeader){let s=-t.y+this._offsetY,o=e._szClient.height,n=Math.min(i.frozen,i.length-1);if(n>0){let e=i[n-1].pos;s+=e,o-=e}if(l.row=Math.min(i.length-1,Math.max(i.frozen,i.getItemAt(s+1))),l.row2=i.getItemAt(s+o),e._clipToScreen){let t=e.hostElement.getBoundingClientRect();t.top<0&&(l.row=Math.max(l.row,i.getItemAt(-t.top-e._ptScrl.y)-1)),t.bottom>innerHeight&&(l.row2=Math.min(l.row2,i.getItemAt(-t.top-e._ptScrl.y+innerHeight)+1))}}if(this._ct==CellType.Cell||this._ct==CellType.ColumnHeader){let i=-t.x,o=e._szClient.width,n=Math.min(s.frozen,s.length-1);if(n>0){let e=s[n-1].pos;i+=e,o-=e}l.col=Math.min(s.length-1,Math.max(s.frozen,s.getItemAt(i+1))),l.col2=s.getItemAt(i+o)}return i.length<=i.frozen&&(l.row=l.row2=-1),s.length<=s.frozen&&(l.col=l.col2=-1),l}_getFrozenPos(){let e=this._rows.frozen,t=this._cols.frozen,i=e>0?this._rows[e-1]:null,s=t>0?this._cols[t-1]:null,l=i?i.pos+i.renderSize:0,o=s?s.pos+s.renderSize:0;return new wijmo_1.Point(o,l)}}GridPanel._INDEX_KEY="wj-cell-index",exports.GridPanel=GridPanel,function(e){e[e.None=0]="None",e[e.Cells=1]="Cells",e[e.ColumnHeaders=2]="ColumnHeaders",e[e.RowHeaders=4]="RowHeaders",e[e.AllHeaders=6]="AllHeaders",e[e.All=7]="All"}(AllowMerging=exports.AllowMerging||(exports.AllowMerging={}));class MergeManager{constructor(e){this._g=e}getMergedRange(e,t,i,s=!0){let l=this._g,o=e.cellType,n=e.columns,r=e.rows,a=r[t],h=n[i];if(a instanceof _NewRowTemplate)return null;if(l.showGroups&&!l.childItemsPath&&a instanceof GroupRow&&a.dataItem instanceof wijmo_1.CollectionViewGroup&&o==CellType.Cell){let e=new CellRange(t,i);if(h.aggregate==wijmo_1.Aggregate.None){for(;e.col>0&&n[e.col-1].aggregate==wijmo_1.Aggregate.None&&e.col!=n.frozen;)e.col--;for(;e.col2<n.length-1&&n[e.col2+1].aggregate==wijmo_1.Aggregate.None&&e.col2+1!=n.frozen;)e.col2++}for(;e.col<i&&!n[e.col].visible;)e.col++;return e.isSingleCell?null:e}let d=!1,_=AllowMerging,g=CellType;switch(l.allowMerging){case _.None:d=!0;break;case _.Cells:d=o!=g.Cell;break;case _.ColumnHeaders:d=o!=g.ColumnHeader&&o!=g.TopLeft;break;case _.RowHeaders:d=o!=g.RowHeader&&o!=g.TopLeft;break;case _.AllHeaders:d=o==g.Cell}if(d)return null;if(n[i].allowMerging){let n=new CellRange(t,i),a=e._vrb,h=0,d=r.length-1;t>=r.frozen?!s||o!=CellType.Cell&&o!=CellType.RowHeader||l._vtRows<r.length&&a&&(h=a.topRow,d=a.bottomRow):d=r.frozen-1;for(let s=t-1;s>=h&&this._mergeCell(e,s,i,t,i);s--)n.row=s;for(let s=t+1;s<=d&&this._mergeCell(e,t,i,s,i);s++)n.row2=s;for(;n.row<t&&!r[n.row].visible;)n.row++;if(!n.isSingleCell)return n}if(r[t].allowMerging){let r=new CellRange(t,i),a=e._vrb,h=0,d=n.length-1;i>=n.frozen?!s||o!=CellType.Cell&&o!=CellType.ColumnHeader||l._vtCols<n.length&&a&&(h=a.leftCol,d=a.rightCol):d=n.frozen-1;for(let s=i-1;s>=h&&this._mergeCell(e,t,s,t,i);s--)r.col=s;for(let s=i+1;s<=d&&this._mergeCell(e,t,i,t,s);s++)r.col2=s;for(;r.col<i&&!n[r.col].visible;)r.col++;if(!r.isSingleCell)return r}return null}_mergeCell(e,t,i,s,l){let o=e.rows[t],n=e.rows[s];if(o instanceof GroupRow||o instanceof _NewRowTemplate||n instanceof GroupRow||n instanceof _NewRowTemplate)return!1;if(t!=s&&e.rows.isFrozen(t)!=e.rows.isFrozen(s))return!1;if(i!=l&&e.columns.isFrozen(i)!=e.columns.isFrozen(l))return!1;if(t!=s){if(i>0&&(o.allowMerging&&this._mergeCell(e,t,i-1,t,i)||n.allowMerging&&this._mergeCell(e,s,i-1,s,i)))return!1;if(l<e.columns.length-1&&(o.allowMerging&&this._mergeCell(e,t,l,t,l+1)||n.allowMerging&&this._mergeCell(e,s,l,s,l+1)))return!1}return e.getCellData(t,i,!0)==e.getCellData(s,l,!0)}}exports.MergeManager=MergeManager;class HitTestInfo{constructor(e,t){let i;if(this._row=-1,this._col=-1,this._edge=0,t instanceof Element){if(wijmo_1.closest(t,".wj-flexgrid")!=e.hostElement)return;e=t}if(e instanceof Element&&!(e instanceof FlexGrid)){let t=wijmo_1.closest(e,".wj-cell"),i=t?t[GridPanel._INDEX_KEY]:null;return void(i&&(this._row=i.row,this._col=i.col,this._rng=i.rng,this._p=i.panel,this._g=i.panel.grid))}if(e instanceof FlexGrid)i=this._g=e;else{if(!(e instanceof GridPanel))throw"First parameter should be a FlexGrid or GridPanel.";this._p=e,i=this._g=this._p.grid}t instanceof MouseEvent&&"mousedown"==t.type&&(i._rcBounds=null),t=wijmo_1.mouseToPage(t),this._pt=t.clone();let s=i.controlRect,l=i._szClient,o=i.topLeftCells,n=i._eTL,r=i.headersVisibility,a=HeadersVisibility,h=r&a.Row?o.columns.getTotalSize():0,d=r&a.Column?o.rows.getTotalSize():0,_=r&a.Column?d+n.offsetTop:0,g=i._eBL,c=g.offsetHeight;if(t.x-=s.left,t.y-=s.top,this._g.rightToLeft&&(t.x=s.width-t.x),!this._p&&t.x>=0&&t.y>=n.offsetTop&&l&&t.x<=l.width+h&&t.y<=l.height+_&&(t.y<_?this._p=t.x<h?i.topLeftCells:i.columnHeaders:t.y<g.offsetTop?this._p=t.x<h?i.rowHeaders:i.cells:this._p=t.x<h?i.bottomLeftCells:i.columnFooters),null!=this._p){let e=this._p.rows,s=this._p.columns,l=this._p.cellType,o=CellType,n=this._p._getFrozenPos(),r=l==o.TopLeft||l==o.ColumnHeader?d:l==o.BottomLeft||l==o.ColumnFooter?c:e.getTotalSize(),a=l==o.TopLeft||l==o.BottomLeft||l==o.RowHeader?h:s.getTotalSize();l==o.RowHeader||l==o.Cell?(t.y-=d,(t.y>n.y||n.y<=0)&&(t.y-=i._ptScrl.y,t.y+=this._p._getOffsetY())):l!=o.BottomLeft&&l!=o.ColumnFooter||(t.y-=g.offsetTop),l!=o.ColumnHeader&&l!=o.Cell&&l!=o.ColumnFooter||(t.x-=h,(t.x>n.x||n.x<=0)&&(t.x-=i._ptScrl.x)),l!=o.ColumnHeader&&l!=o.TopLeft||(t.y-=_-d),this._edge=0;let w=HitTestInfo._SZEDGE[this._g.isTouching?1:0];if(this._g.isTouching&&(w=HitTestInfo._SZEDGE[1],t.x-=w/2),this._row=t.y>r?-1:e.getItemAt(t.y),this._col=t.x>a?-1:s.getItemAt(t.x),this._row<0||this._col<0)return void(this._p=null);if(this._col>-1){let e=s[this._col];t.x-e.pos<=w&&(this._edge|=1),e.pos+e.renderSize-t.x<=w&&(this._edge|=4)}if(this._row>-1){let i=e[this._row];t.y-i.pos<=w&&(this._edge|=2),i.pos+i.renderSize-t.y<=w&&(this._edge|=8)}}}get point(){return this._pt}get cellType(){return this._p?this._p.cellType:CellType.None}get panel(){return this._p}get grid(){return this._p?this._p.grid:null}get row(){return this._row}get col(){return this._col}get range(){return this._rng||(this._rng=new CellRange(this._row,this._col)),this._rng}get edgeLeft(){return 0!=(1&this._edge)}get edgeTop(){return 0!=(2&this._edge)}get edgeRight(){return 0!=(4&this._edge)}get edgeBottom(){return 0!=(8&this._edge)}}function softInput(){return wijmo_1._getModule("wijmo.input")}HitTestInfo._SZEDGE=[5,30],exports.HitTestInfo=HitTestInfo,exports.softInput=softInput;class CellFactory{updateCell(e,t,i,s,l,o){let n=e.grid,r=n.rightToLeft,a=CellType,h=e.rows,d=e.columns,_=h[t],g=d[i],c=t,w=i,u=_ instanceof GroupRow?_:null,m=_ instanceof _NewRowTemplate?_:null,p=g.renderWidth,C=_.renderHeight,f=e.cellType,R="wj-cell",y="",v={display:""};if(0!=o&&s.firstElementChild&&(1==s.childNodes.length&&"checkbox"==s.firstElementChild.type||(s.textContent="")),l&&!l.isSingleCell){t=l.row,i=l.col,c=l.row2,w=l.col2,_=h[t],g=d[i],u=_ instanceof GroupRow?_:null;let s=l.getRenderSize(e);C=s.height,p=s.width}let j=n._getBindingColumn(e,t,g),S=j.dataType||_.dataType,E=j.dataMap&&0!=j.showDropDown||_.dataMap&&0!=_.showDropDown,b=S==wijmo_1.DataType.Boolean&&!E,x=g.pos,z=_.pos;n._useFrozenDiv()&&f==a.Cell&&!n.editRange?(t<h.frozen&&i>=d.frozen&&(x+=n._ptScrl.x),i<d.frozen&&t>=h.frozen&&(z+=n._ptScrl.y)):(t<h.frozen&&(z-=n._ptScrl.y),i<d.frozen&&(x-=n._ptScrl.x)),r?v.right=x+"px":v.left=x+"px",v.top=z-e._getOffsetY()+"px",v.width=p+"px",v.height=C+"px",v.zIndex="",(t<h.frozen||i<d.frozen)&&(v.zIndex=t<h.frozen&&i<d.frozen?2:1);let T=!1,H=n.alternatingRowStep;H&&(l&&l.row!=l.row2||(T=_.visibleIndex%(H+1)==0,1==H&&(T=!T))),f==a.Cell?(u&&(R+=" wj-group"),T&&(R+=" wj-alt"),(t<h.frozen||i<d.frozen)&&(R+=" wj-frozen"),m&&(R+=" wj-new"),_.cssClass&&(R+=" "+_.cssClass),j.cssClass&&(R+=" "+j.cssClass)):(R+=" wj-header",T&&(R+=" wj-header-alt")),_.cssClassAll&&(R+=" "+_.cssClassAll),j.cssClassAll&&(R+=" "+j.cssClassAll);let M=SelectedState,A=e.getSelectedState(t,i,l);switch(A!=M.None&&f==a.Cell&&!b&&n.editRange&&n.editRange.contains(t,i)&&(A=M.None),A){case M.Active:R+=" wj-state-active";break;case M.Cursor:R+=" wj-state-selected wj-state-active";break;case M.Selected:R+=" wj-state-multi-selected"}c==h._lastFrozen&&(R+=" wj-frozen-row"),w==d._lastFrozen&&(R+=" wj-frozen-col"),(j.wordWrap||_.wordWrap)&&(R+=" wj-wrap"),(j.multiLine||_.multiLine)&&(R+=" wj-multiline");let I=j.getAlignment(_);if(I&&(y=" wj-align-"+I),v.paddingLeft=v.paddingRight=v.paddingTop=v.paddingBottom="",f==a.Cell&&n.rows.maxGroupLevel>-1&&i==n.columns.firstVisibleIndex&&n.treeIndent){let e=u?Math.max(0,u.level):n.rows.maxGroupLevel+1,t=n.treeIndent*e+n._cellPadLeft;r?v.paddingRight=t+"px":v.paddingLeft=t+"px"}if(0!=o){let l=e.getCellData(t,i,!1),o=e.getCellData(t,i,!0);if(f==a.Cell&&i==n.columns.firstVisibleIndex&&u&&u.hasChildren&&!this._isEditingCell(n,t,i)){let e=this._getTreeBtn(u);o=wijmo_1.escapeHtml(o)||u.getGroupHeader(),s.innerHTML=e.outerHTML+" "+o,y=""}else if(f==a.ColumnHeader&&j.currentSort&&n.showSort&&(c==n._getSortRowIndex()||j!=g))R+=" wj-sort-"+("+"==j.currentSort?"asc":"desc"),s.innerHTML=wijmo_1.escapeHtml(o)+"&nbsp;"+this._getSortIcon(j);else if(f!=a.RowHeader||i!=n._getEditColumnIndex()||o)if(f!=a.Cell||S!=wijmo_1.DataType.Boolean||E||u&&!wijmo_1.isBoolean(l))if(f==a.Cell&&this._isEditingCell(n,t,i)){let l=j.inputType||_.inputType;if(l||(l=S!=wijmo_1.DataType.Number||E?"text":"tel"),!E&&!j.mask&&!_.mask){let s=e.getCellData(t,i,!1);if(wijmo_1.isNumber(s)){let e=s.toString(),t=j.format||_.format;if(t&&s!=Math.round(s)){let i=e.match(/\.(\d+)/)[1].length;t=t.replace(/([a-z])(\d*)(.*)/gi,"$01"+i+"$3")}o=wijmo_1.Globalize.formatNumber(s,t,!0)}}s.innerHTML=(j.multiLine||_.multiLine)&&"checkbox"!=l?'<textarea wrap="soft"></textarea>':'<input type="'+l+'"/>';let r=s.children[0];wijmo_1.addClass(r,"wj-grid-editor wj-form-control"),wijmo_1.disableAutoComplete(r),r.value=o,r.required=j.getIsRequired(_),wijmo_1.setAttribute(r,"aria-required",r.required);let a=j.maxLength||_.maxLength;a&&(r.maxLength=a),r.style.textAlign=j.getAlignment(_);let h=j.mask||_.mask;h&&new wijmo_1._MaskProvider(r,h),n._edtHdl._edt=r}else f==a.Cell&&(_.isContentHtml||j.isContentHtml)?s.innerHTML=o:s.textContent=o||"";else{let e=s.firstChild;e instanceof HTMLInputElement&&"checkbox"==e.type||(s.innerHTML='<input type="checkbox" class="wj-cell-check" tabindex="-1"/>',e=s.firstChild),e.checked=1==l,e.indeterminate=null==l,e.disabled=!n.canEditCell(t,i),e.disabled&&(e.style.cursor="default"),n.editRange&&n.editRange.contains(t,i)&&(n._edtHdl._edt=e)}else{let e=n.editableCollectionView,t=e?e.currentEditItem:null;t&&_.dataItem==t?s.innerHTML='<span class="wj-glyph-pencil"></span>':_ instanceof _NewRowTemplate&&(s.innerHTML='<span class="wj-glyph-asterisk"></span>')}if(f==a.Cell&&E&&softInput()&&n.showDropDown&&n.canEditCell(t,i)){if(!CellFactory._ddBtn){let e=CellFactory._WJC_DROPDOWN,t=wijmo_1.createElement('<button class="wj-btn wj-btn-glyph wj-right '+e+'" type="button" tabindex="-1"><span class="wj-glyph-down"></span></button>');wijmo_1.setAriaLabel(t,wijmo_1.culture.FlexGrid.ariaLabels.toggleDropDown),wijmo_1.setAttribute(t,"aria-expanded",!1),CellFactory._ddBtn=t}let e=CellFactory._ddBtn.cloneNode(!0);s.appendChild(e)}}if(f==a.RowHeader||f==a.ColumnHeader){let e=f==a.RowHeader?!u&&!m&&_.allowDragging&&0!=(n.allowDragging&AllowDragging.Rows):g.allowDragging&&0!=(n.allowDragging&AllowDragging.Columns);wijmo_1.setAttribute(s,"draggable",e?"true":null)}R+=y,s.className!=R&&(s.className=R);let L=s.style;for(var D in v)L[D]!==v[D]&&(L[D]=v[D]);if(n._edtHdl._edt&&n._edtHdl._edt.parentElement==s){let e=n._root,t=e.getBoundingClientRect(),i=s.getBoundingClientRect(),l=t.top+e.clientHeight-i.top,o=t.left+e.clientWidth-i.left;i.height>l&&(s.style.height=l+"px"),i.width>o&&(s.style.width=o+"px")}if((f==a.Cell||f==a.RowHeader)&&n._getShowErrors()){let l=n._getError(e,t,i);n._edtHdl._setCellError(s,l)}if(n.itemFormatter&&n.itemFormatter(e,t,i,s),n.formatItem.hasHandlers){let l=CellFactory._fmtRng;l?l.setRange(t,i,c,w):l=CellFactory._fmtRng=new CellRange(t,i,c,w);let o=new FormatItemEventArgs(e,l,s);n.onFormatItem(o)}}disposeCell(e){}getEditorValue(e){let t=e._edtHdl._edt;if(t instanceof HTMLInputElement&&"checkbox"==t.type)return t.checked;if(t instanceof HTMLInputElement||t instanceof HTMLTextAreaElement){let e=t.maxLength;return wijmo_1.isNumber(e)&&e>-1&&t.value.length>e?t.value.substr(0,e):t.value}return null}_isEditingCell(e,t,i){return e.editRange&&e.editRange.contains(t,i)}_getTreeBtn(e){let t=CellFactory._WJC_COLLAPSE,i=(e.isCollapsed?"":"down-")+(e.grid.rightToLeft?"left":"right"),s=wijmo_1.createElement('<button class="wj-btn wj-btn-glyph '+t+'" type="button" tabindex="-1"><span class="wj-glyph-'+i+'"></span></button>');return wijmo_1.setAriaLabel(s,wijmo_1.culture.FlexGrid.ariaLabels.toggleGroup),wijmo_1.setAttribute(s,"aria-expanded",!e.isCollapsed),s}_getSortIcon(e){return'<span class="wj-glyph-'+("+"==e.currentSort?"up":"down")+'"></span>'}}CellFactory._WJC_COLLAPSE="wj-elem-collapse",CellFactory._WJC_DROPDOWN="wj-elem-dropdown",exports.CellFactory=CellFactory;const _WJC_CHECKBOX="wj-cell-check",_PAGE_SIZE=4;class _EditHandler{constructor(e){this._fullEdit=!1,this._list=null,this._g=e,this._evtInput=document.createEvent("HTMLEvents"),this._evtInput.initEvent("input",!0,!1),this._evtChange=document.createEvent("HTMLEvents"),this._evtChange.initEvent("change",!0,!1),e.selectionChanging.addHandler((t,i)=>{if(this.finishEditing()){let t=e._selHdl.selection.row;if(t!=i.row){let s=e.rows.length;(t>-1&&t<s?e.rows[t].dataItem:null)!=(i.row>-1&&i.row<s?e.rows[i.row].dataItem:null)&&this._commitRowEdits()}}else i.cancel=!0}),e.lostFocus.addHandler(()=>{let e=wijmo_1.getActiveElement();e&&"fixed"==getComputedStyle(e).position?this.finishEditing():this._commitRowEdits()});let t=e.hostElement;e.addEventListener(t,"mousedown",t=>{if(t.defaultPrevented||0!=t.button)return;if(e._mouseHdl._szRowCol)return;e.selection;let i=e.hitTest(t);if(i.cellType!=CellType.Cell&&i.cellType!=CellType.None)this.finishEditing();else if(i.cellType!=CellType.None){let s=wijmo_1.tryCast(t.target,HTMLInputElement);this._isNativeCheckbox(s)&&(s!=this.activeEditor&&(t.preventDefault(),this.startEditing(!1,i.row,i.col,!0,t)&&(s=this.activeEditor)),!s||"checkbox"!=s.type||s.disabled||s.readOnly||(s.checked=!s.checked,e._setFocusNoScroll(s),this.finishEditing()))}},!0),e.addEventListener(t,"click",e=>{this._isNativeCheckbox(e.target)&&(e.preventDefault(),e.stopImmediatePropagation())},!0),e.addEventListener(t,"compositionend",this._keypress.bind(this))}startEditing(e=!0,t,i,s,l){let o=this._g;if(t=wijmo_1.asNumber(t,!0,!0),i=wijmo_1.asNumber(i,!0,!0),null==t&&(t=o.selection.row),null==i&&(i=o.selection.col),null==s&&(s=!0),!this._allowEditing(t,i))return!1;let n=o.getMergedRange(o.cells,t,i,!1);n||(n=new CellRange(t,i));let r=o.rows[t].dataItem;if(o.scrollIntoView(n.row,n.col,!0),o.select(n,!0),!o.rows[t]||r!=o.rows[t].dataItem)return!1;if(n.equals(this._rng))return!0;if(this.activeEditor&&!this.finishEditing())return!1;let a=new CellRangeEventArgs(o.cells,n,l);if(!o.onBeginningEdit(a))return!1;let h=o.editableCollectionView,d=!1;h&&((d=(r=o.rows[t].dataItem)!=h.currentEditItem)&&o.onRowEditStarting(a),h.editItem(r),d&&(o.onRowEditStarted(a),this._edItem=r)),this._fullEdit=wijmo_1.asBoolean(e),this._rng=n,this._list=null;let _=o.rows[t],g=o._getBindingColumn(o.cells,t,o.columns[i]),c=g.dataMap||_.dataMap;c&&(this._list=c.getDisplayValues(r)),n.isSingleCell?this._updateEditorCell(t,i,d):o.refresh(!1);let w=this._edt;if(w){if("checkbox"==w.type)this._fullEdit=!1;else if(s){let e=0,s=w.value.length,n=!1,r=wijmo_1.culture.Globalize.numberFormat["%"]||"%",a=o.getCellData(t,i,!1);if(wijmo_1.isNumber(a)?n=w.value.indexOf(r)>-1:null==a&&(n=/^p/i.test(g.format))&&w.value.indexOf(r)<0&&(w.value+=r),n){let t=w.value;for(e=0,s=t.length;s>0&&(t[s-1]==r||" "==t[s-1]);)s--;for(;e<s&&t[e]==r;)e++}l&&"keydown"==l.type&&l.keyCode==wijmo_1.Key.Space&&(e=s),wijmo_1.setSelectionRange(w,e,s),wijmo_1.isIE()&&"right"==w.style.textAlign&&(w.style.paddingRight="1px")}o.onPrepareCellForEdit(a)}return null!=w&&!w.disabled&&!w.readOnly}finishEditing(e){let t=this._edt;if(!t)return this._removeListBox(),!0;let i=this._g,s=this._rng,l=new CellEditEndingEventArgs(i.cells,s),o=i.containsFocus(),n=i.hostElement.querySelector(".wj-control.wj-state-focused");if(n){let e=wijmo_1.Control.getControl(n);e&&e.onLostFocus(l)}if(l.cancel=e,!e&&i.validateEdits){let e=this._getValidationError();if(e){l.cancel=!0;let i=t.parentElement;i&&(this._setCellError(i,e),l.stayInEditMode=!0)}}if(!i.onCellEditEnding(l)&&l.stayInEditMode)return o?setTimeout(()=>{t.select()}):t.select(),!1;if(!l.cancel){l.data=i.cells.getCellData(s.topRow,s.leftCol,!1);let e=i.cellFactory.getEditorValue(i);for(let t=s.topRow;t<=s.bottomRow&&t<i.rows.length;t++)for(let l=s.leftCol;l<=s.rightCol&&l<i.columns.length;l++)i.cells.setCellData(t,l,e,!0,!1);t.value==this._edtValue&&t.dispatchEvent(this._evtChange)}this._edt=null,this._rng=null,this._list=null,this._edtValue=null,this._removeListBox();let r=wijmo_1.closest(t,".wj-cell");return wijmo_1.contains(r,wijmo_1.getActiveElement())&&r.focus(),!l.cancel&&l.refresh&&i._refreshOnEdit?i.refresh(!1):this._updateEditorCell(s.row,s.col,!1),o&&i.focus(),i.onCellEditEnded(l),!0}_setCellError(e,t){""==t&&(t=null),wijmo_1.toggleClass(e,"wj-state-invalid",null!=t);let i=this._g.errorTip;i?i.setTooltip(e,t):wijmo_1.setAttribute(e,"title",t)}get activeEditor(){return this._edt}get editRange(){return this._rng}getClipString(e,t,i,s){let l=this._g,o=[],n=SelectionMode;if(!e)switch(e=l.selection,l.selectionMode){case n.Row:case n.RowRange:case n.ListBox:e.col=0,e.col2=l.columns.length-1}if(i){let i=l.columnHeaders;i.rows.forEach((l,n)=>{if(l.isVisible){let l=this._getRowClipString(i,n,e.leftCol,e.rightCol,t,s);o.push(l)}})}let r=l.cells;if(l.selectionMode==n.ListBox)r.rows.forEach((i,l)=>{if(i.isSelected&&i.isVisible){let i=this._getRowClipString(r,l,e.leftCol,e.rightCol,t,s);o.push(i)}});else for(let i=e.topRow;i<=e.bottomRow;i++)if(r.rows[i].isVisible){let l=this._getRowClipString(r,i,e.leftCol,e.rightCol,t,s);o.push(l)}return o.join(t?"\r\n":"\n")}_getRowClipString(e,t,i,s,l,o){let n="",r=l?",":"\t",a=e.rows[t];if(a.isVisible){if(o){let i=e.cellType==CellType.ColumnHeader?e.grid.topLeftCells:e.grid.rowHeaders;for(let e=0;e<i.columns.length;e++)if(i.columns[e].isVisible){let s=i.getCellData(t,e,!0);n&&(n+=r),n+=this._getCellClipString(s,l)}}for(let o=i;o<=s;o++)if(e.columns[o].isVisible){let i=e.getCellData(t,o,!0);!i&&a instanceof GroupRow&&o==e.columns.firstVisibleIndex&&(i=wijmo_1.toPlainText(a.getGroupHeader())),n&&(n+=r),n+=this._getCellClipString(i,l)}}return n}_getCellClipString(e,t){e=e.replace(/\t/g," "),t&&(e=e.replace(/"/g,'""'));let i=e.indexOf("\n")>-1;return!i&&t&&(i=e.indexOf('"')>-1||e.indexOf(",")>-1),i&&(!t&&e.match(/^".?"$/)||(e='"'+e+'"')),e}setClipString(e,t){let i=this._g,s=null==t,l=SelectionMode;if(!t)switch(t=i.selection,i.selectionMode){case l.Row:case l.RowRange:case l.ListBox:t.col=0,t.col2=i.columns.length-1}t=wijmo_1.asType(t,CellRange);let o=this._parseClipString(wijmo_1.asString(e));s&&!t.isSingleCell&&o.length&&this._expandClipRows(o,t);let n=new CellRange(t.topRow,t.leftCol,t.topRow+o.length-1,t.leftCol+o[0].length-1),r=new CellRangeEventArgs(i.cells,n);if(!i.onPasting(r))return!1;n=new CellRange(t.topRow,t.leftCol);let a=i.editableCollectionView,h=!1,d=t.topRow;i.deferUpdate(()=>{a&&o.length>1&&a.beginUpdate();for(let e=0;e<o.length&&d<i.rows.length;e++,d++){let s=i.rows[d];if(!s.isVisible){e--;continue}let l=o[e],r=t.leftCol;for(let e=0;e<l.length&&r<i.columns.length;e++,r++){let t=i.columns[r];if(t.isVisible){if(this._allowEditing(d,r)){let o=l[e],_=t.maxLength||s.maxLength;_&&(o=o.substr(0,_));let g=new CellRangeEventArgs(i.cells,new CellRange(d,r),o);i.onPastingCell(g)&&(a&&(a.editItem(i.rows[d].dataItem),this._edItem=a.currentEditItem),i.cells.setCellData(d,r,g.data)&&(i.onPastedCell(g),h=!0)),n.row2=Math.max(n.row2,d),n.col2=Math.max(n.col2,r)}}else e--}if(this._edItem&&a instanceof wijmo_1.CollectionView){let e=new wijmo_1.NotifyCollectionChangedEventArgs(wijmo_1.NotifyCollectionChangedAction.Change,this._edItem,d);a.onCollectionChanged(e)}}if(a&&o.length>1&&a.endUpdate(),i.select(n),i.onPasted(r),h&&wijmo_1.closest(i.hostElement,"form")){let e=wijmo_1.createElement("<input>",i.hostElement),t=document.createEvent("HTMLEvents");t.initEvent("change",!0,!1),e.dispatchEvent(t),wijmo_1.removeChild(e)}})}_isNativeCheckbox(e){return e instanceof HTMLInputElement&&"checkbox"==e.type&&!e.disabled&&!e.readOnly&&wijmo_1.hasClass(e,_WJC_CHECKBOX)&&wijmo_1.closest(e,".wj-flexgrid")==this._g.hostElement}_parseClipString(e){let t=[];e=(e=e.replace(/\r\n/g,"\n").replace(/\r/g,"\n")).replace(/\n$/,"");let i=0,s=0;for(i=0;i<e.length;i++){let l='"'==e[i]&&e[i+1]>=" ",o=!1,n=!1;for(s=i;s<e.length&&!n;s++){let r=e[s];switch(r){case'"':l&&(o=!o);break;case"\t":case"\n":o||(this._parseClipCell(t,e,i,s,"\n"==r),i=s,n=!0)}}if(s==e.length){this._parseClipCell(t,e,i,s,!1);break}}return 0==t.length&&t.push([""]),t}_parseClipCell(e,t,i,s,l){e.length||e.push([]);let o=t.substr(i,s-i),n=o.length;n>1&&'"'==o[0]&&'"'==o[n-1]?o=(o=o.substr(1,n-2)).replace(/""/g,'"'):"\t"==o&&(o=""),e[e.length-1].push(o),l&&e.push([])}_expandClipRows(e,t){let i=e.length,s=0;for(let t=0;t<i;t++)s=Math.max(s,e[t].length);let l=this._g,o=0,n=0;for(let e=t.topRow;e<=t.bottomRow;e++)l.rows[e].isVisible&&o++;for(let e=t.leftCol;e<=t.rightCol;e++)l.columns[e].isVisible&&n++;if((o>1||n>1)&&(1==o&&(o=i),1==n&&(n=s),n%s==0&&o%i==0)){for(let t=s;t<n;t++)for(let l=0;l<i;l++)e[l].push(e[l%i][t%s]);for(let t=i;t<o;t++)e.push(e[t%i])}}_updateEditorCell(e,t,i){let s=this._g,l=s.cells.getCellElement(e,t),o=s._useFrozenDiv()&&(e<s.frozenRows||t<s.frozenColumns);if(!l||o||s._hasPendingUpdates())s.refresh(!1);else if(this._updateCell(l),(i=i||s._getHasValidation())&&s.headersVisibility&HeadersVisibility.Row){let t=s.rowHeaders,i=s._getEditColumnIndex(),l=t.getCellElement(e,i);l&&this._updateCell(l)}}_updateCell(e){let t=new HitTestInfo(e,null),i=FlexGrid._WJS_UPDATING;t.panel&&(wijmo_1.addClass(e,i),t.grid.cellFactory.updateCell(t.panel,t.row,t.col,e,t.range),wijmo_1.removeClass(e,i))}_getValidationError(){let e=this._g;if(e._getHasValidation()){let t=this._rng.row,i=this._rng.col,s=e.cellFactory.getEditorValue(e),l=e.getCellData(t,i,!1);if(e.setCellData(t,i,s,!0,!1)){let s=e._getError(e.cells,t,i);return e.setCellData(t,i,l,!1,!1),s}}return null}_allowEditing(e,t){let i=this._g;if(i.isReadOnly||i.selectionMode==SelectionMode.None)return!1;if(e<0||e>=i.rows.length||t<0||t>=i.columns.length)return!1;let s=i.rows[e];if(!s||s.isReadOnly||!s.isVisible)return!1;let l=i._getBindingColumn(i.cells,e,i.columns[t]);return!(!l||l.isReadOnly||!l.isVisible)}_commitRowEdits(){let e=this._g;if(this.finishEditing()&&this._edItem){let t=e.editableCollectionView;if(t&&(t.currentEditItem||t.currentAddItem)){let i=new CellRangeEventArgs(e.cells,e.selection);e.onRowEditEnding(i),t.commitEdit(),e.onRowEditEnded(i)}this._edItem=null}}_keydown(e){let t=this._edt;switch(e.keyCode){case wijmo_1.Key.F2:return this._fullEdit=!this._fullEdit,e.preventDefault(),!0;case wijmo_1.Key.F4:return this._toggleListBox(e),e.preventDefault(),!0;case wijmo_1.Key.Space:return!t||"checkbox"!=t.type||t.disabled||t.readOnly||(t.checked=!t.checked,this.finishEditing(),e.preventDefault()),!0;case wijmo_1.Key.Enter:if(e.preventDefault(),t&&e.altKey){let t=e.target;if(t instanceof HTMLTextAreaElement&&"soft"==t.wrap){let e=t.value,i=t.selectionStart,s=t.selectionEnd;t.value=e.substr(0,i)+"\n"+e.substr(s),wijmo_1.setSelectionRange(t,i+1)}return!0}return!this.finishEditing();case wijmo_1.Key.Tab:return e.preventDefault(),!this.finishEditing();case wijmo_1.Key.Escape:return e.preventDefault(),this.finishEditing(!0),!0;case wijmo_1.Key.Up:case wijmo_1.Key.Down:case wijmo_1.Key.Left:case wijmo_1.Key.Right:case wijmo_1.Key.PageUp:case wijmo_1.Key.PageDown:case wijmo_1.Key.Home:case wijmo_1.Key.End:if(this._lbx)return this._keydownListBox(e);if(e.altKey)switch(e.keyCode){case wijmo_1.Key.Up:case wijmo_1.Key.Down:return this._toggleListBox(e),e.preventDefault(),!0}if(!this._fullEdit&&this.finishEditing())return!1}return!0}_keydownListBox(e){let t=!0;if(this._lbx)switch(e.keyCode){case wijmo_1.Key.Up:e.altKey?this._toggleListBox(e):this._lbx.selectedIndex>0&&this._lbx.selectedIndex--;break;case wijmo_1.Key.Down:e.altKey?this._toggleListBox(e):this._lbx.selectedIndex++;break;case wijmo_1.Key.Home:case wijmo_1.Key.PageUp:this._lbx.selectedIndex=0;break;case wijmo_1.Key.End:case wijmo_1.Key.PageDown:this._lbx.selectedIndex=this._lbx.collectionView.items.length-1;break;default:t=!1}return!!t&&(e.preventDefault(),!0)}_keypress(e){let t=this._edt,i=e.charCode||32;if(t&&"checkbox"!=t.type&&wijmo_1.getActiveElement()==t&&this._list&&this._list.length>0&&i>=32){let i=t.selectionStart,s=t.value.substr(0,i);e.target==t&&e.charCode&&(s+=String.fromCharCode(e.charCode),i++);let l=this._findString(this._list,s,!0);l<0&&(l=this._findString(this._list,s,!1)),l>-1&&(t.value=this._list[l],wijmo_1.setSelectionRange(t,i,t.value.length),t.dispatchEvent(this._evtInput),e.preventDefault&&e.preventDefault())}}_findString(e,t,i){i||(t=t.toLowerCase());for(let s=0;s<e.length;s++){let l=e[s];if(i||(l=l.toLowerCase()),0==l.indexOf(t))return s}return-1}_toggleListBox(e,t){let i=this._g,s=i._selHdl.selection,l=i.isTouching;if(t||(t=s),this._lbx&&(this._removeListBox(),s.contains(t)))return i.activeEditor?i.activeEditor.focus():i.containsFocus()||i.focus(),!0;let o=i.rows[t.row],n=i._getBindingColumn(i.cells,t.row,i.columns[t.col]),r=n.dataMap&&0!=n.showDropDown||o.dataMap&&0!=o.showDropDown;return!(!softInput()||!r)&&(!(!softInput()||!this.startEditing(!0,t.row,t.col,!l,e))&&(this._lbx=this._createListBox(),this._lbx.showSelection(),l&&this._lbx.focus(),!0))}_createListBox(){let e=this._g,t=e.activeEditor,i=this._rng,s=e.rows[i.row],l=e._getBindingColumn(e.cells,i.row,e.columns[i.col]),o=l.dataMap||s.dataMap,n=l.dropDownCssClass||s.dropDownCssClass,r=document.createElement("div");this._removeListBox(),wijmo_1.addClass(r,"wj-dropdown-panel wj-grid-listbox"),wijmo_1.addClass(r,n);let a=new mInput.ListBox(r,{maxHeight:4*s.renderHeight,isContentHtml:l.isContentHtml,itemsSource:o.getDisplayValues(s.dataItem),selectedValue:t?t.value:e.getCellData(i.row,i.col,!0)});a.addEventListener(a.hostElement,"click",()=>{this._removeListBox(),e.focus(),this.finishEditing()}),a.lostFocus.addHandler(()=>{this._removeListBox()}),a.selectedIndexChanged.addHandler(()=>{let t=e.activeEditor;t&&(t.value=a.selectedValue,t.dispatchEvent(this._evtInput),wijmo_1.setSelectionRange(t,0,t.value.length))});let h=e.cells.getCellElement(i.row,i.col);if(h){wijmo_1.showPopup(r,h,!1,!1,!1);let e=h.querySelector("."+CellFactory._WJC_DROPDOWN);wijmo_1.setAttribute(e,"aria-expanded",!0)}else wijmo_1.showPopup(r,e.getCellBoundingRect(i.row,i.col)),r[wijmo_1.Control._OWNR_KEY]=e.hostElement;return a}_removeListBox(){let e=this._lbx;e&&(this._lbx=null,wijmo_1.hidePopup(e.hostElement,()=>{e.dispose()}))}}exports._EditHandler=_EditHandler;const _AR_ALLCELLS=4,_WJC_DRAGSRC="wj-state-dragsrc";var AllowResizing,AutoSizeMode,AllowDragging;!function(e){e[e.None=0]="None",e[e.Columns=1]="Columns",e[e.Rows=2]="Rows",e[e.Both=3]="Both",e[e.ColumnsAllCells=e.Columns|_AR_ALLCELLS]="ColumnsAllCells",e[e.RowsAllCells=e.Rows|_AR_ALLCELLS]="RowsAllCells",e[e.BothAllCells=e.Both|_AR_ALLCELLS]="BothAllCells"}(AllowResizing=exports.AllowResizing||(exports.AllowResizing={})),function(e){e[e.None=0]="None",e[e.Headers=1]="Headers",e[e.Cells=2]="Cells",e[e.Both=3]="Both"}(AutoSizeMode=exports.AutoSizeMode||(exports.AutoSizeMode={})),function(e){e[e.None=0]="None",e[e.Columns=1]="Columns",e[e.Rows=2]="Rows",e[e.Both=3]="Both"}(AllowDragging=exports.AllowDragging||(exports.AllowDragging={}));class _MouseHandler{constructor(e){this._tsLast=0;let t=e.hostElement,i=e.addEventListener.bind(e),s=e.removeEventListener.bind(e);this._g=e,this._dvMarker=wijmo_1.createElement('<div class="wj-marker">&nbsp;</div>'),i(t,"mousedown",t=>{if(e._rcBounds=null,!t.defaultPrevented&&0==t.button){let n=t.target;if(!e.containsFocus()){let t=n instanceof HTMLElement&&n.tabIndex>-1?n:e._eFocus;e._setFocusNoScroll(t)}setTimeout(()=>{t.defaultPrevented||e.focus()});let r=wijmo_1.closest(n,".wj-flexgrid");if(r&&r!=e.hostElement||!e.activeEditor&&e._isInputElement(n)){let i=e.hitTest(t),s=CellType;switch(i.cellType){case s.Cell:e.select(i.range,!1),n instanceof HTMLElement&&"root"!=n.getAttribute("wj-part")&&n.focus();break;case s.ColumnHeader:case s.ColumnFooter:e.scrollIntoView(-1,i.col);break;case s.RowHeader:e.scrollIntoView(i.row,-1)}return}let a=document;s(a,"mousemove"),s(a,"mouseup"),i(a,"mousemove",l),i(a,"mouseup",o),this._isDown=!0,this._mousedown(t)}});let l=e=>{this._mousemove(e)},o=e=>{this._isDown=!1,s(document,"mousemove"),s(document,"mouseup"),this._mouseup(e)};i(t,"mouseup",e=>{this._tsLast=Date.now()}),i(t,"mouseenter",t=>{e._rcBounds=null}),i(t,"mousemove",this._hover.bind(this)),i(t,"dblclick",this._dblclick.bind(this)),i(t,"click",this._click.bind(this)),i(t,"selectstart",t=>{e._isInputElement(t.target)||t.preventDefault()}),i(t,"wheel",t=>{if(!t.defaultPrevented&&t.deltaY&&!t.ctrlKey&&!t.metaKey){let i=e._root,s=t.deltaY,l=0;if(i.scrollHeight>i.offsetHeight&&wijmo_1.closest(t.target,".wj-flexgrid")==e.hostElement){switch(t.deltaMode){case 1:l=e.rows.defaultSize*(s<0?-1:1);break;case 2:l=i.clientHeight*(s<0?-1:1);break;case 0:default:wijmo_1.isSafari()&&(s=wijmo_1.clamp(s,-150,150)),l=s}e.hostElement.focus(),i.scrollTop+=l,t.preventDefault()}}}),i(t,"dragstart",this._dragstart.bind(this)),i(t,"dragover",this._dragover.bind(this)),i(t,"dragleave",this._dragover.bind(this)),i(t,"drop",this._drop.bind(this)),i(t,"dragend",this._dragend.bind(this)),this._enableTouchResizing()}resetMouseState(){this._updating&&(this._updating=!1,this._g.endUpdate()),this._dragSrc&&wijmo_1.removeClass(this._dragSrc,_WJC_DRAGSRC),this._showDragMarker(null);let e=this._g.hostElement;e&&(e.style.cursor="");let t=this._g;t.removeEventListener(document,"mousemove"),t.removeEventListener(document,"mouseup"),this._tsLast=Date.now(),this._eMouse=null,this._isDown=null,this._htDown=null,this._lbSelRows=null,this._szRowCol=null,this._szArgs=null,t._rcBounds=null}_enableTouchResizing(){let e=this._g,t=e.hostElement,i="ontouchstart"in window?["touchstart","touchmove","touchend"]:"onpointerdown"in window?["pointerdown","pointermove","pointerup"]:null;i&&(e.addEventListener(t,i[0],i=>{if((null==i.pointerType||"touch"==i.pointerType)&&!wijmo_1.closest(i.target,".wj-elem-filter")){var s=wijmo_1.closest(i.target,".wj-cell");s instanceof HTMLElement&&(e._rcBounds=null,this._htDown=null,this._hover(i),this._szRowCol&&(s.removeAttribute("draggable"),t.style.touchAction="none",this._mousedown(i),i.preventDefault()))}}),e.addEventListener(t,i[1],e=>{null!=e.pointerType&&"touch"!=e.pointerType||this._szRowCol&&(this._mousemove(e),e.preventDefault())}),e.addEventListener(t,i[2],e=>{if((null==e.pointerType||"touch"==e.pointerType)&&this._szRowCol){if(this._szArgs)this._finishResizing(this._eMouse);else{let t=wijmo_1.closest(e.target,".wj-cell");t instanceof HTMLElement&&t.click()}this.resetMouseState(),t.style.touchAction=""}}))}_mousedown(e){let t=this._g,i=t.hitTest(e),s=i.cellType,l=e.ctrlKey||e.metaKey,o=e.target,n=CellType;if(this._selDown=t.selection,i.panel==t.cells){if(wijmo_1.closestClass(o,CellFactory._WJC_DROPDOWN))return t._edtHdl._toggleListBox(e,i.range),void e.preventDefault();if(t.editRange&&t.editRange.contains(i.range))return}let r=wijmo_1.getActiveElement();if(o!=r||!t._isInputElement(o)){if(s==n.None)return t.finishEditing(),void(o!=t._root&&o!=t._fCt&&t._edtHdl._commitRowEdits());if(this._htDown=i,this._eMouse=e,null!=this._szRowCol)return r!=t._eFocus&&(t._eFocus.tabIndex=0,t._eFocus.focus()),void this._handleResizing(e);if(!(s==n.RowHeader&&i.edgeBottom&&t.allowResizing&AllowResizing.Rows&&this._getResizeRow(i))){switch(s){case n.Cell:case n.RowHeader:l&&t.selectionMode==SelectionMode.ListBox&&this._startListBoxSelection(i.row),this._mouseSelect(e,e.shiftKey),s==n.RowHeader&&0==(t.allowDragging&AllowDragging.Rows)&&(e.preventDefault(),t.focus())}if(s==n.Cell&&t.rows.maxGroupLevel>-1&&wijmo_1.closestClass(o,CellFactory._WJC_COLLAPSE)){let e=wijmo_1.tryCast(t.rows[i.row],GroupRow);if(e)return l?t.collapseGroupsToLevel(e.isCollapsed?e.level+1:e.level):e.isCollapsed=!e.isCollapsed,void this.resetMouseState()}}}}_mousemove(e){if(null!=this._htDown){if(0==e.buttons&&this._eMouse&&e.timeStamp-this._eMouse.timeStamp>600)return void this.resetMouseState();if(this._eMouse=e,this._szRowCol)this._handleResizing(e);else switch(this._htDown.cellType){case CellType.Cell:this._mouseSelect(e,!0);break;case CellType.RowHeader:0==(this._g.allowDragging&AllowDragging.Rows)&&this._mouseSelect(e,!0)}}}_mouseup(e){if(this._g.isTouching&&(this._dragSrc||e.target instanceof HTMLHtmlElement))return;let t=this._g,i=t.hitTest(e),s=this._htDown,l=SelectionMode;if(s&&!e.defaultPrevented)if(this._szArgs)this._finishResizing(e);else if(s.panel!=t.topLeftCells||this._szArgs)s.panel!=t.columnHeaders||e.dataTransfer?s.panel==t.cells&&(this._szRowCol||e.ctrlKey||e.metaKey||e.shiftKey||i.panel==s.panel&&i.range.equals(s.range)&&t.selection.equals(this._selDown)&&t._edtHdl.startEditing(!0,i.row,i.col,!0,e)):i.panel==s.panel&&i.col==s.col&&!i.edgeRight&&i.col>-1&&this._clickSort(e,i);else if(i.panel==s.panel&&i.row==s.row&&i.col==s.col&&t.rows.length&&t.columns.length)switch(t.selectionMode){case l.CellRange:case l.RowRange:case l.ListBox:t.select(new CellRange(0,0,t.rows.length-1,t.columns.length-1))}this.resetMouseState()}_click(e){Date.now()-this._tsLast>50&&!e.pointerType&&this._handleClick(e)}_handleClick(e){let t=this._g,i=e.target,s=new HitTestInfo(i,null),l=s.panel;if(!e.defaultPrevented&&s.grid==t&&!t._isInputElement(i))if(l==t.topLeftCells)t.select(new CellRange(0,0,t.rows.length-1,t.columns.length-1));else if(l==t.columnHeaders)this._clickSort(e,s);else if(l==t.rowHeaders)t.select(new CellRange(s.row,0,s.row,t.columns.length-1));else if(l==t.cells)if(s.row<0)this._clickSort(e,s);else if(wijmo_1.closestClass(i,CellFactory._WJC_COLLAPSE)){let i=t.rows[s.row];i instanceof GroupRow&&(e.ctrlKey?t.collapseGroupsToLevel(i.isCollapsed?i.level+1:i.level):i.isCollapsed=!i.isCollapsed)}else wijmo_1.closestClass(i,CellFactory._WJC_DROPDOWN)?t._edtHdl._toggleListBox(e,s.range):t.select(s.range)}_clickSort(e,t){let i=this._g,s=i.collectionView,l=e.ctrlKey||e.metaKey;if(!s||!s.canSort||!i.allowSorting)return;t.row;let o=t.panel.columns[t.col],n=i._getBindingColumn(t.panel,t.row,o),r=n?n._getBindingSort():null;if(!n.allowSorting||!r)return;if(o==n){let e=i.getMergedRange(t.panel,t.row,t.col,!1);if(e&&e.columnSpan>1)return}let a=t.grid.collectionView.sortDescriptions,h=null;for(let e=0;e<a.length;e++)if(a[e].property==r){h=!a[e].ascending;break}if(null==h){if(l)return;h=!0}let d=new CellRangeEventArgs(t.panel,t.range,e);i.onSortingColumn(d)&&(i._edtHdl._commitRowEdits(),l?a.clear():a.splice(0,a.length,new wijmo_1.SortDescription(r,h)),i.onSortedColumn(d))}_dblclick(e){let t,i=this._g,s=i.hitTest(e),l=s.cellType,o=i.selection,n=s.range;if(!e.defaultPrevented)if(s.edgeRight&&i.allowResizing&AllowResizing.Columns){if(l==CellType.ColumnHeader||l==CellType.Cell&&i.allowResizing&_AR_ALLCELLS){e.preventDefault(),e.ctrlKey&&o.containsColumn(s.col)&&(n=o);for(let e=n.leftCol;e<=n.rightCol;e++)i.columns[e].allowResizing&&(t=new CellRangeEventArgs(i.cells,new CellRange(-1,e)),i.onAutoSizingColumn(t)&&i.onResizingColumn(t)&&(i.autoSizeColumn(e),i.onResizedColumn(t),i.onAutoSizedColumn(t)))}else l==CellType.TopLeft&&s.panel.columns[s.col].allowResizing&&(e.preventDefault(),t=new CellRangeEventArgs(s.panel,new CellRange(-1,s.col)),i.onAutoSizingColumn(t)&&i.onResizingColumn(t)&&(i.autoSizeColumn(s.col,!0),i.onAutoSizedColumn(t),i.onResizedColumn(t)));this.resetMouseState()}else if(s.edgeBottom&&i.allowResizing&AllowResizing.Rows){if(l==CellType.RowHeader||l==CellType.Cell&&i.allowResizing&_AR_ALLCELLS){e.ctrlKey&&o.containsRow(s.row)&&(n=o);for(let e=n.topRow;e<=n.bottomRow;e++)i.rows[e].allowResizing&&(t=new CellRangeEventArgs(i.cells,new CellRange(e,-1)),i.onAutoSizingRow(t)&&i.onResizingRow(t)&&(i.autoSizeRow(e),i.onResizedRow(t),i.onAutoSizedRow(t)))}else l==CellType.TopLeft&&s.panel.rows[s.row].allowResizing&&(t=new CellRangeEventArgs(s.panel,new CellRange(s.row,-1)),i.onAutoSizingRow(t)&&i.onResizingRow(t)&&(i.autoSizeRow(s.row,!0),i.onResizedRow(t),i.onAutoSizedRow(t)));this.resetMouseState()}else;}_hover(e){if(!this._isDown){let t=this._g,i=t.hitTest(e),s=(i.panel,i.cellType),l="";return this._szRowCol=null,(s==CellType.ColumnHeader||s==CellType.TopLeft||s==CellType.Cell&&t.allowResizing&_AR_ALLCELLS)&&i.edgeRight&&0!=(t.allowResizing&AllowResizing.Columns)&&(this._szRowCol=this._getResizeCol(i)),(s==CellType.RowHeader||s==CellType.TopLeft||s==CellType.Cell&&t.allowResizing&_AR_ALLCELLS)&&i.edgeBottom&&0!=(t.allowResizing&AllowResizing.Rows)&&(this._szRowCol=this._getResizeRow(i)),this._szRowCol instanceof Column?l="col-resize":this._szRowCol instanceof Row&&(l="row-resize"),this._szStart=this._szRowCol?this._szRowCol.renderSize:0,t.hostElement.style.cursor=l,i}return null}_getResizeCol(e){let t=e.panel.columns,i=t[e.col];for(let s=e.col+1;s<t.length;s++){let e=t[s];if(e.visible){e.renderSize<1&&(i=e);break}}if(e.col==t.length-1&&(e.cellType==CellType.TopLeft||e.cellType==CellType.RowHeader)){t=this._g.columns;for(let e=0;e<t.length;e++){let s=t[e];if(s.visible){s.renderSize<1&&(i=s);break}}}return i.allowResizing?i:null}_getResizeRow(e){let t=e.panel.rows,i=t[e.row];for(let s=e.row+1;s<t.length;s++){let e=t[s];if(e.visible){e.renderSize<1&&(i=e);break}}if(e.row==t.length-1&&(e.cellType==CellType.TopLeft||e.cellType==CellType.ColumnHeader)){t=this._g.rows;for(let e=0;e<t.length;e++){let s=t[e];if(s.visible){s.renderSize<1&&(i=s);break}}}return i.allowResizing?i:null}_mouseSelect(e,t){let i=this._g;if(e&&this._htDown&&this._htDown.panel&&i.selectionMode!=SelectionMode.None){let s=new HitTestInfo(this._htDown.panel,e);this._handleSelection(s,t),!wijmo_1.isIE9()&&e.button>=0&&e.target!=i._root&&(s=new HitTestInfo(i,e)).cellType!=CellType.Cell&&s.cellType!=CellType.RowHeader&&setTimeout(()=>{this._isDown&&this._eMouse&&this._mouseSelect(this._eMouse,t)},100)}}_handleResizing(e){if(e.preventDefault(),this._szRowCol instanceof Column){let t=this._g,i=wijmo_1.mouseToPage(e).x,s=Math.round(Math.max(_MouseHandler._SZ_MIN,this._szStart+(i-this._htDown.point.x)*(t.rightToLeft?-1:1)));if(this._szRowCol.renderSize!=s){if(null==this._szArgs){let e=t.rowHeaders.columns.indexOf(this._szRowCol)>-1?t.rowHeaders:t.cells;this._szArgs=new CellRangeEventArgs(e,new CellRange(-1,this._szRowCol.index))}this._szArgs.cancel=!1,t.onResizingColumn(this._szArgs)&&(t.deferResizing?this._showResizeMarker(s):this._szRowCol.width=s)}}if(this._szRowCol instanceof Row){let t=this._g,i=wijmo_1.mouseToPage(e).y,s=Math.round(Math.max(_MouseHandler._SZ_MIN,this._szStart+(i-this._htDown.point.y)));if(this._szRowCol.renderSize!=s){if(null==this._szArgs){let e=t.columnHeaders.rows.indexOf(this._szRowCol)>-1?t.columnHeaders:t.cells;this._szArgs=new CellRangeEventArgs(e,new CellRange(this._szRowCol.index,-1))}this._szArgs.cancel=!1,t.onResizingRow(this._szArgs)&&(t.deferResizing?this._showResizeMarker(s):this._szRowCol.height=s)}}}_dragstart(e){let t=this._g,i=this._htDown,s=AllowDragging;if(i){if(this._dragSrc=null,this._htDrag=null,!this._szRowCol){let l=new CellRangeEventArgs(i.panel,i.range);if(i.cellType==CellType.ColumnHeader&&t.allowDragging&s.Columns&&i.col>-1&&t.columns[i.col].allowDragging)t.onDraggingColumn(l)?this._dragSrc=e.target:e.preventDefault();else if(i.cellType==CellType.RowHeader&&t.allowDragging&s.Rows&&i.row>-1&&t.rows[i.row].allowDragging){let s=t.rows[i.row];s instanceof GroupRow||s instanceof _NewRowTemplate||(t.onDraggingRow(l)?this._dragSrc=e.target:e.preventDefault())}else i.cellType==CellType.TopLeft&&t.allowDragging&s.Columns&&i.col>-1&&t.topLeftCells.columns[i.col].allowDragging&&(t.onDraggingColumn(l)?this._dragSrc=e.target:e.preventDefault())}this._dragSrc&&e.dataTransfer&&!e.defaultPrevented&&(this._htDrag=i,wijmo_1._startDrag(e.dataTransfer,"move"),e.stopPropagation(),wijmo_1.addClass(this._dragSrc,_WJC_DRAGSRC),t.beginUpdate(),this._updating=!0)}}_dragend(e){this._dragSrc=null,this._htDrag=null,this.resetMouseState()}_dragover(e){let t=this._g,i=this._hitTest(e),s=this._dragSrc?this._htDrag:null,l=CellType,o=!1;if(s&&i.cellType==s.cellType){let e=new CellRangeEventArgs(i.panel,i.range,s);i.cellType==l.ColumnHeader?(e.cancel=!t.columns.canMoveElement(s.col,i.col),o=t.onDraggingColumnOver(e)):i.cellType==l.RowHeader?(e.cancel=!t.rows.canMoveElement(s.row,i.row),o=t.onDraggingRowOver(e)):i.cellType==l.TopLeft&&(e.cancel=!t.topLeftCells.columns.canMoveElement(s.col,i.col),o=t.onDraggingColumnOver(e))}if(o?(e.dataTransfer.dropEffect="move",this._showDragMarker(i),e.preventDefault(),e.stopPropagation()):this._showDragMarker(null),s&&t.autoScroll){let i=t.controlRect,l=t.scrollPosition,o=wijmo_1.Control._DRAG_SCROLL_EDGE,n=wijmo_1.Control._DRAG_SCROLL_STEP;s.panel==t.columnHeaders?(e.pageX-i.left<o&&(l.x+=n),i.right-e.pageX<o&&(l.x-=n)):s.panel==t.rowHeaders&&(e.pageY-i.top<o&&(l.y+=n),i.bottom-e.pageY<o&&(l.y-=n)),l.equals(t._ptScrl)||(t.scrollPosition=l,t._rcBounds=null)}}_drop(e){let t=this._g,i=this._hitTest(e),s=this._dragSrc?this._htDrag:null,l=CellType;if(s&&i.cellType==s.cellType){let e=t.selection,o=new CellRangeEventArgs(i.panel,i.range,s);i.cellType==l.ColumnHeader?(t.columns.moveElement(s.col,i.col),t.select(e.row,i.col),t.onDraggedColumn(o)):i.cellType==l.RowHeader?(t.rows.moveElement(s.row,i.row),t.select(i.row,e.col),t.onDraggedRow(o)):i.cellType==l.TopLeft&&(t.topLeftCells.columns.moveElement(s.col,i.col),t.onDraggedColumn(o))}this.resetMouseState()}_hitTest(e){let t=this._g;return t._rcBounds=null,t.hitTest(e)}_showResizeMarker(e){let t=this._g,i=this._dvMarker,s=t.cells.hostElement;i.parentElement!=s&&s.appendChild(i);let l,o=this._szArgs.panel.cellType,n=CellType;this._szRowCol instanceof Column?(l={left:this._szRowCol.pos+e-1,top:-1e3,right:"",bottom:0,width:3,height:""},o!=n.TopLeft&&o!=n.RowHeader||(l.left-=t._eTL.offsetWidth),o==n.Cell&&this._szRowCol.index<t.frozenColumns&&(l.left-=t.scrollPosition.x),t.rightToLeft&&(l.left=s.clientWidth-l.left-l.width)):(l={left:-1e3,top:this._szRowCol.pos+e-1,right:0,bottom:"",width:"",height:3},o!=n.TopLeft&&o!=n.ColumnHeader||(l.top-=t._eTL.offsetHeight),o==n.Cell&&this._szRowCol.index<t.frozenRows&&(l.top-=t.scrollPosition.y)),wijmo_1.setCss(i,l)}_showDragMarker(e){let t=this._g,i=this._dvMarker;if(!e||!e.panel)return wijmo_1.removeChild(i),void(this._rngTarget=null);if(e.range.equals(this._rngTarget))return;this._rngTarget=e.range;let s=e.panel.hostElement;i.parentElement!=s&&s.appendChild(i);let l=CellType,o={left:0,top:0,width:6,height:6,right:"",bottom:""};switch(e.cellType){case l.TopLeft:case l.ColumnHeader:o.height=e.panel.height;let s=e.panel.columns[e.col];o.left=s.pos-o.width/2,this._htDown&&e.col>this._htDown.col&&(o.left+=s.renderWidth),e.cellType==l.ColumnHeader&&e.col<t.frozenColumns&&(o.left-=t.scrollPosition.x),t.rightToLeft&&(o.left=i.parentElement.clientWidth-o.left-o.width);break;case l.RowHeader:o.width=e.panel.width;let n=e.panel.rows[e.row];o.top=n.pos-o.height/2,e.row>this._htDown.row&&(o.top+=n.renderHeight),e.row<t.frozenRows&&(o.top-=t.scrollPosition.y)}wijmo_1.setCss(i,o)}_finishResizing(e){let t=this._g,i=t.selection,s=this._szArgs,l=this._eMouse&&this._eMouse.ctrlKey,o=CellType;if(s&&!s.cancel){if(s.col>-1){let n=s.col,r=wijmo_1.mouseToPage(e).x,a=Math.round(Math.max(_MouseHandler._SZ_MIN,this._szStart+(r-this._htDown.point.x)*(this._g.rightToLeft?-1:1)));if(s.panel.columns[n].width=Math.round(a),t.onResizedColumn(s),l&&this._htDown.cellType==o.ColumnHeader&&i.containsColumn(n))for(let e=i.leftCol;e<=i.rightCol;e++)t.columns[e].allowResizing&&e!=n&&(s=new CellRangeEventArgs(t.cells,new CellRange(-1,e)),t.onResizingColumn(s)&&(t.columns[e].size=t.columns[n].size,t.onResizedColumn(s)))}if(s.row>-1){let n=s.row,r=wijmo_1.mouseToPage(e).y,a=Math.round(Math.max(_MouseHandler._SZ_MIN,this._szStart+(r-this._htDown.point.y)));if(s.panel.rows[n].height=Math.round(a),t.onResizedRow(s),l&&this._htDown.cellType==o.RowHeader&&i.containsRow(n))for(let e=i.topRow;e<=i.bottomRow;e++)t.rows[e].allowResizing&&e!=n&&(s=new CellRangeEventArgs(t.cells,new CellRange(e,-1)),t.onResizingRow(s)&&(t.rows[e].size=t.rows[n].size,t.onResizedRow(s)))}}}_startListBoxSelection(e){let t=this._g.rows,i=this._lbSelRows={};this._lbSelState=!t[e].isSelected,t.forEach((e,t)=>{e.isSelected&&(i[t]=!0)})}_handleSelection(e,t){let i=this._g,s=i.rows,l=i._selHdl.selection,o=new CellRange(e.row,e.col);if(e.row>-1&&e.col>-1)if(null!=this._lbSelRows){let t=!1;o=new CellRange(e.row,e.col,this._htDown.row,this._htDown.col);for(let e=0;e<s.length;e++){let n=o.containsRow(e)?this._lbSelState:null!=this._lbSelRows[e];if(n!=s[e].isSelected){let o=new CellRangeEventArgs(i.cells,new CellRange(e,l.col,e,l.col2));i.onSelectionChanging(o)&&(s[e]._setFlag(RowColFlags.Selected,n,!0),t=!0,i.onSelectionChanged(o))}}t&&i.refreshCells(!1,!0,!0),i.scrollIntoView(e.row,e.col)}else t&&(i.anchorCursor?(o.row=l.row,o.col=l.col):(o.row2=l.row2,o.col2=l.col2)),e.cellType==CellType.RowHeader?(o.col=0,o.col2=i.columns.length-1,i.select(o,!1),i.scrollIntoView(e.row,-1)):i.select(o)}}_MouseHandler._SZ_MIN=0,exports._MouseHandler=_MouseHandler,wijmo_1._registerModule("wijmo.grid",selfModule);