/*!
    *
    * Wijmo Library 5.20191.603
    * http://wijmo.com/
    *
    * Copyright(c) GrapeCity, Inc.  All rights reserved.
    *
    * Licensed under the GrapeCity Commercial License.
    * sales@wijmo.com
    * wijmo.com/products/wijmo-5/license/
    *
    */

"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const wijmo_1=require("wijmo/wijmo"),wijmo_chart_1=require("wijmo/wijmo.chart"),selfModule=require("wijmo/wijmo.chart.finance");class FinancialSeries extends wijmo_chart_1.SeriesBase{get chartType(){return this._finChartType}set chartType(e){(e=wijmo_1.asEnum(e,FinancialChartType,!0))!=this._finChartType&&(this._finChartType=e,this._invalidate())}_getChartType(){var e=null;switch(this.chartType){case FinancialChartType.Area:e=wijmo_chart_1.ChartType.Area;break;case FinancialChartType.Line:case FinancialChartType.Kagi:case FinancialChartType.PointAndFigure:e=wijmo_chart_1.ChartType.Line;break;case FinancialChartType.Column:case FinancialChartType.ColumnVolume:e=wijmo_chart_1.ChartType.Column;break;case FinancialChartType.LineSymbols:e=wijmo_chart_1.ChartType.LineSymbols;break;case FinancialChartType.Scatter:e=wijmo_chart_1.ChartType.Scatter;break;case FinancialChartType.Candlestick:case FinancialChartType.Renko:case FinancialChartType.HeikinAshi:case FinancialChartType.LineBreak:case FinancialChartType.EquiVolume:case FinancialChartType.CandleVolume:case FinancialChartType.ArmsCandleVolume:e=wijmo_chart_1.ChartType.Candlestick;break;case FinancialChartType.HighLowOpenClose:e=wijmo_chart_1.ChartType.HighLowOpenClose}return e}getDataRect(e,t){if(t)return t;var i=this.getValues(0),a=this.getValues(1)||(this.chart._xvals&&this.chart._xvals.length?this.chart._xvals:null),s=this._getBinding(0),r=this._getBinding(1),n=this._getBinding(2),l=this._getBinding(3);this._plotter;let h=this._getChartType()||this.chart._getChartType();if(h!==wijmo_chart_1.ChartType.HighLowOpenClose&&h!==wijmo_chart_1.ChartType.Candlestick||s===r)return null;if(i){for(var o=NaN,_=NaN,c=NaN,u=NaN,g=i.length,m=0;m<g;m++){var d=this._getItem(m),p=i[m];if(isFinite(p)){[p,r?d[r]:null,n?d[n]:null,l?d[l]:null].forEach(e=>{wijmo_chart_1._DataInfo.isValid(e)&&null!==e&&((isNaN(_)||e<_)&&(_=e),(isNaN(u)||e>u)&&(u=e))})}if(a){var w=a[m];isFinite(w)&&(isNaN(o)?o=c=w:w<o?o=w:p>u&&(c=w))}}if(a||(o=0,c=g-1),!isNaN(_))return new wijmo_1.Rect(o,_,c-o,u-_)}return null}}function _trunc(e){return wijmo_1.asNumber(e,!0,!1),e>0?Math.floor(e):Math.ceil(e)}function _sum(e){return arguments.length>1&&(e=Array.prototype.slice.call(arguments)),wijmo_1.asArray(e,!1),e.reduce((e,t)=>e+wijmo_1.asNumber(t),0)}function _average(e){return arguments.length>1&&(e=Array.prototype.slice.call(arguments)),wijmo_1.asArray(e,!1),_sum(e)/e.length}function _minimum(e){return arguments.length>1&&(e=Array.prototype.slice.call(arguments)),wijmo_1.asArray(e,!1),Math.min.apply(null,e)}function _maximum(e){return arguments.length>1&&(e=Array.prototype.slice.call(arguments)),wijmo_1.asArray(e,!1),Math.max.apply(null,e)}function _variance(e){arguments.length>1&&(e=Array.prototype.slice.call(arguments)),wijmo_1.asArray(e,!1);var t=_average(e);return _average(e.map(e=>Math.pow(e-t,2)))}function _stdDeviation(e){return arguments.length>1&&(e=Array.prototype.slice.call(arguments)),wijmo_1.asArray(e,!1),Math.sqrt(_variance(e))}function _avgTrueRng(e,t,i,a=14){wijmo_1.asArray(e,!1),wijmo_1.asArray(t,!1),wijmo_1.asArray(i,!1),wijmo_1.asInt(a,!1,!0);var s=_trueRng(e,t,i,a),r=Math.min(e.length,t.length,i.length,s.length),n=[];wijmo_1.assert(r>a&&a>1,"Average True Range period must be an integer less than the length of the data and greater than one.");for(var l=0;l<r;l++)wijmo_1.asNumber(e[l],!1),wijmo_1.asNumber(t[l],!1),wijmo_1.asNumber(i[l],!1),wijmo_1.asNumber(s[l],!1),l+1===a?n.push(_average(s.slice(0,a))):l+1>a&&n.push(((a-1)*n[n.length-1]+s[l])/a);return n}function _trueRng(e,t,i,a=14){wijmo_1.asArray(e,!1),wijmo_1.asArray(t,!1),wijmo_1.asArray(i,!1),wijmo_1.asInt(a,!1,!0);var s=Math.min(e.length,t.length,i.length),r=[];wijmo_1.assert(s>a&&a>1,"True Range period must be an integer less than the length of the data and greater than one.");for(var n=0;n<s;n++)wijmo_1.asNumber(e[n],!1),wijmo_1.asNumber(t[n],!1),wijmo_1.asNumber(i[n],!1),0===n?r.push(e[n]-t[n]):r.push(Math.max(e[n]-t[n],Math.abs(e[n]-i[n-1]),Math.abs(t[n]-i[n-1])));return r}function _sma(e,t){wijmo_1.asArray(e,!1),wijmo_1.asNumber(t,!1,!0),wijmo_1.assert(e.length>t&&t>1,"Simple Moving Average period must be an integer less than the length of the data and greater than one.");for(var i=[],a=t;a<=e.length;a++)i.push(_average(e.slice(a-t,a)));return i}function _ema(e,t){wijmo_1.asArray(e,!1),wijmo_1.asNumber(t,!1,!0),wijmo_1.assert(e.length>t&&t>1,"Exponential Moving Average period must be an integer less than the length of the data and greater than one.");var i=[],a=2/(t+1),s=_sma(e,t);e=e.slice(t-1);for(var r=0;r<e.length;r++)0===r?i.push(s[0]):i.push((e[r]-i[r-1])*a+i[r-1]);return i}function _range(e,t,i=1){wijmo_1.asNumber(e,!1),wijmo_1.asNumber(t,!1),wijmo_1.asNumber(i,!1),wijmo_1.assert(e<t,"begin argument must be less than end argument.");for(var a=[],s=e;s<=t;s+=i)a.push(s);return a}exports.FinancialSeries=FinancialSeries,exports._trunc=_trunc,exports._sum=_sum,exports._average=_average,exports._minimum=_minimum,exports._maximum=_maximum,exports._variance=_variance,exports._stdDeviation=_stdDeviation,exports._avgTrueRng=_avgTrueRng,exports._trueRng=_trueRng,exports._sma=_sma,exports._ema=_ema,exports._range=_range;class _BaseCalculator{constructor(e,t,i,a){this.highs=e,this.lows=t,this.opens=i,this.closes=a}calculate(){}}exports._BaseCalculator=_BaseCalculator;class _HeikinAshiCalculator extends _BaseCalculator{constructor(e,t,i,a){super(e,t,i,a)}calculate(){var e,t,i,a,s=Math.min(this.highs.length,this.lows.length,this.opens.length,this.closes.length),r=[];if(s<=0)return r;for(var n=0;n<s;n++)a=_average(this.highs[n],this.lows[n],this.opens[n],this.closes[n]),0===n?(i=_average(this.opens[n],this.closes[n]),e=this.highs[n],t=this.lows[n]):(i=_average(r[n-1].open,r[n-1].close),e=Math.max(this.highs[n],i,a),t=Math.min(this.lows[n],i,a)),r.push({high:e,low:t,close:a,open:i,pointIndex:n,x:null});return r}}exports._HeikinAshiCalculator=_HeikinAshiCalculator;class _BaseRangeCalculator extends _BaseCalculator{constructor(e,t,i,a,s,r,n,l){super(e,t,i,a),this.xs=s,this.size=r,this.unit=n,this.fields=l}_getValues(){var e,t=[],i=Math.min(this.highs.length,this.lows.length,this.opens.length,this.closes.length);switch(this.fields){case DataFields.High:t=this.highs;break;case DataFields.Low:t=this.lows;break;case DataFields.Open:t=this.opens;break;case DataFields.HL2:for(e=0;e<i;e++)t.push(_average(this.highs[e],this.lows[e]));break;case DataFields.HLC3:for(e=0;e<i;e++)t.push(_average(this.highs[e],this.lows[e],this.closes[e]));break;case DataFields.HLOC4:for(e=0;e<i;e++)t.push(_average(this.highs[e],this.lows[e],this.opens[e],this.closes[e]));break;case DataFields.Close:default:t=this.closes}return t}_getSize(){var e=this.unit===RangeMode.ATR?_avgTrueRng(this.highs,this.lows,this.closes,this.size):null;return this.unit===RangeMode.ATR?e[e.length-1]:this.size}}exports._BaseRangeCalculator=_BaseRangeCalculator;class _LineBreakCalculator extends _BaseRangeCalculator{constructor(e,t,i,a,s,r){super(e,t,i,a,s,r)}calculate(){var e=null!==this.xs&&this.xs.length>0,t=this.closes.length,i=[],a=[[],[]];if(t<=0)return i;for(var s,r,n,l,h,o,_=[],c=1;c<t;c++){if(l=i.length-1,r=e?this.xs[c]:c,n=this.closes[c],-1===l){if((s=this.closes[0])===n)continue}else if(_=this._trendExists(a)||1===this.size?a[0].slice(-this.size).concat(a[1].slice(-this.size)):a[0].slice(1-this.size).concat(a[1].slice(1-this.size)),h=Math.max.apply(null,_),o=Math.min.apply(null,_),n>h)s=Math.max(a[0][l],a[1][l]);else{if(!(n<o))continue;s=Math.min(a[0][l],a[1][l])}a[0].push(s),a[1].push(n),i.push({high:Math.max(s,n),low:Math.min(s,n),open:s,close:n,x:r,pointIndex:c})}return i}_trendExists(e){if(e[1].length<this.size)return!1;var t,i=!1,a=e[1].slice(-this.size);for(t=1;t<this.size&&(i=a[t]>a[t-1]);t++);if(!i)for(t=1;t<this.size&&(i=a[t]<a[t-1]);t++);return i}}exports._LineBreakCalculator=_LineBreakCalculator;class _KagiCalculator extends _BaseRangeCalculator{constructor(e,t,i,a,s,r,n,l){super(e,t,i,a,s,r,n,l)}calculate(){var e,t,i,a,s,r,n,l,h,o=this._getSize(),_=Math.min(this.highs.length,this.lows.length,this.opens.length,this.closes.length),c=this._getValues(),u=null!==this.xs&&this.xs.length>0,g=[],m=[[],[]];if(_<=0)return g;for(var d=1;d<_;d++){if(a=g.length-1,t=u?this.xs[d]:d,h=d,l=!1,this.fields===DataFields.HighLow)if(-1===a)if(this.highs[d]>this.highs[0])i=this.highs[d];else{if(!(this.lows[d]<this.lows[0]))continue;i=this.lows[d]}else if((n=m[1][a]-m[0][a])>0)if(this.highs[d]>m[1][a])i=this.highs[d];else{if(!(this.lows[d]<m[1][a]))continue;i=this.lows[d]}else if(this.lows[d]<m[1][a])i=this.lows[d];else{if(!(this.highs[d]>m[1][a]))continue;i=this.highs[d]}else i=c[d];if(this.unit===RangeMode.Percentage&&(o=i*this.size),-1===a){if(t=u?this.xs[0]:0,h=0,e=this.fields===DataFields.HighLow?null==this.highs[0]?this.highs[this.highs.length-1]:this.highs[0]:null==c[0]?c[c.length-1]:c[0],(n=Math.abs(e-i)||0)<o)continue}else if(n=m[1][a]-m[0][a],r=Math.max(m[0][a],m[1][a]),s=Math.min(m[0][a],m[1][a]),n>0)if(i>r)l=!0;else{if(!((n=r-i)>=o))continue;e=r}else if(i<s)l=!0;else{if(!((n=i-s)>=o))continue;e=s}l?(m[1][a]=i,g[a].close=i,g[a].high=Math.max(g[a].open,g[a].close),g[a].low=Math.min(g[a].open,g[a].close)):(m[0].push(e),m[1].push(i),g.push({high:Math.max(e,i),low:Math.min(e,i),open:e,close:i,x:t,pointIndex:h}))}return g}}exports._KagiCalculator=_KagiCalculator;class _RenkoCalculator extends _BaseRangeCalculator{constructor(e,t,i,a,s,r,n,l,h=!1){super(e,t,i,a,s,r,n,l),this.rounding=h}calculate(){var e,t,i,a,s,r,n,l=this._getSize(),h=Math.min(this.highs.length,this.lows.length,this.opens.length,this.closes.length),o=null!==this.xs&&this.xs.length>0,_=this._getValues(),c=[],u=[[],[]];if(h<=0)return c;for(var g=1;g<h;g++){if(a=c.length-1,t=o?this.xs[g]:g,this.fields===DataFields.HighLow)if(-1===a)if(this.highs[g]-this.highs[0]>l)e=this.highs[0],i=this.highs[g];else{if(!(this.lows[0]-this.lows[g]>l))continue;e=this.lows[0],i=this.lows[g]}else if(s=Math.min(u[0][a],u[1][a]),r=Math.max(u[0][a],u[1][a]),this.highs[g]-r>l)e=r,i=this.highs[g];else{if(!(s-this.lows[g]>l))continue;e=s,i=this.lows[g]}else if(i=_[g],-1===a)e=_[0];else if(s=Math.min(u[0][a],u[1][a]),i>(r=Math.max(u[0][a],u[1][a])))e=r;else{if(!(i<s))continue;e=s}if(n=i-e,!(Math.abs(n)<l)){n=_trunc(n/l);for(var m=0;m<Math.abs(n);m++){var d={};this.rounding&&(e=this._round(e,l)),u[0].push(e),d.open=e,e=n>0?e+l:e-l,u[1].push(e),d.close=e,d.x=t,d.pointIndex=g,d.high=Math.max(d.open,d.close),d.low=Math.min(d.open,d.close),c.push(d)}}}return c}_round(e,t){return Math.round(e/t)*t}}exports._RenkoCalculator=_RenkoCalculator;class _BaseRangePlotter extends wijmo_chart_1._BasePlotter{constructor(){super(),this._symFactor=.7,this.clear()}clear(){super.clear(),this._rangeValues=null,this._rangeXLabels=null,this._calculator=null}unload(){var e,t;super.unload();for(var i=0;i<this.chart.series.length;i++)(e=this.chart.series[i])&&(t=e._getAxisX())&&t.itemsSource&&(t.itemsSource=null)}adjustLimits(e,t){var i,a,s,r=0,n=0,l=0,h=0,o=this.chart._xDataType===wijmo_1.DataType.Date?.5:0;wijmo_1.assert(this.chart.series.length<=1,"Current FinancialChartType only supports a single series");for(var _=0;_<this.chart.series.length;_++)i=this.chart.series[_],this._calculate(i),this._rangeValues.length<=0||this._rangeXLabels.length<=0||((a=this._rangeValues.map(e=>e.open)).push.apply(a,this._rangeValues.map(e=>e.close)),s=this._rangeXLabels.map(e=>e.value),l=Math.min.apply(null,a),h=Math.max.apply(null,a),r=Math.min.apply(null,s),n=Math.max.apply(null,s),i._getAxisX().itemsSource=this._rangeXLabels);return r-=o,new wijmo_1.Rect(r,l,n-r+o,h-l)}plotSeries(e,t,i,a,s,r,n){this._calculate(a);var l=this.chart.series.indexOf(a),h=this._rangeValues.length,o=t.actualMin,_=t.actualMax,c=this._DEFAULT_WIDTH,u=this._symFactor,g=a._getSymbolFill(l),m=a._getAltSymbolFill(l)||"transparent",d=a._getSymbolStroke(l),p=a._getAltSymbolStroke(l)||d;e.strokeWidth=c;var w,f,x,v,y=0;let C=this.getItemFormatter(a);for(var j=0;j<h;j++)if(w=j,wijmo_chart_1._DataInfo.isValid(w)&&o<=w&&w<=_){if(f=this._rangeValues[j].open,x=this._rangeValues[j].close,e.fill=f>x?g:m,e.stroke=f>x?d:p,v=this._getDataPoint(l,j,a,Math.max(f,x)),e.startGroup(),C){var k=new wijmo_chart_1.HitTestInfo(this.chart,new wijmo_1.Point(t.convert(w),i.convert(x)),wijmo_chart_1.ChartElement.SeriesSymbol);k._setData(a,j),k._setDataPoint(v),C(e,k,()=>{this._drawSymbol(e,t,i,l,y,u,w,f,x,v)})}else this._drawSymbol(e,t,i,l,y,u,w,f,x,v);e.endGroup(),a._setPointIndex(j,y),y++}}_drawSymbol(e,t,i,a,s,r,n,l,h,o){var _,c,u,g,m;if((u=t.convert(n-.5*r))>(g=t.convert(n+.5*r))){var d=u;u=g,g=d}wijmo_chart_1._DataInfo.isValid(l)&&wijmo_chart_1._DataInfo.isValid(h)&&(l=i.convert(l),h=i.convert(h),c=(_=Math.min(l,h))+Math.abs(l-h),e.drawRect(u,_,g-u,c-_),(m=new wijmo_chart_1._RectArea(new wijmo_1.Rect(u,_,g-u,c-_))).tag=o,this.hitTester.add(m,a))}_getDataPoint(e,t,i,a){var s=t,r=new wijmo_chart_1._DataPoint(e,t,s,a),n=i._getItem(this._rangeValues[t].pointIndex),l=i.bindingX||this.chart.bindingX,h=i._getBinding(0),o=i._getBinding(1),_=i._getBinding(2),c=i._getBinding(3),u=i._getAxisY();return r.item=wijmo_chart_1._BasePlotter.cloneStyle(n,[]),r.item[h]=this._rangeValues[t].high,r.item[o]=this._rangeValues[t].low,r.item[_]=this._rangeValues[t].open,r.item[c]=this._rangeValues[t].close,r.y=this._rangeValues[t].close,r.yfmt=u._formatValue(this._rangeValues[t].close),r.x=r.item[l],r.xfmt=this._rangeXLabels[t]._text,r}_init(){this._rangeValues=[],this._rangeXLabels=[]}_calculate(e){}_generateXLabels(e){var t,i=e._getAxisX(),a=e.getDataType(1)||this.chart._xDataType;this._rangeValues.forEach((e,s)=>{var r=e.x;t=a===wijmo_1.DataType.Date?wijmo_1.Globalize.format(wijmo_chart_1.FlexChart._fromOADate(r),i.format||"d"):a===wijmo_1.DataType.Number?i._formatValue(r):null!==a&&a!==wijmo_1.DataType.String||!this.chart._xlabels?r.toString():this.chart._xlabels[r],this._rangeXLabels.push({value:s,text:t,_text:t})},this)}}var DataFields,RangeMode,PointAndFigureScaling,FinancialChartType;exports._BaseRangePlotter=_BaseRangePlotter,function(e){e[e.Close=0]="Close",e[e.High=1]="High",e[e.Low=2]="Low",e[e.Open=3]="Open",e[e.HighLow=4]="HighLow",e[e.HL2=5]="HL2",e[e.HLC3=6]="HLC3",e[e.HLOC4=7]="HLOC4"}(DataFields=exports.DataFields||(exports.DataFields={})),function(e){e[e.Fixed=0]="Fixed",e[e.ATR=1]="ATR",e[e.Percentage=2]="Percentage"}(RangeMode=exports.RangeMode||(exports.RangeMode={})),function(e){e[e.Traditional=0]="Traditional",e[e.Fixed=1]="Fixed",e[e.Dynamic=2]="Dynamic"}(PointAndFigureScaling=exports.PointAndFigureScaling||(exports.PointAndFigureScaling={}));class _PointAndFigurePlotter extends wijmo_chart_1._BasePlotter{constructor(){super()}clear(){super.clear(),this._boxSize=null,this._fields=null,this._reversal=null,this._scaling=null}unload(){super.unload(),this.chart.axisX.itemsSource=this._xlbls}_init(){this._boxSize=this.getNumOption("boxSize","pointAndFigure")||1,this._reversal=this.getNumOption("reversal","pointAndFigure")||3,this._period=this.getNumOption("period","pointAndFigure")||20,this._fields=this.getOption("fields","pointAndFigure")||DataFields.Close,this._fields=wijmo_1.asEnum(this._fields,DataFields,!0),wijmo_1.assert(this._fields==DataFields.Close||this._fields==DataFields.HighLow,"Only DataFields.Close and DataFields.HighLow are supported"),this._scaling=this.getOption("scaling","pointAndFigure")||PointAndFigureScaling.Traditional,this._scaling=wijmo_1.asEnum(this._scaling,PointAndFigureScaling,!0),this._xlbls=[]}adjustLimits(e,t){this._init(),this.hitTester.clear();let i=new wijmo_1.Rect(0,0,0,0),a=this.chart.series.length;if(wijmo_1.assert(a<=1,"Current FinancialChartType only supports a single series"),a>0){let e=this.chart.series[0],t=this._reversal,a=e.collectionView?e.collectionView:this.chart.collectionView,o=a?a.items:null;if(o&&o.length>0){let a=e._getBinding(0),_=e._getBinding(1),c=e._getBinding(2),u=e._getBinding(3);this._fields==DataFields.Close&&(u?a=u:c&&(a=c),_=a);let g=e.bindingX?e.bindingX:this.chart.bindingX,m=this._actualBoxSize=this.calcBoxSize(o,a,_);if(this._pfdata=this.calcPFHiLo2(o,a,_,g,m,t),this._pfdata&&this._pfdata.length>0){var s=this._pfdata.reduce(function(e,t){return Math.max(e,t.max)},this._pfdata[0].max),r=this._pfdata.reduce(function(e,t){return Math.min(e,t.min)},this._pfdata[0].min);i=new wijmo_1.Rect(-.5,r-.5*m,this._pfdata.length,s-r+m);for(var n=1;n<this._pfdata.length;n++){var l=this._pfdata[n-1],h=this._pfdata[n];wijmo_1.isDate(h.date)&&wijmo_1.isDate(l.date)&&h.date.getYear()!=l.date.getYear()&&this._xlbls.push({value:n,text:wijmo_1.Globalize.formatNumber(h.date.getFullYear()%100,"d2")})}}}}return 0==this._xlbls.length&&this._xlbls.push({value:0}),this.axisYMajorGrid=this.chart.axisY.majorGrid,this.chart.axisY.majorGrid=!1,this.chart.axisX.itemsSource=this._xlbls,i}plotSeries(e,t,i,a,s,r,n){if(this._pfdata&&this._pfdata.length>0){var l=this._actualBoxSize;this.renderGrid(e,this._pfdata,l),this.renderData(this.chart,e,this._pfdata,l)}this.chart.axisY.majorGrid=this.axisYMajorGrid}calcBoxSize(e,t,i){var a=e.reduce(function(e,i){return Math.max(e,i[t])},e[0][t]),s=e.reduce(function(e,t){return Math.min(e,t[i])},e[0][i]),r=this._boxSize,n=a-s;switch(this._scaling){case PointAndFigureScaling.Traditional:n<.25?r=.0625:n>=.25&&n<1?r=.125:n>=1&&n<5?r=.25:n>=5&&n<20?r=.5:n>=20&&n<100?r=1:n>=100&&n<200?r=2:n>=200&&n<500?r=4:n>=500&&n<1e3?r=5:n>=1e3&&n<25e3?r=50:n>-25e3&&(r=500);break;case PointAndFigureScaling.Dynamic:let e=this.chart.series[0],t=e._getBindingValues(0),i=e._getBindingValues(1);e._getBindingValues(2);var l=_avgTrueRng(t,i,e._getBindingValues(3),this._period);r=l[l.length-1];break;case PointAndFigureScaling.Fixed:}return r}calcPFHiLo2(e,t,i,a,s,r){let n=[];for(let _=0;_<e.length;_++){let c=e[_][t],u=e[_][i];wijmo_1.assert(c>=u,"'High' value must be larger than 'low' value.");let g=e[_][a];if(0==n.length)n.push({min:this.roundDown(u,s),max:this.roundDown(c,s),rise:!1,date:g});else{var l=n[n.length-1];if(l.rise){var h=l.max+s,o=l.max-r*s;this.roundUp(c,s)>=h?l.max=this.roundUp(c,s):u<=o&&n.push({min:this.roundDown(u,s),max:l.max-s,rise:!1,date:g})}else{h=l.min-s,o=l.min+r*s;this.roundDown(u,s)<=h?l.min=this.roundDown(u,s):c>=o&&n.push({min:l.min+s,max:this.roundUp(c,s),rise:!0,date:g})}}}if(n.length>0){var _=n[0];_.min==_.max&&n.splice(0,1)}return n}roundUp(e,t){return Math.ceil(e/t-.999999)*t}roundDown(e,t){return Math.floor(e/t+.999999)*t}renderGrid(e,t,i){if(this._pfdata){for(var a=this._pfdata.reduce(function(e,t){return Math.max(e,t.max)},this._pfdata[0].max),s=this._pfdata.reduce(function(e,t){return Math.min(e,t.min)},this._pfdata[0].min),r=this.chart,n=this._pfdata.length,l=s-.5*i;l<=a+i;l+=i){var h=new wijmo_1.Point(-.5,l);h=r.dataToPoint(h);var o=new wijmo_1.Point(n,l);o=r.dataToPoint(o),e.stroke=wijmo_chart_1.FlexChartCore._FG,e.strokeWidth=1,e.drawLine(h.x,h.y,o.x,o.y,wijmo_chart_1.FlexChartCore._CSS_GRIDLINE)}for(var _=-.5;_<=n;_+=1){h=new wijmo_1.Point(_,this.chart.axisY.actualMin);h=r.dataToPoint(h);o=new wijmo_1.Point(_,this.chart.axisY.actualMax);o=r.dataToPoint(o),e.stroke=wijmo_chart_1.FlexChartCore._FG,e.strokeWidth=1,e.drawLine(h.x,h.y,o.x,o.y,wijmo_chart_1.FlexChartCore._CSS_GRIDLINE)}}}renderData(e,t,i,a){let s=e.series[0],r=s._getSymbolStroke(0),n=s._getAltSymbolStroke(0)||r;for(let s=0;s<i.length;s++){let h=i[s],o=(i[s].max-i[s].min)/a;if(0==o)continue;let _=new wijmo_1.Point(s-.5,h.min);_=e.dataToPoint(_);let c=new wijmo_1.Point(s+.5,h.max);c=e.dataToPoint(c),t.fill="transparent";let u=(c.y-_.y)/o;for(var l=0;l<o+1;l++)if(t.strokeWidth=1.5,h.rise?(t.stroke=r,t.drawLine(_.x,_.y+(l-.5)*u,c.x,_.y+(l+.5)*u),t.drawLine(c.x,_.y+(l-.5)*u,_.x,_.y+(l+.5)*u)):(t.stroke=n,t.drawEllipse(.5*(_.x+c.x),_.y+l*u,.5*Math.abs(_.x-c.x),.5*Math.abs(u))),this.hitTester){let e=h.min+l*a,t=new wijmo_chart_1._DataPoint(0,s,h.date,e);t.y=e,t.yfmt=this.chart.axisY._formatValue(e),wijmo_1.isDate(h.date)&&(t.x=h.date,t.xfmt=wijmo_1.Globalize.formatDate(h.date,"d"));let i=new wijmo_1.Rect(Math.min(_.x,c.x),_.y+l*u-.5*u,Math.abs(c.x-_.x),u);i.height<0&&(i.top+=u,i.height=-i.height);let r=new wijmo_chart_1._RectArea(i);r.tag=t,this.hitTester.add(r,0)}}}}exports._PointAndFigurePlotter=_PointAndFigurePlotter;class _KagiPlotter extends _BaseRangePlotter{constructor(){super()}_calculate(e){this._init();var t=e._getBindingValues(0),i=e._getBindingValues(1),a=e._getBindingValues(2),s=e._getBindingValues(3),r=e.getValues(1)||this.chart._xvals;this._calculator=new _KagiCalculator(t,i,a,s,r,this._reversalAmount,this._rangeMode,this._fields),this._rangeValues=this._calculator.calculate(),(null===this._rangeValues||wijmo_1.isUndefined(this._rangeValues))&&(this._rangeValues=[]),this._generateXLabels(e)}plotSeries(e,t,i,a,s,r,n){this._calculate(a);var l=this.chart.series.indexOf(a),h=this._rangeValues.length,o=t.actualMin,_=t.actualMax,c=this._DEFAULT_WIDTH,u=a._getSymbolStroke(l),g=a._getAltSymbolStroke(l)||u,m=[],d=[];e.stroke=u,e.strokeWidth=c;var p,w,f,x,v,y,C,j=0;e.startGroup();for(var k=0;k<h;k++)p=k,wijmo_chart_1._DataInfo.isValid(p)&&o<=p&&p<=_&&(w=this._rangeValues[k].open,f=this._rangeValues[k].close,0===k?(x=Math.min(w,f),v=Math.max(w,f),e.strokeWidth=w>f?c:2*c,e.stroke=w>f?u:g,e.drawLine(t.convert(p),i.convert(w),t.convert(p),i.convert(f)),e.drawLine(t.convert(p-1)-e.strokeWidth/2,i.convert(w),t.convert(p)+e.strokeWidth/2,i.convert(w))):e.strokeWidth===c?f>w?(f>v?(e.drawLine(t.convert(p),i.convert(w),t.convert(p),i.convert(v)),e.strokeWidth=2*c,e.stroke=g,e.drawLine(t.convert(p),i.convert(v),t.convert(p),i.convert(f)),x=w):e.drawLine(t.convert(p),i.convert(w),t.convert(p),i.convert(f)),v=f):e.drawLine(t.convert(p),i.convert(w),t.convert(p),i.convert(f)):e.strokeWidth/2===c&&(f<w?(f<x?(e.drawLine(t.convert(p),i.convert(w),t.convert(p),i.convert(x)),e.strokeWidth=c,e.stroke=u,e.drawLine(t.convert(p),i.convert(x),t.convert(p),i.convert(f)),v=w):e.drawLine(t.convert(p),i.convert(w),t.convert(p),i.convert(f)),x=f):e.drawLine(t.convert(p),i.convert(w),t.convert(p),i.convert(f))),k<h-1&&e.drawLine(t.convert(p)-e.strokeWidth/2,i.convert(f),t.convert(p+1)+e.strokeWidth/2,i.convert(f)),C=this._getDataPoint(l,k,a,f),(y=new wijmo_chart_1._CircleArea(new wijmo_1.Point(t.convert(p),i.convert(f)),.5*e.strokeWidth)).tag=C,this.hitTester.add(y,l),a._setPointIndex(k,j),j++,m.push(t.convert(p)),d.push(i.convert(w)),m.push(t.convert(p)),d.push(i.convert(f)));e.endGroup(),this.hitTester.add(new wijmo_chart_1._LinesArea(m,d),l)}_init(){super._init(),this._reversalAmount=this.getNumOption("reversalAmount","kagi")||14,this._rangeMode=this.getOption("rangeMode","kagi")||RangeMode.Fixed,this._rangeMode=wijmo_1.asEnum(this._rangeMode,RangeMode,!0),this._fields=this.getOption("fields","kagi")||DataFields.Close,this._fields=wijmo_1.asEnum(this._fields,DataFields,!0)}clear(){super.clear(),this._reversalAmount=null,this._rangeMode=null}}exports._KagiPlotter=_KagiPlotter;class _RenkoPlotter extends _BaseRangePlotter{constructor(){super()}clear(){super.clear(),this._boxSize=null,this._rangeMode=null}_calculate(e){this._init();var t=e._getBindingValues(0),i=e._getBindingValues(1),a=e._getBindingValues(2),s=e._getBindingValues(3),r=e.getValues(1)||this.chart._xvals;this._calculator=new _RenkoCalculator(t,i,a,s,r,this._boxSize,this._rangeMode,this._fields,this._rounding),this._rangeValues=this._calculator.calculate(),(null===this._rangeValues||wijmo_1.isUndefined(this._rangeValues))&&(this._rangeValues=[]),this._generateXLabels(e)}_init(){super._init(),this._boxSize=this.getNumOption("boxSize","renko")||14,this._rangeMode=this.getOption("rangeMode","renko")||RangeMode.Fixed,this._rangeMode=wijmo_1.asEnum(this._rangeMode,RangeMode,!0),wijmo_1.assert(this._rangeMode!==RangeMode.Percentage,"RangeMode.Percentage is not supported"),this._fields=this.getOption("fields","renko")||DataFields.Close,this._fields=wijmo_1.asEnum(this._fields,DataFields,!0),wijmo_1.assert(this._fields!==DataFields.HighLow,"DataFields.HighLow is not supported"),this._rounding=wijmo_1.asBoolean(this.getOption("rounding","renko"),!0)}_generateXLabels(e){super._generateXLabels(e),this._rangeXLabels.forEach((e,t)=>{t>0&&this._rangeXLabels[t-1]._text===e.text&&(e.text="")},this)}}exports._RenkoPlotter=_RenkoPlotter;class _LineBreakPlotter extends _BaseRangePlotter{constructor(){super()}clear(){super.clear(),this._newLineBreaks=null}_calculate(e){this._init();var t=e._getBindingValues(3),i=e.getValues(1)||this.chart._xvals;this._calculator=new _LineBreakCalculator(null,null,null,t,i,this._newLineBreaks),this._rangeValues=this._calculator.calculate(),(null===this._rangeValues||wijmo_1.isUndefined(this._rangeValues))&&(this._rangeValues=[]),this._generateXLabels(e)}_init(){super._init(),this._newLineBreaks=wijmo_1.asInt(this.getNumOption("newLineBreaks","lineBreak"),!0,!0)||3,wijmo_1.assert(this._newLineBreaks>=1,"Value must be greater than 1")}}exports._LineBreakPlotter=_LineBreakPlotter;class _HeikinAshiPlotter extends wijmo_chart_1._FinancePlotter{constructor(){super(),this._symFactor=.7,this.clear()}clear(){super.clear(),this._haValues=null,this._calculator=null}plotSeries(e,t,i,a,s,r,n){this._calculate(a);var l=wijmo_1.asType(a,wijmo_chart_1.SeriesBase),h=this.chart.series.indexOf(a),o=a.getValues(1),_=this._symFactor,c=this._haValues.length,u=!0;if(o){var g=this.dataInfo.getDeltaX();g>0&&(_*=g)}else o=this.dataInfo.getXVals();o?c=Math.min(c,o.length):(u=!1,o=new Array(c));var m=this._DEFAULT_WIDTH,d=l._getSymbolFill(h),p=l._getAltSymbolFill(h)||"transparent",w=l._getSymbolStroke(h),f=l._getAltSymbolStroke(h)||w,x=_,v=a.getDataType(1)||a.chart._xDataType;e.strokeWidth=m;var y,C,j,k,F,b,P,T,V=t.actualMin,A=t.actualMax,M=0;let L=this.getItemFormatter(a);for(var D=0;D<c;D++)if(j=u?o[D]:D,wijmo_chart_1._DataInfo.isValid(j)&&V<=j&&j<=A){if(F=this._haValues[D].high,b=this._haValues[D].low,P=this._haValues[D].open,T=this._haValues[D].close,y=P<T?p:d,C=P<T?f:w,e.fill=y,e.stroke=C,e.startGroup(),k=this._getDataPoint(h,D,j,a),L){var S=new wijmo_chart_1.HitTestInfo(this.chart,new wijmo_1.Point(t.convert(j),i.convert(F)),wijmo_chart_1.ChartElement.SeriesSymbol);S._setData(l,D),S._setDataPoint(k),L(e,S,()=>{this._drawSymbol(e,t,i,h,D,y,x,j,F,b,P,T,k,v)})}else this._drawSymbol(e,t,i,h,D,y,x,j,F,b,P,T,k,v);e.endGroup(),a._setPointIndex(D,M),M++}}_drawSymbol(e,t,i,a,s,r,n,l,h,o,_,c,u,g){var m,d=null,p=null,w=null,f=null,x=g===wijmo_1.DataType.Date?432e5:.5;if((w=t.convert(l-x*n))>(f=t.convert(l+x*n))){var v=w;w=f,f=v}l=t.convert(l),wijmo_chart_1._DataInfo.isValid(_)&&wijmo_chart_1._DataInfo.isValid(c)&&(_=i.convert(_),c=i.convert(c),p=(d=Math.min(_,c))+Math.abs(_-c),e.drawRect(w,d,f-w,p-d),(m=new wijmo_chart_1._RectArea(new wijmo_1.Rect(w,d,f-w,p-d))).tag=u,this.hitTester.add(m,a)),wijmo_chart_1._DataInfo.isValid(h)&&(h=i.convert(h),null!==d&&(e.drawLine(l,d,l,h),m.rect.top=h,m.rect.height=m.rect.height+h)),wijmo_chart_1._DataInfo.isValid(o)&&(o=i.convert(o),null!==p&&(e.drawLine(l,p,l,o),m.rect.height=m.rect.height+o))}_getDataPoint(e,t,i,a){var s=new wijmo_chart_1._DataPoint(e,t,i,this._haValues[t].high),r=a._getItem(t),n=a._getBinding(0),l=a._getBinding(1),h=a._getBinding(2),o=a._getBinding(3),_=a._getAxisY();return null!=r&&(s.item=wijmo_chart_1._BasePlotter.cloneStyle(r,[]),s.item[n]=this._haValues[t].high,s.item[l]=this._haValues[t].low,s.item[h]=this._haValues[t].open,s.item[o]=this._haValues[t].close),s.y=this._haValues[t].high,s.yfmt=_._formatValue(this._haValues[t].high),s}_calculate(e){var t=e._getBindingValues(0),i=e._getBindingValues(1),a=e._getBindingValues(2),s=e._getBindingValues(3);this._calculator=new _HeikinAshiCalculator(t,i,a,s),this._haValues=this._calculator.calculate(),(null===this._haValues||wijmo_1.isUndefined(this._haValues))&&this._init()}_init(){this._haValues=[]}}exports._HeikinAshiPlotter=_HeikinAshiPlotter,function(e){e[e.Column=0]="Column",e[e.Scatter=1]="Scatter",e[e.Line=2]="Line",e[e.LineSymbols=3]="LineSymbols",e[e.Area=4]="Area",e[e.Candlestick=5]="Candlestick",e[e.HighLowOpenClose=6]="HighLowOpenClose",e[e.HeikinAshi=7]="HeikinAshi",e[e.LineBreak=8]="LineBreak",e[e.Renko=9]="Renko",e[e.Kagi=10]="Kagi",e[e.ColumnVolume=11]="ColumnVolume",e[e.EquiVolume=12]="EquiVolume",e[e.CandleVolume=13]="CandleVolume",e[e.ArmsCandleVolume=14]="ArmsCandleVolume",e[e.PointAndFigure=15]="PointAndFigure"}(FinancialChartType=exports.FinancialChartType||(exports.FinancialChartType={}));class FinancialChart extends wijmo_chart_1.FlexChartCore{constructor(e,t){super(e,null),this._chartType=FinancialChartType.Line,this.__heikinAshiPlotter=null,this.__lineBreakPlotter=null,this.__renkoPlotter=null,this.__kagiPlotter=null,this.__pfPlotter=null,this.initialize(t)}_getProductInfo(){return"A78U,FinancialChart"}get chartType(){return this._chartType}set chartType(e){(e=wijmo_1.asEnum(e,FinancialChartType))!=this._chartType&&(this._chartType=e,this.invalidate())}get options(){return this._options}set options(e){e!=this._options&&(this._options=e,this.invalidate())}get _heikinAshiPlotter(){return null===this.__heikinAshiPlotter&&(this.__heikinAshiPlotter=new _HeikinAshiPlotter,this._initPlotter(this.__heikinAshiPlotter)),this.__heikinAshiPlotter}get _lineBreakPlotter(){return null===this.__lineBreakPlotter&&(this.__lineBreakPlotter=new _LineBreakPlotter,this._initPlotter(this.__lineBreakPlotter)),this.__lineBreakPlotter}get _renkoPlotter(){return null===this.__renkoPlotter&&(this.__renkoPlotter=new _RenkoPlotter,this._initPlotter(this.__renkoPlotter)),this.__renkoPlotter}get _kagiPlotter(){return null===this.__kagiPlotter&&(this.__kagiPlotter=new _KagiPlotter,this._initPlotter(this.__kagiPlotter)),this.__kagiPlotter}get _pfPlotter(){return null===this.__pfPlotter&&(this.__pfPlotter=new _PointAndFigurePlotter,this._initPlotter(this.__pfPlotter)),this.__pfPlotter}_getChartType(){var e=null;switch(this.chartType){case FinancialChartType.Area:e=wijmo_chart_1.ChartType.Area;break;case FinancialChartType.Line:case FinancialChartType.Kagi:case FinancialChartType.PointAndFigure:e=wijmo_chart_1.ChartType.Line;break;case FinancialChartType.Column:case FinancialChartType.ColumnVolume:e=wijmo_chart_1.ChartType.Column;break;case FinancialChartType.LineSymbols:e=wijmo_chart_1.ChartType.LineSymbols;break;case FinancialChartType.Scatter:e=wijmo_chart_1.ChartType.Scatter;break;case FinancialChartType.Candlestick:case FinancialChartType.Renko:case FinancialChartType.HeikinAshi:case FinancialChartType.LineBreak:case FinancialChartType.EquiVolume:case FinancialChartType.CandleVolume:case FinancialChartType.ArmsCandleVolume:e=wijmo_chart_1.ChartType.Candlestick;break;case FinancialChartType.HighLowOpenClose:e=wijmo_chart_1.ChartType.HighLowOpenClose}return e}_getPlotter(e){var t=this.chartType,i=null;if(e){var a=e.chartType;a&&!wijmo_1.isUndefined(a)&&a!=t&&(t=a,!0)}switch(t){case FinancialChartType.HeikinAshi:i=this._heikinAshiPlotter;break;case FinancialChartType.LineBreak:i=this._lineBreakPlotter;break;case FinancialChartType.Renko:i=this._renkoPlotter;break;case FinancialChartType.Kagi:i=this._kagiPlotter;break;case FinancialChartType.ColumnVolume:(i=super._getPlotter(e)).isVolume=!0,i.width=1;break;case FinancialChartType.EquiVolume:(i=super._getPlotter(e)).isEqui=!0,i.isCandle=!1,i.isArms=!1,i.isVolume=!0,i.symbolWidth="100%";break;case FinancialChartType.CandleVolume:(i=super._getPlotter(e)).isEqui=!1,i.isCandle=!0,i.isArms=!1,i.isVolume=!0,i.symbolWidth="100%";break;case FinancialChartType.ArmsCandleVolume:(i=super._getPlotter(e)).isEqui=!1,i.isCandle=!1,i.isArms=!0,i.isVolume=!0,i.symbolWidth="100%";break;case FinancialChartType.PointAndFigure:i=this._pfPlotter;break;default:i=super._getPlotter(e)}return i}_createSeries(){return new FinancialSeries}}exports.FinancialChart=FinancialChart,wijmo_1._registerModule("wijmo.chart.finance",selfModule);