/*!
    *
    * Wijmo Library 5.20191.603
    * http://wijmo.com/
    *
    * Copyright(c) GrapeCity, Inc.  All rights reserved.
    *
    * Licensed under the GrapeCity Commercial License.
    * sales@wijmo.com
    * wijmo.com/products/wijmo-5/license/
    *
    */

import{WjBinding,WjContext,MetaFactory}from"wijmo/wijmo.knockout.base";import*as mKo from"knockout";import*as wjcGrid from"wijmo/wijmo.grid";var wjKo=mKo;export class wjFlexGrid extends WjBinding{_getControlConstructor(){return wjcGrid.FlexGrid}_createWijmoContext(){return new WjFlexGridContext(this)}_initialize(){super._initialize(),MetaFactory.findProp("itemFormatter",this._metaData.props).updateControl=this._formatterPropHandler}_formatterPropHandler(e,t,r,o,l){return o!==e._userFormatter&&(e._userFormatter=o,r.invalidate()),!0}};wjFlexGrid._columnTemplateProp="_wjkoColumnTemplate",wjFlexGrid._cellClonedTemplateProp="__wjkoClonedTempl",wjFlexGrid._cellVMProp="__wjkoCellVM",wjFlexGrid._templColIdx="_wjkoTemplColIdx",wjFlexGrid._columnStyleBinding="wjStyle",wjFlexGrid._columnStyleProp="__wjkoStyle";export class WjFlexGridContext extends WjContext{constructor(){super(...arguments),this._wrapperFormatter=this._itemFormatter.bind(this)}_initControl(){super._initControl(),this.control.itemFormatter=this._wrapperFormatter}_itemFormatter(e,t,r,o){var l=e.columns[r],i=l[wjFlexGrid._columnTemplateProp],n=l[wjFlexGrid._columnStyleProp];if((i||n)&&e.cellType==wjcGrid.CellType.Cell){var a=e.grid.editRange;if(a&&a.row===t&&a.col===r)return;if(e.rows[t]instanceof wjcGrid.GroupRow)return;var d=o[wjFlexGrid._cellVMProp],s=o[wjFlexGrid._cellClonedTemplateProp],m=e.rows[t].dataItem;if(d&&o[wjFlexGrid._templColIdx]!=r&&(o[wjFlexGrid._cellVMProp]=o[wjFlexGrid._cellClonedTemplateProp]=o[wjFlexGrid._templColIdx]=d=s=null,wjKo.cleanNode(o)),d)s&&(o.innerHTML="",o.appendChild(s)),d.$row(t),d.$col(r),d.$item()!=m?d.$item(m):d.$item.valueHasMutated();else{d={$row:wjKo.observable(t),$col:wjKo.observable(r),$item:wjKo.observable(m)};var w=this.bindingContext.extend(d);if(i){o.innerHTML="<div>"+i+"</div>";var j=o.childNodes[0];o[wjFlexGrid._cellClonedTemplateProp]=j}else o.setAttribute("data-bind","style:"+n);o[wjFlexGrid._cellVMProp]=d,o[wjFlexGrid._templColIdx]=r,wjKo.applyBindings(w,o)}var c=o.scrollHeight;e.rows[t].renderHeight<c&&(e.rows.defaultSize=c)}else this._userFormatter&&this._userFormatter(e,t,r,o)}};export class wjFlexGridColumn extends WjBinding{_getControlConstructor(){return wjcGrid.Column}_createControl(e){return new wjcGrid.Column}_createWijmoContext(){return new WjFlexGridColumnContext(this)}};export class WjFlexGridColumnContext extends WjContext{_initControl(){var e=this.parentWjContext;if(e){var t=e.control;t.autoGenerateColumns&&(t.autoGenerateColumns=!1,t.columns.clear())}super._initControl();var r=this.element.innerHTML.trim();this.control[wjFlexGrid._columnTemplateProp]=r;var o=this.allBindings.get(wjFlexGrid._columnStyleBinding);o&&(this.control[wjFlexGrid._columnStyleProp]=o.trim()),(r||o)&&this.control._setFlag(wjcGrid.RowColFlags.HasTemplate,!0),this.element.innerHTML=""}};export class wjStyle{constructor(){this.preprocess=function(e,t,r){return wjStyle.quoteString(e)},this.init=function(){}}static quoteString(e){return null==e?e:"'"+e.replace(/'/g,"\\'")+"'"}static unquoteString(e){return!e||e.length<2?e:("'"===e.charAt(0)&&(e=e.substr(1,e.length-1)),e.replace(/\\\'/g,"'"))}};wjKo.bindingHandlers[wjFlexGrid._columnStyleBinding]=new wjStyle,wjKo.bindingHandlers.wjFlexGrid=new wjFlexGrid,wjKo.bindingHandlers.wjFlexGridColumn=new wjFlexGridColumn;