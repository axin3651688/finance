/*!
    *
    * Wijmo Library 5.20191.603
    * http://wijmo.com/
    *
    * Copyright(c) GrapeCity, Inc.  All rights reserved.
    *
    * Licensed under the GrapeCity Commercial License.
    * sales@wijmo.com
    * wijmo.com/products/wijmo-5/license/
    *
    */

import{Control,_addCultureInfo,culture,setAriaLabel,disableAutoComplete,removeChild,addClass,isIE,isIE9,asBoolean,toggleClass,CancelEventArgs,hasClass,hidePopup,removeClass,asString,setSelectionRange,Event,EventArgs,contains,getActiveElement,showPopup,Key,setAttribute,Binding,asFunction,asNumber,DateTime,isObject,asArray,tryCast,closest,escapeHtml,asType,asCollectionView,hasItems,createElement,getUniqueId,clamp,toPlainText,enable,isFunction,_ClickRepeater,asDate,asEnum,Globalize,setText,isDate,Color,setCss,_MaskProvider,isNumber,isArray,Point,getElementRect,format,moveFocus,getElement,isUndefined,mouseToPage,_registerModule}from"wijmo/wijmo";import*as selfModule from"wijmo/wijmo.input";_addCultureInfo("InputNumber",{ariaLabels:{incVal:"Increase Value",decVal:"Decrease Value"}});export class InputNumber extends Control{constructor(t,e){super(t),this._showBtn=!0,this._readOnly=!1,this.textChanged=new Event,this.valueChanged=new Event;let s=this.hostElement;setAttribute(s,"role","spinbutton",!0);let i=this.getTemplate();this.applyTemplate("wj-control wj-content wj-inputnumber",i,{_tbx:"input",_btnUp:"btn-inc",_btnDn:"btn-dec"},"input");let h=culture.InputNumber.ariaLabels;setAriaLabel(this._btnUp.querySelector("button"),h.incVal),setAriaLabel(this._btnDn.querySelector("button"),h.decVal),this._tbx.type.match(/number/i)&&(this.inputType="");let n=this._tbx;n.autocomplete="off",n.spellcheck=!1,this._updateSymbols();let l=this.addEventListener.bind(this);l(n,"keypress",this._keypress.bind(this)),l(n,"keydown",this._keydown.bind(this)),l(n,"input",this._input.bind(this)),l(n,"blur",()=>{this.text!=this._oldText&&this._setText(this.text)}),l(n,"compositionstart",()=>{this._composing=!0}),l(n,"compositionend",()=>{this._composing=!1,setTimeout(()=>{let t=this.text;this._oldText.indexOf(this._chrPct)>-1&&t.indexOf(this._chrPct)<0&&(t+=this._chrPct),this._setText(t)})});let a=this._clickSpinner.bind(this);l(this._btnUp,"click",a),l(this._btnDn,"click",a),this._rptUp=new _ClickRepeater(this._btnUp.querySelector("button")),this._rptDn=new _ClickRepeater(this._btnDn.querySelector("button")),l(s,"wheel",t=>{if(!t.defaultPrevented&&!this.isReadOnly&&this.containsFocus()){let e=clamp(-t.deltaY,-1,1);this._increment((this.step||1)*e),setTimeout(()=>this.selectAll()),t.preventDefault()}}),this.value=0,this.isRequired=!0,this.initialize(e)}get inputElement(){return this._tbx}get inputType(){return this._tbx.type}set inputType(t){this._tbx.type=asString(t)}get value(){return this._value}set value(t){if(t!=this._value)if(null==(t=asNumber(t,!this.isRequired||null==t&&null==this._value)))this._setText("");else if(!isNaN(t)){let e=Globalize.format(t,this.format);this._setText(e)}}get isRequired(){return this._tbx.required}set isRequired(t){this._tbx.required=asBoolean(t)}get isReadOnly(){return this._readOnly}set isReadOnly(t){this._readOnly=asBoolean(t),this.inputElement.readOnly=this._readOnly,toggleClass(this.hostElement,"wj-state-readonly",this.isReadOnly)}get min(){return this._min}set min(t){t!=this._min&&(this._min=asNumber(t,!0),this._updateAria())}get max(){return this._max}set max(t){t!=this._max&&(this._max=asNumber(t,!0),this._updateAria())}get step(){return this._step}set step(t){this._step=asNumber(t,!0),this._updateBtn()}get format(){return this._format}set format(t){t!=this.format&&(this._format=asString(t),this.refresh())}get text(){return this._tbx.value}set text(t){t!=this.text&&(this._oldText=null,this._setText(t))}get placeholder(){return this._tbx.placeholder}set placeholder(t){this._tbx.placeholder=t}get showSpinner(){return this._showBtn}set showSpinner(t){this._showBtn=asBoolean(t),this._updateBtn()}get repeatButtons(){return!this._rptUp.disabled}set repeatButtons(t){this._rptUp.disabled=this._rptDn.disabled=!asBoolean(t)}selectAll(){let t=this._tbx;setSelectionRange(t,0,t.value.length)}clamp(t){return clamp(t,this.min,this.max)}onTextChanged(t){this.textChanged.raise(this,t),this._updateState()}onValueChanged(t){this._updateAria(),this.valueChanged.raise(this,t)}dispose(){this._rptUp.element=null,this._rptDn.element=null,super.dispose()}onGotFocus(t){this._oldValue=this.value,this.isTouching||(this._tbx.focus(),this.selectAll()),super.onGotFocus(t)}onLostFocus(t){this._composing&&(this._composing=!1,this._setText(this.text));let e=this.clamp(this.value),s=Globalize.format(e,this.format);this._setText(s),super.onLostFocus(t)}refresh(t=!0){super.refresh(t),this._updateSymbols();let e=Globalize.format(this.value,this.format);this._setText(e)}_updateSymbols(){let t=culture.Globalize.numberFormat,e=this.format?this.format.match(/([a-z])(\d*)(,*)(.*)/i):null;this._chrDec=t["."]||".",this._chrTho=t[","]||",",this._chrNeg=t["-"]||"-",this._chrPls=t["+"]||"+",this._chrPct=t["%"]||"%",this._chrCur=e&&e[4]?e[4]:t.currency.symbol||"$",this._fmtSpc=e&&e[1]?e[1].toLowerCase():"n",this._fmtPrc=e&&e[2]?parseInt(e[2]):null,this._rxSym=new RegExp("^[%+\\-() \\"+this._chrDec+"\\"+this._chrCur+"\\"+this._chrNeg+"\\"+this._chrPls+"\\"+this._chrPct+"]*$"),this._rxNeg=new RegExp("(\\-|\\(|\\"+this._chrNeg+")")}_isNumeric(t,e){let s=t==this._chrDec||t>="0"&&t<="9",i="x"==this._fmtSpc;return!s&&i&&(s=t>="a"&&t<="f"||t>="A"&&t<="F"),s||e||i||(s=t==this._chrPls||t==this._chrNeg||"("==t||")"==t),s}_getInputRange(t){let e=[0,0],s=this.text,i=!1;for(let h=0;h<s.length;h++)this._isNumeric(s[h],t)&&(i||(e[0]=h,i=!0),e[1]=h+1);return e}_flipSign(){let t=this._getSelStartDigits();this.value*=-1,this._setSelStartDigits(t)}_getSelStartDigits(){let t=0,e=this._tbx.selectionStart,s=this._tbx.value;for(let i=0;i<s.length&&i<e;i++)this._isNumeric(s[i],!0)&&t++;return t}_setSelStartDigits(t){let e=this._tbx.value;for(let s=0;s<e.length&&t>=0;s++)if(this._isNumeric(e[s],!0)){if(!t){setSelectionRange(this._tbx,s);break}t--}else if(!t){setSelectionRange(this._tbx,s);break}}_increment(t){if(t){let e=this.clamp(isNumber(this.value)?this.value+t:0),s=Globalize.format(e,this.format,!1,!1);this._setText(s)}}_updateBtn(){let t=this.showSpinner&&!!this.step,e=t;setCss([this._btnUp,this._btnDn],{display:t?"":"none"}),toggleClass(this.hostElement,"wj-input-show-spinner",t),enable(this._btnUp,e),enable(this._btnDn,e),this._updateAria()}_setText(t){if(this._composing)return;let e=this._tbx,s=this._rxNeg.test(t),i=this._delKey;if(t&&this._rxSym.test(t)&&this.containsFocus()&&(t=this.isRequired||!i?"0":""),this._delKey=!1,i&&0==this.value&&!this.isRequired&&(t=""),!t){if(!this.isRequired)return e.value="",null!=this._value&&(this._value=null,this.onValueChanged()),this._oldText&&(this._oldText=t,this.onTextChanged()),void this._updateBtn();t="0"}let h=this._format||(t.indexOf(this._chrDec)>-1?"n2":"n0"),n=Globalize.parseFloat(t,h);if(isNaN(n))return void(e.value=this._oldText);let l=Globalize.format(n,h,!1);s&&n>=0&&!i&&(l=this._chrNeg+l),null!=this._fmtPrc&&"g"!=this._fmtSpc||!i&&e.value.match(/\.0?$/)&&(l=t+("0"==t?this._chrDec:"")),e.value!=l&&("g"==this._fmtSpc&&e.value.match(l+"0*")&&this.containsFocus()&&e.selectionStart==e.value.length&&(l=e.value),e.value=l,n=Globalize.parseFloat(l,this.format)),n!=this._value&&(this._value=n,this.onValueChanged()),this.text!=this._oldText&&(this._oldText=this.text,this.onTextChanged()),this._updateBtn()}_keypress(t){if(!(t.defaultPrevented||this._composing||this.isReadOnly)&&t.charCode&&!t.ctrlKey&&!t.metaKey){let e=this._tbx,s=String.fromCharCode(t.charCode);if(this._isNumeric(s,!1)){let s=this._getInputRange(!0),i=e.selectionStart,h=e.selectionEnd;if(i<s[0]&&h<e.value.length&&(h=Math.max(h,s[0]),setSelectionRange(e,s[0],h)),i>=s[1]){let s=null!=this._fmtPrc?this._fmtPrc:2,h=e.value.indexOf(this._chrDec);h>-1&&i-h>s&&t.preventDefault()}}else t.preventDefault();switch(s){case"-":case this._chrNeg:this.min>=0?this.value<0&&this._flipSign():this.value&&e.selectionStart==e.selectionEnd?this._flipSign():this.clamp(-1)<0&&(e.value=this._chrNeg,setSelectionRange(e,1)),t.preventDefault();break;case"+":case this._chrPls:this.value<0&&this._flipSign(),t.preventDefault();break;case".":case this._chrDec:if(0==this._fmtPrc)t.preventDefault();else{let s=e.value.indexOf(this._chrDec);s>-1&&(e.selectionStart<=s&&s++,setSelectionRange(e,s),t.preventDefault())}}if(!t.defaultPrevented&&isIE()){let i=e.value,h=e.selectionStart,n=e.selectionEnd;h==n&&(e.value=i.substr(0,h)+s+i.substr(n),setSelectionRange(e,h+1),t.preventDefault(),this._input())}}}_keydown(t){if(this._delKey=!1,t.defaultPrevented||this._composing)return;let e=this._tbx,s=e.value,i=e.selectionStart,h=e.selectionEnd;switch(t.keyCode){case 65:t.ctrlKey&&(setTimeout(()=>{this.selectAll()}),t.preventDefault());break;case Key.Up:case Key.Down:this.step&&!this.isReadOnly&&(this._increment(this.step*(t.keyCode==Key.Up?1:-1)),setTimeout(()=>{this.selectAll()}),t.preventDefault());break;case Key.Back:if(this._delKey=!0,h-i<2&&!this.isReadOnly){let i=s[h-1];i!=this._chrDec&&i!=this._chrPct&&i!=this._chrTho&&")"!=i||(setTimeout(()=>{h=i==this._chrPct?this._getInputRange(!0)[1]:h-1,setSelectionRange(e,h)}),t.preventDefault())}break;case Key.Delete:if(this._delKey=!0,h-i<2&&!this.isReadOnly)if("0"==s&&1==i)setSelectionRange(e,0);else{let h=s[i];h!=this._chrDec&&h!=this._chrPct||(setTimeout(()=>{setSelectionRange(e,i+1)}),t.preventDefault())}break;case Key.Escape:this.value=this._oldValue,this.selectAll()}}_input(){this._composing||setTimeout(()=>{let t=this._tbx,e=t.value,s=e.indexOf(this._chrDec),i=t.selectionStart,h=this._getSelStartDigits();if("p"==this._fmtSpc&&e.length&&e.indexOf(this._chrPct)<0&&(e+=this._chrPct),this._setText(e),this.containsFocus()){let n=t.value,l=n.indexOf(this._chrDec),a=this._getInputRange(!0);if(e==this._chrNeg+this._chrDec&&l>-1)return void setSelectionRange(t,l+1);if(e[0]==this._chrNeg&&n[0]!=this._chrNeg)return void(1==n.length?setSelectionRange(t,1):this._setSelStartDigits(h));e?e==this._chrDec&&l>-1?i=l+1:i<=s&&l>-1||s<0&&l<0?i+=n.length-e.length:s<0&&l>-1&&(i=l):i=l>-1?l:a[1],i=clamp(i,a[0],a[1]),setSelectionRange(t,i)}})}_clickSpinner(t){t.defaultPrevented||this.isReadOnly||!this.step||(this._increment(this.step*(contains(this._btnUp,t.target)?1:-1)),this.isTouching||setTimeout(()=>this.selectAll()))}_updateAria(){let t=this.hostElement;t&&(setAttribute(t,"aria-valuemin",this.min),setAttribute(t,"aria-valuemax",this.max),setAttribute(t,"aria-valuenow",this.value))}};InputNumber.controlTemplate='<div class="wj-input"><div class="wj-input-group"><span wj-part="btn-dec" class="wj-input-group-btn" tabindex="-1"><button class="wj-btn wj-btn-default" tabindex="-1">-</button></span><input type="tel" wj-part="input" class="wj-form-control wj-numeric"/><span wj-part="btn-inc" class="wj-input-group-btn" tabindex="-1"><button class="wj-btn wj-btn-default" tabindex="-1">+</button></span></div></div>';export class InputMask extends Control{constructor(t,e){super(t),this.valueChanged=new Event;let s=this.getTemplate();if(this.applyTemplate("wj-control wj-content wj-inputmask",s,{_tbx:"input"},"input"),"INPUT"==this._orgTag){let t=this._tbx.getAttribute("value");t&&(this.value=t)}this._msk=new _MaskProvider(this._tbx),this.isRequired=!0,this.initialize(e),this.addEventListener(this._tbx,"input",()=>{setTimeout(()=>{this.onValueChanged()})})}get inputElement(){return this._tbx}get inputType(){return this._tbx.type}set inputType(t){this._tbx.type=asString(t)}get value(){return this._tbx.value}set value(t){t!=this.value&&(this._tbx.value=asString(t),t=this._msk._applyMask(),this._tbx.value=t,this.onValueChanged())}get rawValue(){return this._msk.getRawValue()}set rawValue(t){t!=this.rawValue&&(this.value=asString(t))}get mask(){return this._msk.mask}set mask(t){let e=this.value;this._msk.mask=asString(t),this.value!=e&&this.onValueChanged()}get promptChar(){return this._msk.promptChar}set promptChar(t){let e=this.value;this._msk.promptChar=t,this.value!=e&&this.onValueChanged()}get placeholder(){return this._tbx.placeholder}set placeholder(t){this._tbx.placeholder=t}get maskFull(){return this._msk.maskFull}get isRequired(){return this._tbx.required}set isRequired(t){this._tbx.required=asBoolean(t)}get isReadOnly(){return this._tbx.readOnly}set isReadOnly(t){this._tbx.readOnly=asBoolean(t),toggleClass(this.hostElement,"wj-state-readonly",this.isReadOnly)}selectAll(){let t=this._msk.getMaskRange();setSelectionRange(this._tbx,t[0],t[1]+1)}onValueChanged(t){this.value!=this._oldValue&&(this._oldValue=this.value,this.valueChanged.raise(this,t)),this._updateState()}_updateState(){super._updateState();let t=!this._pristine&&this._tbx.value&&!this.maskFull;toggleClass(this.hostElement,"wj-state-invalid",t)}dispose(){this._msk.input=null,super.dispose()}refresh(t=!0){super.refresh(t),this._msk.refresh()}onGotFocus(t){super.onGotFocus(t),this.selectAll()}};InputMask.controlTemplate='<div class="wj-input"><div class="wj-input-group"><input wj-part="input" class="wj-form-control"/></div></div>';export class ColorPicker extends Control{constructor(t,e){super(t),this._hsb=[.5,1,1],this._alpha=1,this.valueChanged=new Event;let s=this.getTemplate();this.applyTemplate("wj-control wj-content wj-colorpicker",s,{_eSB:"div-sb",_eHue:"div-hue",_eAlpha:"div-alpha",_ePreview:"div-pv",_ePal:"div-pal",_eText:"div-text"}),this._palette="#FFF,#000, #F00,#FFC000,#FFFF00,#92D050,#00B050,#00B0F0,#0070C0,#7030A0".split(","),this._updatePalette(),this._eHue.style.backgroundImage="url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAD4CAIAAACi6hsPAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAAYdEVYdFNvZnR3YXJlAHBhaW50Lm5ldCA0LjAuM4zml1AAAAGvSURBVDhPXdBPaM9xHMfxz4pWaxcmtoOhpdXSVpiyHWxqmVpDjaU5rK34XfypjTJ/p+ZPay6jhsOsRrKwaJElf9IQq03WIkv4FeMwMq221tfje1ByeFzfvd7PEKWGEKWTQRZLySWfVRRTQjmVbKWGOhLsZT+HaeY0bbTTQSfdXOcWffTzmAFeMcwoYyT5ygS/mA5hNgphip98J8kHRnnNSwZ4yH1uc4OrdHGR87RximYO0cgedlLLdqqoYAPrWMtKVrCcJSxiPmnMJUQp/Bsyk2xyyKOAQooopYwKtlDNDur5G7SBJo7RQiv/B+2hl3s84CkvGGKEOOYnxolj/mYmhBmDJ5ngCx95xxsGecYj4pB3iENeoZMO2mmlhaMcpIE4ZII6aqhmM3HMMkooopB88sghm0wySCeVlCjMCVFIYx4LWUwOeRSwhmLWU84mqqihll3sppEmjnOSs5zjEl1c4yZ99POE5wwxwns+840fTDFLFKaZZIJxkozxlmEGGSC+GF++Sy89dHOZC8Rr4lVnOMERDrCPBPXEX22jko2UEn+/mnxyWUYWC0gnNUQh/AEc0HJs6cex0gAAAABJRU5ErkJggg==)",this._eHue.style.backgroundSize="contain",navigator.appVersion.indexOf("MSIE 9")>-1&&(this._eSB.children[0].style.filter="progid:DXImageTransform.Microsoft.gradient(startColorstr=#ffffffff,endColorstr=#00ffffff,GradientType=1)",this._eSB.children[1].style.filter="progid:DXImageTransform.Microsoft.gradient(startColorstr=#00000000,endColorstr=#ff000000,GradientType=0)"),s=ColorPicker._tplCursor,this._cSB=createElement(s),this._cHue=createElement(s),this._cHue.style.width="100%",this._cAlpha=createElement(s),this._cAlpha.style.height="100%",this._eSB.appendChild(this._cSB),this._eHue.appendChild(this._cHue),this._eAlpha.appendChild(this._cAlpha),this.addEventListener(this.hostElement,"mousedown",t=>{document.addEventListener("mousemove",i),document.addEventListener("mouseup",h),this._mouseDown(t)});let i=t=>{this._mouseMove(t)},h=t=>{document.removeEventListener("mousemove",i),document.removeEventListener("mouseup",h),this._mouseUp(t)};this.addEventListener(this.hostElement,"click",t=>{let e=t.target;if(e&&"DIV"==e.tagName&&contains(this._ePal,e)){let t=e.style.backgroundColor;t&&(this.value=new Color(t).toString())}}),this.value="#ffffff",this.initialize(e),this._updatePanels()}get showAlphaChannel(){return"none"!=this._eAlpha.parentElement.style.display}set showAlphaChannel(t){this._eAlpha.parentElement.style.display=asBoolean(t)?"":"none"}get showColorString(){return"none"!=this._eText.style.display}set showColorString(t){this._eText.style.display=asBoolean(t)?"":"none"}get value(){return this._value}set value(t){if(t!=this.value){this._value=asString(t),this._eText.innerText=this._value;let e=new Color(this._value),s=e.getHsb();this._hsb[0]==s[0]&&this._hsb[1]==s[1]&&this._hsb[2]==s[2]&&this._alpha==e.a||(0==s[2]?(s[0]=this._hsb[0],s[1]=this._hsb[1]):0==s[1]&&(s[0]=this._hsb[0]),this._hsb=s,this._alpha=e.a,this.onValueChanged())}}get palette(){return this._palette}set palette(t){t=asArray(t);for(let e=0;e<t.length&&e<this._palette.length;e++){let s=asString(t[e]);this._palette[e]=s}this._updatePalette()}onValueChanged(t){this._updatePanels(),this.valueChanged.raise(this,t)}_mouseDown(t){this._htDown=this._getTargetPanel(t),this._htDown&&(t.preventDefault(),this.focus(),this._mouseMove(t))}_mouseMove(t){if(this._htDown){let e=this._htDown.getBoundingClientRect();this._htDown==this._eHue?(this._hsb[0]=clamp((t.clientY-e.top)/e.height,0,.99),this._updateColor()):this._htDown==this._eSB?(this._hsb[1]=clamp((t.clientX-e.left)/e.width,0,1),this._hsb[2]=clamp(1-(t.clientY-e.top)/e.height,0,1),this._updateColor()):this._htDown==this._eAlpha&&(this._alpha=clamp((t.clientX-e.left)/e.width,0,1),this._updateColor())}}_mouseUp(t){this._htDown=null}_updateColor(){let t=Color.fromHsb(this._hsb[0],this._hsb[1],this._hsb[2],this._alpha);this.value=t.toString(),this._updatePanels()}_updatePalette(){let t=new Color("#fff"),e=new Color("#000");this._ePal.innerHTML="";for(let s=0;s<this._palette.length;s++){let i=createElement('<div style="float:left;width:10%;box-sizing:border-box;padding:1px">'),h=new Color(this._palette[s]),n=h.getHsb();i.appendChild(this._makePalEntry(h,4));for(let s=0;s<5;s++){if(0==n[1]){let i=.1*s+(n[2]>.5?.05:.55);h=Color.interpolate(t,e,i)}else h=Color.fromHsb(n[0],.1+.2*s,1-.1*s);i.appendChild(this._makePalEntry(h,0))}this._ePal.appendChild(i)}}_makePalEntry(t,e){let s=document.createElement("div");return setCss(s,{cursor:"pointer",backgroundColor:t.toString(),marginBottom:e||""}),s.innerHTML="&nbsp",s}_updatePanels(){let t=Color.fromHsb(this._hsb[0],1,1,1),e=Color.fromHsb(this._hsb[0],this._hsb[1],this._hsb[2],1);this._eSB.style.backgroundColor=t.toString(),this._eAlpha.style.background="linear-gradient(to right, transparent 0%, "+e.toString()+" 100%)",navigator.appVersion.indexOf("MSIE 9")>-1&&(this._eAlpha.style.filter="progid:DXImageTransform.Microsoft.gradient(startColorstr=#00000000,endColorstr="+e.toString()+", GradientType = 1)"),this._ePreview.style.backgroundColor=this.value,this._cHue.style.top=(100*this._hsb[0]).toFixed(0)+"%",this._cSB.style.left=(100*this._hsb[1]).toFixed(0)+"%",this._cSB.style.top=(100-100*this._hsb[2]).toFixed(0)+"%",this._cAlpha.style.left=(100*this._alpha).toFixed(0)+"%"}_getTargetPanel(t){let e=t.target;return contains(this._eSB,e)?this._eSB:contains(this._eHue,e)?this._eHue:contains(this._eAlpha,e)?this._eAlpha:null}};ColorPicker.controlTemplate='<div style="position:relative;width:100%;height:100%"><div style="float:left;width:50%;height:100%;box-sizing:border-box;padding:2px"><div wj-part="div-pal"><div style="float:left;width:10%;box-sizing:border-box;padding:2px"><div style="background-color:black;width:100%">&nbsp;</div><div style="height:6px"></div></div></div><div wj-part="div-text" style="position:absolute;bottom:0px;display:none"></div></div><div style="float:left;width:50%;height:100%;box-sizing:border-box;padding:2px"><div wj-part="div-sb" class="wj-colorbox" style="float:left;width:89%;height:89%"><div style="position:absolute;width:100%;height:100%;background:linear-gradient(to right, white 0%,transparent 100%)"></div><div style="position:absolute;width:100%;height:100%;background:linear-gradient(to top, black 0%,transparent 100%)"></div></div><div style="float:left;width:1%;height:89%"></div><div style="float:left;width:10%;height:89%"><div wj-part="div-hue" class="wj-colorbox"></div></div><div style="float:left;width:89%;height:1%"></div><div style="float:left;width:89%;height:10%"><div style="width:100%;height:100%;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAIAAABLbSncAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAAYdEVYdFNvZnR3YXJlAHBhaW50Lm5ldCA0LjAuM4zml1AAAAAcSURBVBhXY/iPBBYgAWpKQGkwgMqDAdUk/v8HAM7Mm6GatDUYAAAAAElFTkSuQmCC)"><div wj-part="div-alpha" class="wj-colorbox"></div></div></div><div style="float:left;width:1%;height:10%"></div><div style="float:left;width:10%;height:10%"><div wj-part="div-pv" class="wj-colorbox" style="position:static"></div></div></div></div>',ColorPicker._tplCursor='<div style="position:absolute;left:50%;top:50%;width:7px;height:7px;transform:translate(-50%,-50%);border:2px solid #f0f0f0;border-radius:50px;box-shadow:0px 0px 4px 2px #0f0f0f"></div>';export class ListBox extends Control{constructor(t,e){super(t),this._pathDisplay=new Binding(null),this._pathValue=new Binding(null),this._pathChecked=new Binding(null),this._html=!1,this._shGroups=!1,this._checkedItems=[],this._itemRole="option",this._search="",this._fmtItemHandlers=0,this._itemCount=0,this.selectedIndexChanged=new Event,this.itemsChanged=new Event,this.loadingItems=new Event,this.loadedItems=new Event,this.itemChecked=new Event,this.checkedItemsChanged=new Event,this.formatItem=new Event(()=>{this.invalidate()}),this.applyTemplate("wj-control wj-content wj-listbox",null,null);let s=this.hostElement;setAttribute(s,"role","listbox",!0),"SELECT"==this._orgTag&&this._initFromSelect(this.hostElement),this.addEventListener(s,"click",this._click.bind(this)),this.addEventListener(s,"keydown",this._keydown.bind(this)),this.addEventListener(s,"keypress",this._keypress.bind(this)),this.addEventListener(s,"wheel",t=>{s.scrollHeight>s.offsetHeight&&(t.deltaY<0&&0==s.scrollTop||t.deltaY>0&&s.scrollTop+s.offsetHeight>=s.scrollHeight)&&t.preventDefault()}),this.initialize(e)}get itemsSource(){return this._items}set itemsSource(t){this._items!=t&&(this._cv&&(this._cv.currentChanged.removeHandler(this._cvCurrentChanged,this),this._cv.collectionChanged.removeHandler(this._cvCollectionChanged,this),this._cv=null),this._items=t,this._cv=asCollectionView(t),null!=this._cv&&(this._cv.currentChanged.addHandler(this._cvCurrentChanged,this),this._cv.collectionChanged.addHandler(this._cvCollectionChanged,this)),this._populateList(),this.onItemsChanged(),this.onSelectedIndexChanged())}get collectionView(){return this._cv}get showGroups(){return this._shGroups}set showGroups(t){t!=this._shGroups&&(this._shGroups=asBoolean(t),this._populateList())}get isContentHtml(){return this._html}set isContentHtml(t){t!=this._html&&(this._html=asBoolean(t),this._populateList())}get itemFormatter(){return this._itemFormatter}set itemFormatter(t){t!=this._itemFormatter&&(this._itemFormatter=asFunction(t),this._populateList())}get displayMemberPath(){return this._pathDisplay.path}set displayMemberPath(t){t!=this.displayMemberPath&&(this._pathDisplay.path=asString(t),this._populateList())}get selectedValuePath(){return this._pathValue.path}set selectedValuePath(t){this._pathValue.path=asString(t)}get checkedMemberPath(){return this._pathChecked.path}set checkedMemberPath(t){t!=this.checkedMemberPath&&(this._pathChecked.path=asString(t),this._populateList())}get itemRole(){return this._itemRole}set itemRole(t){t!=this.itemRole&&(this._itemRole=asString(t),this._populateList())}getDisplayValue(t){let e=null;t>-1&&hasItems(this._cv)&&(e=this._cv.items[t],this.displayMemberPath&&(e=this._pathDisplay.getValue(e)));let s=null!=e?e.toString():"";return this._itemFormatter&&(s=this._itemFormatter(t,s)),s}getDisplayText(t){let e=this._getChild(t);return null!=e?e.textContent:""}isItemEnabled(t){var e=this._getChild(t);return null!=e&&!e.hasAttribute("disabled")&&!hasClass(e,"wj-state-disabled")&&!hasClass(e,"wj-separator")}get selectedIndex(){return this._cv?this._cv.currentPosition:-1}set selectedIndex(t){this._cv&&this._cv.moveCurrentToPosition(asNumber(t))}get selectedItem(){return this._cv?this._cv.currentItem:null}set selectedItem(t){this._cv&&this._cv.moveCurrentTo(t)}get selectedValue(){let t=this.selectedItem;return t&&this.selectedValuePath&&(t=this._pathValue.getValue(t)),t}set selectedValue(t){let e=this.selectedValuePath,s=-1;if(this._cv){for(let i=0;i<this._cv.items.length;i++){let h=this._cv.items[i],n=e?this._pathValue.getValue(h):h;if(n===t||DateTime.equals(n,t)){s=i;break}}this.selectedIndex=s}}get maxHeight(){let t=this.hostElement;return t?parseFloat(t.style.maxHeight):null}set maxHeight(t){let e=this.hostElement;e&&(e.style.maxHeight=asNumber(t)+"px")}showSelection(t){let e=this.selectedIndex,s=this.hostElement,i=s.children;e=this._getElementIndex(e);for(let t=0;t<i.length;t++){let s=i[t],h=t==e;toggleClass(s,"wj-state-selected",h),setAttribute(s,"aria-selected",h),s.tabIndex=h?this._orgTabIndex:-1}if(e>-1&&e<i.length){let t=i[e].getBoundingClientRect(),h=s.getBoundingClientRect(),n=0;if(this._shGroups){let t=i[0];hasClass(t,"wj-header")&&(n=t.offsetHeight)}t.bottom>h.bottom?s.scrollTop+=t.bottom-h.bottom:t.top<h.top+n&&(s.scrollTop-=h.top+n-t.top)}if(e>-1&&(null==t&&(t=this.containsFocus()),t)){let t=i[e];t instanceof HTMLElement&&!contains(t,getActiveElement())&&t.focus()}s.tabIndex=e<0?this._orgTabIndex:-1}loadList(){this._populateList()}getItemChecked(t){let e=this._cv.items[t],s=this._pathChecked;if(isObject(e)&&s.path)return s.getValue(e);let i=this._getCheckbox(t);return!!i&&i.checked}setItemChecked(t,e){this._setItemChecked(t,e,!0)}toggleItemChecked(t){this.setItemChecked(t,!this.getItemChecked(t))}get checkedItems(){if(this._checkedItems.splice(0,this._checkedItems.length),this._cv)for(let t=0;t<this._cv.items.length;t++)this.getItemChecked(t)&&this._checkedItems.push(this._cv.items[t]);return this._checkedItems}set checkedItems(t){let e=this._cv,s=this.hostElement,i=asArray(t,!1),h=!1;if(e&&i){let t=e.currentPosition,n=s.scrollTop;for(let t=0;t<e.items.length;t++){let s=e.items[t];this._setItemChecked(t,i.indexOf(s)>-1,!1)&&(h=!0)}e.moveCurrentToPosition(t),s.scrollTop=n,h&&this.onCheckedItemsChanged()}}indexOf(t){if(this._shGroups&&hasClass(t,"wj-header"))return-1;let e=this.hostElement.children;for(let s=0,i=0;s<e.length;s++){let h=e[s];if(contains(e[s],t))return i;this._shGroups&&hasClass(h,"wj-header")||i++}return-1}onSelectedIndexChanged(t){this.selectedIndexChanged.raise(this,t)}onItemsChanged(t){this.itemsChanged.raise(this,t)}onLoadingItems(t){this.loadingItems.raise(this,t)}onLoadedItems(t){this.loadedItems.raise(this,t)}onItemChecked(t){this.itemChecked.raise(this,t)}onCheckedItemsChanged(t){this.checkedItemsChanged.raise(this,t)}onFormatItem(t){this.formatItem.raise(this,t)}refresh(t=!0){super.refresh(t);let e=this._cv?this._cv.items.length:0,s=this.formatItem.handlerCount;e==this._itemCount&&s==this._fmtItemHandlers||(this._fmtItemHandlers=s,this._populateList())}_getChild(t){return t=this._getElementIndex(t),this.hostElement.children[t]}_getElementIndex(t){if(this._shGroups){let e=this.hostElement.children;for(let s=0;s<=t&&s<e.length;s++){let i=e[s];hasClass(i,"wj-header")&&t++}}return t}_setItemChecked(t,e,s=!0){let i=this._cv.items[t],h=this._pathChecked,n=!1;if(isObject(i)&&h.path){let t=tryCast(this._cv,"IEditableCollectionView");h.getValue(i)!=e&&(n=!0,this._checking=!0,t?(t.editItem(i),h.setValue(i,e),t.commitEdit()):(h.setValue(i,e),this._cv.refresh()),this._checking=!1)}else n=!0;let l=this._getCheckbox(t);if(l){l.checked=e;let t=closest(l,".wj-listbox-item");t&&toggleClass(t,"wj-state-checked",e)}return s&&n&&(this.onItemChecked(),this.onCheckedItemsChanged()),n}_cvCollectionChanged(t,e){this._checking||(this._populateList(),this.onItemsChanged())}_cvCurrentChanged(t,e){this._checking||(this.showSelection(),this.onSelectedIndexChanged())}_populateList(){let t=this.hostElement;if(this._itemCount=this._cv?this._cv.items.length:0,t){let e,s=this.containsFocus(),i=-1;this.onLoadingItems(),t.textContent="",t.scrollTop=0;let h=this._cv;if(h){let s,n=[],l=0;if(i=h.currentPosition,this._shGroups&&h.groups&&h.groups.length){e={};for(let t=0;t<h.groups.length;t++){let i=h.groups[t];e[l]=i,s=this._createHeaderItem(i),n.push(s);for(let t=0;t<i.items.length;t++,l++)s=this._createItem(l),n.push(s)}}else for(let t=0;t<h.items.length;t++,l++)s=this._createItem(l),n.push(s);t.innerHTML=n.join("")}if(this.formatItem.hasHandlers&&h){let s=t.children,i=h.items,n=0,l=new FormatItemEventArgs(0,null,null);for(let t=0;t<s.length;t++)l._item=s[t],this._shGroups&&hasClass(l._item,"wj-header")?(l._index=-1,l._data=e[n]):(l._index=n,l._data=i[n],n++),this.onFormatItem(l)}if(0==t.children.length&&t.appendChild(document.createElement("div")),t.tabIndex=i<0?this._orgTabIndex:-1,s){(i>=0?t.children[this._getElementIndex(i)]:t).focus()}else i>0&&this.showSelection();this.onLoadedItems()}}_createItem(t){let e=this._cv.items[t],s=t==this._cv.currentPosition,i=this.getDisplayValue(t);1!=this._html&&(i=escapeHtml(i));let h=!1;this.checkedMemberPath&&(i='<label><input tabindex="-1" type="checkbox"'+((h=this._pathChecked.getValue(e))?" checked":"")+"> "+i+"</label>");let n="wj-listbox-item";if(s&&(n+=" wj-state-selected"),h&&(n+=" wj-state-checked"),this._html){let t=["wj-separator","wj-state-disabled"];if(i.indexOf(t[0])>-1||i.indexOf(t[1])>-1){let e=createElement(i);t.forEach(t=>{hasClass(e,t)&&(n+=" "+t)})}}return'<div class="'+n+'" role="'+this.itemRole+'" aria-selected="'+s+'" tabindex="'+(s?this._orgTabIndex:-1)+'">'+i+"</div>"}_createHeaderItem(t){return'<div class="wj-listbox-item wj-header wj-state-disabled" role="presentation" tabindex="-1">'+escapeHtml(t.name)+"</div>"}_click(t){if(0==t.button&&!t.defaultPrevented){let e=this.indexOf(t.target);if(e>-1&&(this.selectedIndex=e,this.checkedMemberPath)){let s=this._getCheckbox(e),i=this.hostElement.children[e];s!=t.target&&t.target!=i||(i.focus({preventScroll:!0}),this.setItemChecked(e,s.checked))}}}_keydown(t){let e=this.selectedIndex;this.hostElement.children;if(!t.defaultPrevented){if(65==t.keyCode&&(t.ctrlKey||t.metaKey)&&this.checkedMemberPath&&hasItems(this.collectionView))return this.checkedItems=this.getItemChecked(0)?[]:this.collectionView.items,void t.preventDefault();if(!(t.ctrlKey||t.shiftKey||t.altKey||t.metaKey))switch(t.keyCode){case Key.Down:t.preventDefault(),this._selectNext();break;case Key.Up:t.preventDefault(),this._selectPrev();break;case Key.Home:t.preventDefault(),this._selectFirst();break;case Key.End:t.preventDefault(),this._selectLast();break;case Key.PageDown:t.preventDefault(),this._selectNextPage();break;case Key.PageUp:t.preventDefault(),this._selectPrevPage();break;case Key.Space:if(this.checkedMemberPath&&e>-1){let s=this._getCheckbox(e);s&&this.isItemEnabled(e)&&(this.setItemChecked(e,!s.checked),t.preventDefault())}}}}_keypress(t){if(!t.defaultPrevented&&!(t.target instanceof HTMLInputElement)&&(t.charCode>32||32==t.charCode&&this._search)){t.preventDefault(),this._search+=String.fromCharCode(t.charCode).toLowerCase(),this._toSearch&&clearTimeout(this._toSearch),this._toSearch=setTimeout(()=>{this._toSearch=null,this._search=""},Control._SEARCH_DELAY);let e=this._findNext();e<0&&this._search.length>1&&(this._search=this._search[this._search.length-1],e=this._findNext()),e>-1&&(this.selectedIndex=e)}}_selectNext(){let t=this.hostElement.children.length;for(let e=this.selectedIndex+1;e<t;e++)if(this.isItemEnabled(e))return this.selectedIndex=e,!0;return!1}_selectPrev(){for(let t=this.selectedIndex-1;t>=0;t--)if(this.isItemEnabled(t))return this.selectedIndex=t,!0;return!1}_selectFirst(){let t=this.hostElement.children.length;for(let e=0;e<t;e++)if(this.isItemEnabled(e))return this.selectedIndex=e,!0;return!1}_selectLast(){for(let t=this.hostElement.children.length-1;t>=0;t--)if(this.isItemEnabled(t))return this.selectedIndex=t,!0;return!1}_selectNextPage(){let t=this.hostElement,e=t.offsetHeight,s=t.children,i=0;for(let t=this.selectedIndex+1;t<this._cv.items.length;t++){let h=s[t].scrollHeight;if(i+h>e&&this.isItemEnabled(t))return this.selectedIndex=t,!0;i+=h}return this._selectLast()}_selectPrevPage(){let t=this.hostElement,e=t.offsetHeight,s=t.children,i=0;for(let t=this.selectedIndex-1;t>0;t--){let h=s[t].scrollHeight;if(i+h>e&&this.isItemEnabled(t))return this.selectedIndex=t,!0;i+=h}return this._selectFirst()}_findNext(){if(this.hostElement){let t=this.hostElement.childElementCount,e=this.selectedIndex;(e<0||1==this._search.length)&&e++;for(let s=0;s<t;s++){let i=(e+s)%t;if(0==this.getDisplayText(i).trim().toLowerCase().indexOf(this._search)&&this.isItemEnabled(i))return i}}return-1}_getCheckbox(t){let e=this.hostElement,s=e?e.children:null;return t=this._getElementIndex(t),e&&t>-1&&t<s.length?s[t].querySelector("input[type=checkbox]"):null}_initFromSelect(t){let e=t.children,s=[],i=-1;for(let h=0;h<e.length;h++){let n=e[h];"OPTION"==n.tagName&&(n.hasAttribute("selected")&&(i=s.length),n.innerHTML?s.push({hdr:n.innerHTML,val:n.getAttribute("value"),cmdParam:n.getAttribute("cmd-param")}):s.push({hdr:'<div class="wj-separator"></div>'}),t.removeChild(n),h--)}s&&(this.displayMemberPath="hdr",this.selectedValuePath="val",this.itemsSource=s,this.selectedIndex=i)}};export class FormatItemEventArgs extends EventArgs{constructor(t,e,s){super(),this._index=asNumber(t),this._data=e,this._item=asType(s,HTMLElement,!0)}get index(){return this._index}get data(){return this._data}get item(){return this._item}};_addCultureInfo("Calendar",{ariaLabels:{calendar:"Calendar",monthView:"Month View",yearView:"Year View",prvMo:"Previous Month",today:"Today",nxtMo:"Next Month",prvYr:"Previous Year",currMo:"Current Month",nxtYr:"Next Year"}});export var DateSelectionMode;!function(t){t[t.None=0]="None",t[t.Day=1]="Day",t[t.Month=2]="Month"}(DateSelectionMode||(DateSelectionMode={}));export class Calendar extends Control{constructor(t,e){super(t,null,!0),this._readOnly=!1,this._selMode=DateSelectionMode.Day,this._yrPicker=!0,this._tmYrHidden=0,this._fmtYrMo="y",this._fmtYr="yyyy",this._fmtDayHdr="ddd",this._fmtDay="d ",this._fmtMonths="MMM",this.valueChanged=new Event,this.displayMonthChanged=new Event,this.formatItem=new Event(()=>{this.invalidate()});var s=this.hostElement;s.tabIndex=-1,this._value=DateTime.newDate(),this._currMonth=this._getMonth(this._value),this._createChildren(),this._createYearPicker();let i=this.addEventListener.bind(this);i(s,"keydown",this._keydown.bind(this)),i(s,"click",this._click.bind(this)),this._rptUp=new _ClickRepeater(this._btnPrv),this._rptDn=new _ClickRepeater(this._btnNxt),this.addEventListener(s,"wheel",t=>{if(!t.defaultPrevented&&!this.isReadOnly&&this.containsFocus()){clamp(-t.deltaY,-1,1);t.deltaY<0?this._btnPrv.click():this._btnNxt.click(),t.preventDefault()}}),this.initialize(e),this.refresh(!0)}get value(){return this._value}set value(t){t=asDate(t,!0),t=this._clamp(t),(this._valid(t)||null==t)&&(this.displayMonth=this._getMonth(t),DateTime.equals(this._value,t)||(this._value=t,this.invalidate(!1),this.onValueChanged()))}get min(){return this._min}set min(t){t!=this.min&&(this._min=asDate(t,!0),this.refresh())}get max(){return this._max}set max(t){t!=this.max&&(this._max=asDate(t,!0),this.refresh())}get selectionMode(){return this._selMode}set selectionMode(t){if((t=asEnum(t,DateSelectionMode))!=this._selMode){this._selMode=t;let e=this._monthMode();e&&(this.monthView=!1);let s=this._btnMth.querySelector(".wj-glyph-down");s&&(s.style.display=e?"none":""),this.refresh()}}get isReadOnly(){return this._readOnly}set isReadOnly(t){this._readOnly=asBoolean(t),toggleClass(this.hostElement,"wj-state-readonly",this.isReadOnly)}get repeatButtons(){return!this._rptUp.disabled}set repeatButtons(t){this._rptUp.disabled=this._rptDn.disabled=!asBoolean(t)}get showYearPicker(){return this._yrPicker}set showYearPicker(t){this._yrPicker=asBoolean(t)}get firstDayOfWeek(){return this._fdw}set firstDayOfWeek(t){if(t!=this._fdw){if((t=asNumber(t,!0))&&(t>6||t<0))throw"firstDayOfWeek must be between 0 and 6 (Sunday to Saturday).";this._fdw=t,this.refresh()}}get displayMonth(){return this._currMonth}set displayMonth(t){if(!DateTime.equals(this.displayMonth,t)){t=asDate(t),(this.monthView?this._monthInValidRange(t):this._yearInValidRange(t))&&(this._currMonth=this._getMonth(this._clamp(t)),this.invalidate(!0),this.onDisplayMonthChanged())}}get formatYearMonth(){return this._fmtYrMo}set formatYearMonth(t){t!=this._fmtYrMo&&(this._fmtYrMo=asString(t),this.invalidate())}get formatDayHeaders(){return this._fmtDayHdr}set formatDayHeaders(t){t!=this._fmtDayHdr&&(this._fmtDayHdr=asString(t),this.invalidate())}get formatDays(){return this._fmtDay}set formatDays(t){t!=this._fmtDay&&(this._fmtDay=asString(t),this.invalidate())}get formatYear(){return this._fmtYr}set formatYear(t){t!=this._fmtYr&&(this._fmtYr=asString(t),this.invalidate())}get formatMonths(){return this._fmtMonths}set formatMonths(t){t!=this._fmtMonths&&(this._fmtMonths=asString(t),this.invalidate())}get showHeader(){return"none"!=this._tbHdr.style.display}set showHeader(t){this._tbHdr.style.display=asBoolean(t)?"":"none"}get monthView(){return"none"!=this._tbMth.style.display}set monthView(t){if(t!=this.monthView){this._tbMth.style.display=t?"":"none",this._tbYr.style.display=t?"none":"",this.refresh();let e=culture.Calendar.ariaLabels;setAriaLabel(this._btnPrv,t?e.prvMo:e.prvYr),setAriaLabel(this._btnTdy,t?e.today:e.currMo),setAriaLabel(this._btnNxt,t?e.nxtMo:e.nxtYr),setAriaLabel(this._btnMth,t?e.monthView:e.yearView)}}get itemFormatter(){return this._itemFormatter}set itemFormatter(t){t!=this._itemFormatter&&(this._itemFormatter=asFunction(t),this.invalidate())}get itemValidator(){return this._itemValidator}set itemValidator(t){t!=this._itemValidator&&(this._itemValidator=asFunction(t),this.invalidate())}onValueChanged(t){this.valueChanged.raise(this,t)}onDisplayMonthChanged(t){this.displayMonthChanged.raise(this,t)}onFormatItem(t){this.formatItem.raise(this,t)}containsFocus(){return super.containsFocus()||this._lbYears.containsFocus()}dispose(){this._rptUp.element=null,this._rptDn.element=null,this._lbYears.dispose(),super.dispose()}refresh(t=!0){let e,s,i,h=this.displayMonth,n=null!=this.firstDayOfWeek?this.firstDayOfWeek:Globalize.getFirstDayOfWeek(),l=this.hostElement,a=getActiveElement(),r=this.containsFocus(),o=contains(l,a)?a:null;super.refresh(t),this._firstDay=DateTime.addDays(h,-(h.getDay()-n+7)%7),setText(this._spMth,Globalize.format(h,this._fmtYrMo)),e=this._tbMth.querySelectorAll("td");for(let t=0;t<7&&t<e.length;t++)i=DateTime.addDays(this._firstDay,t),setText(e[t],Globalize.format(i,this._fmtDayHdr));for(let t=7;t<e.length;t++){s=e[t],i=DateTime.addDays(this._firstDay,t-7),setText(s,Globalize.format(i,this._fmtDay));let n=!this._valid(i),l=this._selMode&&DateTime.sameDate(i,this.value),a=i.getDay();if(toggleClass(s,"wj-state-invalid",n),toggleClass(s,"wj-state-selected",l),toggleClass(s,"wj-day-weekend",0==a||6==a),toggleClass(s,"wj-day-today",DateTime.sameDate(i,DateTime.newDate())),toggleClass(s,"wj-day-othermonth",n||i.getMonth()!=h.getMonth()||!this._inValidRange(i)),setAttribute(s,"aria-selected",l),s.tabIndex=-1,this.itemFormatter&&this.itemFormatter(i,s),this.formatItem.hasHandlers){let e=new FormatItemEventArgs(t,i,s);this.onFormatItem(e)}}let d=this._tbMth.querySelectorAll("tr");d.length&&(i=DateTime.addDays(this._firstDay,28),d[d.length-2].style.display=i.getMonth()==h.getMonth()?"":"none",i=DateTime.addDays(this._firstDay,35),d[d.length-1].style.display=i.getMonth()==h.getMonth()?"":"none"),(e=this._tbYr.querySelectorAll("td")).length&&setText(e[0],Globalize.format(h,this._fmtYr));for(let t=1;t<e.length;t++){i=DateTime.newDate(h.getFullYear(),t-1,1);let n=!this._monthInValidRange(i),l=this._sameMonth(i,this.value);s=e[t],setText(s,Globalize.format(i,this._fmtMonths)),toggleClass(s,"wj-state-disabled",n),toggleClass(s,"wj-state-selected",l),setAttribute(s,"aria-selected",l),s.tabIndex=-1}let u=(this.monthView?this._tbMth:this._tbYr).querySelector("td.wj-state-selected")||l;u.tabIndex=this._orgTabIndex,r&&(o&&o!=u&&(o.tabIndex=-1),u.focus())}_canChangeValue(){return!this._readOnly&&this._selMode!=DateSelectionMode.None}_valid(t){return!!isDate(t)&&(!!DateTime.sameDate(t,this._clamp(t))&&(!isFunction(this.itemValidator)||this.itemValidator(t)))}_inValidRange(t){return!(this.min&&t<DateTime.fromDateTime(this.min,t))&&!(this.max&&t>DateTime.fromDateTime(this.max,t))}_monthInValidRange(t){if(this.min||this.max){let e=t.getFullYear(),s=t.getMonth(),i=DateTime.newDate(e,s,1),h=DateTime.newDate(e,s+1,0);if(this.min&&this.min>h)return!1;if(this.max&&this.max<i)return!1}return!0}_yearInValidRange(t){if(this.min||this.max){let e=t.getFullYear(),s=DateTime.newDate(e,0,1),i=DateTime.newDate(e,11,31);if(this.min&&this.min>i)return!1;if(this.max&&this.max<s)return!1}return!0}_sameMonth(t,e){return isDate(t)&&isDate(e)&&t.getMonth()==e.getMonth()&&t.getFullYear()==e.getFullYear()}_getValidDate(t,e){if(isDate(t)){let s=t.getFullYear(),i=t.getMonth()+(e?0:1),h=e?1:0,n=DateTime.newDate(s,i,h),l=e?1:-1;for(let t=0;t<31;t++){if(this._valid(n))return n;n=DateTime.addDays(n,l)}}return null}_clamp(t){if(t){if(this.min){let e=DateTime.fromDateTime(this.min,t);t<e&&(t=e)}if(this.max){let e=DateTime.fromDateTime(this.max,t);t>e&&(t=e)}}return t}_createChildren(){let t=this.getTemplate();this.applyTemplate("wj-control wj-calendar",t,{_tbHdr:"tbl-header",_btnMth:"btn-month",_spMth:"span-month",_btnPrv:"btn-prev",_btnTdy:"btn-today",_btnNxt:"btn-next",_tbMth:"tbl-month",_tbYr:"tbl-year"});let e=culture.Calendar.ariaLabels;setAriaLabel(this._tbMth,e.calendar),setAriaLabel(this._tbYr,e.calendar),setAriaLabel(this._btnPrv,e.calendar),setAriaLabel(this._btnMth,e.monthView),setAriaLabel(this._btnPrv,e.prvMo),setAriaLabel(this._btnTdy,e.today),setAriaLabel(this._btnNxt,e.nxtMo);let s=this._createElement("tr",this._tbMth,"wj-header");for(let t=0;t<7;t++)this._createElement("td",s);for(let t=0;t<6;t++){s=this._createElement("tr",this._tbMth);for(let t=0;t<7;t++)this._createElement("td",s)}s=this._createElement("tr",this._tbYr,"wj-header"),this._createElement("td",s).setAttribute("colspan","4");for(let t=0;t<3;t++){s=this._createElement("tr",this._tbYr);for(let t=0;t<4;t++)this._createElement("td",s)}}_createYearPicker(){let t=this.hostElement,e=this._createElement("div",null,"wj-dropdown-panel wj-yearpicker");e.tabIndex=this._orgTabIndex,this._lbYears=new ListBox(e,{lostFocus:(t,s)=>{if(hidePopup(e),this._tmYrHidden=Date.now(),this.removeEventListener(window,"touchstart"),t.selectedIndex>-1){let e=DateTime.clone(this.displayMonth);e.setFullYear(t.selectedIndex+t.itemsSource[0]),this.displayMonth=e}}}),this.addEventListener(e,"keydown",e=>{switch(e.keyCode){case Key.Enter:t.focus();break;case Key.Escape:this._lbYears.selectedIndex=-1,t.focus()}e.defaultPrevented&&e.stopPropagation()}),this.addEventListener(e,"click",e=>{t.focus()})}_createElement(t,e,s){let i=document.createElement(t);if(i.tabIndex=-1,s&&addClass(i,s),"TD"==i.tagName){let t=closest(i,".wj-header")?"columnheader":"gridcell";setAttribute(i,"role",t),setAttribute(i,"aria-selected",!1)}return e&&e.appendChild(i),i}_click(t){if(!t.defaultPrevented&&0==t.button){let l=!1,a=t.target;if(contains(this._btnMth,a)&&!this._monthMode()?(this.monthView=!this.monthView,l=!0):contains(this._btnPrv,a)?(this._navigate(-1),l=!0):contains(this._btnNxt,a)?(this._navigate(1),l=!0):contains(this._btnTdy,a)&&(this._navigate(0),l=!0),a&&!l&&this._yrPicker&&contains(this._tbYr,a)&&closest(a,".wj-header")){if(Date.now()-this._tmYrHidden<600)return void t.preventDefault();for(var e=this.displayMonth.getFullYear(),s=this.min?this.min.getFullYear():e-100,i=this.max?this.max.getFullYear():e+100,h=[],n=s;n<=i;n++)h.push(n);let l=this._lbYears,r=l.hostElement,o=closest(a,".wj-header");return l.itemsSource=h,l.selectedIndex=e-h[0],setAttribute(r,"dir",this.rightToLeft?"rtl":null),r.style.minWidth="",showPopup(r,o,!1,!1,this.hostElement),l.focus(),this.addEventListener(window,"touchstart",t=>{contains(r,t.target)||(hidePopup(r),this._tmYrHidden=Date.now(),this.removeEventListener(window,"touchstart"))}),void t.preventDefault()}if(a&&!l){let t=closest(a,"TD");if(t)if(this.monthView){let e=this._getCellIndex(this._tbMth,t);if(e>6&&this._canChangeValue()){let t=DateTime.fromDateTime(DateTime.addDays(this._firstDay,e-7),this.value);this._inValidRange(t)&&this._valid(t)&&(this.value=t),l=!0}}else{let e=this._getCellIndex(this._tbYr,t);if(e>0){if(this.displayMonth=DateTime.newDate(this.displayMonth.getFullYear(),e-1,1),this._monthMode()){if(this._canChangeValue()){let t=DateTime.fromDateTime(this.displayMonth,this.value);this._inValidRange(t)&&(this.value=t)}}else this.monthView=!0;l=!0}}}l&&(t.preventDefault(),this.focus())}}_getCellIndex(t,e){let s=t.querySelectorAll("TD");for(let t=0;t<s.length;t++)if(s[t]==e)return t;return-1}_keydown(t){if(t.defaultPrevented)return;if(t.altKey)switch(t.keyCode){case Key.Up:case Key.Down:return;case Key.End:return this._navigate(0),void t.preventDefault()}if(t.ctrlKey||t.metaKey||t.shiftKey)return;let e=this._getKeyCode(t),s=0,i=0,h=!0;if(this.monthView)switch(e){case Key.Left:s=-1;break;case Key.Right:s=1;break;case Key.Up:s=-7;break;case Key.Down:s=7;break;case Key.PageDown:i=t.altKey?12:1;break;case Key.PageUp:i=t.altKey?-12:-1;break;case Key.Home:case Key.End:if(this._canChangeValue()){let t=this.value||this.displayMonth,s=this._getValidDate(t,e==Key.Home);s&&(this.value=DateTime.fromDateTime(s,this.value))}break;default:h=!1}else switch(e){case Key.Left:i=-1;break;case Key.Right:i=1;break;case Key.Up:i=-4;break;case Key.Down:i=4;break;case Key.PageDown:i=t.altKey?120:12;break;case Key.PageUp:i=t.altKey?-120:-12;break;case Key.Home:i=this.value?-this.value.getMonth():0;break;case Key.End:i=this.value?11-this.value.getMonth():0;break;case Key.Enter:this._monthMode()?h=!1:this.monthView=!0;break;default:h=!1}if(this._canChangeValue()&&(s||i)){let t=this.value;if(t?(t=DateTime.addDays(t,s),t=DateTime.addMonths(t,i)):t=this._getValidDate(new Date,!0),i&&!this._valid(t)){let e=t.getMonth();for(let s=1;s<31&&!this._valid(t);s++){let i=DateTime.addDays(t,+s),h=DateTime.addDays(t,-s);this._valid(i)&&i.getMonth()==e?t=i:this._valid(h)&&h.getMonth()==e&&(t=h)}}for(let e=0;e<31&&!this._valid(t);e++)t=DateTime.addDays(t,s>0||i>0?1:-1);this.value=t}h&&t.preventDefault()}_getMonth(t){return t||(t=DateTime.newDate()),DateTime.newDate(t.getFullYear(),t.getMonth(),1)}_monthMode(){return this.selectionMode==DateSelectionMode.Month}_navigate(t){let e=this.monthView,s=this.displayMonth;switch(t){case 0:let i=DateTime.newDate();this._canChangeValue()&&(this.value=e?DateTime.fromDateTime(i,this.value):this._getMonth(i)),s=this._getMonth(i);break;case 1:s=DateTime.addMonths(s,e?1:12);break;case-1:s=DateTime.addMonths(s,e?-1:-12)}this.displayMonth=s}};Calendar.controlTemplate='<div class="wj-content wj-calendar-outer"><div wj-part="tbl-header" class="wj-calendar-header"><div wj-part="btn-month" class="wj-month-select" role="button"><span wj-part="span-month"></span> <span class="wj-glyph-down"></span></div><div class="wj-btn-group"><button wj-part="btn-prev" class="wj-btn wj-btn-default" tabindex="-1"><span class="wj-glyph-left"></span></button><button wj-part="btn-today" class="wj-btn wj-btn-default" tabindex="-1"><span class="wj-glyph-circle"></span></button><button wj-part="btn-next" class="wj-btn wj-btn-default" tabindex="-1"><span class="wj-glyph-right"></span></button></div></div><table wj-part="tbl-month" class="wj-calendar-month" role="grid"></table><table wj-part="tbl-year" class="wj-calendar-year" role="grid" style="display:none"></table></div>',_addCultureInfo("DropDown",{ariaLabels:{tgl:"Toggle Dropdown"}});export class DropDown extends Control{constructor(t,e){super(t,null,!0),this._showBtn=!0,this._autoExpand=!0,this._animate=!1,this.textChanged=new Event,this.isDroppedDownChanging=new Event,this.isDroppedDownChanged=new Event;let s=this.getTemplate();this.applyTemplate("wj-control wj-content wj-dropdown",s,{_tbx:"input",_btn:"btn",_dropDown:"dropdown"},"input");let i=culture.DropDown.ariaLabels;setAriaLabel(this._btn.querySelector("button"),i.tgl);let h=this._elRef=this._tbx;disableAutoComplete(h),this._createDropDown(),this._updateBtn();let n=this.hostElement;addClass(n,"wj-state-collapsed");let l=this.dropDown,a=this.addEventListener.bind(this),r=this._updateFocusState.bind(this);a(l,"blur",r,!0),a(l,"focus",r);let o=this._keydown.bind(this);a(n,"keydown",o),a(l,"keydown",o),a(h,"keypress",t=>{9787==t.keyCode&&this._altDown&&t.preventDefault()}),a(h,"keyup",t=>{this._altDown=this._altDown||t.altKey}),a(h,"input",()=>{this._setText(this.text,!1)}),a(h,"click",()=>{this._autoExpand&&this._expandSelection()}),a(h,"blur",()=>{this._commitText()},!0),a(this._btn,"mousedown",t=>{t.defaultPrevented||0!=t.button||(this._btnclick(t),t.preventDefault())}),removeChild(l),isIE()&&this._elRef==this._tbx&&a(n,"mouseup",t=>{if(!t.defaultPrevented&&0==t.button&&hasClass(t.target,"wj-btn")){let e=getActiveElement();e&&e!=t.target&&setTimeout(()=>{e.focus()})}}),isIE9()&&a(h,"keyup",()=>{this._setText(this.text,!1)}),a(l,"click",this._dropDownClick.bind(this))}get text(){return this._tbx.value}set text(t){t!=this.text&&this._setText(t,!0)}get inputElement(){return this._tbx}get inputType(){return this._tbx.type}set inputType(t){this._tbx.type=asString(t)}get isReadOnly(){return this._tbx.readOnly}set isReadOnly(t){this._tbx.readOnly=asBoolean(t),toggleClass(this.hostElement,"wj-state-readonly",this.isReadOnly)}get isRequired(){return this._tbx.required}set isRequired(t){this._tbx.required=asBoolean(t)}get placeholder(){return this._tbx.placeholder}set placeholder(t){this._tbx.placeholder=t}get isDroppedDown(){let t=this._dropDown;return t&&"none"!=t.style.display}set isDroppedDown(t){let e=this.hostElement,s=this._dropDown,i=this.containsFocus()||this._setFocus;e&&s&&(t=asBoolean(t)&&!this.isDisabled&&!this.isReadOnly)!=this.isDroppedDown&&this.onIsDroppedDownChanging(new CancelEventArgs)&&(t?(this._minWidthDropdown=s.style.minWidth,s.style.display="block",this._updateDropDown(),this.addEventListener(window,"touchstart",t=>{for(let s=t.target;s;){if(s==e)return;s=s[Control._OWNR_KEY]||s.parentNode}Control._touching=!0,this.isDroppedDown=!1,Control._touching=!1})):(this.removeEventListener(window,"touchstart"),hidePopup(s),s.style.minWidth=this._minWidthDropdown),this._setFocus=!1,i&&(this.isTouching&&this.showDropDownButton?e.focus():this.selectAll()),this._updateFocusState(),toggleClass(e,"wj-state-collapsed",!this.isDroppedDown),this.onIsDroppedDownChanged())}get dropDown(){return this._dropDown}get dropDownCssClass(){return this._cssClass}set dropDownCssClass(t){t!=this._cssClass&&(removeClass(this._dropDown,this._cssClass),this._cssClass=asString(t),addClass(this._dropDown,this._cssClass))}get showDropDownButton(){return this._showBtn}set showDropDownButton(t){this._showBtn=asBoolean(t),this._updateBtn()}get autoExpandSelection(){return this._autoExpand}set autoExpandSelection(t){this._autoExpand=asBoolean(t)}get isAnimated(){return this._animate}set isAnimated(t){this._animate=asBoolean(t)}selectAll(){let t=this._tbx;this._elRef==t&&setSelectionRange(t,0,this.text.length),this.containsFocus()||this.focus()}onTextChanged(t){this.textChanged.raise(this,t),this._updateState()}onIsDroppedDownChanging(t){return this.isDroppedDownChanging.raise(this,t),!t.cancel}onIsDroppedDownChanged(t){this.isDroppedDownChanged.raise(this,t)}onGotFocus(t){this.isTouching||contains(this._dropDown,getActiveElement())||this.selectAll(),super.onGotFocus(t)}onLostFocus(t){this._commitText(),this.isDroppedDown=!1,super.onLostFocus(t)}containsFocus(){return super.containsFocus()||this.isDroppedDown&&contains(this._dropDown,getActiveElement())}dispose(){this.isDroppedDown=!1;let t=this._dropDown;if(t){let e=Control.getControl(t);e&&e.dispose(),removeChild(t),this._dropDown=null}super.dispose()}refresh(t=!0){if(super.refresh(t),this.hostElement.offsetHeight&&this.isDroppedDown){let t=getActiveElement();this.isAnimated&&""!=this._dropDown.style.opacity||showPopup(this._dropDown,this.hostElement,!1,!1,null==this.dropDownCssClass),t instanceof HTMLElement&&t!=getActiveElement()&&t.focus()}}_handleResize(){this.isDroppedDown&&this.refresh()}_dropDownClick(t){t.stopPropagation()}_expandSelection(){let t=this._tbx,e=t.value,s=t.selectionStart,i=t.selectionEnd;if(e&&s==i){let h=this._getCharType(e,s);if(h>-1){for(;i<e.length&&this._getCharType(e,i)==h;i++);for(;s>0&&this._getCharType(e,s-1)==h;s--);s!=i&&setSelectionRange(t,s,i)}}}_getCharType(t,e){let s=t[e];return s>="0"&&s<="9"?0:s>="a"&&s<="z"||s>="A"&&s<="Z"?1:-1}_keydown(t){if(this._altDown=t.altKey,!t.defaultPrevented)switch(t.keyCode){case Key.Tab:case Key.Escape:case Key.Enter:this.isDroppedDown&&(this.isDroppedDown=!1,t.keyCode==Key.Tab||this.containsFocus()||this.focus(),t.preventDefault());break;case Key.F4:case Key.Up:case Key.Down:if(t.keyCode==Key.F4||t.altKey){let e=this.hostElement;e&&e.offsetHeight&&(this.isDroppedDown=!this.isDroppedDown,t.preventDefault())}}}_btnclick(t){0==t.button&&(this._setFocus=!0,this.isDroppedDown=!this.isDroppedDown)}_setText(t,e){null==t&&(t=""),(t=t.toString())!=this._tbx.value&&(this._tbx.value=t),t!=this._oldText&&(this._oldText=t,this.onTextChanged())}_updateBtn(){this._btn.style.display=this._showBtn?"":"none"}_createDropDown(){}_commitText(){}_updateDropDown(){if(this.isDroppedDown){this._commitText();let t=this.dropDown;setAttribute(t,"dir",this.rightToLeft?"rtl":null),showPopup(t,this.hostElement,!1,this._animate,null==this.dropDownCssClass)}}};DropDown.controlTemplate='<div class="wj-template"><div class="wj-input"><div class="wj-input-group wj-input-btn-visible"><input wj-part="input" type="text" class="wj-form-control"/><span wj-part="btn" class="wj-input-group-btn"><button class="wj-btn wj-btn-default" tabindex="-1"><span class="wj-glyph-down"></span></button></span></div></div><div wj-part="dropdown" class="wj-content wj-dropdown-panel" style="display:none"></div></div>';export var PopupTrigger;!function(t){t[t.None=0]="None",t[t.Click=1]="Click",t[t.Blur=2]="Blur",t[t.ClickOrBlur=3]="ClickOrBlur"}(PopupTrigger||(PopupTrigger={}));export class Popup extends Control{constructor(t,e){super(t,null,!0),this._showTrigger=PopupTrigger.Click,this._hideTrigger=PopupTrigger.Blur,this._hideAnim=[],this._fadeIn=!0,this._fadeOut=!0,this._removeOnHide=!0,this._visible=!1,this._ownerClickBnd=this._ownerClick.bind(this),this._ownerMousedownBnd=this._ownerMouseDown.bind(this),this.showing=new Event,this.shown=new Event,this.hiding=new Event,this.hidden=new Event;let s=this.hostElement;addClass(s,"wj-control wj-content wj-popup"),s.getAttribute("tabindex")||(s.tabIndex=0),hidePopup(s,!1),this.addEventListener(s,"compositionstart",t=>{this._composing=!0}),this.addEventListener(s,"compositionend",t=>{this._composing=!1}),this.addEventListener(s,"keydown",t=>{if(!t.defaultPrevented){if(t.keyCode!=Key.Escape||this._composing||(t.preventDefault(),this.hide()),t.keyCode==Key.Enter){let e=this.dialogResultEnter;e&&(t.preventDefault(),this._validateAndHide(e))}t.keyCode==Key.Tab&&this.modal&&(t.preventDefault(),moveFocus(s,t.shiftKey?-1:1))}}),this.addEventListener(s,"click",t=>{if(t.target instanceof HTMLElement){let e=t.target.className.match(/\bwj-hide[\S]*\b/);e&&e.length>0&&(t.preventDefault(),t.stopPropagation(),this.hide(e[0]))}}),this.addEventListener(document,"wheel",t=>{if(this.isVisible&&this._modal){for(let e=t.target;e&&e!=document.body;e=e.parentElement)if(e.scrollHeight>e.clientHeight)return;t.preventDefault()}}),this.initialize(e)}get owner(){return this._owner}set owner(t){let e=this._owner;e&&(this.removeEventListener(e,"mousedown"),this.removeEventListener(e,"click")),(e=this._owner=null!=t?getElement(t):null)&&(this.addEventListener(e,"mousedown",this._ownerMousedownBnd,!0),this.addEventListener(e,"click",this._ownerClickBnd,!0))}get content(){return this.hostElement.firstElementChild}set content(t){t!=this.content&&(this.hostElement.innerHTML="",t instanceof HTMLElement&&this.hostElement.appendChild(t))}get showTrigger(){return this._showTrigger}set showTrigger(t){this._showTrigger=asEnum(t,PopupTrigger)}get hideTrigger(){return this._hideTrigger}set hideTrigger(t){this._hideTrigger=asEnum(t,PopupTrigger)}get fadeIn(){return this._fadeIn}set fadeIn(t){this._fadeIn=asBoolean(t)}get fadeOut(){return this._fadeOut}set fadeOut(t){this._fadeOut=asBoolean(t)}get removeOnHide(){return this._removeOnHide}set removeOnHide(t){this._removeOnHide=asBoolean(t)}get modal(){return this._modal}set modal(t){this._modal=asBoolean(t)}get isDraggable(){return this._draggable}set isDraggable(t){this._draggable=asBoolean(t)}get dialogResult(){return this._result}set dialogResult(t){this._result=t}get dialogResultEnter(){return this._resultEnter}set dialogResultEnter(t){this._resultEnter=t}get isVisible(){let t=this.hostElement;return this._visible&&null!=t&&t.offsetHeight>0}show(t,e){if(!this.isVisible){let s=this.hostElement;this.dialogResult=null,this._callback=null,this._hideAnim.forEach(t=>{clearInterval(t)}),this._hideAnim.length=0;let i=new CancelEventArgs;this.onShowing(i)&&(null!=t&&(this.modal=asBoolean(t)),null!=e&&(this._callback=asFunction(e)),showPopup(s,this._owner,!1,this._fadeIn,!1),this._modal&&this._showBackdrop(),this._composing=!1,this._visible=!0,this.onShown(i),this.modal&&this.addEventListener(window,"focus",()=>{this.containsFocus()||moveFocus(s,0)}),this._dragged=!1,this._makeDraggable(this._draggable),this.addEventListener(window,"touchstart",t=>{this._hideTrigger&PopupTrigger.Blur&&!contains(s,t.target,!0)&&this.hide()}),setTimeout(()=>{if(!this.isTouching){let t=s.querySelector("input[autofocus]");t&&t.clientHeight>0&&!t.disabled&&t.tabIndex>-1&&!closest(t,"[disabled],.wj-state-disabled")?(t.focus(),t.select()):moveFocus(s,0)}this.containsFocus()||(s.tabIndex=0,s.focus())},200))}}hide(t){if(this._makeDraggable(!1),this.removeEventListener(window,"touchstart"),this.isVisible){isUndefined(t)||(this.dialogResult=t);let e=new CancelEventArgs;if(this.onHiding(e)){let t=this.hostElement.querySelectorAll(".wj-control.wj-dropdown");for(let e=0;e<t.length;e++){let s=Control.getControl(t[e]);s instanceof DropDown&&(s.isDroppedDown=!1)}let s=this.removeOnHide,i=this.fadeOut;this._bkdrop&&this._hideAnim.push(hidePopup(this._bkdrop,s,i)),this._hideAnim.push(hidePopup(this.hostElement,s,i)),this._visible=!1,this.removeEventListener(window,"focus"),this.containsFocus()&&getActiveElement().blur(),setTimeout(()=>{this._updateState(),this.onHidden(e),this._callback&&this._callback(this)})}}}onShowing(t){return this.showing.raise(this,t),!t.cancel}onShown(t){this.shown.raise(this,t)}onHiding(t){return this.hiding.raise(this,t),!t.cancel}onHidden(t){this.hidden.raise(this,t)}dispose(){this.owner=null,super.dispose()}onLostFocus(t){this.isVisible&&this._hideTrigger&PopupTrigger.Blur&&(this.containsFocus()||this.hide()),super.onLostFocus(t)}refresh(t=!0){if(super.refresh(t),this.isVisible&&!this._refreshing){this._refreshing=!0;let t=getActiveElement(),e=this._owner?this._owner.getBoundingClientRect():null;showPopup(this.hostElement,e),this._modal&&t instanceof HTMLElement&&t!=getActiveElement()&&t.focus(),this._refreshing=!1}}_makeDraggable(t){let e,s,i=this.hostElement,h=i?i.querySelector(".wj-dialog-header"):null,n=document,l="mousedown",a="mousemove",r="mouseup",o="touchstart",d="touchmove",u="touchend",c=!1,m=t=>{i&&contains(h,t.target)&&!t.button&&(e=new Point(i.offsetLeft,i.offsetTop),s=mouseToPage(t),c=!1,[a,r,d,u].forEach(t=>{this.removeEventListener(n,t)}),[a,d].forEach(t=>{this.addEventListener(n,t,_,!1,!0)}),[r,u].forEach(t=>{this.addEventListener(n,t,p)}))},_=t=>{let h=mouseToPage(t),n=h.x-s.x,l=h.y-s.y;(c||Math.abs(n)+Math.abs(l)>Popup._DRAG_THRESHOLD)&&(setCss(i,{left:Math.max(e.x+n,50-i.offsetWidth),top:Math.max(e.y+(h.y-s.y),0)}),this._dragged=!0,c=!0)},p=t=>{[a,r,d,u].forEach(t=>{this.removeEventListener(n,t)})};[l,o].forEach(t=>{this.removeEventListener(n,t)}),h&&(setCss(h,{touchAction:t?"none":""}),t&&[l,o].forEach(t=>{this.addEventListener(n,t,m)}))}_handleResize(){this.isVisible&&!this._dragged&&this.refresh()}_ownerClick(t){this.isVisible?this._hideTrigger&PopupTrigger.Click&&this.hide():this._showTrigger&PopupTrigger.Click&&(this._wasVisible||this.show())}_ownerMouseDown(t){this._wasVisible=this.isVisible}_showBackdrop(){this._bkdrop||(this._bkdrop=document.createElement("div"),this._bkdrop.tabIndex=-1,addClass(this._bkdrop,"wj-popup-backdrop"),this.addEventListener(this._bkdrop,"mousedown",t=>{t.preventDefault(),t.stopPropagation(),this.hostElement.focus(),this.hideTrigger&PopupTrigger.Blur&&this.hide()})),setCss(this._bkdrop,{zIndex:Control._POPUP_ZINDEX,display:""});let t=this.hostElement;t.parentElement.insertBefore(this._bkdrop,t)}_validateAndHide(t){let e=this.hostElement.querySelector(":invalid");e?e.focus():this.hide(t)}};Popup._DRAG_THRESHOLD=6;export class InputDate extends DropDown{constructor(t,e){if(super(t),this._format="d",this.valueChanged=new Event,addClass(this.hostElement,"wj-inputdate"),this._msk=new _MaskProvider(this._tbx),isIE9()||(this.inputType="tel"),this._tbx.type.match(/date/i)&&(this.inputType=""),this.addEventListener(this.hostElement,"wheel",t=>{if(!t.defaultPrevented&&!this.isDroppedDown&&this.containsFocus()&&null!=this.value&&this._canChangeValue()){let e=clamp(-t.deltaY,-1,1);this.value=this.selectionMode==DateSelectionMode.Month?DateTime.addMonths(this.value,e):DateTime.addDays(this.value,e),this.selectAll(),t.preventDefault()}}),this.value=DateTime.newDate(),"INPUT"==this._orgTag){let t=this._tbx.getAttribute("value");t&&(this.value=Globalize.parseDate(t,"yyyy-MM-dd"))}this.isRequired=!0,this.initialize(e)}get value(){return this._value}set value(t){if(DateTime.equals(this._value,t))this._tbx.value=Globalize.format(t,this.format);else{let e=!this.isRequired||null==t&&null==this.value;t=asDate(t,e),t=this._clamp(t),this._isValidDate(t)?(this._tbx.value=t?Globalize.format(t,this.format):"",t==this._value||DateTime.equals(this._value,t)||(this._value=t,this.onValueChanged())):this._tbx.value=t?Globalize.format(this.value,this.format):"",this._calChanging=!0,this._calendar.value=this.value,this._calChanging=!1,this.text!=this._oldText&&(this._oldText=this.text,this.onTextChanged())}}get text(){return this._tbx.value}set text(t){t!=this.text&&(this._setText(t,!0),this._commitText())}get selectionMode(){return this.calendar.selectionMode}set selectionMode(t){this.calendar.selectionMode=t}get min(){return this._calendar.min}set min(t){this._calendar.min=asDate(t,!0)}get max(){return this._calendar.max}set max(t){this._calendar.max=asDate(t,!0)}get repeatButtons(){return this.calendar.repeatButtons}set repeatButtons(t){this.calendar.repeatButtons=asBoolean(t)}get showYearPicker(){return this.calendar.showYearPicker}set showYearPicker(t){this.calendar.showYearPicker=asBoolean(t)}get format(){return this._format}set format(t){t!=this.format&&(this._format=asString(t),this._tbx.value=Globalize.format(this.value,this.format))}get mask(){return this._msk.mask}set mask(t){this._msk.mask=asString(t)}get calendar(){return this._calendar}get inputElement(){return this._tbx}get inputType(){return this._tbx.type}set inputType(t){this._tbx.type=asString(t)}get itemValidator(){return this._calendar.itemValidator}set itemValidator(t){t!=this.itemValidator&&(this._calendar.itemValidator=asFunction(t),this.invalidate())}get itemFormatter(){return this.calendar.itemFormatter}set itemFormatter(t){t!=this.itemFormatter&&(this.calendar.itemFormatter=asFunction(t))}onValueChanged(t){this.valueChanged.raise(this,t)}refresh(t=!0){super.refresh(t),this.isDroppedDown=!1,this._msk&&this._msk.refresh(),this._calendar&&this._calendar.refresh(),this._tbx.value=Globalize.format(this.value,this.format)}onIsDroppedDownChanged(t){super.onIsDroppedDownChanged(t),this.isDroppedDown&&(this._calChanged=!1,this.dropDown.focus(),this._calendar.refresh())}_createDropDown(){this._calendar=new Calendar(this._dropDown),this._calendar.valueChanged.addHandler(()=>{this._calChanging||(this.value=DateTime.fromDateTime(this._calendar.value,this.value),this._calChanged=!0)}),this.addEventListener(this._dropDown,"click",t=>{let e=t.target;hasClass(e,"wj-state-invalid")||closest(e,".wj-header")&&closest(e,".wj-calendar-year")||(this._calChanged&&!closest(e,".wj-calendar-header")?this.isDroppedDown=!1:(e=closest(e,".wj-btn"))&&"btn-today"==e.getAttribute("wj-part")&&(this.isDroppedDown=!1))})}_updateDropDown(){this._commitText();let t=this._calendar;t.value=this.value,t.min=this.min,t.max=this.max,this.selectionMode!=DateSelectionMode.Month&&(t.monthView=!0);let e=getComputedStyle(this.hostElement);this._dropDown.style.minWidth=18*parseFloat(e.fontSize)+"px",this._calendar.refresh(),super._updateDropDown()}_keydown(t){if(!(t.defaultPrevented||t.altKey||t.ctrlKey||t.metaKey))switch(t.keyCode){case Key.Enter:this._commitText(),this.selectAll();break;case Key.Escape:this.text=Globalize.format(this.value,this.format),this.selectAll();break;case Key.Up:case Key.Down:if(!this.isDroppedDown&&this.value&&this._canChangeValue()){let e=t.keyCode==Key.Up?1:-1,s=this.selectionMode==DateSelectionMode.Month?DateTime.addMonths(this.value,e):DateTime.addDays(this.value,e);this.value=DateTime.fromDateTime(s,this.value),this.selectAll(),t.preventDefault()}}super._keydown(t)}_canChangeValue(){return!this.isReadOnly&&this.selectionMode!=DateSelectionMode.None}_clamp(t){return this.calendar._clamp(t)}_commitText(){let t=this._tbx.value;if(t||this.isRequired){let e=Globalize.parseDate(t,this.format,this.value);e?this.value=DateTime.fromDateTime(e,this.value):this._tbx.value=Globalize.format(this.value,this.format)}else this.value=null}_isValidDate(t){if(t){if(this._clamp(t)!=t)return!1;if(this.itemValidator&&!this.itemValidator(t))return!1}return!0}};export class InputColor extends DropDown{constructor(t,e){super(t),this.valueChanged=new Event,addClass(this.hostElement,"wj-inputcolor");this._ePreview=createElement('<div class="wj-inputcolorbox"></div>',this.hostElement.firstElementChild),"INPUT"==this._orgTag&&(this._tbx.type="",this._commitText()),this.value="#ffffff",this.isRequired=!0,this.initialize(e),this.addEventListener(this._colorPicker.hostElement,"click",t=>{let e=t.target;if(e&&"DIV"==e.tagName&&(closest(e,'[wj-part="div-pal"]')||closest(e,'[wj-part="div-pv"]'))){e.style.backgroundColor&&(this.isDroppedDown=!1)}})}get value(){return this._value}set value(t){t!=this.value&&(!t&&this.isRequired||(this.text=asString(t)))}get text(){return this._tbx.value}set text(t){t!=this.text&&(this._setText(asString(t),!0),this._commitText())}get showAlphaChannel(){return this._colorPicker.showAlphaChannel}set showAlphaChannel(t){this._colorPicker.showAlphaChannel=t}get palette(){return this._colorPicker.palette}set palette(t){this._colorPicker.palette=t}get colorPicker(){return this._colorPicker}onValueChanged(t){this.valueChanged.raise(this,t)}onIsDroppedDownChanged(t){super.onIsDroppedDownChanged(t),this.isDroppedDown&&!this.isTouching&&this.selectAll()}_createDropDown(){this._colorPicker=new ColorPicker(this._dropDown),setCss(this._dropDown,{minWidth:420,minHeight:200}),this._colorPicker.valueChanged.addHandler(()=>{this.value=this._colorPicker.value})}_keydown(t){if(!t.defaultPrevented)switch(t.keyCode){case Key.Enter:this._commitText(),this.selectAll();break;case Key.Escape:this.text=this.value,this.selectAll()}super._keydown(t)}_commitText(){if(this.value!=this.text){if(!this.isRequired&&!this.text)return this._value=this.text,void(this._ePreview.style.backgroundColor="");Color.fromString(this.text)?(this._colorPicker.value=this.text,this._value=this._colorPicker.value,this._ePreview.style.backgroundColor=this.value,this.onValueChanged()):this.text=this._value?this._value:""}}};export class ComboBox extends DropDown{constructor(t,e){super(t),this._editable=!1,this._trimText=!0,this._delKey=0,this._composing=!1,this._pathHdr=new Binding(null),this._bsCollapse=!0,this._fmtItemHandlers=0,this.itemsSourceChanged=new Event,this.selectedIndexChanged=new Event;let s=this.hostElement;addClass(s,"wj-combobox"),this.dropDown.id=getUniqueId(s.id+"_dropdown"),this.autoExpandSelection=!1,this.addEventListener(this._tbx,"compositionstart",()=>{this._composing=!0}),this.addEventListener(this._tbx,"compositionend",()=>{this._composing=!1,setTimeout(()=>{this._setText(this.text,!0)})}),this.addEventListener(s,"wheel",this._wheel.bind(this)),"SELECT"==this._orgTag&&this._lbx._initFromSelect(s),this._lbx.loadedItems.addHandler(t=>{this.selectedIndex>-1&&(this.selectedIndex=this._lbx.selectedIndex)}),this.isRequired=!0,this.initialize(e)}get itemsSource(){return this._lbx.itemsSource}set itemsSource(t){this._lbx.itemsSource!=t&&(this._lbx.itemsSource=t,this.onItemsSourceChanged()),this._updateBtn()}get collectionView(){return this._lbx.collectionView}get showGroups(){return this._lbx.showGroups}set showGroups(t){this._lbx.showGroups=t}get displayMemberPath(){return this._lbx.displayMemberPath}set displayMemberPath(t){this._lbx.displayMemberPath=t;let e=this.getDisplayText();this.text!=e&&this._setText(e,!0)}get headerPath(){return this._pathHdr.path}set headerPath(t){this._pathHdr.path=asString(t);let e=this.getDisplayText();this.text!=e&&this._setText(e,!0)}get selectedValuePath(){return this._lbx.selectedValuePath}set selectedValuePath(t){this._lbx.selectedValuePath=t}get isContentHtml(){return this._lbx.isContentHtml}set isContentHtml(t){if(t!=this.isContentHtml){this._lbx.isContentHtml=asBoolean(t);let e=this.getDisplayText();this.text!=e&&this._setText(e,!0)}}get trimText(){return this._trimText}set trimText(t){t!=this._trimText&&(this._trimText=asBoolean(t),this.invalidate())}get itemFormatter(){return this._lbx.itemFormatter}set itemFormatter(t){this._lbx.itemFormatter=asFunction(t),this.selectedIndex=this._lbx.selectedIndex}get formatItem(){return this.listBox.formatItem}get selectedIndex(){return this._lbx.selectedIndex}set selectedIndex(t){t!=this.selectedIndex&&(this._lbx.selectedIndex=t),t=this.selectedIndex;let e=this.getDisplayText(t);this.text!=e&&this._setText(e,!0)}get selectedItem(){return this._lbx.selectedItem}set selectedItem(t){this._lbx.selectedItem=t}get selectedValue(){return this.collectionView?this._lbx.selectedValue:this.text}set selectedValue(t){this.collectionView?this._lbx.selectedValue=t:null!=t&&(this.text=t.toString())}get isEditable(){return this._editable}set isEditable(t){this._editable=asBoolean(t)}get maxDropDownHeight(){return this._lbx.maxHeight}set maxDropDownHeight(t){this._lbx.maxHeight=asNumber(t)}get maxDropDownWidth(){let t=this._dropDown;return parseInt(t.style.maxWidth)}set maxDropDownWidth(t){let e=this._dropDown;e.style.maxWidth=asNumber(t)+"px",e.style.minWidth=""}getDisplayText(t=this.selectedIndex){let e;if(this.headerPath&&t>-1&&hasItems(this.collectionView)){let s=this.collectionView.items[t];e=null!=(e=s?this._pathHdr.getValue(s):null)?e.toString():"",this.isContentHtml&&(e=toPlainText(e))}else e=this._lbx.getDisplayText(t);return this._trimText?e.trim():e}indexOf(t,e){let s=this.collectionView;if(hasItems(s)&&null!=t){let i=this.selectedIndex;if(e&&t==this.getDisplayText(i))return i;t=t.toString().toLowerCase();for(let i=0;i<s.items.length;i++)if(this.listBox.isItemEnabled(i)){let s=this.getDisplayText(i).toLowerCase();if(e){if(s==t)return i}else if(t&&0==s.indexOf(t))return i}}return-1}get listBox(){return this._lbx}onItemsSourceChanged(t){this.itemsSourceChanged.raise(this,t)}onSelectedIndexChanged(t){this._updateBtn(),this.selectedIndexChanged.raise(this,t)}refresh(t=!0){super.refresh(t),hasItems(this.collectionView)&&(this._lbx.refresh(),this.selectedIndex>-1&&(this.selectedIndex=this._lbx.selectedIndex))}onLostFocus(t){this._composing&&(this._composing=!1,this._setText(this.text,!0)),this.isEditable&&this.isRequired&&!this.text&&hasItems(this.collectionView)&&(this.selectedIndex=0),super.onLostFocus(t)}onIsDroppedDownChanging(t){return this.isDroppedDown||hasItems(this.collectionView)?super.onIsDroppedDownChanging(t):(t.cancel=!0,!1)}onIsDroppedDownChanged(t){super.onIsDroppedDownChanged(t),this.isDroppedDown&&(this._fmtItemHandlers=this.formatItem.handlerCount,this._lbx.showSelection()),setAttribute(this.dropDown,"aria-expanded",this.isDroppedDown)}_updateBtn(){let t=this.collectionView,e=this._tbx,s=this.dropDown.id,i=hasItems(t);super._updateBtn(),this._btn.style.display=this._showBtn&&null!=t?"":"none",enable(this._btn,i),setAttribute(e,"role",i?"combobox":null),setAttribute(e,"aria-autocomplete",i?"both":null),setAttribute(e,"aria-owns",i&&this.dropDown.parentElement?s:null),setAttribute(this.dropDown,"aria-expanded",!i&&null)}_createDropDown(){this._lbx||(this._lbx=new ListBox(this._dropDown)),this._lbx.maxHeight=200,this._lbx.selectedIndexChanged.addHandler(()=>{this._updateBtn();let t=this._lbx.selectedIndex,e=this._lbx.hostElement.children,s=t>-1&&t<e.length?e[t].id:null;setAttribute(this._tbx,"aria-activedescendant",s&&s.length?s:null),this.selectedIndex=t,this.onSelectedIndexChanged()}),this._lbx.itemsChanged.addHandler(()=>{this._updateBtn()})}_wheel(t){if(!t.defaultPrevented&&!this.isDroppedDown&&!this.isReadOnly&&this.containsFocus()&&this.selectedIndex>-1){let e=clamp(-t.deltaY,-1,1);this.selectedIndex=clamp(this.selectedIndex-e,0,this.collectionView.items.length-1),t.preventDefault()}}_dropDownClick(t){t.defaultPrevented||t.target!=this._dropDown&&(this.isDroppedDown=!1),super._dropDownClick(t)}_setText(t,e){if(this._composing)return;if(this._settingText)return;if(this._settingText=!0,this.containsFocus()){let t=this.formatItem.handlerCount;this._fmtItemHandlers!=t&&(this._fmtItemHandlers=t,this._lbx.loadList())}null==t&&(t=""),t=t.toString();let s=this.selectedIndex,i=this.collectionView,h=this._getSelStart(),n=-1,l=!0;if(this.isEditable&&(this._delKey||this._getSelEnd()<t.length||!this.containsFocus())&&(e=!0,l=!1),s=this.indexOf(t,e),l&&(s<0&&e&&(s=this.indexOf(t,!1)),s<0&&h>0&&(s=this.indexOf(t.substr(0,h),!1))),s<0&&!this.isEditable&&hasItems(i)&&(this.isRequired||t)){let e=this._oldText||"";s=Math.max(0,this.indexOf(e,!1));for(let s=0;s<t.length&&s<e.length;s++)if(t[s]!=e[s]){h=s;break}}s>-1&&(n=h,t=this.getDisplayText(s)),t!=this._tbx.value&&(this._tbx.value=t),n>-1&&this.containsFocus()&&!this.isTouching&&this._updateInputSelection(n),i&&i.moveCurrentToPosition(s),this._delKey=0,this._settingText=!1;let a=this._oldText,r=this.selectedIndex;super._setText(t,e),this.text!=a&&this.selectedIndex==r&&r<0&&this.onSelectedIndexChanged()}_findNext(t,e){let s=this.selectedIndex,i=this.collectionView,h=i?i.items.length:0,n=this.listBox;if(i&&h&&e){t=t.toLowerCase();for(let i=s+e;i>-1&&i<h;i+=e){if(0==this.getDisplayText(i).toLowerCase().indexOf(t)){if(!this.dropDown.children[i]||n.isItemEnabled(i))return i}}}return s}_keydown(t){if(super._keydown(t),t.defaultPrevented||this.isReadOnly)return;if(t.altKey)return;if(!hasItems(this.collectionView))return;if(this._elRef!=this._tbx)return;this._delKey=0;let e=this._getSelStart();switch(t.keyCode){case Key.Back:if(this._bsCollapse&&!this.isEditable){let t=this._getSelEnd();e>0&&t==this._tbx.value.length&&hasItems(this.collectionView)&&this._setSelRange(e-1,t)}this._delKey=t.keyCode;break;case Key.Delete:this._delKey=t.keyCode;break;case Key.Up:case Key.Down:e==this.text.length&&(e=0),this.selectedIndex=this._findNext(this.text.substr(0,e),t.keyCode==Key.Up?-1:1),this._setSelRange(e,this.text.length),t.preventDefault();break;case Key.PageUp:this._lbx._selectPrevPage(),this.selectAll(),t.preventDefault();break;case Key.PageDown:this._lbx._selectNextPage(),this.selectAll(),t.preventDefault()}}_updateInputSelection(t){this._elRef==this._tbx&&this._setSelRange(t,this._tbx.value.length)}_getSelStart(){return this._tbx&&this._tbx.value?this._tbx.selectionStart:0}_getSelEnd(){return this._tbx&&this._tbx.value?this._tbx.selectionEnd:0}_setSelRange(t,e){let s=this._tbx;this._elRef!=s||s.readOnly||setSelectionRange(s,t,e)}};_addCultureInfo("MultiSelect",{itemsSelected:"{count:n0} items selected",selectAll:"Select All"});export class MultiSelect extends ComboBox{constructor(t,e){super(t),this._maxHdrItems=2,this._readOnly=!1,this._hdrFmt=culture.MultiSelect.itemsSelected,this.checkedItemsChanged=new Event,addClass(this.hostElement,"wj-multiselect"),this._tbx.readOnly=!0,this.checkedMemberPath=null,this.addEventListener(this.inputElement,"click",t=>{document.elementFromPoint(t.clientX,t.clientY)==this.inputElement&&(this._btnclick(t),t.preventDefault())}),this.addEventListener(this._selectAll,"click",t=>{hasItems(this.collectionView)&&t.target==this._selectAllCheckbox&&(this.checkedItems=t.target.checked?this.collectionView.items:[])}),this.removeEventListener(this.dropDown,"click"),this._updateHeader(),this.listBox.itemsChanged.addHandler(()=>{this._updateHeader()}),this.listBox.checkedItemsChanged.addHandler(()=>{this._updateHeader(),this.onCheckedItemsChanged()}),this.initialize(e)}get showSelectAllCheckbox(){return""==this._selectAll.style.display}set showSelectAllCheckbox(t){this._selectAll.style.display=asBoolean(t)?"":"none"}get selectAllLabel(){return this._selectAllLabel}set selectAllLabel(t){t!=this._selectAllLabel&&(this._selectAllLabel=asString(t),this.refresh())}get checkedMemberPath(){let t=this.listBox.checkedMemberPath;return t!=MultiSelect._DEF_CHECKED_PATH?t:null}set checkedMemberPath(t){t=asString(t),this.listBox.checkedMemberPath=t||MultiSelect._DEF_CHECKED_PATH}get maxHeaderItems(){return this._maxHdrItems}set maxHeaderItems(t){this._maxHdrItems!=t&&(this._maxHdrItems=asNumber(t),this._updateHeader())}get headerFormat(){return this._hdrFmt}set headerFormat(t){t!=this._hdrFmt&&(this._hdrFmt=asString(t),this._updateHeader())}get headerFormatter(){return this._hdrFormatter}set headerFormatter(t){t!=this._hdrFormatter&&(this._hdrFormatter=asFunction(t),this._updateHeader())}get checkedItems(){return this.listBox.checkedItems}set checkedItems(t){this.listBox.checkedItems=asArray(t)}onCheckedItemsChanged(t){this.checkedItemsChanged.raise(this,t)}onIsDroppedDownChanged(t){super.onIsDroppedDownChanged(t),this.isDroppedDown&&this.listBox.focus()}_createDropDown(){this._selectAll=createElement('<div class="wj-header wj-select-all wj-listbox-item" style="display:none" tabindex="0"><label><input type="checkbox"> <span></span></label></div>',this._dropDown),this._selectAllCheckbox=this._selectAll.querySelector("input[type=checkbox]"),this._selectAllSpan=this._selectAll.querySelector("label>span"),setText(this._selectAllSpan,culture.MultiSelect.selectAll);let t=createElement("<div></div>",this._dropDown);this._lbx=new ListBox(t),super._createDropDown(),addClass(this.dropDown,"wj-control wj-listbox"),this.dropDown.style.overflow="hidden"}get isReadOnly(){return this._readOnly}set isReadOnly(t){this._readOnly=asBoolean(t),toggleClass(this.hostElement,"wj-state-readonly",this.isReadOnly)}refresh(t=!0){super.refresh(t),this._updateHeader(),this._selectAllSpan&&setText(this._selectAllSpan,this._selectAllLabel||culture.MultiSelect.selectAll)}_setText(t,e){}_keydown(t){super._keydown(t),!t.defaultPrevented&&hasItems(this.collectionView)&&t.keyCode>32&&(this.isDroppedDown=!0)}_updateHeader(){let t=this.checkedItems;if(isFunction(this._hdrFormatter))this.inputElement.value=this._hdrFormatter();else{let e="";if(t.length>0)if(t.length<=this._maxHdrItems){if(this.displayMemberPath){let e=new Binding(this.displayMemberPath);t=t.map(t=>e.getValue(t))}e=t.join(", ")}else e=format(this.headerFormat,{count:t.length});this.inputElement.value=e}let e=null,s=this.collectionView;hasItems(s)&&(0==t.length?e=!1:t.length==s.items.length&&(e=!0)),this._selectAllCheckbox.indeterminate=null==e,null!=e&&(this._selectAllCheckbox.checked=e),this._updateState()}};MultiSelect._DEF_CHECKED_PATH="$checked";export class Menu extends ComboBox{constructor(t,e){super(t),this._isButton=!1,this._openOnHover=!1,this._closeOnLeave=!0,this._hoverEnterBnd=this._hoverEnter.bind(this),this._hoverLeaveBnd=this._hoverLeave.bind(this),this._hoverOverBnd=this._hoverOver.bind(this),this.itemClicked=new Event;let s=this.hostElement,i=this._tbx,h=this._lbx,n=this.dropDown;addClass(s,"wj-menu"),i.style.display="none";this._hdr=this._elRef=createElement('<div wj-part="header" class="wj-form-control"/>'),i.parentElement.insertBefore(this._hdr,this._tbx);var l=this._orgOuter.match(/tabindex="?(-?\d+)"?/i);s.tabIndex=l?parseInt(l[1]):0,this.isRequired=!1,setAttribute(s,"role","menubar",!0),setAttribute(i,"role",null),setAttribute(i,"aria-autocomplete",null),setAttribute(i,"aria-owns",null),setAttribute(n,"role","menu"),h.itemRole="menuitem","SELECT"==this._orgTag&&(this.header=s.getAttribute("header"),this._lbx.itemsSource&&(this.commandParameterPath="cmdParam")),this.isContentHtml=!0,this.maxDropDownHeight=500,this.addEventListener(this._hdr,"click",t=>{t.defaultPrevented||(this._clearHover(),this._isButton?(this.isDroppedDown=!1,this._raiseCommand()):this.isDroppedDown=!this.isDroppedDown)}),h.lostFocus.addHandler(()=>{this.containsFocus()||(this.isDroppedDown=!1)}),addClass(n,"wj-menu-items"),h.formatItem.addHandler(this._formatMenuItem.bind(this)),this.initialize(e)}get header(){return this._hdr.innerHTML}set header(t){this._hdr.innerHTML=asString(t)}get command(){return this._cmd}set command(t){this._cmd=t}get commandPath(){return this._cmdPath}set commandPath(t){this._cmdPath=asString(t)}get commandParameterPath(){return this._cmdParamPath}set commandParameterPath(t){this._cmdParamPath=asString(t)}get subItemsPath(){return this._subPath}set subItemsPath(t){t!=this._subPath&&(this._subPath=t,this.refresh(!0))}get openOnHover(){return this._openOnHover}set openOnHover(t){this._openOnHover=asBoolean(t),this._updateHoverEvents()}get closeOnLeave(){return this._closeOnLeave}set closeOnLeave(t){this._closeOnLeave=asBoolean(t),this._updateHoverEvents()}get isButton(){return this._isButton}set isButton(t){this._isButton=asBoolean(t)}get owner(){return this._owner}set owner(t){this._owner=asType(t,HTMLElement,!0),this._enableDisableItems()}show(t){if(!this.isDroppedDown&&(this.selectedIndex=-1,this.onIsDroppedDownChanging(new CancelEventArgs))){let e=this.owner||t.target,s=this.dropDown;e instanceof HTMLElement&&(s[Control._OWNR_KEY]=e),showPopup(s,t,!1,this.isAnimated),this.onIsDroppedDownChanged(),s.focus()}}hide(){this.isDroppedDown&&this.onIsDroppedDownChanging(new CancelEventArgs)&&(hidePopup(this.dropDown),this.onIsDroppedDownChanged())}onItemClicked(t){this.itemClicked.raise(this,t)}refresh(t=!0){super.refresh(t),this._enableDisableItems()}onIsDroppedDownChanged(t){super.onIsDroppedDownChanged(t),this.isDroppedDown?(this._closing=!0,this._defaultItem=this.selectedItem,this.isRequired=!1,this.selectedIndex=-1,this._enableDisableItems(),this._closing=!1,this.dropDown.focus()):this.selectedItem||(this.selectedItem=this._defaultItem)}_updateHoverEvents(){let t=this.hostElement,e=this.dropDown,s=this.addEventListener.bind(this),i=this.removeEventListener.bind(this),h="mouseleave";i(t,"mouseenter",this._hoverEnterBnd),i(t,h,this._hoverLeaveBnd),i(e,"mouseover",this._hoverOverBnd),i(e,h,this._hoverLeaveBnd),this._openOnHover&&(s(t,"mouseenter",this._hoverEnterBnd),s(e,"mouseover",this._hoverOverBnd),this._closeOnLeave&&(s(t,h,this._hoverLeaveBnd),s(e,h,this._hoverLeaveBnd)))}_getSubItems(t){let e=this.subItemsPath,s=t&&e?t[e]:null;return isArray(s)&&s.length?s:null}_formatMenuItem(t,e){let s=e.item;this._getSubItems(e.data)?addClass(s,"wj-subitems"):"-"==s.innerHTML&&(s.innerHTML="",addClass(s,"wj-separator"))}_keydown(t){if(!t.defaultPrevented){let s=this._getKeyCode(t);if(this.isDroppedDown)switch(s){case Key.Enter:case Key.Right:if(this._showSubMenu())return void t.preventDefault();break;case Key.Left:var e=Control.getControl(this.owner);if(e instanceof Menu){let s=e.dropDown,i=e.selectedIndex;return(i>-1?s.children[i]:s).focus(),void t.preventDefault()}}s==Key.Enter&&(this.isDroppedDown?this.getDisplayText(this.selectedIndex)&&this._raiseCommand():(this.isDroppedDown=!0,t.preventDefault()))}super._keydown(t)}_dropDownClick(t){if(!t.defaultPrevented&&t.target!=this.dropDown){if(this._clearHover(),this._showSubMenu())return void t.preventDefault();this.getDisplayText(this.selectedIndex)&&this._raiseCommand()}super._dropDownClick(t)}_showSubMenu(){let t=this._getSubItems(this.selectedItem);if(!t)return null;let e=this.dropDown.children[this.selectedIndex].getBoundingClientRect(),s=new Point(e.right,e.top);if(0==e.height)return null;let i=this.rightToLeft||"rtl"==this.dropDown.getAttribute("dir");i&&(s.x=e.left);let h=new Menu(document.createElement("div"),{owner:this.hostElement,itemsSource:t,itemClicked:(t,e)=>{this.itemClicked.raise(t,e)}});"displayMemberPath,selectedValuePath,isContentHtml,command,commandPath,commandParameterPath,maxDropDownWidth,maxDropDownHeight,dropDownCssClass,isAnimated,subItemsPath,openOnHover,closeOnLeave".split(",").forEach(t=>{h[t]=this[t]});let n=h.dropDown;return setAttribute(n,"dir",i?"rtl":null),h.show(s),n[Control._OWNR_KEY]=this.dropDown,n.focus(),h}_raiseCommand(t){let e=this.selectedItem,s=this._getSubItems(e),i=this._getCommand(e);if(i&&!s){let t=this._getCommandParm(e);if(!this._canExecuteCommand(i,t))return;this._executeCommand(i,t)}if(this.onItemClicked(t),this.containsFocus()){let t=this;for(;t&&t.owner;){let e=Control.getControl(t.owner);if(!(e instanceof Menu))break;t=e}let e=t.owner;!e&&t.dropDown&&(e=t.dropDown[Control._OWNR_KEY]),t.isDroppedDown=!1,t.focus(),t.containsFocus()||e instanceof HTMLElement&&e.focus()}}_getCommand(t){let e=t&&this._cmdPath?t[this._cmdPath]:null;return e||this._cmd}_getCommandParm(t){let e=this._cmdParamPath;return t&&e?t[e]:t}_executeCommand(t,e){t&&!isFunction(t)&&(t=t.executeCommand),isFunction(t)&&t(e)}_canExecuteCommand(t,e){if(t){let s=t.canExecuteCommand;if(isFunction(s))return s(e)}return!0}_enableDisableItems(){if(this.collectionView&&(this._cmd||this._cmdPath)){let t=this.collectionView.items;for(let e=0;e<t.length;e++){let s=t[e],i=this._getCommand(s);if(i){let t=this._lbx.hostElement.children[e],h=this._getCommandParm(s);toggleClass(t,"wj-state-disabled",!this._canExecuteCommand(i,h))}}}}_clearHover(){this._toHover&&clearTimeout(this._toHover),this._toHover=null}_hoverEnter(t){this._clearHover(),this._toHover=setTimeout(()=>{this._toHover=null,this.isDroppedDown=!0},Control._HOVER_DELAY)}_hoverLeave(t){if(this._clearHover(),this.isDroppedDown){let e=document.elementFromPoint(t.clientX,t.clientY),s=closest(e,".wj-listbox.wj-menu-items"),i=this._subMenu;s||contains(this.hostElement,e)||(this.isDroppedDown=!1,i&&(i.isDroppedDown=!1))}}_hoverOver(t){this._clearHover(),this._toHover=setTimeout(()=>{this._toHover=null;let e=this.listBox.indexOf(t.target);e>-1&&(this.selectedIndex=e,this._subMenu=this._showSubMenu())},Control._HOVER_DELAY)}};export class InputTime extends ComboBox{constructor(t,e){if(super(t),this._format="t",this.valueChanged=new Event,addClass(this.hostElement,"wj-inputtime"),this.isEditable=!0,this._value=DateTime.newDate(),this._msk=new _MaskProvider(this._tbx),isIE9()||(this._tbx.type="tel"),"INPUT"==this._orgTag){let t=this._tbx.getAttribute("value");t&&(this.value=Globalize.parseDate(t,"HH:mm:ss"))}this.step=15,this.autoExpandSelection=!0,this.initialize(e)}get inputElement(){return this._tbx}get inputType(){return this._tbx.type}set inputType(t){this._tbx.type=asString(t)}get value(){return this._value}set value(t){(t=asDate(t,!this.isRequired))&&(t=this._clamp(t)),this._setText(t?Globalize.format(t,this.format):"",!0),this.selectedItem&&this.selectedItem.value&&(t=DateTime.fromDateTime(t,this.selectedItem.value)),t==this._value||DateTime.equals(t,this._value)||(this._value=t,this.onValueChanged())}get text(){return this._tbx.value}set text(t){t!=this.text&&(this._setText(t,!0),this._commitText())}get min(){return this._min}set min(t){this._min=asDate(t,!0),this.isDroppedDown=!1,this._updateItems()}get max(){return this._max}set max(t){this._max=asDate(t,!0),this.isDroppedDown=!1,this._updateItems()}get step(){return this._step}set step(t){this._step=asNumber(t,!0),this.isDroppedDown=!1,this._updateItems()}get format(){return this._format}set format(t){t!=this.format&&(this._format=asString(t),this._tbx.value=Globalize.format(this.value,this.format),hasItems(this.collectionView)&&this._updateItems())}get mask(){return this._msk.mask}set mask(t){this._msk.mask=asString(t)}onValueChanged(t){this.valueChanged.raise(this,t)}onItemsSourceChanged(t){super.onItemsSourceChanged(t),this._hasCustomItems=null!=this.itemsSource}refresh(t=!0){super.refresh(t),this.isDroppedDown=!1,this._msk.refresh(),this._tbx.value=Globalize.format(this.value,this.format),this._updateItems()}onSelectedIndexChanged(t){if(this.selectedIndex>-1&&!this._settingText){let t=this.value?this.value:DateTime.newDate(),e=null!=this.selectedItem.value?this.selectedItem.value:Globalize.parseDate(this.text,this.format,this.value);this.value=DateTime.fromDateTime(t,e)}super.onSelectedIndexChanged(t)}_clamp(t){return null!=this._min&&this._getTime(t)<this._getTime(this._min)&&(t=DateTime.fromDateTime(t,this._min)),null!=this._max&&this._getTime(t)>this._getTime(this._max)&&(t=DateTime.fromDateTime(t,this._max)),t}_wheel(t){if(!t.defaultPrevented&&!this.isDroppedDown&&!this.isReadOnly&&this.containsFocus()&&this.selectedIndex<0&&this.value&&isNumber(this.step)&&this.step>0){let e=DateTime.addMinutes(this.value,this.step*clamp(t.deltaY,-1,1));this.value=this._clamp(e),this.selectAll(),t.preventDefault()}super._wheel(t)}_updateInputSelection(t){if(this._delKey)super._updateInputSelection(t);else{let e=this._tbx.value;for(;t<e.length&&!e[t].match(/[a-z0-9]/i);)t++;setSelectionRange(this._tbx,t,this._tbx.value.length)}}_updateItems(){if(this._hasCustomItems)return;let t=[],e=DateTime.newDate(0,0,0,0,0),s=DateTime.newDate(0,0,0,23,59,59);if(this.min&&e.setHours(this.min.getHours(),this.min.getMinutes(),this.min.getSeconds()),this.max&&s.setHours(this.max.getHours(),this.max.getMinutes(),this.max.getSeconds()),isNumber(this.step)&&this.step>0)for(let i=e;i<=s;i=DateTime.addMinutes(i,this.step))t.push({value:i,text:Globalize.format(i,this.format)});let i=this.value;this._settingText=!0,this.displayMemberPath="text",this.selectedValuePath="text",this.itemsSource=t,this._hasCustomItems=!1,this._settingText=!1,this.value=i}_getTime(t){return 3600*t.getHours()+60*t.getMinutes()+t.getSeconds()}_keydown(t){if(super._keydown(t),!t.defaultPrevented)switch(t.keyCode){case Key.Enter:this.isDroppedDown||(this._commitText(),this.selectAll());break;case Key.Escape:this.text=Globalize.format(this.value,this.format),this.selectAll()}}_commitText(){if(this.text||this.isRequired){let t=this.value?Globalize.format(this.value,this.format):null;if(this.text!=t){let e=this.selectedItem&&this.selectedItem.value?this.selectedItem.value:Globalize.parseDate(this.text,this.format,this.value);e?this.value=DateTime.fromDateTime(this.value,e):this.text=t}}else this.value=null}};_addCultureInfo("InputDateTime",{ariaLabels:{tglDate:"Toggle Calendar",tglTime:"Toggle Time List"}});export class InputDateTime extends InputDate{constructor(t,e){super(t),addClass(this.hostElement,"wj-inputdatetime"),this._btnTm=this.hostElement.querySelector('[wj-part="btn-tm"]');let s=culture.InputDateTime.ariaLabels;setAriaLabel(this._btn,s.tglDate),setAriaLabel(this._btnTm,s.tglTime),this.format="g",this._inputTime=new InputTime(document.createElement("div"),{valueChanged:(t,e)=>{this.value=DateTime.fromDateTime(this.value,t.value)}});let i=this._inputTime.dropDown,h=this.calendar.hostElement,n=this.addEventListener.bind(this),l=this._keydown.bind(this);n(i,"keydown",l,!0),n(i,"blur",()=>{this._updateFocusState()},!0),n(i,"click",t=>{t.defaultPrevented||t.target!=i&&this.hostElement.focus()},!0),n(this._btn,"mousedown",t=>{this._setDropdown(h)&&this._btnclick(t)}),n(this._btnTm,"mousedown",t=>{this._setDropdown(i),this._btnclick(t),t.preventDefault()}),this.initialize(e)}get timeMin(){return this._inputTime.min}set timeMin(t){this._inputTime.min=t}get timeMax(){return this._inputTime.max}set timeMax(t){this._inputTime.max=t}get timeFormat(){return this._inputTime.format}set timeFormat(t){this._inputTime.format=t}get timeStep(){return this._inputTime.step}set timeStep(t){this._inputTime.step=t}get inputTime(){return this._inputTime}dispose(){this._setDropdown(this.calendar.hostElement),super.dispose(),this._inputTime.dispose()}refresh(t=!0){this._setDropdown(this.calendar.hostElement),this._inputTime.refresh(),super.refresh(t)}_updateBtn(){super._updateBtn(),this._btnTm&&(this._btnTm.tabIndex=this._btn.tabIndex,this._btnTm.parentElement.style.display=this._btn.style.display)}_clamp(t){return t&&(this.min&&t<this.min&&(t=this.min),this.max&&t>this.max&&(t=this.max)),t}_commitText(){let t=this._tbx.value;if(t||this.isRequired){let e=Globalize.parseDate(t,this.format,this.value);e?this.value=e:this._tbx.value=Globalize.format(this.value,this.format)}else this.value=null}_setDropdown(t){if(this._dropDown==t)return!1;this.isDroppedDown&&(this.isDroppedDown=!1);var e=this.dropDownCssClass;return this.dropDownCssClass="",this._dropDown=t,this.dropDownCssClass=e,!0}_updateDropDown(){let t=this._inputTime;this._dropDown==t.dropDown?(this._commitText(),super._updateDropDown(),t.isRequired=this.isRequired&&null!=this.value,t.value=this.value,this.isDroppedDown&&t.listBox.showSelection()):super._updateDropDown()}};InputDateTime.controlTemplate='<div class="wj-template"><div class="wj-input"><div class="wj-input-group wj-input-btn-visible"><input wj-part="input" type="text" class="wj-form-control"/><span class="wj-input-group-btn"><button wj-part="btn" class="wj-btn wj-btn-default" tabindex="-1"><span class="wj-glyph-calendar"></span></button><button wj-part="btn-tm" class="wj-btn wj-btn-default" tabindex="-1"><span class="wj-glyph-clock"></span></button></span></div></div><div wj-part="dropdown" class="wj-content wj-dropdown-panel" style="display:none"></div></div>';export class AutoComplete extends ComboBox{constructor(t,e){super(t),this._cssMatch="wj-autocomplete-match",this._minLength=2,this._maxItems=6,this._itemCount=0,this._delay=500,this._query="",this._inCallback=!1,this._srchProps=[],addClass(this.hostElement,"wj-autocomplete"),this._bsCollapse=!1,this.isEditable=!0,this.isRequired=!1,this.listBox.formatItem.addHandler(this._formatListItem,this),this._itemsSourceFnCallBackBnd=this._itemSourceFunctionCallback.bind(this),this.initialize(e)}get minLength(){return this._minLength}set minLength(t){this._minLength=asNumber(t,!1,!0)}get maxItems(){return this._maxItems}set maxItems(t){this._maxItems=asNumber(t,!1,!0)}get delay(){return this._delay}set delay(t){this._delay=asNumber(t,!1,!0)}get searchMemberPath(){return this._srchProp}set searchMemberPath(t){this._srchProp=asString(t),this._srchProps=t?t.trim().split(/\s*,\s*/):[]}get itemsSourceFunction(){return this._itemsSourceFn}set itemsSourceFunction(t){this._itemsSourceFn=asFunction(t),isFunction(this._itemsSourceFn)&&this.itemsSourceFunction(this.text,this.maxItems,this._itemsSourceFnCallBackBnd)}get cssMatch(){return this._cssMatch}set cssMatch(t){this._cssMatch=asString(t)}_keydown(t){if(!t.defaultPrevented&&this.isDroppedDown)switch(t.keyCode){case Key.Up:case Key.Down:this.selectAll()}super._keydown(t)}_setText(t){if(!this._inCallback){if(!t&&this.selectedIndex>-1&&this.getDisplayText()&&(this.selectedIndex=-1),t!=this._oldText&&(this._tbx.value!=t&&(this._tbx.value=t),this._oldText=t,this.onTextChanged(),!t&&this.collectionView))return(this._query||this.selectedIndex<0)&&(this.isDroppedDown=!1),this._query=this._rxHighlight=null,void(this.collectionView.filter=null);this._toSearch&&clearTimeout(this._toSearch),t!=this.getDisplayText()&&(this._toSearch=setTimeout(()=>{this._toSearch=null;let t=this.text.trim();if(t.length>=this._minLength&&t!=this._query){this._query=t,t=t.replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1");let e=escapeHtml(t);this._rxMatch=new RegExp("(?=.*"+t.replace(/ /g,")(?=.*")+")","ig"),this._rxHighlight=this.isContentHtml?new RegExp("("+e.replace(/ /g,"|")+")(?![^<]*>|[^<>]* </)","ig"):new RegExp("("+e.replace(/ /g,"|")+")","ig"),this.itemsSourceFunction?this.itemsSourceFunction(t,this.maxItems,this._itemsSourceFnCallBackBnd):this._updateItems()}},this._delay))}}_itemSourceFunctionCallback(t){this._inCallback=!0;let e=asCollectionView(t);if(e&&e.moveCurrentToPosition(-1),this.itemsSource=e,this._inCallback=!1,this.containsFocus()){let t=this._tbx,e=t.selectionStart,s=t.selectionEnd;this.isDroppedDown=!0,setSelectionRange(t,e,s),this.refresh()}}onIsDroppedDownChanged(t){if(super.onIsDroppedDownChanged(t),this.containsFocus()&&!this.isTouching&&this.selectedIndex<0){let t=this.collectionView.items,e=this.text;1==t.length&&t[0]==e?this.selectedIndex=0:setSelectionRange(this._tbx,e.length)}this._query=""}_updateItems(){let t=this.collectionView;if(t){this._inCallback=!0,t.beginUpdate(),this._itemCount=0,t.filter=this._filter.bind(this),t.moveCurrentToPosition(-1),t.endUpdate(),this._inCallback=!1;let e=t.items.length,s=this._tbx,i=s.selectionStart,h=s.selectionEnd;this.isDroppedDown=e>0&&this.containsFocus(),e||this.isEditable||(this.selectedIndex=-1),this.isDroppedDown&&setSelectionRange(s,i,h),this.refresh()}}_filter(t){if(this._itemCount>=this._maxItems)return!1;let e=this._getItemText(t,!1);if(this._srchProps)for(let s=0;s<this._srchProps.length;s++)e+="\0"+t[this._srchProps[s]];return this.isContentHtml&&(e=e.replace(/<[^>]*>/g,"")),!!e.match(this._rxMatch)&&(this._itemCount++,!0)}_getItemText(t,e){let s=t?t.toString():"",i=e&&this.headerPath?this._pathHdr:this._lbx._pathDisplay;return i&&(s=null!=(s=i.getValue(t))?s.toString():""),s}_formatListItem(t,e){if(this._cssMatch&&this._rxHighlight){let t='<span class="'+this._cssMatch+'">$1</span>';e.item.innerHTML=e.item.innerHTML.replace(this._rxHighlight,t)}}};export class MultiAutoComplete extends AutoComplete{constructor(t,e){super(t),this._selItems=[],this._lastInputValue="",this._selPath=new Binding(null),this._notAddItm=!1,this.selectedItemsChanged=new Event,addClass(this.hostElement,"wj-multi-autocomplete"),this.showDropDownButton=!1,this.initialize(e),this._wjTpl=this.hostElement.querySelector(".wj-template"),this._wjInput=this.hostElement.querySelector(".wj-input"),this.addEventListener(this.hostElement,"keyup",this._keyup.bind(this),!0),this.addEventListener(window,"resize",this._adjustInputWidth.bind(this)),this.addEventListener(this._tbx,"focus",()=>{this._itemOff()}),this._addHelperInput(),this._initSeltems(),this.listBox.itemsChanged.addHandler(()=>this.selectedIndex=-1),this._refreshHeader()}set showDropDownButton(t){this._showBtn=!1}get maxSelectedItems(){return this._maxSelItems}set maxSelectedItems(t){this._maxSelItems!=t&&(this._maxSelItems=asNumber(t,!0),this._updateMaxItems(),this._refreshHeader(),this._clearSelIndex())}get selectedMemberPath(){return this._selPath.path}set selectedMemberPath(t){(t=asString(t))!==this.selectedMemberPath&&(this._selPath.path=t,this._initSeltems(),this._refreshHeader(),this.onSelectedItemsChanged())}get selectedItems(){return this._selItems}set selectedItems(t){if(this._selItems=asArray(t),this.selectedMemberPath&&""!==this.selectedMemberPath&&this._selItems)for(let t=0;t<this._selItems.length;t++){let e=this._selItems[t];this._setSelItem(e,!1)}this._updateMaxItems(),this.onSelectedItemsChanged(),this._refreshHeader(),this._clearSelIndex()}onSelectedItemsChanged(t){this.selectedItemsChanged.raise(this,t)}onIsDroppedDownChanged(t){!this.isDroppedDown&&this.selectedIndex>-1&&!this._notAddItm&&this._addItem(!0),this._notAddItm=!1,super.onIsDroppedDownChanged(t)}refresh(t=!0){super.refresh(t),this._initSeltems(),this.isDroppedDown||this._refreshHeader()}_keydown(t){if(!this.isReadOnly){if(!t.defaultPrevented)switch(t.keyCode){case Key.Back:this._lastInputValue=this._tbx.value;break;case Key.Enter:this._itemOff(),this._addItem(!0),isIE&&setSelectionRange(this._tbx,0,0);break;case Key.Tab:this.isDroppedDown?(this._addItem(!1),this._tbx.value="",this._lbx.selectedIndex=-1,t.preventDefault()):this._updateFocus();break;case Key.Space:if(""!==this._tbx.value)return;this.isDroppedDown||this._tbx.disabled||(this.isDroppedDown=!0,this._clearSelIndex());break;case Key.Escape:this.isDroppedDown&&(this._notAddItm=!0);break;case Key.Left:this._itemOn(!this.rightToLeft);break;case Key.Right:this._itemOn(!!this.rightToLeft);break;case Key.Up:case Key.Down:let e=getActiveElement();if(t.altKey){if(this._tbx==e)return this.isDroppedDown=!this.isDroppedDown,this.isDroppedDown||this._tbx.focus(),void t.preventDefault()}else if(this._tbx!==e)return;default:if(t.keyCode===Key.Back||t.keyCode===Key.Delete)return;this._itemOff(),null!=this._maxSelItems&&this._selItems.length>=this._maxSelItems&&t.preventDefault()}this._tbx.disabled||super._keydown(t)}}_updateState(){super._updateState(),this._wjTpl&&(hasClass(this.hostElement,"wj-state-focused")||this._itemOff())}_keyup(t){if(!this.isReadOnly&&!t.defaultPrevented)switch(t.keyCode){case Key.Back:0===this._tbx.value.length&&0===this._lastInputValue.length&&this._delItem(!1);break;case Key.Delete:this._delItem(!0)}}_addHelperInput(){let t=document.createElement("input");t.type="text",t.tabIndex=-1,t.className="wj-token-helper",t.readOnly=!0,this._wjTpl.insertBefore(t,this._wjInput),this._helperInput=t}_refreshHeader(){let t=this.hostElement.querySelectorAll(".wj-token");for(let e=0;e<t.length;e++)this._wjTpl.removeChild(t[e]);let e=this.selectedItems;if(!e||0===e.length)return this._wjInput.style.cssFloat=this.rightToLeft?"right":"left",void this._adjustInputWidth();for(let t=0;t<e.length;t++)this._insertToken(e[t]);this._wjInput.style.cssFloat=this.rightToLeft?"right":"left",this._adjustInputWidth()}_insertToken(t){let e=this._getItemText(t,!0);this.isContentHtml||(e=escapeHtml(e)),this._wjTpl.insertBefore(this._createItem(e),this._wjInput)}_updateMaxItems(){null!=this._maxSelItems&&this._selItems&&this._selItems.length>this._maxSelItems&&(this._selItems=this._selItems.slice(0,this._maxSelItems))}_updateFocus(){let t=this._wjTpl.querySelector("."+MultiAutoComplete._clsActive);t?(removeClass(t,MultiAutoComplete._clsActive),setTimeout(()=>{this._tbx.focus()})):(this._clearSelIndex(),removeClass(this.hostElement,"wj-state-focused"))}_addItem(t){this.selectedItems.indexOf(this.selectedItem)>-1?this._clearSelIndex():this.selectedIndex>-1&&(this._updateSelItems(this.selectedItem,!0),this._refreshHeader(),t&&this._clearSelIndex(),this._disableInput(!0))}_delItem(t){let e,s,i=this._wjTpl.querySelector("."+MultiAutoComplete._clsActive),h=!1;t&&!i||(i?(s=this._getItemIndex(i))>-1&&(e=this._selItems[s],h=!0):this._selItems.length>0&&(e=this._selItems[this._selItems.length-1],h=!0),h&&(this._updateSelItems(e,!1),this._refreshHeader(),this._clearSelIndex(),this._disableInput(!1)),this._tbx.focus())}_updateSelItems(t,e){if(e){if(this._selItems&&0!==this._selItems.length||(this._selItems=[]),null!=this._maxSelItems&&this._selItems.length>=this._maxSelItems)return;this._selItems.push(t)}else{let e=this._selItems.indexOf(t);this._selItems.splice(e,1)}this._hasSelectedMemeberPath()&&this._setSelItem(t,e),this.onSelectedItemsChanged()}_createItem(t){let e=document.createElement("div"),s=document.createElement("span"),i=document.createElement("a");return e.appendChild(s),e.appendChild(i),e.className="wj-token",s.className="wj-token-label",s.innerHTML=t,i.className="wj-token-close",i.href="#",i.tabIndex=-1,i.text="×",e.style.cssFloat=this.rightToLeft?"right":"left",this.addEventListener(e,"click",t=>{this._helperInput.focus();let s=this._wjTpl.querySelector("."+MultiAutoComplete._clsActive);s&&removeClass(s,MultiAutoComplete._clsActive),addClass(e,MultiAutoComplete._clsActive),t.stopPropagation(),t.preventDefault()}),this.addEventListener(i,"click",t=>{if(this.isReadOnly)return;let s=this._getItemIndex(e);if(s>-1){let t=this._selItems[s];this._updateSelItems(t,!1)}this._wjTpl.removeChild(e),this._adjustInputWidth(),this._disableInput(!1),this._tbx.focus(),t.stopPropagation(),t.preventDefault()}),e}_itemOn(t){let e,s,i,h=getActiveElement();if((this._tbx!=h||0===this._tbx.value.length)&&0!==(e=this._wjTpl.querySelectorAll(".wj-token")).length)if(s=this._wjTpl.querySelector("."+MultiAutoComplete._clsActive),i=this._getItemIndex(s),t){if(0===i)return;-1===i?(addClass(e[e.length-1],MultiAutoComplete._clsActive),this._helperInput.focus()):(removeClass(s,MultiAutoComplete._clsActive),addClass(e[i-1],MultiAutoComplete._clsActive),this._helperInput.focus())}else if(!t){if(-1===i)return;i!==e.length-1?(removeClass(s,MultiAutoComplete._clsActive),addClass(e[i+1],MultiAutoComplete._clsActive),this._helperInput.focus()):(removeClass(s,MultiAutoComplete._clsActive),this._tbx.focus())}}_itemOff(){let t=this._wjTpl.querySelector("."+MultiAutoComplete._clsActive);t&&removeClass(t,MultiAutoComplete._clsActive)}_initSeltems(){if(this.selectedMemberPath&&""!==this.selectedMemberPath){let t=this.itemsSource;if(this._selItems.splice(0,this._selItems.length),t)for(let e=0;e<t.sourceCollection.length;e++)this._getSelItem(e)&&this._selItems.push(t.sourceCollection[e])}}_getSelItem(t){let e=this.itemsSource.sourceCollection[t];return!(!isObject(e)||!this.selectedMemberPath)&&this._selPath.getValue(e)}_setSelItem(t,e){this.itemsSource;isObject(t)&&this._selPath.getValue(t)!=e&&this._selPath.setValue(t,e)}_clearSelIndex(){this.selectedIndex=-1}_hasSelectedMemeberPath(){return this.selectedMemberPath&&""!==this.selectedMemberPath}_disableInput(t){null!=this._maxSelItems&&(this._selItems.length<this._maxSelItems?(this._tbx.disabled=!1,this._tbx.focus()):(this._tbx.disabled=!0,this.hostElement.focus()))}_adjustInputWidth(){this._tbx.style.width="60px";let t,e=getElementRect(this.hostElement),s=getElementRect(this._tbx),i=getComputedStyle(this._tbx),h=parseInt(i.paddingLeft,10),n=parseInt(i.paddingRight,10);t=this.rightToLeft?s.left+s.width-e.left-h-n-8:e.left+e.width-s.left-h-n-8,this._tbx.style.width=t+"px"}_getItemIndex(t){let e=this.hostElement.querySelectorAll(".wj-token");for(let s=0;s<e.length;s++)if(t===e[s])return s;return-1}};MultiAutoComplete._clsActive="wj-token-active",_registerModule("wijmo.input",selfModule);