/*!
    *
    * Wijmo Library 5.20191.603
    * http://wijmo.com/
    *
    * Copyright(c) GrapeCity, Inc.  All rights reserved.
    *
    * Licensed under the GrapeCity Commercial License.
    * sales@wijmo.com
    * wijmo.com/products/wijmo-5/license/
    *
    */

import{asNumber,copy,asEnum,asBoolean,asType,Point,Rect,isArray,isNumber,asFunction,asArray,assert,asInt,asString,isString,Size,_registerModule}from"wijmo/wijmo";import{SeriesBase,ChartType,_DataPoint,_RectArea,_CircleArea,HitTestInfo,ChartElement,_DataInfo,Series}from"wijmo/wijmo.chart";import*as selfModule from"wijmo/wijmo.chart.analytics";export class Waterfall extends SeriesBase{constructor(t){super(),this._startLabel="Start",this._relativeData=!0,this._connectorLines=!1,this._showTotal=!1,this._totalLabel="Total",this._getXValues=!1,this._showIntermediateTotal=!1,this._intermediateTotalPos=[],this._chartType=ChartType.Bar,this.rendering.addHandler(this._rendering,this),this.initialize(t)}get relativeData(){return this._relativeData}set relativeData(t){t!=this._relativeData&&(this._relativeData=asBoolean(t,!0),this._invalidate())}get start(){return this._start}set start(t){t!=this._start&&(this._start=asNumber(t,!0),this._invalidate())}get startLabel(){return this._startLabel}set startLabel(t){t!=this._startLabel&&(this._startLabel=asString(t,!1),this._invalidate())}get showTotal(){return this._showTotal}set showTotal(t){t!=this._showTotal&&(this._showTotal=asBoolean(t,!0),this._invalidate())}get totalLabel(){return this._totalLabel}set totalLabel(t){t!=this._totalLabel&&(this._totalLabel=asString(t,!1),this._invalidate())}get showIntermediateTotal(){return this._showIntermediateTotal}set showIntermediateTotal(t){t!=this._showIntermediateTotal&&(this._showIntermediateTotal=asBoolean(t,!1),this._invalidate())}get intermediateTotalPositions(){return this._intermediateTotalPositions}set intermediateTotalPositions(t){t!=this._intermediateTotalPositions&&(this._intermediateTotalPositions=asArray(t,!0),this._invalidate())}get intermediateTotalLabels(){return this._intermediateTotalLabels}set intermediateTotalLabels(t){t!=this._intermediateTotalLabels&&(assert(null==t||isArray(t)||isString(t),"Array or string expected."),this._intermediateTotalLabels=t,this._invalidate())}get connectorLines(){return this._connectorLines}set connectorLines(t){t!=this._connectorLines&&(this._connectorLines=asBoolean(t,!0),this._invalidate())}get styles(){return this._styles}set styles(t){t!=this._styles&&(this._styles=t,this._invalidate())}getValues(t){var e,i,r,s,a=[],n=0;if(e=super.getValues(t),0===t){if(!this._yValues){a=[];var l=0,h=0,u=e&&e.length||0;if(this.relativeData){for(;h<u;h++)l+=isNaN(e[h])?0:e[h],a.push(l);this._yValues=a}else{for(;h<u;h++)l=isNaN(e[h])?0:e[h],a.push(l);this._yValues=a}(i=this._yValues)&&i.length>0&&(this.showIntermediateTotal&&this.intermediateTotalPositions&&this.intermediateTotalPositions.length>0&&(this._intermediateTotalPos=i.slice(),this.intermediateTotalPositions.reduceRight((t,e)=>{var r=0===e?i[0]:i[e-1];return i.length>e?(i.splice(e,0,r),this._intermediateTotalPos.splice(e,0,!0)):i.length===e&&(i.push(r),this._intermediateTotalPos.push(!0)),0},0)),null!=this.start&&(i.splice(0,0,this.start),this._intermediateTotalPos.splice(0,0,!1)),this.showTotal&&i&&i.push(i[i.length-1]))}return this._yValues}if(!this._xValues&&this._getXValues&&(this._xValues=e&&e.slice(),this._getXValues=!1,this._xValues&&this._xValues.length>1&&(u=this._xValues.length,s=this._xValues[u-1],n=Math.abs(this._xValues[u-1]-this._xValues[u-2])),this.chart&&this.chart._xlabels&&this.chart._xlabels.length)){if(r=this.chart._xlabels,this.showIntermediateTotal&&this.intermediateTotalPositions&&this.intermediateTotalPositions.length>0){var o=this.intermediateTotalLabels;o&&this.intermediateTotalPositions.reduceRight((t,e,i)=>{var a="";return a=isString(o)?o:o[i]||"",r.length>e?r.splice(e,0,a):r.length===e&&r.push(a),n&&(s+=n,this._xValues.push(s)),0},0)}null!=this.start&&(r.splice(0,0,this.startLabel),n&&(s+=n,this._xValues.push(s))),this.showTotal&&(r.push(this.totalLabel),n&&(s+=n,this._xValues.push(s)))}return this._xValues}legendItemLength(){return this.showTotal?3:2}measureLegendItem(t,e){var i=this._getName(e);return i?this._measureLegendItem(t,i):new Size(0,0)}drawLegendItem(t,e,i){var r=this._getLegendStyles(i);this._getName(i)&&this._drawLegendItem(t,e,ChartType.Bar,this._getName(i),r,this.symbolStyle)}_clearValues(){super._clearValues(),this._xValues=null,this._yValues=null,this._wfstyle=null,this._getXValues=!0,this._intermediateTotalPos=[],this.chart&&this.chart._performBind()}_invalidate(){super._invalidate(),this._clearValues()}_rendering(t,e){e.cancel=!0,this._wfstyle=null;var i,r,s,a,n,l,h=this.chart,u=this._getAxisY(),o=this._getAxisX(),_=u.origin||0,c=e.engine;if(this._barPlotter=h._getPlotter(this),s=this._barPlotter.rotated,this._barPlotter._getSymbolOrigin||(this._barPlotter._getSymbolOrigin=((t,e,i)=>0===e?t:!0===this._intermediateTotalPos[e]?t:e===i-1&&this.showTotal?t:this._yValues[e-1])),this._barPlotter._getSymbolStyles||(this._barPlotter._getSymbolStyles=((t,e)=>{var i=this._getStyles();return 0===t&&null!=this.start?i.start:!0===this._intermediateTotalPos[t]?i.intermediateTotal:t===e-1&&this.showTotal?i.total:this._yValues[t]<this._yValues[t-1]?i.falling:i.rising})),this._barPlotter.plotSeries(c,o,u,t,h,0,1),this.connectorLines){for(c.startGroup(Waterfall.CSS_CONNECTOR_LINE_GROUP),a=this._barPlotter.hitTester._map[0],l=this._yValues[0]<_,n=a[0].rect,i=1,r=a.length;i<r;i++)!0===this._intermediateTotalPos[i]&&i!==r-1||(this._drawConnectorLine(c,s,n,a[i].rect,l),n=a[i].rect,l=this._yValues[i]<this._yValues[i-1]);c.endGroup()}}_getStyles(){if(this._wfstyle)return this._wfstyle;var t=this._chart.series.indexOf(this),e=this._getSymbolFill(t),i=this._getSymbolStroke(t),r=this.styles||{};return this._wfstyle={start:this._getStyleByKey(r,"start",e,i),intermediateTotal:this._getStyleByKey(r,"intermediateTotal",e,i),total:this._getStyleByKey(r,"total",e,i),falling:this._getStyleByKey(r,"falling","red","red"),rising:this._getStyleByKey(r,"rising","green","green")},this._wfstyle}_getStyleByKey(t,e,i,r){return{fill:t[e]&&t[e].fill?t[e].fill:i,stroke:t[e]&&t[e].stroke?t[e].stroke:r}}_drawConnectorLine(t,e,i,r,s){var a=new Point,n=new Point,l=this.chart.axisY.reversed,h=this.chart.axisX.reversed;l^=s,e?(l?(a.x=i.left,n.x=i.left):(a.x=i.left+i.width,n.x=i.left+i.width),h?(a.y=i.top,n.y=r.top+r.height):(a.y=i.top+i.height,n.y=r.top)):(l?(a.y=i.top+i.height,n.y=i.top+i.height):(a.y=i.top,n.y=i.top),h?(a.x=i.left+i.width,n.x=r.left):(a.x=i.left,n.x=r.left+r.width)),t.drawLine(a.x,a.y,n.x,n.y,Waterfall.CSS_CONNECTOR_LINE,this.styles&&this.styles.connectorLines||{stroke:"black"})}_getLegendStyles(t){if(t<0||null===this.styles)return null;var e=this._getStyles();return 0===t?e.rising:1===t?e.falling:e.total}_getName(t){var e=void 0;if(this.name)if(this.name.indexOf(",")){var i=this.name.split(",");i&&i.length-1>=t&&(e=i[t].trim())}else e=this.name;return e}};Waterfall.CSS_CONNECTOR_LINE_GROUP="water-fall-connector-lines",Waterfall.CSS_CONNECTOR_LINE="water-fall-connector-line",Waterfall.CSS_ENDLABEL="water-fall-end-label";export class TrendLineBase extends SeriesBase{constructor(t){super(),this._chartType=ChartType.Line,this._sampleCount=100,this.initialize(t)}get sampleCount(){return this._sampleCount}set sampleCount(t){(t=asNumber(t,!1,!0))!=this._sampleCount&&(this._sampleCount=t,this._invalidate())}approximate(t){return 0}getValues(t){var e=this.binding,i=this.bindingX;return e!==this._bind&&(this._bind=e,this.binding=e),i!==this._bindX&&(this._bindX=i,this.bindingX=i),null==this._originYValues&&(this._originYValues=super.getValues(0)),null==this._originXValues&&(this._originXValues=super.getValues(1)),null==this._originXValues||null==this._originYValues?null:(super.getValues(t),null!=this._xValues&&null!=this._yValues||this._calculateValues(),0===t?this._yValues||null:1===t?this._xValues||null:void 0)}_calculateValues(){}_invalidate(){super._invalidate(),this._clearCalculatedValues()}_clearValues(){super._clearValues(),this._originXValues=null,this._originYValues=null,this._clearCalculatedValues()}_clearCalculatedValues(){this._xValues=null,this._yValues=null}};export var MovingAverageType;!function(t){t[t.Simple=0]="Simple",t[t.Weighted=1]="Weighted",t[t.Exponential=2]="Exponential",t[t.Triangular=3]="Triangular"}(MovingAverageType||(MovingAverageType={}));export class MovingAverage extends TrendLineBase{constructor(t){super(),this._chartType=ChartType.Line,this._type=MovingAverageType.Simple,this._period=2,this.initialize(t)}get type(){return this._type}set type(t){(t=asEnum(t,MovingAverageType,!1))!=this._type&&(this._type=t,this._invalidate())}get period(){return this._period}set period(t){(t=asNumber(t,!1,!0))!=this._period&&(this._period=asNumber(t,!1,!0),this._invalidate())}_checkPeriod(){var t=this.period,e=this._originXValues;t<=1&&assert(!1,"period must be greater than 1."),e&&e.length&&t>=e.length&&assert(!1,"period must be less than itemSource's length.")}_calculateValues(){this._type;var t="_calculate"+MovingAverageType[this._type],e=[],i=[];this._checkPeriod(),this[t]&&this[t].call(this,e,i),this._yValues=i,this._xValues=e}_calculateSimple(t,e,i=!1){for(var r=this._originXValues,s=this._originYValues,a=r.length,n=this._period,l=0,h=0;h<a;h++)l+=s[h]||0,h>=n&&(l-=s[h-n]||0),h>=n-1?(t.push(r[h]),e.push(l/n)):i&&(t.push(r[h]),e.push(l/(h+1)))}_calculateWeighted(t,e){for(var i=this._originXValues,r=this._originYValues,s=i.length,a=this._period,n=a*(a+1)/2,l=0,h=0,u=0;u<s;u++)u>0&&(l+=r[u-1]||0),u>a&&(l-=r[u-a-1]||0),u<a-1?h+=(r[u]||0)*(u+1):(h+=(r[u]||0)*a,u>a-1&&(h-=l),t.push(i[u]),e.push(h/n))}_calculateExponential(t,e){for(var i=this._originXValues,r=this._originYValues,s=i.length,a=this._period,n=0,l=0;l<s;l++)l<=a-2?(n+=r[l]||0,l===a-2&&(n/=a-1)):(n+=2/(a+1)*((r[l]||0)-n),t.push(i[l]),e.push(n))}_calculateTriangular(t,e){var i=this._period,r=[],s=[],a=0;this._calculateSimple(r,s,!0);for(var n=0,l=r.length;n<l;n++)a+=s[n]||0,n>=i&&(a-=s[n-i]||0),n>=i-1&&(t.push(r[n]),e.push(a/i))}};class MathHelper{static round(t,e){if(!t)return 0;var i=Math.pow(10,e||2);return Math.round(t*i)/i}static avg(t){return MathHelper.sum(t)/t.length}static sum(t){return(t=asArray(t,!1)).reduce((t,e)=>t+e,0)}static sumOfPow(t,e){return t=asArray(t,!1),e=asNumber(e,!1),t.reduce((t,i)=>t+Math.pow(i,e),0)}static sumProduct(...t){t.length;var e,i,r=0,s=[];for((t=asArray(t,!1)).forEach((t,e)=>{t=asArray(t,!1),0===e?r=t.length:assert(t.length===r,"The length of the arrays must be equal")}),e=0;e<r;e++)i=1,t.some((t,r)=>{var s=t[e];if(!s||!isNumber(s))return i=0,!0;i*=s}),s.push(i);return MathHelper.sum(s)}static variance(t){t=asArray(t,!1);var e,i=MathHelper.avg(t);return e=t.map(t=>t-i),MathHelper.sumOfSquares(e)/(t.length-1)}static covariance(t,e){t=asArray(t,!1),e=asArray(e,!1),assert(t.length===e.length,"Length of arrays must be equal");var i,r=MathHelper.avg(t),s=MathHelper.avg(e),a=t.length,n=0;for(i=0;i<a;i++)n+=(t[i]-r)*(e[i]-s)/a;return n}}MathHelper.min=(t=>Math.min.apply(Math,asArray(t,!1))),MathHelper.max=(t=>Math.max.apply(Math,asArray(t,!1))),MathHelper.square=(t=>Math.pow(asNumber(t,!1),2)),MathHelper.sumOfSquares=(t=>MathHelper.sumOfPow(t,2)),MathHelper.stdDev=(t=>Math.sqrt(MathHelper.variance(t)));export var TrendLineFitType;!function(t){t[t.Linear=0]="Linear",t[t.Exponential=1]="Exponential",t[t.Logarithmic=2]="Logarithmic",t[t.Power=3]="Power",t[t.Fourier=4]="Fourier",t[t.Polynomial=5]="Polynomial",t[t.MinX=6]="MinX",t[t.MinY=7]="MinY",t[t.MaxX=8]="MaxX",t[t.MaxY=9]="MaxY",t[t.AverageX=10]="AverageX",t[t.AverageY=11]="AverageY"}(TrendLineFitType||(TrendLineFitType={}));export class TrendLine extends TrendLineBase{constructor(t){super(),this._fitType=TrendLineFitType.Linear,this._order=2,this.initialize(t)}get fitType(){return this._fitType}set fitType(t){(t=asEnum(t,TrendLineFitType,!1))!=this._fitType&&(this._fitType=t,this._invalidate())}get order(){return this._order}set order(t){t!=this._order&&(this._order=asNumber(t,!1,!0),this._invalidate())}get coefficients(){return this._helper?this._helper.coefficients:null}approximate(t){return this._helper?this._helper.approximate(t):NaN}getEquation(t){return(this._helper?this._helper.getEquation(t):"").replace(/\S(\+|\-)\d/g,function(t){return t[0]+" "+t[1]+" "+t[2]})}_calculateValues(){var t=TrendLineFitType[this._fitType];if(TrendLineHelper[t]){var e=!1,i=this._originXValues;0==this._chart._xvals.length&&this._chart._xlabels.length>0&&(i=this._originXValues.map(t=>t+1),e=!0);var r=new TrendLineHelper[t](this._originYValues,i,this.sampleCount,this.order);r._isXString=e;var s=r.calculateValues();this._yValues=s[0],this._xValues=s[1],this._helper=r}}};class Calculator{constructor(t,e){this._x=t,this._y=e}get x(){return this._x}get y(){return this._y}get minX(){return null==this._minX&&(this._minX=MathHelper.min(this._x)),this._minX}get minY(){return null==this._minY&&(this._minY=MathHelper.min(this._y)),this._minY}get maxX(){return null==this._maxX&&(this._maxX=MathHelper.max(this._x)),this._maxX}get maxY(){return null==this._maxY&&(this._maxY=MathHelper.max(this._y)),this._maxY}get averageX(){return null==this._averageX&&(this._averageX=MathHelper.avg(this._x)),this._averageX}get averageY(){return null==this._averageY&&(this._averageY=MathHelper.avg(this._y)),this._averageY}get sumX(){return null==this._sumX&&(this._sumX=MathHelper.sum(this._x)),this._sumX}get sumY(){return null==this._sumY&&(this._sumY=MathHelper.sum(this._y)),this._sumY}get LogX(){return null==this._logX&&(this._logX=this._x.map(t=>Math.log(t))),this._logX}get LogY(){return null==this._logY&&(this._logY=this._y.map(t=>Math.log(t))),this._logY}get sumLogX(){return null==this._sumLogX&&(this._sumLogX=MathHelper.sum(this.LogX)),this._sumLogX}get sumLogY(){return null==this._sumLogY&&(this._sumLogY=MathHelper.sum(this.LogY)),this._sumLogY}get sumOfSquareX(){return null==this._sumOfSquareX&&(this._sumOfSquareX=MathHelper.sumOfSquares(this._x)),this._sumOfSquareX}get sumOfSquareY(){return null==this._sumOfSquareY&&(this._sumOfSquareY=MathHelper.sumOfSquares(this._y)),this._sumOfSquareY}get sumOfSquareLogX(){return null==this._sumOfSquareLogX&&(this._sumOfSquareLogX=MathHelper.sumOfSquares(this.LogX)),this._sumOfSquareLogX}get sumOfSquareLogY(){return null==this._sumOfSquareLogY&&(this._sumOfSquareLogY=MathHelper.sumOfSquares(this.LogY)),this._sumOfSquareLogY}sumProduct(t,e){return null==this._sumProduct&&(this._sumProduct=MathHelper.sumProduct(t,e)),this._sumProduct}}class TrendHelperBase{constructor(t,e,i){this._coefficients=[],this.y=asArray(t),this.x=asArray(e),assert(t.length===e.length,"Length of X and Y arrays are not equal"),this.count=i||t.length,this._calculator=new Calculator(e,t),this.xMin=this._calculator.minX,this.xMax=this._calculator.maxX}get calculator(){return this._calculator}get y(){return this._y}set y(t){t!==this.y&&(this._y=asArray(t,!1))}get x(){return this._x}set x(t){t!==this.x&&(this._x=asArray(t,!1))}get count(){return this._count}set count(t){t!==this.count&&(this._count=asInt(t,!1,!0))}get xMin(){return this._xMin}set xMin(t){t!==this.xMin&&(this._xMin=asNumber(t,!1))}get xMax(){return this._xMax}set xMax(t){t!==this.xMax&&(this._xMax=asNumber(t,!1))}get coefficients(){return this._coefficients}_calculateCoefficients(){var t=this.calcB(),e=this.calcA(t);this._coefficients.push(e,t)}calculateValues(){for(var t=(this.xMax-this.xMin)/(this.count-1),e=[[],[]],i=0;i<this.count;i++){var r=this.xMin+t*i,s=this.calcY(r);e[0].push(s),this._isXString?e[1].push(r-1):e[1].push(r)}return e}calcA(t){var e=this.y.length,i=this.calculator.sumX;return(this.calculator.sumY-(t=t||this.calcB())*i)/e}calcB(){var t=this.y.length,e=this.calculator,i=e.sumProduct(e.x,e.y),r=e.sumX;return(t*i-r*e.sumY)/(t*e.sumOfSquareX-MathHelper.square(r))}calcY(t){var e=this.coefficients;return e[0]+e[1]*t}approximate(t){return this.calcY(t)}getEquation(t){t=t||this._defaultEquationFmt;return this._getEquation(t)}_getEquation(t){var e=[];return this.coefficients.forEach(i=>{e.push(t(i))}),this._concatEquation(e)}_concatEquation(t){return""}_defaultEquationFmt(t){var e,i=Math.abs(t),r=String(i),s=0;return i>=1e5?(e=String(Math.round(i)).length-1,Math.round(t/Number("1e"+e))+"e"+e):i<1e-4?(e=r.indexOf("e")>-1?Math.abs(+r.substring(r.indexOf("e")+1)):r.match(/\.0+/)[0].length,Math.round(t*Number("1e"+e))+"e-"+e):(s=t>0?6:7,i>=1e4&&s--,String(+String(t).substring(0,s)))}}class LinearHelper extends TrendHelperBase{get yOffset(){return this._yOffset}set yOffset(t){t!==this.yOffset&&(this._yOffset=asNumber(t,!0))}constructor(t,e,i,r){super(t,e,i),this._calculateCoefficients(),this.yOffset=r}calcA(t){return null!=this.yOffset?this.yOffset:super.calcA(t)}calcB(){return null!=this.yOffset?this._calculateBSimple():super.calcB()}_calculateBSimple(){var t=this.calculator,e=t.sumProduct(t.x,t.y),i=t.sumX,r=t.sumOfSquareX;return(e-this.yOffset*i)/r}_calculateCoefficients(){var t=this.calcB(),e=this.calcA(t);this.coefficients.push(t,e)}calcY(t){var e=this.coefficients;return e[0]*t+e[1]}_concatEquation(t){return"y = "+t[0]+"x"+(this.coefficients[1]>=0?"+":"")+t[1]}}class LogHelper extends TrendHelperBase{constructor(t,e,i){super(t,e,i),this._calculateCoefficients()}calcA(t){var e=this.y.length,i=this.calculator,r=i.sumY,s=i.sumLogX;return(r-(t=t||this.calcB())*s)/e}calcB(){var t=this.y.length,e=this.calculator,i=e.sumProduct(e.y,e.LogX),r=e.sumY,s=e.sumLogX;return(t*i-r*s)/(t*e.sumOfSquareLogX-MathHelper.square(s))}_calculateCoefficients(){var t=this.calcB(),e=this.calcA(t);this.coefficients.push(t,e)}calcY(t){var e=this.coefficients;return Math.log(t)*e[0]+e[1]}_concatEquation(t){return"y = "+t[0]+"ln(x)"+(this.coefficients[1]>=0?"+":"")+t[1]}}class ExpHelper extends TrendHelperBase{constructor(t,e,i){super(t,e,i),this._calculateCoefficients()}calcA(){var t=this.y.length,e=this.calculator,i=e.sumLogY,r=e.sumOfSquareX,s=e.sumX,a=e.sumProduct(e.x,e.LogY);return Math.exp((i*r-s*a)/(t*r-MathHelper.square(s)))}calcB(){var t=this.y.length,e=this.calculator,i=e.sumLogY,r=e.sumOfSquareX,s=e.sumX;return(t*e.sumProduct(e.x,e.LogY)-s*i)/(t*r-MathHelper.square(s))}calcY(t){var e=this.coefficients;return e[0]*Math.exp(e[1]*t)}_concatEquation(t){return"y = "+t[0]+"e<sup>"+t[1]+"x</sup>"}}class PowerHelper extends TrendHelperBase{constructor(t,e,i){super(t,e,i),this._calculateCoefficients()}calcA(t){var e=this.calculator,i=this.y.length,r=e.sumLogX,s=e.sumLogY;t=t||this.calcB();return Math.exp((s-t*r)/i)}calcB(){var t=this.y.length,e=this.calculator,i=e.sumProduct(e.LogX,e.LogY),r=e.sumLogX;return(t*i-r*e.sumLogY)/(t*e.sumOfSquareLogX-MathHelper.square(r))}calcY(t){var e=this.coefficients;return e[0]*Math.pow(t,e[1])}_concatEquation(t){return"y = "+t[0]+"x<sup>"+t[1]+"</sup>"}}class LeastSquaresHelper extends TrendHelperBase{constructor(t,e,i,r){super(t,e,i),this._order=null==r?2:r,this._basis=[],this._calculateCoefficients()}get basis(){return this._basis}get order(){return this._order}set order(t){this._order=asNumber(t,!0)}_calculateCoefficients(){this._coefficients.length=this.order,this._createBasis(),this._normalizeAndSolveGauss()}_createBasis(){var t=this.x.length,e=this.order;if(t<2)throw"Incompatible data: Less than 2 data points.";if(e<1)throw"Incompatible data: Less than 1 coefficient in the fit";if(e>t)throw"Incompatible data: Number of data points less than number of terms"}_normalizeAndSolveGauss(){var t=[];if(this._computeNormalEquations(t),this._genDefValForArray(t,0),!this._solveGauss(t))throw"Incompatible data: No solution."}_genDefValForArray(t,e){var i=t.length+1;t.forEach(t=>{for(var r=0;r<i;r++)null==t[r]&&(t[r]=e)})}_computeNormalEquations(t){var e,i,r,s,a=this.y,n=this.basis,l=this.order,h=a.length;for(e=0;e<l;e++)for(r=0,null==t[e]&&(t[e]=[]),a.forEach((t,i)=>{r+=t*n[i][e]}),t[e][l]=r,i=e;i<l;i++){for(r=0,s=0;s<h;s++)r+=n[s][i]*n[s][e];null==t[i]&&(t[i]=[]),t[i][e]=r,t[e][i]=r}}_solveGauss(t){var e,i,r=t.length,s=this._coefficients,a=!0;if(s.length<r||t[0].length<r+1)throw"Dimension of matrix is not correct.";if(t.some((e,s)=>{var n,l,h=s,u=Math.abs(e[s]);for(i=s+1;i<r;i++)u<(n=Math.abs(t[i][s]))&&(u=n,h=i);if(!(u>0))return a=!1,!0;for(i=s;i<=r;i++)l=t[s][i],t[s][i]=t[h][i],t[h][i]=l;for(h=s+1;h<r;h++)for(l=t[h][s]/e[s],t[h][s]=0,i=s+1;i<=r;i++)t[h][i]-=l*e[i]}),a)for(e=r-1;e>=0;e--){for(s[e]=t[e][r],i=e+1;i<r;i++)s[e]-=t[e][i]*s[i];s[e]=s[e]/t[e][e]}return a}}class PolyHelper extends LeastSquaresHelper{constructor(t,e,i,r){super(t,e,i,r)}get coefficients(){return this._coefficients.slice(0).reverse()}calcY(t){var e=0,i=1;return this._coefficients.forEach((r,s)=>{s>0&&(i*=t),e+=r*i}),e}_calculateCoefficients(){this._coefficients;this.order++,super._calculateCoefficients(),this.order--}_createBasis(){super._createBasis();var t=this.x,e=this.basis,i=this.order;t.forEach((t,r)=>{e[r]=[1];for(var s=1;s<=i;s++)e[r][s]=t*e[r][s-1]})}_concatEquation(t){var e="y = ",i=t.length,r=this.coefficients;return t.forEach(function(t,s){var a,n=i-1-s;0===n?e+=t:1===n?(a=r[s+1]>=0?"+":"",e+=t+"x"+a):(a=r[s+1]>=0?"+":"",e+=t+"x<sup>"+n+"</sup>"+a)}),e}}class FourierHelper extends LeastSquaresHelper{constructor(t,e,i,r){super(t,e,i,r=null==r?e.length:r)}_createBasis(){super._createBasis();var t=this.x,e=this.basis,i=this.order;t.forEach((t,r)=>{var s,a;for(e[r]=[1],s=1;s<i;s++)a=Math.floor((s+1)/2),s%2==1?e[r].push(Math.cos(a*t)):e[r].push(Math.sin(a*t))})}calcY(t){var e;return this._coefficients.forEach((i,r)=>{var s,a=Math.floor((r+1)/2);0===r?e=i:(s=a*t,e+=r%2==1?i*Math.cos(s):i*Math.sin(s))}),e}_concatEquation(t){var e="y = ",i=t.length,r=this.coefficients;return t.forEach(function(t,s){var a=s===i-1?"":r[s+1]>=0?"+":"",n="",l=Math.ceil(s/2);if(0===s)e+=t+a;else{n=s%2==1?"cos":"sin";n+="("+(1===l?"":String(l))+"x)",e+=t+n+a}}),e}}class SimpleTrendHelper extends TrendHelperBase{constructor(t,e,i){super(t,e,i),this._calculateCoefficients()}_setVal(t){this._val=t}calcY(t){return this._val}}class MinXHelper extends SimpleTrendHelper{constructor(t,e,i){super(t,e,i)}calculateValues(){var t,e,i=this.xMin,r=MathHelper.min(this.y),s=MathHelper.max(this.y);return this._isXString&&(i-=1),t=[i,i],e=[r,s],this._setVal(i),[e,t]}getEquation(t){var e=this.xMin;return this._isXString&&(e-=1),t&&(e=t(e)),"x = "+e}}class MinYHelper extends SimpleTrendHelper{constructor(t,e,i){super(t,e,i)}calculateValues(){var t,e,i=this.xMin,r=this.xMax,s=MathHelper.min(this.y);return this._isXString&&(i-=1,r-=1),t=[i,r],e=[s,s],this._setVal(s),[e,t]}getEquation(t){var e=MathHelper.min(this.y);return t&&(e=t(e)),"y = "+e}}class MaxXHelper extends SimpleTrendHelper{constructor(t,e,i){super(t,e,i)}calculateValues(){var t,e,i=this.xMax,r=MathHelper.min(this.y),s=MathHelper.max(this.y);return this._isXString&&(i-=1),t=[i,i],e=[r,s],this._setVal(i),[e,t]}getEquation(t){var e=this.xMax;return this._isXString&&(e-=1),t&&(e=t(e)),"x = "+e}}class MaxYHelper extends SimpleTrendHelper{constructor(t,e,i){super(t,e,i)}calculateValues(){var t,e,i=this.xMin,r=this.xMax,s=MathHelper.max(this.y);return this._isXString&&(i-=1,r-=1),t=[i,r],e=[s,s],this._setVal(s),[e,t]}getEquation(t){var e=MathHelper.max(this.y);return t&&(e=t(e)),"y = "+e}}class AverageXHelper extends SimpleTrendHelper{constructor(t,e,i){super(t,e,i)}calculateValues(){var t,e,i=MathHelper.avg(this.x),r=MathHelper.min(this.y),s=MathHelper.max(this.y);return this._isXString&&(i-=1),t=[i,i],e=[r,s],this._setVal(i),[e,t]}_getEquation(t){var e=MathHelper.avg(this.x);return this._isXString&&(e-=1),t&&(e=t(e))," x ="+e}_defaultEquationFmt(t){return Math.abs(t)<1e5?super._defaultEquationFmt(t):""+MathHelper.round(t,2)}}class AverageYHelper extends SimpleTrendHelper{constructor(t,e,i){super(t,e,i)}calculateValues(){var t,e,i=MathHelper.avg(this.y),r=this.xMin,s=this.xMax;return this._isXString&&(r-=1,s-=1),t=[r,s],e=[i,i],this._setVal(i),[e,t]}_getEquation(t){return"y = "+t(MathHelper.avg(this.y))}_defaultEquationFmt(t){return Math.abs(t)<1e5?super._defaultEquationFmt(t):""+MathHelper.round(t,2)}}var TrendLineHelper={TrendHelperBase:TrendHelperBase,Linear:LinearHelper,Exponential:ExpHelper,Logarithmic:LogHelper,Power:PowerHelper,Polynomial:PolyHelper,Fourier:FourierHelper,MinX:MinXHelper,MinY:MinYHelper,MaxX:MaxXHelper,MaxY:MaxYHelper,AverageX:AverageXHelper,AverageY:AverageYHelper};export class FunctionSeries extends TrendLineBase{constructor(t){super(),this._min=0,this._max=1,this.initialize(t),null==this.itemsSource&&(this.itemsSource=[new Point(0,0)])}get min(){return this._min}set min(t){this._min!==t&&(this._min=asNumber(t,!1),this._invalidate())}get max(){return this._max}set max(t){this._max!==t&&(this._max=asNumber(t,!1),this._invalidate())}getValues(t){return null!=this._xValues&&null!=this._yValues||this._calculateValues(),0===t?this._yValues||null:1===t?this._xValues||null:void 0}_calculateValues(){for(var t,e=this.sampleCount,i=[],r=[],s=(this.max-this.min)/(e-1),a=0;a<e;a++)t=a===e-1?this.max:this.min+s*a,i[a]=this._calculateX(t),r[a]=this._calculateY(t);this._yValues=r,this._xValues=i}_validateValue(t){return isFinite(t)?t:Number.NaN}_calculateValue(t,e){var i;try{i=t(e)}catch(t){i=Number.NaN}return this._validateValue(i)}_calculateX(t){return 0}_calculateY(t){return 0}};export class YFunctionSeries extends FunctionSeries{constructor(t){super(t)}get func(){return this._func}set func(t){t&&this._func!==t&&(this._func=asFunction(t,!1),this._invalidate())}_calculateX(t){return t}_calculateY(t){return this._calculateValue(this.func,t)}approximate(t){return this._calculateValue(this.func,t)}};export class ParametricFunctionSeries extends FunctionSeries{constructor(t){super(t)}get xFunc(){return this._xFunc}set xFunc(t){t&&this._xFunc!==t&&(this._xFunc=asFunction(t,!1),this._invalidate())}get yFunc(){return this._yFunc}set yFunc(t){t&&this._yFunc!==t&&(this._yFunc=asFunction(t,!1),this._invalidate())}_calculateX(t){return this._calculateValue(this.xFunc,t)}_calculateY(t){return this._calculateValue(this.yFunc,t)}approximate(t){var e=this._calculateValue(this.xFunc,t),i=this._calculateValue(this.yFunc,t);return new Point(e,i)}};export var ErrorAmount;!function(t){t[t.FixedValue=0]="FixedValue",t[t.Percentage=1]="Percentage",t[t.StandardDeviation=2]="StandardDeviation",t[t.StandardError=3]="StandardError",t[t.Custom=4]="Custom"}(ErrorAmount||(ErrorAmount={}));export var ErrorBarEndStyle;!function(t){t[t.Cap=0]="Cap",t[t.NoCap=1]="NoCap"}(ErrorBarEndStyle||(ErrorBarEndStyle={}));export var ErrorBarDirection;!function(t){t[t.Both=0]="Both",t[t.Minus=1]="Minus",t[t.Plus=2]="Plus"}(ErrorBarDirection||(ErrorBarDirection={}));export class ErrorBar extends Series{constructor(t){super(),this._errorAmount=ErrorAmount.FixedValue,this._endStyle=ErrorBarEndStyle.Cap,this._direction=ErrorBarDirection.Both,this.rendering.addHandler(this._rendering,this),this.initialize(t)}get value(){return this._value}set value(t){t!=this._value&&(this._value=t,this._invalidate())}get errorAmount(){return this._errorAmount}set errorAmount(t){(t=asEnum(t,ErrorAmount,!0))!=this._errorAmount&&(this._errorAmount=t,this._invalidate())}get errorBarStyle(){return this._errorBarStyle}set errorBarStyle(t){t!=this._errorBarStyle&&(this._errorBarStyle=t,this._invalidate())}get endStyle(){return this._endStyle}set endStyle(t){(t=asEnum(t,ErrorBarEndStyle,!0))!=this._endStyle&&(this._endStyle=t,this._invalidate())}get direction(){return this._direction}set direction(t){(t=asEnum(t,ErrorBarDirection,!0))!=this._direction&&(this._direction=t,this._invalidate())}getDataRect(t,e){if(!t)return null;this._chart;var i,r=this.errorAmount,s=0,a=0;this._paddings=[],this._calculateErrorValue();var n,l,h,u,o=this.getValues(0);if(!o)return t;for(h=0,i=o.length;h<i;h++){var _={plus:0,val:0,minus:0},c=this._value||0;switch(u=o[h],r){case ErrorAmount.Custom:(_=this._getCustomValue(h)).val=u,this._paddings.push(_);break;case ErrorAmount.FixedValue:this._paddings.push({plus:c,minus:c,val:u});break;case ErrorAmount.Percentage:this._paddings.push({plus:u*c,minus:u*c,val:u});break;case ErrorAmount.StandardDeviation:this._paddings.push({plus:this._errorValue*c,minus:this._errorValue*c,val:u});break;case ErrorAmount.StandardError:this._paddings.push({plus:this._errorValue,minus:this._errorValue,val:u})}(isNaN(n)||n>u-_.minus)&&(n=u-_.minus),(isNaN(l)||l<u+_.plus)&&(l=u+_.plus)}switch(r){case ErrorAmount.FixedValue:s=c,a=c;break;case ErrorAmount.Percentage:s=n*c,a=l*c;break;case ErrorAmount.StandardDeviation:s=this._errorValue*c,a=this._errorValue*c;break;case ErrorAmount.StandardError:s=this._errorValue,a=this._errorValue}return this._showPlus&&(l+=a),this._showMinus&&(n-=s),new Rect(t.left,n,t.width,l-n)}_getCustomValue(t){var e,i=this.value,r={minus:0,val:0,plus:0};return null!=this._minusBindingValues||null!=this._plusBindingValues?(r.minus=this._minusBindingValues&&this._minusBindingValues[t]||0,r.plus=this._plusBindingValues&&this._plusBindingValues[t]||0,r):null==i?r:(isArray(i)?((e=i[t])&&e.minus&&(r.minus=e.minus),e&&e.plus&&(r.plus=e.plus)):isNumber(i)?(r.minus=i,r.plus=i):(i.minus&&(r.minus=i.minus),i.plus&&(r.plus=i.plus)),r)}_calculateErrorValue(){var t=0,e=0,i=0;if(this._errorAmount===ErrorAmount.StandardDeviation||this._errorAmount===ErrorAmount.StandardError){var r=this.getValues(0);null!=r&&(r.forEach(i=>{t+=i,e++}),i=t/e,this._mean=i,t=0,r.forEach(e=>{t+=Math.pow(e-i,2)}),this._errorValue=Math.sqrt(t/(e-1))),this._errorAmount==ErrorAmount.StandardError&&(this._errorValue=this._errorValue/Math.sqrt(e))}}_clearValues(){this.__errorValue=null,this._mean=null,this._plusBindingValues=null,this._minusBindingValues=null,super._clearValues()}getValues(t){if(0==t&&this.errorAmount===ErrorAmount.Custom){var e=this._getBinding(1),i=this._getBinding(2);if((null==this._plusBindingValues||null==this._minusBindingValues)&&e&&i)if(null!=this._cv){if(e){var r=this._bindValues(this._cv.items,e);this._plusBindingValues=r.values}if(i){var s=this._bindValues(this._cv.items,i);this._minusBindingValues=s.values}}else if(null!=this.binding&&null!=this._chart&&null!=this._chart.collectionView){if(e){r=this._bindValues(this._chart.collectionView.items,e);this._plusBindingValues=r.values}if(i){s=this._bindValues(this._chart.collectionView.items,i);this._minusBindingValues=s.values}}}return super.getValues(t)}get _chart(){return this.__chart}set _chart(t){t!==this.__chart&&(this.__chart=t)}get _errorValue(){return this.__errorValue}set _errorValue(t){t!=this.__errorValue&&(this.__errorValue=t)}get _showPlus(){return this.direction===ErrorBarDirection.Both||this.direction===ErrorBarDirection.Plus}get _showMinus(){return this.direction===ErrorBarDirection.Both||this.direction===ErrorBarDirection.Minus}_rendering(t,e){this._errorBarEles=[],e.cancel=!0;var i=this.chart,r=i._plotRect,s=this._getAxisY(),a=this._getAxisX(),n=(s.origin,e.engine),l=i.series.indexOf(this),h=this._plotter;h.plotSeries(n,a,s,this,i,e.index,e.count,t=>{var e,u,o,_=this._paddings,c=this._showPlus,m=this._showMinus,d=i._isRotated(),g=this.errorBarStyle&&this.errorBarStyle["stroke-width"]||2;o=(u=d?a:s).actualMax,e=u.convert(o);var p=n.stroke,f=n.strokeWidth;n.stroke="black",n.strokeWidth=1,t&&t.length&&t.forEach((t,i)=>{if(null!=t.x&&null!=t.y){var s=_[i],a=s&&s.minus||0,p=s&&s.plus||0,f=Math.abs(u.convert(o-a)-e),x=Math.abs(u.convert(o+p)-e),y=new Point(t.x,t.y),v=new Point(t.x,t.y);let M;d?(this.errorAmount===ErrorAmount.StandardDeviation&&(t=new Point(u.convert(this._mean),t.y),y.x=t.x,v.x=t.x),m&&(y.x=y.x-f),c&&(v.x=v.x+x)):(this.errorAmount===ErrorAmount.StandardDeviation&&(t=new Point(t.x,u.convert(this._mean)),y.y=t.y,v.y=t.y),m&&(y.y=y.y+f),c&&(v.y=v.y-x)),M=d?new Rect(y.x,y.y-g,Math.abs(v.x-y.x),2*g):new Rect(v.x-g,v.y,2*g,Math.abs(v.y-y.y));let S=new _RectArea(M);S.ignoreLabel=!0;let w=new _DataPoint(l,i,i,s.val);S.tag=w,h.hitTester.add(S,l);let V=[n.drawLine(Math.max(y.x,r.left),Math.min(y.y,r.bottom),Math.min(v.x,r.right),Math.max(v.y,r.top),"error-bar",this.errorBarStyle)];if(this._errorBarEles[i]=V,this.endStyle===ErrorBarEndStyle.Cap){if(c){let t;d?v.x<=r.right&&(t=n.drawLine(v.x,v.y-g,v.x,v.y+g,"error-bar",this.errorBarStyle),V.push(t)):v.y>=r.top&&(t=n.drawLine(v.x-g,v.y,v.x+g,v.y,"error-bar",this.errorBarStyle),V.push(t))}if(m){let t;d?y.x>=r.left&&(t=n.drawLine(y.x,y.y-g,y.x,y.y+g,"error-bar",this.errorBarStyle),V.push(t)):y.y<=r.bottom&&(t=n.drawLine(y.x-g,y.y,y.x+g,y.y,"error-bar",this.errorBarStyle),V.push(t))}}}}),n.stroke=p,n.strokeWidth=f})}getPlotElement(t){if(this.hostElement&&t<this._pointIndexes.length){let i=null==this._errorBarEles[t]?[]:this._errorBarEles[t].slice();var e=this._pointIndexes[t];return e<this.hostElement.childNodes.length&&i.push(this.hostElement.childNodes[e]),i}return null}};export var QuartileCalculation;!function(t){t[t.InclusiveMedian=0]="InclusiveMedian",t[t.ExclusiveMedian=1]="ExclusiveMedian"}(QuartileCalculation||(QuartileCalculation={}));export class BoxWhisker extends SeriesBase{constructor(t){super(),this._groupWidth=.8,this._gapWidth=.1,this._showInnerPoints=!1,this._showOutliers=!1,this._quartileCalculation=QuartileCalculation.InclusiveMedian,this._chartType=ChartType.Bar,this.rendering.addHandler(this._rendering,this),this.initialize(t)}_initProperties(t){t&&copy(this,t)}_clearValues(){super._clearValues()}get quartileCalculation(){return this._quartileCalculation}set quartileCalculation(t){(t=asEnum(t,QuartileCalculation,!0))!=this._quartileCalculation&&(this._quartileCalculation=t,this._invalidate())}get groupWidth(){return this._groupWidth}set groupWidth(t){t!=this._groupWidth&&t>=0&&t<=1&&(this._groupWidth=asNumber(t,!0),this._invalidate())}get gapWidth(){return this._gapWidth}set gapWidth(t){t!=this._gapWidth&&t>=0&&t<=1&&(this._gapWidth=asNumber(t,!0),this._invalidate())}get showMeanLine(){return this._showMeanLine}set showMeanLine(t){t!=this._showMeanLine&&(this._showMeanLine=asBoolean(t,!0),this._invalidate())}get meanLineStyle(){return this._meanLineStyle}set meanLineStyle(t){t!=this._meanLineStyle&&(this._meanLineStyle=t,this._invalidate())}get showMeanMarker(){return this._showMeanMarker}set showMeanMarker(t){t!=this._showMeanMarker&&(this._showMeanMarker=asBoolean(t,!0),this._invalidate())}get meanMarkerStyle(){return this._meanMarkerStyle}set meanMarkerStyle(t){t!=this._meanMarkerStyle&&(this._meanMarkerStyle=t,this._invalidate())}get showInnerPoints(){return this._showInnerPoints}set showInnerPoints(t){t!=this._showInnerPoints&&(this._showInnerPoints=asBoolean(t,!0),this._invalidate())}get showOutliers(){return this._showOutliers}set showOutliers(t){t!=this._showOutliers&&(this._showOutliers=asBoolean(t,!0),this._invalidate())}_rendering(t,e){e.cancel=!0;var i,r,s=this,a=s.chart,n=(s.chart,s._getAxisX()),l=s._getAxisY(),h=e.index,u=e.count,o=e.engine,_=this._plotter,c=a.series.indexOf(s),m=asType(s,SeriesBase),d=this.quartileCalculation,g=this.showOutliers,p=this.groupWidth,f=(null==this.gapWidth?.2:this.gapWidth)/2;h=h||0;var x=p/(u=u||1),y=s.getValues(0),v=s.getValues(1);if(!y)return;if(v||(v=_.dataInfo.getXVals()),v){var M=_.dataInfo.getDeltaX();M>0&&(p*=M,x*=M)}var S=m._getSymbolFill(c),w=m._getAltSymbolFill(c)||S,V=m._getSymbolStroke(c),b=m._getAltSymbolStroke(c)||V,L=y.length;null!=v&&(L=Math.min(L,v.length));var P,E,T=0,B=0;let X=_.getItemFormatter(s);if(_.rotated){(T=n.origin||T)<n.actualMin?T=n.actualMin:T>n.actualMax&&(T=n.actualMax);n.convert(T);var H=l.actualMin,A=l.actualMax;for(I=0;I<L;I++){D=v?v[I]:I;if(null==(k=y[I])||0===k.length)return;if(_._getSymbolOrigin&&l.convert(_._getSymbolOrigin(T,I)),_._getSymbolStyles)S=(F=_._getSymbolStyles(I))&&F.fill?F.fill:S,w=F&&F.fill?F.fill:w,V=F&&F.stroke?F.fill:V,b=F&&F.stroke?F.fill:b;if(P=k[0]>0?S:w,E=k[0]>0?V:b,o.fill=P,o.stroke=E,_DataInfo.isValid(D)&&isArray(k)&&k.length>0&&_DataInfo.isValid(k[0])){var q=D-.5*p+h*x,Y=D-.5*p+(h+1)*x;if(Y-=Q=(Y-q)*f,(q+=Q)<H&&Y<H||q>A&&Y>A)continue;q=l.convert(q),Y=l.convert(Y);j=new _BoxPlot(k,d,g),K={min:n.convert(j.min),max:n.convert(j.max),firstQuartile:n.convert(j.firstQuartile),median:n.convert(j.median),thirdQuartile:n.convert(j.thirdQuartile),mean:n.convert(j.mean),outlierPoints:this._convertPoints(j.outlierPoints,n),innerPoints:this._convertPoints(j.innerPoints,n)},U=new Rect(Math.min(K.min,K.max),Math.min(q,Y),Math.abs(K.max-K.min),Math.abs(Y-q)),J=new _RectArea(U);var C={min:Math.min(q,Y),median:(q+Y)/2,max:Math.max(Y,q)};if(X)o.startGroup(),(G=new HitTestInfo(a,new Point((K.min+K.max)/2,C.median),ChartElement.SeriesSymbol))._setData(s,I),X(o,G,()=>{this._drawBoxWhisker(o,K,C,i,r,s),i=K,r=C}),o.endGroup();else this._drawBoxWhisker(o,K,C,i,r,s),i=K,r=C;s._setPointIndex(I,B),B++,(z=new _DataPoint(c,I,k,D)).item=j,J.tag=z,_.hitTester.add(J,c),j.outlierPoints&&j.outlierPoints.length&&j.outlierPoints.forEach((t,e)=>{let i=K.outlierPoints[e],r=new _CircleArea(new Point(i,U.top+U.height/2),2);r.tag=z,_.hitTester.add(r,c)})}}}else{(T=l.origin||T)<l.actualMin?T=l.actualMin:T>l.actualMax&&(T=l.actualMax);l.convert(T);for(var O=n.actualMin,N=n.actualMax,I=0;I<L;I++){var k,F,D=v?v[I]:I;if(null==(k=y[I])||0===k.length)return;if(_._getSymbolOrigin&&l.convert(_._getSymbolOrigin(T,I,L)),_._getSymbolStyles)S=(F=_._getSymbolStyles(I,L))&&F.fill?F.fill:S,w=F&&F.fill?F.fill:w,V=F&&F.stroke?F.stroke:V,b=F&&F.stroke?F.stroke:b;if(P=k[0]>0?S:w,E=k[0]>0?V:b,o.fill=P,o.stroke=E,_DataInfo.isValid(D)&&isArray(k)&&k.length>0&&_DataInfo.isValid(k[0])){var Q,W=D-.5*p+h*x,R=D-.5*p+(h+1)*x;if(R-=Q=(R-W)*f,(W+=Q)<O&&R<O||W>N&&R>N)continue;if(W=n.convert(W),R=n.convert(R),!_DataInfo.isValid(W)||!_DataInfo.isValid(R))continue;var G,z,j=new _BoxPlot(k,d,g),K={min:l.convert(j.min),max:l.convert(j.max),firstQuartile:l.convert(j.firstQuartile),median:l.convert(j.median),thirdQuartile:l.convert(j.thirdQuartile),mean:l.convert(j.mean),outlierPoints:this._convertPoints(j.outlierPoints,l),innerPoints:this._convertPoints(j.innerPoints,l)},U=new Rect(Math.min(W,R),Math.min(K.min,K.max),Math.abs(R-W),Math.abs(K.max-K.min)),J=new _RectArea(U),Z={min:Math.min(W,R),median:(W+R)/2,max:Math.max(W,R)};if(X)o.startGroup(),(G=new HitTestInfo(a,new Point(Z.median,(K.min+K.max)/2),ChartElement.SeriesSymbol))._setData(s,I),X(o,G,()=>{this._drawBoxWhisker(o,Z,K,i,r,s),i=Z,r=K}),o.endGroup();else this._drawBoxWhisker(o,Z,K,i,r,s),i=Z,r=K;s._setPointIndex(I,B),B++,(z=new _DataPoint(c,I,D,k)).item=j,J.tag=z,_.hitTester.add(J,c),j.outlierPoints&&j.outlierPoints.length&&j.outlierPoints.forEach((t,e)=>{let i=K.outlierPoints[e],r=new _CircleArea(new Point(U.left+U.width/2,i),2);r.tag=z,_.hitTester.add(r,c)})}}}}_convertPoints(t,e){return t.map(t=>e.convert(t))}_drawBoxWhisker(t,e,i,r,s,a){var n=a.symbolStyle,l=this.showInnerPoints,h=this.showOutliers,u=this.showMeanLine,o=this.meanLineStyle,_=this.showMeanMarker,c=this.meanMarkerStyle,m=this._plotter;if(t.startGroup("box-plot"),m.rotated){if(t.drawLine(e.min,(i.min+i.median)/2,e.min,(i.max+i.median)/2,null,n),t.drawLine(e.min,i.median,e.firstQuartile,i.median,null,n),t.drawRect(Math.min(e.firstQuartile,e.thirdQuartile),Math.min(i.min,i.max),Math.abs(e.thirdQuartile-e.firstQuartile),Math.abs(i.max-i.min),null,n),t.drawLine(e.median,i.min,e.median,i.max,null,n),t.drawLine(e.max,i.median,e.thirdQuartile,i.median,null,n),t.drawLine(e.max,(i.min+i.median)/2,e.max,(i.max+i.median)/2,null,n),u&&r&&s&&t.drawLine(e.mean,i.median,r.mean,s.median,"box-whisker-mean-line",o||n),_){var d=Math.abs(i.median-i.min)/2;t.drawLine(e.mean-d,i.median-d,e.mean+d,i.median+d,null,c||n),t.drawLine(e.mean+d,i.median-d,e.mean-d,i.median+d,null,c||n)}h&&e.outlierPoints.forEach(e=>{t.drawPieSegment(e,i.median,2,0,2*Math.PI,null,n)}),l&&e.innerPoints.forEach(e=>{t.drawPieSegment(e,i.median,2,0,2*Math.PI,null,n)})}else{if(t.drawLine((e.min+e.median)/2,i.min,(e.max+e.median)/2,i.min,null,n),t.drawLine(e.median,i.min,e.median,i.firstQuartile,null,n),t.drawRect(Math.min(e.min,e.max),Math.min(i.firstQuartile,i.thirdQuartile),Math.abs(e.max-e.min),Math.abs(i.thirdQuartile-i.firstQuartile),null,n),t.drawLine(e.min,i.median,e.max,i.median,null,n),t.drawLine(e.median,i.max,e.median,i.thirdQuartile,null,n),t.drawLine((e.min+e.median)/2,i.max,(e.max+e.median)/2,i.max,null,n),u&&r&&s&&t.drawLine(e.median,i.mean,r.median,s.mean,"box-whisker-mean-line",o||n),_){d=Math.abs(e.median-e.min)/2;t.drawLine(e.median-d,i.mean-d,e.median+d,i.mean+d,null,c||n),t.drawLine(e.median-d,i.mean+d,e.median+d,i.mean-d,null,c||n)}h&&i.outlierPoints.forEach(i=>{t.drawPieSegment(e.median,i,2,0,2*Math.PI,null,n)}),l&&i.innerPoints.forEach(i=>{t.drawPieSegment(e.median,i,2,0,2*Math.PI,null,n)})}t.endGroup()}_renderLabels(t,e,i,r){var s=this,a=this._plotter,n=e.length,l=i.dataLabel,h=l.border,u=l.offset,o=l.connectingLine,_="dataY";a.rotated&&(_="dataX"),void 0===u&&(u=o?16:0),h&&(u-=2);let c=[];for(var m=0;m<n;m++){var d=e[m],g=d.tag,p=asType(g,_DataPoint,!0);if(p&&-1==c.indexOf(p)){c.push(p);var f=g.item,x=g.y;if(g[_]=f.min,g.yfmt=f.min,g.y=f.min,this._plotter._renderLabel(t,d,p,i,l,s,u,r),g[_]=f.firstQuartile,g.yfmt=f.firstQuartile,g.y=f.firstQuartile,this._plotter._renderLabel(t,d,p,i,l,s,u,r),g[_]=f.median,g.yfmt=f.median,g.y=f.median,this._plotter._renderLabel(t,d,p,i,l,s,u,r),g[_]=f.thirdQuartile,g.yfmt=f.thirdQuartile,g.y=f.thirdQuartile,this._plotter._renderLabel(t,d,p,i,l,s,u,r),g[_]=f.max,g.yfmt=f.max,g.y=f.max,this._plotter._renderLabel(t,d,p,i,l,s,u,r),this.showMeanMarker){let e=Number(f.mean.toFixed(2));g[_]=e,g.yfmt=e,g.y=e,this._plotter._renderLabel(t,d,p,i,l,s,u,r)}f.showOutliers&&f.outlierPoints&&f.outlierPoints.forEach(e=>{g[_]=e,g.yfmt=e,g.y=e,this._plotter._renderLabel(t,d,p,i,l,s,u,r)}),g.y=x}}}};export class _BoxPlot{constructor(t,e,i){this._outlierPoints=[],this._innerPoints=[],this._data=t,this._quartileCalculation=e,this._showOutliers=i,this._parse()}get showOutliers(){return this._showOutliers}get min(){return this._min}get max(){return this._max}get mean(){return this._mean}get firstQuartile(){return this._firstQuartile}get thirdQuartile(){return this._thirdQuartile}get median(){return this._median}get outlierPoints(){return this._outlierPoints}get innerPoints(){return this._innerPoints}_parse(){var t=this._data.length,e=this._data,i=0;this._outlierPoints=[],this._innerPoints=[],e.sort((t,e)=>t-e),e.some(t=>null!=t&&(this._min=t,!0)),this._max=null==e[t-1]?0:e[t-1],this._quartileCalculation===QuartileCalculation.InclusiveMedian?(this._firstQuartile=this._quartileInc(e,.25),this._median=this._quartileInc(e,.5),this._thirdQuartile=this._quartileInc(e,.75)):(this._firstQuartile=this._quartileExc(e,.25),this._median=this._quartileExc(e,.5),this._thirdQuartile=this._quartileExc(e,.75)),this._iqr=1.5*Math.abs(this._thirdQuartile-this._firstQuartile);var r=this._firstQuartile-this._iqr,s=this._thirdQuartile+this._iqr;if(this._showOutliers){var a=this._max;this._max=this._min,this._min=a,this._data.forEach(t=>{i+=t,t<r||t>s?this._outlierPoints.push(t):(t<this._min&&(this._min=t),t>this._max&&(this._max=t))})}else i=this._data.reduce((t,e)=>t+e,0);this._innerPoints=this._data.filter(t=>{if(t>this._min&&t<this._max)return!0}),this._mean=i/t}_quartileInc(t,e){var i,r,s,a,n=t.length;return 1===n?t[0]:(a=(i=(n-1)*e+1)-(r=Math.floor(i)),(s=t[r-1])+(t[r]-s)*a)}_quartileExc(t,e){var i,r,s,a,n=t.length;return 1===n?t[0]:2===n?t[Math.round(e)]:(n+1)%4==0?t[(n+1)*e]:(a=(i=(n+1)*e)-(r=Math.floor(i)),(s=t[r-1])+(t[r]-s)*a)}};_registerModule("wijmo.chart.analytics",selfModule);