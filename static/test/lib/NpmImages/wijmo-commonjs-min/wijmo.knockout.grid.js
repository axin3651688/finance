/*!
    *
    * Wijmo Library 5.20191.603
    * http://wijmo.com/
    *
    * Copyright(c) GrapeCity, Inc.  All rights reserved.
    *
    * Licensed under the GrapeCity Commercial License.
    * sales@wijmo.com
    * wijmo.com/products/wijmo-5/license/
    *
    */

"use strict";var __extends=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(e,o)};return function(e,o){function r(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(r.prototype=o.prototype,new r)}}();Object.defineProperty(exports,"__esModule",{value:!0});var wijmo_knockout_base_1=require("wijmo/wijmo.knockout.base"),mKo=require("knockout"),wjcGrid=require("wijmo/wijmo.grid"),wjKo=mKo,wjFlexGrid=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype._getControlConstructor=function(){return wjcGrid.FlexGrid},e.prototype._createWijmoContext=function(){return new WjFlexGridContext(this)},e.prototype._initialize=function(){t.prototype._initialize.call(this),wijmo_knockout_base_1.MetaFactory.findProp("itemFormatter",this._metaData.props).updateControl=this._formatterPropHandler},e.prototype._formatterPropHandler=function(t,e,o,r,n){return r!==t._userFormatter&&(t._userFormatter=r,o.invalidate()),!0},e._columnTemplateProp="_wjkoColumnTemplate",e._cellClonedTemplateProp="__wjkoClonedTempl",e._cellVMProp="__wjkoCellVM",e._templColIdx="_wjkoTemplColIdx",e._columnStyleBinding="wjStyle",e._columnStyleProp="__wjkoStyle",e}(wijmo_knockout_base_1.WjBinding);exports.wjFlexGrid=wjFlexGrid;var WjFlexGridContext=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._wrapperFormatter=e._itemFormatter.bind(e),e}return __extends(e,t),e.prototype._initControl=function(){t.prototype._initControl.call(this),this.control.itemFormatter=this._wrapperFormatter},e.prototype._itemFormatter=function(t,e,o,r){var n=t.columns[o],i=n[wjFlexGrid._columnTemplateProp],l=n[wjFlexGrid._columnStyleProp];if((i||l)&&t.cellType==wjcGrid.CellType.Cell){var u=t.grid.editRange;if(u&&u.row===e&&u.col===o)return;if(t.rows[e]instanceof wjcGrid.GroupRow)return;var a=r[wjFlexGrid._cellVMProp],p=r[wjFlexGrid._cellClonedTemplateProp],c=t.rows[e].dataItem;if(a&&r[wjFlexGrid._templColIdx]!=o&&(r[wjFlexGrid._cellVMProp]=r[wjFlexGrid._cellClonedTemplateProp]=r[wjFlexGrid._templColIdx]=a=p=null,wjKo.cleanNode(r)),a)p&&(r.innerHTML="",r.appendChild(p)),a.$row(e),a.$col(o),a.$item()!=c?a.$item(c):a.$item.valueHasMutated();else{a={$row:wjKo.observable(e),$col:wjKo.observable(o),$item:wjKo.observable(c)};var s=this.bindingContext.extend(a);if(i){r.innerHTML="<div>"+i+"</div>";var d=r.childNodes[0];r[wjFlexGrid._cellClonedTemplateProp]=d}else r.setAttribute("data-bind","style:"+l);r[wjFlexGrid._cellVMProp]=a,r[wjFlexGrid._templColIdx]=o,wjKo.applyBindings(s,r)}var _=r.scrollHeight;t.rows[e].renderHeight<_&&(t.rows.defaultSize=_)}else this._userFormatter&&this._userFormatter(t,e,o,r)},e}(wijmo_knockout_base_1.WjContext);exports.WjFlexGridContext=WjFlexGridContext;var wjFlexGridColumn=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype._getControlConstructor=function(){return wjcGrid.Column},e.prototype._createControl=function(t){return new wjcGrid.Column},e.prototype._createWijmoContext=function(){return new WjFlexGridColumnContext(this)},e}(wijmo_knockout_base_1.WjBinding);exports.wjFlexGridColumn=wjFlexGridColumn;var WjFlexGridColumnContext=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype._initControl=function(){var e=this.parentWjContext;if(e){var o=e.control;o.autoGenerateColumns&&(o.autoGenerateColumns=!1,o.columns.clear())}t.prototype._initControl.call(this);var r=this.element.innerHTML.trim();this.control[wjFlexGrid._columnTemplateProp]=r;var n=this.allBindings.get(wjFlexGrid._columnStyleBinding);n&&(this.control[wjFlexGrid._columnStyleProp]=n.trim()),(r||n)&&this.control._setFlag(wjcGrid.RowColFlags.HasTemplate,!0),this.element.innerHTML=""},e}(wijmo_knockout_base_1.WjContext);exports.WjFlexGridColumnContext=WjFlexGridColumnContext;var wjStyle=function(){function t(){this.preprocess=function(e,o,r){return t.quoteString(e)},this.init=function(){}}return t.quoteString=function(t){return null==t?t:"'"+t.replace(/'/g,"\\'")+"'"},t.unquoteString=function(t){return!t||t.length<2?t:("'"===t.charAt(0)&&(t=t.substr(1,t.length-1)),t.replace(/\\\'/g,"'"))},t}();exports.wjStyle=wjStyle,wjKo.bindingHandlers[wjFlexGrid._columnStyleBinding]=new wjStyle,wjKo.bindingHandlers.wjFlexGrid=new wjFlexGrid,wjKo.bindingHandlers.wjFlexGridColumn=new wjFlexGridColumn;