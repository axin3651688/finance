/*!
    *
    * Wijmo Library 5.20191.603
    * http://wijmo.com/
    *
    * Copyright(c) GrapeCity, Inc.  All rights reserved.
    *
    * Licensed under the GrapeCity Commercial License.
    * sales@wijmo.com
    * wijmo.com/products/wijmo-5/license/
    *
    */

"use strict";var __extends=this&&this.__extends||function(){var e=function(o,l){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,o){e.__proto__=o}||function(e,o){for(var l in o)o.hasOwnProperty(l)&&(e[l]=o[l])})(o,l)};return function(o,l){function t(){this.constructor=o}e(o,l),o.prototype=null===l?Object.create(l):(t.prototype=l.prototype,new t)}}();Object.defineProperty(exports,"__esModule",{value:!0});var wijmo_1=require("wijmo/wijmo"),wijmo_grid_1=require("wijmo/wijmo.grid"),mXlsx=require("wijmo/wijmo.xlsx"),selfModule=require("wijmo/wijmo.grid.xlsx");function softDetail(){return wijmo_1._getModule("wijmo.grid.detail")}function softMultiRow(){return wijmo_1._getModule("wijmo.grid.multirow")}exports.softDetail=softDetail,exports.softMultiRow=softMultiRow;var FlexGridXlsxConverter=function(){function e(){}return e.save=function(e,o,l){var t=this._saveFlexGridToWorkbook(e,o);return l&&t.save(l),t},e.saveAsync=function(e,o,l,t,r){var n=this._saveFlexGridToWorkbook(e,o);return l&&n.saveAsync(l,t,r),n},e.load=function(e,o,l){var t=this;if(o instanceof Blob){var r=new FileReader;r.onload=function(){var o=mXlsx.Workbook._base64EncArr(new Uint8Array(r.result)),n=new mXlsx.Workbook;n.load(o),o=null,e.deferUpdate(function(){t._loadToFlexGrid(e,n,l),n=null})},r.readAsArrayBuffer(o)}else if(o instanceof mXlsx.Workbook)e.deferUpdate(function(){t._loadToFlexGrid(e,o,l),o=null});else{if(o instanceof ArrayBuffer)o=mXlsx.Workbook._base64EncArr(new Uint8Array(o));else if(!wijmo_1.isString(o))throw"Invalid workbook.";var n=new mXlsx.Workbook;n.load(o),o=null,e.deferUpdate(function(){t._loadToFlexGrid(e,n,l),n=null})}},e.loadAsync=function(e,o,l,t,r){var n=this;if(o instanceof Blob){var s=new FileReader;s.onload=function(){var o=mXlsx.Workbook._base64EncArr(new Uint8Array(s.result)),i=new mXlsx.Workbook;i.loadAsync(o,function(r){o=null,i=null,e.deferUpdate(function(){n._loadToFlexGrid(e,r,l),t&&t(r),r=null})},r)},s.readAsArrayBuffer(o)}else if(o instanceof mXlsx.Workbook)e.deferUpdate(function(){n._loadToFlexGrid(e,o,l),t&&t(o),o=null});else{if(o instanceof ArrayBuffer)o=mXlsx.Workbook._base64EncArr(new Uint8Array(o));else if(!wijmo_1.isString(o))throw"Invalid workbook.";(new mXlsx.Workbook).loadAsync(o,function(r){o=null,e.deferUpdate(function(){n._loadToFlexGrid(e,r,l),t&&t(r),r=null})},r)}},e._saveFlexGridToWorkbook=function(e,o){var l,t,r,n,s,i,a,d,u,m,c,f,h,w,p=new mXlsx.Workbook,g=new mXlsx.WorkSheet,_=(new mXlsx.WorkbookStyle,new mXlsx.WorkbookFrozenPane),x=!o||null==o.includeColumnHeaders||o.includeColumnHeaders,y=!(!o||null==o.includeRowHeaders)&&o.includeRowHeaders,b=!o||null==o.includeCellStyles||o.includeCellStyles,C=o?o.activeWorksheet:null,v=o?o.includeColumns:null,k=o?o.formatItem:null,S=0,j=0,R=0,T=[];if(null==this.hasCssText&&(this.hasCssText="cssText"in document.body.style),m=e.wj_sheetInfo,g.name=o?o.sheetName:"",g.visible=!o||!1!==o.sheetVisible,m&&m.tables&&m.tables.length>0)for(var W=0;W<m.tables.length;W++)g.tables.push(m.tables[W]);if(i=[],m||!b&&!k||((c=document.createElement("div")).style.visibility="hidden",c.setAttribute(wijmo_grid_1.FlexGrid._WJS_MEASURE,"true"),e.hostElement.appendChild(c)),y){for(d=0,a=0;a<e.rowHeaders.rows.length;a++)if(!(e.rowHeaders.rows[a].renderSize<=0)){for(i[d]=[],u=0;u<e.rowHeaders.columns.length;u++)r=e._getBindingColumn(e.rowHeaders,a,e.rowHeaders.columns[u]),(n=this._getColumnSetting(r,u,e.columnHeaders.columns))&&(i[d][u]=n,0===d&&((s=new mXlsx.WorkbookColumn)._deserialize(n),g._addWorkbookColumn(s,u)));d++}R=u}if(e.columnHeaders.rows.length>0){for(d=0,a=0;a<e.columnHeaders.rows.length;a++)if(!(e.columnHeaders.rows[a].renderSize<=0)){for(i[d]||(i[d]=[]),u=0;u<e.columnHeaders.columns.length;u++)r=e._getBindingColumn(e.columnHeaders,a,e.columnHeaders.columns[u]),(n=this._getColumnSetting(r,u,e.columnHeaders.columns))&&(i[d][R+u]=n,0===d&&(v&&!v(r)||((s=new mXlsx.WorkbookColumn)._deserialize(n),g._addWorkbookColumn(s,R+u))));x&&(R=0,l={},t=new mXlsx.WorkbookRow,y&&(R=this._parseFlexGridRowToSheetRow(e.topLeftCells,l,a,0,i,b,c,T,!1,0,v,k)),this._parseFlexGridRowToSheetRow(e.columnHeaders,l,a,R,i,b,c,T,!1,0,v,k),l.cells.length>0&&(t._deserialize(l),g._addWorkbookRow(t,d))),d++}j=x?d:0}for(a=0;a<e.cells.rows.length;a++)R=0,l={},t=new mXlsx.WorkbookRow,(f=e.rows[a])instanceof wijmo_grid_1._NewRowTemplate||((h=f instanceof wijmo_grid_1.GroupRow)?S=wijmo_1.tryCast(f,wijmo_grid_1.GroupRow).level:e.rows.maxGroupLevel>-1&&(S=e.rows.maxGroupLevel+1),y&&(R=this._parseFlexGridRowToSheetRow(e.rowHeaders,l,a,0,i,b,c,T,h,S,v,k)),this._parseFlexGridRowToSheetRow(e.cells,l,a,R,i,b,c,T,h,S,v,k),l.cells.length>0&&(t._deserialize(l),g._addWorkbookRow(t,j+a)));for(w=e.cells.rows.length,a=0;a<e.columnFooters.rows.length;a++)R=0,l={},t=new mXlsx.WorkbookRow,h=(f=e.columnFooters.rows[a])instanceof wijmo_grid_1.GroupRow,y&&(R=this._parseFlexGridRowToSheetRow(e.rowHeaders,l,a,0,i,b,c,T,h,0,v,k)),this._parseFlexGridRowToSheetRow(e.columnFooters,l,a,R,i,b,c,T,h,0,v,k),l.cells.length>0&&(t._deserialize(l),g._addWorkbookRow(t,j+w+a));return _.rows=x?e.frozenRows+j:e.frozenRows,_.columns=y?e.frozenColumns+R:e.frozenColumns,g.frozenPane=_,p._addWorkSheet(g),m||!b&&!k||(e.hostElement.removeChild(c),T.forEach(function(e){return e.forEach(function(e){e&&e.parentElement&&e.parentElement.removeChild(e)})})),p.activeWorksheet=C,p},e._loadToFlexGrid=function(e,o,l){var t,r,n,s,i,a,d,u,m,c,f,h,w,p,g,_,x,y,b,C,v,k,S,j,R,T,W,X,A,F,D,B,H=!l||null==l.includeColumnHeaders||l.includeColumnHeaders,N=!l||null==l.includeColumnHeaders||l.includeColumnHeaders,E=l&&null!=l.sheetIndex&&!isNaN(l.sheetIndex)?l.sheetIndex:0,I=l?l.sheetName:null,G=!l||l.sheetVisible,M=null!=e.wj_sheetInfo,z=0,O=0,L=!1,P={};if(e.itemsSource=null,e.columns.clear(),e.rows.clear(),e.frozenColumns=0,e.frozenRows=0,T={},W=[],O=0,n=[],X=[],E<0||E>=o.sheets.length)throw"The sheet index option is out of the sheet range of current workbook.";if(null!=I)for(t=0;t<o.sheets.length;t++)if(I===o.sheets[t].name){f=o.sheets[t];break}if(null!=(f=f||o.sheets[E]).rows){for(H&&(O=1,f.rows.length<=1&&(N=!1,O=0),d=f.rows[0]),w=this._getColumnCount(f.rows),h=this._getRowCount(f.rows,w),y=f.summaryBelow,r=f.columns,z=0;z<w;z++)e.columns.push(new wijmo_grid_1.Column),r[z]&&(isNaN(+r[z].width)||(e.columns[z].width=+r[z].width),r[z].visible||null==r[z].visible||(e.columns[z].visible=!!r[z].visible),r[z].style&&r[z].style.wordWrap&&(e.columns[z].wordWrap=r[z].style.wordWrap));for(;O<h;O++){if(p=!1,B=null,c=f.rows[O])for(_=O+1;_<f.rows.length;){if(x=f.rows[_]){(isNaN(c.groupLevel)&&!isNaN(x.groupLevel)||!isNaN(c.groupLevel)&&c.groupLevel<x.groupLevel)&&(p=!0);break}_++}for(p&&!y?(C&&(C.isCollapsed=L),(C=new wijmo_grid_1.GroupRow).isReadOnly=!1,L=null!=c.collapsed&&c.collapsed,C.level=isNaN(c.groupLevel)?0:c.groupLevel,P[C.level]=L,this._checkParentCollapsed(P,C.level)&&C._setFlag(wijmo_grid_1.RowColFlags.ParentCollapsed,!0),e.rows.push(C)):(b=new wijmo_grid_1.Row,c&&this._checkParentCollapsed(P,c.groupLevel)&&b._setFlag(wijmo_grid_1.RowColFlags.ParentCollapsed,!0),e.rows.push(b)),c&&c.height&&!isNaN(c.height)&&(e.rows[N?O-1:O].height=c.height),z=0;z<w;z++)if(c){if((S=(g=c.cells[z])?g.formula:null)&&"="!==S[0]&&(S="="+S),g&&g.textRuns&&g.textRuns.length>0?(e.rows[N?O-1:O].isContentHtml=!0,e.setCellData(N?O-1:O,z,this._parseTextRunsToHTML(g.textRuns))):e.setCellData(N?O-1:O,z,S&&M?S:this._getItemValue(g)),p||this._setColumn(n,z,g),j=O*w+z,R=g?g.style:null,A=mXlsx.Workbook._parseExcelFormat(g),R){if(B=null==B?!!R.wordWrap:B&&!!R.wordWrap,F=this._getItemType(g),R.hAlign)D=mXlsx.Workbook._parseHAlignToString(wijmo_1.asEnum(R.hAlign,mXlsx.HAlign));else switch(F){case wijmo_1.DataType.Number:D="right";break;case wijmo_1.DataType.Boolean:D="center";break;default:D=A&&0===A.search(/[n,c,p]/i)?"right":"left"}T[j]={fontWeight:R.font&&R.font.bold?"bold":"none",fontStyle:R.font&&R.font.italic?"italic":"none",textDecoration:R.font&&R.font.underline?"underline":"none",textAlign:D,fontFamily:R.font&&R.font.family?R.font.family:"",fontSize:R.font&&R.font.size?R.font.size+"px":"",color:R.font&&R.font.color?R.font.color:"",backgroundColor:R.fill&&R.fill.color?R.fill.color:"",whiteSpace:R.wordWrap?"pre-wrap":"normal",format:A},R.borders&&(R.borders.left&&(this._parseBorderStyle(R.borders.left.style,"Left",T[j]),T[j].borderLeftColor=R.borders.left.color),R.borders.right&&(this._parseBorderStyle(R.borders.right.style,"Right",T[j]),T[j].borderRightColor=R.borders.right.color),R.borders.top&&(this._parseBorderStyle(R.borders.top.style,"Top",T[j]),T[j].borderTopColor=R.borders.top.color),R.borders.bottom&&(this._parseBorderStyle(R.borders.bottom.style,"Bottom",T[j]),T[j].borderBottomColor=R.borders.bottom.color)),R.font&&-1===X.indexOf(R.font.family)&&X.push(R.font.family)}g&&wijmo_1.isNumber(g.rowSpan)&&g.rowSpan>0&&wijmo_1.isNumber(g.colSpan)&&g.colSpan>0&&(g.rowSpan>1||g.colSpan>1)&&W.push(new wijmo_grid_1.CellRange(O,z,O+g.rowSpan-1,z+g.colSpan-1))}c&&(this._checkParentCollapsed(P,c.groupLevel)||c.visible||null==c.visible||(e.rows[N?O-1:O].visible=c.visible),e.rows[N?O-1:O].wordWrap=!!c.style&&!!c.style.wordWrap||!!B)}for(C&&(C.isCollapsed=L),f.frozenPane&&(v=f.frozenPane.columns,wijmo_1.isNumber(v)&&!isNaN(v)&&(e.frozenColumns=v),k=f.frozenPane.rows,wijmo_1.isNumber(k)&&!isNaN(k)&&(e.frozenRows=N&&k>0?k-1:k)),z=0;z<e.columnHeaders.columns.length;z++)s=n[z],(i=e.columns[z]).isRequired=!1,N&&((u=d?d.cells[z]:null)&&u.value?(m=mXlsx.Workbook._parseExcelFormat(u),a=wijmo_1.Globalize.format(u.value,m)):a=""),i.header=a,s&&(s.dataType===wijmo_1.DataType.Boolean&&(i.dataType=s.dataType),i.format=s.format,i.align=s.hAlign,i.wordWrap=i.wordWrap||!!s.wordWrap);M&&(e.wj_sheetInfo.name=f.name,e.wj_sheetInfo.visible=!0===G||!1!==f.visible,e.wj_sheetInfo.styledCells=T,e.wj_sheetInfo.mergedRanges=W,e.wj_sheetInfo.fonts=X,e.wj_sheetInfo.tables=f.tables)}},e._parseFlexGridRowToSheetRow=function(e,o,l,t,r,n,s,i,a,d,u,m){var c,f,h,w,p,g,_,x,y,b,C,v,k,S,j,R,T,W,X,A,F,D,B,H,N,E,I,G,M,z,O=!1,L=!1;for((X=(c=e.grid).wj_sheetInfo)&&(A=X.evaluateFormula),null==(f=e.rows[l]).recordIndex?(H=0,e.cellType===wijmo_grid_1.CellType.ColumnHeader&&e.rows.length>1&&(H=l===r.length?l-1:l)):H=f.recordIndex,o.cells||(o.cells=[]),o.visible=f.isVisible,o.height=f.renderHeight||e.rows.defaultSize,o.groupLevel=d,a&&(o.collapsed=f.isCollapsed),f.wordWrap&&(o.style={wordWrap:f.wordWrap}),(f.constructor===wijmo_grid_1.Row||f.constructor===wijmo_grid_1._NewRowTemplate||softDetail()&&f.constructor===softDetail().DetailRow||softMultiRow()&&f.constructor===softMultiRow()._MultiRow)&&(O=!0),softDetail()&&f.constructor===softDetail().DetailRow&&(L=!0),w=0;w<e.columns.length;w++)if(p=null,W=1,T=1,M=0,B=!1,j=null,I=null,E=null,x=null,D=c._getBindingColumn(e,l,e.columns[w]),R=null,X&&e===c.cells?(S=l*e.columns.length+w,X.mergedRanges&&(R=this._getMergedRange(l,w,X.mergedRanges)),X.styledCells&&(j=X.styledCells[S])):n&&(E=this._getMeasureCell(e,w,s,i),j=(R=c.getMergedRange(e,l,w,!1))?this._getCellStyle(e,E,R.bottomRow,R.rightCol)||{}:this._getCellStyle(e,E,l,w)||{}),R||(R=c.getMergedRange(e,l,w,!1)),R?l===R.topRow&&w===R.leftCol&&(T=R.bottomRow-R.topRow+1,W=this._getColSpan(e,R,u),B=!0):B=!0,!u||u(D)){if(h=r[H]?r[H][w+t]:null,O||a?(_=B?e.getCellData(l,w,!0):null,y=B?e.getCellData(l,w,!1):null,C=!1,k=null,_&&wijmo_1.isString(_)&&_.length>1&&"="===_[0]&&(C=!0),F=wijmo_1.isDate(y),j&&j.format&&null!=y?(p=j.format,/[hsmyt\:]/i.test(p)&&(F=!0),g=mXlsx.Workbook._parseCellFormat(j.format,F)):h&&h.style&&h.style.format?(p=D.format,g=h.style.format):g=null,C&&null!=A&&wijmo_1.isFunction(A)&&(k=A(_)),g||(F?g="m/d/yyyy":wijmo_1.isNumber(y)&&!D.dataMap?g=wijmo_1.isInt(y)?"#,##0":"#,##0.00":C?(v=_.toLowerCase()).indexOf("now()")>-1?(g="m/d/yyyy h:mm",F=!0):v.indexOf("today()")>-1||v.indexOf("date(")>-1?(g="m/d/yyyy",F=!0):v.indexOf("time(")>-1&&(g="h:mm AM/PM",F=!0):g="General")):(_=B?c.columnHeaders.getCellData(0,w,!0):null,g="General"),wijmo_1.isString(_)&&-1!==_.indexOf("<span")&&(x=this._parseToTextRuns(_),_=null),I=this._parseCellStyle(j)||{},e===c.cells&&a&&f.hasChildren&&w===c.columns.firstVisibleIndex){if(C&&null!=k?b=k:_?b=_:B&&(b=f.getGroupHeader().replace(/<\/?\w+>/g,"").replace(/&#39;/g,"'")),null==b&&!j)continue;!(F=wijmo_1.isDate(b))&&p&&"d"===p.toLowerCase()&&wijmo_1.isInt(b)&&(g="0"),b=wijmo_1.isString(b)?mXlsx.Workbook._unescapeXML(b):b,w===c.columns.firstVisibleIndex&&c.treeIndent&&(M=d),N={value:b,isDate:F,formula:C?this._parseToExcelFormula(_,F):null,colSpan:W,rowSpan:T,style:this._extend(I,{format:g,font:{bold:!0},hAlign:mXlsx.HAlign.Left,indent:M}),textRuns:x}}else _=wijmo_1.isString(_)?mXlsx.Workbook._unescapeXML(_):_,y=wijmo_1.isString(y)?mXlsx.Workbook._unescapeXML(y):y,!F&&p&&"d"===p.toLowerCase()&&wijmo_1.isInt(y)&&(g="0"),G=I&&I.hAlign?I.hAlign:h&&h.style&&null!=h.style.hAlign?wijmo_1.asEnum(h.style.hAlign,mXlsx.HAlign,!0):wijmo_1.isDate(y)?mXlsx.HAlign.Left:mXlsx.HAlign.General,w!==c.columns.firstVisibleIndex||!c.treeIndent||G!==mXlsx.HAlign.Left&&G!==mXlsx.HAlign.General||(M=d),N={value:C?k:"General"===g?_:y,isDate:F,formula:C?this._parseToExcelFormula(_,F):null,colSpan:w<c.columns.firstVisibleIndex?1:W,rowSpan:T,style:this._extend(I,{format:g,hAlign:G,vAlign:T>1?e===c.cells||!1===c.centerHeadersVertically?mXlsx.VAlign.Top:mXlsx.VAlign.Center:null,indent:M}),textRuns:x},L&&(z=e.getCellElement(l,w))&&z.appendChild(f.detail);m&&m(new XlsxFormatItemEventArgs(e,new wijmo_grid_1.CellRange(l,w),E,s,i,N)),o.cells.push(N)}return t+w},e._parseCellStyle=function(e,o){if(void 0===o&&(o=!1),null==e)return null;var l=e.fontSize;l=l?+l.substring(0,l.indexOf("px")):null,isNaN(l)&&(l=null);var t=e.fontWeight;t="bold"===t||+t>=700;var r="italic"===e.fontStyle,n=e.textDecorationStyle;null==n&&(n=e.textDecoration),n="underline"===n;var s=e.whiteSpace;return s=!!s&&s.indexOf("pre")>-1,{font:{bold:t,italic:r,underline:n,family:this._parseToExcelFontFamily(e.fontFamily),size:l,color:e.color},fill:{color:e.backgroundColor},borders:this._parseBorder(e,o),hAlign:mXlsx.Workbook._parseStringToHAlign(e.textAlign),wordWrap:s}},e._parseBorder=function(e,o){var l={};return l.left=this._parseEgdeBorder(e,"Left"),l.right=this._parseEgdeBorder(e,"Right"),l.top=this._parseEgdeBorder(e,"Top"),l.bottom=this._parseEgdeBorder(e,"Bottom"),o&&(l.vertical=this._parseEgdeBorder(e,"Vertical"),l.horizontal=this._parseEgdeBorder(e,"Horizontal")),l},e._parseEgdeBorder=function(e,o){var l,t=e["border"+o+"Style"],r=e["border"+o+"Width"];if(r&&r.length>2&&(r=+r.substring(0,r.length-2)),t&&"none"!==t&&"hidden"!==t){switch(l={},t=t.toLowerCase()){case"dotted":l.style=r>1?mXlsx.BorderStyle.MediumDashDotted:mXlsx.BorderStyle.Dotted;break;case"dashed":l.style=r>1?mXlsx.BorderStyle.MediumDashed:mXlsx.BorderStyle.Dashed;break;case"double":l.style=mXlsx.BorderStyle.Double;break;default:l.style=r>2?mXlsx.BorderStyle.Thick:r>1?mXlsx.BorderStyle.Medium:mXlsx.BorderStyle.Thin}l.color=e["border"+o+"Color"]}return l},e._parseBorderStyle=function(e,o,l){var t="border"+o+"Style",r="border"+o+"Width";switch(e){case mXlsx.BorderStyle.Dotted:case mXlsx.BorderStyle.Hair:l[t]="dotted",l[r]="1px";break;case mXlsx.BorderStyle.Dashed:case mXlsx.BorderStyle.ThinDashDotDotted:case mXlsx.BorderStyle.ThinDashDotted:l[t]="dashed",l[r]="1px";break;case mXlsx.BorderStyle.MediumDashed:case mXlsx.BorderStyle.MediumDashDotDotted:case mXlsx.BorderStyle.MediumDashDotted:case mXlsx.BorderStyle.SlantedMediumDashDotted:l[t]="dashed",l[r]="2px";break;case mXlsx.BorderStyle.Double:l[t]="double",l[r]="3px";break;case mXlsx.BorderStyle.Medium:l[t]="solid",l[r]="2px";break;default:l[t]="solid",l[r]="1px"}},e._parseToExcelFontFamily=function(e){var o;return e&&(o=e.split(","))&&o.length>0&&(e=o[0].replace(/\"|\'/g,"")),e},e._parseToExcelFormula=function(e,o){var l,t,r,n,s,i,a,d=/\"?\w+\"?\s*\,\s*\"(\w+)\"/i;if(l=e.match(/(floor|ceiling)\([+-]?\d+\.?\d*\)/gi))for(s=0;s<l.length;s++)a=(i=l[s]).substring(0,i.lastIndexOf(")"))+", 1)",e=e.replace(i,a);if(l=null,l=e.match(/text\(\"?\w+\"?\s*\,\s*\"\w+\"\)/gi))for(s=0;s<l.length;s++)(t=(i=l[s]).match(d))&&2===t.length&&(r=t[1],/^d{1,4}?$/.test(r)||(n=mXlsx.Workbook._parseCellFormat(r,o),a=i.replace(r,n),e=e.replace(i,a)));return e},e._parseToTextRuns=function(e){var o,l,t,r=e.split("<span "),n=[];for(o=0;o<r.length;o++)t=-1!==(l=r[o]).indexOf("</span>")?{text:l.substring(l.indexOf(">")+1,l.indexOf("</span>")),font:this._parseToTextRunFont(l.substring(l.indexOf('style="')+7,l.indexOf(';"')))}:{text:l},n.push(t);return n},e._parseToTextRunFont=function(e){var o,l,t,r,n,s,i,a,d,u=e.split(";");if(u.length>0){for(o=0;o<u.length;o++)if(2===(l=u[o].split(":")).length)switch(l[1]=l[1].trim(),l[0]){case"font-size":s=+l[1].substring(0,l[1].indexOf("px")),isNaN(s)&&(s=null);break;case"font-weight":t="bold"===l[1]||+l[1]>=700;break;case"font-style":r="italic"===l[1];break;case"text-decoration-style":case"text-decoration":n="underline"===l[1];break;case"font-family":i=this._parseToExcelFontFamily(l[1]);break;case"color":a=l[1]}d={bold:t,italic:r,underline:n,family:i,size:s,color:a}}return d},e._getMeasureCell=function(e,o,l,t){var r=t[e.cellType],n=r&&r[o],s=null==n;if(n){if(this.hasCssText){n.style;n.style.cssText="",n.style.visibility="hidden"}}else r||(t[e.cellType]=r=[]),r[o]=n=l.cloneNode();return!s&&n.parentElement||(e.hostElement.children.length>0?e.hostElement.children[0].appendChild(n):e.hostElement.appendChild(n)),n},e._getColumnSetting=function(e,o,l){return null!=e.colspan&&(e=this._getRenderColumn(o,l)),e?{autoWidth:!0,width:e.renderWidth||l.defaultSize,visible:e.visible,style:{format:e.format?mXlsx.Workbook._parseCellFormat(e.format,e.dataType===wijmo_1.DataType.Date):"",hAlign:mXlsx.Workbook._parseStringToHAlign(this._toExcelHAlign(e.getAlignment())),wordWrap:e.wordWrap}}:null},e._toExcelHAlign=function(e){return(e=e?e.trim().toLowerCase():e)?e.indexOf("center")>-1?"center":e.indexOf("right")>-1||e.indexOf("end")>-1?"right":e.indexOf("justify")>-1?"justify":"left":e},e._getColumnCount=function(e){for(var o,l=0,t=0,r=0;r<e.length;r++)(o=e[r]&&e[r].cells?e[r].cells:[])&&o.length>0&&(t=o.length,wijmo_1.isInt(o[t-1].colSpan)&&o[t-1].colSpan>1&&(t=t+o[t-1].colSpan-1),t>l&&(l=t));return l},e._getRowCount=function(e,o){for(var l,t,r=e.length,n=r-1,s=0;s<o;s++)e:for(;n>=0;n--)if((t=((l=e[n])&&l.cells?l.cells:[])[s])&&(null!=t.value&&""!==t.value||wijmo_1.isInt(t.rowSpan)&&t.rowSpan>1)){wijmo_1.isInt(t.rowSpan)&&t.rowSpan>1&&n+t.rowSpan>r&&(r=n+t.rowSpan);break e}return r},e._numAlpha=function(e){var o=Math.floor(e/26)-1;return(o>-1?this._numAlpha(o):"")+String.fromCharCode(65+e%26)},e._getItemType=function(e){return null==e||null==e.value||isNaN(e.value)?null:wijmo_1.getType(e.value)},e._setColumn=function(e,o,l){var t,r,n,s=e[o];s?(t=this._getItemType(l),s.dataType!==t&&s.dataType===wijmo_1.DataType.Boolean&&t!==wijmo_1.DataType.Boolean&&(s.dataType=t),!l||null==l.value||wijmo_1.isString(l.value)&&wijmo_1.isNullOrWhiteSpace(l.value)||(r=mXlsx.Workbook._parseExcelFormat(l))&&s.format!==r&&"General"!==r&&(s.format=r),l&&l.style&&(l.style.hAlign&&(n=mXlsx.Workbook._parseHAlignToString(wijmo_1.asEnum(l.style.hAlign,mXlsx.HAlign))),null==s.wordWrap?s.wordWrap=!!l.style.wordWrap:s.wordWrap=s.wordWrap&&!!l.style.wordWrap),n||t!==wijmo_1.DataType.Number||(n="right"),s.hAlign=n):e[o]={dataType:this._getItemType(l),format:mXlsx.Workbook._parseExcelFormat(l),hAlign:"",wordWrap:null}},e._getItemValue=function(e){if(null==e||null==e.value)return null;var o=e.value;return wijmo_1.isNumber(o)&&isNaN(o)?"":o instanceof Date&&isNaN(o.getTime())?"":o},e._getCellStyle=function(e,o,l,t){try{e.grid.cellFactory.updateCell(e,l,t,o),o.className=o.className.replace("wj-state-selected",""),o.className=o.className.replace("wj-state-multi-selected","")}catch(e){return null}return window.getComputedStyle(o)},e._parseTextRunsToHTML=function(e){var o,l,t,r;for(t="",r=0;r<e.length;r++)t+=(l=(o=e[r]).font)?'<span style="'+(l.bold?"font-weight: bold;":"")+(l.italic?"font-style: italic;":"")+(l.underline?"text-decoration: underline;":"")+(l.family?"font-family: "+l.family+";":"")+(null!=l.size?"font-size: "+l.size+"px;":"")+(l.color?"color: "+l.color+";":"")+'">'+o.text+"</span>":o.text;return t},e._extend=function(e,o){for(var l in o){var t=o[l];wijmo_1.isObject(t)&&e[l]?wijmo_1.copy(e[l],t):e[l]=t}return e},e._checkParentCollapsed=function(e,o){var l=!1;return Object.keys(e).forEach(function(t){!0===e[t]&&!1===l&&!isNaN(o)&&+t<o&&(l=!0)}),l},e._getColSpan=function(e,o,l){for(var t=0,r=o.leftCol;r<=o.rightCol;r++)l&&!l(e.columns[r])||t++;return t},e._getRenderColumn=function(e,o){return e>=o.length?null:o[e]},e._getMergedRange=function(e,o,l){var t,r;for(t=0;t<l.length;t++)if(e>=(r=l[t]).topRow&&e<=r.bottomRow&&o>=r.leftCol&&o<=r.rightCol)return r;return null},e}();exports.FlexGridXlsxConverter=FlexGridXlsxConverter;var XlsxFormatItemEventArgs=function(e){function o(o,l,t,r,n,s){var i=e.call(this,o,l)||this;return i._cell=t,i._patternCell=r,i._xlsxCell=s,i._cellsCache=n,i}return __extends(o,e),Object.defineProperty(o.prototype,"cell",{get:function(){return this._cell},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"xlsxCell",{get:function(){return this._xlsxCell},set:function(e){this._xlsxCell=e},enumerable:!0,configurable:!0}),o.prototype.getFormattedCell=function(){return this._cell||(this._cell=FlexGridXlsxConverter._getMeasureCell(this.panel,this.col,this._patternCell,this._cellsCache),FlexGridXlsxConverter._getCellStyle(this.panel,this._cell,this.row,this.col)),this._cell},o}(wijmo_grid_1.CellRangeEventArgs);exports.XlsxFormatItemEventArgs=XlsxFormatItemEventArgs,wijmo_1._registerModule("wijmo.grid.xlsx",selfModule);