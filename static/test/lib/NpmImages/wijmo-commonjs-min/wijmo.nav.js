/*!
    *
    * Wijmo Library 5.20191.603
    * http://wijmo.com/
    *
    * Copyright(c) GrapeCity, Inc.  All rights reserved.
    *
    * Licensed under the GrapeCity Commercial License.
    * sales@wijmo.com
    * wijmo.com/products/wijmo-5/license/
    *
    */

"use strict";var __extends=this&&this.__extends||function(){var e=function(t,i){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(t,i)};return function(t,i){function n(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();Object.defineProperty(exports,"__esModule",{value:!0});var wijmo_1=require("wijmo/wijmo"),selfModule=require("wijmo/wijmo.nav"),TabPanel=function(e){function t(t,i,n){var o=e.call(this,t,null,!0)||this;o._tabs=new wijmo_1.ObservableArray,o._selectedIndex=-1,o._animated=!0,o._autoSwitch=!0,o.selectedIndexChanged=new wijmo_1.Event;var r=o.hostElement,s=[];if(!n)for(;r.firstElementChild;){var a=r.firstElementChild;r.removeChild(a),s.push(a)}var l=o.getTemplate();return o.applyTemplate("wj-control wj-tabpanel",l,{_dRoot:"root",_dTabHeaders:"tabheaders",_dTabPanes:"tabpanes"}),r.tabIndex=-1,o._dRoot.tabIndex=o._dTabHeaders.tabIndex=o._dTabPanes.tabIndex=-1,o.addEventListener(r,"click",o._click.bind(o)),o.addEventListener(r,"keydown",o._keydown.bind(o)),o._tabs.collectionChanged.addHandler(o._populateControl.bind(o)),o.tabs.deferUpdate(function(){s.forEach(function(e){wijmo_1.assert(2==e.childElementCount,"TabPanel children should contain header and pane elements"),o.tabs.push(new Tab(e.children[0],e.children[1]))})}),o.initialize(i),o.selectedIndex<0&&o.tabs.length?o.selectedIndex=0:o.onSelectedIndexChanged(),o}return __extends(t,e),Object.defineProperty(t.prototype,"tabs",{get:function(){return this._tabs},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"selectedIndex",{get:function(){return this._selectedIndex},set:function(e){(e=wijmo_1.asInt(e,!1))!=this._selectedIndex?(this._selectedIndex=e,this._updateContent(),this.onSelectedIndexChanged()):this._updateContent()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"selectedTab",{get:function(){var e=this._selectedIndex;return e>-1?this._tabs[e]:null},set:function(e){for(var t=-1,i=0;i<this._tabs.length&&t<0;i++)this._tabs[i]==e&&(t=i);this.selectedIndex=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isAnimated",{get:function(){return this._animated},set:function(e){this._animated=wijmo_1.asBoolean(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"autoSwitch",{get:function(){return this._autoSwitch},set:function(e){e!=this._autoSwitch&&(this._autoSwitch=wijmo_1.asBoolean(e),this._updateContent())},enumerable:!0,configurable:!0}),t.prototype.getTab=function(e){for(var t=0;t<this._tabs.length;t++){if((i=this._tabs[t]).header.id==e||i.pane.id==e)return i}for(t=0;t<this._tabs.length;t++){var i;if((i=this._tabs[t]).header.textContent==e)return i}return null},t.prototype.onSelectedIndexChanged=function(e){this.selectedIndexChanged.raise(this,e)},t.prototype._populateControl=function(){var e=this;this._removeChildren(this._dTabHeaders),this._removeChildren(this._dTabPanes);var t=-1;this._tabs.forEach(function(i,n){wijmo_1.assert(i instanceof Tab,"tabs array must contain Tab objects."),i._setPanel(e);var o=i.header,r=i.pane;wijmo_1.addClass(o,"wj-tabheader"),wijmo_1.setAttribute(o,"role","tab"),e._dTabHeaders.appendChild(o),wijmo_1.addClass(r,"wj-tabpane"),wijmo_1.setAttribute(r,"role","tabpanel"),wijmo_1.setAttribute(r,"aria-labelledby",o.id?o.id:null),e._dTabPanes.appendChild(r),t<0&&(wijmo_1.hasClass(o,"wj-state-active")||"true"==o.getAttribute("aria-selected"))&&(t=n)}),t<0&&this._tabs.length>0&&(t=0),t>-1?this.selectedIndex=t:this.selectedIndex>-1&&this.selectedIndex<this._tabs.length&&this._updateContent(),this._validateSelection()},t.prototype._validateSelection=function(){var e=this.selectedTab;if(e&&(e.isDisabled||!e.isVisible)){var t=this._getNextIndex(this.selectedIndex,1);t<0&&(t=this._getNextIndex(this.selectedIndex,-1)),this.selectedIndex=t}},t.prototype._updateContent=function(){var e=this,t=wijmo_1.contains(this._dTabHeaders,wijmo_1.getActiveElement()),i=this._dTabHeaders.children,n=this._dTabPanes.children,o=this._selectedIndex;if(o>-1&&o<n.length){var r=(d=n[o]).style;this.isAnimated?(r.opacity="0",this._toAnim&&clearInterval(this._toAnim),this._toAnim=wijmo_1.animate(function(t){1==t?(r.opacity="",e._toAnim=null):r.opacity=t.toString()})):r.opacity=""}for(var s=0;s<i.length;s++){var a=s==o,l=i[s],d=n[s];wijmo_1.setAttribute(l,"aria-selected",a),wijmo_1.toggleClass(l,"wj-state-active",a),wijmo_1.toggleClass(d,"wj-state-active",a),l.tabIndex=a||!this._autoSwitch?this._orgTabIndex:-1,a&&(t&&l.focus(),wijmo_1.Control._szObserver||wijmo_1.Control.invalidateAll(d))}},t.prototype._removeChildren=function(e){for(;e.firstChild;)e.removeChild(e.firstChild)},t.prototype._click=function(e){var t=this._getTabIndex(e.target);if(t>-1){var i=this._tabs[t];!i.isDisabled&&i.isVisible&&(this.selectedIndex=t)}},t.prototype._keydown=function(e){if(!e.defaultPrevented){var t=this._getTabIndex(wijmo_1.getActiveElement());if(t>-1){var i=this._getKeyCode(e);switch(i){case wijmo_1.Key.Left:case wijmo_1.Key.Up:case wijmo_1.Key.Right:case wijmo_1.Key.Down:case wijmo_1.Key.Home:case wijmo_1.Key.PageUp:case wijmo_1.Key.End:case wijmo_1.Key.PageDown:switch(i){case wijmo_1.Key.Left:case wijmo_1.Key.Up:t=this._getNextIndex(t,-1);break;case wijmo_1.Key.Right:case wijmo_1.Key.Down:t=this._getNextIndex(t,1);break;case wijmo_1.Key.Home:case wijmo_1.Key.PageUp:t=this._getNextIndex(-1,1);break;case wijmo_1.Key.End:case wijmo_1.Key.PageDown:t=this._getNextIndex(this._tabs.length,-1)}t>-1&&(this._autoSwitch?this.selectedIndex=t:this._tabs[t].header.focus()),e.preventDefault();break;case wijmo_1.Key.Enter:case wijmo_1.Key.Space:if(t>-1)this._tabs[t].header.click();e.preventDefault()}}}},t.prototype._getTabIndex=function(e){var t=wijmo_1.closest(e,".wj-tabheader");if(t&&wijmo_1.closest(t,".wj-tabpanel")==this.hostElement)for(var i=0;i<this._tabs.length;i++)if(this._tabs[i].header==t)return i;return-1},t.prototype._getNextIndex=function(e,t){for(var i=e+t;i>-1&&i<this._tabs.length;i+=t){var n=this._tabs[i];if(!n.isDisabled&&n.isVisible)return i}return-1},t.controlTemplate='<div wj-part="root"><div wj-part="tabheaders" class="wj-tabheaders" role="tablist"></div><div wj-part="tabpanes" class="wj-tabpanes"></div></div>',t}(wijmo_1.Control);exports.TabPanel=TabPanel;var Tab=function(){function e(e,t){this._hdr=wijmo_1.asType(wijmo_1.getElement(e),HTMLElement),this._pane=wijmo_1.asType(wijmo_1.getElement(t),HTMLElement)}return Object.defineProperty(e.prototype,"tabPanel",{get:function(){return this._p},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"header",{get:function(){return this._hdr},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pane",{get:function(){return this._pane},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isDisabled",{get:function(){return wijmo_1.hasClass(this._hdr,"wj-state-disabled")},set:function(e){wijmo_1.toggleClass(this._hdr,"wj-state-disabled",wijmo_1.asBoolean(e)),this._p&&this._p._validateSelection()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isVisible",{get:function(){return"none"!=this._hdr.style.display},set:function(e){this._hdr.style.display=wijmo_1.asBoolean(e)?"":"none",this._p&&this._p._validateSelection()},enumerable:!0,configurable:!0}),e.prototype._setParts=function(e,t){if(e=wijmo_1.asType(wijmo_1.getElement(e),HTMLElement),t=wijmo_1.asType(wijmo_1.getElement(t),HTMLElement,!1),this._hdr!==e||this._pane!==t){var i=this.isDisabled,n=this.isVisible;this._hdr=e,this._pane=t,this.isDisabled=i,this.isVisible=n;var o=this.tabPanel;o&&!o.tabs.isUpdating&&o._populateControl()}},e.prototype._setPanel=function(e){this._p=e},e}();exports.Tab=Tab;var FormatNodeEventArgs=function(e){function t(t,i,n){var o=e.call(this)||this;return o._data=t,o._e=wijmo_1.asType(i,HTMLElement),o._level=n,o}return __extends(t,e),Object.defineProperty(t.prototype,"dataItem",{get:function(){return this._data},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"element",{get:function(){return this._e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"level",{get:function(){return this._level},enumerable:!0,configurable:!0}),t}(wijmo_1.EventArgs);exports.FormatNodeEventArgs=FormatNodeEventArgs;var TreeNodeEventArgs=function(e){function t(t){var i=e.call(this)||this;return i._node=t,i}return __extends(t,e),Object.defineProperty(t.prototype,"node",{get:function(){return this._node},enumerable:!0,configurable:!0}),t}(wijmo_1.CancelEventArgs);exports.TreeNodeEventArgs=TreeNodeEventArgs;var DropPosition,TreeNodeDragDropEventArgs=function(e){function t(t,i,n){var o=e.call(this)||this;return o._src=wijmo_1.asType(t,TreeNode),o._tgt=wijmo_1.asType(i,TreeNode),o._pos=n,o}return __extends(t,e),Object.defineProperty(t.prototype,"dragSource",{get:function(){return this._src},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dropTarget",{get:function(){return this._tgt},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"position",{get:function(){return this._pos},set:function(e){this._pos=wijmo_1.asEnum(e,DropPosition)},enumerable:!0,configurable:!0}),t}(wijmo_1.CancelEventArgs);exports.TreeNodeDragDropEventArgs=TreeNodeDragDropEventArgs,function(e){e[e.Before=0]="Before",e[e.After=1]="After",e[e.Into=2]="Into"}(DropPosition=exports.DropPosition||(exports.DropPosition={}));var TreeNode=function(){function e(t,i){wijmo_1.hasClass(i,"wj-treeview")?(t=wijmo_1.Control.getControl(i),i=null):e._assertNode(i),this._t=t,this._e=i}return Object.defineProperty(e.prototype,"dataItem",{get:function(){return this._e[TreeView._DATAITEM_KEY]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"element",{get:function(){return this._e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"treeView",{get:function(){return this._t},enumerable:!0,configurable:!0}),e.prototype.ensureVisible=function(){for(var e=this.parentNode;e;e=e.parentNode)e.isCollapsed=!1;var t=this._t.hostElement,i=this.element.getBoundingClientRect(),n=t.getBoundingClientRect();i.bottom>n.bottom?t.scrollTop+=i.bottom-n.bottom:i.top<n.top&&(t.scrollTop-=n.top-i.top)},e.prototype.equals=function(e){return null!=e&&e.element==this.element},e.prototype.select=function(){var e=this._t,t=e._selNode;this.equals(t)||(t&&(wijmo_1.removeClass(t.element,TreeView._CSEL),wijmo_1.setAttribute(t.element,"aria-selected",!1)),e._selNode=this,wijmo_1.addClass(this.element,TreeView._CSEL),wijmo_1.setAttribute(this.element,"aria-selected",!0),this.ensureVisible(),e._updateFocus(t),e.onSelectedItemChanged())},Object.defineProperty(e.prototype,"index",{get:function(){for(var t=0,i=this._pse(this.element);i;i=this._pse(i))e._isNode(i)&&t++;return t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"parentNode",{get:function(){var t=null;if(this._e){var i=this._e.parentElement;e._assertNodeList(i),t=this._pse(i)}return t?new e(this._t,t):null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"level",{get:function(){for(var e=-1,t=this;t;t=t.parentNode)e++;return e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasChildren",{get:function(){return e._isNode(this._e)&&!e._isEmpty(this._e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasPendingChildren",{get:function(){return this.isCollapsed&&this.hasChildren&&!e._isNodeList(this.element.nextElementSibling)&&wijmo_1.isFunction(this._t.lazyLoadFunction)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"nodes",{get:function(){return this.hasChildren?e._getChildNodes(this._t,this._e.nextSibling):null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"checkBox",{get:function(){return this._e.querySelector("input."+TreeView._CNDC)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isCollapsed",{get:function(){return this.hasChildren&&wijmo_1.hasClass(this._e,TreeView._CCLD)},set:function(e){if(e!=this.isCollapsed){var t=this._t,i=new TreeNodeEventArgs(this);t.onIsCollapsedChanging(i)&&(this.setCollapsed(wijmo_1.asBoolean(e),t.isAnimated,t.autoCollapse),t.onIsCollapsedChanged(i))}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isChecked",{get:function(){var e=this.checkBox;return e&&!e.indeterminate?e.checked:null},set:function(e){if(e!=this.isChecked){var t=this._t,i=new TreeNodeEventArgs(this);t.onIsCheckedChanging(i)&&(this.setChecked(wijmo_1.asBoolean(e),!0),t.onIsCheckedChanged(i))}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isDisabled",{get:function(){return this._e&&null!=this._e.getAttribute("disabled")},set:function(e){(e=wijmo_1.asBoolean(e,!0))!=this.isDisabled&&wijmo_1.enable(this._e,!e)},enumerable:!0,configurable:!0}),e.prototype.previous=function(t,i){var n=this._pse(this._e);if(!n&&e._isNodeList(this._e.parentElement)&&(n=this._pse(this._e.parentElement)),e._isNodeList(n)){for(;e._isNodeList(n)&&n.childElementCount;)n=n.lastChild;e._isNodeList(n)&&(n=this._pse(n))}var o=e._isNode(n)?new e(this._t,n):null;return t&&o&&!o.element.offsetHeight&&(o=o.previous(t,i)),i&&o&&o.isDisabled&&(o=o.previous(t,i)),o},e.prototype.next=function(t,i){var n=this._e.nextSibling;if(e._isNodeList(n)&&(n=n.childElementCount?n.firstChild:n.nextSibling),!n)for(var o=this._e.parentElement;!n&&e._isNodeList(o);o=o.parentElement)n=o.nextSibling;var r=e._isNode(n)?new e(this._t,n):null;return t&&r&&!r.element.offsetHeight&&(r=r.next(t,i)),i&&r&&r.isDisabled&&(r=r.next(t,i)),r},e.prototype.previousSibling=function(){for(var t=this._pse(this.element);e._isNodeList(t);)t=this._pse(t);return t?new e(this._t,t):null},e.prototype.nextSibling=function(){var t=this.element.nextSibling;return e._isNodeList(t)&&(t=t.nextSibling),t?new e(this._t,t):null},e.prototype.setCollapsed=function(t,i,n){var o=this._t,r=this._e,s=this._e.nextElementSibling,a=e._isNodeList(s);if(wijmo_1.setAttribute(r,"aria-expanded",a?(!t).toString():null),t!=this.isCollapsed)if(t||a||!wijmo_1.isFunction(o.lazyLoadFunction)){if(null==i&&(i=o.isAnimated),null==n&&(n=o.autoCollapse),i){if(a){var l=s.offsetHeight,d=s.style,h=o.hostElement,c=h.style;h.scrollHeight<=h.clientHeight&&(c.overflowY="hidden"),t?(wijmo_1.toggleClass(r,TreeView._CCLG,!0),wijmo_1.animate(function(e){e<1?(e=1-e,d.height=(e*l).toFixed(0)+"px"):(d.height=d.opacity=c.overflowY="",wijmo_1.toggleClass(r,TreeView._CCLD,!0),wijmo_1.toggleClass(r,TreeView._CCLG,!1))},TreeView._AN_DLY)):(wijmo_1.toggleClass(r,TreeView._CCLD,!1),d.height=d.opacity="0",wijmo_1.animate(function(e){d.height=e>=1?d.opacity=c.overflowY="":(e*l).toFixed(0)+"px"},TreeView._AN_DLY))}}else wijmo_1.toggleClass(r,TreeView._CCLD,t);if(!t&&n){var _=r.parentElement;if(e._isNodeList(_))for(var u=0;u<_.children.length;u++){var p=_.children[u];p!=r&&e._isNode(p)&&(wijmo_1.toggleClass(p,TreeView._CCLD,!0),p.setAttribute("aria-expanded","false"))}}}else o._lazyLoadNode(this)},e.prototype.setChecked=function(e,t){var i=this.checkBox,n=i.checked!=e;i.checked=e,i.indeterminate=!1,this.hasChildren&&this.nodes.forEach(function(t){t.setChecked(e,!1)});var o=this._t;if(o&&o.checkedMemberPath&&o._chkPath.setValue(this.dataItem,this.level,e),t){var r=this.parentNode;r&&r._updateCheckedState()}o&&n&&o._raiseCheckedItemsChanged()},e.prototype.remove=function(){var t=this._t,i=this.parentNode,n=this._getArray(),o=n.indexOf(this.dataItem);t.selectedNode==this&&(t.selectedNode=this.nextSibling()||this.previousSibling()||i);var r=this.element.nextSibling;e._isNodeList(r)&&wijmo_1.removeChild(r),wijmo_1.removeChild(this.element),i&&i._updateState(),n.splice(o,1),this._t=null},e.prototype.addChildNode=function(e,t){var i=this._t._createNode(t),n=this.nodes;return n?e<n.length?i.move(n[e],DropPosition.Before):i.move(n[n.length-1],DropPosition.After):i.move(this,DropPosition.Into),i},e.prototype.refresh=function(e){var t=this._getArray();e&&(t[this.index]=e),e=t[this.index];var i=this._t._createNode(e),n=this.hasChildren&&!this.hasPendingChildren?this.element.nextSibling:null;n&&wijmo_1.removeChild(n),(n=i.hasChildren&&!i.hasPendingChildren?i.element.nextSibling:null)&&this.element.parentElement.insertBefore(n,this.element.nextSibling),this.element.innerHTML=i.element.innerHTML,this._updateState()},e.prototype.move=function(t,i){if(t instanceof e&&this._contains(t))return!1;var n=this.parentNode,o=this._getArray();this._moveElements(t,i);var r=this.parentNode,s=this._getArray();n&&n._updateState(),r&&r._updateState();var a=this.dataItem,l=o.indexOf(a);return o.splice(l,1),s.splice(this.index,0,a),t.treeView&&(this._t=t.treeView),!0},Object.defineProperty(e.prototype,"itemsSource",{get:function(){return this._getArray()},enumerable:!0,configurable:!0}),e.prototype._pse=function(e){return e.previousElementSibling},e.prototype._contains=function(e){for(;e;e=e.parentNode)if(e.element==this.element)return!0;return!1},e.prototype._getArray=function(){var e=this._t,t=this.parentNode,i=e.itemsSource;if(t){var n=e._itmPath;(i=n.getValue(t.dataItem,this.level))||(i=[],n.setValue(t.dataItem,this.level,i))}return i},e.prototype._moveElements=function(t,i){var n=document.createDocumentFragment(),o=this.hasChildren&&!this.hasPendingChildren?this.element.nextSibling:null;if(n.appendChild(this.element),o&&(e._assertNodeList(o),n.appendChild(o)),t instanceof TreeView)t._root.insertBefore(n,null);else{var r=t.element,s=r?r.parentElement:t.treeView._root;e._assertNodeList(s);var a=DropPosition;switch(i){case a.Before:s.insertBefore(n,r);break;case a.After:r=(t=t.nextSibling())?t.element:null,s.insertBefore(n,r);break;case a.Into:t.hasChildren&&!t.hasPendingChildren||(o=document.createElement("div"),wijmo_1.addClass(o,TreeView._CNDL),s.insertBefore(o,r.nextSibling)),s=t.element.nextSibling,e._assertNodeList(s),s.insertBefore(n,null)}}},e.prototype._updateState=function(){this._updateEmptyState(),this._updateCheckedState()},e.prototype._updateEmptyState=function(){var t=this.element.nextSibling,i=!1;e._isNodeList(t)&&(t.childElementCount?i=!0:wijmo_1.removeChild(t)),wijmo_1.toggleClass(this.element,TreeView._CEMP,!i),i||this.element.removeAttribute("aria-expanded")},e.prototype._updateCheckedState=function(){var e=this._t,t=this.checkBox,i=this.nodes,n=0,o=0;if(t&&i&&(i.forEach(function(e){switch(e.isChecked){case!0:n++;break;case!1:o++}}),n==i.length?(t.checked=!0,t.indeterminate=!1):o==i.length?(t.checked=!1,t.indeterminate=!1):(t.checked=!1,t.indeterminate=!0),e&&e.checkedMemberPath)){var r=t.indeterminate?null:t.checked;e._chkPath.setValue(this.dataItem,this.level,r)}var s=this.parentNode;s&&s._updateCheckedState()},e._getChildNodes=function(t,i){e._assertNodeList(i);var n=[];if(e._isNodeList(i))for(var o=i.children,r=0;r<o.length;r++){var s=o[r];e._isNode(s)&&n.push(new e(t,s))}return n},e._isNode=function(e){return e&&wijmo_1.hasClass(e,TreeView._CND)},e._isNodeList=function(e){return e&&wijmo_1.hasClass(e,TreeView._CNDL)},e._isEmpty=function(t){return e._isNode(t)&&wijmo_1.hasClass(t,TreeView._CEMP)},e._isCollapsed=function(t){return e._isNode(t)&&!e._isEmpty(t)&&wijmo_1.hasClass(t,TreeView._CCLD)},e._assertNode=function(t){wijmo_1.assert(e._isNode(t),"node expected")},e._assertNodeList=function(t){wijmo_1.assert(e._isNodeList(t),"nodeList expected")},e}();exports.TreeNode=TreeNode;var _BindingArray=function(){function e(e){this.path=e}return Object.defineProperty(e.prototype,"path",{get:function(){return this._path},set:function(e){if(this._path=e,wijmo_1.isString(e))this._bindings=[new wijmo_1.Binding(e)];else if(wijmo_1.isArray(e)){this._bindings=[];for(var t=0;t<e.length;t++)this._bindings.push(new wijmo_1.Binding(e[t]))}else null!=e&&wijmo_1.assert(!1,"Path should be a string or an array of strings.");this._maxLevel=this._bindings?this._bindings.length-1:-1},enumerable:!0,configurable:!0}),e.prototype.getValue=function(e,t){var i=Math.min(t,this._maxLevel);return i>-1?this._bindings[i].getValue(e):null},e.prototype.setValue=function(e,t,i){var n=Math.min(t,this._maxLevel);n>-1&&this._bindings[n].setValue(e,i)},e}();exports._BindingArray=_BindingArray;var TreeView=function(e){function t(i,n){var o=e.call(this,i)||this;o._itmPath=new _BindingArray("items"),o._chkPath=new _BindingArray,o._dspPath=new _BindingArray("header"),o._imgPath=new _BindingArray,o._html=!1,o._animated=!0,o._chkOnClick=!1,o._xpndOnClick=!0,o._xpdnOnLoad=!0,o._autoColl=!0,o._showChk=!1,o._srch="",o._isReadOnly=!0,o.itemsSourceChanged=new wijmo_1.Event,o.loadingItems=new wijmo_1.Event,o.loadedItems=new wijmo_1.Event,o.itemClicked=new wijmo_1.Event,o.selectedItemChanged=new wijmo_1.Event,o.checkedItemsChanged=new wijmo_1.Event,o.isCollapsedChanging=new wijmo_1.Event,o.isCollapsedChanged=new wijmo_1.Event,o.isCheckedChanging=new wijmo_1.Event,o.isCheckedChanged=new wijmo_1.Event,o.formatItem=new wijmo_1.Event(function(){o.invalidate()}),o.dragStart=new wijmo_1.Event,o.dragOver=new wijmo_1.Event,o.drop=new wijmo_1.Event,o.dragEnd=new wijmo_1.Event,o.nodeEditStarting=new wijmo_1.Event,o.nodeEditStarted=new wijmo_1.Event,o.nodeEditEnding=new wijmo_1.Event,o.nodeEditEnded=new wijmo_1.Event;var r=o.getTemplate();o.applyTemplate("wj-control wj-content wj-treeview",r,{_root:"root"});var s=o.hostElement;return wijmo_1.setAttribute(s,"role","tree",!0),wijmo_1.addClass(o._root,t._CNDL),wijmo_1.setAttribute(o._root,"role","group",!0),o.addEventListener(s,"mousedown",o._mousedown.bind(o)),o.addEventListener(s,"click",o._click.bind(o)),o.addEventListener(s,"keydown",o._keydown.bind(o)),o.addEventListener(s,"keypress",o._keypress.bind(o)),o.addEventListener(s,"wheel",function(e){s.scrollHeight>s.offsetHeight&&(e.deltaY<0&&0==s.scrollTop||e.deltaY>0&&s.scrollTop+s.offsetHeight>=s.scrollHeight)&&e.preventDefault()}),o.addEventListener(s,"blur",function(e){o._edtNode&&!wijmo_1.contains(o._edtNode.element,wijmo_1.getActiveElement())&&o.finishEditing()},!0),o.initialize(n),o.refresh(),o}return __extends(t,e),Object.defineProperty(t.prototype,"itemsSource",{get:function(){return this._items},set:function(e){this._items!=e&&(this._items=wijmo_1.asArray(e),this.onItemsSourceChanged(),this._reload())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"childItemsPath",{get:function(){return this._itmPath.path},set:function(e){e!=this.childItemsPath&&(this._itmPath.path=e,this._reload())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"displayMemberPath",{get:function(){return this._dspPath.path},set:function(e){e!=this.displayMemberPath&&(this._dspPath.path=e,this._reload())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"imageMemberPath",{get:function(){return this._imgPath.path},set:function(e){e!=this.imageMemberPath&&(this._imgPath.path=e,this._reload())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"checkedMemberPath",{get:function(){return this._chkPath.path},set:function(e){e!=this.checkedMemberPath&&(this._chkPath.path=e,this._reload())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isContentHtml",{get:function(){return this._html},set:function(e){e!=this._html&&(this._html=wijmo_1.asBoolean(e),this._reload())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"showCheckboxes",{get:function(){return this._showChk},set:function(e){e!=this._showChk&&(this._showChk=wijmo_1.asBoolean(e),this._reload())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"autoCollapse",{get:function(){return this._autoColl},set:function(e){this._autoColl=wijmo_1.asBoolean(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isAnimated",{get:function(){return this._animated},set:function(e){e!=this._animated&&(this._animated=wijmo_1.asBoolean(e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isReadOnly",{get:function(){return this._isReadOnly},set:function(e){this._isReadOnly=wijmo_1.asBoolean(e),wijmo_1.toggleClass(this.hostElement,"wj-state-readonly",this.isReadOnly)},enumerable:!0,configurable:!0}),t.prototype.startEditing=function(e){if(this.isReadOnly)return!1;if(e||(e=this.selectedNode),!e||e.isDisabled)return!1;if(!this.finishEditing())return!1;var i=e.element.querySelector("."+t._CNDT);if(!i)return!1;var n=new TreeNodeEventArgs(e);if(!this.onNodeEditStarting(n))return!1;i.tabIndex=0,i.focus(),i.contentEditable="true",i.style.cursor="auto";var o=document.createRange();o.selectNodeContents(i);var r=getSelection();return r.removeAllRanges(),r.addRange(o),i.focus(),wijmo_1.setAttribute(i,"autocomplete","off"),wijmo_1.setAttribute(i,"autocorrect","off"),this._edtNode=e,this.onNodeEditStarted(n),!0},t.prototype.finishEditing=function(e){var i=this._edtNode;if(i){var n=i.element.querySelector("."+t._CNDT);if(!n)return!1;var o=new TreeNodeEventArgs(i);if(!this.onNodeEditEnding(o))return!1;var r=i.dataItem,s=i.level;this.isContentHtml?e?n.innerHTML=this._dspPath.getValue(r,s):this._dspPath.setValue(r,s,n.innerHTML):e?n.textContent=this._dspPath.getValue(r,s):this._dspPath.setValue(r,s,n.textContent),document.createRange().selectNodeContents(n),getSelection().removeAllRanges(),n.contentEditable="false",n.style.cursor="",this._edtNode=null,this.onNodeEditEnded(o)}return!0},Object.defineProperty(t.prototype,"allowDragging",{get:function(){return null!=this._dd},set:function(e){if(e!=this.allowDragging){wijmo_1.asBoolean(e)?this._dd=new _TreeDragDropManager(this):(this._dd.dispose(),this._dd=null);for(var i=this.hostElement.querySelectorAll("."+t._CND),n=0;n<i.length;n++){var o=i[n];wijmo_1.setAttribute(o,"draggable",!!this._dd||null)}}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"checkOnClick",{get:function(){return this._chkOnClick},set:function(e){this._chkOnClick=wijmo_1.asBoolean(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"expandOnClick",{get:function(){return this._xpndOnClick},set:function(e){this._xpndOnClick=wijmo_1.asBoolean(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"expandOnLoad",{get:function(){return this._xpdnOnLoad},set:function(e){this._xpdnOnLoad=wijmo_1.asBoolean(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"selectedItem",{get:function(){return this._selNode?this._selNode.dataItem:null},set:function(e){e!=this.selectedItem&&(this.selectedNode=e?this.getNode(e):null)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"selectedNode",{get:function(){return this._selNode},set:function(e){if(e!=this.selectedNode)if(this._prevSel=this._selNode,e)e.select();else if(this._selNode){var i=this._selNode.element;wijmo_1.removeClass(i,t._CSEL),wijmo_1.setAttribute(i,"aria-selected",!1),this._selNode=null,this._updateFocus(this._prevSel),this.onSelectedItemChanged()}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"selectedPath",{get:function(){for(var e=[],t=this.selectedNode;t;t=t.parentNode){var i=this._dspPath.getValue(t.dataItem,t.level);e.splice(0,0,i)}return e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"checkedItems",{get:function(){if(null==this._chkItems){var e=t,i="."+e._CND+"."+e._CEMP+" > input:checked."+e._CNDC,n=this._root.querySelectorAll(i);this._chkItems=[];for(var o=0;o<n.length;o++){var r=n[o].parentElement[e._DATAITEM_KEY];this._chkItems.push(r)}}return this._chkItems},set:function(e){if(this.showCheckboxes)for(var i=t,n="."+i._CND+"."+i._CEMP,o=this._root.querySelectorAll(n),r=0;r<o.length;r++){var s=new TreeNode(this,o[r]),a=e.indexOf(s.dataItem)>-1;s.isChecked!=a&&(s.isChecked=a)}},enumerable:!0,configurable:!0}),t.prototype.checkAllItems=function(e){if(this.showCheckboxes)for(var i=t,n="."+i._CND+"."+i._CEMP,o=this._root.querySelectorAll(n),r=0;r<o.length;r++){var s=new TreeNode(this,o[r]);s.isChecked!=e&&(s.isChecked=e)}},Object.defineProperty(t.prototype,"totalItemCount",{get:function(){return this.hostElement.querySelectorAll("."+t._CND).length},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"lazyLoadFunction",{get:function(){return this._lazyLoad},set:function(e){e!=this._lazyLoad&&(this._lazyLoad=wijmo_1.asFunction(e),this._reload())},enumerable:!0,configurable:!0}),t.prototype.getFirstNode=function(e,i){var n=this.hostElement.querySelector("."+t._CND),o=n?new TreeNode(this,n):null;return e&&o&&!o.element.offsetHeight&&(o=o.next(e,i)),i&&o&&o.isDisabled&&(o=o.next(e,i)),o},t.prototype.getLastNode=function(e,i){var n=this.hostElement.querySelectorAll("."+t._CND+":last-child"),o=n.length?new TreeNode(this,n[n.length-1]):null;return e&&o&&!o.element.offsetHeight&&(o=o.previous(e,i)),i&&o&&o.isDisabled&&(o=o.previous(e,i)),o},Object.defineProperty(t.prototype,"nodes",{get:function(){return TreeNode._getChildNodes(this,this._root)},enumerable:!0,configurable:!0}),t.prototype.getNode=function(e){this._isDirty&&this._loadTree();for(var i=this.hostElement.querySelectorAll("."+t._CND),n=0;n<i.length;n++){var o=i[n];if(o[t._DATAITEM_KEY]==e)return new TreeNode(this,o)}return null},t.prototype.addChildNode=function(e,t){var i=this._createNode(t),n=this.nodes;return n?e<n.length?i.move(n[e],DropPosition.Before):i.move(n[n.length-1],DropPosition.After):i.move(this,DropPosition.Into),i},t.prototype.collapseToLevel=function(e){var t=this._animated,i=this._autoColl;this._animated=this._autoColl=!1,this._collapseToLevel(this.nodes,e,0),this._animated=t,this._autoColl=i},t.prototype.loadTree=function(e){this._loadTree(e)},t.prototype.onItemsSourceChanged=function(e){this.itemsSourceChanged.raise(this,e)},t.prototype.onLoadingItems=function(e){return this.loadingItems.raise(this,e),!e.cancel},t.prototype.onLoadedItems=function(e){this.loadedItems.raise(this,e)},t.prototype.onItemClicked=function(e){this.itemClicked.raise(this,e)},t.prototype.onSelectedItemChanged=function(e){this.selectedItemChanged.raise(this,e)},t.prototype.onCheckedItemsChanged=function(e){this._chkItems=null,this.checkedItemsChanged.raise(this,e)},t.prototype.onIsCollapsedChanging=function(e){return this.isCollapsedChanging.raise(this,e),!e.cancel},t.prototype.onIsCollapsedChanged=function(e){this.isCollapsedChanged.raise(this,e)},t.prototype.onIsCheckedChanging=function(e){return this.isCheckedChanging.raise(this,e),!e.cancel},t.prototype.onIsCheckedChanged=function(e){this.isCheckedChanged.raise(this,e)},t.prototype.onFormatItem=function(e){this.formatItem.raise(this,e)},t.prototype.onDragStart=function(e){return this.dragStart.raise(this,e),!e.cancel},t.prototype.onDragOver=function(e){return this.dragOver.raise(this,e),!e.cancel},t.prototype.onDrop=function(e){return this.drop.raise(this,e),!e.cancel},t.prototype.onDragEnd=function(e){this.dragEnd.raise(this,e)},t.prototype.onNodeEditStarting=function(e){return this.nodeEditStarting.raise(this,e),!e.cancel},t.prototype.onNodeEditStarted=function(e){this.nodeEditStarted.raise(this,e)},t.prototype.onNodeEditEnding=function(e){return this.nodeEditEnding.raise(this,e),!e.cancel},t.prototype.onNodeEditEnded=function(e){this.nodeEditEnded.raise(this,e)},t.prototype.refresh=function(t){void 0===t&&(t=!0),e.prototype.refresh.call(this,t),!this.isUpdating&&this._isDirty&&this._loadTree()},t.prototype._updateFocus=function(e){var t=this._selNode;t&&(t.element.tabIndex=this._orgTabIndex),this.hostElement.tabIndex=t?-1:this._orgTabIndex,this.containsFocus()&&(t?t.element.focus():this.hostElement.focus()),e&&(e.element.tabIndex=-1)},t.prototype._raiseCheckedItemsChanged=function(){var e=this;this._toItemsChanged&&clearTimeout(this._toItemsChanged),this._toItemsChanged=setTimeout(function(){e._toItemsChanged=null,e.onCheckedItemsChanged()},10)},t.prototype._reload=function(){this._isDirty=!0,this.invalidate()},t.prototype._createNode=function(e){return new t(document.createElement("div"),{expandOnLoad:this.expandOnLoad,childItemsPath:this.childItemsPath,displayMemberPath:this.displayMemberPath,imageMemberPath:this.imageMemberPath,isContentHtml:this.isContentHtml,showCheckboxes:this.showCheckboxes,itemsSource:[e]}).getFirstNode()},t.prototype._mousedown=function(e){if(!e.defaultPrevented){var i=wijmo_1.closest(e.target,"input."+t._CNDC),n=wijmo_1.closestClass(e.target,t._CND),o=n?new TreeNode(this,n):null;o&&!o.isDisabled&&(this.selectedNode=o),this._dnIndet=i&&i.indeterminate}},t.prototype._click=function(e){if(!e.defaultPrevented){var i=wijmo_1.closestClass(e.target,t._CND);if(i){var n=new TreeNode(this,i),o="input."+t._CNDC,r=wijmo_1.closest(e.target,o),s=i.getBoundingClientRect(),a=this.rightToLeft?s.right-e.clientX:e.clientX-s.left;if(n.isDisabled)return;if(!r&&n.equals(this._edtNode))return;if(!r&&this._chkOnClick&&(!n.hasChildren||a>i.offsetHeight)&&(r=i.querySelector(o)),i.focus(),r&&(e.preventDefault(),e.stopPropagation(),setTimeout(function(){r.indeterminate=!1,n.isChecked=!n.isChecked})),!r){var l=(e.ctrlKey||e.metaKey)&&!n.hasPendingChildren,d=!1;a<=i.offsetHeight?(l?this.collapseToLevel(n.isCollapsed?n.level+1:n.level):n.isCollapsed=!n.isCollapsed,d=!0):this.expandOnClick&&n.isCollapsed&&(l?this.collapseToLevel(n.level):n.isCollapsed=!1,d=!0),d&&l&&this.selectedNode&&this.selectedNode.ensureVisible(),d||this.isReadOnly||this.selectedNode&&this.selectedNode.equals(this._prevSel)&&this.startEditing()}this.selectedItem&&this.onItemClicked()}}},t.prototype._keydown=function(e){if(!e.defaultPrevented){var t=this._getKeyCode(e),i=this._selNode,n=void 0,o=!0;if(!i)switch(t){case wijmo_1.Key.Up:case wijmo_1.Key.Down:case wijmo_1.Key.Left:case wijmo_1.Key.Right:case wijmo_1.Key.Enter:case wijmo_1.Key.Home:case wijmo_1.Key.End:if(n=this.getFirstNode(!0,!0))return this.selectedNode=n,void e.preventDefault()}if(i&&!i.isDisabled){switch(t){case wijmo_1.Key.F2:this.startEditing(),e.preventDefault();break;case wijmo_1.Key.Escape:this.finishEditing(!0),e.preventDefault();break;case wijmo_1.Key.Up:case wijmo_1.Key.Down:this.finishEditing();break;case wijmo_1.Key.Enter:this._edtNode?(this.finishEditing(),t=wijmo_1.Key.Down):(this.startEditing(),e.preventDefault())}if(this._edtNode)return;if(this.rightToLeft)switch(t){case wijmo_1.Key.Left:t=wijmo_1.Key.Right;break;case wijmo_1.Key.Right:t=wijmo_1.Key.Left}switch(t){case wijmo_1.Key.Left:!i.isCollapsed&&i.hasChildren?i.isCollapsed=!0:(i=i.parentNode)&&i.select();break;case wijmo_1.Key.Right:i.isCollapsed&&i.hasChildren&&(i.isCollapsed=!1);break;case wijmo_1.Key.Up:n=i.previous(!0,!0);break;case wijmo_1.Key.Down:n=i.next(!0,!0);break;case wijmo_1.Key.Home:n=this.getFirstNode(!0,!0);break;case wijmo_1.Key.End:n=this.getLastNode(!0,!0);break;case wijmo_1.Key.Space:if(this.selectedItem){var r=i.checkBox;r&&(i.isChecked=!r.checked)}break;case wijmo_1.Key.Enter:this.selectedItem&&this.onItemClicked();break;default:o=!1}o&&(e.preventDefault(),n&&n.select())}}},t.prototype._keypress=function(e){var i=this;if(!e.defaultPrevented){if(e.ctrlKey||e.metaKey||e.altKey)return;if(e.target instanceof HTMLInputElement)return;if(this._edtNode)return;if(e.charCode>32&&this.startEditing(this.selectedNode)){var n=wijmo_1.getActiveElement();if(wijmo_1.contains(this._edtNode.element,n)){n.textContent=String.fromCharCode(e.charCode),e.preventDefault();var o=document.createRange();o.selectNodeContents(n),o.collapse(!1);var r=getSelection();r.removeAllRanges(),r.addRange(o)}return}if(e.charCode>32||32==e.charCode&&this._srch){e.preventDefault(),this._srch+=String.fromCharCode(e.charCode).toLowerCase(),this._toSrch&&clearTimeout(this._toSrch),this._toSrch=setTimeout(function(){i._toSrch=null,i._srch=""},t._AS_DLY);var s=this._findNext();null==s&&this._srch.length>1&&(this._srch=this._srch[this._srch.length-1],s=this._findNext()),null!=s&&(this.selectedItem=s)}}},t.prototype._findNext=function(){if(this.hostElement&&this.selectedItem){var e=this.getNode(this.selectedItem),t=e,i=!1,n=!1;for(1==this._srch.length&&(n=!0);t;){if(!t.isDisabled&&!n)if(0==t.element.textContent.trim().toLowerCase().indexOf(this._srch))return t.dataItem;var o=t.next(!0,!0);if(o==e&&i)break;o||i||(o=this.getFirstNode(!0,!0),i=!0),t=o,n=!1}}return null},t.prototype._loadTree=function(e){var i=this,n=this._root;if(n){if(!this.onLoadingItems(new wijmo_1.CancelEventArgs))return;this._isDirty=!1;var o=this.containsFocus(),r=this.selectedItem;this.selectedItem=null,this._chkItems=null,this._ldLvl=-1;var s=void 0;if(e&&wijmo_1.isFunction(window.Map)){s=new Map;for(var a=this.hostElement.querySelectorAll("."+t._CND),l=0;l<a.length;l++){var d=a[l];wijmo_1.hasClass(d,t._CCLD)&&s.set(d[t._DATAITEM_KEY],!0)}}if(n.innerHTML="",this._items&&this._items.forEach(function(e){i._addItem(n,0,e)}),s)for(a=this.hostElement.querySelectorAll("."+t._CND),l=0;l<a.length;l++){d=a[l];var h=TreeNode._isNodeList(d),c=s.get(d[t._DATAITEM_KEY]);wijmo_1.toggleClass(d,t._CCLD,1==c),wijmo_1.setAttribute(d,"aria-expanded",h?(!c).toString():null)}o&&!this.containsFocus()&&this.focus(),this.selectedItem=r,this.onLoadedItems(),this._ldLvl=-1}},t.prototype._addItem=function(e,i,n){var o,r=this._dspPath.getValue(n,i),s=this._imgPath.getValue(n,i),a=wijmo_1.asArray(this._itmPath.getValue(n,i),!0),l=document.createElement("div");wijmo_1.addClass(l,t._CND),l.tabIndex=-1,wijmo_1.setAttribute(l,"role","treeitem",!0),wijmo_1.setAttribute(l,"aria-selected",!1);var d=document.createElement("span");if(this.isContentHtml?d.innerHTML=r:d.textContent=r,wijmo_1.addClass(d,t._CNDT),l.appendChild(d),s){var h=document.createElement("img");h.src=s,l.insertBefore(h,l.firstChild)}if(this._showChk&&!this._lazyLoad&&((o=document.createElement("input")).type="checkbox",o.tabIndex=-1,wijmo_1.addClass(o,t._CNDC),l.insertBefore(o,l.firstChild)),this._dd&&l.setAttribute("draggable","true"),e.appendChild(l),l[t._DATAITEM_KEY]=n,a&&0==a.length&&!this.lazyLoadFunction&&(a=null),a){var c=this.expandOnLoad;if(i>this._ldLvl&&c?(this._ldLvl=i,0==a.length&&(c=!1,wijmo_1.addClass(l,t._CCLD))):(c=!1,wijmo_1.addClass(l,t._CCLD),i<this._ldLvl&&(this._ldLvl=100)),a.length>0){var _=document.createElement("div");_.tabIndex=-1,wijmo_1.addClass(_,t._CNDL);for(var u=0;u<a.length;u++)this._addItem(_,i+1,a[u]);e.appendChild(_),wijmo_1.setAttribute(l,"aria-expanded",c.toString(),!0),wijmo_1.setAttribute(_,"role","group",!0)}}else wijmo_1.addClass(l,t._CEMP);o&&this.checkedMemberPath&&(a&&a.length?new TreeNode(this,l)._updateCheckedState():o.checked=this._chkPath.getValue(n,i));this.formatItem.hasHandlers&&this.onFormatItem(new FormatNodeEventArgs(n,l,i))},t.prototype._collapseToLevel=function(e,t,i){for(var n=0;n<e.length;n++){var o=e[n];o.hasPendingChildren||(o.isCollapsed=i>=t,o.hasChildren&&this._collapseToLevel(o.nodes,t,i+1))}},t.prototype._lazyLoadNode=function(e){var i=this.hostElement;wijmo_1.hasClass(i,t._CLDG)||(wijmo_1.addClass(i,t._CLDG),wijmo_1.addClass(e.element,t._CLDG),this.lazyLoadFunction(e,this._lazyLoadCallback.bind(e)))},t.prototype._lazyLoadCallback=function(e){this.treeView._lazyLoadNodeDone(this,e)},t.prototype._lazyLoadNodeDone=function(e,i){var n=t;wijmo_1.removeClass(e.element,n._CLDG),wijmo_1.removeClass(this.hostElement,n._CLDG);var o=e.dataItem,r=e.level,s=wijmo_1.asArray(i,!0);if(null==s||0==s.length)this._itmPath.setValue(o,r,null),wijmo_1.addClass(e.element,n._CEMP);else if(s.length){this._itmPath.setValue(o,r,s);var a=document.createElement("div"),l=e.element;wijmo_1.addClass(a,n._CNDL),l.parentElement.insertBefore(a,l.nextSibling);for(var d=0;d<s.length;d++)this._addItem(a,r+1,s[d]);e.isCollapsed=!1}},t._DATAITEM_KEY="wj-Data-Item",t._AS_DLY=600,t._AN_DLY=200,t._CND="wj-node",t._CNDL="wj-nodelist",t._CEMP="wj-state-empty",t._CNDT="wj-node-text",t._CNDC="wj-node-check",t._CSEL="wj-state-selected",t._CCLD="wj-state-collapsed",t._CCLG="wj-state-collapsing",t._CLDG="wj-state-loading",t.controlTemplate='<div wj-part="root"></div>',t}(wijmo_1.Control);exports.TreeView=TreeView;var _TreeDragDropManager=function(){function e(e){this._tree=wijmo_1.asType(e,TreeView),this._dragstartBnd=this._dragstart.bind(this),this._dragoverBnd=this._dragover.bind(this),this._dropBnd=this._drop.bind(this),this._dragendBnd=this._dragend.bind(this);var t=this._tree,i=t.hostElement;t.addEventListener(i,"dragstart",this._dragstartBnd),t.addEventListener(i,"dragover",this._dragoverBnd),t.addEventListener(i,"dragleave",this._dragoverBnd),t.addEventListener(i,"drop",this._dropBnd),t.addEventListener(i,"dragend",this._dragendBnd),t.addEventListener(i,"keydown",this._keydown)}return e.prototype.dispose=function(){var e=this._tree,t=e.hostElement;e.removeEventListener(t,"dragstart",this._dragstartBnd),e.removeEventListener(t,"dragover",this._dragoverBnd),e.removeEventListener(t,"dragleave",this._dragoverBnd),e.removeEventListener(t,"drop",this._dropBnd),e.removeEventListener(t,"dragend",this._dragendBnd),e.removeEventListener(t,"keydown",this._keydown),this._showDragMarker()},e.prototype._dragstart=function(t){if(!t.defaultPrevented){var i=this._tree,n=wijmo_1.closestClass(t.target,TreeView._CND),o=e;if(o._drgSrc=TreeNode._isNode(n)?new TreeNode(i,n):null,o._drgSrc){var r=new TreeNodeEventArgs(o._drgSrc);i.onDragStart(r)||(o._drgSrc=null)}o._drgSrc&&t.dataTransfer?(wijmo_1._startDrag(t.dataTransfer,"copyMove"),t.stopPropagation()):t.preventDefault()}},e.prototype._dragover=function(e){this._handleDragDrop(e,!1)},e.prototype._drop=function(e){this._handleDragDrop(e,!0)},e.prototype._dragend=function(t){e._drgSrc=null,this._showDragMarker(),this._tree.onDragEnd()},e.prototype._keydown=function(e){e.defaultPrevented||e.keyCode==wijmo_1.Key.Escape&&this._dragendBnd(null)},e.prototype._handleDragDrop=function(t,i){var n,o,r=this._tree,s=e,a=DropPosition,l=a.Into;if(!t.defaultPrevented&&s._drgSrc){var d=document.elementFromPoint(t.clientX,t.clientY),h=wijmo_1.closestClass(d,TreeView._CND);if(null==h){var c=wijmo_1.Control.getControl(wijmo_1.closest(d,".wj-treeview"));c instanceof TreeView&&0==c.totalItemCount&&(h=c.hostElement)}if(h==s._drgSrc.element&&(h=null),h){o=h.getBoundingClientRect();var _=new TreeNode(r,h),u=_.hasPendingChildren?o.height/2:o.height/3;null==_.element?((o=wijmo_1.Rect.fromBoundingRect(o)).inflate(-12,-12),l=a.Before):t.clientY<o.top+u?l=a.Before:(t.clientY>o.bottom-u||_.hasPendingChildren)&&(l=a.After,!_.hasChildren||_.isCollapsed||_.hasPendingChildren||(l=a.Before,o=(h=(_=_.next(!0,!1)).element).getBoundingClientRect())),s._drgSrc._contains(_)?h=null:((n=new TreeNodeDragDropEventArgs(s._drgSrc,_,l)).cancel=s._drgSrc.treeView!=_.treeView,r.onDragOver(n)||(h=null))}if(h)if((l=n.position)==a.Before){var p=n.dragSource.next(!0,!1);p&&p.element==h&&(h=null)}else if(l==a.After){var m=n.dragSource.previous(!0,!1);m&&m.element==h&&(h=null)}if(h&&!i?(t.dataTransfer.dropEffect="move",t.preventDefault(),t.stopPropagation(),this._showDragMarker(o,l)):this._showDragMarker(),h&&i&&r.onDrop(n)){r.hostElement.focus();var f=n.dragSource;f.move(n.dropTarget,n.position),f.select()}}},e.prototype._showDragMarker=function(t,i){var n=this._tree,o=e._dMarker.parentElement;if(t){var r=n.hostElement.getBoundingClientRect(),s=i==DropPosition.After?t.bottom:t.top,a={top:Math.round(s-r.top+n.hostElement.scrollTop-2),width:"75%",height:i==DropPosition.Into?t.height:4,opacity:i==DropPosition.Into?"0.15":""};n.rightToLeft?a.right=Math.round(r.right-t.right):a.left=Math.round(t.left-r.left),wijmo_1.setCss(e._dMarker,a),o!=n._root&&n._root.appendChild(e._dMarker)}else o&&o.removeChild(e._dMarker)},e._dMarker="undefined"!=typeof window?wijmo_1.createElement('<div class="wj-marker">&nbsp;</div>'):null,e}();exports._TreeDragDropManager=_TreeDragDropManager,wijmo_1._registerModule("wijmo.nav",selfModule);