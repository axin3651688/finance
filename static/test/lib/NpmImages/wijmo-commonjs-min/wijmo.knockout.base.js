/*!
    *
    * Wijmo Library 5.20191.603
    * http://wijmo.com/
    *
    * Copyright(c) GrapeCity, Inc.  All rights reserved.
    *
    * Licensed under the GrapeCity Commercial License.
    * sales@wijmo.com
    * wijmo.com/products/wijmo-5/license/
    *
    */

"use strict";var __extends=this&&this.__extends||function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(exports,"__esModule",{value:!0});var wijmo_meta_1=require("wijmo/wijmo.meta"),mKo=require("knockout"),MetaFactory=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.CreateProp=function(t,e,r,n,o,i){return new PropDesc(t,e,r,n,o,i)},e.CreateEvent=function(t,e){return new EventDesc(t,e)},e.CreateComplexProp=function(t,e,r){return new ComplexPropDesc(t,e,r)},e.findProp=function(t,e){return wijmo_meta_1.ControlMetaFactory.findProp(t,e)},e.findEvent=function(t,e){return wijmo_meta_1.ControlMetaFactory.findEvent(t,e)},e.findComplexProp=function(t,e){return wijmo_meta_1.ControlMetaFactory.findComplexProp(t,e)},e}(wijmo_meta_1.ControlMetaFactory);exports.MetaFactory=MetaFactory;var PropDesc=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(wijmo_meta_1.PropDescBase);exports.PropDesc=PropDesc;var EventDesc=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(wijmo_meta_1.EventDescBase);exports.EventDesc=EventDesc;var ComplexPropDesc=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(wijmo_meta_1.ComplexPropDescBase);exports.ComplexPropDesc=ComplexPropDesc;var wjKo=mKo,WjBinding=function(){function t(){this.init=function(t,e,r,n,o){return this.ensureMetaData(),this._initImpl(t,e,r,n,o)}.bind(this),this.update=function(t,e,r,n,o){this._updateImpl(t,e,r,n,o)}.bind(this),this._updateImpl=function(e,r,n,o,i){e[t._wjContextProp].update(e,r,n,o,i)}}return t.prototype.ensureMetaData=function(){this._metaData||(this._metaData=MetaFactory.getMetaData(this._getMetaDataId()),this._initialize(),this._metaData.prepare())},t.prototype._initialize=function(){},t.prototype._getControlConstructor=function(){return null},t.prototype._getMetaDataId=function(){return this._getControlConstructor()},t.prototype._createControl=function(t){return new(this._getControlConstructor())(t)},t.prototype._createWijmoContext=function(){return new WjContext(this)},t.prototype._isChild=function(){return this._isParentInitializer()||this._isParentReferencer()},t.prototype._isParentInitializer=function(){return void 0!=this._metaData.parentProperty},t.prototype._isParentReferencer=function(){return void 0!=this._metaData.parentReferenceProperty},t.prototype._initImpl=function(e,r,n,o,i){var a=this._createWijmoContext();return e[t._wjContextProp]=a,a.element=e,this._isChild()&&(a.parentWjContext=e.parentElement[t._wjContextProp]),a.valueAccessor=r,a.allBindings=n,a.viewModel=o,a.bindingContext=i,a.init(e,r,n,o,i)},t._wjContextProp="__wjKoContext",t._parPropAttr="wjProperty",t._controlPropAttr="control",t._initPropAttr="isInitialized",t._initEventAttr="initialized",t}();exports.WjBinding=WjBinding;var WjContext=function(){function t(t){this._isInitialized=!1,this._isUpdatingControl=!1,this._isSourceDirty=!1,this._oldSourceValues={},this.wjBinding=t}return t.prototype.init=function(t,e,r,n,o){var i=e(),a=(this.wjBinding._metaData.props,this.wjBinding._metaData.events);if(this._isChild()){var s=i[WjBinding._parPropAttr],p=this.wjBinding._metaData,c=s&&wjKo.unwrap(s)||p.parentProperty;this._parentPropDesc=MetaFactory.findComplexProp(c,this.parentWjContext.wjBinding._metaData.complexProps)||new ComplexPropDesc(c,p.isParentPropertyArray,p.ownsObject)}for(var u in this._initControl(),this._safeUpdateSrcAttr(WjBinding._controlPropAttr,this.control),wjKo.applyBindingsToDescendants(o,t),this._childrenInitialized(),a)this._addEventHandler(a[u]);this._updateControl(e),this._safeNotifySrcAttr(WjBinding._controlPropAttr),this._updateSource(),this._isInitialized=!0,this._safeUpdateSrcAttr(WjBinding._initPropAttr,!0);var _=i[WjBinding._initEventAttr];return _&&wjKo.unwrap(_)(this.bindingContext.$data,this.control,void 0),{controlsDescendantBindings:!0}},t.prototype.update=function(t,e,r,n,o){this.valueAccessor=e,this._updateControl(e)},t.prototype._createControl=function(){return this.wjBinding._createControl(this._parentInCtor()?this.parentWjContext.control:this.element)},t.prototype._initControl=function(){if(this._isChild()){this.element.style.display="none";var t=this._getParentProp(),e=this.parentWjContext.control;if(this._useParentObj())this.control=e[t];else{var r=this.control=this._createControl();this._isParentInitializer()&&(this._isParentArray()?e[t].push(r):e[t]=r),this._isParentReferencer()&&!this._parentInCtor()&&(r[this._getParentReferenceProperty()]=e)}}else this.control=this._createControl()},t.prototype._childrenInitialized=function(){},t.prototype._addEventHandler=function(t){var e=this;this.control[t.eventName].addHandler(function(r,n){e._isInitialized&&e._updateSource();var o=e.valueAccessor()[t.eventName];o&&wjKo.unwrap(o)(e.bindingContext.$data,r,n)},this)},t.prototype._updateSource=function(){t._isUpdatingSource=!0;try{var e=this.wjBinding._metaData.props;for(var r in e){var n=e[r],o=n.propertyName;n.shouldUpdateSource&&n.isNativeControlProperty&&this._safeUpdateSrcAttr(o,this.control[o])}}finally{for(t._isUpdatingSource=!1;t._pendingSourceUpdates.length>0;){t._pendingSourceUpdates.shift()._updateControl()}}},t.prototype._updateControl=function(e){void 0===e&&(e=this.valueAccessor);var r=e(),n=this.wjBinding._metaData.props;if(t._isUpdatingSource)for(var o in t._pendingSourceUpdates.indexOf(this)<0&&t._pendingSourceUpdates.push(this),n)wjKo.unwrap(r[n[o].propertyName]);else try{var i=[],a=[];for(var o in n){var s=r[u=(p=n[o]).propertyName];if(void 0!==s)((c=wjKo.unwrap(s))!==this._oldSourceValues[u]||p.changeEvent&&c!==this.control[u])&&(this._oldSourceValues[u]=c,i.push(c),a.push(p))}for(var o in i){var p=a[o],c=wjKo.unwrap(r[p.propertyName]),u=p.propertyName;if(void 0!==c||this._isInitialized){var _=this._castValueToType(c,p);p.updateControl&&p.updateControl(this,p,this.control,c,_)||!p.isNativeControlProperty||this.control[u]!=_&&(this.control[u]=_)}}}finally{}},t.prototype._castValueToType=function(t,e){return e.castValueToType(t)},t.prototype._safeUpdateSrcAttr=function(t,e){var r=this.valueAccessor()[t];wjKo.isWritableObservable(r)&&(e!=wjKo.unwrap(r)&&r(e))},t.prototype._safeNotifySrcAttr=function(t){var e=this.valueAccessor()[t];wjKo.isWritableObservable(e)&&e.valueHasMutated&&e.valueHasMutated()},t.prototype._isChild=function(){return this.wjBinding._isChild()},t.prototype._isParentInitializer=function(){return this.wjBinding._isParentInitializer()},t.prototype._isParentReferencer=function(){return this.wjBinding._isParentReferencer()},t.prototype._getParentProp=function(){return this._isParentInitializer()?this._parentPropDesc.propertyName:void 0},t.prototype._getParentReferenceProperty=function(){return this.wjBinding._metaData.parentReferenceProperty},t.prototype._useParentObj=function(){return!this._isParentReferencer()&&this._isParentInitializer()&&!this._parentPropDesc.isArray&&!this._parentPropDesc.ownsObject},t.prototype._isParentArray=function(){return this._parentPropDesc.isArray},t.prototype._parentInCtor=function(){return this._isParentReferencer()&&""==this._getParentReferenceProperty()},t._debugId=0,t._isUpdatingSource=!1,t._pendingSourceUpdates=[],t}();exports.WjContext=WjContext;var WjTagsPreprocessor=function(){function t(){}return t._getSpecialProps=function(){var t={},e=WjBinding;return t[e._controlPropAttr]=!0,t[e._parPropAttr]=!0,t},t.prototype.register=function(){this._foreignProc=wjKo.bindingProvider.instance.preprocessNode,wjKo.bindingProvider.instance.preprocessNode=this.preprocessNode.bind(this)},t.prototype.preprocessNode=function(e){var r=t._dataBindAttr;if(1!=e.nodeType||!this._isWjTag(e.tagName))return this._delegate(e);var n=MetaFactory.toCamelCase(e.tagName),o=wjKo.bindingHandlers[n];if(!o)return this._delegate(e);o.ensureMetaData();for(var i,a="",s=e.attributes,p=document.createElement("div"),c=0;c<s.length;c++){var u=s[c];if(u.name.toLowerCase()!=r){var _=MetaFactory.toCamelCase(u.name);this._isWjProp(_,o._metaData)?(a&&(a+=","),a+=_+":"+u.value):p.setAttribute(u.name,u.value)}else i=u}for(a=n+":{"+a+"}",i&&i.value&&i.value.trim()&&(a+=","+i.value),p.setAttribute(r,a);e.firstChild;)p.appendChild(e.firstChild);return e.parentNode.replaceChild(p,e),[p]},t.prototype._delegate=function(t){return this._foreignProc?this._foreignProc(t):void 0},t.prototype._isWjTag=function(e){var r=t._wjTagPrefix;return e&&e.length>r.length&&e.substr(0,r.length).toLowerCase()===r},t.prototype._isWjProp=function(e,r){return t._specialProps[e]||MetaFactory.findProp(e,r.props)||MetaFactory.findEvent(e,r.events)},t._specialProps=t._getSpecialProps(),t._dataBindAttr="data-bind",t._wjTagPrefix="wj-",t}();exports.WjTagsPreprocessor=WjTagsPreprocessor,window.wijmo.disableKnockoutTags||(new WjTagsPreprocessor).register();