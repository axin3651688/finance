/*!
    *
    * Wijmo Library 5.20191.603
    * http://wijmo.com/
    *
    * Copyright(c) GrapeCity, Inc.  All rights reserved.
    *
    * Licensed under the GrapeCity Commercial License.
    * sales@wijmo.com
    * wijmo.com/products/wijmo-5/license/
    *
    */

"use strict";var __extends=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(exports,"__esModule",{value:!0});var TreeMapType,wijmo_1=require("wijmo/wijmo"),wijmo_chart_1=require("wijmo/wijmo.chart"),selfModule=require("wijmo/wijmo.chart.hierarchical"),HierarchicalUtil=function(){function t(){}return t.parseDataToHierarchical=function(e,i,r,o){var a,n=[];return e instanceof wijmo_1.CollectionView&&e.groups.length>0?n=t.parseGroupCV(e,i):e.length>0&&(wijmo_1.isString(r)&&r.indexOf(",")>-1&&(r=r.split(",")),o?n=t.parseItems(e,i,r,o):(a=t.convertFlatData(e,i,r),n=t.parseItems(a,"value",r,"items"))),n},t.parseGroupCV=function(t,e){for(var i=[],r=0,o=t.groups.length;r<o;r++){var a=this.parseGroups(t.groups[r],e);i.push(a)}return i},t.parseGroups=function(t,e){var i={};if(i.name=t.name,i.nameField=t.groupDescription.propertyName,i.item=t.items,t.groups&&t.groups.length){i.items=[];for(var r=0,o=t.groups.length;r<o;r++){var a=this.parseGroups(t.groups[r],e);i.items.push(a)}}else t.isBottomLevel&&(i.value=t.getAggregate(wijmo_1.Aggregate.Sum,e));return i},t.parseItems=function(e,i,r,o){var a,n=[],s=e.length;for(a=0;a<s;a++)n.push(t.parseItem(e[a],i,r,o));return n},t.isFlatItem=function(t,e){return!wijmo_1.isArray(t[e])},t.convertFlatData=function(e,i,r){var o,a,n=[],s={},l=e.length;for(o=0;o<l;o++)a=e[o],t.convertFlatItem(s,a,i,wijmo_1.isArray(r)?r:[r]);return t.convertFlatToHierarchical(n,s),n},t.convertFlatToHierarchical=function(e,i){var r=i.flatDataOrder;r&&r.forEach(function(r){var o,a={},n=i[r];a[i.field]=r,n.flatDataOrder?(o=[],t.convertFlatToHierarchical(o,n),a.items=o):a.value=n,e.push(a)})},t.convertFlatItem=function(e,i,r,o){var a,n,s,l;return n=(a=o.slice()).shift(),null!=(s=null==(n=wijmo_1.isString(n)?n.trim():n)?r:i[n])&&(0===a.length?(e[s]=i[r]||0,e.flatDataOrder?e.flatDataOrder.push(s):e.flatDataOrder=[s],e.field=n):(null==e[s]&&(e[s]={},e.flatDataOrder?e.flatDataOrder.push(s):e.flatDataOrder=[s],e.field=n),l=e[s],t.convertFlatItem(l,i,r,a)||(e[s]=i[r])),!0)},t.parseItem=function(e,i,r,o){var a,n,s,l,h,_={};return wijmo_1.isArray(o)?l=(h=o.slice()).length?h.shift().trim():"":(h=o,l=o),wijmo_1.isArray(r)?(n=null==(n=(a=r.slice()).shift())?n:n.trim(),_.nameField=null==n?i:n,_.name=null==n?e[i]:e[n],s=e[l],0===a.length?_.value=e[i]:s&&wijmo_1.isArray(s)&&s.length>0?_.items=t.parseItems(s,i,a,h):_.value=e[i]||0):(_.nameField=null==r?i:r,_.name=null==r?e[i]:e[r],null!=(s=e[l])&&wijmo_1.isArray(s)&&s.length>0?_.items=t.parseItems(s,i,r,h):_.value=e[i]),_.item=e,_},t.parseFlatItem=function(t,e,i,r){t.items||(t.items=[])},t}();exports.HierarchicalUtil=HierarchicalUtil,function(t){t[t.Squarified=0]="Squarified",t[t.Horizontal=1]="Horizontal",t[t.Vertical=2]="Vertical"}(TreeMapType=exports.TreeMapType||(exports.TreeMapType={}));var TreeMap=function(t){function e(e,i){var r=t.call(this,e,null,!0)||this;return r._values=[],r._labels=[],r._areas=[],r._sum=0,r._keywords=new wijmo_chart_1._KeyWords,r._processedData=[],r._depth=1,r._itemIndex=0,r._processedItem=[],r._maxDepth=-1,r._tmItems=[],r._colRowLens=[],r._defPalette=[{titleColor:"#033884",maxColor:"#1450a7",minColor:"#83b3f9"},{titleColor:"#a83100",maxColor:"#dc4a0d",minColor:"#ffb190"},{titleColor:"#006658",maxColor:"#008d7a",minColor:"#7deddf"},{titleColor:"#a10046",maxColor:"#df0061",minColor:"#ff8cbe"},{titleColor:"#784d08",maxColor:"#99681a",minColor:"#efc989"},{titleColor:"#54156f",maxColor:"#722a90",minColor:"#cf95e7"},{titleColor:"#998605",maxColor:"#c2ac19",minColor:"#ffef8b"},{titleColor:"#9a0005",maxColor:"#c80c14",minColor:"#ff888d"}],r.applyTemplate("wj-control wj-flexchart wj-treemap",null,null),r._currentRenderEngine=new wijmo_chart_1._SvgRenderEngine(r.hostElement),r._legend=new wijmo_chart_1.Legend(r),r._legend.position=wijmo_chart_1.Position.None,r._tooltip=new wijmo_chart_1.ChartTooltip,r._tooltip.content="<b>{name}</b><br/>{value}",r._tooltip.showDelay=0,r._lbl=new wijmo_chart_1.DataLabel,r._lbl.position=wijmo_chart_1.LabelPosition.Center,r._lbl._chart=r,r.hostElement.addEventListener("mousemove",function(t){r.isTouching||r._toogleTooltip(t)}),r.hostElement.addEventListener("click",function(t){var e=!0;if(r.maxDepth>0){var i=r.hitTest(t),o=wijmo_chart_1.FlexChart._SELECTION_THRESHOLD;if(r.tooltip&&r.tooltip.threshold&&(o=r.tooltip.threshold),i.distance<=o&&i.pointIndex>=-1&&i.pointIndex<r._areas.length){var a=r._areas[i.pointIndex];r._currentItem!=a.item&&(r._currentItem=a.item,r._refreshChart(),e=!1)}}e&&r.isTouching&&r._toogleTooltip(t)}),r.hostElement.addEventListener("contextmenu",function(t){if(r.maxDepth>0){var e=r.hitTest(t),i=wijmo_chart_1.FlexChart._SELECTION_THRESHOLD;r.tooltip&&r.tooltip.threshold&&(i=r.tooltip.threshold),e.distance<=i&&r._rollUp()}return t.preventDefault(),!1}),r.hostElement.addEventListener("mouseleave",function(){r._hideToolTip()}),r.initialize(i),r.refresh(),r}return __extends(e,t),e.prototype._rollUp=function(){this._currentItem=this._currentItem&&this._currentItem.parent?this._currentItem.parent:null,this._refreshChart()},e.prototype._toogleTooltip=function(t){var e=this._tooltip;if(e.content){var i=this.hitTest(t);if(i.distance<=e.threshold){var r=this._getLabelContent(i,this.tooltip.content);this._showToolTip(r,new wijmo_1.Rect(t.clientX,t.clientY,5,5))}else this._hideToolTip()}},Object.defineProperty(e.prototype,"selectionMode",{get:function(){return wijmo_chart_1.SelectionMode.None},set:function(t){},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"_treeMapItems",{get:function(){return this._tmItems},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"tooltip",{get:function(){return this._tooltip},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"binding",{get:function(){return this._binding},set:function(t){t!=this._binding&&(this._binding=wijmo_1.asString(t,!0),this._bindChart())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"type",{get:function(){return null==this._type?TreeMapType.Squarified:this._type},set:function(t){(t=wijmo_1.asEnum(t,TreeMapType))!=this._type&&(this._type=t,this.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bindingName",{get:function(){return this._bindingName},set:function(t){t!=this._bindingName&&(wijmo_1.assert(null==t||wijmo_1.isArray(t)||wijmo_1.isString(t),"bindingName should be an array or a string."),this._bindingName=t,this._bindChart())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dataLabel",{get:function(){return this._lbl},set:function(t){t!=this._lbl&&(this._lbl=t,this._lbl&&(this._lbl._chart=this))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"childItemsPath",{get:function(){return this._childItemsPath},set:function(t){t!=this._childItemsPath&&(wijmo_1.assert(null==t||wijmo_1.isArray(t)||wijmo_1.isString(t),"childItemsPath should be an array or a string."),this._childItemsPath=t,this._bindChart())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxDepth",{get:function(){return this._maxDepth},set:function(t){t!=this._maxDepth&&(this._maxDepth=wijmo_1.asNumber(t,!0),this.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"palette",{get:function(){return this._palette},set:function(t){t!=this._palette&&(this._palette=wijmo_1.asArray(t),this._tmItems&&this._tmItems.length>0&&this._calculateColorForItems(this._tmItems),this.invalidate())},enumerable:!0,configurable:!0}),e.prototype._initData=function(){this._sum=0,this._tmItems=[],this._currentItem=null,this._values=[],this._labels=[],this._processedData=[],this._depth=1,this._processedItem=[]},e.prototype._performBind=function(){var t;this._initData(),this._cv&&(t=this._cv.items,this._cv.groups&&this._cv.groups.length?this._processedData=HierarchicalUtil.parseDataToHierarchical(this._cv,this.binding,this.bindingName,this.childItemsPath):t&&(this._processedData=HierarchicalUtil.parseDataToHierarchical(t,this.binding,this.bindingName,this.childItemsPath)),this._processedData&&this._processedData.length&&(this._sum=this._calculateValueAndDepth(this._processedData,1),this._sortData(this._processedData),this._values=[],this._getTMItemsAndLabelsAndValues(this._processedData,this._tmItems,1,null),this._calculateColorForItems(this._tmItems)))},e.prototype._sortData=function(t){var e=this;t.forEach(function(t){t.items&&e._sortData(t.items)}),t.sort(function(t,e){return e.value-t.value})},e.prototype._getTMItemsAndLabelsAndValues=function(t,e,i,r,o){var a=this;t&&t.length>0&&t.forEach(function(t,o){var n,s=new _TreeMapItem;s.items=[],s.parent=r,s.depth=i,t.items&&a._getTMItemsAndLabelsAndValues(t.items,s.items,i+1,s),n=t.name?t.name:t.value.toString(),s.label=n,s.value=t.value,null!=r&&(t.value>r.maxValue&&(r.maxValue=t.value),t.value<r.minValue&&(r.minValue=t.value)),e.push(s),a._labels.push(n),a._values.push(t.value)})},e.prototype._calculateColorForItems=function(t,e,i){var r=this,o=i;t.forEach(function(t,i){var a=e;1===t.depth&&(a=r._getColor(i)),t.palette=a;var n=t.palette;if(wijmo_1.isString(n)){var s=n,l=r._getLightColor(s);t.titleFill=s,t.titleStroke=s,t.fill=l,t.stroke=s}else if(n.maxColor&&n.minColor&&n.titleColor)if(t.titleFill=n.titleColor,t.titleStroke=n.titleColor,null==t.parent)t.fill=n.maxColor,t.stroke=n.maxColor;else{null==o&&(o=new _ColorConverter(n.minColor,t.minValue,n.maxColor,t.maxValue));var h=o._calculateColorByVal(t.value,!0).toString();t.fill=h,t.stroke=h}if(t.items&&t.items.length>0){var _=new _ColorConverter(n.minColor,t.minValue,n.maxColor,t.maxValue);r._calculateColorForItems(t.items,a,_)}})},e.prototype._getBindData=function(t,e,i){var r,o=0;i&&(r=t[i]);o=0;return wijmo_1.isNumber(r)?o=wijmo_1.asNumber(r):r&&(o=parseFloat(r.toString())),!isNaN(o)&&isFinite(o)?e.push(o):(o=0,e.push(o)),o},e.prototype._calculateValueAndDepth=function(t,e){var i=this,r=0,o=this._values;return this._depth<e&&(this._depth=e),t.forEach(function(t){var a;t.items?(a=i._calculateValueAndDepth(t.items,e+1),t.value=a,o.push(a)):(a=i._getBindData(t,o,"value"),t.value=a),r+=a}),r},e.prototype._prepareRender=function(){this._areas=[]},e.prototype._renderChart=function(t,i,r){var o,a,n,s=this._rectChart.clone();new wijmo_1.Size(s.width,s.height);this.onRendering(new wijmo_chart_1.RenderEventArgs(t));var l=i.width,h=i.height;this._tmGroup=t.startGroup(null,null,!0);var _=this._parseMargin(this.plotMargin);this.dataLabel;isNaN(_.left)&&(_.left=e._MARGIN),isNaN(_.right)&&(_.right=e._MARGIN),isNaN(_.top)&&(_.top=e._MARGIN),isNaN(_.bottom)&&(_.bottom=e._MARGIN),i.top+=_.top;h=i.height-(_.top+_.bottom);i.height=h>0?h:24,i.left+=_.left;l=i.width-(_.left+_.right);i.width=l>0?l:24,this._plotRect=i,o=this._currentItem?[this._currentItem]:this._tmItems,a=null==this._currentItem||this.maxDepth<1?this.maxDepth:this._currentItem&&this._currentItem.items&&this._currentItem.items.length&&this.maxDepth>1?this.maxDepth:this.maxDepth+1,n=this._currentItem?this._currentItem.value:this._sum,this._renderTreeMap(t,i,this._tmGroup,o,n,a),t.endGroup(),this.dataLabel.content&&this.dataLabel.position!=wijmo_chart_1.LabelPosition.None&&this._renderLabels(t),this.onRendered(new wijmo_chart_1.RenderEventArgs(t))},e.prototype._renderTreeMap=function(t,e,i,r,o,a){o>0&&(this._itemIndex=0,this._resetItemRects(this._tmItems),this._calculateItemRects(e,r,o,1,a),this._renderHierarchicalTreeMapItems(t,i,e,this._tmItems,o,1,a))},e.prototype._resetItemRects=function(t){var e=this;t.forEach(function(t){t.rect=new wijmo_1.Rect(0,0,0,0),t.isTitle=!1,t.type=e.type,t.items&&t.items.length&&e._resetItemRects(t.items)})},e.prototype._calculateItemRects=function(t,e,i,r,o){var a=this;switch(this.type){case TreeMapType.Horizontal:_TreeMapUtils.horizontal(e,t,i);break;case TreeMapType.Vertical:_TreeMapUtils.vertical(e,t,i);break;case TreeMapType.Squarified:_TreeMapUtils.squarified(e,t,i)}e.forEach(function(t,e){t.rect.clone();t.items&&t.items.length&&(r===o||r>o&&o>=1||(t.isTitle=!0,a._calculateItemRects(t.itemsRect,t.items,t.value,r+1,o)))})},e.prototype._renderHierarchicalTreeMapItems=function(t,i,r,o,a,n,s){var l,h,_,c,u,m=o.length;this.type;if(0!==m)for(var p=0;p<m;p++)l=t.startGroup(e._CSS_ITEMDEPTH+n),h=o[p],_=Math.abs(h.value),c=h.rect,h.draw(t),u=new wijmo_chart_1._RectArea(c),h.items&&this._renderHierarchicalTreeMapItems(t,l,h.itemsRect,h.items,_,n+1,s),u.tag=this._itemIndex,u.name=h.label,u.value=_,u.item=h,this._areas.push(u),this._itemIndex++,t.endGroup()},e.prototype._renderLabels=function(t){var e,i=this._areas.length,r=this.dataLabel,o=r.position,a=r.connectingLine,n=r.border,s=r.offset||0;t.stroke="null",t.fill="transparent",t.strokeWidth=1,t.startGroup("wj-data-labels");for(var l=0;l<i;l++){var h=this._areas[l];if(h){var _=h.rect,c=new wijmo_chart_1.HitTestInfo(this,e);c._setData(null,l);var u=this._getLabelContent(c,r.content);if(e=new wijmo_1.Point(_.left+_.width/2,_.top+_.height/2),u&&_.width>0&&_.height>0){var m=new wijmo_chart_1.DataLabelRenderEventArgs(t,c,e,u);r.onRendering(m)&&(u=m.text,e=m.point,this._renderLabelAndBorder(t,h,_,u,o,s,e,a,2,n))}}}t.endGroup()},e.prototype._renderLabelAndBorder=function(t,e,i,r,o,a,n,s,l,h){var _,c="wj-data-label",u="wj-data-label-line";switch(o){case wijmo_chart_1.LabelPosition.Top:s&&t.drawLine(n.x,n.y,n.x,n.y-a,u),n.y-=l+a,_=this._renderText(t,e,i,r,n,1,2,c);break;case wijmo_chart_1.LabelPosition.Bottom:s&&t.drawLine(n.x,n.y,n.x,n.y+a,u),n.y+=l+a,_=this._renderText(t,e,i,r,n,1,0,c);break;case wijmo_chart_1.LabelPosition.Left:s&&t.drawLine(n.x,n.y,n.x-a,n.y,u),n.x-=l+a,_=this._renderText(t,e,i,r,n,2,1,c);break;case wijmo_chart_1.LabelPosition.Right:s&&t.drawLine(n.x,n.y,n.x+a,n.y,u),n.x+=l+a,_=this._renderText(t,e,i,r,n,0,1,c);break;case wijmo_chart_1.LabelPosition.Center:_=this._renderText(t,e,i,r,n,1,1,c)}return h&&_&&t.drawRect(_.left-l,_.top-l,_.width+2*l,_.height+2*l,"wj-data-label-border"),_},e.prototype._renderText=function(t,e,i,r,o,a,n,s){var l,h=r,_=e.item;return l=t.measureString(r,s),this.type===TreeMapType.Horizontal&&_.isTitle?(l.width>i.height&&(h=this._cutText(r,l.width,i.height)),wijmo_chart_1.FlexChart._renderRotatedText(t,h,o,a,n,o,-90,s),null):(l.width>i.width&&(h=this._cutText(r,l.width,i.width)),wijmo_chart_1.FlexChart._renderText(t,h,o,a,n,s))},e.prototype._cutText=function(t,e,i){var r="",o=t.length,a=Math.floor((1-(e-i)/e)*o);return t.length>0&&(r=t[0]+(a>1?t.substring(1,a-1)+"..":"")),r},e.prototype._measureLegendItem=function(t,e){var i=new wijmo_1.Size;if(i.width=wijmo_chart_1.Series._LEGEND_ITEM_WIDTH,i.height=wijmo_chart_1.Series._LEGEND_ITEM_HEIGHT,e){var r=t.measureString(e,wijmo_chart_1.FlexChart._CSS_LABEL,wijmo_chart_1.FlexChart._CSS_LEGEND);i.width+=r.width,i.height<r.height&&(i.height=r.height)}return i.width+=3*wijmo_chart_1.Series._LEGEND_ITEM_MARGIN,i.height+=2*wijmo_chart_1.Series._LEGEND_ITEM_MARGIN,i},e.prototype._getDesiredLegendSize=function(t,e,i,r){var o=new wijmo_1.Size,a=new wijmo_1.Size(i,r),n=this._tmItems.length,s=0,l=0;this._colRowLens=[];for(var h=0;h<n;h++){var _=this._measureLegendItem(t,this._tmItems[h].label);e?(l+_.height>r&&(o.height=r,this._colRowLens.push(s),s=0,l=0),s<_.width&&(s=_.width),l+=_.height):(s+_.width>i&&(o.width=i,this._colRowLens.push(l),l=0,s=0),l<_.height&&(l=_.height),s+=_.width)}return e?(o.height<l&&(o.height=l),this._colRowLens.push(s),o.width=this._colRowLens.reduce(function(t,e){return t+e},0),o.width>a.width/2&&(o.width=a.width/2)):(o.width<s&&(o.width=s),this._colRowLens.push(l),o.height=this._colRowLens.reduce(function(t,e){return t+e},0),o.height>a.height/2&&(o.height=a.height/2)),o},e.prototype._renderLegend=function(t,e,i,r,o,a){for(var n,s=this._rectLegend,l=this._tmItems.length,h=0,_=e.clone(),c=0;c<l;c++){n=this._tmItems[c].label;var u=this._measureLegendItem(t,n);r?_.y+u.height>s.top+s.height+1&&(_.x+=this._colRowLens[h],h++,_.y=e.y):_.x+u.width>s.left+s.width+1&&(_.y+=this._colRowLens[h],h++,_.x=e.x);var m=new wijmo_1.Rect(_.x,_.y,u.width,u.height);this._drawLegendItem(t,m,c,n),i.push(m),r?_.y+=u.height:_.x+=u.width}},e.prototype._drawLegendItem=function(t,e,i,r){t.strokeWidth=1;var o=wijmo_chart_1.Series._LEGEND_ITEM_MARGIN,a=this._getColor(i),n=a&&a.maxColor?a.maxColor:a,s=this._getLightColor(n);t.fill=n,t.stroke=s;var l=e.top+.5*e.height,h=wijmo_chart_1.Series._LEGEND_ITEM_WIDTH,_=wijmo_chart_1.Series._LEGEND_ITEM_HEIGHT;t.drawRect(e.left+o,l-.5*_,h,_,null),r&&wijmo_chart_1.FlexChart._renderText(t,r,new wijmo_1.Point(e.left+_+2*o,l),0,1,wijmo_chart_1.FlexChart._CSS_LABEL)},e.prototype._getLabelContent=function(t,e){return wijmo_1.isString(e)?this._keywords.replace(e,t):wijmo_1.isFunction(e)?e(t):null},e.prototype.hitTest=function(t,e){var i=this._toControl(t,e),r=new wijmo_chart_1.HitTestInfo(this,i),o=null;if(wijmo_chart_1.FlexChart._contains(this._rectHeader,i))r._chartElement=wijmo_chart_1.ChartElement.Header;else if(wijmo_chart_1.FlexChart._contains(this._rectFooter,i))r._chartElement=wijmo_chart_1.ChartElement.Footer;else if(wijmo_chart_1.FlexChart._contains(this._rectLegend,i))r._chartElement=wijmo_chart_1.ChartElement.Legend,null!==(o=this.legend._hitTest(i))&&o>=0&&o<this._areas.length&&r._setData(null,o);else if(wijmo_chart_1.FlexChart._contains(this._rectChart,i)){for(var a,n=this._areas.length,s=NaN,l=0;l<n;l++){var h=i.clone(),_=this._areas[l];_.contains(h)&&(r._setData(null,_.tag),r._dist=0);var c=_.distance(h);void 0!==c&&(isNaN(s)||c<s)&&(s=c,a=_)}0!==r._dist&&null!=a&&(r._setData(null,a.tag),r._dist=s),r._chartElement=wijmo_chart_1.ChartElement.ChartArea}else r._chartElement=wijmo_chart_1.ChartElement.None;return r},e.prototype._getHitTestItem=function(t){var e=null,i=null;return(e=null!=this._cv?this._cv.items:this.itemsSource)&&t<e.length&&(i=e[t]),i},e.prototype._getHitTestValue=function(t){return this._values[t]},e.prototype._getHitTestLabel=function(t){return this._labels[t]},e._CSS_ITEMDEPTH="wj-treemap-item-depth",e._MARGIN=0,e}(wijmo_chart_1.FlexChartBase);exports.TreeMap=TreeMap;var _TreeMapItem=function(){function t(){this.items=[],this.maxValue=Number.MIN_VALUE,this.minValue=Number.MAX_VALUE}return t.prototype.draw=function(e){var i=this.rect;e.strokeWidth=0,this.isTitle?(e.fill=this.titleFill,e.stroke=this.titleStroke):(e.fill=this.fill,e.stroke=this.stroke),e.drawRect(i.left,i.top,i.width,i.height,t._CLASSNAME)},Object.defineProperty(t.prototype,"itemsRect",{get:function(){var t=this.rect,e=this._rect,i=1===this.depth?2:.5;return this.isTitle?this.type===TreeMapType.Horizontal?new wijmo_1.Rect(t.left+t.width+1,t.top,e.width-t.width-2*i,t.height+1):new wijmo_1.Rect(t.left,t.top+t.height+1,t.width+1,e.height-t.height-2*i):new wijmo_1.Rect(0,0,0,0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rect",{get:function(){var t=this._rect,e=1===this.depth?2:.5,i=t.width,r=t.height,o=t.left,a=t.top;return this.isTitle?(this.type===TreeMapType.Horizontal?(i=t.width>20?20:i,i=Math.max(20,i-2*e),r=r>2*e?r-2*e:0):(r=t.height>20?20:r,r=Math.max(20,r-2*e),i=i>2*e?i-2*e:0),o+=e,a+=e):(i=i>2*e?i-2*e:0,r=r>2*e?r-2*e:0),new wijmo_1.Rect(o,a,i,r)},set:function(t){t!=this._rect&&(this._rect=t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isTitle",{get:function(){return this._isTitle},set:function(t){var e=wijmo_1.asBoolean(t,!0);e!==this._isTitle&&(this._isTitle=e)},enumerable:!0,configurable:!0}),t._CLASSNAME="wj-treemap-item",t}(),_ColorConverter=function(){function t(t,e,i,r,o,a){this.minColor=new wijmo_1.Color(t),this.minColorValue=e,this.maxColor=new wijmo_1.Color(i),this.maxColorValue=r,this.midColorValue=this.originalMidColorValue=a,this._calculateMidColorValue(),this.midColor=this.originalMidColor=new wijmo_1.Color(o),this._calculateMidColor()}return t.prototype._resetminColor=function(t){this.minColor=new wijmo_1.Color(t),this._calculateMidColor()},t.prototype._resetmidColor=function(t){this.midColor=this.originalMidColor=new wijmo_1.Color(t),this._calculateMidColor()},t.prototype._resetmaxColor=function(t){this.maxColor=new wijmo_1.Color(t),this._calculateMidColor()},t.prototype._resetminColorValue=function(t){this.minColorValue=t,this._calculateMidColorValue()},t.prototype._resetmidColorValue=function(t){this.midColorValue=this.originalMidColorValue=t,this._calculateMidColorValue()},t.prototype._resetmaxColorValue=function(t){this.maxColorValue=t,this._calculateMidColorValue()},t.prototype._calculateMidColorValue=function(){null==this.originalMidColorValue&&(this.midColorValue=(this.maxColorValue+this.minColorValue)/2)},t.prototype._calculateMidColor=function(){null==this.originalMidColor&&(this.midColor=this._calculateColorByVal(this.midColorValue,!0))},t.prototype._calculateColorByVal=function(t,e){void 0===e&&(e=!1);var i=this.maxColor,r=this.minColor,o=this.maxColorValue,a=this.minColorValue;if(t>=this.maxColorValue)return new wijmo_1.Color(i.toString());if(t<=this.minColorValue)return new wijmo_1.Color(r.toString());if(!e){if(t===this.midColorValue)return new wijmo_1.Color(this.midColor.toString());t<this.midColorValue?(i=this.midColor,o=this.midColorValue):(r=this.midColor,a=this.midColorValue)}return this._getColor(t,i,o,r,a)},t.prototype._getColor=function(t,e,i,r,o){return wijmo_1.Color.fromRgba(this._getValueByRatio(t,e.r,i,r.r,o),this._getValueByRatio(t,e.g,i,r.g,o),this._getValueByRatio(t,e.b,i,r.b,o),this._getValueByRatio(t,e.a,i,r.a,o))},t.prototype._getValueByRatio=function(t,e,i,r,o){return Math.abs(r+Math.round((t-o)*(e-r)/(i-o)))},t}(),_TreeMapUtils=function(){function t(){}return t.squarified=function(e,i,r){var o=e.slice(),a=i.clone(),n=a.width*a.height/r;do{var s=t.getRowedItems(o,a,n);t.layoutRowedItems(i,s,a,a.width>a.height)}while(o.length)},t.horizontal=function(e,i,r){var o=i.clone();e.forEach(function(e){var a=[{item:e,val:e.value*i.width*i.height/r}];t.layoutRowedItems(i,a,o,!1)})},t.vertical=function(e,i,r){var o=i.clone();e.forEach(function(e){var a=[{item:e,val:e.value*i.width*i.height/r}];t.layoutRowedItems(i,a,o,!0)})},t.getNarrowLen=function(t){return Math.min(t.width,t.height)},t.getRowedItem=function(t,e,i){return{item:t,val:i*t.value}},t.getRowedItems=function(e,i,r){var o=e.shift(),a=[],n=[],s=t.getNarrowLen(i),l=t.getRowedItem(o,i,r);if(a.push(l),n.push(l),e.length>0)do{if(n.push(t.getRowedItem(e[0],i,r)),!(t.worst(a,s)>t.worst(n,s)))break;a=n.slice(),e.shift()}while(e.length);return a},t.layoutRowedItems=function(e,i,r,o){var a,n=r.left,s=r.top,l=n+r.width,h=s+r.height,_=t.sumRowedArray(i);o?(a=0===r.height?0:_/r.height,n+a>=l&&(a=l-n),i.forEach(function(t,e){var r=0===a?0:t.val/a;(s+r>h||e===i.length-1)&&(r=h-s);var o=new wijmo_1.Rect(n,s,a,r);t.item.rect=o,s+=r}),r.left+=a,r.width-=a):(a=0===r.width?0:_/r.width,s+a>=h&&(a=h-s),i.forEach(function(t,e){var r=0===a?0:t.val/a;(n+r>l||e===i.length-1)&&(r=l-n);var o=new wijmo_1.Rect(n,s,r,a);t.item.rect=o,n+=r}),r.top+=a,r.height-=a)},t.sumRowedArray=function(t){for(var e=0,i=t.length,r=0;r<i;r++)e+=t[r].val;return e},t.worst=function(e,i){var r,o,a=t.sumRowedArray(e),n=a*a,s=i*i;return r=o=e[0].val,e.forEach(function(t,e){t.val>r?r=t.val:t.val<o&&(o=t.val)}),Math.max(s*r/n,n/(s*o))},t}(),Sunburst=function(t){function e(e,i){var r=t.call(this,e,i)||this;return r._selectionIndex=0,r.applyTemplate("wj-sunburst",null,null),r.initialize(i),r.refresh(),r}return __extends(e,t),Object.defineProperty(e.prototype,"bindingName",{get:function(){return this._bindName},set:function(t){t!=this._bindName&&(wijmo_1.assert(null==t||wijmo_1.isArray(t)||wijmo_1.isString(t),"bindingName should be an array or a string."),this._bindName=t,this._bindChart())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"childItemsPath",{get:function(){return this._childItemsPath},set:function(t){t!=this._childItemsPath&&(wijmo_1.assert(null==t||wijmo_1.isArray(t)||wijmo_1.isString(t),"childItemsPath should be an array or a string."),this._childItemsPath=t,this._bindChart())},enumerable:!0,configurable:!0}),e.prototype._initData=function(){t.prototype._initData.call(this),this._processedData=[],this._level=1,this._legendLabels=[],this._processedItem=[],this._values[0]=[]},e.prototype._performBind=function(){var t,e=this;this._initData(),this._cv&&(t=this._cv.items,this._cv.groups&&this._cv.groups.length?this._processedData=HierarchicalUtil.parseDataToHierarchical(this._cv,this.binding,this.bindingName,this.childItemsPath):t&&(this._processedData=HierarchicalUtil.parseDataToHierarchical(t,this.binding,this.bindingName,this.childItemsPath)),this._processedData&&this._processedData.length&&(this._sums[0]=this._sum=this._calculateValueAndLevel(this._processedData,1),this._processedData.forEach(function(t){e._legendLabels.push(t.name)})))},e.prototype._calculateValueAndLevel=function(t,e){var i=this,r=0,o=this._values[0],a=this._labels;return this._level<e&&(this._level=e),t.forEach(function(t){var n;t.items?(n=i._calculateValueAndLevel(t.items,e+1),t.value=n,o.push(n),a.push(t.name)):(n=i._getBindData(t,o,a,"value","name"),t.value=n),r+=n}),r},e.prototype._renderPie=function(t,e,i,r,o,a){var n=this._getCenter();this._sliceIndex=0,this._parentRef={},this._renderHierarchicalSlices(t,n.x,n.y,this._processedData,this._sum,i,r,o,2*Math.PI,a,1)},e.prototype._renderHierarchicalSlices=function(t,e,i,r,o,a,n,s,l,h,_){var c,u,m,p,d,f,g,w,v,C,y=r.length,b=s,I=1==this.reversed;m=(a-n)/this._level,c=a-(this._level-_)*m,u=n+(_-1)*m;for(var j=0;j<y;j++){if(w=e,v=i,g=t.startGroup("wj-slice slice-level"+_),1===_&&(t.fill=this._getColorLight(j),t.stroke=this._getColor(j)),d=r[j],f=Math.abs(d.value),p=Math.abs(f-o)<1e-10?l:l*f/o,C=I?b-.5*p:b+.5*p,h>0&&p<l&&(w+=h*Math.cos(C),v+=h*Math.sin(C)),d.items){var x=this._sliceIndex;for(this._renderHierarchicalSlices(t,w,v,d.items,f,a,n,b,p,0,_+1);x<this._sliceIndex;x++)null==this._parentRef[x]&&(this._parentRef[x]=this._sliceIndex)}this._renderSlice(t,w,v,C,0,this._sliceIndex,c,u,b,p,l),this._processedItem.push(d.item),this._sliceIndex++,I?b-=p:b+=p,t.endGroup(),this._pels.push(g)}},e.prototype._getLabelsForLegend=function(){return this._legendLabels||[]},e.prototype._highlightCurrent=function(){this.selectionMode!=wijmo_chart_1.SelectionMode.None&&this._highlight(!0,this._selectionIndex)},e.prototype.hitTest=function(e,i){var r=t.prototype.hitTest.call(this,e,i),o=this._toControl(e,i);if(wijmo_chart_1.FlexChartBase._contains(this._rectChart,o)){var a=r.pointIndex,n=this._processedItem[a],s=new wijmo_chart_1._DataPoint(null,a,null,null);s.item=n,r._setDataPoint(s)}return r},e.prototype._getSelectedItemOffset=function(t,e){var i=0,r=0,o=0;if(this.selectedItemOffset>0)if(t==this.selectedIndex)o=this.selectedItemOffset;else{var a=this._getSelectedParentIndex(t);if(null!=a){var n=this._areas[a];this.dataLabel.position;o=this.selectedItemOffset,e=((e=n.langle+this._rotationAngles[0])%360+360)%360,e*=Math.PI/180}}return o>0&&(i=Math.cos(e)*o*this._radius,r=Math.sin(e)*o*this._radius),{x:i,y:r}},e.prototype._getSelectedParentIndex=function(t){var e=this._parentRef[t];return null!=e?e===this.selectedIndex?e:this._getSelectedParentIndex(e):null},e}(wijmo_chart_1.FlexPie);exports.Sunburst=Sunburst,wijmo_1._registerModule("wijmo.chart.hierarchical",selfModule);