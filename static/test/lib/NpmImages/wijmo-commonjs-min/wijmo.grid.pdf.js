/*!
    *
    * Wijmo Library 5.20191.603
    * http://wijmo.com/
    *
    * Copyright(c) GrapeCity, Inc.  All rights reserved.
    *
    * Licensed under the GrapeCity Commercial License.
    * sales@wijmo.com
    * wijmo.com/products/wijmo-5/license/
    *
    */

"use strict";var __extends=this&&this.__extends||function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(t,o)};return function(t,o){function r(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(r.prototype=o.prototype,new r)}}();Object.defineProperty(exports,"__esModule",{value:!0});var ScaleMode,ExportMode,wijmo_1=require("wijmo/wijmo"),pdf=require("wijmo/wijmo.pdf"),selfModule=require("wijmo/wijmo.grid.pdf");function softGrid(){return wijmo_1._getModule("wijmo.grid")}function softDetail(){return wijmo_1._getModule("wijmo.grid.detail")}function softMultiRow(){return wijmo_1._getModule("wijmo.grid.multirow")}function softSheet(){return wijmo_1._getModule("wijmo.grid.sheet")}function softOlap(){return wijmo_1._getModule("wijmo.olap")}function _merge(e,t,o){if(void 0===o&&(o=!1),!e&&t&&(e={}),t&&e)for(var r in t){var n=t[r],i=e[r];if(wijmo_1.isObject(n)){if(void 0===i||!wijmo_1.isObject(i)&&o){if(wijmo_1.isFunction(n.clone)){e[r]=i=n.clone();continue}e[r]=i={}}wijmo_1.isObject(i)&&_merge(e[r],n,o)}else(void 0===i||o&&void 0!==n)&&(e[r]=n)}return e}exports.softGrid=softGrid,exports.softDetail=softDetail,exports.softMultiRow=softMultiRow,exports.softSheet=softSheet,exports.softOlap=softOlap,exports._merge=_merge,function(e){e[e.ActualSize=0]="ActualSize",e[e.PageWidth=1]="PageWidth",e[e.SinglePage=2]="SinglePage"}(ScaleMode=exports.ScaleMode||(exports.ScaleMode={})),function(e){e[e.All=0]="All",e[e.Selection=1]="Selection"}(ExportMode=exports.ExportMode||(exports.ExportMode={}));var _CellType,PdfFormatItemEventArgs=function(e){function t(t,o,r,n,i,l,s,a,u){var c=e.call(this)||this;return c.cancelBorders=!1,c._p=t,c._rng=o,c._cell=wijmo_1.asType(r,HTMLElement,!0),c._canvas=n,c._clientRect=i,c._contentRect=l,c._textTop=s,c._style=a,c._getFormattedCell=u,c}return __extends(t,e),Object.defineProperty(t.prototype,"panel",{get:function(){return this._p},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"range",{get:function(){return this._rng.clone()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"row",{get:function(){return this._rng.row},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"col",{get:function(){return this._rng.col},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"data",{get:function(){return this._data},set:function(e){this._data=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"canvas",{get:function(){return this._canvas},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cell",{get:function(){return this._cell},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"clientRect",{get:function(){return this._clientRect},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"contentRect",{get:function(){return this._contentRect},enumerable:!0,configurable:!0}),t.prototype.getFormattedCell=function(){return wijmo_1.asFunction(this._getFormattedCell)()},Object.defineProperty(t.prototype,"style",{get:function(){return this._style},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"textTop",{get:function(){return this._textTop},enumerable:!0,configurable:!0}),t}(wijmo_1.CancelEventArgs);exports.PdfFormatItemEventArgs=PdfFormatItemEventArgs,function(e){e[e.None=0]="None",e[e.Cell=1]="Cell",e[e.ColumnHeader=2]="ColumnHeader",e[e.RowHeader=3]="RowHeader",e[e.TopLeft=4]="TopLeft",e[e.ColumnFooter=5]="ColumnFooter",e[e.BottomLeft=6]="BottomLeft"}(_CellType=exports._CellType||(exports._CellType={}));var _FlexGridPdfCoreConverter=function(){function e(){}return e.draw=function(e,t,o,r,n,i){wijmo_1.assert(!!e,"The flex argument cannot be null."),wijmo_1.assert(!!t,"The doc argument cannot be null."),null==(i=this._applyDefaultDrawSettings(i)).scaleMode&&(i.scaleMode=null==r?ScaleMode.ActualSize:null==n?ScaleMode.PageWidth:ScaleMode.SinglePage),this._drawInternal(e,t,o,r,n,i)},e._applyDefaultDrawSettings=function(t){return _merge(_merge({},t),e.DefaultDrawSettings)},e._drawInternal=function(e,t,o,r,n,i){var l=null!=o,s=new wijmo_1.Size(t.width,t.height);o||(o=new wijmo_1.Point(0,t.y)),wijmo_1.isArray(i.embeddedFonts)&&i.embeddedFonts.forEach(function(e){t.registerFont(e)});var a=this._getRowsToRender(e,i),u=new FlexGridRenderer(e,i,a,this.BorderWidth,!0),c=new wijmo_1.Rect(o.x||0,o.y||0,r||s.width,n||s.height),d=this._getScaleFactor(u,i.scaleMode,c),p=this._getPages(u,a,c,i,l,d),f=(i.progress?this._getCellsCount(e,i,p):0)/i._progressMax,h=0,g=0,_=i.progress?function(){++h-g>=50&&(g=h,i.progress(h/f))}:null;i.progress&&i.progress(0);for(var w=0;w<p.length;w++){w>0&&t.addPage();var b=p[w],m=0===b.pageCol?c.left:0,y=0===b.pageRow?c.top:0;t.saveState(),t.paths.rect(0,0,s.width,s.height).clip(),t.scale(d,d,new wijmo_1.Point(m,y)),t.translate(m,y);var C=new FlexGridRenderer(e,i,b.range,this.BorderWidth,w===p.length-1);C.render(t,_),t.restoreState(),t.x=m,t.y=y+C.renderSize.height*d}i.progress&&0<i._progressMax&&i.progress(i._progressMax)},e._getCellsCount=function(e,t,o){for(var r=0,n=0;n<o.length;n++){r+=new FlexGridRenderer(e,t,o[n].range,0,!1).getCellsCount()}return r},e._getRowsToRender=function(e,t){var o=[];t.exportMode===ExportMode.All?o.push(new _CellRange(null,0,0,e.rows.length-1,e.columns.length-1)):o=e.getSelection();var r=new RowRange(o);if(!t.drawDetailRows){var n=[];r.forEach(e.cells,function(t,o,r){if(!e.isDetailRow(t)){var i=n.length;i&&n[i-1].bottomRow+1===r?n[i-1].row2++:n.push(new _CellRange(null,r,o.col,r,o.col2))}}),r=new RowRange(n)}return r},e._getScaleFactor=function(e,t,o){var r=1;if(t===ScaleMode.ActualSize)return r;var n,i=e.renderSize;t===ScaleMode.SinglePage?(n=Math.min(o.width/i.width,o.height/i.height))<1&&(r=n):(n=o.width/i.width)<1&&(r=n);return r},e._getPages=function(e,t,o,r,n,i){var l=this,s=[],a=[],u=pdf.pxToPt,c=e.flex,d=e.showColumnHeader,p=e.showColumnFooter,f=e.showRowHeader,h=d?u(c.columnHeaders.height):0,g=p?u(c.columnFooters.height):0,_=f?u(c.rowHeaders.width):0,w=r.scaleMode===ScaleMode.ActualSize||r.scaleMode===ScaleMode.PageWidth,b=r.scaleMode===ScaleMode.ActualSize,m=(o.width-o.left)*(1/i),y=(o.height-o.top)*(1/i),C=o.width*(1/i),R=o.height*(1/i),x=h+g,v=_,P=n&&r.scaleMode===ScaleMode.ActualSize;if(w){var S=0;t.forEach(c.cells,function(t,o,r,n){var i=s.length?R:y;if(e.isRenderableRow(t)){var a=u(t.renderHeight);x+=a,(d||++S>1)&&(x-=l.BorderWidth),x>i&&(h+a>i||P?(s.push(n),x=h):(s.push(n-1),x=h+a),d&&(x-=l.BorderWidth))}})}var j=t.length()-1;if(j<0&&(j=0),s.length&&s[s.length-1]===j||s.push(j),b)for(var T=0,G=t.leftCol;G<=t.rightCol;G++){var M=c.columns[G];if(M.isVisible){var O=u(M.renderWidth),F=a.length?C:m;v+=O,(f||++T>1)&&(v-=this.BorderWidth),v>F&&(_+O>F||P?(a.push(G),v=_):(a.push(G-1),v=_+O),f&&(v-=this.BorderWidth))}}a.length&&a[a.length-1]===t.rightCol||a.push(t.rightCol);var H=[],W=!1,z=1,A=n&&r.maxPages>0?1:r.maxPages;for(G=0;G<s.length&&!W;G++)for(var D=0;D<a.length&&!W;D++,z++)if(!(W=z>A)){var L=0===G?0:s[G-1]+1,E=0===D?t.leftCol:a[D-1]+1;H.push(new PdfPageRowRange(t.subrange(L,s[G]-L+1,E,a[D]),D,G))}return H},e.BorderWidth=1,e.DefFont=new pdf.PdfFont,e.DefaultDrawSettings={customCellContent:!1,drawDetailRows:!1,exportMode:ExportMode.All,maxPages:Number.MAX_VALUE,repeatMergedValuesAcrossPages:!0,recalculateStarWidths:!0,styles:{cellStyle:{font:{family:e.DefFont.family,size:e.DefFont.size,style:e.DefFont.style,weight:e.DefFont.weight},padding:1.5,verticalAlign:"middle"},headerCellStyle:{font:{weight:"bold"}}},_progressMax:1},e}();exports._FlexGridPdfCoreConverter=_FlexGridPdfCoreConverter;var FlexGridRenderer=function(){function e(e,t,o,r,n){this._flex=e,this._borderWidth=r,this._lastPage=n,this._settings=t||{},this._topLeft=new PanelSectionRenderer(this,e.topLeftCells,this.showRowHeader&&this.showColumnHeader?new RowRange([new _CellRange(null,0,0,e.topLeftCells.rows.length-1,e.topLeftCells.columns.length-1)]):new RowRange([]),r),this._rowHeader=new PanelSectionRenderer(this,e.rowHeaders,this.showRowHeader?o.clone(0,e.rowHeaders.columns.length-1):new RowRange([]),r),this._columnHeader=new PanelSectionRenderer(this,e.columnHeaders,this.showColumnHeader?new RowRange([new _CellRange(null,0,o.leftCol,e.columnHeaders.rows.length-1,o.rightCol)]):new RowRange([]),r),this._cells=new PanelSectionRenderer(this,e.cells,o,r),this._bottomLeft=new PanelSectionRenderer(this,e.bottomLeftCells,this.showRowHeader&&this.showColumnFooter?new RowRange([new _CellRange(null,0,0,e.bottomLeftCells.rows.length-1,e.bottomLeftCells.columns.length-1)]):new RowRange([]),r),this._columnFooter=new PanelSectionRenderer(this,e.columnFooters,this.showColumnFooter?new RowRange([new _CellRange(null,0,o.leftCol,e.columnFooters.rows.length-1,o.rightCol)]):new RowRange([]),r)}return Object.defineProperty(e.prototype,"settings",{get:function(){return this._settings},enumerable:!0,configurable:!0}),e.prototype.isRenderableRow=function(e){return e.isVisible&&!this._flex.isNewRow(e)},e.prototype.getCellsCount=function(){return this._topLeft.getCellsCount()+this._rowHeader.getCellsCount()+this._columnHeader.getCellsCount()+this._cells.getCellsCount()+this._bottomLeft.getCellsCount()+this._columnFooter.getCellsCount()},e.prototype.render=function(e,t){var o=Math.max(0,Math.max(this._topLeft.renderSize.width,this._rowHeader.renderSize.width)-this._borderWidth),r=Math.max(0,Math.max(this._topLeft.renderSize.height,this._columnHeader.renderSize.height)-this._borderWidth);this._topLeft.render(e,0,0,t),this._rowHeader.render(e,0,r,t),this._columnHeader.render(e,o,0,t),this._cells.render(e,o,r,t),r=Math.max(0,r+this._cells.renderSize.height-this._borderWidth),this._bottomLeft.render(e,0,r,t),this._columnFooter.render(e,o,r,t)},Object.defineProperty(e.prototype,"flex",{get:function(){return this._flex},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"renderSize",{get:function(){var e=Math.max(this._topLeft.renderSize.height,this._columnHeader.renderSize.height)+Math.max(this._rowHeader.renderSize.height,this._cells.renderSize.height)+Math.max(this._bottomLeft.renderSize.height,this._columnFooter.renderSize.height),t=Math.max(this._topLeft.renderSize.width,this._rowHeader.renderSize.width)+Math.max(this._columnHeader.renderSize.width,this._cells.renderSize.width);return this._columnHeader.visibleRows>0&&(e-=this._borderWidth),this._columnFooter.visibleRows>0&&(e-=this._borderWidth),this._rowHeader.visibleColumns>0&&(t-=this._borderWidth),new wijmo_1.Size(t,e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"showColumnHeader",{get:function(){return this._flex.showColumnHeader},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"showRowHeader",{get:function(){return this._flex.showRowHeader},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"showColumnFooter",{get:function(){return this._lastPage&&this._flex.showColumnFooter},enumerable:!0,configurable:!0}),e.prototype.alignMergedTextToTheTopRow=function(e){return this._flex.alignMergedTextToTheTopRow(e)},e.prototype.getColumn=function(e,t,o){return this._flex.getColumn(e,t,o)},e.prototype.isAlternatingRow=function(e){return this._flex.isAlternatingRow(e)},e.prototype.isGroupRow=function(e){return this._flex.isGroupRow(e)},e.prototype.isNewRow=function(e){return this._flex.isNewRow(e)},e.prototype.isExpandableGroupRow=function(e){return this._flex.isExpandableGroupRow(e)},e.prototype.isBooleanCell=function(e,t,o){return this._flex.isBooleanCell(e,t,o)},e.prototype.getCellStyle=function(e,t,o){return this._flex.getCellStyle(e,t,o)},e}(),PanelSection=function(){function e(e,t){this._panel=e,this._range=t.clone()}return Object.defineProperty(e.prototype,"visibleRows",{get:function(){var e=this;return null==this._visibleRows&&(this._visibleRows=0,this._range.forEach(this._panel,function(t){e.isRenderableRow(t)&&e._visibleRows++})),this._visibleRows},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"visibleColumns",{get:function(){if(null==this._visibleColumns&&(this._visibleColumns=0,this._range.isValid))for(var e=this._range.leftCol;e<=this._range.rightCol;e++)this._panel.columns[e].isVisible&&this._visibleColumns++;return this._visibleColumns},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){if(null==this._size){var e=this._range.getRenderSize(this._panel);this._size=new wijmo_1.Size(pdf.pxToPt(e.width),pdf.pxToPt(e.height))}return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"range",{get:function(){return this._range},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"panel",{get:function(){return this._panel},enumerable:!0,configurable:!0}),e.prototype.isRenderableRow=function(e){return e.isVisible},e}(),PanelSectionRenderer=function(e){function t(t,o,r,n){var i=e.call(this,o,r)||this;return i._gr=t,i._borderWidth=n,i}return __extends(t,e),Object.defineProperty(t.prototype,"gr",{get:function(){return this._gr},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"renderSize",{get:function(){return null==this._renderSize&&(this._renderSize=this.size.clone(),this.visibleColumns>1&&(this._renderSize.width-=this._borderWidth*(this.visibleColumns-1)),this.visibleRows>1&&(this._renderSize.height-=this._borderWidth*(this.visibleRows-1))),this._renderSize},enumerable:!0,configurable:!0}),t.prototype.getRangeWidth=function(e,t){for(var o=0,r=0,n=this.panel,i=e;i<=t;i++){var l=n.columns[i];l.isVisible&&(r++,o+=l.renderWidth)}return o=pdf.pxToPt(o),r>1&&(o-=this._borderWidth*(r-1)),o},t.prototype.getRangeHeight=function(e,t){for(var o=0,r=0,n=this.panel,i=e;i<=t;i++){var l=n.rows[i];this.isRenderableRow(l)&&(r++,o+=l.renderHeight)}return o=pdf.pxToPt(o),r>1&&(o-=this._borderWidth*(r-1)),o},t.prototype.getCellsCount=function(){var e=this,t=0,o=this.range,r=this.panel,n=new GetMergedRangeProxy(this._gr.flex);return o.isValid?(o.forEach(r,function(i,l,s){if(e.isRenderableRow(i))for(var a=o.leftCol;a<=o.rightCol;a++){var u=!1,c=void 0;if(r.columns[a].isVisible){var d;(d=n.getMergedRange(r,s,a))?d.topRow!==d.bottomRow?d.firstVisibleRow!==s&&s!==l.topRow||(u=!0):(u=!0,c=Math.min(o.rightCol,d.rightCol)):u=!0,u&&t++,c&&(a=c)}}}),t):t},t.prototype.render=function(e,t,o,r){var n=this,i=this.range,l=this.panel,s=new GetMergedRangeProxy(this._gr.flex),a=new _CellRange(l,0,0,0,0),u=new CellRenderer(this,e,this._borderWidth);if(i.isValid){for(var c={},d=i.leftCol;d<=i.rightCol;d++)c[d]=o;i.forEach(l,function(e,o,d){if(n.isRenderableRow(e))for(var p=t,f=i.leftCol;f<=i.rightCol;f++){var h,g=n.gr.getColumn(l,d,f),_=void 0,w=void 0,b=!1,m=void 0;if(l.columns[f].isVisible){var y,C=n._gr.flex.getCellContent(n.panel,e,g,f);if(y=s.getMergedRange(l,d,f))if(a.copyFrom(y),y.topRow!==y.bottomRow)y.firstVisibleRow===d||d===o.topRow?(b=!0,h=n.gr.settings.repeatMergedValuesAcrossPages?C:y.firstVisibleRow===d?C:"",_=n.getRangeHeight(d,Math.min(y.bottomRow,o.bottomRow)),w=n.getRangeWidth(f,f)):w=n.getRangeWidth(f,f);else{b=!0,h=n.gr.settings.repeatMergedValuesAcrossPages?C:f===y.leftCol?C:"",_=n.getRangeHeight(d,d),w=n.getRangeWidth(Math.max(i.leftCol,y.leftCol),Math.min(i.rightCol,y.rightCol)),m=Math.min(i.rightCol,y.rightCol);for(var R=f+1;R<=m;R++)c[R]+=_-n._borderWidth}else a.setRange(d,f,d,f),b=!0,h=C,_=n.getRangeHeight(d,d),w=n.getRangeWidth(f,f);b&&(u.renderCell(h,e,g,a,new wijmo_1.Rect(p,c[f],w,_)),r&&r()),_&&(c[f]+=_-n._borderWidth),w&&(p+=w-n._borderWidth),m&&(f=m)}}})}},t.prototype.isRenderableRow=function(e){return this._gr.isRenderableRow(e)},t}(PanelSection),CellRenderer=function(){function e(e,t,o){this._pr=e,this._area=t,this._borderWidth=o}return e.prototype.renderCell=function(e,t,o,r,n){var i,l=this._pr.gr.flex,s=this._pr.panel,a=function(){return l.getCell(s,r.topRow,r.leftCol)},u=null,c=this._pr.gr.getCellStyle(s,t,o),d=this._pr.gr.settings.customCellContent;if(d){var p=l.getComputedStyle(u=a());c.color=p.color,c.backgroundColor=p.backgroundColor,c.borderColor=p.borderColor||p.borderRightColor||p.borderBottomColor||p.borderLeftColor||p.borderTopColor,c.font=new pdf.PdfFont(p.fontFamily,pdf._asPt(p.fontSize,!0,void 0),p.fontStyle,p.fontWeight),c.textAlign=p.textAlign}if(c.font&&!(c.font instanceof pdf.PdfFont)){var f=c.font;c.font=new pdf.PdfFont(f.family,f.size,f.style,f.weight)}if(c.boxSizing="border-box",c.borderWidth=this._borderWidth,c.borderStyle="solid",d||this._pr.gr.isExpandableGroupRow(t)&&s.columns.firstVisibleIndex===o.visibleIndex||(c.textAlign=o.getAlignment()),s.cellType===_CellType.Cell&&l.rows.maxGroupLevel>=0&&r.leftCol===l.columns.firstVisibleIndex){var h=l.isGroupRow(t)?Math.max(t.level,0):l.rows.maxGroupLevel+1,g=pdf._asPt(c.paddingLeft||c.padding),_=pdf.pxToPt(h*l.treeIndent);c.paddingLeft=g+_}var w,b=this._measureCell(e,s,t,o,c,n),m=r.rowSpan>1&&r.visibleRowsCount>1&&this._pr.gr.alignMergedTextToTheTopRow(s);m&&(w=new wijmo_1.Rect(b.contentRect.left,b.contentRect.top,b.contentRect.width,b.contentRect.height/(r.visibleRowsCount||1)),b.textRect=this._calculateTextRect(e,s,t,o,w,c)),wijmo_1.isFunction(this._pr.gr.settings.formatItem)&&((i=new PdfFormatItemEventArgs(s,r,u,this._area,b.rect,b.contentRect,b.textRect.top,c,function(){return u||a()})).data=e,this._pr.gr.settings.formatItem(i),i.data!==e&&(e=wijmo_1.asString(i.data),b.textRect=this._calculateTextRect(e,s,t,o,m?w:b.contentRect,c))),this._renderCell(e,t,o,r,b,c,!i||!i.cancel,!i||!i.cancelBorders)},e.prototype._renderCell=function(e,t,o,r,n,i,l,s){(l||s)&&(this._isBooleanCellAndValue(e,this._pr.panel,t,o)?this._renderBooleanCell(e,n,i,l,s):this._renderTextCell(e,n,i,l,s))},e.prototype._isBooleanCellAndValue=function(e,t,o,r){return this._pr.gr.isBooleanCell(t,o,r)&&this._isBoolean(e)},e.prototype._isBoolean=function(e){var t=wijmo_1.isString(e)&&e.toLowerCase();return"true"===t||"false"===t||!0===e||!1===e},e.prototype._measureCell=function(e,t,o,r,n,i){this._decompositeStyle(n);var l=i.left,s=i.top,a=i.height,u=i.width,c=this._parseBorder(n),d=c.left.width,p=c.top.width,f=c.bottom.width,h=c.right.width,g=this._parsePadding(n),_=0,w=0,b=0,m=0;if("content-box"===n.boxSizing||void 0===n.boxSizing)_=g.top+a+g.bottom,w=g.left+u+g.right,b=a,m=u;else{if("border-box"!==n.boxSizing)throw"Invalid value: "+n.boxSizing;pdf._IE&&n instanceof CSSStyleDeclaration?(_=g.top+g.bottom+a,w=g.left+g.right+u):(_=a-p-f,w=u-d-h),b=_-g.top-g.bottom,m=w-g.left-g.right}i=new wijmo_1.Rect(l,s,u,a);var y=new wijmo_1.Rect(l+d,s+p,w,_),C=new wijmo_1.Rect(l+d+g.left,s+p+g.top,m,b);return{rect:i,clientRect:y,contentRect:C,textRect:this._calculateTextRect(e,t,o,r,C,n)}},e.prototype._decompositeStyle=function(e){var t;e&&((t=e.borderColor)&&(e.borderLeftColor||(e.borderLeftColor=t),e.borderRightColor||(e.borderRightColor=t),e.borderTopColor||(e.borderTopColor=t),e.borderBottomColor||(e.borderBottomColor=t)),(t=e.borderWidth)&&(e.borderLeftWidth||(e.borderLeftWidth=t),e.borderRightWidth||(e.borderRightWidth=t),e.borderTopWidth||(e.borderTopWidth=t),e.borderBottomWidth||(e.borderBottomWidth=t)),(t=e.borderStyle)&&(e.borderLeftStyle||(e.borderLeftStyle=t),e.borderRightStyle||(e.borderRightStyle=t),e.borderTopStyle||(e.borderTopStyle=t),e.borderBottomStyle||(e.borderBottomStyle=t)),(t=e.padding)&&(e.paddingLeft||(e.paddingLeft=t),e.paddingRight||(e.paddingRight=t),e.paddingTop||(e.paddingTop=t),e.paddingBottom||(e.paddingBottom=t)))},e.prototype._parseBorder=function(e){var t={left:{width:0},top:{width:0},bottom:{width:0},right:{width:0}};return"none"!==e.borderLeftStyle&&(t.left={width:pdf._asPt(e.borderLeftWidth),style:e.borderLeftStyle,color:e.borderLeftColor}),"none"!==e.borderTopStyle&&(t.top={width:pdf._asPt(e.borderTopWidth),style:e.borderTopStyle,color:e.borderTopColor}),"none"!==e.borderBottomStyle&&(t.bottom={width:pdf._asPt(e.borderBottomWidth),style:e.borderBottomStyle,color:e.borderBottomColor}),"none"!==e.borderRightStyle&&(t.right={width:pdf._asPt(e.borderRightWidth),style:e.borderRightStyle,color:e.borderRightColor}),t},e.prototype._parsePadding=function(e){return{left:pdf._asPt(e.paddingLeft),top:pdf._asPt(e.paddingTop),bottom:pdf._asPt(e.paddingBottom),right:pdf._asPt(e.paddingRight)}},e.prototype._renderEmptyCell=function(e,t,o,r){var n=e.rect.left,i=e.rect.top,l=e.clientRect.width,s=e.clientRect.height,a=e.clientRect.left-e.rect.left,u=e.clientRect.top-e.rect.top,c=e.rect.top+e.rect.height-(e.clientRect.top+e.clientRect.height),d=e.rect.left+e.rect.width-(e.clientRect.left+e.clientRect.width);if(r&&(a||d||c||u)){var p=t.borderLeftColor||t.borderColor,f=t.borderRightColor||t.borderColor,h=t.borderTopColor||t.borderColor,g=t.borderBottomColor||t.borderColor;if(a&&u&&c&&d&&a===d&&a===c&&a===u&&p===f&&p===g&&p===h){var _=a,w=_/2;this._area.paths.rect(n+w,i+w,l+_,s+_).stroke(new pdf.PdfPen(p,_))}else a&&this._area.paths.polygon([[n,i],[n+a,i+u],[n+a,i+u+s],[n,i+u+s+c]]).fill(p),u&&this._area.paths.polygon([[n,i],[n+a,i+u],[n+a+l,i+u],[n+a+l+d,i]]).fill(h),d&&this._area.paths.polygon([[n+a+l+d,i],[n+a+l,i+u],[n+a+l,i+u+s],[n+a+l+d,i+u+s+c]]).fill(f),c&&this._area.paths.polygon([[n,i+u+s+c],[n+a,i+u+s],[n+a+l,i+u+s],[n+a+l+d,i+u+s+c]]).fill(g)}o&&t.backgroundColor&&l>0&&s>0&&this._area.paths.rect(n+a,i+u,l,s).fill(t.backgroundColor)},e.prototype._renderBooleanCell=function(e,t,o,r,n){if(this._renderEmptyCell(t,o,r,n),r){var i=t.textRect.left,l=t.textRect.top,s=t.textRect.height;if(this._area.paths.rect(i,l,s,s).fillAndStroke(wijmo_1.Color.fromRgba(255,255,255),new pdf.PdfPen(void 0,.5)),!0===wijmo_1.changeType(e,wijmo_1.DataType.Boolean,"")){var a=s/20,u=s-.5-2*a,c=s/8;this._area.document.saveState(),this._area.translate(i+.25+a,l+.25+a).paths.moveTo(c/2,.6*u).lineTo(u-.6*u,u-c).lineTo(u-c/2,c/2).stroke(new pdf.PdfPen(void 0,c)),this._area.document.restoreState()}}},e.prototype._renderTextCell=function(e,t,o,r,n){this._renderEmptyCell(t,o,r,n),r&&e&&this._area.drawText(e,t.textRect.left,t.textRect.top,{brush:o.color,font:o.font,height:t.textRect.height,width:t.textRect.width,align:"center"===o.textAlign?pdf.PdfTextHorizontalAlign.Center:"right"===o.textAlign?pdf.PdfTextHorizontalAlign.Right:"justify"===o.textAlign?pdf.PdfTextHorizontalAlign.Justify:pdf.PdfTextHorizontalAlign.Left})},e.prototype._calculateTextRect=function(e,t,o,r,n,i){var l=n.clone();if(this._isBooleanCellAndValue(e,t,o,r)){var s=this._getTextLineHeight(i.font);switch(i.verticalAlign){case"middle":l.top=n.top+n.height/2-s/2;break;case"bottom":l.top=n.top+n.height-s}switch(i.textAlign){case"justify":case"center":l.left=n.left+n.width/2-s/2;break;case"right":l.left=n.left+n.width-s}l.height=l.width=s}else if(l.height>0&&l.width>0){switch(i.verticalAlign){case"bottom":(a=this._area.measureText(e,i.font,{height:l.height,width:l.width})).size.height<l.height&&(l.top+=l.height-a.size.height,l.height=a.size.height);break;case"middle":var a;(a=this._area.measureText(e,i.font,{height:l.height,width:l.width})).size.height<l.height&&(l.top+=l.height/2-a.size.height/2,l.height=a.size.height)}r.wordWrap||(l.height=this._getTextLineHeight(i.font))}return l},e.prototype._getTextLineHeight=function(e){return this._area.lineHeight(e)},e}(),GetMergedRangeProxy=function(){function e(e){this._columns={},this._flex=e}return e.prototype.getMergedRange=function(e,t,o){var r=this._columns[o];if(r&&t>=r.topRow&&t<=r.bottomRow)return r;var n=this._flex.getMergedRange(e,t,o);return this._columns[o]=n?new _CellRange(e,n):null},e}(),_CellRange=function(){function e(e,t,o,r,n){if("number"==typeof t?(this._row=t,this._col=o,this._row2=r,this._col2=n):(this._row=t.row,this._col=t.col,this._row2=t.row2,this._col2=t.col2),this.firstVisibleRow=-1,this.visibleRowsCount=0,e){var i=this.topRow,l=this.bottomRow,s=e.rows.length;if(s>0)for(var a=i;a<=l&&a<s;a++)e.rows[a].isVisible&&(this.firstVisibleRow<0&&(this.firstVisibleRow=a),this.visibleRowsCount++)}}return Object.defineProperty(e.prototype,"row",{get:function(){return this._row},set:function(e){this._row=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"col",{get:function(){return this._col},set:function(e){this._col=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"row2",{get:function(){return this._row2},set:function(e){this._row2=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"col2",{get:function(){return this._col2},set:function(e){this._col2=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"topRow",{get:function(){return Math.min(this._row,this._row2)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bottomRow",{get:function(){return Math.max(this._row,this._row2)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"leftCol",{get:function(){return Math.min(this._col,this._col2)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rightCol",{get:function(){return Math.max(this._col,this._col2)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rowSpan",{get:function(){return Math.abs(this._row2-this._row)+1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isValid",{get:function(){return this._row>-1&&this._col>-1&&this._row2>-1&&this._col2>-1},enumerable:!0,configurable:!0}),e.prototype.copyFrom=function(e){this.setRange(e.row,e.col,e.row2,e.col2),this.firstVisibleRow=e.firstVisibleRow,this.visibleRowsCount=e.visibleRowsCount},e.prototype.clone=function(){return new e(null,this._row,this._col,this._row2,this._col2)},e.prototype.getRenderSize=function(e){var t=new wijmo_1.Size(0,0);if(this.isValid){for(var o=this.topRow;o<=this.bottomRow;o++)t.height+=e.rows[o].renderHeight;for(var r=this.leftCol;r<=this.rightCol;r++)t.width+=e.columns[r].renderWidth}return t},e.prototype.setRange=function(e,t,o,r){void 0===e&&(e=-1),void 0===t&&(t=-1),void 0===o&&(o=e),void 0===r&&(r=t),this._row=wijmo_1.asInt(e),this._col=wijmo_1.asInt(t),this._row2=wijmo_1.asInt(o),this._col2=wijmo_1.asInt(r)},e}();exports._CellRange=_CellRange;var _fc,RowRange=function(){function e(e){this._ranges=e||[]}return e.prototype.length=function(){for(var e=0,t=0;t<this._ranges.length;t++){var o=this._ranges[t];o.isValid&&(e+=o.bottomRow-o.topRow+1)}return e},Object.defineProperty(e.prototype,"isValid",{get:function(){return this._ranges.length&&this._ranges[0].isValid},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"leftCol",{get:function(){return this._ranges.length?this._ranges[0].leftCol:-1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rightCol",{get:function(){return this._ranges.length?this._ranges[0].rightCol:-1},enumerable:!0,configurable:!0}),e.prototype.clone=function(t,o){for(var r=[],n=0;n<this._ranges.length;n++){var i=this._ranges[n].clone();arguments.length>0&&(i.col=t),arguments.length>1&&(i.col2=o),r.push(i)}return new e(r)},e.prototype.getRenderSize=function(e){for(var t=new wijmo_1.Size(0,0),o=0;o<this._ranges.length;o++){var r=this._ranges[o].getRenderSize(e);t.width=Math.max(t.width,r.width),t.height+=r.height}return t},e.prototype.forEach=function(e,t){for(var o=0,r=0;r<this._ranges.length;r++){var n=this._ranges[r];if(n.isValid)for(var i=n.topRow;i<=n.bottomRow;i++)t(e.rows[i],n,i,o++)}},e.prototype.subrange=function(t,o,r,n){var i=[];if(t>=0&&o>0)for(var l=0,s=0,a=0;a<this._ranges.length&&o>0;a++,l=s+1){var u=this._ranges[a];if(!(t>(s=l+(u.bottomRow-u.topRow)))){var c=t>l?u.topRow+(t-l):u.topRow,d=Math.min(u.bottomRow,c+o-1),p=arguments.length>2?r:u.leftCol,f=arguments.length>2?n:u.rightCol;i.push(new _CellRange(null,c,p,d,f)),o-=d-c+1}}return new e(i)},e}(),PdfPageRowRange=function(){function e(e,t,o){this._col=t,this._row=o,this._range=e}return Object.defineProperty(e.prototype,"range",{get:function(){return this._range},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pageCol",{get:function(){return this._col},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pageRow",{get:function(){return this._row},enumerable:!0,configurable:!0}),e}();function getFakeCell(){return _fc||(_fc=document.createElement("div"),softGrid()&&_fc.setAttribute(softGrid().FlexGrid._WJS_MEASURE,"true"),document&&document.body&&document.body.appendChild(_fc)),_fc.className="",_fc.innerHTML="",_fc.style.cssText="",_fc.style.visibility="hidden",_fc}function _removeFakeCell(){_fc&&(wijmo_1.removeChild(_fc),_fc=null)}exports._removeFakeCell=_removeFakeCell;var FlexGridPdfConverter=function(){function e(){}return e.draw=function(e,t,o,r,n){this.drawToPosition(e,t,null,o,r,n)},e.drawToPosition=function(e,t,o,r,n,i){wijmo_1.assert(!!e,"The flex argument cannot be null."),wijmo_1.assert(!!t,"The doc argument cannot be null.");var l=softGrid()&&e instanceof softGrid().FlexGrid;try{i=_FlexGridPdfCoreConverter._applyDefaultDrawSettings(i);var s=e;l&&(i&&i.recalculateStarWidths&&e.columns._updateStarSizes(pdf.ptToPx(t.width)),s=this._getFlexGridAdapter(e,i)),_FlexGridPdfCoreConverter.draw(s,t,o,r,n,i)}finally{_removeFakeCell(),l&&i&&i.recalculateStarWidths&&e.invalidate(!0)}},e.export=function(e,t,o){wijmo_1.assert(!!e,"The flex argument cannot be null."),wijmo_1.assert(!!t,"The fileName argument cannot be empty.");var r=(o=this._applyDefaultExportSettings(o)).documentOptions.ended;o.documentOptions.ended=function(e,i){o.progress&&o.progress(1),r&&!1===r.apply(n,[e,i])||pdf.saveBlob(i.blob,t),e.dispose()};var n=new pdf.PdfDocument(o.documentOptions);this.drawToPosition(e,n,null,null,null,o),n.end()},e._getFlexGridAdapter=function(e,t){return new(softMultiRow()&&e instanceof softMultiRow().MultiRow&&MultiRowAdapter||softSheet()&&e instanceof softSheet().FlexSheet&&FlexSheetAdapter||softOlap()&&e instanceof softOlap().PivotGrid&&PivotGridAdapter||FlexGridAdapter)(e,t)},e._applyDefaultExportSettings=function(e){return _merge(_merge({},e),this._DefaultExportSettings)},e._DefaultExportSettings=_merge({scaleMode:ScaleMode.PageWidth,documentOptions:{compress:!1,pageSettings:{margins:{left:36,right:36,top:18,bottom:18}}},_progressMax:.9},_FlexGridPdfCoreConverter.DefaultDrawSettings),e}();exports.FlexGridPdfConverter=FlexGridPdfConverter;var PdfWebWorkerResponseStatus,FlexGridAdapter=function(){function e(e,t){this._flex=e,this._settings=t}return Object.defineProperty(e.prototype,"flex",{get:function(){return this._flex},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"settings",{get:function(){return this._settings},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"columns",{get:function(){return this._flex.columns},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rows",{get:function(){return this._flex.rows},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bottomLeftCells",{get:function(){return this._flex.bottomLeftCells},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cells",{get:function(){return this._flex.cells},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"columnFooters",{get:function(){return this._flex.columnFooters},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"columnHeaders",{get:function(){return this._flex.columnHeaders},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rowHeaders",{get:function(){return this._flex.rowHeaders},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"topLeftCells",{get:function(){return this._flex.topLeftCells},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"treeIndent",{get:function(){return this._flex.treeIndent},enumerable:!0,configurable:!0}),e.prototype.getSelection=function(){var e=[],t=this._flex.selection,o=softGrid();switch(this._flex.selectionMode){case o.SelectionMode.None:break;case o.SelectionMode.Cell:case o.SelectionMode.CellRange:e.push(t);break;case o.SelectionMode.Row:e.push(new o.CellRange(t.topRow,0,t.topRow,this._flex.cells.columns.length-1));break;case o.SelectionMode.RowRange:e.push(new o.CellRange(t.topRow,0,t.bottomRow,this._flex.cells.columns.length-1));break;case o.SelectionMode.ListBox:for(var r=-1,n=0;n<this._flex.rows.length;n++){this._flex.rows[n].isSelected?(r<0&&(r=n),n===this._flex.rows.length-1&&e.push(new o.CellRange(r,0,n,this._flex.cells.columns.length-1))):(r>=0&&e.push(new o.CellRange(r,0,n-1,this._flex.cells.columns.length-1)),r=-1)}}return e},e.prototype.getCell=function(e,t,o){var r=e.getCellElement(t,o);return r||(r=getFakeCell(),this._flex.cellFactory.updateCell(e,t,o,r)),r},e.prototype.getComputedStyle=function(e){return e.className=e.className.replace("wj-state-selected",""),e.className=e.className.replace("wj-state-multi-selected",""),window.getComputedStyle(e)},e.prototype.getMergedRange=function(e,t,o){return this._flex.getMergedRange(e,t,o,!1)},Object.defineProperty(e.prototype,"showColumnHeader",{get:function(){return!!(this._flex.headersVisibility&softGrid().HeadersVisibility.Column)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"showRowHeader",{get:function(){return!!(this._flex.headersVisibility&softGrid().HeadersVisibility.Row)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"showColumnFooter",{get:function(){return this._flex.columnFooters.rows.length>0},enumerable:!0,configurable:!0}),e.prototype.alignMergedTextToTheTopRow=function(e){return!1},e.prototype.getCellData=function(e,t,o){return e.getCellData(o,t,!0)},e.prototype.getCellContent=function(e,t,o,r){var n,i=this.getCellData(e,r,t.index),l=o.isContentHtml,s=softGrid();if(!i&&e.cellType===s.CellType.Cell){var a=t;a instanceof s.GroupRow&&a.dataItem&&a.dataItem.groupDescription&&o.index===e.columns.firstVisibleIndex&&(l=!0,i=a.getGroupHeader())}this.settings.customCellContent?!(i=(n=this.getCell(e,t.index,r)).textContent.trim())&&this.isBooleanCell(e,t,o)&&(i=null==(i=this._extractCheckboxValue(n))?"":i+""):l&&((n=getFakeCell()).innerHTML=i,i=n.textContent.trim());return i},e.prototype.isBooleanCell=function(e,t,o){return o.dataType===wijmo_1.DataType.Boolean&&e.cellType===softGrid().CellType.Cell&&(!this.isExpandableGroupRow(t)||o.visibleIndex!==e.columns.firstVisibleIndex)},e.prototype.getColumn=function(e,t,o){return e.columns[o]},e.prototype.isAlternatingRow=function(e){return e.index%2!=0},e.prototype.isGroupRow=function(e){return e instanceof softGrid().GroupRow},e.prototype.isNewRow=function(e){return e instanceof softGrid()._NewRowTemplate},e.prototype.isDetailRow=function(e){return softDetail()&&e instanceof softDetail().DetailRow},e.prototype.isExpandableGroupRow=function(e){return e instanceof softGrid().GroupRow&&e.hasChildren},e.prototype.getCellStyle=function(e,t,o){var r=this.settings.styles,n=_merge({},r.cellStyle),i=this._flex,l=softGrid();switch(e.cellType){case l.CellType.Cell:this.isExpandableGroupRow(t)?_merge(n,r.groupCellStyle,!0):this.isAlternatingRow(t)&&_merge(n,r.altCellStyle,!0);break;case l.CellType.ColumnHeader:case l.CellType.RowHeader:case l.CellType.TopLeft:case l.CellType.BottomLeft:_merge(n,r.headerCellStyle,!0);break;case l.CellType.ColumnFooter:_merge(n,r.headerCellStyle,!0),_merge(n,r.footerCellStyle,!0)}return!this.settings.customCellContent&&i._getShowErrors()&&i._getError(e,t.index,o.index)&&_merge(n,r.errorCellStyle,!0),n},e.prototype._extractCheckboxValue=function(e){var t=e.querySelector("input[type=checkbox]");if(t&&("none"!==window.getComputedStyle(t).display&&"hidden"!==t.style.visibility))return t.checked},e}(),FlexSheetAdapter=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.getCellData=function(t,o,r){return t.cellType===softGrid().CellType.Cell?t.rows[r]instanceof softSheet().HeaderRow?this.flex.columnHeaders.getCellData(r,o,!0):this.flex.getCellValue(r,o,!0):e.prototype.getCellData.call(this,t,o,r)},t.prototype.getCellStyle=function(t,o,r){var n=e.prototype.getCellStyle.call(this,t,o,r),i=this.flex.selectedSheet.findTable(o.index,r.index);if(i){var l=i.getRange(),s=o.index-l.topRow,a=r.index-l.leftCol,u=i._getTableCellAppliedStyles(s,a);u&&(u.font=new pdf.PdfFont(u.fontFamily,pdf._asPt(u.fontSize,!0,void 0),u.fontStyle,u.fontWeight)),_merge(n,u,!0)}return n},Object.defineProperty(t.prototype,"showColumnHeader",{get:function(){return!1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"showRowHeader",{get:function(){return!1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"showColumnFooter",{get:function(){return!1},enumerable:!0,configurable:!0}),t}(FlexGridAdapter),MultiRowAdapter=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.getColumn=function(e,t,o){return this.flex.getBindingColumn(e,t,o)},t.prototype.isAlternatingRow=function(t){return t instanceof softMultiRow()._MultiRow?t.dataIndex%2!=0:e.prototype.isAlternatingRow.call(this,t)},t}(FlexGridAdapter),PivotGridAdapter=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.alignMergedTextToTheTopRow=function(e){var t=softGrid();return!this.flex.centerHeadersVertically&&(e.cellType===t.CellType.ColumnHeader||e.cellType===t.CellType.RowHeader)},t}(FlexGridAdapter);!function(e){e[e.Done=1]="Done",e[e.Progress=2]="Progress"}(PdfWebWorkerResponseStatus||(PdfWebWorkerResponseStatus={}));var DefGridName="",PdfWebWorkerExportDoneEventArgs=function(e){function t(t){var o=e.call(this)||this;return o._buf=t,o}return __extends(t,e),Object.defineProperty(t.prototype,"blob",{get:function(){return this._blob||(this._blob=new Blob([new Uint8Array(this._buf)],{type:"application/pdf"})),this._blob},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"buffer",{get:function(){return this._buf},enumerable:!0,configurable:!0}),t}(wijmo_1.EventArgs);exports.PdfWebWorkerExportDoneEventArgs=PdfWebWorkerExportDoneEventArgs;var PdfWebWorkerClient=function(){function e(){}return e.exportGrid=function(e,t,o,r,n,i){(r=_merge({},r)).progress=r.progress||i,this.addGrid(e,t,DefGridName,r),this.export(e,r.documentOptions,function(e){wijmo_1.isFunction(n)&&!1===n(e)||pdf.saveBlob(e.blob,o)},i)},e.export=function(e,t,o,r){e.addEventListener("message",function t(n){var i=n.data;switch(i.status){case PdfWebWorkerResponseStatus.Done:e.removeEventListener("message",t),wijmo_1.isFunction(o)&&o(new PdfWebWorkerExportDoneEventArgs(i.data));break;case PdfWebWorkerResponseStatus.Progress:r&&r(i.data);break;default:throw"Unknown status: "+i.status}});var n=this._clientDataToArrayBuffer(e);e.postMessage({content:n,settings:t},[n]),this._clearClientData(e)},e.addGrid=function(e,t,o,r){var n=this._gridToJson(t,r);this._addClientData(e,JSON.stringify(n),o,r,!0)},e.addImage=function(e,t,o,r){var n=wijmo_1.isString(t)&&t.indexOf("data:image/svg")>=0?t:pdf._PdfImageHelper.getDataUri(t);this._addClientData(e,n,o,r)},e.addString=function(e,t,o){this._addClientData(e,t,o,null)},e.serializeGrid=function(e,t){var o=this._gridToJson(e,t);return strToBuf(JSON.stringify(o))},e._addClientData=function(e,t,o,r,n){void 0===n&&(n=!1),wijmo_1.asType(e,Worker),wijmo_1.asString(o),wijmo_1.asString(t,!0);var i=e;i.clientData=i.clientData||{},i.clientData[o]={content:t,settings:r?JSON.stringify(r):null};var l=i.clientData[o];n&&(l.isGrid=!0,l.progressMessaging=wijmo_1.isFunction(r.progress))},e._clearClientData=function(e){delete e.clientData},e._clientDataToArrayBuffer=function(e){var t=e;return strToBuf(JSON.stringify(t.clientData||{}))},e._gridToJson=function(e,t){var o;t=FlexGridPdfConverter._applyDefaultExportSettings(t);try{o=new pdf.PdfDocument(t.documentOptions),t&&t.recalculateStarWidths&&e.columns._updateStarSizes(pdf.ptToPx(o.width));var r=this._getJsonConverter(e,t).convert();strToBuf(JSON.stringify(r));return r}finally{_removeFakeCell(),t&&t.recalculateStarWidths&&e.invalidate(!0),null!=o&&(o.dispose(),o=null)}},e._getJsonConverter=function(e,t){return new(softMultiRow()&&e instanceof softMultiRow().MultiRow&&MultiRowJsonConverter||softOlap()&&e instanceof softOlap().PivotGrid&&PivotGridJsonConverter||FlexGridJsonConverter)(e,FlexGridPdfConverter._getFlexGridAdapter(e,t))},e}();exports.PdfWebWorkerClient=PdfWebWorkerClient;var RowState,ColState,PdfWebWorker=function(){function e(){}return e.initExportGrid=function(){var e=this;this.initExport(function(t,o){var r=o[DefGridName];r.progressMessaging&&(r.settings._progressMax=FlexGridPdfConverter._DefaultExportSettings._progressMax,r.settings.progress=function(t){e.sendExportProgress(t)},t.ended.addHandler(function(){e.sendExportProgress(1)})),FlexGridPdfConverter.draw(r.content,t,null,null,r.settings),t.end()})},e.initExport=function(t){self.addEventListener("message",function o(r){self.removeEventListener("message",o);var n=r.data,i=JSON.parse(bufToStr(n.content)),l=n.settings||{};l.ended=function(e,t){blobToBuf(t.blob,function(e){self.postMessage({data:e,status:PdfWebWorkerResponseStatus.Done},[e])})};var s=new pdf.PdfDocument(l);Object.keys(i).forEach(function(t){var o=i[t];o.settings&&(o.settings=JSON.parse(o.settings)),o.isGrid&&(o.settings&&e._disableUnsupportedFeatures(o.settings),o.content=e._deserializeGridFromString(o.content,o.settings))}),t(s,i)})},e.sendExportProgress=function(e){e=wijmo_1.clamp(e,0,1),self.postMessage({data:e,status:PdfWebWorkerResponseStatus.Progress})},e.deserializeGrid=function(e,t){return this._deserializeGridFromString(bufToStr(e),t)},e._deserializeGridFromString=function(e,t){return this._getJsonAdapter(JSON.parse(e),FlexGridPdfConverter._applyDefaultExportSettings(t))},e._disableUnsupportedFeatures=function(e){e.customCellContent=!1},e._getJsonAdapter=function(e,t){switch(e.typeName){case"MultiRow":return new MultiRowJsonAdapter(e,t);case"PivotGrid":return new PivotGridJsonAdapter(e,t);default:return new FlexGridJsonAdapter(e,t)}},e}();function bufToStr(e){for(var t=new Uint16Array(e),o="",r=0,n=t.length;r<n;r++)o+=String.fromCharCode(t[r]);return o}function strToBuf(e){for(var t=new ArrayBuffer(2*e.length),o=new Uint16Array(t),r=0,n=e.length;r<n;r++)o[r]=e.charCodeAt(r);return t}function blobToBuf(e,t){wijmo_1.asFunction(t);var o=new FileReader;o.onload=function(e){t(e.target.result)},o.readAsArrayBuffer(e)}exports.PdfWebWorker=PdfWebWorker,function(e){e[e.None=0]="None",e[e.Alternate=1]="Alternate",e[e.Group=2]="Group",e[e.ExpandableGroup=4]="ExpandableGroup",e[e.New=8]="New",e[e.Visible=16]="Visible",e[e.Detail=32]="Detail"}(RowState||(RowState={})),function(e){e[e.None=0]="None",e[e.Visible=1]="Visible"}(ColState||(ColState={}));var FlexGridJsonConverter=function(){function e(e,t){this._flex=e,this._adapter=t}return e.prototype.convert=function(){var e={};return e.typeName=this._getTypeName(this._flex),e.selection=this._serializeSelection(),e.showColumnFooter=this.adapter.showColumnFooter,e.showColumnHeader=this.adapter.showColumnHeader,e.showRowHeader=this.adapter.showRowHeader,e.treeIndent=this._flex.treeIndent,e.bottomLeftCells=this._serializePanel(this._flex.bottomLeftCells),e.cells=this._serializePanel(this._flex.cells),e.columnFooters=this._serializePanel(this._flex.columnFooters),e.columnHeaders=this._serializePanel(this._flex.columnHeaders),e.rowHeaders=this._serializePanel(this._flex.rowHeaders),e.topLeftCells=this._serializePanel(this._flex.topLeftCells),e},Object.defineProperty(e.prototype,"adapter",{get:function(){return this._adapter},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"flex",{get:function(){return this._flex},enumerable:!0,configurable:!0}),e.prototype._getTypeName=function(e){return e.constructor.toString().match(/function\s*(\w+)/)[1]},e.prototype._getRowState=function(e){var t=RowState.None;return this.adapter.isAlternatingRow(e)&&(t|=RowState.Alternate),e instanceof softGrid().GroupRow&&(t|=RowState.Group),this.adapter.isDetailRow(e)&&(t|=RowState.Detail),this.adapter.isExpandableGroupRow(e)&&(t|=RowState.ExpandableGroup),e instanceof softGrid()._NewRowTemplate&&(t|=RowState.New),e.isVisible&&(t|=RowState.Visible),t},e.prototype._getColumnState=function(e){var t=ColState.None;return e.isVisible&&(t|=ColState.Visible),t},e.prototype._serializeSelection=function(){for(var e=this.adapter.getSelection(),t=[],o=0;o<e.length;o++){var r=e[o];t.push([r.row,r.col,r.row2,r.col2])}return t},e.prototype._serializeColumns=function(e){for(var t=[],o=0,r=(e||[]).length;o<r;o++){var n=e[o],i={aggregate:n.aggregate,alignment:n.getAlignment(),dataType:n.dataType,renderWidth:n.renderWidth,wordWrap:n.wordWrap,visibleIndex:n.visibleIndex},l=this._getColumnState(n);l!==ColState.None&&(i.state=l),t.push(i)}return t},e.prototype._serializePanel=function(e){var t={cellType:e.cellType,height:e.height,width:e.width};t.mergedRanges=this._serializeMergedRanges(e),t.columns=this._serializeColumns(e.columns),t.columnsFirstVisibleIndex=e.columns.firstVisibleIndex,t.rows=[],t.rowsMaxGroupLevel=e.rows.maxGroupLevel;for(var o=0,r=e.rows.length,n=e.columns.length;o<r;o++){var i=e.rows[o],l={renderHeight:i.renderHeight};t.rows.push(l),i instanceof softGrid().GroupRow&&(l.level=i.level);var s=this._getRowState(i);s!==RowState.None&&(l.state=s),l.cells=[];for(var a=0;a<n;a++)l.cells[a]=this._adapter.getCellContent(e,e.rows[o],e.columns[a],a)}return t},e.prototype._serializeMergedRanges=function(e){for(var t=[],o=[],r=0;r<e.columns.length;r++)o[r]=0;for(var n=0;n<e.rows.length;n++)for(var i=0;i<e.columns.length;i++)if(!(n<o[i])){var l=e.grid.getMergedRange(e,n,i);if(null!=l&&!l.isSingleCell){t.push([l.row,l.col,l.row2,l.col2]);for(var s=l.col;s<=l.col2;s++)o[s]=l.row2+1;l.col===l.col2||(i=l.col2)}}return t},e}(),MultiRowJsonConverter=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.convert=function(){var t=e.prototype.convert.call(this);return t.rowsPerItem=this.flex.rowsPerItem,t},t.prototype._serializePanel=function(t){var o=e.prototype._serializePanel.call(this,t);return o.cellGroups=this._serializeCellGroup(t),o},t.prototype._serializeCellGroup=function(e){var t=[],o=[],r=softGrid(),n=this.flex.rowsPerItem;e.cellType!==r.CellType.TopLeft&&e.cellType!==r.CellType.ColumnHeader||(n=e.rows.length);for(var i=0;i<n;i++){o[i]=[];for(var l=0;l<e.columns.length;l++){var s=this.flex.getBindingColumn(e,i,l),a=t.indexOf(s);o[i][l]=a<0?t.push(s)-1:a}}return{bindingColumns:this._serializeColumns(t),mappings:o}},t}(FlexGridJsonConverter),PivotGridJsonConverter=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.convert=function(){var t=e.prototype.convert.call(this);return t.centerHeadersVertically=this.flex.centerHeadersVertically,t},t}(FlexGridJsonConverter),RowJson=function(){function e(e,t){this._index=t,this._level=e.level,this._renderHeight=e.renderHeight,this._state=e.state,this._cells=e.cells}return Object.defineProperty(e.prototype,"cells",{get:function(){return this._cells},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"index",{get:function(){return this._index},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isAlternatingRow",{get:function(){return(this._state&RowState.Alternate)!==RowState.None},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isGroupRow",{get:function(){return(this._state&RowState.Group)!==RowState.None},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isDetailRow",{get:function(){return(this._state&RowState.Detail)!==RowState.None},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isExpandableGroupRow",{get:function(){return(this._state&RowState.ExpandableGroup)!==RowState.None},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isNewRow",{get:function(){return(this._state&RowState.New)!==RowState.None},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isVisible",{get:function(){return(this._state&RowState.Visible)!==RowState.None},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"level",{get:function(){return this._level},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"renderHeight",{get:function(){return this._renderHeight},enumerable:!0,configurable:!0}),e}(),ColumnJson=function(){function e(e,t){this._aggregate=e.aggregate,this._alignment=e.alignment,this._dataType=e.dataType,this._index=t,this._renderWidth=e.renderWidth,this._state=e.state,this._visibleIndex=e.visibleIndex,this._wordWrap=e.wordWrap}return Object.defineProperty(e.prototype,"aggregate",{get:function(){return this._aggregate},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dataType",{get:function(){return this._dataType},enumerable:!0,configurable:!0}),e.prototype.getAlignment=function(){return this._alignment},Object.defineProperty(e.prototype,"index",{get:function(){return this._index},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isVisible",{get:function(){return(this._state&ColState.Visible)!==ColState.None},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"renderWidth",{get:function(){return this._renderWidth},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"visibleIndex",{get:function(){return this._visibleIndex},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"wordWrap",{get:function(){return this._wordWrap},enumerable:!0,configurable:!0}),e}(),RowJsonCollection=function(){function e(e,t){void 0===t&&(t=-1),this._maxGroupLevel=t,this._length=e.length;for(var o=0;o<e.length;o++)this[o]=new RowJson(e[o],o)}return Object.defineProperty(e.prototype,"length",{get:function(){return this._length},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxGroupLevel",{get:function(){return this._maxGroupLevel},enumerable:!0,configurable:!0}),e}(),ColumnJsonCollection=function(){function e(e,t){void 0===t&&(t=-1),this._firstVisibleIndex=t,this._length=e.length;for(var o=0;o<e.length;o++)this[o]=new ColumnJson(e[o],o)}return Object.defineProperty(e.prototype,"length",{get:function(){return this._length},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"firstVisibleIndex",{get:function(){return this._firstVisibleIndex},enumerable:!0,configurable:!0}),e}(),GridJsonPanel=function(){function e(e){this._height=e.height,this._width=e.width,this._cellType=e.cellType,this._columns=new ColumnJsonCollection(e.columns,e.columnsFirstVisibleIndex),this._rows=new RowJsonCollection(e.rows,e.rowsMaxGroupLevel),this._mergedRanges=this._deserializeMergedRanges(e.mergedRanges)}return Object.defineProperty(e.prototype,"cellType",{get:function(){return this._cellType},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"columns",{get:function(){return this._columns},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rows",{get:function(){return this._rows},enumerable:!0,configurable:!0}),e.prototype.getMergedRange=function(e,t){var o=this._mergedRanges[e];if(o)for(var r=0,n=o.length;r<n;r++){var i=o[r];if(t>=i.col&&t<=i.col2)return i}return null},e.prototype._deserializeMergedRanges=function(e){var t=[];e=e||[];for(var o=0,r=this._rows.length;o<r;o++)t[o]=[];for(o=0,r=e.length;o<r;o++)for(var n=e[o],i=new _CellRange(null,n[0],n[1],n[2],n[3]),l=i.row;l<=i.row2;l++)t[l].push(i);return t},e}(),FlexGridJsonAdapter=function(){function e(e,t){this._settings=t,this._bottomLeftCells=this.deserializePanel(e.bottomLeftCells),this._cells=this.deserializePanel(e.cells),this._columnFooters=this.deserializePanel(e.columnFooters),this._columnHeaders=this.deserializePanel(e.columnHeaders),this._rowHeaders=this.deserializePanel(e.rowHeaders),this._topLeftCells=this.deserializePanel(e.topLeftCells),this._treeIndent=e.treeIndent,this._showColumnFooter=e.showColumnFooter,this._showColumnHeader=e.showColumnHeader,this._showRowHeader=e.showRowHeader,this._selection=[];for(var o=0;o<e.selection.length;o++){var r=e.selection[o];this._selection.push(new _CellRange(null,r[0],r[1],r[2],r[3]))}}return Object.defineProperty(e.prototype,"settings",{get:function(){return this._settings},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"columns",{get:function(){return this._cells.columns},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rows",{get:function(){return this._cells.rows},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bottomLeftCells",{get:function(){return this._bottomLeftCells},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cells",{get:function(){return this._cells},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"columnFooters",{get:function(){return this._columnFooters},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"columnHeaders",{get:function(){return this._columnHeaders},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rowHeaders",{get:function(){return this._rowHeaders},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"topLeftCells",{get:function(){return this._topLeftCells},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"treeIndent",{get:function(){return this._treeIndent},enumerable:!0,configurable:!0}),e.prototype.getSelection=function(){return this._selection},e.prototype.getCell=function(e,t,o){throw"Not implemented"},e.prototype.getComputedStyle=function(e){throw"Not implemented"},e.prototype.getMergedRange=function(e,t,o){return e.getMergedRange(t,o)},Object.defineProperty(e.prototype,"showColumnFooter",{get:function(){return this._showColumnFooter},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"showColumnHeader",{get:function(){return this._showColumnHeader},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"showRowHeader",{get:function(){return this._showRowHeader},enumerable:!0,configurable:!0}),e.prototype.alignMergedTextToTheTopRow=function(e){return!1},e.prototype.getCellData=function(e,t,o){return e.rows[o].cells[t]},e.prototype.getCellContent=function(e,t,o,r){return this.getCellData(e,r,t.index)},e.prototype.isBooleanCell=function(e,t,o){return o.dataType===wijmo_1.DataType.Boolean&&e.cellType===_CellType.Cell&&!this.isExpandableGroupRow(t)},e.prototype.getColumn=function(e,t,o){return e.columns[o]},e.prototype.isAlternatingRow=function(e){return e.isAlternatingRow},e.prototype.isGroupRow=function(e){return e.isGroupRow},e.prototype.isNewRow=function(e){return e.isNewRow},e.prototype.isDetailRow=function(e){return e.isDetailRow},e.prototype.isExpandableGroupRow=function(e){return e.isExpandableGroupRow},e.prototype.getCellStyle=function(e,t,o){var r=this.settings.styles,n=_merge({},r.cellStyle);switch(e.cellType){case _CellType.Cell:this.isExpandableGroupRow(t)?_merge(n,r.groupCellStyle,!0):this.isAlternatingRow(t)&&_merge(n,r.altCellStyle,!0);break;case _CellType.ColumnHeader:case _CellType.RowHeader:case _CellType.TopLeft:case _CellType.BottomLeft:_merge(n,r.headerCellStyle,!0);break;case _CellType.ColumnFooter:_merge(n,r.headerCellStyle,!0),_merge(n,r.footerCellStyle,!0)}return n},e.prototype.deserializePanel=function(e){return new GridJsonPanel(e)},e}(),PivotGridJsonAdapter=function(e){function t(t,o){var r=e.call(this,t,o)||this;return r._centerHeadersVertically=t.centerHeadersVertically,r}return __extends(t,e),t.prototype.alignMergedTextToTheTopRow=function(e){return!this._centerHeadersVertically&&(e.cellType===_CellType.ColumnHeader||e.cellType===_CellType.RowHeader)},t}(FlexGridJsonAdapter),MultiRowJsonPanel=function(e){function t(t){var o=e.call(this,t)||this;return t.cellGroups&&(o._cellGroups={bindingColumns:new ColumnJsonCollection(t.cellGroups.bindingColumns),mappings:t.cellGroups.mappings}),o}return __extends(t,e),t.prototype.getColumn=function(e,t,o){return this._cellGroups?(this.cellType!==_CellType.ColumnHeader&&this.cellType!==_CellType.BottomLeft&&(e%=o),this._cellGroups.bindingColumns[this._cellGroups.mappings[e][t]]):this.columns[t]},t}(GridJsonPanel),MultiRowJsonAdapter=function(e){function t(t,o){var r=e.call(this,t,o)||this;return r._rowsPerItem=t.rowsPerItem,r}return __extends(t,e),t.prototype.deserializePanel=function(e){return new MultiRowJsonPanel(e)},t.prototype.getColumn=function(e,t,o){return e.getColumn(t,o,this._rowsPerItem)},t}(FlexGridJsonAdapter);wijmo_1._registerModule("wijmo.grid.pdf",selfModule);