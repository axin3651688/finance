/*!
    *
    * Wijmo Library 5.20191.603
    * http://wijmo.com/
    *
    * Copyright(c) GrapeCity, Inc.  All rights reserved.
    *
    * Licensed under the GrapeCity Commercial License.
    * sales@wijmo.com
    * wijmo.com/products/wijmo-5/license/
    *
    */

var __extends=this&&this.__extends||function(){var e=function(t,i){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(t,i)};return function(t,i){function o(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(o.prototype=i.prototype,new o)}}();import{isInt,asInt,_addCultureInfo,tryCast,Size,CancelEventArgs,asType,asBoolean,isNumber,assert,_getModule,Point,mouseToPage,closest,Control,isSafari,clamp,closestClass,addClass,isIE9,removeClass,_startDrag,setCss,getActiveElement,removeChild,createElement,SortDescription,escapeHtml,Globalize,disableAutoComplete,setAttribute,_MaskProvider,setAriaLabel,culture,isBoolean,DataType,changeType,DateTime,asNumber,Rect,isIE,hasClass,toggleClass,isString,isFirefox,getType,CollectionView,CollectionViewGroup,NotifyCollectionChangedAction,getAggregate,NotifyCollectionChangedEventArgs,Aggregate,setSelectionRange,asString,Key,showPopup,hidePopup,contains,toPlainText,Clipboard,isArray,Event,asCollectionView,Tooltip,isFunction,asFunction,Binding,asEnum,setText,isPrimitive,getElementRect,_deprecated,asArray,supportsFocusOptions,isMobile,toHeaderCase,getTypes,copy,hasItems,format,ObservableArray,_registerModule}from"wijmo/wijmo";import*as mInput from"wijmo/wijmo.input";import*as selfModule from"wijmo/wijmo.grid";var DataMap=function(){function e(e,t,i){if(this.mapChanged=new Event,isArray(e)&&!t&&!i){for(var o=[],n=0;n<e.length;n++)o.push({value:e[n]});e=o,t=i="value"}this._cv=asCollectionView(e),this._keyPath=asString(t,!1),this._displayPath=asString(i,!1),this._cv.collectionChanged.addHandler(this.onMapChanged,this)}return Object.defineProperty(e.prototype,"sortByDisplayValues",{get:function(){return 1!=this._sortByKey},set:function(e){this._sortByKey=!asBoolean(e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"collectionView",{get:function(){return this._cv},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"selectedValuePath",{get:function(){return this._keyPath},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"displayMemberPath",{get:function(){return this._displayPath},enumerable:!0,configurable:!0}),e.prototype.getKeyValue=function(e){var t=this._displayPath,i=this._indexOf(e,t,!0);return i<0&&(i=this._indexOf(e,t,!1)),i>-1?this._cv.sourceCollection[i][this._keyPath]:null},e.prototype.getDisplayValue=function(e){if(!this._hash){this._hash={};var t=this._cv.sourceCollection;if(t&&this._keyPath&&this._displayPath)for(var i=t.length-1;i>=0;i--){var o=t[i],n=o[this._keyPath],r=o[this._displayPath];this._hash[n]=r}}var s=this._hash[e];return null!=s?s:e},e.prototype.getDisplayValues=function(e){var t=[];if(this._cv&&this._displayPath)for(var i=this._cv.items,o=0;o<i.length;o++)t.push(i[o][this._displayPath]);return t},e.prototype.getKeyValues=function(){var e=[];if(this._cv&&this._keyPath)for(var t=this._cv.items,i=0;i<t.length;i++)e.push(t[i][this._keyPath]);return e},Object.defineProperty(e.prototype,"isEditable",{get:function(){return this._editable},set:function(e){this._editable=asBoolean(e)},enumerable:!0,configurable:!0}),e.prototype.onMapChanged=function(e){this._hash=null,this.mapChanged.raise(this,e)},e.prototype._indexOf=function(e,t,i){var o=-1,n=-1;if(this._cv&&t)for(var r=null!=e?e.toString():"",s=i?r:r.toLowerCase(),l=this._cv.sourceCollection,a=0;a<l.length;a++){var h=l[a],c=h[t];if(c==e?o=a:i||c.length!=s.length||c.toLowerCase()!=s?null!=c&&c.toString()==r&&(o=a):o=a,o==a){if(!this._cv.filter||this._cv.filter(h))return o;n<0&&(n=o)}}return n},e}();export{DataMap};var CellRange=function(){function e(e,t,i,o){void 0===e&&(e=-1),void 0===t&&(t=-1),void 0===i&&(i=e),void 0===o&&(o=t),this.setRange(e,t,i,o)}return e.prototype.setRange=function(e,t,i,o){void 0===e&&(e=-1),void 0===t&&(t=-1),void 0===i&&(i=e),void 0===o&&(o=t),this._row=asInt(e),this._col=asInt(t),this._row2=asInt(i),this._col2=asInt(o)},Object.defineProperty(e.prototype,"row",{get:function(){return this._row},set:function(e){this._row=asInt(e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"col",{get:function(){return this._col},set:function(e){this._col=asInt(e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"row2",{get:function(){return this._row2},set:function(e){this._row2=asInt(e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"col2",{get:function(){return this._col2},set:function(e){this._col2=asInt(e)},enumerable:!0,configurable:!0}),e.prototype.clone=function(){return new e(this._row,this._col,this._row2,this._col2)},e.prototype.copy=function(e){this.setRange(e._row,e._col,e._row2,e._col2)},Object.defineProperty(e.prototype,"rowSpan",{get:function(){return Math.abs(this._row2-this._row)+1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"columnSpan",{get:function(){return Math.abs(this._col2-this._col)+1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"topRow",{get:function(){return Math.min(this._row,this._row2)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bottomRow",{get:function(){return Math.max(this._row,this._row2)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"leftCol",{get:function(){return Math.min(this._col,this._col2)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rightCol",{get:function(){return Math.max(this._col,this._col2)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isValid",{get:function(){return this._row>-1&&this._col>-1&&this._row2>-1&&this._col2>-1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isSingleCell",{get:function(){return this._row==this._row2&&this._col==this._col2},enumerable:!0,configurable:!0}),e.prototype.contains=function(t,i){var o=tryCast(t,e);if(o)return o.topRow>=this.topRow&&o.bottomRow<=this.bottomRow&&o.leftCol>=this.leftCol&&o.rightCol<=this.rightCol;if(isInt(t)&&isInt(i))return t>=this.topRow&&t<=this.bottomRow&&i>=this.leftCol&&i<=this.rightCol;throw"contains expects a CellRange or row/column indices."},e.prototype.containsRow=function(e){return asInt(e)>=this.topRow&&e<=this.bottomRow},e.prototype.containsColumn=function(e){return asInt(e)>=this.leftCol&&e<=this.rightCol},e.prototype.intersects=function(e){return this.intersectsRow(e)&&this.intersectsColumn(e)},e.prototype.intersectsRow=function(e){return e&&!(this.bottomRow<e.topRow||this.topRow>e.bottomRow)},e.prototype.intersectsColumn=function(e){return e&&!(this.rightCol<e.leftCol||this.leftCol>e.rightCol)},e.prototype.getRenderSize=function(e){var t=new Size(0,0);if(this.isValid){for(var i=this.topRow;i<=this.bottomRow;i++)t.height+=e.rows[i].renderSize;for(var o=this.leftCol;o<=this.rightCol;o++)t.width+=e.columns[o].renderSize}return t},e.prototype.equals=function(t){return t instanceof e&&this._row==t._row&&this._col==t._col&&this._row2==t._row2&&this._col2==t._col2},e}();export{CellRange};var CellRangeEventArgs=function(e){function t(t,i,o){var n=e.call(this)||this;return n._p=asType(t,GridPanel,!0),n._rng=asType(i,CellRange,!0),n._data=o,n}return __extends(t,e),Object.defineProperty(t.prototype,"panel",{get:function(){return this._p},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"range",{get:function(){return this._rng.clone()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"row",{get:function(){return this._rng.row},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"col",{get:function(){return this._rng.col},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"data",{get:function(){return this._data},set:function(e){this._data=e},enumerable:!0,configurable:!0}),t}(CancelEventArgs);export{CellRangeEventArgs};var FormatItemEventArgs=function(e){function t(t,i,o){var n=e.call(this,t,i)||this;return n._cell=asType(o,HTMLElement),n}return __extends(t,e),Object.defineProperty(t.prototype,"cell",{get:function(){return this._cell},enumerable:!0,configurable:!0}),t}(CellRangeEventArgs);export{FormatItemEventArgs};var CellEditEndingEventArgs=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._stayInEditMode=!1,t._refresh=!0,t}return __extends(t,e),Object.defineProperty(t.prototype,"stayInEditMode",{get:function(){return this._stayInEditMode},set:function(e){this._stayInEditMode=asBoolean(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"refresh",{get:function(){return this._refresh},set:function(e){this._refresh=asBoolean(e)},enumerable:!0,configurable:!0}),t}(CellRangeEventArgs);export{CellEditEndingEventArgs};export var SelectionMode;!function(e){e[e.None=0]="None",e[e.Cell=1]="Cell",e[e.CellRange=2]="CellRange",e[e.Row=3]="Row",e[e.RowRange=4]="RowRange",e[e.ListBox=5]="ListBox"}(SelectionMode||(SelectionMode={}));export var SelectedState;!function(e){e[e.None=0]="None",e[e.Selected=1]="Selected",e[e.Cursor=2]="Cursor",e[e.Active=3]="Active"}(SelectedState||(SelectedState={}));export var SelMove;!function(e){e[e.None=0]="None",e[e.Next=1]="Next",e[e.Prev=2]="Prev",e[e.NextPage=3]="NextPage",e[e.PrevPage=4]="PrevPage",e[e.Home=5]="Home",e[e.End=6]="End",e[e.NextCell=7]="NextCell",e[e.PrevCell=8]="PrevCell"}(SelMove||(SelMove={}));var _SelectionHandler=function(){function e(e){this._sel=new CellRange(0,0),this._mode=SelectionMode.CellRange,this._rng=new CellRange(0,0),this._g=e,this._e=new CellRangeEventArgs(e.cells,this._rng)}return Object.defineProperty(e.prototype,"selectionMode",{get:function(){return this._mode},set:function(e){var t=this;if(e!=this._mode){var i=SelectionMode;switch(e!=i.ListBox&&this._mode!=i.ListBox||this._g.rows.forEach(function(i,o){var n=e==SelectionMode.ListBox&&t._sel.containsRow(o);i._setFlag(RowColFlags.Selected,n,!0)}),e){case i.None:this._sel.setRange(-1,-1);break;case i.Cell:this._sel.row2=this._sel.row,this._sel.col2=this._sel.col;break;case i.Row:this._sel.row2=this._sel.row}this._mode=e,this._g.invalidate()}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"selection",{get:function(){return this._sel},set:function(e){this.select(e)},enumerable:!0,configurable:!0}),e.prototype.select=function(e,t){void 0===t&&(t=!0),isNumber(e)&&isNumber(t)?(this._rng.setRange(e,t),t=!0):e instanceof CellRange?this._rng.copy(e):assert(!1,"CellRange expected");var i=this._g,o=this._sel,n=this._rng,r=!1,s=SelectionMode;switch(i.selectionMode){case s.Cell:n.row2=n.row,n.col2=n.col;break;case s.Row:n.row2=n.row;break;case s.ListBox:r=!0}var l=n.equals(o);if(r&&n.row>-1&&!i.rows[n.row].isSelected&&(l=!1),l)t&&this._showSelection();else{var a=this._e;if(a._rng=n,a.cancel=!1,i.onSelectionChanging(a)){if(r&&(n.row!=o.row||n.rowSpan>1||o.rowSpan>1)&&i.rows.forEach(function(e,t){e._setFlag(RowColFlags.Selected,n.containsRow(t),!0)}),n.row=Math.min(n.row,i.rows.length-1),n.row2=Math.min(n.row2,i.rows.length-1),this._sel.copy(n),i.refreshCells(!1,!0,!0),t&&this._showSelection(),i.collectionView){var h=i._getCvIndex(n.row);i.collectionView.moveCurrentToPosition(h)}i.onSelectionChanged(a)}}},e.prototype.moveSelection=function(e,t,i){var o=this._g,n=this._sel,r=i&&o.anchorCursor?new CellRange(n.row2,n.col2):new CellRange(n.row,n.col);this._adjustReferenceCell(r,e,t);var s=r.row,l=r.col,a=o.rows,h=o.columns,c=Math.max(0,o._szClient.height-o.columnHeaders.height),u=SelMove;switch(t){case u.NextCell:(l=h.getNextCell(l,u.Next,c))==r.col&&(s=a.getNextCell(s,u.Next,c))>r.row&&(l=h.getNextCell(0,u.Next,c),l=h.getNextCell(l,u.Prev,c)),o.select(s,l);break;case u.PrevCell:(l=h.getNextCell(r.col,u.Prev,c))==r.col&&(s=a.getNextCell(s,u.Prev,c))<r.row&&(l=h.getNextCell(h.length-1,u.Prev,c),l=h.getNextCell(l,u.Next,c)),o.select(s,l);break;default:s=a.getNextCell(s,e,c),l=h.getNextCell(l,t,c),i?o.selection=o.anchorCursor?new CellRange(n.row,n.col,s,l):new CellRange(s,l,n.row2,n.col2):o.select(s,l)}},e.prototype._showSelection=function(){var e=this._g,t=this._sel;e.anchorCursor?e.scrollIntoView(t.row2,t.col2):e.scrollIntoView(t.row,t.col)},e.prototype._adjustReferenceCell=function(e,t,i){var o=this._g,n=o.getMergedRange(o.cells,e.row,e.col);if(n&&!n.isSingleCell){var r=SelMove;switch(t){case r.Next:case r.NextCell:e.row=n.bottomRow;break;case r.Prev:case r.PrevCell:e.row=n.topRow}switch(i){case r.Next:case r.NextCell:e.col=n.rightCol;break;case r.Prev:case r.PrevCell:e.col=n.leftCol}}},e}();export{_SelectionHandler};export var RowColFlags;!function(e){e[e.Visible=1]="Visible",e[e.AllowResizing=2]="AllowResizing",e[e.AllowDragging=4]="AllowDragging",e[e.AllowMerging=8]="AllowMerging",e[e.AllowSorting=16]="AllowSorting",e[e.AutoGenerated=32]="AutoGenerated",e[e.Collapsed=64]="Collapsed",e[e.ParentCollapsed=128]="ParentCollapsed",e[e.Selected=256]="Selected",e[e.ReadOnly=512]="ReadOnly",e[e.HtmlContent=1024]="HtmlContent",e[e.WordWrap=2048]="WordWrap",e[e.MultiLine=4096]="MultiLine",e[e.HasTemplate=8192]="HasTemplate",e[e.RowDefault=3]="RowDefault",e[e.ColumnDefault=23]="ColumnDefault"}(RowColFlags||(RowColFlags={}));var RowCol=function(){function e(){this._pos=0,this._idx=-1,this._vidx=-1,this.gridChanged=new Event}return Object.defineProperty(e.prototype,"dataType",{get:function(){return this._type},set:function(e){e=asEnum(e,DataType,!0),this._type!=e&&(this._type=e,this.grid&&this.grid.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"inputType",{get:function(){return this._inpType},set:function(e){this._inpType=asString(e,!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mask",{get:function(){return this._mask},set:function(e){this._mask=asString(e,!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxLength",{get:function(){return this._maxLen},set:function(e){this._maxLen=asNumber(e,!0,!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"align",{get:function(){return this._align},set:function(e){this._align!=e&&(this._align=e,this.onPropertyChanged())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"format",{get:function(){return this._fmt},set:function(e){this._fmt!=e&&(this._fmt=e,this.onPropertyChanged())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dataMap",{get:function(){return this._map},set:function(e){this._map!=e&&(this._map&&this._map.mapChanged.removeHandler(this.onPropertyChanged,this),isArray(e)&&(e=new DataMap(e,null,null)),this._map=asType(e,DataMap,!0),this._map&&this._map.mapChanged.addHandler(this.onPropertyChanged,this),this.onPropertyChanged())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"showDropDown",{get:function(){return this._showDropDown},set:function(e){e!=this._showDropDown&&(this._showDropDown=asBoolean(e,!0),this.grid&&this.grid.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dropDownCssClass",{get:function(){return this._ddCssClass},set:function(e){this._ddCssClass=asString(e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"visible",{get:function(){return this._getFlag(RowColFlags.Visible)},set:function(e){this._setFlag(RowColFlags.Visible,e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isVisible",{get:function(){return!!this._getFlag(RowColFlags.Visible)&&(!this._getFlag(RowColFlags.ParentCollapsed)||this instanceof _NewRowTemplate)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pos",{get:function(){return this._list&&this._list._dirty&&this._list._update(),this._pos},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"index",{get:function(){return this._list&&this._list._dirty&&this._list._update(),this._idx},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"visibleIndex",{get:function(){return this._list&&this._list._dirty&&this._list._update(),this.isVisible?this._vidx:-1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return this._sz},set:function(e){e!=this._sz&&(this._sz=asNumber(e,!0),this.onPropertyChanged())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"renderSize",{get:function(){var e=0,t=this._list;return this.isVisible&&((null==(e=this._sz)||e<0)&&(e=t?t.defaultSize:0),t&&null!=t.minSize&&e<t.minSize&&(e=t.minSize),t&&null!=t.maxSize&&e>t.maxSize&&(e=t.maxSize),null!=this._szMin&&e<this._szMin&&(e=this._szMin),null!=this._szMax&&e>this._szMax&&(e=this._szMax)),e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"allowResizing",{get:function(){return this._getFlag(RowColFlags.AllowResizing)},set:function(e){this._setFlag(RowColFlags.AllowResizing,e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"allowDragging",{get:function(){return this._getFlag(RowColFlags.AllowDragging)},set:function(e){this._setFlag(RowColFlags.AllowDragging,e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"allowMerging",{get:function(){return this._getFlag(RowColFlags.AllowMerging)},set:function(e){this._setFlag(RowColFlags.AllowMerging,e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isSelected",{get:function(){return this._getFlag(RowColFlags.Selected)},set:function(e){if(this._setFlag(RowColFlags.Selected,e,!0)){var t=this.grid;t&&t.refreshCells(!1,!0,!0)}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isReadOnly",{get:function(){return this._getFlag(RowColFlags.ReadOnly)},set:function(e){this._setFlag(RowColFlags.ReadOnly,e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isRequired",{get:function(){return this._required},set:function(e){this._required=asBoolean(e,!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isContentHtml",{get:function(){return this._getFlag(RowColFlags.HtmlContent)},set:function(e){this.isContentHtml!=e&&(this._setFlag(RowColFlags.HtmlContent,e),this.grid&&this.grid.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"wordWrap",{get:function(){return this._getFlag(RowColFlags.WordWrap)},set:function(e){this._setFlag(RowColFlags.WordWrap,e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"multiLine",{get:function(){return this._getFlag(RowColFlags.MultiLine)},set:function(e){this._setFlag(RowColFlags.MultiLine,e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cssClass",{get:function(){return this._cssClass},set:function(e){e!=this._cssClass&&(this._cssClass=asString(e),this.grid&&this.grid.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cssClassAll",{get:function(){return this._cssClassAll},set:function(e){e!=this._cssClassAll&&(this._cssClassAll=asString(e),this.grid&&this.grid.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"grid",{get:function(){return this._list?this._list._g:null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"collectionView",{get:function(){return this.grid?this.grid.collectionView:null},enumerable:!0,configurable:!0}),e.prototype.onPropertyChanged=function(){this._list&&(this._list._dirty=!0,this.grid.invalidate())},e.prototype.onGridChanged=function(e){this.gridChanged.raise(this,e)},e.prototype._setList=function(e){e!=this._list&&(this._list=e,this.onGridChanged())},e.prototype._getFlag=function(e){return 0!=(this._f&e)},e.prototype._setFlag=function(e,t,i){return t!=this._getFlag(e)&&(this._f=t?this._f|e:this._f&~e,i||this.onPropertyChanged(),!0)},e}();export{RowCol};var Column=function(e){function t(i){var o=e.call(this)||this;return o._f=RowColFlags.ColumnDefault,o._hash=t._ctr.toString(36),t._ctr++,i&&copy(o,i),o}return __extends(t,e),Object.defineProperty(t.prototype,"name",{get:function(){return this._name},set:function(e){this._name=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"binding",{get:function(){return this._binding?this._binding.path:null},set:function(e){if(e!=this.binding){var t=asString(e);if(this._binding=t?new Binding(t):null,!this._type&&this.grid&&this._binding){var i=this.grid.collectionView;if(i&&i.sourceCollection&&i.sourceCollection.length){var o=i.sourceCollection[0];this._type=getType(this._binding.getValue(o))}}this.onPropertyChanged()}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"sortMemberPath",{get:function(){return this._bindingSort?this._bindingSort.path:null},set:function(e){if(e!=this.sortMemberPath){var t=asString(e);this._bindingSort=t?new Binding(t):null,this.onPropertyChanged()}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"width",{get:function(){return null!=this._szStar?this._szStar:this.size},set:function(e){null!=t._parseStarSize(e)?(this._szStar=e,this.onPropertyChanged()):(this._szStar=null,this.size=asNumber(e,!0))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"minWidth",{get:function(){return this._szMin},set:function(e){e!=this._szMin&&(this._szMin=asNumber(e,!0,!0),this.onPropertyChanged())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxWidth",{get:function(){return this._szMax},set:function(e){e!=this._szMax&&(this._szMax=asNumber(e,!0,!0),this.onPropertyChanged())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"quickAutoSize",{get:function(){return this._quickSize},set:function(e){this._quickSize=asBoolean(e,!0)},enumerable:!0,configurable:!0}),t.prototype._getQuickAutoSize=function(){return!!this.grid._getQuickAutoSize()&&(isBoolean(this._quickSize)?this._quickSize:!(this.isContentHtml||this.wordWrap||this.multiLine||this._getFlag(RowColFlags.HasTemplate)))},Object.defineProperty(t.prototype,"renderWidth",{get:function(){return this.renderSize},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"header",{get:function(){return this._hdr?this._hdr:this.binding},set:function(e){this._hdr!=e&&(this._hdr=e,this.onPropertyChanged())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"allowSorting",{get:function(){return this._getFlag(RowColFlags.AllowSorting)},set:function(e){this._setFlag(RowColFlags.AllowSorting,e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"currentSort",{get:function(){var e=this.grid?this.grid.collectionView:null,t=e?e.sortDescriptions:null,i=t&&t.length?this._getBindingSort():null;if(i)for(var o=0;o<t.length;o++)if(t[o].property==i)return t[o].ascending?"+":"-";return null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"aggregate",{get:function(){return null!=this._agg?this._agg:Aggregate.None},set:function(e){(e=asEnum(e,Aggregate))!=this._agg&&(this._agg=e,this.onPropertyChanged())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"describedById",{get:function(){return this._descById},set:function(e){e!=this._descById&&(this._descById=asString(e),this.grid&&this.grid.invalidate())},enumerable:!0,configurable:!0}),t.prototype.getIsRequired=function(e){return null!=this._required?this._required:e&&null!=e.isRequired?e.isRequired:this.dataType==DataType.String?null!=this.dataMap||null!=this._mask&&this._mask.length>0:!e||e.dataType!=DataType.String||(null!=e.dataMap||null!=e.mask&&e.mask.length>0)},t.prototype.getAlignment=function(e){if(null!=this._align)return this._align;if(e&&null!=e.align)return e.align;if(!this._map)switch(this.dataType){case DataType.Boolean:return"center";case DataType.Number:return"right"}if(e&&!e.dataMap)switch(e.dataType){case DataType.Boolean:return"center";case DataType.Number:return"right"}return""},t.prototype._getBindingSort=function(){return this.sortMemberPath?this.sortMemberPath:this.binding?this.binding:null},t._parseStarSize=function(e){if(isString(e)&&e.length>0&&"*"==e[e.length-1]){var t=1==e.length?1:1*e.substr(0,e.length-1);if(t>0&&!isNaN(t))return t}return null},t._ctr=0,t}(RowCol);export{Column};var Row=function(e){function t(t){var i=e.call(this)||this;return i._f=RowColFlags.ColumnDefault,i._data=t,i}return __extends(t,e),Object.defineProperty(t.prototype,"dataItem",{get:function(){return this._data},set:function(e){this._data=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this.size},set:function(e){this.size=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"renderHeight",{get:function(){return this.renderSize},enumerable:!0,configurable:!0}),t}(RowCol);export{Row};var GroupRow=function(e){function t(){var t=e.call(this)||this;return t._level=-1,t.isReadOnly=!0,t}return __extends(t,e),Object.defineProperty(t.prototype,"level",{get:function(){return this._level},set:function(e){asInt(e),e!=this._level&&(this._level=e,this.onPropertyChanged())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hasChildren",{get:function(){if(null!=this.grid&&null!=this._list){this._list._update();var e=this.index<this._list.length-1?this._list[this.index+1]:null,i=tryCast(e,t),o=tryCast(e,_NewRowTemplate);return null!=e&&null==o&&(null==i||i.level>this.level)}return!0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isCollapsed",{get:function(){return this._getFlag(RowColFlags.Collapsed)},set:function(e){asBoolean(e),e!=this.isCollapsed&&null!=this._list&&this._setCollapsed(e)},enumerable:!0,configurable:!0}),t.prototype.getGroupHeader=function(){var e=this.grid,t=e.groupHeaderFormat||culture.FlexGrid.groupHeaderFormat,i=tryCast(this.dataItem,CollectionViewGroup);if(i&&t&&e.showGroups&&!e.childItemsPath){var o=i.groupDescription.propertyName,n=i.name,r=e.getColumn(o),s=this.isContentHtml;r?(s=s||r.isContentHtml,r.header&&(o=r.header),r.dataMap?n=r.dataMap.getDisplayValue(n):r.format&&(n=Globalize.format(n,r.format))):o=toHeaderCase(o);var l=i.getAggregate(Aggregate.CntAll,null,e.collectionView);return format(t,{name:escapeHtml(o),value:s?n:escapeHtml(n),level:i.level,count:l})}return""},t.prototype._setCollapsed=function(e){var i=this,o=this.grid,n=o.rows,r=this.getCellRange(),s=new CellRangeEventArgs(o.cells,new CellRange(this.index,-1));o.onGroupCollapsedChanging(s)&&(o.deferUpdate(function(){n.deferUpdate(function(){i._setFlag(RowColFlags.Collapsed,e,!0);for(var o=r.topRow+1;o<=r.bottomRow&&o>-1&&o<n.length;o++){n[o]._setFlag(RowColFlags.ParentCollapsed,e,!0);var s=n[o];s instanceof t&&s.isCollapsed&&(o=s.getCellRange().bottomRow)}})}),o.onGroupCollapsedChanged(s))},t.prototype.getCellRange=function(){for(var e=this._list,i=this.index,o=e.length-1,n=i+1;n<=o;n++){var r=tryCast(e[n],t);if(null!=r&&r.level<=this.level){o=n-1;break}}return new CellRange(i,0,o,this.grid.columns.length-1)},t}(Row);export{GroupRow};var RowColCollection=function(e){function t(t,i){var o=e.call(this)||this;return o._frozen=0,o._lastFrozen=-1,o._firstVisible=-1,o._vlen=0,o._szDef=28,o._szTot=0,o._szCustom=!1,o._dirty=!1,o._g=asType(t,FlexGrid),o._szDef=asNumber(i,!1,!0),o}return __extends(t,e),Object.defineProperty(t.prototype,"grid",{get:function(){return this._g},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"defaultSize",{get:function(){return this._szDef},set:function(e){this._szCustom=!0,this._szDef!=e&&(this._szDef=asNumber(e,!1,!0),this._dirty=!0,this._g.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"frozen",{get:function(){return this._frozen},set:function(e){e!=this._frozen&&(this._frozen=asNumber(e,!1,!0),this._dirty=!0,this._g.invalidate())},enumerable:!0,configurable:!0}),t.prototype.isFrozen=function(e){return e<this.frozen},Object.defineProperty(t.prototype,"minSize",{get:function(){return this._szMin},set:function(e){e!=this._szMin&&(this._szMin=asNumber(e,!0,!0),this._dirty=!0,this._g.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxSize",{get:function(){return this._szMax},set:function(e){e!=this._szMax&&(this._szMax=asNumber(e,!0,!0),this._dirty=!0,this._g.invalidate())},enumerable:!0,configurable:!0}),t.prototype.getTotalSize=function(){return this._dirty&&this._update(),this._szTot},Object.defineProperty(t.prototype,"visibleLength",{get:function(){return this._dirty&&this._update(),this._vlen},enumerable:!0,configurable:!0}),t.prototype.getItemAt=function(e){if(this._dirty&&this._update(),e<=0&&this.length>0&&this[0].renderSize)return 0;e=Math.round(e);for(var t,i,o=this.length,n=0,r=o-1;n<=r;)if((i=this[t=n+r>>>1])._pos>e&&t>0)r=t-1;else{if(!(i._pos+i.renderSize<=e&&t<o-1)){for(;t>0&&!this[t].renderSize;)t--;for(;t<o-1&&!this[t].renderSize;)t++;return t}n=t+1}return r},t.prototype.getNextCell=function(e,t,i){var o,n=SelMove;switch(t){case n.Next:for(o=e+1;o<this.length;o++)if(this[o].renderSize>0)return o;break;case n.Prev:for(o=e-1;o>=0;o--)if(this[o].renderSize>0)return o;break;case n.End:for(o=this.length-1;o>=0;o--)if(this[o].renderSize>0)return o;break;case n.Home:for(o=0;o<this.length;o++)if(this[o].renderSize>0)return o;break;case n.NextPage:return(o=this.getItemAt(this[e].pos+this[e].renderSize+i))<0?this.getNextCell(e,SelMove.End,i):o==e&&o<this.length-1&&this[o+1].renderSize?o+1:o;case n.PrevPage:return(o=this.getItemAt(this[e].pos-i))<0?this.getNextCell(e,SelMove.Home,i):o==e&&o>0&&this[o-1].renderSize?o-1:o}return e},t.prototype.canMoveElement=function(e,t){if(t==e)return!1;if(e<0||e>=this.length||t>=this.length)return!1;t<0&&(t=this.length-1);for(var i=Math.min(e,t),o=Math.max(e,t),n=i;n<=o;n++)if(!this[n].allowDragging)return!1;return!(this[t]instanceof _NewRowTemplate)},t.prototype.moveElement=function(e,t){if(this.canMoveElement(e,t)){var i=this[e];this.removeAt(e),t<0&&(t=this.length),this.insert(t,i)}},t.prototype.onCollectionChanged=function(t){void 0===t&&(t=NotifyCollectionChangedEventArgs.reset),this._dirty=!0,this._g.invalidate(),e.prototype.onCollectionChanged.call(this,t)},t.prototype.push=function(t){return t._setList(this),e.prototype.push.call(this,t)},t.prototype.splice=function(t,i,o){for(var n=0;n<i;n++){var r=this[t+n];r&&r._setList(null)}return o&&o._setList(this),e.prototype.splice.call(this,t,i,o)},t.prototype.beginUpdate=function(){this._update(),e.prototype.beginUpdate.call(this)},t.prototype._setDefaultSize=function(e){this._szCustom||(this.defaultSize=e,this._szCustom=!1)},t.prototype._update=function(){if(this._dirty&&!this.isUpdating){this._dirty=!1,this._lastFrozen=-1,this._firstVisible=-1;for(var e=0,t=0,i=void 0,o=void 0,n=0;n<this.length;n++)(o=this[n])._idx=n,o._vidx=e,o._pos=t,o._setList(this),(i=o.renderSize)>0&&(t+=i,e++,n<this._frozen&&(this._lastFrozen=n)),this._firstVisible<0&&o.visible&&(this._firstVisible=n);return this._vlen=e,this._szTot=t,!0}return!1},t}(ObservableArray);export{RowColCollection};var ColumnCollection=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.getColumn=function(e){var t=isNumber(e)?e:this.indexOf(e);return t>-1?this[t]:null},t.prototype.indexOf=function(t){if(t instanceof Column)return e.prototype.indexOf.call(this,t);for(var i=0;i<this.length;i++)if(this[i].name==t)return i;for(i=0;i<this.length;i++)if(this[i].binding==t)return i;return-1},Object.defineProperty(t.prototype,"describedById",{get:function(){return this._descById},set:function(e){e!=this._descById&&(this._descById=asString(e),this._g&&this._g.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"firstVisibleIndex",{get:function(){return this._dirty&&this._update(),this._firstVisible},enumerable:!0,configurable:!0}),t.prototype._updateStarSizes=function(e){for(var t,i=0,o=0;o<this.length;o++){(r=this[o]).isVisible&&(r._szStar?(i+=Column._parseStarSize(r._szStar),t=r):e-=r.renderWidth)}if(t){var n=e;for(o=0;o<this.length;o++){var r;(r=this[o]).isVisible&&r._szStar&&(r==t&&n>0?r._sz=n:(r._sz=Math.max(0,Math.round(Column._parseStarSize(r._szStar)/i*e)),n-=r.renderWidth))}return this._dirty=!0,this._update(),!0}return!1},t}(RowColCollection);export{ColumnCollection};var RowCollection=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._maxLevel=-1,t}return __extends(t,e),Object.defineProperty(t.prototype,"ariaLabel",{get:function(){return this._ariaLabel},set:function(e){e!=this.ariaLabel&&(this._ariaLabel=asString(e),this._g&&this._g.refresh())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxGroupLevel",{get:function(){return this._dirty&&this._update(),this._maxLevel},enumerable:!0,configurable:!0}),t.prototype._update=function(){if(e.prototype._update.call(this)){this._maxLevel=-1;for(var t=0;t<this.length;t++){var i=tryCast(this[t],GroupRow);i&&i.level>this._maxLevel&&(this._maxLevel=i.level)}return!0}return!1},t}(RowColCollection);export{RowCollection};_addCultureInfo("FlexGrid",{groupHeaderFormat:"{name}: <b>{value}</b> ({count:n0} items)",ariaLabels:{toggleDropDown:"Toggle Dropdown",toggleGroup:"Toggle Group"}});export var HeadersVisibility;!function(e){e[e.None=0]="None",e[e.Column=1]="Column",e[e.Row=2]="Row",e[e.All=3]="All"}(HeadersVisibility||(HeadersVisibility={}));var FlexGrid=function(e){function t(t,i){var o=e.call(this,t,null,!0)||this;o._szClient=new Size(0,0),o._ptScrl=new Point(0,0),o._cellPadLeft=3,o._cellPadVert=0,o._clipToScreen=!1,o._autoGenCols=!0,o._autoClipboard=!0,o._autoScroll=!0,o._autoSearch=!1,o._readOnly=!1,o._indent=14,o._autoSizeMode=AutoSizeMode.Both,o._hdrVis=HeadersVisibility.All,o._alSorting=!0,o._alAddNew=!1,o._alDelete=!1,o._alResizing=AllowResizing.Columns,o._alDragging=AllowDragging.Columns,o._alMerging=AllowMerging.None,o._ssHdr=HeadersVisibility.None,o._shSort=!0,o._shGroups=!0,o._altStep=1,o._shErr=!0,o._shDropDown=!0,o._valEdt=!0,o._deferResizing=!1,o._pSel=!0,o._pOutline=!0,o._stickyHdr=!1,o._anchorCursor=!1,o._vt=0,o._vtRows=0,o._vtCols=0,o._reorderCells=!0,o._refreshOnEdit=!0,o._lazyRender=!1,o.itemsSourceChanging=new Event,o.itemsSourceChanged=new Event,o.scrollPositionChanged=new Event,o.selectionChanging=new Event,o.selectionChanged=new Event,o.loadingRows=new Event,o.loadedRows=new Event,o.updatingLayout=new Event,o.updatedLayout=new Event,o.resizingColumn=new Event,o.resizedColumn=new Event,o.autoSizingColumn=new Event,o.autoSizedColumn=new Event,o.draggingColumn=new Event,o.draggingColumnOver=new Event,o.draggedColumn=new Event,o.resizingRow=new Event,o.resizedRow=new Event,o.autoSizingRow=new Event,o.autoSizedRow=new Event,o.draggingRow=new Event,o.draggingRowOver=new Event,o.draggedRow=new Event,o.groupCollapsedChanging=new Event,o.groupCollapsedChanged=new Event,o.sortingColumn=new Event,o.sortedColumn=new Event,o.beginningEdit=new Event,o.prepareCellForEdit=new Event,o.cellEditEnding=new Event,o.cellEditEnded=new Event,o.rowEditStarting=new Event,o.rowEditStarted=new Event,o.rowEditEnding=new Event,o.rowEditEnded=new Event,o.rowAdded=new Event,o.deletingRow=new Event,o.deletedRow=new Event,o.copying=new Event,o.copied=new Event,o.pasting=new Event,o.pasted=new Event,o.pastingCell=new Event,o.pastedCell=new Event,o.formatItem=new Event(function(){o.invalidate()}),o.updatingView=new Event,o.updatedView=new Event,o._mappedColumns=null;var n=o.hostElement;isIE()&&(n.style.borderRadius="0");var r=o.getTemplate();o.applyTemplate("wj-control wj-content wj-flexgrid",r,{_root:"root",_eSz:"sz",_eCt:"cells",_fCt:"fcells",_eTL:"tl",_eBL:"bl",_eCHdr:"ch",_eRHdr:"rh",_eCFtr:"cf",_eTLCt:"tlcells",_eBLCt:"blcells",_eCHdrCt:"chcells",_eCFtrCt:"cfcells",_eRHdrCt:"rhcells",_eMarquee:"marquee",_eFocus:"focus"});return[o._eRHdr,o._eCFtr,o._eCHdr,o._eBL,o._eTL].forEach(function(e){setAttribute(e,"aria-hidden",!0),setCss(e,{position:"absolute",overflow:"hidden",outline:"none"}),setCss(e.firstElementChild,{position:"relative"})}),[o._eFocus,o._eMarquee,o._fCt,o._eSz].forEach(function(e){setAttribute(e,"aria-hidden",!0)}),n.tabIndex=-1,o.deferUpdate(function(){var e=o._getDefaultRowHeight();o._rows=new RowCollection(o,e),o._cols=new ColumnCollection(o,4*e),o._hdrRows=new RowCollection(o,e),o._hdrCols=new ColumnCollection(o,Math.round(1.25*e)),o._ftrRows=new RowCollection(o,e);var t=CellType;o._gpTL=new GridPanel(o,t.TopLeft,o._hdrRows,o._hdrCols,o._eTLCt),o._gpCHdr=new GridPanel(o,t.ColumnHeader,o._hdrRows,o._cols,o._eCHdrCt),o._gpRHdr=new GridPanel(o,t.RowHeader,o._rows,o._hdrCols,o._eRHdrCt),o._gpCells=new GridPanel(o,t.Cell,o._rows,o._cols,o._eCt),o._gpBL=new GridPanel(o,t.BottomLeft,o._ftrRows,o._hdrCols,o._eBLCt),o._gpCFtr=new GridPanel(o,t.ColumnFooter,o._ftrRows,o._cols,o._eCFtrCt),o._hdrRows.push(new Row),o._hdrCols.push(new Column({align:"center"})),o._cf=new CellFactory,o._keyHdl=new _KeyboardHandler(o),o._mouseHdl=new _MouseHandler(o),o._edtHdl=new _EditHandler(o),o._selHdl=new _SelectionHandler(o),o._addHdl=new _AddNewHandler(o),o._mrgMgr=new MergeManager(o),o._bndSortConverter=o._sortConverter.bind(o),o._errorTip=new Tooltip({isContentHtml:!1,showDelay:0,cssClass:"wj-error-tip"}),setAttribute(o.cells.hostElement,"role","grid"),o.selectionMode=SelectionMode.CellRange,o.initialize(i)}),o.addEventListener(o._root,"scroll",function(e){o._updateScrollPosition()&&(o.finishEditing(),o._updateContent(!0))}),o.addEventListener(n,"focus",function(e){if(n.tabIndex>-1){var t=e.target;if(t instanceof HTMLElement&&t.tabIndex<0)return void o._setFocus(!0)}},!0),o}return __extends(t,e),t.prototype._handleResize=function(){this._rcBounds=null,e.prototype._handleResize.call(this)},Object.defineProperty(t.prototype,"headersVisibility",{get:function(){return this._hdrVis},set:function(e){(e=asEnum(e,HeadersVisibility))!=this._hdrVis&&(this._hdrVis=e,this.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"stickyHeaders",{get:function(){return this._stickyHdr},set:function(e){e!=this._stickyHdr&&(this._stickyHdr=asBoolean(e),this._updateStickyHeaders(),this.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"preserveSelectedState",{get:function(){return this._pSel},set:function(e){this._pSel=asBoolean(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"preserveOutlineState",{get:function(){return this._pOutline},set:function(e){this._pOutline=asBoolean(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"anchorCursor",{get:function(){return this._anchorCursor},set:function(e){this._anchorCursor=asBoolean(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"virtualizationThreshold",{get:function(){return this._vt},set:function(e){this._vt=e,isNumber(e)?this._vtRows=this._vtCols=asNumber(e):e?isArray(e)&&2==e.length?(this._vtRows=asNumber(e[0]),this._vtCols=asNumber(e[1])):assert(!1,"virtualizationThreshold should be a number or an array with two numbers."):this._vtRows=this._vtCols=0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"autoGenerateColumns",{get:function(){return this._autoGenCols},set:function(e){this._autoGenCols=asBoolean(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"autoClipboard",{get:function(){return this._autoClipboard},set:function(e){this._autoClipboard=asBoolean(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"autoScroll",{get:function(){return this._autoScroll},set:function(e){this._autoScroll=asBoolean(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"autoSearch",{get:function(){return this._autoSearch},set:function(e){this._autoSearch=asBoolean(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"columnLayout",{get:function(){var e=t._getSerializableProperties(Column),i=new Column,o=[];return this.columns.forEach(function(t){var n={};e.forEach(function(e){var o=t[e];o!=i[e]&&isPrimitive(o)&&"size"!=e&&(n[e]=o)}),o.push(n)}),JSON.stringify({columns:o})},set:function(e){var t=JSON.parse(asString(e));if(!t||null==t.columns)throw"Invalid columnLayout data.";this.columns.clear(),this.initialize(t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isReadOnly",{get:function(){return this._readOnly},set:function(e){e!=this._readOnly&&(this._readOnly=asBoolean(e),this.finishEditing(),this.invalidate(!0),this._addHdl.updateNewRowTemplate(),toggleClass(this.hostElement,"wj-state-readonly",this.isReadOnly),this._setAria("readonly",this.isReadOnly?"true":null))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"imeEnabled",{get:function(){return null!=this._imeHdl},set:function(e){if(asBoolean(e)!=this.imeEnabled&&this.finishEditing()){var t=this.containsFocus();this._imeHdl&&(this._imeHdl.dispose(),this._imeHdl=null),e&&(this._imeHdl=new _ImeHandler(this)),t&&this.focus()}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"allowResizing",{get:function(){return this._alResizing},set:function(e){this._alResizing=asEnum(e,AllowResizing)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"deferResizing",{get:function(){return this._deferResizing},set:function(e){this._deferResizing=asBoolean(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"autoSizeMode",{get:function(){return this._autoSizeMode},set:function(e){this._autoSizeMode=asEnum(e,AutoSizeMode)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"quickAutoSize",{get:function(){return this._quickSize},set:function(e){this._quickSize=asBoolean(e,!0)},enumerable:!0,configurable:!0}),t.prototype._getQuickAutoSize=function(){return isBoolean(this._quickSize)?this._quickSize:!this.formatItem.hasHandlers&&null==this.itemFormatter},Object.defineProperty(t.prototype,"allowSorting",{get:function(){return this._alSorting},set:function(e){this._alSorting=asBoolean(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"allowAddNew",{get:function(){return this._alAddNew},set:function(e){e!=this._alAddNew&&(this._alAddNew=asBoolean(e),this._addHdl.updateNewRowTemplate())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"newRowAtTop",{get:function(){return this._addHdl.newRowAtTop},set:function(e){this._addHdl.newRowAtTop=asBoolean(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"allowDelete",{get:function(){return this._alDelete},set:function(e){e!=this._alDelete&&(this._alDelete=asBoolean(e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"allowMerging",{get:function(){return this._alMerging},set:function(e){(e=asEnum(e,AllowMerging))!=this._alMerging&&(this._alMerging=e,this.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"showSelectedHeaders",{get:function(){return this._ssHdr},set:function(e){(e=asEnum(e,HeadersVisibility))!=this._ssHdr&&(this._ssHdr=e,this.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"showMarquee",{get:function(){return!this._eMarquee.style.display},set:function(e){if(e!=this.showMarquee){var t=this._eMarquee.style;t.visibility="collapse",t.display=asBoolean(e)?"":"none",this.invalidate()}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"showSort",{get:function(){return this._shSort},set:function(e){e!=this._shSort&&(this._shSort=asBoolean(e),this.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"showGroups",{get:function(){return this._shGroups},set:function(e){e!=this._shGroups&&(this._shGroups=asBoolean(e),this._bindGrid(!1))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"alternatingRowStep",{get:function(){return this._altStep},set:function(e){e!=this._altStep&&(this._altStep=asInt(e,!1,!0),this.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"showAlternatingRows",{get:function(){return this._altStep>0},set:function(e){_deprecated("showAlternatingRows","alternatingRowStep"),this.alternatingRowStep=e?1:0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"showErrors",{get:function(){return this._shErr},set:function(e){e!=this._shErr&&(this._clearCells(),this._shErr=asBoolean(e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"errorTip",{get:function(){return this._errorTip},set:function(e){e!=this._errorTip&&(this._clearCells(),this._errorTip=asType(e,Tooltip,!0))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"itemValidator",{get:function(){return this._itemValidator},set:function(e){e!=this.itemValidator&&(this._itemValidator=asFunction(e),this.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"validateEdits",{get:function(){return this._valEdt},set:function(e){this._valEdt=asBoolean(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"groupHeaderFormat",{get:function(){return this._gHdrFmt},set:function(e){e!=this._gHdrFmt&&(this._gHdrFmt=asString(e),this._bindGrid(!1))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"allowDragging",{get:function(){return this._alDragging},set:function(e){(e=asEnum(e,AllowDragging))!=this._alDragging&&(this._alDragging=e,this.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"itemsSource",{get:function(){return this._items},set:function(e){if(e!=this._items){var t=new CancelEventArgs;if(this.onItemsSourceChanging(t)){var i;if(this._cv)(i=tryCast(this._cv,CollectionView))&&i.sortConverter==this._bndSortConverter&&(i.sortConverter=null),this._cv.currentChanged.removeHandler(this._cvCurrentChanged,this),this._cv.collectionChanged.removeHandler(this._cvCollectionChanged,this),this._cv=null;if(this._items=e,this._cv=this._getCollectionView(e),this._lastCount=0,this._cv)this._cv.currentChanged.addHandler(this._cvCurrentChanged,this),this._cv.collectionChanged.addHandler(this._cvCollectionChanged,this),(i=tryCast(this._cv,CollectionView))&&!i.sortConverter&&(i.sortConverter=this._bndSortConverter);this._bindGrid(!0);var o=SelectionMode;this.selectionMode==o.ListBox&&(this.selectionMode=o.CellRange,this.selectionMode=o.ListBox),this.onItemsSourceChanged(t)}}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"collectionView",{get:function(){return this._cv},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"editableCollectionView",{get:function(){return tryCast(this._cv,"IEditableCollectionView")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"childItemsPath",{get:function(){return this._childItemsPath},set:function(e){e!=this._childItemsPath&&(assert(null==e||isArray(e)||isString(e),"childItemsPath should be an array or a string."),this._childItemsPath=e,this._bindGrid(!0))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rowHeaderPath",{get:function(){return this._rowHdrPath?this._rowHdrPath.path:null},set:function(e){e!=this.rowHeaderPath&&(e=asString(e),this._rowHdrPath=e?new Binding(e):null,this.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cells",{get:function(){return this._gpCells},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"columnHeaders",{get:function(){return this._gpCHdr},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"columnFooters",{get:function(){return this._gpCFtr},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rowHeaders",{get:function(){return this._gpRHdr},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"topLeftCells",{get:function(){return this._gpTL},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bottomLeftCells",{get:function(){return this._gpBL},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rows",{get:function(){return this._rows},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"columns",{get:function(){return this._cols},enumerable:!0,configurable:!0}),t.prototype.getColumn=function(e){return this.columns.getColumn(e)},Object.defineProperty(t.prototype,"frozenRows",{get:function(){return this.rows.frozen},set:function(e){this.rows.frozen=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"frozenColumns",{get:function(){return this.columns.frozen},set:function(e){this.columns.frozen=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cloneFrozenCells",{get:function(){return this._fzClone},set:function(e){e!=this.cloneFrozenCells&&(setText(this._fCt,null),this._fzClone=asBoolean(e,!0),this.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"sortRowIndex",{get:function(){return this._sortRowIndex},set:function(e){e!=this._sortRowIndex&&(this._sortRowIndex=asNumber(e,!0),this.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"editColumnIndex",{get:function(){return this._editColIndex},set:function(e){e!=this._editColIndex&&(this._editColIndex=asNumber(e,!0),this.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scrollPosition",{get:function(){return this._ptScrl.clone()},set:function(e){var i=this._root,o=-e.x;if(this.rightToLeft)switch(t._getRtlMode()){case"rev":o=i.scrollWidth-i.clientWidth+e.x;break;case"neg":o=e.x;break;default:o=-e.x}i.scrollLeft=o,i.scrollTop=-e.y},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"clientSize",{get:function(){return this._szClient},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"controlRect",{get:function(){return this._rcBounds||(this._rcBounds=getElementRect(this._root)),this._rcBounds},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scrollSize",{get:function(){return new Size(this._gpCells.width,this._heightBrowser)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"viewRange",{get:function(){return this._gpCells.viewRange},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cellFactory",{get:function(){return this._cf},set:function(e){e!=this._cf&&(this._clearCells(),this._cf=asType(e,CellFactory,!1))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"itemFormatter",{get:function(){return this._itemFormatter},set:function(e){e!=this._itemFormatter&&(this._clearCells(),this._itemFormatter=asFunction(e))},enumerable:!0,configurable:!0}),t.prototype.canEditCell=function(e,t){return this._edtHdl._allowEditing(e,t)},t.prototype.getCellData=function(e,t,i){return this.cells.getCellData(e,t,i)},t.prototype.getCellBoundingRect=function(e,t,i){return this.cells.getCellBoundingRect(e,t,i)},t.prototype.setCellData=function(e,t,i,o,n){return void 0===o&&(o=!0),void 0===n&&(n=!0),this.cells.setCellData(e,t,i,o,n)},t.prototype.hitTest=function(e,t){return isNumber(e)&&isNumber(t)&&(e=new Point(e,t)),isBoolean(t)&&t&&(this._rcBounds=null),new HitTestInfo(this,e)},t.prototype.getClipString=function(e,t,i,o){return this._edtHdl.getClipString(e,t,i,o)},t.prototype.setClipString=function(e,t){this._edtHdl.setClipString(e,t)},t.prototype.focus=function(){this._setFocus(!1)},t.prototype.dispose=function(){this.finishEditing(!0),this.itemsSource=null,e.prototype.dispose.call(this)},t.prototype.refresh=function(t){if(void 0===t&&(t=!0),e.prototype.refresh.call(this,t),this.finishEditing(),t){this._updateColumnTypes(),this.scrollPosition=this._ptScrl;var i=this._getDefaultRowHeight();this._rows._setDefaultSize(i),this._cols._setDefaultSize(4*i),this._hdrRows._setDefaultSize(i),this._hdrCols._setDefaultSize(Math.round(1.25*i)),this._ftrRows._setDefaultSize(i),this._toInv&&(clearTimeout(this._toInv),this._toInv=null)}this.refreshCells(t)},t.prototype.refreshCells=function(e,t,i){this.isUpdating||(e?this._updateLayout():this._updateContent(t,i))},t.prototype.autoSizeColumn=function(e,t,i){void 0===t&&(t=!1),void 0===i&&(i=4),this.autoSizeColumns(e,e,t,i)},t.prototype.autoSizeColumns=function(e,i,o,n){var r=this;void 0===o&&(o=!1),void 0===n&&(n=4);var s=0,l=o?this.topLeftCells:this.columnHeaders,a=o?this.bottomLeftCells:this.columnFooters,h=o?this.rowHeaders:this.cells,c=this.viewRange;e=null==e?0:asInt(e),i=null==i?h.columns.length-1:asInt(i),c.row=Math.max(0,c.row-1e3),c.row2=Math.min(c.row2+1e3,this.rows.length-1),this.finishEditing()&&this.columns.deferUpdate(function(){setCss(r._eCt,{width:r._gpCells.width});for(var o=createElement('<div style="visibility: hidden" '+t._WJS_MEASURE+'="true"/>',h.hostElement),u=r._getCanvasContext(),d=e;d<=i&&d>-1&&d<h.columns.length;d++){var g=h.columns[d];if(g.isVisible){if(s=0,r.autoSizeMode&AutoSizeMode.Headers){for(var p=0;p<l.rows.length;p++)l.rows[p].isVisible&&(s=Math.max(r._getDesiredWidth(l,p,d,o),s));for(p=0;p<a.rows.length;p++)a.rows[p].isVisible&&(s=Math.max(r._getDesiredWidth(a,p,d,o),s))}if(r.autoSizeMode&AutoSizeMode.Cells&&c.isValid)if(g._getQuickAutoSize()){p=r._getWidestRow(h,c,d,u);s=Math.max(r._getDesiredWidth(h,p,d,o),s)}else for(p=c.row;p<=c.row2&&p<h.rows.length;p++)h.rows[p].isVisible&&(s=Math.max(r._getDesiredWidth(h,p,d,o),s));s>0&&(g.width=s+n+2)}}r.cellFactory.disposeCell(o),removeChild(o)})},t.prototype.autoSizeRow=function(e,t,i){void 0===t&&(t=!1),void 0===i&&(i=0),this.autoSizeRows(e,e,t,i)},t.prototype.autoSizeRows=function(e,i,o,n){var r=this;void 0===o&&(o=!1),void 0===n&&(n=0);var s=0,l=o?this.topLeftCells:this.rowHeaders,a=o?this.columnHeaders:this.cells;if(o=asBoolean(o),n=asNumber(n),e=null==e?0:asInt(e),i=null==i?a.rows.length-1:asInt(i),this.finishEditing()){setCss(this._eCt,{width:this._gpCells.width});var h=createElement('<div style="visibility: hidden" '+t._WJS_MEASURE+'="true"/>',a.hostElement);this.rows.deferUpdate(function(){for(var t={},o=e;o<=i&&o>-1&&o<a.rows.length;o++){a.rows[o].isVisible&&(s=0,r.autoSizeMode&AutoSizeMode.Headers&&(s=r._getDesiredRowHeight(l,o,h,t)),r.autoSizeMode&AutoSizeMode.Cells&&(s=Math.max(r._getDesiredRowHeight(a,o,h,t),s)),s>0&&(a.rows[o].height=s+n))}}),this.cellFactory.disposeCell(h),removeChild(h)}},Object.defineProperty(t.prototype,"treeIndent",{get:function(){return this._indent},set:function(e){e!=this._indent&&(this._indent=asNumber(e,!1,!0),this.columns.onCollectionChanged())},enumerable:!0,configurable:!0}),t.prototype.collapseGroupsToLevel=function(e){var t=this;this.finishEditing()&&this.deferUpdate(function(){var i=t.rows;i.deferUpdate(function(){for(var t=0;t<i.length;t++){var o=i[t];o instanceof GroupRow&&(o.isCollapsed=o.level>=e)}})})},Object.defineProperty(t.prototype,"selectionMode",{get:function(){return this._selHdl.selectionMode},set:function(e){(e=asEnum(e,SelectionMode))!=this.selectionMode&&(this._clearCells(),this._selHdl.selectionMode=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"selection",{get:function(){return this._selHdl.selection.clone()},set:function(e){this._selHdl.selection=e},enumerable:!0,configurable:!0}),t.prototype.select=function(e,t){void 0===t&&(t=!0),this._selHdl.select(e,t)},t.prototype.getSelectedState=function(e,t){return this.cells.getSelectedState(e,t,null)},Object.defineProperty(t.prototype,"selectedRows",{get:function(){var e=[];if(this.selectionMode==SelectionMode.ListBox)for(var t=0;t<this.rows.length;t++)this.rows[t].isSelected&&e.push(this.rows[t]);else if(this.rows.length){var i=this.selection;for(t=i.topRow;t>-1&&t<=i.bottomRow;t++)e.push(this.rows[t])}return e},set:function(e){var t=this;assert(this.selectionMode==SelectionMode.ListBox,"This property can be set only in ListBox mode."),e=asArray(e),this.deferUpdate(function(){for(var i=0,o=!0;i<t.rows.length;i++){var n=t.rows[i],r=e&&e.indexOf(n)>-1;r&&o&&(o=!1,t.select(i,t.selection.col)),n.isSelected=r}})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"selectedItems",{get:function(){for(var e=this.selectedRows,t=0;t<e.length;t++)e[t]=e[t].dataItem;return e},set:function(e){var t=this;assert(this.selectionMode==SelectionMode.ListBox,"This property can be set only in ListBox mode."),e=asArray(e),this.deferUpdate(function(){for(var i=0,o=!0;i<t.rows.length;i++){var n=t.rows[i],r=e&&e.indexOf(n.dataItem)>-1;r&&o&&(o=!1,t.select(i,t.selection.col)),n.isSelected=r}})},enumerable:!0,configurable:!0}),t.prototype.scrollIntoView=function(e,t,i){(null==this._maxOffsetY||this._rows._dirty||this._cols._dirty)&&this._updateLayout();var o=this.scrollPosition,n=this._szClient.width,r=this._szClient.height-this._gpCFtr.rows.getTotalSize(),s=this.cells._getFrozenPos();if((e=asInt(e))>-1&&e<this._rows.length&&e>=this._rows.frozen){var l=this._rows[e],a=this.cells.height>r?Math.round(l.pos/(this.cells.height-r)*100)/100:0,h=Math.round(this._maxOffsetY*a),c=l.pos-h,u=c+l.renderSize;u>r-o.y&&(o.y=Math.max(-c,r-u)),c-s.y<-o.y&&(o.y=-(c-s.y))}if((t=asInt(t))>-1&&t<this._cols.length&&t>=this._cols.frozen){var d=this._cols[t],g=d.pos+d.renderSize;g>-o.x+n&&(o.x=Math.max(-d.pos,n-g)),d.pos-s.x<-o.x&&(o.x=-(d.pos-s.x))}return!o.equals(this._ptScrl)&&(this.scrollPosition=o,i&&(this._updateScrollPosition(),this.refresh()),!0)},t.prototype.isRangeValid=function(e){return e.isValid&&e.bottomRow<this.rows.length&&e.rightCol<this.columns.length},t.prototype.startEditing=function(e,t,i,o){return void 0===e&&(e=!0),this._edtHdl.startEditing(e,t,i,o)},t.prototype.finishEditing=function(e){return this._edtHdl.finishEditing(e)},Object.defineProperty(t.prototype,"activeEditor",{get:function(){return this._edtHdl.activeEditor},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"editRange",{get:function(){return this._edtHdl.editRange},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"mergeManager",{get:function(){return this._mrgMgr},set:function(e){e!=this._mrgMgr&&(this._mrgMgr=asType(e,MergeManager,!0),this.invalidate())},enumerable:!0,configurable:!0}),t.prototype.getMergedRange=function(e,t,i,o){return void 0===o&&(o=!0),this._mrgMgr?this._mrgMgr.getMergedRange(e,t,i,o):null},Object.defineProperty(t.prototype,"keyActionTab",{get:function(){return this._keyHdl._kaTab},set:function(e){this._keyHdl._kaTab=asEnum(e,KeyAction)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"keyActionEnter",{get:function(){return this._keyHdl._kaEnter},set:function(e){this._keyHdl._kaEnter=asEnum(e,KeyAction)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"showDropDown",{get:function(){return this._shDropDown},set:function(e){e!=this._shDropDown&&(this._shDropDown=asBoolean(e,!0),this.invalidate())},enumerable:!0,configurable:!0}),t.prototype.toggleDropDownList=function(){this._tglDropDown||(this._tglDropDown=!0,this._edtHdl._toggleListBox(null),this._tglDropDown=!1)},t.prototype.onItemsSourceChanging=function(e){return this.itemsSourceChanging.raise(this,e),!e.cancel},t.prototype.onItemsSourceChanged=function(e){this.itemsSourceChanged.raise(this,e)},t.prototype.onScrollPositionChanged=function(e){this.scrollPositionChanged.raise(this,e)},t.prototype.onSelectionChanging=function(e){return this.selectionChanging.raise(this,e),!e.cancel},t.prototype.onSelectionChanged=function(e){this.selectionChanged.raise(this,e)},t.prototype.onLoadingRows=function(e){return this.loadingRows.raise(this,e),!e.cancel},t.prototype.onLoadedRows=function(e){this.loadedRows.raise(this,e)},t.prototype.onUpdatingLayout=function(e){return this.updatingLayout.raise(this,e),!e.cancel},t.prototype.onUpdatedLayout=function(e){this.updatedLayout.raise(this,e)},t.prototype.onResizingColumn=function(e){return this.resizingColumn.raise(this,e),!e.cancel},t.prototype.onResizedColumn=function(e){this.resizedColumn.raise(this,e)},t.prototype.onAutoSizingColumn=function(e){return this.autoSizingColumn.raise(this,e),!e.cancel},t.prototype.onAutoSizedColumn=function(e){this.autoSizedColumn.raise(this,e)},t.prototype.onDraggingColumn=function(e){return this.draggingColumn.raise(this,e),!e.cancel},t.prototype.onDraggingColumnOver=function(e){return this.draggingColumnOver.raise(this,e),!e.cancel},t.prototype.onDraggedColumn=function(e){this.draggedColumn.raise(this,e)},t.prototype.onResizingRow=function(e){return this.resizingRow.raise(this,e),!e.cancel},t.prototype.onResizedRow=function(e){this.resizedRow.raise(this,e)},t.prototype.onAutoSizingRow=function(e){return this.autoSizingRow.raise(this,e),!e.cancel},t.prototype.onAutoSizedRow=function(e){this.autoSizedRow.raise(this,e)},t.prototype.onDraggingRow=function(e){return this.draggingRow.raise(this,e),!e.cancel},t.prototype.onDraggingRowOver=function(e){return this.draggingRowOver.raise(this,e),!e.cancel},t.prototype.onDraggedRow=function(e){this.draggedRow.raise(this,e)},t.prototype.onGroupCollapsedChanging=function(e){return this.groupCollapsedChanging.raise(this,e),!e.cancel},t.prototype.onGroupCollapsedChanged=function(e){this.groupCollapsedChanged.raise(this,e)},t.prototype.onSortingColumn=function(e){return this.sortingColumn.raise(this,e),!e.cancel},t.prototype.onSortedColumn=function(e){this.sortedColumn.raise(this,e)},t.prototype.onBeginningEdit=function(e){return this.beginningEdit.raise(this,e),!e.cancel},t.prototype.onPrepareCellForEdit=function(e){this.prepareCellForEdit.raise(this,e)},t.prototype.onCellEditEnding=function(e){return this.cellEditEnding.raise(this,e),!e.cancel&&!e.stayInEditMode},t.prototype.onCellEditEnded=function(e){this.cellEditEnded.raise(this,e)},t.prototype.onRowEditStarting=function(e){this.rowEditStarting.raise(this,e)},t.prototype.onRowEditStarted=function(e){this.rowEditStarted.raise(this,e)},t.prototype.onRowEditEnding=function(e){this.rowEditEnding.raise(this,e)},t.prototype.onRowEditEnded=function(e){this.rowEditEnded.raise(this,e)},t.prototype.onRowAdded=function(e){return this.rowAdded.raise(this,e),!e.cancel},t.prototype.onDeletingRow=function(e){return this.deletingRow.raise(this,e),!e.cancel},t.prototype.onDeletedRow=function(e){this.deletedRow.raise(this,e)},t.prototype.onCopying=function(e){return this.copying.raise(this,e),!e.cancel},t.prototype.onCopied=function(e){this.copied.raise(this,e)},t.prototype.onPasting=function(e){return this.pasting.raise(this,e),!e.cancel},t.prototype.onPasted=function(e){this.pasted.raise(this,e)},t.prototype.onPastingCell=function(e){return this.pastingCell.raise(this,e),!e.cancel},t.prototype.onPastedCell=function(e){this.pastedCell.raise(this,e)},t.prototype.onFormatItem=function(e){this.formatItem.raise(this,e)},t.prototype.onUpdatingView=function(e){return this.updatingView.raise(this,e),!e.cancel},t.prototype.onUpdatedView=function(e){this.updatedView.raise(this,e)},t.prototype._getShowErrors=function(){return this.showErrors&&this._hasValidation},t.prototype._getHasValidation=function(){return this._hasValidation},t.prototype._getError=function(e,t,i){if(isFunction(this.itemValidator)){if(e==this.cells)return this.itemValidator(t,i);if(e==this.rowHeaders)for(i=0;i<this.columns.length;i++){if(a=this.itemValidator(t,i))return a}}var o=this._cv,n=o?o.getError:null;if(isFunction(n)){var r=e.rows,s=this.columns,l=r[t].dataItem;if(l&&!(l instanceof CollectionViewGroup))for(;t<r.length&&r[t].dataItem==l;t++){if(e==this.cells)return n(l,this._getBindingColumn(this.cells,t,s[i]).binding);if(e==this.rowHeaders)for(i=0;i<s.length;i++){var a;if(a=n(l,this._getBindingColumn(this.cells,t,s[i]).binding))return a}}}return null},t.prototype._setAria=function(e,t){setAttribute(this.cells.hostElement,"aria-"+e,t)},t.prototype._setFocus=function(e){if(this.hostElement&&(e||!this.containsFocus())){var t=getActiveElement(),i=this.activeEditor,o=this._activeCell,n=this._eFocus;i?contains(i,t)||(i.focus(),n.tabIndex=-1):o?contains(o,t)||t!=this._root&&(o.tabIndex=this._orgTabIndex,o.focus(),n.tabIndex=-1):contains(n,t)||t==this._root||(n.tabIndex=this._orgTabIndex,n.focus()),this.containsFocus()||(n.tabIndex=this._orgTabIndex,n.focus())}},t.prototype._setFocusNoScroll=function(e){if(e.tabIndex=this._orgTabIndex,supportsFocusOptions())e.focus({preventScroll:!0});else{var t=this.scrollPosition,i=e.style,o=i.position,n=i.opacity;i.opacity="0",i.position="fixed",e.focus(),i.position=o,i.opacity=n,this.scrollPosition=t}},t.prototype._getDefaultRowHeight=function(){var e=this.hostElement,t=this._eFocus,i=null;t.offsetHeight||(i=createElement('<div><div class="wj-cell">0</div></div>',document.body),e&&i.setAttribute("class",e.getAttribute("class")),t=i.children[0]);var o=t.offsetHeight;return(isNaN(o)||o<=6)&&(o=28),removeChild(i),o},t.prototype._getCollectionView=function(e){return asCollectionView(e)},t.prototype._getCanvasContext=function(){var e=document.createElement("canvas").getContext("2d"),t=getComputedStyle(this.hostElement);return e.font=t.fontSize+" "+t.fontFamily.split(",")[0],e},t.prototype._getWidestRow=function(e,t,i,o){for(var n=0,r=0,s=e.columns[i].dataType==DataType.Boolean,l=t.row;l<=t.row2;l++)if(e.rows[l].isVisible){var a=e.getCellData(l,i,!0),h=o.measureText(a).width,c=this.getMergedRange(e,l,i,!1);if(c&&c.columnSpan>1&&(h/=c.columnSpan),h>r&&(r=h,n=l),s)break}return n},t.prototype._getDesiredWidth=function(e,t,i,o){var n=this.getMergedRange(e,t,i,!1),r=o.style;return this.cellFactory.updateCell(e,t,i,o,n),r.width=r.top=r.left="",o.offsetWidth/(n&&n.columnSpan>1?n.columnSpan:1)},t.prototype._getDesiredHeight=function(e,t,i,o){var n=o.style,r=this.getMergedRange(e,t,i,!1),s=r?r.rowSpan:1;return this.cellFactory.updateCell(e,t,i,o,r),o.innerHTML.trim()||(o.innerHTML="&nbsp;"),n.height=n.top=n.left="",o.offsetHeight/s},t.prototype._getDesiredRowHeight=function(e,t,i,o){for(var n=0,r=0;r<e.columns.length;r++){var s=e.columns[r];if(s.isVisible){var l=this.getMergedRange(e,t,r,!1),a=void 0;if(this._getQuickAutoSize()){var h={ct:e.cellType,col:r,rng:l&&l.rowSpan>1?l.rowSpan:1,content:s.dataType==DataType.Number?"1":e.getCellData(t,r,!0)},c=JSON.stringify(h);null==(a=o[c])&&(a=this._getDesiredHeight(e,t,r,i),o[c]=a)}else a=this._getDesiredHeight(e,t,r,i);n=Math.max(a,n)}}return n},t.prototype._getSortRowIndex=function(){return null!=this._sortRowIndex?this._sortRowIndex:this.columnHeaders.rows.length-1},t.prototype._getEditColumnIndex=function(){return null!=this._editColIndex?this._editColIndex:this.rowHeaders.columns.length-1},t.prototype._sortConverter=function(e,t,i,o){var n;if(o){if(this._mappedColumns=null,this._cv)for(var r=this._cv.sortDescriptions,s=0;s<r.length;s++)(n=this.getColumn(r[s].property))&&n.dataMap&&(this._mappedColumns||(this._mappedColumns={}),this._mappedColumns[n.binding]=n.dataMap);this._mouseHdl._htDown&&this._mouseHdl._htDown.col>-1&&(n=this.columns[this._mouseHdl._htDown.col],this._mappedColumns&&n.dataMap&&(this._mappedColumns[n.binding]=n.dataMap))}if(this._mappedColumns){var l=this._mappedColumns[e.property];l&&l.sortByDisplayValues&&(i=l.getDisplayValue(i))}return i},t.prototype._bindGrid=function(e){var t=this;if(this.finishEditing(),this.deferUpdate(function(){t.autoGenerateColumns&&0==t._lastCount&&hasItems(t._cv)&&(e=!0);var i,o,n=t.selectionMode==SelectionMode.ListBox;if(t.preserveSelectedState&&n&&(i=t.selectedItems),t.preserveOutlineState&&isFunction(window.Map)&&t.rows.maxGroupLevel>-1){o=new Map;for(var r=0;r<t.rows.length;r++){var s=t.rows[r];if(s instanceof GroupRow&&s.isCollapsed&&s.dataItem){var l=s.dataItem;l instanceof CollectionViewGroup&&(l=l._path),o.set(l,!0)}}}e&&t.columns.deferUpdate(function(){t._bindColumns()});var a=new CancelEventArgs;t.onLoadingRows(a)&&(t.rows.deferUpdate(function(){t._bindRows()}),t.onLoadedRows(a));var h=0;if(i&&i.length)for(r=0;r<t.rows.length&&h<i.length;r++)i.indexOf(t.rows[r].dataItem)>-1&&(t.rows[r].isSelected=!0,h++);if(n&&0==h&&t._lastCount>0){var c=t.selection;for(r=c.topRow;r<=c.bottomRow&&r>-1&&r<t.rows.length;r++)t.rows[r].isSelected=!0}o&&t.rows.deferUpdate(function(){for(var e=0;e<t.rows.length;e++){var i=t.rows[e];if(i instanceof GroupRow){var n=i.dataItem;n instanceof CollectionViewGroup&&(n=n._path),o.get(n)&&(i.isCollapsed=!0)}}}),!t._lastCount&&t._cv&&t._cv.items&&(t._lastCount=t._cv.items.length)}),!this.rows.length){var i=this._selHdl.selection;i.row=i.row2=-1}this._cv&&this._syncSelection(e)},t.prototype._cvCollectionChanged=function(e,t){if(this.autoGenerateColumns&&0==this.columns.length)this._bindGrid(!0);else{var i=NotifyCollectionChangedAction;if(this.childItemsPath&&t.action!=i.Change)this._bindGrid(!1);else{switch(t.action){case i.Change:return void this.invalidate();case i.Add:if(t.index==this._cv.items.length-1){var o=this.rows.length;return this.rows[o-1]instanceof _NewRowTemplate&&o--,void this.rows.insert(o,new Row(t.item))}assert(!1,"added item should be the last one.");break;case i.Remove:var n=this._findRow(t.item);if(n>-1)return this.rows.removeAt(n),void this._syncSelection(!1);assert(!1,"removed item not found on grid.")}this._bindGrid(!1)}}},t.prototype._cvCurrentChanged=function(e,t){this._syncSelection(!1)},t.prototype._syncSelection=function(e){if(this._cv&&this.selectionMode!=SelectionMode.None){var t=this._selHdl.selection,i=t.row>-1&&t.row<this.rows.length?this.rows[t.row]:null,o=i?i.dataItem:null;if(this.newRowAtTop&&i instanceof _NewRowTemplate&&(o=null),o instanceof CollectionViewGroup&&(o=null),(o!=this._cv.currentItem||e)&&(!this.childItemsPath||!this.editableCollectionView||!this.editableCollectionView.currentAddItem)){var n=this._getRowIndex(this._cv.currentPosition);n==t.row&&this.childItemsPath||(t=new CellRange(n,t.col,n,t.col2),this.select(t,!1),this.selectionMode&&this.scrollIntoView(t.row,-1))}}},t.prototype._getRowIndex=function(e){if(this._cv){if(e>-1){for(var t=this._cv.items[e];e<this.rows.length;e++)if(this.rows[e].dataItem===t)return e;return-1}if(1==this.rows.length&&this.rows[0]instanceof _NewRowTemplate)return 0;var i=this.selection.row,o=i>-1?this.rows[i]:null;return o&&(o instanceof GroupRow||null==o.dataItem)?i:-1}return this.selection.row},t.prototype._getCvIndex=function(e){if(this._cv&&e>-1&&e<this.rows.length){var t=this._cv.items,i=this.rows[e].dataItem;for(e=Math.min(e,t.length-1);e>-1;e--)if(t[e]===i)return e}return-1},t.prototype._findRow=function(e){for(var t=0;t<this.rows.length;t++)if(this.rows[t].dataItem==e)return t;return-1},t.prototype._updateLayout=function(){var e=new CancelEventArgs;if(this.onUpdatingLayout(e)){var i=this._hdrVis&HeadersVisibility.Row?this._hdrCols.getTotalSize():0,o=this._hdrVis&HeadersVisibility.Column?this._hdrRows.getTotalSize():0,n=this._ftrRows.getTotalSize(),r=this._rows.getTotalSize()+n;r<1&&(r=1),this._heightBrowser=Math.min(r,t._getMaxSupportedCssHeight()),this._maxOffsetY=Math.max(0,r-this._heightBrowser);var s=getComputedStyle(this._eFocus);this._cellPadLeft=parseInt(this.rightToLeft?s.paddingRight:s.paddingLeft),this._cellPadVert=parseInt(s.paddingTop)+parseInt(s.paddingBottom);var l=this._heightBrowser+o-n,a=this._gpCells.width,h=this._heightBrowser;!a&&this.rows.length&&(a=.1),!h&&this.columns.length&&(h=.1),this.rightToLeft?(setCss(this._eTL,{right:0,top:0,width:i,height:o}),setCss(this._eCHdr,{right:i,top:0,height:o}),setCss(this._eRHdr,{right:0,top:o,width:i}),setCss(this._eCt,{right:i,top:o,width:a,height:h}),setCss(this._fCt,{right:i,top:o}),setCss(this._eBL,{right:0,top:l,width:i,height:n}),setCss(this._eCFtr,{right:i,top:l,height:n})):(setCss(this._eTL,{left:0,top:0,width:i,height:o}),setCss(this._eCHdr,{left:i,top:0,height:o}),setCss(this._eRHdr,{left:0,top:o,width:i}),setCss(this._eCt,{left:i,top:o,width:a,height:h}),setCss(this._fCt,{left:i,top:o}),setCss(this._eBL,{left:0,top:l,width:i,height:n}),setCss(this._eCFtr,{left:i,top:l,height:n})),this._stickyHdr&&this._updateStickyHeaders();var c=this.frozenRows||this.frozenColumns?"3":"";setCss([this._eTL,this._eBL,this._eCHdr,this._eCFtr,this._eRHdr,this._eMarquee],{zIndex:c});var u=this._root,d=u.offsetWidth-u.clientWidth,g=u.offsetHeight-u.clientHeight;setCss(this._eSz,{width:i+d+this._gpCells.width,height:o+g+this._heightBrowser});var p=null;this.columns._updateStarSizes(u.clientWidth-i)&&(p=u.clientWidth,setCss(this._eCt,{width:this._gpCells.width})),this._szClient=new Size(u.clientWidth-i,u.clientHeight-o),this._rcBounds=null,this._updateScrollHandler(),this._updateContent(!1),d=u.offsetWidth-u.clientWidth,g=u.offsetHeight-u.clientHeight,setCss(this._eSz,{width:i+d+this._gpCells.width,height:o+g+this._heightBrowser}),this._szClient=new Size(u.clientWidth-i,u.clientHeight-o),p&&p!=u.clientWidth&&this.columns._updateStarSizes(u.clientWidth-i)&&(setCss(this._eCt,{width:this._gpCells.width}),this._updateContent(!1)),setCss([this._eCHdr,this._eCFtr,this._fCt],{width:this._szClient.width}),setCss([this._eRHdr,this._fCt],{height:this._szClient.height}),n&&(l=Math.min(l,this._szClient.height+o-n),setCss([this._eBL,this._eCFtr],{top:l})),this.onUpdatedLayout(e)}},t.prototype._updateStickyHeaders=function(){var e=!1,i=0;if(this._stickyHdr){for(var o=0,n=null,r=this.hostElement;r;r=r.parentElement){var s=r.getBoundingClientRect();null==n&&(n=s.top),o=Math.max(o,s.top)}i=-(n=Math.max(0,o-n-1)),e=n>0,this._rcBounds=null}this._eTL.style.top=this._eCHdr.style.top=e?-i+"px":"",toggleClass(this._eTL,t._WJS_STICKY,e),toggleClass(this._eCHdr,t._WJS_STICKY,e)},t.prototype._updateScrollHandler=function(){this._clipToScreen=this._getClipToScreen();var e=this._stickyHdr||this._clipToScreen;e!=this._scrollHandlerAttached&&(this._scrollHandlerAttached=e,e?this.addEventListener(window,"scroll",this._scroll.bind(this),!0):this.removeEventListener(window,"scroll"))},t.prototype._getClipToScreen=function(){if(this.rows.length<=t._MIN_VIRT_ROWS)return!1;if(this._root.clientHeight!=this._root.scrollHeight)return!1;for(var e=this.hostElement;e&&e!=document.documentElement;e=e.parentElement){if("auto"==getComputedStyle(e).overflow)return!1}return!0},t.prototype._scroll=function(e){var t=this;contains(e.target,this.hostElement)&&(this._clipToScreen&&(this._afClip&&cancelAnimationFrame(this._afClip),this._afClip=requestAnimationFrame(function(){t._afClip=null,t.finishEditing(),t._updateContent(!0)})),this._stickyHdr&&(this._afSticky&&cancelAnimationFrame(this._afSticky),this._afSticky=requestAnimationFrame(function(){t._afSticky=null;var e=new CancelEventArgs;t.onUpdatingLayout(e)&&(t._updateStickyHeaders(),t.onUpdatedLayout(e))})))},t.prototype._updateScrollPosition=function(){var e=this._root,i=e.scrollTop,o=e.scrollLeft;this.rightToLeft&&"rev"==t._getRtlMode()&&(o=e.scrollWidth-e.clientWidth-o);var n=new Point(-Math.abs(o),-i);return!this._ptScrl.equals(n)&&(this._ptScrl=n,this.onScrollPositionChanged(),!0)},t.prototype._updateContent=function(e,t){var i=this,o=this._root,n=this.hostElement,r=this.cells.hostElement,s=getActiveElement(),l=contains(n,s)?s:null,a=this._activeCell,h=new CancelEventArgs;if(this.onUpdatingView(h)){setAttribute(r,"role",this.rows.maxGroupLevel<0?"grid":"treegrid"),this._hasValidation=isFunction(this._itemValidator)||this._cv&&isFunction(this._cv.getError);var c=!t&&this._errorTip&&this._errorTip._tips.length;if(this._offsetY=0,this._heightBrowser>this._szClient.height){var u=Math.round(-this._ptScrl.y/(this._heightBrowser-this._szClient.height)*100)/100;this._offsetY=Math.round(this._maxOffsetY*u)}this._updateScrollPosition();var d=this._gpCells._updateContent(e,t,this._offsetY);if(this._hdrVis&HeadersVisibility.Column&&(!t||this._ssHdr&HeadersVisibility.Column)&&this._gpCHdr._updateContent(e,t,0),this._hdrVis&HeadersVisibility.Row&&(!t||this._ssHdr&HeadersVisibility.Row)&&this._gpRHdr._updateContent(e,t,this._offsetY),this._hdrVis&&!t&&this._gpTL._updateContent(e,t,0),this._gpCFtr.rows.length&&(this._gpBL._updateContent(e,t,0),this._gpCFtr._updateContent(e,t,0)),this.showMarquee){var g=this._selHdl.selection,p=this._eMarquee;if(this.isRangeValid(g)){var f=this._getMarqueeRect(g),_=p.firstChild,w=p.offsetWidth-_.offsetWidth,m=p.offsetHeight-_.offsetHeight;setCss(p,{left:f.left+r.offsetLeft-w/2,top:f.top+r.offsetTop-m/2,width:f.width+w,height:f.height+m,visibility:f.width>0&&f.height>0?"":"collapse"})}else setCss(p,{left:0,top:0,width:0,height:0,visibility:"collapse"})}if(c&&this._errorTip&&this._errorTip._tips.length&&(this._toErrorTips&&clearTimeout(this._toErrorTips),this._toErrorTips=setTimeout(function(){i._errorTip.hide();for(var e=i._errorTip._tips,t=0;t<e.length;t++){var o=e[t].element;o.offsetHeight&&hasClass(o,"wj-state-invalid")||(i._errorTip.setTooltip(o,null),t--)}},250)),this._useFrozenDiv()&&(this._updateFrozenCells(t),d&&hasClass(d,"wj-frozen")&&(d=null)),this._fCt.style.display=this._fCt.childElementCount?"":"none",this._activeCell=d,l)if(l!=o&&l!=this._eFocus&&contains(n,l)&&!contains(r,l)){if(getActiveElement()!==l&&l.focus(),isIE()&&l instanceof HTMLInputElement&&!l.type.match(/checkbox|radio|range/i)){var C=l.selectionStart,y=l.selectionEnd;l.setSelectionRange(C,y)}}else{var v=d!==a;this._setFocus(v)}!l&&d&&(d.tabIndex=this._orgTabIndex),a&&a!=d&&(a.tabIndex=-1),this._rcBounds=null,this.onUpdatedView(h)}},t.prototype._clearCells=function(){for(var e in this)if("_"==e[0]){var t=this[e];t instanceof GridPanel&&t._clearCells()}this.invalidate()},t.prototype._useFrozenDiv=function(){return isBoolean(this._fzClone)?this._fzClone:isIE()||isFirefox()||isSafari()||isMobile()},t.prototype._updateFrozenCells=function(e){var t=this._fCt;if(this.frozenRows||this.frozenColumns){var i=this._eCt.querySelectorAll(".wj-frozen");if(e&&t.children.length==i.length){for(var o=0;o<i.length;o++)t.children[o].className=i[o].className;return}if(setText(t,null),!this.activeEditor){var n=this._errorTip;for(o=0;o<i.length;o++){var r=i[o];if(closest(r,".wj-flexgrid")==this.hostElement&&(r=i[o].cloneNode(!0),t.appendChild(r),n)){var s=n.getTooltip(i[o]);s&&n.setTooltip(r,s)}}}}else setText(t,null)},t.prototype._getMarqueeRect=function(e){var t=this.getMergedRange(this.cells,e.topRow,e.leftCol)||new CellRange(e.topRow,e.leftCol),i=this.getMergedRange(this.cells,e.bottomRow,e.rightCol)||new CellRange(e.bottomRow,e.rightCol),o=this.cells.getCellBoundingRect(t.topRow,t.leftCol,!0),n=this.cells.getCellBoundingRect(i.bottomRow,i.rightCol,!0);if(this.rows.frozen){var r=Math.min(this.rows.length,this.rows.frozen),s=this.cells.getCellBoundingRect(r-1,0,!0);e.topRow>=r&&o.top<s.bottom&&(o.top=s.bottom),e.bottomRow>=r&&n.bottom<s.bottom&&(n.height=s.bottom-n.top)}if(this.columns.frozen){var l=Math.min(this.columns.length,this.columns.frozen);s=this.cells.getCellBoundingRect(0,l-1,!0);this.rightToLeft?(e.leftCol>=l&&o.right>s.left&&(o.left=s.left-o.width),e.rightCol>=l&&n.left>s.left&&(n.left=s.left)):(e.leftCol>=l&&o.left<s.right&&(o.left=s.right),e.rightCol>=l&&n.right<s.right&&(n.width=s.right-n.left))}return this.rightToLeft?new Rect(n.left,o.top,o.right-n.left,n.bottom-o.top):new Rect(o.left,o.top,n.right-o.left,n.bottom-o.top)},t.prototype._bindColumns=function(){for(var e=this,t=0;t<this.columns.length;t++){this.columns[t]._getFlag(RowColFlags.AutoGenerated)&&(this.columns.removeAt(t),t--)}var i=this._cv,o=i?i.sourceCollection:null;o&&o.length&&this.autoGenerateColumns&&getTypes(o).forEach(function(t){var i=new Column(t);i._setFlag(RowColFlags.AutoGenerated,!0),i.name=t.binding,i.header=toHeaderCase(t.binding),i.dataType==DataType.Number&&(i.width=80),e.columns.push(i)}),this._updateColumnTypes()},t.prototype._updateColumnTypes=function(){var e=this._cv;if(hasItems(e))for(var t=e.items[0],i=this.columns,o=0;o<i.length;o++){var n=i[o];null==n.dataType&&n._binding&&(n.dataType=getType(n._binding.getValue(t)))}},t.prototype._getBindingColumn=function(e,t,i){return i},t.prototype._getRowHeaderPath=function(){return this._rowHdrPath},t.prototype._bindRows=function(){this.rows.clear();var e=this._cv;if(e&&e.items){var t=e.items,i=e.groups;if(this.childItemsPath)for(var o=0;o<t.length;o++)this._addNode(t,o,0);else if(null!=i&&i.length>0&&this.showGroups)for(o=0;o<i.length;o++)this._addGroup(i[o]);else for(o=0;o<t.length;o++)this._addBoundRow(t,o)}},t.prototype._addBoundRow=function(e,t){this.rows.push(new Row(e[t]))},t.prototype._addNode=function(e,t,i){var o=new GroupRow,n=this.childItemsPath,r=isArray(n)?n[i]:n,s=e[t],l=s[r];if(o.dataItem=s,o.level=i,this.rows.push(o),isArray(l))for(var a=0;a<l.length;a++)this._addNode(l,a,i+1)},t.prototype._addGroup=function(e){var t=new GroupRow;if(t.level=e.level,t.dataItem=e,this.rows.push(t),e.isBottomLevel)for(var i=e.items,o=0;o<i.length;o++)this._addBoundRow(i,o);else for(o=0;o<e.groups.length;o++)this._addGroup(e.groups[o])},t._getSerializableProperties=function(e){var t=[];for(e=e.prototype;e!=Object.prototype;e=Object.getPrototypeOf(e))for(var i=Object.getOwnPropertyNames(e),o=0;o<i.length;o++){var n=i[o],r=Object.getOwnPropertyDescriptor(e,n);r&&r.set&&r.get&&"_"!=n[0]&&!n.match(/disabled|required/)&&t.push(n)}return t},t.prototype._copy=function(e,t){if("columns"==e){this.columns.clear();for(var i=asArray(t),o=0;o<i.length;o++){var n=new Column;copy(n,i[o]),this.columns.push(n)}return!0}return!1},t.prototype._isInputElement=function(e){if(e instanceof HTMLElement&&!hasClass(e,"wj-btn-glyph")){if("true"==e.contentEditable)return!0;var t=e.tagName.match(/^(BUTTON|A|INPUT|TEXTAREA|SELECT|OPTION)$/i);return t&&t.length>0}return!1},t.prototype._wantsInput=function(e){return this._isInputElement(e)&&!this.activeEditor&&!this._edtHdl._isNativeCheckbox(e)&&!hasClass(e,"wj-grid-ime")&&contains(document.body,e)},t._getMaxSupportedCssHeight=function(){if(!t._maxCssHeight){var e=335e5;isIE()?e=15e5:isFirefox()&&(e=175e5),t._maxCssHeight=e}return t._maxCssHeight},t._getRtlMode=function(){if(!t._rtlMode){var e=createElement('<div dir="rtl" style="visibility:hidden;width:100px;height:100px;overflow:auto"><div style="width:2000px;height:2000px"></div></div>');document.body.appendChild(e);var i=e.scrollLeft;e.scrollLeft=-1e3;var o=e.scrollLeft;removeChild(e),t._rtlMode=o<0?"neg":i>0?"rev":"std"}return t._rtlMode},t._WJS_STICKY="wj-state-sticky",t._WJS_MEASURE="wj-state-measuring",t._WJS_UPDATING="wj-state-updating",t._MIN_VIRT_ROWS=200,t.controlTemplate='<div style="position:relative;width:100%;height:100%;overflow:hidden;max-width:inherit;max-height:inherit"><div wj-part="root" style="position:absolute;left:0;top:0;width:100%;height:100%;overflow:auto;max-width:inherit;max-height:inherit;-webkit-overflow-scrolling:touch;"><div wj-part="cells" class="wj-cells" style="position:absolute"></div><div wj-part="marquee" class="wj-marquee" style="display:none;pointer-events:none;"><div style="width:100%;height:100%"></div></div></div><div wj-part="fcells" aria-hidden="true" class="wj-cells wj-frozen-clone" style="position:absolute;top:0;left:0;pointer-events:none;overflow:hidden"></div><div wj-part="rh"><div wj-part="rhcells" class="wj-rowheaders"></div></div><div wj-part="cf"><div wj-part="cfcells" class="wj-colfooters"></div></div><div wj-part="ch"><div wj-part="chcells" class="wj-colheaders"></div></div><div wj-part="bl"><div wj-part="blcells" class="wj-bottomleft"></div></div><div wj-part="tl"><div wj-part="tlcells" class="wj-topleft"></div></div><div wj-part="focus" class="wj-cell" style="position:fixed;left:-32000px">0</div><div wj-part="sz" style="position:relative;visibility:hidden"></div></div>',t}(Control);export{FlexGrid};export var KeyAction;!function(e){e[e.None=0]="None",e[e.MoveDown=1]="MoveDown",e[e.MoveAcross=2]="MoveAcross",e[e.Cycle=3]="Cycle",e[e.CycleOut=4]="CycleOut"}(KeyAction||(KeyAction={}));var _KeyboardHandler=function(){function e(e){this._kaTab=KeyAction.None,this._kaEnter=KeyAction.MoveDown,this._g=e;var t=e.hostElement;e.addEventListener(t,"keypress",this._keypress.bind(this)),e.addEventListener(t,"keydown",this._keydown.bind(this))}return e.prototype._keydown=function(e){var t=this._g,i=t._edtHdl,o=t.selection,n=e.ctrlKey||e.metaKey,r=e.shiftKey,s=e.target,l=!0;if(this._altDown=!1,!t._wantsInput(s)){var a=e.defaultPrevented&&!(s instanceof HTMLInputElement);if(t.isRangeValid(o)&&!a&&(!t.activeEditor||!i._keydown(e))){var h=tryCast(t.rows[o.row],GroupRow),c=t.editableCollectionView,u=t._getKeyCode(e);if(t.autoClipboard){if(n&&(67==u||45==u)){var d=new CellRangeEventArgs(t.cells,o);if(t.onCopying(d)){var g=t.getClipString()+"\r\n";Clipboard.copy(g),t.onCopied(d)}return void e.stopPropagation()}if(n&&86==u||r&&45==u)return t.isReadOnly||Clipboard.paste(function(e){t.setClipString(e)}),void e.stopPropagation()}(r||n)&&"Space"==e.code&&(u=Key.Space);var p=SelMove,f=SelectionMode;switch(u){case Key.Space:if(r&&o.isValid)switch(t.selectionMode){case f.CellRange:case f.Row:case f.RowRange:case f.ListBox:t.select(new CellRange(o.row,0,o.row,t.columns.length-1))}else if(n&&o.isValid)switch(t.selectionMode){case f.CellRange:t.select(new CellRange(0,o.col,t.rows.length-1,o.col))}else(l=this._startEditing(!0,e))&&setTimeout(function(){var e=t.activeEditor;e&&(e.disabled||e.readOnly?t.finishEditing():"checkbox"==e.type&&(e.checked=!e.checked,t.finishEditing()))});break;case 65:if(n)switch(t.selectionMode){case f.CellRange:case f.Row:case f.RowRange:case f.ListBox:t.select(new CellRange(0,0,t.rows.length-1,t.columns.length-1))}else l=!1;break;case Key.Left:n||e.altKey?l=!1:o.isValid&&0==o.leftCol&&null!=h&&!h.isCollapsed&&h.hasChildren?h.isCollapsed=!0:this._moveSel(p.None,n?p.Home:p.Prev,r);break;case Key.Right:n||e.altKey?l=!1:o.isValid&&0==o.leftCol&&null!=h&&h.isCollapsed?h.isCollapsed=!1:this._moveSel(p.None,n?p.End:p.Next,r);break;case Key.Up:n?l=!1:(this._altDown=e.altKey,e.altKey?l=i._toggleListBox(e):this._moveSel(p.Prev,p.None,r));break;case Key.Down:n?l=!1:(this._altDown=e.altKey,e.altKey?l=i._toggleListBox(e):this._moveSel(p.Next,p.None,r));break;case Key.PageUp:if(this._altDown=e.altKey,this._moveSel(e.altKey?p.Home:p.PrevPage,p.None,r),t.rows.frozen&&t.selection.row<t.rows.frozen){var _=t.scrollPosition;_.y&&(t.scrollPosition=new Point(_.x,0))}break;case Key.PageDown:this._altDown=e.altKey,this._moveSel(e.altKey?p.End:p.NextPage,p.None,r);break;case Key.Home:this._moveSel(n?p.Home:p.None,p.Home,r);break;case Key.End:this._moveSel(n?p.End:p.None,p.End,r);break;case Key.Tab:l=this._performKeyAction(t.keyActionTab,r);break;case Key.Enter:l=this._performKeyAction(t.keyActionEnter,r),!r&&c&&null!=c.currentEditItem&&i._commitRowEdits();break;case Key.Escape:if(l=!1,c&&(c.currentAddItem||c.currentEditItem)){var w=new CellRangeEventArgs(t.cells,t.selection);w.cancel=!0,t.onRowEditEnding(w),c.currentAddItem&&c.cancelNew(),c.currentEditItem&&c.cancelEdit(),t.onRowEditEnded(w),l=!0}t._mouseHdl.resetMouseState();break;case Key.Delete:case Key.Back:l=this._deleteSel(e);break;case Key.F2:l=this._startEditing(!0,e);break;case Key.F4:l=i._toggleListBox(e);break;default:l=!1}l&&(t.containsFocus()||t.focus(),e.preventDefault(),e.stopPropagation())}}},e.prototype._performKeyAction=function(e,t){var i=KeyAction,o=SelMove;switch(e){case i.MoveDown:return this._moveSel(t?o.Prev:o.Next,o.None,!1),!0;case i.MoveAcross:return this._moveSel(o.None,t?o.Prev:o.Next,!1),!0;case i.Cycle:return this._moveSel(o.None,t?o.PrevCell:o.NextCell,!1),!0;case i.CycleOut:var n=this._g.selection;return this._moveSel(o.None,t?o.PrevCell:o.NextCell,!1),!n.equals(this._g.selection)}return!1},e.prototype._keypress=function(e){var t=this,i=this._g;if(!i._wantsInput(e.target)&&!e.defaultPrevented)if(this._altDown)e.preventDefault();else{var o=i._edtHdl;if(i.activeEditor)o._keypress(e);else if(e.charCode>Key.Space)if(this._startEditing(!1,e)&&i.activeEditor){var n=getActiveElement();if(n instanceof HTMLInputElement&&"checkbox"!=n.type||n instanceof HTMLTextAreaElement){var r=i._selHdl.selection,s=i.getCellData(r.row,r.col,!0),l=i.getCellData(r.row,r.col,!1),a=culture.Globalize.numberFormat["%"]||"%",h=String.fromCharCode(e.charCode),c=isNumber(l)&&s.indexOf(a)>-1||""==s&&n.value==a;n.value=h+(c?a:""),setSelectionRange(n,1),n.dispatchEvent(o._evtInput),o._keypress(e),o._edtValue=n.value!=s?n.value:null,e.preventDefault()}}else if(i.autoSearch){var u=!1;r=i._selHdl.selection;if(e.charCode>32||32==e.charCode&&this._search){e.preventDefault(),this._search+=String.fromCharCode(e.charCode).toLowerCase(),this._toSearch&&clearTimeout(this._toSearch),this._toSearch=setTimeout(function(){t._toSearch=null,t._search=""},Control._SEARCH_DELAY);var d=this._findNext(r.row,r.col);d<0&&this._search.length>1&&(this._search=this._search[this._search.length-1],d=this._findNext(r.row,r.col)),d>-1&&(u=!0,i.select(d,r.col))}u||(this._search="")}}},e.prototype._findNext=function(e,t){var i=this._g,o=i.rows.length;(e<0||1==this._search.length)&&e++;for(var n=0;n<o;n++){var r=(e+n)%o;if(0==i.getCellData(r,t,!0).trim().toLowerCase().indexOf(this._search))return r}return-1},e.prototype._moveSel=function(e,t,i){this._g.selectionMode!=SelectionMode.None&&this._g._selHdl.moveSelection(e,t,i)},e.prototype._deleteSel=function(e){var t=this._g,i=t.editableCollectionView,o=t.selection,n=t.rows,r=[],s=new CellRange,l=new CellEditEndingEventArgs(t.cells,s,e),a=SelectionMode;if(t.allowDelete&&!t.isReadOnly&&(null==i||i.canRemove&&!i.isAddingNew&&!i.isEditingItem))switch(t.selectionMode){case a.CellRange:if(0==o.leftCol&&o.rightCol==t.columns.length-1)for(var h=o.topRow;h>-1&&h<=o.bottomRow;h++)r.push(n[h]);break;case a.ListBox:for(h=0;h<n.length;h++)n[h].isSelected&&r.push(n[h]);break;case a.Row:o.topRow>-1&&r.push(n[o.topRow]);break;case a.RowRange:for(h=o.topRow;h>-1&&h<=o.bottomRow;h++)r.push(n[h])}if(r.length>0){if(t.deferUpdate(function(){i&&i.beginUpdate();for(var e=r.length-1;e>=0;e--){var o=r[e];s.setRange(o.index,-1),t.onDeletingRow(l)&&(i&&o.dataItem?i.remove(o.dataItem):t.rows.removeAt(o.index),t.onDeletedRow(l))}i&&i.endUpdate()}),t.selectionMode==a.ListBox){var c=t.selection.row;c>-1&&c<t.rows.length&&(t.rows[c].isSelected=!0)}return t.childItemsPath&&t.collectionView&&t.collectionView.refresh(),!0}if(!t.isReadOnly&&0==r.length){var u=!1,d=t.scrollPosition;return t.deferUpdate(function(){for(var e=o.topRow;e<=o.bottomRow;e++){var n=t.rows[e];if(!n.isReadOnly)for(var r=o.leftCol;r<=o.rightCol;r++){var a=t._getBindingColumn(t.cells,e,t.columns[r]);if(!a.getIsRequired(n)&&!a.isReadOnly&&!n.isReadOnly&&t.getCellData(e,r,!0)&&(s.setRange(e,r),l.cancel=!1,t.onBeginningEdit(l))){if(i){var h=i.currentEditItem;!u&&h&&h!=n.dataItem&&(u=!0,i.beginUpdate()),h=n.dataItem,i.editItem(h),t._edtHdl._edItem=h}t.setCellData(e,r,"",!0,!1),t.onCellEditEnding(l),t.onCellEditEnded(l)}}}t.selection=o,t.scrollPosition=d,u&&i.endUpdate()}),!0}return!1},e.prototype._startEditing=function(e,t,i,o){return this._g._edtHdl.startEditing(e,i,o,!0,t)},e}();export{_KeyboardHandler};var _ImeHandler=function(){function e(t){this._updateImeFocusBnd=this._updateImeFocus.bind(this),this._cmpstartBnd=this._compositionstart.bind(this),this._mousedownBnd=this._mousedown.bind(this),this._mouseupBnd=this._mouseup.bind(this),this._keydownBnd=this._keydown.bind(this),this._ignoreKey=!1,this._g=t;var i=createElement('<textarea class="wj-grid-editor wj-form-control wj-grid-ime" aria-hidden="true"/>');disableAutoComplete(i),setCss(i,e._cssHidden),this._tbx=i,t._root.appendChild(i),this._updateImeFocus();var o=t.hostElement,n=t.addEventListener.bind(t);n(i,"compositionstart",this._cmpstartBnd),n(o,"blur",this._updateImeFocusBnd,!0),n(o,"focus",this._updateImeFocusBnd),n(o,"mousedown",this._mousedownBnd,!0),n(o,"mouseup",this._mouseupBnd,!0),n(o,"keydown",this._keydownBnd,!0),t.cellEditEnded.addHandler(this._cellEditEnded,this),t.selectionChanged.addHandler(this._updateImeFocus,this)}return e.prototype.dispose=function(){var e=this._g,t=e.hostElement,i=this._tbx,o=e.removeEventListener.bind(e);o(i,"compositionstart",this._cmpstartBnd),o(t,"blur",this._updateImeFocusBnd),o(t,"focus",this._updateImeFocusBnd),o(t,"mousedown",this._mousedownBnd),o(t,"mouseup",this._mouseupBnd),o(t,"keydown",this._keydownBnd),e.cellEditEnded.removeHandler(this._cellEditEnded),e.selectionChanged.removeHandler(this._updateImeFocus),removeChild(i)},e.prototype._keydown=function(e){var t=this._g;this._ignoreKey=!1,t.activeEditor||"Space"!=e.code||(this._tbx.value="",e.shiftKey||e.ctrlKey?this._ignoreKey=!0:this._compositionstart())},e.prototype._compositionstart=function(){var e=this._g;if(!e.activeEditor&&!this._ignoreKey){var t=e._selHdl.selection;if(e.startEditing(!1,t.row,t.col,!1)&&e.activeEditor){t=e.editRange;var i=e.activeEditor,o=this._tbx,n=e.cells.hostElement,r=e.columns[t.col].pos+n.offsetLeft,s=e.rows[t.row].pos+n.offsetTop,l=e.getCellBoundingRect(t.row,t.col),a=closest(i,".wj-cell");l.width=a.offsetWidth,l.height=a.offsetHeight,t.row<e.frozenRows&&(s+=e._root.scrollTop),t.col<e.frozenColumns&&(r+=e._root.scrollLeft);var h=a.querySelector(".wj-btn.wj-right");h&&(l.width-=h.offsetWidth),"minLength,maxLength,pattern".split(",").forEach(function(e){setAttribute(o,e,i.getAttribute(e))});var c=i instanceof HTMLTextAreaElement;setAttribute(o,"wrap",c?"soft":"off");var u=getComputedStyle(a),d=u.paddingTop;if(t.rowSpan>1&&!c){var g=parseFloat(u.lineHeight);isNaN(g)&&(g=1.2*parseFloat(u.fontSize)),d=Math.max(0,(l.height-g)/2)+"px"}setCss(o,{position:"absolute",left:r,top:s,width:l.width-1,height:l.height-1,paddingTop:d,paddingLeft:u.paddingLeft,paddingRight:u.paddingRight,textAlign:u.textAlign,zIndex:a.style.zIndex}),e._edtHdl._edt=o;var p=i.value;setTimeout(function(){"　"!=o.value&&" "!=o.value||(o.value=p,setSelectionRange(o,p.length))},20),i.value=""}}},e.prototype._cellEditEnded=function(){var t=this;setCss(this._tbx,e._cssHidden),setTimeout(function(){t._tbx.value=""})},e.prototype._mousedown=function(e){this._isMouseDown=!0,this._updateImeFocus()},e.prototype._mouseup=function(e){this._isMouseDown=!1,this._updateImeFocus()},e.prototype._updateImeFocus=function(){var e=this._g,t=this._tbx,i=getActiveElement();e.activeEditor||closest(i,".wj-flexgrid")!=e.hostElement||(this._enableIme()?i!=t&&(t.disabled=!1,t.select(),t.focus()):(t.disabled=!0,t.value=""))},e.prototype._enableIme=function(){var e=this._g,t=e._selHdl.selection;if(!e.canEditCell(t.row,t.col))return!1;var i=t.isValid?e._getBindingColumn(e.cells,t.row,e.columns[t.col]):null;return!(!i||i.dataType==DataType.Boolean)},e._cssHidden={position:"fixed",left:-10,top:-10,width:"1px",overflow:"hidden"},e}();export{_ImeHandler};var _AddNewHandler=function(){function e(e){this._nrt=new _NewRowTemplate,this._g=e,this._keydownBnd=this._keydown.bind(this),this._attach()}return Object.defineProperty(e.prototype,"newRowAtTop",{get:function(){return this._top},set:function(e){e!=this.newRowAtTop&&(this._top=asBoolean(e),this.updateNewRowTemplate())},enumerable:!0,configurable:!0}),e.prototype.updateNewRowTemplate=function(){var e=this._g,t=e.editableCollectionView,i=e.rows,o=this._nrt,n=t&&t.canAddNew&&e.allowAddNew&&!e.isReadOnly,r=i.indexOf(o),s=this._top?0:i.length-1,l=!1;if(!n&&r>-1){var a=e.selection;a.row==r&&e.select(a.row-1,a.col),i.removeAt(r)}else n&&(r<0?l=!0:r!=s&&(i.removeAt(r),l=!0),l&&(this._top?i.insert(0,o):i.push(o)),o&&(o._setFlag(RowColFlags.ParentCollapsed,!1),this._top&&e.selectionMode==SelectionMode.ListBox||o._setFlag(RowColFlags.Selected,!1)))},e.prototype._attach=function(){var e=this._g;e&&(e.beginningEdit.addHandler(this._beginningEdit,this),e.pastingCell.addHandler(this._beginningEdit,this),e.rowEditEnded.addHandler(this._rowEditEnded,this),e.loadedRows.addHandler(this.updateNewRowTemplate,this),e.hostElement.addEventListener("keydown",this._keydownBnd,!0))},e.prototype._detach=function(){var e=this._g;e&&(e.beginningEdit.removeHandler(this._beginningEdit),e.pastingCell.removeHandler(this._beginningEdit),e.rowEditEnded.removeHandler(this._rowEditEnded),e.loadedRows.removeHandler(this.updateNewRowTemplate),e.hostElement.removeEventListener("keydown",this._keydownBnd,!0))},e.prototype._keydown=function(e){e.defaultPrevented||e.keyCode!=Key.Escape||null==this._g.activeEditor&&this._top&&this._nrt.dataItem&&(this._nrt.dataItem=null,this._g.invalidate())},e.prototype._beginningEdit=function(e,t){if(!t.cancel){var i=e.rows[t.row];if(tryCast(i,_NewRowTemplate)){var o=e.editableCollectionView;if(o&&o.canAddNew)if(this._top){if(null==this._nrt.dataItem){var n=null,r=o.sourceCollection,s=o.newItemCreator;n=isFunction(s)?s():r&&r.length?new r[0].constructor:{},this._nrt.dataItem=n}}else{n=o.currentAddItem&&o.currentAddItem==i.dataItem?o.currentAddItem:o.addNew();o.moveCurrentTo(n),this.updateNewRowTemplate(),e.refresh(!0),e.onRowAdded(t),t.cancel&&o.cancelNew()}}}},e.prototype._rowEditEnded=function(e,t){var i=this,o=e.editableCollectionView,n=this._nrt.dataItem;if(o&&!this._committing)if(o.isAddingNew)o.commitNew();else if(n&&!t.cancel){this._committing=!0,this._nrt.dataItem=null;var r=o.addNew();for(var s in n)r[s]=n[s];e.onRowAdded(t),t.cancel?o.cancelNew():o.commitNew(),setTimeout(function(){e.select(0,e.columns.firstVisibleIndex),i.updateNewRowTemplate()},20),this._committing=!1}},e}();export{_AddNewHandler};var _NewRowTemplate=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(Row);export{_NewRowTemplate};export var CellType;!function(e){e[e.None=0]="None",e[e.Cell=1]="Cell",e[e.ColumnHeader=2]="ColumnHeader",e[e.RowHeader=3]="RowHeader",e[e.TopLeft=4]="TopLeft",e[e.ColumnFooter=5]="ColumnFooter",e[e.BottomLeft=6]="BottomLeft"}(CellType||(CellType={}));var GridPanel=function(){function e(e,t,i,o,n){this._offsetY=0,this._rng=new CellRange,this._g=asType(e,FlexGrid),this._ct=asInt(t),this._rows=asType(i,RowCollection),this._cols=asType(o,ColumnCollection),this._e=asType(n,HTMLElement),this._vrb=new CellRange}return Object.defineProperty(e.prototype,"grid",{get:function(){return this._g},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cellType",{get:function(){return this._ct},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewRange",{get:function(){return this._getViewRange()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return this._cols.getTotalSize()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._rows.getTotalSize()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rows",{get:function(){return this._rows},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"columns",{get:function(){return this._cols},enumerable:!0,configurable:!0}),e.prototype.getCellData=function(e,t,i){var o,n=this._g,r=this._rows[asNumber(e,!1,!0)],s=null;if(isString(t)&&(t=this._cols.indexOf(t))<0)throw"Invalid column name or binding.";o=this._cols[asNumber(t,!1,!0)];var l=n?n._getBindingColumn(this,e,o):o,a=null;if(r instanceof GroupRow&&r.dataItem instanceof CollectionViewGroup&&!n.childItemsPath&&(a=r.dataItem),l.binding&&r.dataItem&&!a?s=l._binding.getValue(r.dataItem):r._ubv&&(s=r._ubv[o._hash]),null==s)switch(this._ct){case CellType.ColumnHeader:e!=this._rows.length-1&&l==o||(s=l.header);break;case CellType.ColumnFooter:if(l.aggregate!=Aggregate.None&&r instanceof GroupRow){var h=this._g.collectionView;if(h){var c=tryCast(h,CollectionView);s=c?c.getAggregate(l.aggregate,l.binding):getAggregate(l.aggregate,h.items,l.binding)}}break;case CellType.Cell:l.aggregate!=Aggregate.None&&r instanceof GroupRow&&a&&(s=a.getAggregate(l.aggregate,l.binding,this._g.collectionView))}return i&&(this.cellType==CellType.Cell&&l.dataMap&&(s=l.dataMap.getDisplayValue(s)),s=null!=s?Globalize.format(s,l.format||r.format):""),s},e.prototype.setCellData=function(e,t,i,o,n){void 0===o&&(o=!0),void 0===n&&(n=!0);var r,s=this._rows[asNumber(e,!1,!0)];if(isString(t)&&(t=this._cols.indexOf(t))<0)throw"Invalid column name or binding.";r=this._cols[asNumber(t,!1,!0)];var l=this._g?this._g._getBindingColumn(this,e,r):r;if(this._ct==CellType.Cell){if(l.dataMap&&null!=i&&(l.isRequired||""!=i)){var a=l.dataMap,h=a.getKeyValue(i);if(null==h&&null==a.getDisplayValue(null)){if(a.getDisplayValue(i)!=i);else if(!a.isEditable||a.displayMemberPath!=a.selectedValuePath)return!1}else i=h}var c=DataType.Object,u=l.dataType||s.dataType;if(u)c=u;else{var d=this.getCellData(e,t,!1);c=getType(d)}var g=l.getIsRequired(s),p=""===i||null==i;if(!g&&p)c!=DataType.String&&(i=null),o=!1;else if(g&&p&&o)return!1;if(o&&(i=changeType(i,c,l.format||s.format),c!=DataType.Object&&getType(i)!=c))return!1}if(s.dataItem&&l.binding){var f=l._binding,_=s.dataItem,w=f.getValue(_);if(i!==w&&!DateTime.equals(i,w)){f.setValue(_,i);var m=this._g.collectionView;if(m instanceof CollectionView&&_!=m.currentEditItem){var C=new NotifyCollectionChangedEventArgs(NotifyCollectionChangedAction.Change,_,m.items.indexOf(_));m.onCollectionChanged(C)}}}else s._ubv||(s._ubv={}),s._ubv[r._hash]=i;return n&&this._g&&this._g.invalidate(),!0},e.prototype.getCellBoundingRect=function(e,t,i){var o=this._g,n=this.rows[e],r=this.columns[t],s=new Rect(r.pos,n.pos,r.renderSize,n.renderSize);if(o.rightToLeft&&(s.left=this.hostElement.clientWidth-s.right,isIE()||isFirefox()||(s.left-=o._root.offsetWidth-o._root.clientWidth)),!i){var l=this.hostElement.getBoundingClientRect();s.left+=l.left,s.top+=l.top-this._offsetY}return e<this.rows.frozen&&(s.top-=o.scrollPosition.y),t<this.columns.frozen&&(s.left-=o.scrollPosition.x*(o.rightToLeft?-1:1)),s},e.prototype.getCellElement=function(t,i){for(var o=this.hostElement.children,n=Math.min(t+2,o.length),r=0;r<n;r++)for(var s=o[r].children,l=Math.min(i+2,s.length),a=0;a<l;a++){var h=s[a],c=h[e._INDEX_KEY];if(c&&(c.row==t&&c.col==i||c.rng&&c.rng.contains(t,i)))return h}return null},e.prototype.getSelectedState=function(e,t,i){var o=this._g,n=o.selectionMode,r=o._selHdl.selection,s=SelectionMode,l=SelectedState;if(n==s.None)return l.None;switch(this._ct){case CellType.Cell:if(i||(i=o.getMergedRange(this,e,t)),i){if(i.contains(r.row,r.col))return o.showMarquee?l.Active:l.Cursor;if(i.intersects(r))return l.Selected}if(r.row==e&&r.col==t)return o.showMarquee?l.Active:l.Cursor;if(o.rows[e].isSelected||o.columns[t].isSelected)return l.Selected;if(i)switch(n){case s.Row:case s.RowRange:case s.ListBox:if(i.containsRow(r.row))return l.Selected}return n==SelectionMode.ListBox?l.None:(r=this._getAdjustedSelection(r)).containsRow(e)&&r.containsColumn(t)?l.Selected:l.None;case CellType.ColumnHeader:if(o.showSelectedHeaders&HeadersVisibility.Column&&(o.columns[t].isSelected||r.containsColumn(t)||r.intersectsColumn(i))&&(i&&(e=i.bottomRow),e==this.rows.length-1))return l.Selected;break;case CellType.RowHeader:if(o.showSelectedHeaders&HeadersVisibility.Row&&(o.rows[e].isSelected||r.containsRow(e)||r.intersectsRow(i))&&(i&&(t=i.rightCol),t==this.columns.length-1))return l.Selected}return l.None},Object.defineProperty(e.prototype,"hostElement",{get:function(){return this._e},enumerable:!0,configurable:!0}),e.prototype._getAdjustedSelection=function(e){var t=this._g,i=this._rng,o=SelectionMode;switch(t.selectionMode){case o.Cell:i.setRange(e.row,e.col,e.row,e.col);break;case o.Row:i.setRange(e.row,0,e.row,t.columns.length-1);break;case o.RowRange:case o.ListBox:i.setRange(e.row,0,e.row2,t.columns.length-1);break;default:i.copy(e)}return i},e.prototype._getOffsetY=function(){return this._offsetY},e.prototype._updateContent=function(e,t,i){var o=this._g,n=this._e,r=this._rows,s=this._cols,l=this._ct;if(l==CellType.ColumnHeader||l==CellType.ColumnFooter||l==CellType.RowHeader){var a=o._ptScrl,h=n.style;l==CellType.RowHeader?h.top=a.y+"px":o.rightToLeft?h.right=a.x+"px":h.left=a.x+"px"}this._offsetY!=i&&(e=!1,this._offsetY=i);var c=this._getViewRange(),u=c;if(u.isValid){var d=r.length<=o._vtRows?r.length:0,g=s.length<=o._vtCols?s.length:0;u=new CellRange(Math.max(c.row-d,r.frozen),Math.max(c.col-g,s.frozen),Math.min(c.row2+d,r.length-1),Math.min(c.col2+g,s.length-1))}if(e&&!t&&this._vrb.contains(c)&&!r.frozen&&!s.frozen)return this._activeCell;e&&u.equals(this._vrb)||(t=!1),e&&!t&&this._ct!=CellType.TopLeft&&this._reorderCells(u,this._vrb),this._activeCell=null,this._vru=c,this._vrb=u,this._cf=o.cellFactory,this._recycle=e;var p=0;this._ct==CellType.Cell&&(p=this._renderColHdrRow(u,t));for(var f=0;f<r.frozen&&f<r.length;f++)p=this._renderRow(f,u,t,p);for(f=u.topRow;f<=u.bottomRow&&f>-1;f++)p=this._renderRow(f,u,t,p);for(;n.childElementCount>p;){var _=n.lastElementChild;n.removeChild(_),this._removeExtraCells(_,0)}return this._activeCell},e.prototype._clearCells=function(){for(var e=this.hostElement,t=e.childElementCount-1;t>=0;t--){var i=e.children[t];e.removeChild(i);for(var o=i.childElementCount-1;o>=0;o--)this._cf.disposeCell(i.children[o])}},e.prototype._reorderCells=function(e,t){if(this._g._reorderCells&&t.isValid&&e.isValid&&e.intersects(t)){if(e.row!=t.row){var i=this._e,o=e.row-t.row,n=Math.max(1,e.rowSpan-1);if(0!=o&&Math.abs(o)<n){var r=this._ct==CellType.Cell?1:0,s=i.childElementCount;if(r+=this.rows.frozen,o>0){var l=r,a=Math.min(r+o,s-1);(d=this._createRange(i,l,a))&&a<s-1&&i.appendChild(d.extractContents())}if(o<0){a=s,l=Math.max(r,a+o);if((d=this._createRange(i,l,a))&&l>r){var h=i.children[r];i.insertBefore(d.extractContents(),h)}}}}if(e.col!=t.col){i=this._e,o=e.col-t.col,n=Math.max(1,e.columnSpan-1);if(0!=o&&Math.abs(o)<n){r=this._ct==CellType.Cell&&this._g.rowHeaderPath?1:0;r+=this.columns.frozen;for(var c=0;c<i.children.length;c++){var u=i.children[c];s=u.children.length;if(hasClass(u,"wj-row")){if(o>0){l=r,a=Math.min(r+o,s-1);(d=this._createRange(u,l,a))&&a<s-1&&u.appendChild(d.extractContents())}if(o<0){var d;a=s,l=Math.max(r,a+o);if((d=this._createRange(u,l,a))&&l>r){h=u.children[r];u.insertBefore(d.extractContents(),h)}}}}}}}},e.prototype._createRange=function(e,t,i){if(i>t&&i<=e.children.length&&t>-1){this._docRange||(this._docRange=document.createRange());var o=this._docRange;return o.setStart(e,t),o.setEnd(e,i),o}return null},e.prototype._renderColHdrRow=function(e,t){if(t)return 1;var i=this._e.children[0];i||(i=createElement('<div class="wj-row" role="row"></div>',this._e));var o=this._g,n=o?o.columnHeaders.rows.ariaLabel:null;setAttribute(i,"aria-label",n),setAttribute(i,"aria-selected",null);var r=0,s=this._g._getRowHeaderPath();s&&(r=this._renderRowHdrCell(i,-1,s.path));for(var l=0;l<this.columns.frozen&&l<this.columns.length;l++)r=this._renderColHdrCell(i,l,e,t,r);for(l=e.leftCol;l<=e.rightCol&&l>-1;l++)r=this._renderColHdrCell(i,l,e,t,r);return this._removeExtraCells(i,r),1},e.prototype._renderColHdrCell=function(t,i,o,n,r){var s=this.grid,l=this.columns[i];if(l.renderSize<=0)return r;if(n)return r+1;var a=t.children[r];if(a||(a=createElement('<div class="wj-cell" tabindex="-1"></div>',t)),setAttribute(a,"role","columnheader"),a&&this._recycle&&s._lazyRender){var h=a[e._INDEX_KEY];if(h&&-1==h.row&&h.col==i&&i>=this.columns.frozen)return r+1}if(a.textContent=this.columns[i].header,setCss(a,{position:"fixed",left:l.pos,top:-32e3,width:l.renderSize,height:.1,overflow:"hidden",opacity:"0",pointerEvents:"none"}),l.describedById||this.columns.describedById){var c=[l.describedById,this.columns.describedById].join(" ").trim();setAttribute(a,"aria-describedby",c||null)}if(s.allowSorting){var u="none";switch(s._getBindingColumn(this,0,l).currentSort){case"+":u="ascending";break;case"-":u="descending"}setAttribute(a,"aria-sort",u)}return s.isReadOnly||(setAttribute(a,"aria-readonly",l.isReadOnly),setAttribute(a,"aria-required",l.getIsRequired())),a[e._INDEX_KEY]={row:-1,col:i,panel:this},r+1},e.prototype._renderRowHdrCell=function(t,i,o){var n=t.children[0];return n||(n=createElement('<div class="wj-cell" tabindex="-1"></div>',t)),n.setAttribute("role",i<0?"columnheader":"rowheader"),n.textContent=o?o.toString():"",setCss(n,{position:"fixed",left:-32e3,top:-32e3,width:.1,height:.1,overflow:"hidden",opacity:"0"}),n[e._INDEX_KEY]={row:i,col:-1,panel:this},1},e.prototype._renderRow=function(e,t,i,o){var n=this._g,r=this.rows[e];if(r.renderSize<=0)return o;var s=this._e.children[o];if(s||(s=createElement('<div class="wj-row"></div>',this._e)),this._ct==CellType.Cell){s.setAttribute("role","row");var l=SelectionMode;switch(n.selectionMode){case l.Row:case l.RowRange:case l.ListBox:var a=r.isSelected||this._g._selHdl.selection.containsRow(e);setAttribute(s,"aria-selected",!!a)}setAttribute(s,"aria-level",r instanceof GroupRow?r.level+1:null),setAttribute(s,"aria-expanded",r instanceof GroupRow?!r.isCollapsed:null),this.rows.ariaLabel&&setAttribute(s,"aria-label",this.rows.ariaLabel)}var h=0;if(this._ct==CellType.Cell){var c=this._g._getRowHeaderPath();c&&(h=this._renderRowHdrCell(s,e,c.getValue(r.dataItem)))}for(var u=0;u<this.columns.frozen&&u<this.columns.length;u++)h=this._renderCell(s,e,u,t,i,h);for(u=t.leftCol;u<=t.rightCol&&u>-1;u++)h=this._renderCell(s,e,u,t,i,h);return this._removeExtraCells(s,h),o+1},e.prototype._renderCell=function(t,i,o,n,r,s){var l=this._g,a=l.getMergedRange(this,i,o);if(a){for(var h=Math.max(n.row,a.row);h<i;h++)if(this.rows[h].isVisible)return s;for(h=Math.max(n.col,a.col);h<o;h++)if(this.columns[h].isVisible)return s}var c=this.columns[o];if(c.renderSize<=0&&(!a||a.getRenderSize(this).width<=0))return s;var u=t.children[s];if(u&&!r&&this._recycle&&l._lazyRender&&!l.activeEditor){var d=u[e._INDEX_KEY];d&&d.row==i&&d.col==o&&d.rng==a&&i>=this.rows.frozen&&o>=this.columns.frozen&&(r=!0)}var g=SelectedState,p=this.getSelectedState(i,o,a),f=p==g.Cursor||p==g.Active;return u&&r?(toggleClass(u,"wj-state-active",f),toggleClass(u,"wj-state-selected",p==g.Cursor),toggleClass(u,"wj-state-multi-selected",p==g.Selected),setAttribute(u,"aria-selected",f||p!=g.None),f&&(this._activeCell=u),s+1):(u||((u=document.createElement("div")).tabIndex=-1,t.appendChild(u)),f&&(this._activeCell=u),this._ct==CellType.Cell&&(setAttribute(u,"role","gridcell"),setAttribute(u,"aria-selected",p!=g.None||f),setAttribute(u,"aria-readonly",!l.canEditCell(i,o)||null),setAttribute(u,"aria-required",c.getIsRequired())),l.cellFactory.updateCell(this,i,o,u,a),u[e._INDEX_KEY]={row:i,col:o,rng:a,panel:this},s+1)},e.prototype._removeExtraCells=function(e,t){for(;e.childElementCount>t;){var i=e.lastElementChild;e.removeChild(i),this._cf.disposeCell(i)}},e.prototype._getViewRange=function(){var e=this._g,t=e._ptScrl,i=this._rows,o=this._cols,n=new CellRange(0,0,i.length-1,o.length-1);if(this._ct==CellType.Cell||this._ct==CellType.RowHeader){var r=-t.y+this._offsetY,s=e._szClient.height;if((a=Math.min(i.frozen,i.length-1))>0)r+=h=i[a-1].pos,s-=h;if(n.row=Math.min(i.length-1,Math.max(i.frozen,i.getItemAt(r+1))),n.row2=i.getItemAt(r+s),e._clipToScreen){var l=e.hostElement.getBoundingClientRect();l.top<0&&(n.row=Math.max(n.row,i.getItemAt(-l.top-e._ptScrl.y)-1)),l.bottom>innerHeight&&(n.row2=Math.min(n.row2,i.getItemAt(-l.top-e._ptScrl.y+innerHeight)+1))}}if(this._ct==CellType.Cell||this._ct==CellType.ColumnHeader){var a,h,c=-t.x,u=e._szClient.width;if((a=Math.min(o.frozen,o.length-1))>0)c+=h=o[a-1].pos,u-=h;n.col=Math.min(o.length-1,Math.max(o.frozen,o.getItemAt(c+1))),n.col2=o.getItemAt(c+u)}return i.length<=i.frozen&&(n.row=n.row2=-1),o.length<=o.frozen&&(n.col=n.col2=-1),n},e.prototype._getFrozenPos=function(){var e=this._rows.frozen,t=this._cols.frozen,i=e>0?this._rows[e-1]:null,o=t>0?this._cols[t-1]:null,n=i?i.pos+i.renderSize:0,r=o?o.pos+o.renderSize:0;return new Point(r,n)},e._INDEX_KEY="wj-cell-index",e}();export{GridPanel};export var AllowMerging;!function(e){e[e.None=0]="None",e[e.Cells=1]="Cells",e[e.ColumnHeaders=2]="ColumnHeaders",e[e.RowHeaders=4]="RowHeaders",e[e.AllHeaders=6]="AllHeaders",e[e.All=7]="All"}(AllowMerging||(AllowMerging={}));var MergeManager=function(){function e(e){this._g=e}return e.prototype.getMergedRange=function(e,t,i,o){void 0===o&&(o=!0);var n=this._g,r=e.cellType,s=e.columns,l=e.rows,a=l[t],h=s[i];if(a instanceof _NewRowTemplate)return null;if(n.showGroups&&!n.childItemsPath&&a instanceof GroupRow&&a.dataItem instanceof CollectionViewGroup&&r==CellType.Cell){var c=new CellRange(t,i);if(h.aggregate==Aggregate.None){for(;c.col>0&&s[c.col-1].aggregate==Aggregate.None&&c.col!=s.frozen;)c.col--;for(;c.col2<s.length-1&&s[c.col2+1].aggregate==Aggregate.None&&c.col2+1!=s.frozen;)c.col2++}for(;c.col<i&&!s[c.col].visible;)c.col++;return c.isSingleCell?null:c}var u=!1,d=AllowMerging,g=CellType;switch(n.allowMerging){case d.None:u=!0;break;case d.Cells:u=r!=g.Cell;break;case d.ColumnHeaders:u=r!=g.ColumnHeader&&r!=g.TopLeft;break;case d.RowHeaders:u=r!=g.RowHeader&&r!=g.TopLeft;break;case d.AllHeaders:u=r==g.Cell}if(u)return null;if(s[i].allowMerging){c=new CellRange(t,i);var p=e._vrb,f=0,_=l.length-1;t>=l.frozen?!o||r!=CellType.Cell&&r!=CellType.RowHeader||n._vtRows<l.length&&p&&(f=p.topRow,_=p.bottomRow):_=l.frozen-1;for(var w=t-1;w>=f&&this._mergeCell(e,w,i,t,i);w--)c.row=w;for(var m=t+1;m<=_&&this._mergeCell(e,t,i,m,i);m++)c.row2=m;for(;c.row<t&&!l[c.row].visible;)c.row++;if(!c.isSingleCell)return c}if(l[t].allowMerging){c=new CellRange(t,i),p=e._vrb;var C=0,y=s.length-1;i>=s.frozen?!o||r!=CellType.Cell&&r!=CellType.ColumnHeader||n._vtCols<s.length&&p&&(C=p.leftCol,y=p.rightCol):y=s.frozen-1;for(var v=i-1;v>=C&&this._mergeCell(e,t,v,t,i);v--)c.col=v;for(var b=i+1;b<=y&&this._mergeCell(e,t,i,t,b);b++)c.col2=b;for(;c.col<i&&!s[c.col].visible;)c.col++;if(!c.isSingleCell)return c}return null},e.prototype._mergeCell=function(e,t,i,o,n){var r=e.rows[t],s=e.rows[o];if(r instanceof GroupRow||r instanceof _NewRowTemplate||s instanceof GroupRow||s instanceof _NewRowTemplate)return!1;if(t!=o&&e.rows.isFrozen(t)!=e.rows.isFrozen(o))return!1;if(i!=n&&e.columns.isFrozen(i)!=e.columns.isFrozen(n))return!1;if(t!=o){if(i>0&&(r.allowMerging&&this._mergeCell(e,t,i-1,t,i)||s.allowMerging&&this._mergeCell(e,o,i-1,o,i)))return!1;if(n<e.columns.length-1&&(r.allowMerging&&this._mergeCell(e,t,n,t,n+1)||s.allowMerging&&this._mergeCell(e,o,n,o,n+1)))return!1}return e.getCellData(t,i,!0)==e.getCellData(o,n,!0)},e}();export{MergeManager};var HitTestInfo=function(){function e(t,i){var o;if(this._row=-1,this._col=-1,this._edge=0,i instanceof Element){if(closest(i,".wj-flexgrid")!=t.hostElement)return;t=i}if(!(t instanceof Element)||t instanceof FlexGrid){if(t instanceof FlexGrid)o=this._g=t;else{if(!(t instanceof GridPanel))throw"First parameter should be a FlexGrid or GridPanel.";this._p=t,o=this._g=this._p.grid}i instanceof MouseEvent&&"mousedown"==i.type&&(o._rcBounds=null),i=mouseToPage(i),this._pt=i.clone();var n=o.controlRect,r=o._szClient,s=o.topLeftCells,l=o._eTL,a=o.headersVisibility,h=HeadersVisibility,c=a&h.Row?s.columns.getTotalSize():0,u=a&h.Column?s.rows.getTotalSize():0,d=a&h.Column?u+l.offsetTop:0,g=o._eBL,p=g.offsetHeight;if(i.x-=n.left,i.y-=n.top,this._g.rightToLeft&&(i.x=n.width-i.x),!this._p&&i.x>=0&&i.y>=l.offsetTop&&r&&i.x<=r.width+c&&i.y<=r.height+d&&(i.y<d?this._p=i.x<c?o.topLeftCells:o.columnHeaders:i.y<g.offsetTop?this._p=i.x<c?o.rowHeaders:o.cells:this._p=i.x<c?o.bottomLeftCells:o.columnFooters),null!=this._p){var f=this._p.rows,_=this._p.columns,w=this._p.cellType,m=CellType,C=this._p._getFrozenPos(),y=w==m.TopLeft||w==m.ColumnHeader?u:w==m.BottomLeft||w==m.ColumnFooter?p:f.getTotalSize(),v=w==m.TopLeft||w==m.BottomLeft||w==m.RowHeader?c:_.getTotalSize();w==m.RowHeader||w==m.Cell?(i.y-=u,(i.y>C.y||C.y<=0)&&(i.y-=o._ptScrl.y,i.y+=this._p._getOffsetY())):w!=m.BottomLeft&&w!=m.ColumnFooter||(i.y-=g.offsetTop),w!=m.ColumnHeader&&w!=m.Cell&&w!=m.ColumnFooter||(i.x-=c,(i.x>C.x||C.x<=0)&&(i.x-=o._ptScrl.x)),w!=m.ColumnHeader&&w!=m.TopLeft||(i.y-=d-u),this._edge=0;var b=e._SZEDGE[this._g.isTouching?1:0];if(this._g.isTouching&&(b=e._SZEDGE[1],i.x-=b/2),this._row=i.y>y?-1:f.getItemAt(i.y),this._col=i.x>v?-1:_.getItemAt(i.x),this._row<0||this._col<0)return void(this._p=null);if(this._col>-1){var R=_[this._col];i.x-R.pos<=b&&(this._edge|=1),R.pos+R.renderSize-i.x<=b&&(this._edge|=4)}if(this._row>-1){var S=f[this._row];i.y-S.pos<=b&&(this._edge|=2),S.pos+S.renderSize-i.y<=b&&(this._edge|=8)}}}else{var E=closest(t,".wj-cell"),x=E?E[GridPanel._INDEX_KEY]:null;x&&(this._row=x.row,this._col=x.col,this._rng=x.rng,this._p=x.panel,this._g=x.panel.grid)}}return Object.defineProperty(e.prototype,"point",{get:function(){return this._pt},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cellType",{get:function(){return this._p?this._p.cellType:CellType.None},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"panel",{get:function(){return this._p},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"grid",{get:function(){return this._p?this._p.grid:null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"row",{get:function(){return this._row},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"col",{get:function(){return this._col},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"range",{get:function(){return this._rng||(this._rng=new CellRange(this._row,this._col)),this._rng},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"edgeLeft",{get:function(){return 0!=(1&this._edge)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"edgeTop",{get:function(){return 0!=(2&this._edge)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"edgeRight",{get:function(){return 0!=(4&this._edge)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"edgeBottom",{get:function(){return 0!=(8&this._edge)},enumerable:!0,configurable:!0}),e._SZEDGE=[5,30],e}();export{HitTestInfo};export function softInput(){return _getModule("wijmo.input")};var CellFactory=function(){function e(){}return e.prototype.updateCell=function(t,i,o,n,r,s){var l=t.grid,a=l.rightToLeft,h=CellType,c=t.rows,u=t.columns,d=c[i],g=u[o],p=i,f=o,_=d instanceof GroupRow?d:null,w=d instanceof _NewRowTemplate?d:null,m=g.renderWidth,C=d.renderHeight,y=t.cellType,v="wj-cell",b="",R={display:""};if(0!=s&&n.firstElementChild&&(1==n.childNodes.length&&"checkbox"==n.firstElementChild.type||(n.textContent="")),r&&!r.isSingleCell){i=r.row,o=r.col,p=r.row2,f=r.col2,d=c[i],g=u[o],_=d instanceof GroupRow?d:null;var S=r.getRenderSize(t);C=S.height,m=S.width}var E=l._getBindingColumn(t,i,g),x=E.dataType||d.dataType,z=E.dataMap&&0!=E.showDropDown||d.dataMap&&0!=d.showDropDown,T=x==DataType.Boolean&&!z,H=g.pos,M=d.pos;l._useFrozenDiv()&&y==h.Cell&&!l.editRange?(i<c.frozen&&o>=u.frozen&&(H+=l._ptScrl.x),o<u.frozen&&i>=c.frozen&&(M+=l._ptScrl.y)):(i<c.frozen&&(M-=l._ptScrl.y),o<u.frozen&&(H-=l._ptScrl.x)),a?R.right=H+"px":R.left=H+"px",R.top=M-t._getOffsetY()+"px",R.width=m+"px",R.height=C+"px",R.zIndex="",(i<c.frozen||o<u.frozen)&&(R.zIndex=i<c.frozen&&o<u.frozen?2:1);var P=!1,A=l.alternatingRowStep;A&&(r&&r.row!=r.row2||(P=d.visibleIndex%(A+1)==0,1==A&&(P=!P))),y==h.Cell?(_&&(v+=" wj-group"),P&&(v+=" wj-alt"),(i<c.frozen||o<u.frozen)&&(v+=" wj-frozen"),w&&(v+=" wj-new"),d.cssClass&&(v+=" "+d.cssClass),E.cssClass&&(v+=" "+E.cssClass)):(v+=" wj-header",P&&(v+=" wj-header-alt")),d.cssClassAll&&(v+=" "+d.cssClassAll),E.cssClassAll&&(v+=" "+E.cssClassAll);var L=SelectedState,I=t.getSelectedState(i,o,r);switch(I!=L.None&&y==h.Cell&&!T&&l.editRange&&l.editRange.contains(i,o)&&(I=L.None),I){case L.Active:v+=" wj-state-active";break;case L.Cursor:v+=" wj-state-selected wj-state-active";break;case L.Selected:v+=" wj-state-multi-selected"}p==c._lastFrozen&&(v+=" wj-frozen-row"),f==u._lastFrozen&&(v+=" wj-frozen-col"),(E.wordWrap||d.wordWrap)&&(v+=" wj-wrap"),(E.multiLine||d.multiLine)&&(v+=" wj-multiline");var D=E.getAlignment(d);if(D&&(b=" wj-align-"+D),R.paddingLeft=R.paddingRight=R.paddingTop=R.paddingBottom="",y==h.Cell&&l.rows.maxGroupLevel>-1&&o==l.columns.firstVisibleIndex&&l.treeIndent){var j=_?Math.max(0,_.level):l.rows.maxGroupLevel+1,O=l.treeIndent*j+l._cellPadLeft;a?R.paddingRight=O+"px":R.paddingLeft=O+"px"}if(0!=s){var N=t.getCellData(i,o,!1),B=t.getCellData(i,o,!0);if(y==h.Cell&&o==l.columns.firstVisibleIndex&&_&&_.hasChildren&&!this._isEditingCell(l,i,o)){var F=this._getTreeBtn(_);B=escapeHtml(B)||_.getGroupHeader(),n.innerHTML=F.outerHTML+" "+B,b=""}else if(y==h.ColumnHeader&&E.currentSort&&l.showSort&&(p==l._getSortRowIndex()||E!=g))v+=" wj-sort-"+("+"==E.currentSort?"asc":"desc"),n.innerHTML=escapeHtml(B)+"&nbsp;"+this._getSortIcon(E);else if(y!=h.RowHeader||o!=l._getEditColumnIndex()||B)if(y!=h.Cell||x!=DataType.Boolean||z||_&&!isBoolean(N))if(y==h.Cell&&this._isEditingCell(l,i,o)){var k=E.inputType||d.inputType;if(k||(k=x!=DataType.Number||z?"text":"tel"),!z&&!E.mask&&!d.mask){var V=t.getCellData(i,o,!1);if(isNumber(V)){var G=V.toString(),K=E.format||d.format;if(K&&V!=Math.round(V)){var W=G.match(/\.(\d+)/)[1].length;K=K.replace(/([a-z])(\d*)(.*)/gi,"$01"+W+"$3")}B=Globalize.formatNumber(V,K,!0)}}n.innerHTML=(E.multiLine||d.multiLine)&&"checkbox"!=k?'<textarea wrap="soft"></textarea>':'<input type="'+k+'"/>';var q=n.children[0];addClass(q,"wj-grid-editor wj-form-control"),disableAutoComplete(q),q.value=B,q.required=E.getIsRequired(d),setAttribute(q,"aria-required",q.required);var U=E.maxLength||d.maxLength;U&&(q.maxLength=U),q.style.textAlign=E.getAlignment(d);var Y=E.mask||d.mask;Y&&new _MaskProvider(q,Y),l._edtHdl._edt=q}else y==h.Cell&&(d.isContentHtml||E.isContentHtml)?n.innerHTML=B:n.textContent=B||"";else{var J=n.firstChild;J instanceof HTMLInputElement&&"checkbox"==J.type||(n.innerHTML='<input type="checkbox" class="wj-cell-check" tabindex="-1"/>',J=n.firstChild),J.checked=1==N,J.indeterminate=null==N,J.disabled=!l.canEditCell(i,o),J.disabled&&(J.style.cursor="default"),l.editRange&&l.editRange.contains(i,o)&&(l._edtHdl._edt=J)}else{var X=l.editableCollectionView,Z=X?X.currentEditItem:null;Z&&d.dataItem==Z?n.innerHTML='<span class="wj-glyph-pencil"></span>':d instanceof _NewRowTemplate&&(n.innerHTML='<span class="wj-glyph-asterisk"></span>')}if(y==h.Cell&&z&&softInput()&&l.showDropDown&&l.canEditCell(i,o)){if(!e._ddBtn){var Q=e._WJC_DROPDOWN;F=createElement('<button class="wj-btn wj-btn-glyph wj-right '+Q+'" type="button" tabindex="-1"><span class="wj-glyph-down"></span></button>');setAriaLabel(F,culture.FlexGrid.ariaLabels.toggleDropDown),setAttribute(F,"aria-expanded",!1),e._ddBtn=F}var $=e._ddBtn.cloneNode(!0);n.appendChild($)}}if(y==h.RowHeader||y==h.ColumnHeader){var ee=y==h.RowHeader?!_&&!w&&d.allowDragging&&0!=(l.allowDragging&AllowDragging.Rows):g.allowDragging&&0!=(l.allowDragging&AllowDragging.Columns);setAttribute(n,"draggable",ee?"true":null)}v+=b,n.className!=v&&(n.className=v);var te=n.style;for(var ie in R)te[ie]!==R[ie]&&(te[ie]=R[ie]);if(l._edtHdl._edt&&l._edtHdl._edt.parentElement==n){var oe=l._root,ne=oe.getBoundingClientRect(),re=n.getBoundingClientRect(),se=ne.top+oe.clientHeight-re.top,le=ne.left+oe.clientWidth-re.left;re.height>se&&(n.style.height=se+"px"),re.width>le&&(n.style.width=le+"px")}if((y==h.Cell||y==h.RowHeader)&&l._getShowErrors()){var ae=l._getError(t,i,o);l._edtHdl._setCellError(n,ae)}if(l.itemFormatter&&l.itemFormatter(t,i,o,n),l.formatItem.hasHandlers){var he=e._fmtRng;he?he.setRange(i,o,p,f):he=e._fmtRng=new CellRange(i,o,p,f);var ce=new FormatItemEventArgs(t,he,n);l.onFormatItem(ce)}},e.prototype.disposeCell=function(e){},e.prototype.getEditorValue=function(e){var t=e._edtHdl._edt;if(t instanceof HTMLInputElement&&"checkbox"==t.type)return t.checked;if(t instanceof HTMLInputElement||t instanceof HTMLTextAreaElement){var i=t.maxLength;return isNumber(i)&&i>-1&&t.value.length>i?t.value.substr(0,i):t.value}return null},e.prototype._isEditingCell=function(e,t,i){return e.editRange&&e.editRange.contains(t,i)},e.prototype._getTreeBtn=function(t){var i=e._WJC_COLLAPSE,o=(t.isCollapsed?"":"down-")+(t.grid.rightToLeft?"left":"right"),n=createElement('<button class="wj-btn wj-btn-glyph '+i+'" type="button" tabindex="-1"><span class="wj-glyph-'+o+'"></span></button>');return setAriaLabel(n,culture.FlexGrid.ariaLabels.toggleGroup),setAttribute(n,"aria-expanded",!t.isCollapsed),n},e.prototype._getSortIcon=function(e){return'<span class="wj-glyph-'+("+"==e.currentSort?"up":"down")+'"></span>'},e._WJC_COLLAPSE="wj-elem-collapse",e._WJC_DROPDOWN="wj-elem-dropdown",e}();export{CellFactory};var _WJC_CHECKBOX="wj-cell-check",_PAGE_SIZE=4,_EditHandler=function(){function e(e){var t=this;this._fullEdit=!1,this._list=null,this._g=e,this._evtInput=document.createEvent("HTMLEvents"),this._evtInput.initEvent("input",!0,!1),this._evtChange=document.createEvent("HTMLEvents"),this._evtChange.initEvent("change",!0,!1),e.selectionChanging.addHandler(function(i,o){if(t.finishEditing()){var n=e._selHdl.selection.row;if(n!=o.row){var r=e.rows.length;(n>-1&&n<r?e.rows[n].dataItem:null)!=(o.row>-1&&o.row<r?e.rows[o.row].dataItem:null)&&t._commitRowEdits()}}else o.cancel=!0}),e.lostFocus.addHandler(function(){var e=getActiveElement();e&&"fixed"==getComputedStyle(e).position?t.finishEditing():t._commitRowEdits()});var i=e.hostElement;e.addEventListener(i,"mousedown",function(i){if(!i.defaultPrevented&&0==i.button&&!e._mouseHdl._szRowCol){e.selection;var o=e.hitTest(i);if(o.cellType!=CellType.Cell&&o.cellType!=CellType.None)t.finishEditing();else if(o.cellType!=CellType.None){var n=tryCast(i.target,HTMLInputElement);t._isNativeCheckbox(n)&&(n!=t.activeEditor&&(i.preventDefault(),t.startEditing(!1,o.row,o.col,!0,i)&&(n=t.activeEditor)),!n||"checkbox"!=n.type||n.disabled||n.readOnly||(n.checked=!n.checked,e._setFocusNoScroll(n),t.finishEditing()))}}},!0),e.addEventListener(i,"click",function(e){t._isNativeCheckbox(e.target)&&(e.preventDefault(),e.stopImmediatePropagation())},!0),e.addEventListener(i,"compositionend",this._keypress.bind(this))}return e.prototype.startEditing=function(e,t,i,o,n){void 0===e&&(e=!0);var r=this._g;if(t=asNumber(t,!0,!0),i=asNumber(i,!0,!0),null==t&&(t=r.selection.row),null==i&&(i=r.selection.col),null==o&&(o=!0),!this._allowEditing(t,i))return!1;var s=r.getMergedRange(r.cells,t,i,!1);s||(s=new CellRange(t,i));var l=r.rows[t].dataItem;if(r.scrollIntoView(s.row,s.col,!0),r.select(s,!0),!r.rows[t]||l!=r.rows[t].dataItem)return!1;if(s.equals(this._rng))return!0;if(this.activeEditor&&!this.finishEditing())return!1;var a=new CellRangeEventArgs(r.cells,s,n);if(!r.onBeginningEdit(a))return!1;var h=r.editableCollectionView,c=!1;h&&((c=(l=r.rows[t].dataItem)!=h.currentEditItem)&&r.onRowEditStarting(a),h.editItem(l),c&&(r.onRowEditStarted(a),this._edItem=l)),this._fullEdit=asBoolean(e),this._rng=s,this._list=null;var u=r.rows[t],d=r._getBindingColumn(r.cells,t,r.columns[i]),g=d.dataMap||u.dataMap;g&&(this._list=g.getDisplayValues(l)),s.isSingleCell?this._updateEditorCell(t,i,c):r.refresh(!1);var p=this._edt;if(p){if("checkbox"==p.type)this._fullEdit=!1;else if(o){var f=0,_=p.value.length,w=!1,m=culture.Globalize.numberFormat["%"]||"%",C=r.getCellData(t,i,!1);if(isNumber(C)?w=p.value.indexOf(m)>-1:null==C&&(w=/^p/i.test(d.format))&&p.value.indexOf(m)<0&&(p.value+=m),w){var y=p.value;for(f=0,_=y.length;_>0&&(y[_-1]==m||" "==y[_-1]);)_--;for(;f<_&&y[f]==m;)f++}n&&"keydown"==n.type&&n.keyCode==Key.Space&&(f=_),setSelectionRange(p,f,_),isIE()&&"right"==p.style.textAlign&&(p.style.paddingRight="1px")}r.onPrepareCellForEdit(a)}return null!=p&&!p.disabled&&!p.readOnly},e.prototype.finishEditing=function(e){var t=this._edt;if(!t)return this._removeListBox(),!0;var i=this._g,o=this._rng,n=new CellEditEndingEventArgs(i.cells,o),r=i.containsFocus(),s=i.hostElement.querySelector(".wj-control.wj-state-focused");if(s){var l=Control.getControl(s);l&&l.onLostFocus(n)}if(n.cancel=e,!e&&i.validateEdits){var a=this._getValidationError();if(a){n.cancel=!0;var h=t.parentElement;h&&(this._setCellError(h,a),n.stayInEditMode=!0)}}if(!i.onCellEditEnding(n)&&n.stayInEditMode)return r?setTimeout(function(){t.select()}):t.select(),!1;if(!n.cancel){n.data=i.cells.getCellData(o.topRow,o.leftCol,!1);for(var c=i.cellFactory.getEditorValue(i),u=o.topRow;u<=o.bottomRow&&u<i.rows.length;u++)for(var d=o.leftCol;d<=o.rightCol&&d<i.columns.length;d++)i.cells.setCellData(u,d,c,!0,!1);t.value==this._edtValue&&t.dispatchEvent(this._evtChange)}this._edt=null,this._rng=null,this._list=null,this._edtValue=null,this._removeListBox();var g=closest(t,".wj-cell");return contains(g,getActiveElement())&&g.focus(),!n.cancel&&n.refresh&&i._refreshOnEdit?i.refresh(!1):this._updateEditorCell(o.row,o.col,!1),r&&i.focus(),i.onCellEditEnded(n),!0},e.prototype._setCellError=function(e,t){""==t&&(t=null),toggleClass(e,"wj-state-invalid",null!=t);var i=this._g.errorTip;i?i.setTooltip(e,t):setAttribute(e,"title",t)},Object.defineProperty(e.prototype,"activeEditor",{get:function(){return this._edt},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"editRange",{get:function(){return this._rng},enumerable:!0,configurable:!0}),e.prototype.getClipString=function(e,t,i,o){var n=this,r=this._g,s=[],l=SelectionMode;if(!e)switch(e=r.selection,r.selectionMode){case l.Row:case l.RowRange:case l.ListBox:e.col=0,e.col2=r.columns.length-1}if(i){var a=r.columnHeaders;a.rows.forEach(function(i,r){if(i.isVisible){var l=n._getRowClipString(a,r,e.leftCol,e.rightCol,t,o);s.push(l)}})}var h=r.cells;if(r.selectionMode==l.ListBox)h.rows.forEach(function(i,r){if(i.isSelected&&i.isVisible){var l=n._getRowClipString(h,r,e.leftCol,e.rightCol,t,o);s.push(l)}});else for(var c=e.topRow;c<=e.bottomRow;c++)if(h.rows[c].isVisible){var u=this._getRowClipString(h,c,e.leftCol,e.rightCol,t,o);s.push(u)}return s.join(t?"\r\n":"\n")},e.prototype._getRowClipString=function(e,t,i,o,n,r){var s="",l=n?",":"\t",a=e.rows[t];if(a.isVisible){if(r)for(var h=e.cellType==CellType.ColumnHeader?e.grid.topLeftCells:e.grid.rowHeaders,c=0;c<h.columns.length;c++)if(h.columns[c].isVisible){var u=h.getCellData(t,c,!0);s&&(s+=l),s+=this._getCellClipString(u,n)}for(c=i;c<=o;c++){if(e.columns[c].isVisible)!(u=e.getCellData(t,c,!0))&&a instanceof GroupRow&&c==e.columns.firstVisibleIndex&&(u=toPlainText(a.getGroupHeader())),s&&(s+=l),s+=this._getCellClipString(u,n)}}return s},e.prototype._getCellClipString=function(e,t){e=e.replace(/\t/g," "),t&&(e=e.replace(/"/g,'""'));var i=e.indexOf("\n")>-1;return!i&&t&&(i=e.indexOf('"')>-1||e.indexOf(",")>-1),i&&(!t&&e.match(/^".?"$/)||(e='"'+e+'"')),e},e.prototype.setClipString=function(e,t){var i=this,o=this._g,n=null==t,r=SelectionMode;if(!t)switch(t=o.selection,o.selectionMode){case r.Row:case r.RowRange:case r.ListBox:t.col=0,t.col2=o.columns.length-1}t=asType(t,CellRange);var s=this._parseClipString(asString(e));n&&!t.isSingleCell&&s.length&&this._expandClipRows(s,t);var l=new CellRange(t.topRow,t.leftCol,t.topRow+s.length-1,t.leftCol+s[0].length-1),a=new CellRangeEventArgs(o.cells,l);if(!o.onPasting(a))return!1;l=new CellRange(t.topRow,t.leftCol);var h=o.editableCollectionView,c=!1,u=t.topRow;o.deferUpdate(function(){h&&s.length>1&&h.beginUpdate();for(var e=0;e<s.length&&u<o.rows.length;e++,u++){var n=o.rows[u];if(n.isVisible){for(var r=s[e],d=t.leftCol,g=0;g<r.length&&d<o.columns.length;g++,d++){var p=o.columns[d];if(p.isVisible){if(i._allowEditing(u,d)){var f=r[g],_=p.maxLength||n.maxLength;_&&(f=f.substr(0,_));var w=new CellRangeEventArgs(o.cells,new CellRange(u,d),f);o.onPastingCell(w)&&(h&&(h.editItem(o.rows[u].dataItem),i._edItem=h.currentEditItem),o.cells.setCellData(u,d,w.data)&&(o.onPastedCell(w),c=!0)),l.row2=Math.max(l.row2,u),l.col2=Math.max(l.col2,d)}}else g--}if(i._edItem&&h instanceof CollectionView){var m=new NotifyCollectionChangedEventArgs(NotifyCollectionChangedAction.Change,i._edItem,u);h.onCollectionChanged(m)}}else e--}if(h&&s.length>1&&h.endUpdate(),o.select(l),o.onPasted(a),c&&closest(o.hostElement,"form")){var C=createElement("<input>",o.hostElement),y=document.createEvent("HTMLEvents");y.initEvent("change",!0,!1),C.dispatchEvent(y),removeChild(C)}})},e.prototype._isNativeCheckbox=function(e){return e instanceof HTMLInputElement&&"checkbox"==e.type&&!e.disabled&&!e.readOnly&&hasClass(e,_WJC_CHECKBOX)&&closest(e,".wj-flexgrid")==this._g.hostElement},e.prototype._parseClipString=function(e){var t=[];e=(e=e.replace(/\r\n/g,"\n").replace(/\r/g,"\n")).replace(/\n$/,"");var i=0,o=0;for(i=0;i<e.length;i++){var n='"'==e[i]&&e[i+1]>=" ",r=!1,s=!1;for(o=i;o<e.length&&!s;o++){var l=e[o];switch(l){case'"':n&&(r=!r);break;case"\t":case"\n":r||(this._parseClipCell(t,e,i,o,"\n"==l),i=o,s=!0)}}if(o==e.length){this._parseClipCell(t,e,i,o,!1);break}}return 0==t.length&&t.push([""]),t},e.prototype._parseClipCell=function(e,t,i,o,n){e.length||e.push([]);var r=t.substr(i,o-i),s=r.length;s>1&&'"'==r[0]&&'"'==r[s-1]?r=(r=r.substr(1,s-2)).replace(/""/g,'"'):"\t"==r&&(r=""),e[e.length-1].push(r),n&&e.push([])},e.prototype._expandClipRows=function(e,t){for(var i=e.length,o=0,n=0;n<i;n++)o=Math.max(o,e[n].length);for(var r=this._g,s=0,l=0,a=t.topRow;a<=t.bottomRow;a++)r.rows[a].isVisible&&s++;for(var h=t.leftCol;h<=t.rightCol;h++)r.columns[h].isVisible&&l++;if((s>1||l>1)&&(1==s&&(s=i),1==l&&(l=o),l%o==0&&s%i==0)){for(h=o;h<l;h++)for(a=0;a<i;a++)e[a].push(e[a%i][h%o]);for(a=i;a<s;a++)e.push(e[a%i])}},e.prototype._updateEditorCell=function(e,t,i){var o=this._g,n=o.cells.getCellElement(e,t),r=o._useFrozenDiv()&&(e<o.frozenRows||t<o.frozenColumns);if(!n||r||o._hasPendingUpdates())o.refresh(!1);else if(this._updateCell(n),(i=i||o._getHasValidation())&&o.headersVisibility&HeadersVisibility.Row){var s=o.rowHeaders,l=o._getEditColumnIndex(),a=s.getCellElement(e,l);a&&this._updateCell(a)}},e.prototype._updateCell=function(e){var t=new HitTestInfo(e,null),i=FlexGrid._WJS_UPDATING;t.panel&&(addClass(e,i),t.grid.cellFactory.updateCell(t.panel,t.row,t.col,e,t.range),removeClass(e,i))},e.prototype._getValidationError=function(){var e=this._g;if(e._getHasValidation()){var t=this._rng.row,i=this._rng.col,o=e.cellFactory.getEditorValue(e),n=e.getCellData(t,i,!1);if(e.setCellData(t,i,o,!0,!1)){var r=e._getError(e.cells,t,i);return e.setCellData(t,i,n,!1,!1),r}}return null},e.prototype._allowEditing=function(e,t){var i=this._g;if(i.isReadOnly||i.selectionMode==SelectionMode.None)return!1;if(e<0||e>=i.rows.length||t<0||t>=i.columns.length)return!1;var o=i.rows[e];if(!o||o.isReadOnly||!o.isVisible)return!1;var n=i._getBindingColumn(i.cells,e,i.columns[t]);return!(!n||n.isReadOnly||!n.isVisible)},e.prototype._commitRowEdits=function(){var e=this._g;if(this.finishEditing()&&this._edItem){var t=e.editableCollectionView;if(t&&(t.currentEditItem||t.currentAddItem)){var i=new CellRangeEventArgs(e.cells,e.selection);e.onRowEditEnding(i),t.commitEdit(),e.onRowEditEnded(i)}this._edItem=null}},e.prototype._keydown=function(e){var t=this._edt;switch(e.keyCode){case Key.F2:return this._fullEdit=!this._fullEdit,e.preventDefault(),!0;case Key.F4:return this._toggleListBox(e),e.preventDefault(),!0;case Key.Space:return!t||"checkbox"!=t.type||t.disabled||t.readOnly||(t.checked=!t.checked,this.finishEditing(),e.preventDefault()),!0;case Key.Enter:if(e.preventDefault(),t&&e.altKey){var i=e.target;if(i instanceof HTMLTextAreaElement&&"soft"==i.wrap){var o=i.value,n=i.selectionStart,r=i.selectionEnd;i.value=o.substr(0,n)+"\n"+o.substr(r),setSelectionRange(i,n+1)}return!0}return!this.finishEditing();case Key.Tab:return e.preventDefault(),!this.finishEditing();case Key.Escape:return e.preventDefault(),this.finishEditing(!0),!0;case Key.Up:case Key.Down:case Key.Left:case Key.Right:case Key.PageUp:case Key.PageDown:case Key.Home:case Key.End:if(this._lbx)return this._keydownListBox(e);if(e.altKey)switch(e.keyCode){case Key.Up:case Key.Down:return this._toggleListBox(e),e.preventDefault(),!0}if(!this._fullEdit&&this.finishEditing())return!1}return!0},e.prototype._keydownListBox=function(e){var t=!0;if(this._lbx)switch(e.keyCode){case Key.Up:e.altKey?this._toggleListBox(e):this._lbx.selectedIndex>0&&this._lbx.selectedIndex--;break;case Key.Down:e.altKey?this._toggleListBox(e):this._lbx.selectedIndex++;break;case Key.Home:case Key.PageUp:this._lbx.selectedIndex=0;break;case Key.End:case Key.PageDown:this._lbx.selectedIndex=this._lbx.collectionView.items.length-1;break;default:t=!1}return!!t&&(e.preventDefault(),!0)},e.prototype._keypress=function(e){var t=this._edt,i=e.charCode||32;if(t&&"checkbox"!=t.type&&getActiveElement()==t&&this._list&&this._list.length>0&&i>=32){var o=t.selectionStart,n=t.value.substr(0,o);e.target==t&&e.charCode&&(n+=String.fromCharCode(e.charCode),o++);var r=this._findString(this._list,n,!0);r<0&&(r=this._findString(this._list,n,!1)),r>-1&&(t.value=this._list[r],setSelectionRange(t,o,t.value.length),t.dispatchEvent(this._evtInput),e.preventDefault&&e.preventDefault())}},e.prototype._findString=function(e,t,i){i||(t=t.toLowerCase());for(var o=0;o<e.length;o++){var n=e[o];if(i||(n=n.toLowerCase()),0==n.indexOf(t))return o}return-1},e.prototype._toggleListBox=function(e,t){var i=this._g,o=i._selHdl.selection,n=i.isTouching;if(t||(t=o),this._lbx&&(this._removeListBox(),o.contains(t)))return i.activeEditor?i.activeEditor.focus():i.containsFocus()||i.focus(),!0;var r=i.rows[t.row],s=i._getBindingColumn(i.cells,t.row,i.columns[t.col]),l=s.dataMap&&0!=s.showDropDown||r.dataMap&&0!=r.showDropDown;return!(!softInput()||!l)&&(!(!softInput()||!this.startEditing(!0,t.row,t.col,!n,e))&&(this._lbx=this._createListBox(),this._lbx.showSelection(),n&&this._lbx.focus(),!0))},e.prototype._createListBox=function(){var e=this,t=this._g,i=t.activeEditor,o=this._rng,n=t.rows[o.row],r=t._getBindingColumn(t.cells,o.row,t.columns[o.col]),s=r.dataMap||n.dataMap,l=r.dropDownCssClass||n.dropDownCssClass,a=document.createElement("div");this._removeListBox(),addClass(a,"wj-dropdown-panel wj-grid-listbox"),addClass(a,l);var h=new mInput.ListBox(a,{maxHeight:4*n.renderHeight,isContentHtml:r.isContentHtml,itemsSource:s.getDisplayValues(n.dataItem),selectedValue:i?i.value:t.getCellData(o.row,o.col,!0)});h.addEventListener(h.hostElement,"click",function(){e._removeListBox(),t.focus(),e.finishEditing()}),h.lostFocus.addHandler(function(){e._removeListBox()}),h.selectedIndexChanged.addHandler(function(){var i=t.activeEditor;i&&(i.value=h.selectedValue,i.dispatchEvent(e._evtInput),setSelectionRange(i,0,i.value.length))});var c=t.cells.getCellElement(o.row,o.col);if(c){showPopup(a,c,!1,!1,!1);var u=c.querySelector("."+CellFactory._WJC_DROPDOWN);setAttribute(u,"aria-expanded",!0)}else showPopup(a,t.getCellBoundingRect(o.row,o.col)),a[Control._OWNR_KEY]=t.hostElement;return h},e.prototype._removeListBox=function(){var e=this._lbx;e&&(this._lbx=null,hidePopup(e.hostElement,function(){e.dispose()}))},e}();export{_EditHandler};var _AR_ALLCELLS=4,_WJC_DRAGSRC="wj-state-dragsrc";export var AllowResizing;!function(e){e[e.None=0]="None",e[e.Columns=1]="Columns",e[e.Rows=2]="Rows",e[e.Both=3]="Both",e[e.ColumnsAllCells=e.Columns|_AR_ALLCELLS]="ColumnsAllCells",e[e.RowsAllCells=e.Rows|_AR_ALLCELLS]="RowsAllCells",e[e.BothAllCells=e.Both|_AR_ALLCELLS]="BothAllCells"}(AllowResizing||(AllowResizing={}));export var AutoSizeMode;!function(e){e[e.None=0]="None",e[e.Headers=1]="Headers",e[e.Cells=2]="Cells",e[e.Both=3]="Both"}(AutoSizeMode||(AutoSizeMode={}));export var AllowDragging;!function(e){e[e.None=0]="None",e[e.Columns=1]="Columns",e[e.Rows=2]="Rows",e[e.Both=3]="Both"}(AllowDragging||(AllowDragging={}));var _MouseHandler=function(){function e(e){var t=this;this._tsLast=0;var i=e.hostElement,o=e.addEventListener.bind(e),n=e.removeEventListener.bind(e);this._g=e,this._dvMarker=createElement('<div class="wj-marker">&nbsp;</div>'),o(i,"mousedown",function(i){if(e._rcBounds=null,!i.defaultPrevented&&0==i.button){var l=i.target;if(!e.containsFocus()){var a=l instanceof HTMLElement&&l.tabIndex>-1?l:e._eFocus;e._setFocusNoScroll(a)}setTimeout(function(){i.defaultPrevented||e.focus()});var h=closest(l,".wj-flexgrid");if(h&&h!=e.hostElement||!e.activeEditor&&e._isInputElement(l)){var c=e.hitTest(i),u=CellType;switch(c.cellType){case u.Cell:e.select(c.range,!1),l instanceof HTMLElement&&"root"!=l.getAttribute("wj-part")&&l.focus();break;case u.ColumnHeader:case u.ColumnFooter:e.scrollIntoView(-1,c.col);break;case u.RowHeader:e.scrollIntoView(c.row,-1)}return}var d=document;n(d,"mousemove"),n(d,"mouseup"),o(d,"mousemove",r),o(d,"mouseup",s),t._isDown=!0,t._mousedown(i)}});var r=function(e){t._mousemove(e)},s=function(e){t._isDown=!1,n(document,"mousemove"),n(document,"mouseup"),t._mouseup(e)};o(i,"mouseup",function(e){t._tsLast=Date.now()}),o(i,"mouseenter",function(t){e._rcBounds=null}),o(i,"mousemove",this._hover.bind(this)),o(i,"dblclick",this._dblclick.bind(this)),o(i,"click",this._click.bind(this)),o(i,"selectstart",function(t){e._isInputElement(t.target)||t.preventDefault()}),o(i,"wheel",function(t){if(!t.defaultPrevented&&t.deltaY&&!t.ctrlKey&&!t.metaKey){var i=e._root,o=t.deltaY,n=0;if(i.scrollHeight>i.offsetHeight&&closest(t.target,".wj-flexgrid")==e.hostElement){switch(t.deltaMode){case 1:n=e.rows.defaultSize*(o<0?-1:1);break;case 2:n=i.clientHeight*(o<0?-1:1);break;case 0:default:isSafari()&&(o=clamp(o,-150,150)),n=o}e.hostElement.focus(),i.scrollTop+=n,t.preventDefault()}}}),o(i,"dragstart",this._dragstart.bind(this)),o(i,"dragover",this._dragover.bind(this)),o(i,"dragleave",this._dragover.bind(this)),o(i,"drop",this._drop.bind(this)),o(i,"dragend",this._dragend.bind(this)),this._enableTouchResizing()}return e.prototype.resetMouseState=function(){this._updating&&(this._updating=!1,this._g.endUpdate()),this._dragSrc&&removeClass(this._dragSrc,_WJC_DRAGSRC),this._showDragMarker(null);var e=this._g.hostElement;e&&(e.style.cursor="");var t=this._g;t.removeEventListener(document,"mousemove"),t.removeEventListener(document,"mouseup"),this._tsLast=Date.now(),this._eMouse=null,this._isDown=null,this._htDown=null,this._lbSelRows=null,this._szRowCol=null,this._szArgs=null,t._rcBounds=null},e.prototype._enableTouchResizing=function(){var e=this,t=this._g,i=t.hostElement,o="ontouchstart"in window?["touchstart","touchmove","touchend"]:"onpointerdown"in window?["pointerdown","pointermove","pointerup"]:null;o&&(t.addEventListener(i,o[0],function(o){if((null==o.pointerType||"touch"==o.pointerType)&&!closest(o.target,".wj-elem-filter")){var n=closest(o.target,".wj-cell");n instanceof HTMLElement&&(t._rcBounds=null,e._htDown=null,e._hover(o),e._szRowCol&&(n.removeAttribute("draggable"),i.style.touchAction="none",e._mousedown(o),o.preventDefault()))}}),t.addEventListener(i,o[1],function(t){null!=t.pointerType&&"touch"!=t.pointerType||e._szRowCol&&(e._mousemove(t),t.preventDefault())}),t.addEventListener(i,o[2],function(t){if((null==t.pointerType||"touch"==t.pointerType)&&e._szRowCol){if(e._szArgs)e._finishResizing(e._eMouse);else{var o=closest(t.target,".wj-cell");o instanceof HTMLElement&&o.click()}e.resetMouseState(),i.style.touchAction=""}}))},e.prototype._mousedown=function(e){var t=this._g,i=t.hitTest(e),o=i.cellType,n=e.ctrlKey||e.metaKey,r=e.target,s=CellType;if(this._selDown=t.selection,i.panel==t.cells){if(closestClass(r,CellFactory._WJC_DROPDOWN))return t._edtHdl._toggleListBox(e,i.range),void e.preventDefault();if(t.editRange&&t.editRange.contains(i.range))return}var l=getActiveElement();if(r!=l||!t._isInputElement(r)){if(o==s.None)return t.finishEditing(),void(r!=t._root&&r!=t._fCt&&t._edtHdl._commitRowEdits());if(this._htDown=i,this._eMouse=e,null!=this._szRowCol)return l!=t._eFocus&&(t._eFocus.tabIndex=0,t._eFocus.focus()),void this._handleResizing(e);if(!(o==s.RowHeader&&i.edgeBottom&&t.allowResizing&AllowResizing.Rows&&this._getResizeRow(i))){switch(o){case s.Cell:case s.RowHeader:n&&t.selectionMode==SelectionMode.ListBox&&this._startListBoxSelection(i.row),this._mouseSelect(e,e.shiftKey),o==s.RowHeader&&0==(t.allowDragging&AllowDragging.Rows)&&(e.preventDefault(),t.focus())}if(o==s.Cell&&t.rows.maxGroupLevel>-1&&closestClass(r,CellFactory._WJC_COLLAPSE)){var a=tryCast(t.rows[i.row],GroupRow);if(a)return n?t.collapseGroupsToLevel(a.isCollapsed?a.level+1:a.level):a.isCollapsed=!a.isCollapsed,void this.resetMouseState()}}}},e.prototype._mousemove=function(e){if(null!=this._htDown){if(0==e.buttons&&this._eMouse&&e.timeStamp-this._eMouse.timeStamp>600)return void this.resetMouseState();if(this._eMouse=e,this._szRowCol)this._handleResizing(e);else switch(this._htDown.cellType){case CellType.Cell:this._mouseSelect(e,!0);break;case CellType.RowHeader:0==(this._g.allowDragging&AllowDragging.Rows)&&this._mouseSelect(e,!0)}}},e.prototype._mouseup=function(e){if(!this._g.isTouching||!(this._dragSrc||e.target instanceof HTMLHtmlElement)){var t=this._g,i=t.hitTest(e),o=this._htDown,n=SelectionMode;if(o&&!e.defaultPrevented)if(this._szArgs)this._finishResizing(e);else if(o.panel!=t.topLeftCells||this._szArgs)o.panel!=t.columnHeaders||e.dataTransfer?o.panel==t.cells&&(this._szRowCol||e.ctrlKey||e.metaKey||e.shiftKey||i.panel==o.panel&&i.range.equals(o.range)&&t.selection.equals(this._selDown)&&t._edtHdl.startEditing(!0,i.row,i.col,!0,e)):i.panel==o.panel&&i.col==o.col&&!i.edgeRight&&i.col>-1&&this._clickSort(e,i);else if(i.panel==o.panel&&i.row==o.row&&i.col==o.col&&t.rows.length&&t.columns.length)switch(t.selectionMode){case n.CellRange:case n.RowRange:case n.ListBox:t.select(new CellRange(0,0,t.rows.length-1,t.columns.length-1))}this.resetMouseState()}},e.prototype._click=function(e){Date.now()-this._tsLast>50&&!e.pointerType&&this._handleClick(e)},e.prototype._handleClick=function(e){var t=this._g,i=e.target,o=new HitTestInfo(i,null),n=o.panel;if(!e.defaultPrevented&&o.grid==t&&!t._isInputElement(i))if(n==t.topLeftCells)t.select(new CellRange(0,0,t.rows.length-1,t.columns.length-1));else if(n==t.columnHeaders)this._clickSort(e,o);else if(n==t.rowHeaders)t.select(new CellRange(o.row,0,o.row,t.columns.length-1));else if(n==t.cells)if(o.row<0)this._clickSort(e,o);else if(closestClass(i,CellFactory._WJC_COLLAPSE)){var r=t.rows[o.row];r instanceof GroupRow&&(e.ctrlKey?t.collapseGroupsToLevel(r.isCollapsed?r.level+1:r.level):r.isCollapsed=!r.isCollapsed)}else closestClass(i,CellFactory._WJC_DROPDOWN)?t._edtHdl._toggleListBox(e,o.range):t.select(o.range)},e.prototype._clickSort=function(e,t){var i=this._g,o=i.collectionView,n=e.ctrlKey||e.metaKey;if(o&&o.canSort&&i.allowSorting){t.row;var r=t.panel.columns[t.col],s=i._getBindingColumn(t.panel,t.row,r),l=s?s._getBindingSort():null;if(s.allowSorting&&l){if(r==s){var a=i.getMergedRange(t.panel,t.row,t.col,!1);if(a&&a.columnSpan>1)return}for(var h=t.grid.collectionView.sortDescriptions,c=null,u=0;u<h.length;u++)if(h[u].property==l){c=!h[u].ascending;break}if(null==c){if(n)return;c=!0}var d=new CellRangeEventArgs(t.panel,t.range,e);i.onSortingColumn(d)&&(i._edtHdl._commitRowEdits(),n?h.clear():h.splice(0,h.length,new SortDescription(l,c)),i.onSortedColumn(d))}}},e.prototype._dblclick=function(e){var t,i=this._g,o=i.hitTest(e),n=o.cellType,r=i.selection,s=o.range;if(!e.defaultPrevented)if(o.edgeRight&&i.allowResizing&AllowResizing.Columns){if(n==CellType.ColumnHeader||n==CellType.Cell&&i.allowResizing&_AR_ALLCELLS){e.preventDefault(),e.ctrlKey&&r.containsColumn(o.col)&&(s=r);for(var l=s.leftCol;l<=s.rightCol;l++)i.columns[l].allowResizing&&(t=new CellRangeEventArgs(i.cells,new CellRange(-1,l)),i.onAutoSizingColumn(t)&&i.onResizingColumn(t)&&(i.autoSizeColumn(l),i.onResizedColumn(t),i.onAutoSizedColumn(t)))}else n==CellType.TopLeft&&o.panel.columns[o.col].allowResizing&&(e.preventDefault(),t=new CellRangeEventArgs(o.panel,new CellRange(-1,o.col)),i.onAutoSizingColumn(t)&&i.onResizingColumn(t)&&(i.autoSizeColumn(o.col,!0),i.onAutoSizedColumn(t),i.onResizedColumn(t)));this.resetMouseState()}else if(o.edgeBottom&&i.allowResizing&AllowResizing.Rows){if(n==CellType.RowHeader||n==CellType.Cell&&i.allowResizing&_AR_ALLCELLS){e.ctrlKey&&r.containsRow(o.row)&&(s=r);for(var a=s.topRow;a<=s.bottomRow;a++)i.rows[a].allowResizing&&(t=new CellRangeEventArgs(i.cells,new CellRange(a,-1)),i.onAutoSizingRow(t)&&i.onResizingRow(t)&&(i.autoSizeRow(a),i.onResizedRow(t),i.onAutoSizedRow(t)))}else n==CellType.TopLeft&&o.panel.rows[o.row].allowResizing&&(t=new CellRangeEventArgs(o.panel,new CellRange(o.row,-1)),i.onAutoSizingRow(t)&&i.onResizingRow(t)&&(i.autoSizeRow(o.row,!0),i.onResizedRow(t),i.onAutoSizedRow(t)));this.resetMouseState()}else;},e.prototype._hover=function(e){if(!this._isDown){var t=this._g,i=t.hitTest(e),o=(i.panel,i.cellType),n="";return this._szRowCol=null,(o==CellType.ColumnHeader||o==CellType.TopLeft||o==CellType.Cell&&t.allowResizing&_AR_ALLCELLS)&&i.edgeRight&&0!=(t.allowResizing&AllowResizing.Columns)&&(this._szRowCol=this._getResizeCol(i)),(o==CellType.RowHeader||o==CellType.TopLeft||o==CellType.Cell&&t.allowResizing&_AR_ALLCELLS)&&i.edgeBottom&&0!=(t.allowResizing&AllowResizing.Rows)&&(this._szRowCol=this._getResizeRow(i)),this._szRowCol instanceof Column?n="col-resize":this._szRowCol instanceof Row&&(n="row-resize"),this._szStart=this._szRowCol?this._szRowCol.renderSize:0,t.hostElement.style.cursor=n,i}return null},e.prototype._getResizeCol=function(e){for(var t=e.panel.columns,i=t[e.col],o=e.col+1;o<t.length;o++){if((n=t[o]).visible){n.renderSize<1&&(i=n);break}}if(e.col==t.length-1&&(e.cellType==CellType.TopLeft||e.cellType==CellType.RowHeader)){t=this._g.columns;for(o=0;o<t.length;o++){var n;if((n=t[o]).visible){n.renderSize<1&&(i=n);break}}}return i.allowResizing?i:null},e.prototype._getResizeRow=function(e){for(var t=e.panel.rows,i=t[e.row],o=e.row+1;o<t.length;o++){if((n=t[o]).visible){n.renderSize<1&&(i=n);break}}if(e.row==t.length-1&&(e.cellType==CellType.TopLeft||e.cellType==CellType.ColumnHeader)){t=this._g.rows;for(o=0;o<t.length;o++){var n;if((n=t[o]).visible){n.renderSize<1&&(i=n);break}}}return i.allowResizing?i:null},e.prototype._mouseSelect=function(e,t){var i=this,o=this._g;if(e&&this._htDown&&this._htDown.panel&&o.selectionMode!=SelectionMode.None){var n=new HitTestInfo(this._htDown.panel,e);this._handleSelection(n,t),!isIE9()&&e.button>=0&&e.target!=o._root&&(n=new HitTestInfo(o,e)).cellType!=CellType.Cell&&n.cellType!=CellType.RowHeader&&setTimeout(function(){i._isDown&&i._eMouse&&i._mouseSelect(i._eMouse,t)},100)}},e.prototype._handleResizing=function(t){if(t.preventDefault(),this._szRowCol instanceof Column){var i=this._g,o=mouseToPage(t).x,n=Math.round(Math.max(e._SZ_MIN,this._szStart+(o-this._htDown.point.x)*(i.rightToLeft?-1:1)));if(this._szRowCol.renderSize!=n){if(null==this._szArgs){var r=i.rowHeaders.columns.indexOf(this._szRowCol)>-1?i.rowHeaders:i.cells;this._szArgs=new CellRangeEventArgs(r,new CellRange(-1,this._szRowCol.index))}this._szArgs.cancel=!1,i.onResizingColumn(this._szArgs)&&(i.deferResizing?this._showResizeMarker(n):this._szRowCol.width=n)}}if(this._szRowCol instanceof Row){i=this._g;var s=mouseToPage(t).y;n=Math.round(Math.max(e._SZ_MIN,this._szStart+(s-this._htDown.point.y)));if(this._szRowCol.renderSize!=n){if(null==this._szArgs){r=i.columnHeaders.rows.indexOf(this._szRowCol)>-1?i.columnHeaders:i.cells;this._szArgs=new CellRangeEventArgs(r,new CellRange(this._szRowCol.index,-1))}this._szArgs.cancel=!1,i.onResizingRow(this._szArgs)&&(i.deferResizing?this._showResizeMarker(n):this._szRowCol.height=n)}}},e.prototype._dragstart=function(e){var t=this._g,i=this._htDown,o=AllowDragging;if(i){if(this._dragSrc=null,this._htDrag=null,!this._szRowCol){var n=new CellRangeEventArgs(i.panel,i.range);if(i.cellType==CellType.ColumnHeader&&t.allowDragging&o.Columns&&i.col>-1&&t.columns[i.col].allowDragging)t.onDraggingColumn(n)?this._dragSrc=e.target:e.preventDefault();else if(i.cellType==CellType.RowHeader&&t.allowDragging&o.Rows&&i.row>-1&&t.rows[i.row].allowDragging){var r=t.rows[i.row];r instanceof GroupRow||r instanceof _NewRowTemplate||(t.onDraggingRow(n)?this._dragSrc=e.target:e.preventDefault())}else i.cellType==CellType.TopLeft&&t.allowDragging&o.Columns&&i.col>-1&&t.topLeftCells.columns[i.col].allowDragging&&(t.onDraggingColumn(n)?this._dragSrc=e.target:e.preventDefault())}this._dragSrc&&e.dataTransfer&&!e.defaultPrevented&&(this._htDrag=i,_startDrag(e.dataTransfer,"move"),e.stopPropagation(),addClass(this._dragSrc,_WJC_DRAGSRC),t.beginUpdate(),this._updating=!0)}},e.prototype._dragend=function(e){this._dragSrc=null,this._htDrag=null,this.resetMouseState()},e.prototype._dragover=function(e){var t=this._g,i=this._hitTest(e),o=this._dragSrc?this._htDrag:null,n=CellType,r=!1;if(o&&i.cellType==o.cellType){var s=new CellRangeEventArgs(i.panel,i.range,o);i.cellType==n.ColumnHeader?(s.cancel=!t.columns.canMoveElement(o.col,i.col),r=t.onDraggingColumnOver(s)):i.cellType==n.RowHeader?(s.cancel=!t.rows.canMoveElement(o.row,i.row),r=t.onDraggingRowOver(s)):i.cellType==n.TopLeft&&(s.cancel=!t.topLeftCells.columns.canMoveElement(o.col,i.col),r=t.onDraggingColumnOver(s))}if(r?(e.dataTransfer.dropEffect="move",this._showDragMarker(i),e.preventDefault(),e.stopPropagation()):this._showDragMarker(null),o&&t.autoScroll){var l=t.controlRect,a=t.scrollPosition,h=Control._DRAG_SCROLL_EDGE,c=Control._DRAG_SCROLL_STEP;o.panel==t.columnHeaders?(e.pageX-l.left<h&&(a.x+=c),l.right-e.pageX<h&&(a.x-=c)):o.panel==t.rowHeaders&&(e.pageY-l.top<h&&(a.y+=c),l.bottom-e.pageY<h&&(a.y-=c)),a.equals(t._ptScrl)||(t.scrollPosition=a,t._rcBounds=null)}},e.prototype._drop=function(e){var t=this._g,i=this._hitTest(e),o=this._dragSrc?this._htDrag:null,n=CellType;if(o&&i.cellType==o.cellType){var r=t.selection,s=new CellRangeEventArgs(i.panel,i.range,o);i.cellType==n.ColumnHeader?(t.columns.moveElement(o.col,i.col),t.select(r.row,i.col),t.onDraggedColumn(s)):i.cellType==n.RowHeader?(t.rows.moveElement(o.row,i.row),t.select(i.row,r.col),t.onDraggedRow(s)):i.cellType==n.TopLeft&&(t.topLeftCells.columns.moveElement(o.col,i.col),t.onDraggedColumn(s))}this.resetMouseState()},e.prototype._hitTest=function(e){var t=this._g;return t._rcBounds=null,t.hitTest(e)},e.prototype._showResizeMarker=function(e){var t=this._g,i=this._dvMarker,o=t.cells.hostElement;i.parentElement!=o&&o.appendChild(i);var n,r=this._szArgs.panel.cellType,s=CellType;this._szRowCol instanceof Column?(n={left:this._szRowCol.pos+e-1,top:-1e3,right:"",bottom:0,width:3,height:""},r!=s.TopLeft&&r!=s.RowHeader||(n.left-=t._eTL.offsetWidth),r==s.Cell&&this._szRowCol.index<t.frozenColumns&&(n.left-=t.scrollPosition.x),t.rightToLeft&&(n.left=o.clientWidth-n.left-n.width)):(n={left:-1e3,top:this._szRowCol.pos+e-1,right:0,bottom:"",width:"",height:3},r!=s.TopLeft&&r!=s.ColumnHeader||(n.top-=t._eTL.offsetHeight),r==s.Cell&&this._szRowCol.index<t.frozenRows&&(n.top-=t.scrollPosition.y)),setCss(i,n)},e.prototype._showDragMarker=function(e){var t=this._g,i=this._dvMarker;if(!e||!e.panel)return removeChild(i),void(this._rngTarget=null);if(!e.range.equals(this._rngTarget)){this._rngTarget=e.range;var o=e.panel.hostElement;i.parentElement!=o&&o.appendChild(i);var n=CellType,r={left:0,top:0,width:6,height:6,right:"",bottom:""};switch(e.cellType){case n.TopLeft:case n.ColumnHeader:r.height=e.panel.height;var s=e.panel.columns[e.col];r.left=s.pos-r.width/2,this._htDown&&e.col>this._htDown.col&&(r.left+=s.renderWidth),e.cellType==n.ColumnHeader&&e.col<t.frozenColumns&&(r.left-=t.scrollPosition.x),t.rightToLeft&&(r.left=i.parentElement.clientWidth-r.left-r.width);break;case n.RowHeader:r.width=e.panel.width;var l=e.panel.rows[e.row];r.top=l.pos-r.height/2,e.row>this._htDown.row&&(r.top+=l.renderHeight),e.row<t.frozenRows&&(r.top-=t.scrollPosition.y)}setCss(i,r)}},e.prototype._finishResizing=function(t){var i=this._g,o=i.selection,n=this._szArgs,r=this._eMouse&&this._eMouse.ctrlKey,s=CellType;if(n&&!n.cancel){if(n.col>-1){var l=n.col,a=mouseToPage(t).x,h=Math.round(Math.max(e._SZ_MIN,this._szStart+(a-this._htDown.point.x)*(this._g.rightToLeft?-1:1)));if(n.panel.columns[l].width=Math.round(h),i.onResizedColumn(n),r&&this._htDown.cellType==s.ColumnHeader&&o.containsColumn(l))for(var c=o.leftCol;c<=o.rightCol;c++)i.columns[c].allowResizing&&c!=l&&(n=new CellRangeEventArgs(i.cells,new CellRange(-1,c)),i.onResizingColumn(n)&&(i.columns[c].size=i.columns[l].size,i.onResizedColumn(n)))}if(n.row>-1){l=n.row;var u=mouseToPage(t).y;h=Math.round(Math.max(e._SZ_MIN,this._szStart+(u-this._htDown.point.y)));if(n.panel.rows[l].height=Math.round(h),i.onResizedRow(n),r&&this._htDown.cellType==s.RowHeader&&o.containsRow(l))for(var d=o.topRow;d<=o.bottomRow;d++)i.rows[d].allowResizing&&d!=l&&(n=new CellRangeEventArgs(i.cells,new CellRange(d,-1)),i.onResizingRow(n)&&(i.rows[d].size=i.rows[l].size,i.onResizedRow(n)))}}},e.prototype._startListBoxSelection=function(e){var t=this._g.rows,i=this._lbSelRows={};this._lbSelState=!t[e].isSelected,t.forEach(function(e,t){e.isSelected&&(i[t]=!0)})},e.prototype._handleSelection=function(e,t){var i=this._g,o=i.rows,n=i._selHdl.selection,r=new CellRange(e.row,e.col);if(e.row>-1&&e.col>-1)if(null!=this._lbSelRows){var s=!1;r=new CellRange(e.row,e.col,this._htDown.row,this._htDown.col);for(var l=0;l<o.length;l++){var a=r.containsRow(l)?this._lbSelState:null!=this._lbSelRows[l];if(a!=o[l].isSelected){var h=new CellRangeEventArgs(i.cells,new CellRange(l,n.col,l,n.col2));i.onSelectionChanging(h)&&(o[l]._setFlag(RowColFlags.Selected,a,!0),s=!0,i.onSelectionChanged(h))}}s&&i.refreshCells(!1,!0,!0),i.scrollIntoView(e.row,e.col)}else t&&(i.anchorCursor?(r.row=n.row,r.col=n.col):(r.row2=n.row2,r.col2=n.col2)),e.cellType==CellType.RowHeader?(r.col=0,r.col2=i.columns.length-1,i.select(r,!1),i.scrollIntoView(e.row,-1)):i.select(r)},e._SZ_MIN=0,e}();export{_MouseHandler};_registerModule("wijmo.grid",selfModule);