/*!
    *
    * Wijmo Library 5.20191.603
    * http://wijmo.com/
    *
    * Copyright(c) GrapeCity, Inc.  All rights reserved.
    *
    * Licensed under the GrapeCity Commercial License.
    * sales@wijmo.com
    * wijmo.com/products/wijmo-5/license/
    *
    */

var __extends=this&&this.__extends||function(){var e=function(t,l){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var l in t)t.hasOwnProperty(l)&&(e[l]=t[l])})(t,l)};return function(t,l){function i(){this.constructor=t}e(t,l),t.prototype=null===l?Object.create(l):(i.prototype=l.prototype,new i)}}();import{WjDirective,WjLink,MetaFactory,_registerNgModule,softRefGrid,softRefGridDetail,softRefInput}from"wijmo/wijmo.angular.base";import{Control,closest,CollectionViewGroup,isNullOrWhiteSpace,contains,getActiveElement,isArray,isString,hasClass,setCss,asNumber,isIE}from"wijmo/wijmo";import*as mNg from"angular";import*as wjcGrid from"wijmo/wijmo.grid";var wjNg=mNg,wijmoGridName="wj.grid";export var ngModuleName=wijmoGridName;var wijmoGrid=_registerNgModule(wijmoGridName);softRefGrid()&&softRefGrid().FlexGrid&&(wijmoGrid.directive("wjFlexGrid",["$compile","$interpolate",function(e,t){return new WjFlexGrid(e,t)}]),wijmoGrid.directive("wjFlexGridColumn",["$compile",function(e){return new WjFlexGridColumn(e)}]),wijmoGrid.directive("wjFlexGridCellTemplate",[function(){return new WjFlexGridCellTemplate}]));var WjFlexGrid=function(e){function t(t,l){var i=e.call(this)||this;i._$compile=t,i._$interpolate=l;return i.transclude=!0,i.template="<div ng-transclude />",i}return __extends(t,e),Object.defineProperty(t.prototype,"_controlConstructor",{get:function(){return wjcGrid.FlexGrid},enumerable:!0,configurable:!0}),t.prototype._createLink=function(){return new WjFlexGridLink},t.prototype._initProps=function(){var e=MetaFactory.findProp("childItemsPath",this._props);e.scopeBindingMode="@",e.customHandler=function(e,t,l,i,r){if(l&&(l=l.trim())&&"["===l[0]){var n=e.$parent.$eval(l);return t.childItemsPath=n,!0}return!1}},t}(WjDirective);export{WjFlexGrid};var WjFlexGridLink=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype._initControl=function(){var t=e.prototype._initControl.call(this);return new DirectiveCellFactory(t,this),t},t}(WjLink),gridModule=wjcGrid&&wjcGrid.CellFactory;gridModule||(window.wijmo.grid={},window.wijmo.grid.CellFactory=function(){});var DirectiveCellFactory=function(e){function t(l,i){var r=e.call(this)||this;if(r._lastApplyTimeStamp=0,r._noApplyLag=!1,r._startingEditing=!1,r._cellStampCounter=0,r._composing=!1,r._grid=l,r._gridLink=i,r._rowHeightUpdates=new _RowHeightUpdateQueue(r),!t._templateTypes)for(var n in t._templateTypes=[],CellTemplateType)isNaN(n)&&t._templateTypes.push(n);var o=r;return r._baseCf=l.cellFactory,l.cellFactory=r,r._evtInput=document.createEvent("HTMLEvents"),r._evtInput.initEvent("input",!0,!1),r._evtChange=document.createEvent("HTMLEvents"),r._evtChange.initEvent("change",!0,!1),r._evtBlur=document.createEvent("HTMLEvents"),r._evtBlur.initEvent("blur",!1,!1),l.prepareCellForEdit.addHandler(function(e,t){o._noApplyLag=!0}),l.cellEditEnded.addHandler(function(e,t){(t.range.col<0||!l.columns[t.range.col][WjFlexGridCellTemplate._getTemplContextProp(CellTemplateType.CellEdit)])&&(o._editChar=null),setTimeout(function(){o._noApplyLag=!1},300)}),l.beginningEdit.addHandler(function(e,t){!t.data||t.data instanceof KeyboardEvent&&!(t.data.charCode<=32)||(o._editChar=null),o._startingEditing=!0}),l.hostElement.addEventListener("keydown",function(e){o._startingEditing=!1},!0),l.hostElement.addEventListener("keypress",function(e){var t=e.charCode>32?String.fromCharCode(e.charCode):null;t&&closest(e.target,".wj-flexgrid")===l.hostElement&&(!l.activeEditor||o._startingEditing?o._editChar=t:o._editChar&&(o._editChar+=t))},!0),l.hostElement.addEventListener("compositionstart",function(e){o._composing=!0},!0),l.hostElement.addEventListener("compositionend",function(e){o._composing=!1},!0),r}return __extends(t,e),t.prototype.updateCell=function(e,l,i,r,n){var o=this;this._cellStampCounter=(this._cellStampCounter+1)%1e7;var a=r[t._cellStampProp]=this._cellStampCounter;r.style.overflow&&(r.style.overflow="");var p=l,s=i;n&&!n.isSingleCell&&(l=n.row,i=n.col);var c,d=this,u=e.grid,m=u.editRange,f=e.rows[l],_=f.dataItem,C=!1,h=!1,v=!1,y=!1;switch(e.cellType){case wjcGrid.CellType.Cell:if(m&&m.row===l&&m.col===i)c=CellTemplateType.CellEdit,h=v=!0;else if(f instanceof wjcGrid.GroupRow){var T=!((y=_ instanceof CollectionViewGroup)||f.hasChildren);i==e.columns.firstVisibleIndex?c=T?CellTemplateType.Cell:CellTemplateType.GroupHeader:(c=T?CellTemplateType.Cell:CellTemplateType.Group,h=!0)}else softRefGridDetail()&&softRefGridDetail().DetailRow&&f instanceof softRefGridDetail().DetailRow||(c=CellTemplateType.Cell);break;case wjcGrid.CellType.ColumnHeader:c=CellTemplateType.ColumnHeader;break;case wjcGrid.CellType.RowHeader:c=u.collectionView&&u.collectionView.currentEditItem===_?CellTemplateType.RowHeaderEdit:CellTemplateType.RowHeader,C=!0;break;case wjcGrid.CellType.TopLeft:c=CellTemplateType.TopLeft,C=!0;break;case wjcGrid.CellType.ColumnFooter:c=CellTemplateType.ColumnFooter,h=!0;break;case wjcGrid.CellType.BottomLeft:c=CellTemplateType.BottomLeft,C=!0}var g=!1;if(null!=c){var w=y&&c==CellTemplateType.GroupHeader?u.getColumn(_.groupDescription.propertyName):i>=0&&i<e.columns.length?e.columns[i]:null;if(w){var j=WjFlexGridCellTemplate._getTemplContextProp(c),E=(C?u:w)[j];if(E||(c===CellTemplateType.RowHeaderEdit?(c=CellTemplateType.RowHeader,j=WjFlexGridCellTemplate._getTemplContextProp(c),E=u[j]):c!==CellTemplateType.Group&&c!==CellTemplateType.GroupHeader||y||(c=CellTemplateType.Cell,j=WjFlexGridCellTemplate._getTemplContextProp(c),E=w[j])),E){var G,x=d._getCellTemplate(E.cellTemplate),F=E.cellStyle,S=E.cellClass,L=!isNullOrWhiteSpace(x),W=!isNullOrWhiteSpace(F),H=!isNullOrWhiteSpace(S);if(h&&(G=e.getCellData(l,i,!1)),L){var $=r.getAttribute(wjcGrid.FlexGrid._WJS_MEASURE),R=$&&"true"===$.toLowerCase();g=!0,v&&this._baseCf.updateCell(e,p,s,r,n,!0);var A=r[j]||{},I=A.column!==w||!A.cellScope||!A.cellScope.$root,k=v&&this._composing&&u.imeEnabled,P=A.cellScope;I&&(this._doDisposeCell(r),A.cellScope=P=E.templLink.scope.$parent.$new(),A.column=w,r[j]=A);var b=P.$row!==f||P.$col!==w||P.$item!==_||P.$value!==G;b&&d._initCellScope(P,f,w,_,G);var N=E.cellLink;N||(N=E.cellLink=this._gridLink.directive._$compile('<div style="display:none"'+(W?' ng-style="'+F+'"':"")+(H?' ng-class="'+S+'"':"")+">"+x+"</div>"));var D=A.clonedElement;if(I){var O=P.$watch(function(t){if(D&&(O(),D[0].style.display="",e.cellType===wjcGrid.CellType.ColumnHeader||e.cellType===wjcGrid.CellType.TopLeft)){var l=D[0].style,i=l.outlineColor,r=l.outlineWidth;l.outlineColor="white",l.outlineWidth="0px",setTimeout(function(){l.outlineColor=i,l.outlineWidth=r},0)}});A.clonedElement=D=N(P,function(e,t){})}R&&(D[0].style.display="");var M=!1;if(v){var U=r.firstElementChild;U&&(k||r.focus(),U.style.display="none")}else(M=1==r.childNodes.length)||(r.textContent="");M?D[0]!==r.firstChild&&r.replaceChild(D[0],r.firstChild):r.appendChild(D[0]),E.cellOverflow&&(r.style.overflow=E.cellOverflow);if(this._closingApplyTimeOut&&clearTimeout(this._closingApplyTimeOut),d._rowHeightUpdates.add({panel:e,cell:r,rng:n,cellStamp:a,templateContext:E}),R||m||this._noApplyLag||b&&Date.now()-this._lastApplyTimeStamp>40?(clearTimeout(this._closingApplyTimeOut),P.$root&&!P.$root.$$phase&&P.$apply(),m||R||d._rowHeightUpdates.execute(),this._lastApplyTimeStamp=Date.now()):(clearTimeout(this._closingApplyTimeOut),this._closingApplyTimeOut=setTimeout(function(){clearTimeout(this._closingApplyTimeOut),P.$root&&!P.$root.$$phase&&P.$apply(),d._rowHeightUpdates.execute()},10)),k?v&&setTimeout(function(){k?o._initImeEditInput(A,E):o._initEditInput(A,E,null)},0):setTimeout(function(){if(d._updateRowHeight(e,r,n,a,E)){if(v){d._rowHeightUpdates.clear();var t=d._isFullEdit();return u.refresh(),void u.startEditing(t)}}else v&&d._initEditInput(A,E,null)},0),v){d._cellEditorScope=P;var q=function(t,n){if(u.cellEditEnding.removeHandler(q),!n.stayInEditMode){var o=getActiveElement();o&&o.dispatchEvent(d._evtBlur),contains(r,getActiveElement())&&r.focus()}n.cancel||n.stayInEditMode||(n.cancel=!0,e.grid.setCellData(l,i,P.$value));var a=r.querySelectorAll(".wj-dropdown");[].forEach.call(a,function(e){var t=Control.getControl(e);t&&softRefInput()&&t instanceof softRefInput().DropDown&&(t.isDroppedDown=!1)})};u.cellEditEnding.addHandler(q),u.cellEditEnded.addHandler(function(){d._cellEditorScope=null})}else this._baseCf.updateCell(e,p,s,r,n,!1)}}}}if(g||(this._doDisposeCell(r),this._baseCf.updateCell(e,p,s,r,n)),!L&&(W||H)){var B=d._initCellScope({},f,w,_,G),V=W?this._gridLink.scope.$parent.$eval(F,B):null,z=H?this._gridLink.scope.$parent.$eval(S,B):null;if(V||z){for(var Q=document.createElement("div");r.firstChild;)Q.appendChild(r.firstChild);if(r.appendChild(Q),V)for(var J in V)Q.style[J]=V[J];if(z){for(var K=isArray(z)?z:[z],X="",Y=0;Y<K.length;Y++){var Z=K[Y];if(Z)if(isString(Z))X+=" "+Z;else for(var ee in Z)Z[ee]&&(X+=" "+ee)}Q.className=X}}}},t.prototype.getEditorValue=function(t){return this._cellEditorScope?this._cellEditorScope.$value:e.prototype.getEditorValue.call(this,t)},t.prototype.disposeCell=function(e){this._doDisposeCell(e)},t.prototype._doDisposeCell=function(e){for(var l=t._templateTypes,i=0;i<l.length;i++){var r=WjFlexGridCellTemplate._getTemplContextProp(CellTemplateType[l[i]]),n=e[r];n&&n.cellScope&&n.cellScope.$root&&(n.cellScope.$destroy(),n.clonedElement&&(n.clonedElement.remove(),n.clonedElement=null),e[r]=null)}},t.prototype._updateRowHeight=function(e,l,i,r,n){if(n.autoSizeRows){var o=l.scrollHeight,a=e.rows,p=i&&i.rowSpan||1;if(r===l[t._cellStampProp]&&a.defaultSize*p<o)return a.defaultSize=o/p,!0}return!1},t.prototype._initCellScope=function(e,t,l,i,r){return e.$row=t,e.$col=l,e.$item=i,e.$value=r,e},t.prototype._getCellTemplate=function(e){return e&&(e=(e=(e=e.replace(/ class\=\"ng\-scope\"( \"ng\-binding\")?/g,"")).replace(/<span>\s*<\/span>/g,"")).trim()),e},t.prototype._isFullEdit=function(){var e=this._grid;return!e.activeEditor||e._edtHdl._fullEdit},t.prototype._setFullEdit=function(e){var t=this._grid;e.forceFullEdit&&t.activeEditor&&(t._edtHdl._fullEdit=!0)},t.prototype._initEditInput=function(e,l,i){var r=this;this._setFullEdit(l);var n=this._findInitialInput(e);if(n){var o=function(){n.removeEventListener("focus",o),setTimeout(function(){var e=null!=i?i:r._editChar;e&&(n.value=e,r._editChar=null,t._setSelectionRange(n,e.length,e.length),!t.isNgIE||hasClass(n,"wj-form-control")||n.getAttribute("wj-part")?n.dispatchEvent(r._evtInput):n.dispatchEvent(r._evtChange))},t._FOCUS_INTERVAL)};n.addEventListener("focus",o),n.focus()}},t.prototype._initImeEditInput=function(e,t){var l=this,i=getActiveElement();if(i&&i instanceof HTMLInputElement&&hasClass(i,"wj-grid-ime")){var r=function(n){i.removeEventListener("compositionend",r),setCss(i,wjcGrid._ImeHandler._cssHidden),l._initEditInput(e,t,i.value)};i.addEventListener("compositionend",r);var n=this._findInitialInput(e);if(n){var o=n.getBoundingClientRect(),a=i.getBoundingClientRect(),p=window.getComputedStyle(i),s=parseFloat(p.left),c=parseFloat(p.top);setCss(i,{left:s+o.left-a.left+"px",top:c+o.top-a.top+"px",width:o.width+"px",height:o.height+"px"})}}},t.prototype._findInitialInput=function(e){var t=e.clonedElement[0].querySelectorAll("input,textarea");if(t)for(var l=0;l<t.length;l++){var i=t[l],r=window.getComputedStyle(i);if("none"!==r.display&&"visible"===r.visibility)return i}return null},t._setSelectionRange=function(e,t,l){if(void 0===l&&(l=t),contains(document.body,e)&&!e.disabled&&"none"!=e.style.display)try{e.setSelectionRange(asNumber(t),asNumber(l),isIE()?null:"backward"),e.focus()}catch(e){}},t._cellStampProp="__wjCellStamp",t._FOCUS_INTERVAL=Control._FOCUS_INTERVAL+20,t.isNgIE=!!document.documentMode,t}(wjcGrid.CellFactory),_RowHeightUpdateQueue=function(){function e(e){this._requests=[],this._timeOuts=[],this._cellFactory=e}return e.prototype.add=function(e){this._requests.push(e)},e.prototype.execute=function(){for(var e=this._requests;e.length>0;){var t=this,l=function(e){return setTimeout(function(){if(t._cellFactory._updateRowHeight(e.panel,e.cell,e.rng,e.cellStamp,e.templateContext))t.clear();else{var i=t._timeOuts.indexOf(l);i>-1&&t._timeOuts.splice(i,1)}},0)}(this._requests.shift());this._timeOuts.push(l)}},e.prototype.clear=function(){this._requests.splice(0,this._requests.length),this._clearTimeouts()},e.prototype._clearTimeouts=function(){for(var e=this._timeOuts,t=0;t<e.length;t++)clearTimeout(e[t]);e.splice(0,e.length)},e}();gridModule||(window.wijmo.grid=null);var WjFlexGridColumn=function(e){function t(l){var i=e.call(this)||this;return i._$compile=l,i.scope.dataMap+="map",i.scope.dataType+="type",i.require="^wjFlexGrid",i.terminal=!0,WjDirective._dynaTemplates?(i.transclude=!1,i.priority=100,i.template=function(e,l){return l[t._colTemplateProp]=e[0].innerHTML,'<div class="wjGridColumn"/>'}):(i.transclude=!0,i.template='<div class="wjGridColumn" ng-transclude/>'),i}return __extends(t,e),Object.defineProperty(t.prototype,"_controlConstructor",{get:function(){return wjcGrid.Column},enumerable:!0,configurable:!0}),t.prototype._initControl=function(e){return new wjcGrid.Column},t.prototype._createLink=function(){return new WjFlexGridColumnLink},t._colTemplateProp="$__wjColTemplate",t._colWjLinkProp="$__wjLink",t._cellCtxProp="$_cellCtxProp",t}(WjDirective);export{WjFlexGridColumn};var WjFlexGridColumnLink=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype._initParent=function(){var t=this.parent.control;t.autoGenerateColumns&&(t.autoGenerateColumns=!1,this._safeApply(this.scope,"autoGenerateColumns",!1),t.columns.clear()),e.prototype._initParent.call(this);var l=WjFlexGridCellTemplate._getTemplContextProp(CellTemplateType.Cell),i=this.control[l],r=this[WjFlexGridColumn._cellCtxProp];!i&&r&&(this.control[l]=r),this.control[WjFlexGridColumn._colWjLinkProp]=this},t.prototype._link=function(){var t=this.tElement[0],l=this.tAttrs[WjFlexGridColumn._colTemplateProp],i=null!=l?l:WjDirective._removeTransclude(t.innerHTML),r={};if(!isNullOrWhiteSpace(i)){var n=document.createElement("div");n.innerHTML=i;var o,a=[];[].forEach.call(n.children,function(e){a.push(e)});for(var p=0;p<a.length;p++){var s=a[p];s.tagName.toLocaleLowerCase()===WjFlexGridCellTemplate._tagName&&(o||(o=this.scope.$parent.$new()),n.removeChild(s),t.appendChild(s),this.directive._$compile(s)(o))}var c=n.innerHTML;isNullOrWhiteSpace(c)||(r.cellTemplate=c)}var d=this.tAttrs.ngStyle,u=this.tAttrs.ngClass;d&&(r.cellStyle=d),u&&(r.cellClass=u),(r.cellTemplate||r.cellStyle||r.cellClass)&&(r.templLink=this,this[WjFlexGridColumn._cellCtxProp]=r),e.prototype._link.call(this)},t}(WjLink);export var CellTemplateType;!function(e){e[e.Cell=0]="Cell",e[e.CellEdit=1]="CellEdit",e[e.ColumnHeader=2]="ColumnHeader",e[e.RowHeader=3]="RowHeader",e[e.RowHeaderEdit=4]="RowHeaderEdit",e[e.TopLeft=5]="TopLeft",e[e.GroupHeader=6]="GroupHeader",e[e.Group=7]="Group",e[e.ColumnFooter=8]="ColumnFooter",e[e.BottomLeft=9]="BottomLeft"}(CellTemplateType||(CellTemplateType={}));var WjFlexGridCellTemplate=function(e){function t(){var t=e.call(this)||this;return t.require=["?^wjFlexGridColumn","?^wjFlexGrid"],t.terminal=!0,WjDirective._dynaTemplates?(t.transclude=!1,t.priority=100,t.template=function(e,t){return t[WjFlexGridColumn._colTemplateProp]=e[0].innerHTML,"<div />"}):(t.transclude=!0,t.template="<div ng-transclude/>"),t}return __extends(t,e),t._getTemplContextProp=function(e){return"$__cellTempl"+CellTemplateType[e]},t.prototype._initControl=function(e){return{}},t.prototype._createLink=function(){return new WjFlexGridCellTemplateLink},t.prototype._getMetaDataId=function(){return"FlexGridCellTemplate"},t._tagName="wj-flex-grid-cell-template",t}(WjDirective);export{WjFlexGridCellTemplate};var WjFlexGridCellTemplateLink=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype._initParent=function(){e.prototype._initParent.call(this);var l,i=this.scope.cellType;if(i){l=CellTemplateType[i];var r=this.tAttrs[WjFlexGridColumn._colTemplateProp],n=null!=r?r:WjDirective._removeTransclude(this.tElement[0].innerHTML),o=this.control;isNullOrWhiteSpace(n)||(o.cellTemplate=n);var a=this.tAttrs.ngStyle,p=this.tAttrs.ngClass;a&&(o.cellStyle=a),p&&(o.cellClass=p),this.tAttrs.forceFullEdit||(o.forceFullEdit=!0);var s=this.tAttrs.autoSizeRows;if(o.autoSizeRows=null==s||"true"===s,o.cellTemplate||o.cellStyle||o.cellClass){o.templLink=this;var c=this.parent.control;c[WjFlexGridCellTemplate._getTemplContextProp(l)]=o,c instanceof wjcGrid.Column&&c._setFlag(wjcGrid.RowColFlags.HasTemplate,!0)}t._invalidateGrid(this.parent.control)}},t.prototype._destroy=function(){var l=this.parent&&this.parent.control,i=this.scope.cellType;e.prototype._destroy.call(this),i&&(l[WjFlexGridCellTemplate._getTemplContextProp(CellTemplateType[i])]=void 0,t._invalidateGrid(l))},t._invalidateGrid=function(e){var t=e;t&&(t instanceof wjcGrid.Column&&(t=t.grid),t&&t.invalidate())},t}(WjLink);