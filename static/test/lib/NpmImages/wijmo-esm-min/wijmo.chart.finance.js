/*!
    *
    * Wijmo Library 5.20191.603
    * http://wijmo.com/
    *
    * Copyright(c) GrapeCity, Inc.  All rights reserved.
    *
    * Licensed under the GrapeCity Commercial License.
    * sales@wijmo.com
    * wijmo.com/products/wijmo-5/license/
    *
    */

var __extends=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function a(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(a.prototype=i.prototype,new a)}}();import{asNumber,asArray,assert,asInt,asType,isUndefined,Rect,Point,DataType,asEnum,asBoolean,isDate,Globalize,_registerModule}from"wijmo/wijmo";import{_FinancePlotter,SeriesBase,_DataPoint,_DataInfo,_BasePlotter,_RectArea,HitTestInfo,ChartElement,_LinesArea,_CircleArea,FlexChartCore,ChartType,FlexChart}from"wijmo/wijmo.chart";import*as selfModule from"wijmo/wijmo.chart.finance";var FinancialSeries=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),Object.defineProperty(e.prototype,"chartType",{get:function(){return this._finChartType},set:function(t){(t=asEnum(t,FinancialChartType,!0))!=this._finChartType&&(this._finChartType=t,this._invalidate())},enumerable:!0,configurable:!0}),e.prototype._getChartType=function(){var t=null;switch(this.chartType){case FinancialChartType.Area:t=ChartType.Area;break;case FinancialChartType.Line:case FinancialChartType.Kagi:case FinancialChartType.PointAndFigure:t=ChartType.Line;break;case FinancialChartType.Column:case FinancialChartType.ColumnVolume:t=ChartType.Column;break;case FinancialChartType.LineSymbols:t=ChartType.LineSymbols;break;case FinancialChartType.Scatter:t=ChartType.Scatter;break;case FinancialChartType.Candlestick:case FinancialChartType.Renko:case FinancialChartType.HeikinAshi:case FinancialChartType.LineBreak:case FinancialChartType.EquiVolume:case FinancialChartType.CandleVolume:case FinancialChartType.ArmsCandleVolume:t=ChartType.Candlestick;break;case FinancialChartType.HighLowOpenClose:t=ChartType.HighLowOpenClose}return t},e.prototype.getDataRect=function(t,e){if(e)return e;var i=this.getValues(0),a=this.getValues(1)||(this.chart._xvals&&this.chart._xvals.length?this.chart._xvals:null),n=this._getBinding(0),r=this._getBinding(1),s=this._getBinding(2),o=this._getBinding(3),l=(this._plotter,this._getChartType()||this.chart._getChartType());if(l!==ChartType.HighLowOpenClose&&l!==ChartType.Candlestick||n===r)return null;if(i){for(var h=NaN,c=NaN,u=NaN,_=NaN,p=i.length,g=0;g<p;g++){var d=this._getItem(g),f=i[g];if(isFinite(f))[f,r?d[r]:null,s?d[s]:null,o?d[o]:null].forEach(function(t){_DataInfo.isValid(t)&&null!==t&&((isNaN(c)||t<c)&&(c=t),(isNaN(_)||t>_)&&(_=t))});if(a){var y=a[g];isFinite(y)&&(isNaN(h)?h=u=y:y<h?h=y:f>_&&(u=y))}}if(a||(h=0,u=p-1),!isNaN(c))return new Rect(h,c,u-h,_-c)}return null},e}(SeriesBase);export{FinancialSeries};export function _trunc(t){return asNumber(t,!0,!1),t>0?Math.floor(t):Math.ceil(t)};export function _sum(t){return arguments.length>1&&(t=Array.prototype.slice.call(arguments)),asArray(t,!1),t.reduce(function(t,e){return t+asNumber(e)},0)};export function _average(t){return arguments.length>1&&(t=Array.prototype.slice.call(arguments)),asArray(t,!1),_sum(t)/t.length};export function _minimum(t){return arguments.length>1&&(t=Array.prototype.slice.call(arguments)),asArray(t,!1),Math.min.apply(null,t)};export function _maximum(t){return arguments.length>1&&(t=Array.prototype.slice.call(arguments)),asArray(t,!1),Math.max.apply(null,t)};export function _variance(t){arguments.length>1&&(t=Array.prototype.slice.call(arguments)),asArray(t,!1);var e=_average(t);return _average(t.map(function(t){return Math.pow(t-e,2)}))};export function _stdDeviation(t){return arguments.length>1&&(t=Array.prototype.slice.call(arguments)),asArray(t,!1),Math.sqrt(_variance(t))};export function _avgTrueRng(t,e,i,a){void 0===a&&(a=14),asArray(t,!1),asArray(e,!1),asArray(i,!1),asInt(a,!1,!0);var n=_trueRng(t,e,i,a),r=Math.min(t.length,e.length,i.length,n.length),s=[];assert(r>a&&a>1,"Average True Range period must be an integer less than the length of the data and greater than one.");for(var o=0;o<r;o++)asNumber(t[o],!1),asNumber(e[o],!1),asNumber(i[o],!1),asNumber(n[o],!1),o+1===a?s.push(_average(n.slice(0,a))):o+1>a&&s.push(((a-1)*s[s.length-1]+n[o])/a);return s};export function _trueRng(t,e,i,a){void 0===a&&(a=14),asArray(t,!1),asArray(e,!1),asArray(i,!1),asInt(a,!1,!0);var n=Math.min(t.length,e.length,i.length),r=[];assert(n>a&&a>1,"True Range period must be an integer less than the length of the data and greater than one.");for(var s=0;s<n;s++)asNumber(t[s],!1),asNumber(e[s],!1),asNumber(i[s],!1),0===s?r.push(t[s]-e[s]):r.push(Math.max(t[s]-e[s],Math.abs(t[s]-i[s-1]),Math.abs(e[s]-i[s-1])));return r};export function _sma(t,e){asArray(t,!1),asNumber(e,!1,!0),assert(t.length>e&&e>1,"Simple Moving Average period must be an integer less than the length of the data and greater than one.");for(var i=[],a=e;a<=t.length;a++)i.push(_average(t.slice(a-e,a)));return i};export function _ema(t,e){asArray(t,!1),asNumber(e,!1,!0),assert(t.length>e&&e>1,"Exponential Moving Average period must be an integer less than the length of the data and greater than one.");var i=[],a=2/(e+1),n=_sma(t,e);t=t.slice(e-1);for(var r=0;r<t.length;r++)0===r?i.push(n[0]):i.push((t[r]-i[r-1])*a+i[r-1]);return i};export function _range(t,e,i){void 0===i&&(i=1),asNumber(t,!1),asNumber(e,!1),asNumber(i,!1),assert(t<e,"begin argument must be less than end argument.");for(var a=[],n=t;n<=e;n+=i)a.push(n);return a};var _BaseCalculator=function(){function t(t,e,i,a){this.highs=t,this.lows=e,this.opens=i,this.closes=a}return t.prototype.calculate=function(){},t}();export{_BaseCalculator};var _HeikinAshiCalculator=function(t){function e(e,i,a,n){return t.call(this,e,i,a,n)||this}return __extends(e,t),e.prototype.calculate=function(){var t,e,i,a,n=Math.min(this.highs.length,this.lows.length,this.opens.length,this.closes.length),r=[];if(n<=0)return r;for(var s=0;s<n;s++)a=_average(this.highs[s],this.lows[s],this.opens[s],this.closes[s]),0===s?(i=_average(this.opens[s],this.closes[s]),t=this.highs[s],e=this.lows[s]):(i=_average(r[s-1].open,r[s-1].close),t=Math.max(this.highs[s],i,a),e=Math.min(this.lows[s],i,a)),r.push({high:t,low:e,close:a,open:i,pointIndex:s,x:null});return r},e}(_BaseCalculator);export{_HeikinAshiCalculator};var _BaseRangeCalculator=function(t){function e(e,i,a,n,r,s,o,l){var h=t.call(this,e,i,a,n)||this;return h.xs=r,h.size=s,h.unit=o,h.fields=l,h}return __extends(e,t),e.prototype._getValues=function(){var t,e=[],i=Math.min(this.highs.length,this.lows.length,this.opens.length,this.closes.length);switch(this.fields){case DataFields.High:e=this.highs;break;case DataFields.Low:e=this.lows;break;case DataFields.Open:e=this.opens;break;case DataFields.HL2:for(t=0;t<i;t++)e.push(_average(this.highs[t],this.lows[t]));break;case DataFields.HLC3:for(t=0;t<i;t++)e.push(_average(this.highs[t],this.lows[t],this.closes[t]));break;case DataFields.HLOC4:for(t=0;t<i;t++)e.push(_average(this.highs[t],this.lows[t],this.opens[t],this.closes[t]));break;case DataFields.Close:default:e=this.closes}return e},e.prototype._getSize=function(){var t=this.unit===RangeMode.ATR?_avgTrueRng(this.highs,this.lows,this.closes,this.size):null;return this.unit===RangeMode.ATR?t[t.length-1]:this.size},e}(_BaseCalculator);export{_BaseRangeCalculator};var _LineBreakCalculator=function(t){function e(e,i,a,n,r,s){return t.call(this,e,i,a,n,r,s)||this}return __extends(e,t),e.prototype.calculate=function(){var t=null!==this.xs&&this.xs.length>0,e=this.closes.length,i=[],a=[[],[]];if(e<=0)return i;for(var n,r,s,o,l,h,c=[],u=1;u<e;u++){if(o=i.length-1,r=t?this.xs[u]:u,s=this.closes[u],-1===o){if((n=this.closes[0])===s)continue}else if(c=this._trendExists(a)||1===this.size?a[0].slice(-this.size).concat(a[1].slice(-this.size)):a[0].slice(1-this.size).concat(a[1].slice(1-this.size)),l=Math.max.apply(null,c),h=Math.min.apply(null,c),s>l)n=Math.max(a[0][o],a[1][o]);else{if(!(s<h))continue;n=Math.min(a[0][o],a[1][o])}a[0].push(n),a[1].push(s),i.push({high:Math.max(n,s),low:Math.min(n,s),open:n,close:s,x:r,pointIndex:u})}return i},e.prototype._trendExists=function(t){if(t[1].length<this.size)return!1;var e,i=!1,a=t[1].slice(-this.size);for(e=1;e<this.size&&(i=a[e]>a[e-1]);e++);if(!i)for(e=1;e<this.size&&(i=a[e]<a[e-1]);e++);return i},e}(_BaseRangeCalculator);export{_LineBreakCalculator};var _KagiCalculator=function(t){function e(e,i,a,n,r,s,o,l){return t.call(this,e,i,a,n,r,s,o,l)||this}return __extends(e,t),e.prototype.calculate=function(){var t,e,i,a,n,r,s,o,l,h=this._getSize(),c=Math.min(this.highs.length,this.lows.length,this.opens.length,this.closes.length),u=this._getValues(),_=null!==this.xs&&this.xs.length>0,p=[],g=[[],[]];if(c<=0)return p;for(var d=1;d<c;d++){if(a=p.length-1,e=_?this.xs[d]:d,l=d,o=!1,this.fields===DataFields.HighLow)if(-1===a)if(this.highs[d]>this.highs[0])i=this.highs[d];else{if(!(this.lows[d]<this.lows[0]))continue;i=this.lows[d]}else if((s=g[1][a]-g[0][a])>0)if(this.highs[d]>g[1][a])i=this.highs[d];else{if(!(this.lows[d]<g[1][a]))continue;i=this.lows[d]}else if(this.lows[d]<g[1][a])i=this.lows[d];else{if(!(this.highs[d]>g[1][a]))continue;i=this.highs[d]}else i=u[d];if(this.unit===RangeMode.Percentage&&(h=i*this.size),-1===a){if(e=_?this.xs[0]:0,l=0,t=this.fields===DataFields.HighLow?null==this.highs[0]?this.highs[this.highs.length-1]:this.highs[0]:null==u[0]?u[u.length-1]:u[0],(s=Math.abs(t-i)||0)<h)continue}else if(s=g[1][a]-g[0][a],r=Math.max(g[0][a],g[1][a]),n=Math.min(g[0][a],g[1][a]),s>0)if(i>r)o=!0;else{if(!((s=r-i)>=h))continue;t=r}else if(i<n)o=!0;else{if(!((s=i-n)>=h))continue;t=n}o?(g[1][a]=i,p[a].close=i,p[a].high=Math.max(p[a].open,p[a].close),p[a].low=Math.min(p[a].open,p[a].close)):(g[0].push(t),g[1].push(i),p.push({high:Math.max(t,i),low:Math.min(t,i),open:t,close:i,x:e,pointIndex:l}))}return p},e}(_BaseRangeCalculator);export{_KagiCalculator};var _RenkoCalculator=function(t){function e(e,i,a,n,r,s,o,l,h){void 0===h&&(h=!1);var c=t.call(this,e,i,a,n,r,s,o,l)||this;return c.rounding=h,c}return __extends(e,t),e.prototype.calculate=function(){var t,e,i,a,n,r,s,o=this._getSize(),l=Math.min(this.highs.length,this.lows.length,this.opens.length,this.closes.length),h=null!==this.xs&&this.xs.length>0,c=this._getValues(),u=[],_=[[],[]];if(l<=0)return u;for(var p=1;p<l;p++){if(a=u.length-1,e=h?this.xs[p]:p,this.fields===DataFields.HighLow)if(-1===a)if(this.highs[p]-this.highs[0]>o)t=this.highs[0],i=this.highs[p];else{if(!(this.lows[0]-this.lows[p]>o))continue;t=this.lows[0],i=this.lows[p]}else if(n=Math.min(_[0][a],_[1][a]),r=Math.max(_[0][a],_[1][a]),this.highs[p]-r>o)t=r,i=this.highs[p];else{if(!(n-this.lows[p]>o))continue;t=n,i=this.lows[p]}else if(i=c[p],-1===a)t=c[0];else if(n=Math.min(_[0][a],_[1][a]),i>(r=Math.max(_[0][a],_[1][a])))t=r;else{if(!(i<n))continue;t=n}if(s=i-t,!(Math.abs(s)<o)){s=_trunc(s/o);for(var g=0;g<Math.abs(s);g++){var d={};this.rounding&&(t=this._round(t,o)),_[0].push(t),d.open=t,t=s>0?t+o:t-o,_[1].push(t),d.close=t,d.x=e,d.pointIndex=p,d.high=Math.max(d.open,d.close),d.low=Math.min(d.open,d.close),u.push(d)}}}return u},e.prototype._round=function(t,e){return Math.round(t/e)*e},e}(_BaseRangeCalculator);export{_RenkoCalculator};var _BaseRangePlotter=function(t){function e(){var e=t.call(this)||this;return e._symFactor=.7,e.clear(),e}return __extends(e,t),e.prototype.clear=function(){t.prototype.clear.call(this),this._rangeValues=null,this._rangeXLabels=null,this._calculator=null},e.prototype.unload=function(){var e,i;t.prototype.unload.call(this);for(var a=0;a<this.chart.series.length;a++)(e=this.chart.series[a])&&(i=e._getAxisX())&&i.itemsSource&&(i.itemsSource=null)},e.prototype.adjustLimits=function(t,e){var i,a,n,r=0,s=0,o=0,l=0,h=this.chart._xDataType===DataType.Date?.5:0;assert(this.chart.series.length<=1,"Current FinancialChartType only supports a single series");for(var c=0;c<this.chart.series.length;c++)i=this.chart.series[c],this._calculate(i),this._rangeValues.length<=0||this._rangeXLabels.length<=0||((a=this._rangeValues.map(function(t){return t.open})).push.apply(a,this._rangeValues.map(function(t){return t.close})),n=this._rangeXLabels.map(function(t){return t.value}),o=Math.min.apply(null,a),l=Math.max.apply(null,a),r=Math.min.apply(null,n),s=Math.max.apply(null,n),i._getAxisX().itemsSource=this._rangeXLabels);return new Rect(r-=h,o,s-r+h,l-o)},e.prototype.plotSeries=function(t,e,i,a,n,r,s){var o=this;this._calculate(a);var l=this.chart.series.indexOf(a),h=this._rangeValues.length,c=e.actualMin,u=e.actualMax,_=this._DEFAULT_WIDTH,p=this._symFactor,g=a._getSymbolFill(l),d=a._getAltSymbolFill(l)||"transparent",f=a._getSymbolStroke(l),y=a._getAltSymbolStroke(l)||f;t.strokeWidth=_;for(var m,v,x,C,b=0,w=this.getItemFormatter(a),k=0;k<h;k++)if(m=k,_DataInfo.isValid(m)&&c<=m&&m<=u){if(v=this._rangeValues[k].open,x=this._rangeValues[k].close,t.fill=v>x?g:d,t.stroke=v>x?f:y,C=this._getDataPoint(l,k,a,Math.max(v,x)),t.startGroup(),w){var F=new HitTestInfo(this.chart,new Point(e.convert(m),i.convert(x)),ChartElement.SeriesSymbol);F._setData(a,k),F._setDataPoint(C),w(t,F,function(){o._drawSymbol(t,e,i,l,b,p,m,v,x,C)})}else this._drawSymbol(t,e,i,l,b,p,m,v,x,C);t.endGroup(),a._setPointIndex(k,b),b++}},e.prototype._drawSymbol=function(t,e,i,a,n,r,s,o,l,h){var c,u,_,p,g;if((_=e.convert(s-.5*r))>(p=e.convert(s+.5*r))){var d=_;_=p,p=d}_DataInfo.isValid(o)&&_DataInfo.isValid(l)&&(o=i.convert(o),l=i.convert(l),u=(c=Math.min(o,l))+Math.abs(o-l),t.drawRect(_,c,p-_,u-c),(g=new _RectArea(new Rect(_,c,p-_,u-c))).tag=h,this.hitTester.add(g,a))},e.prototype._getDataPoint=function(t,e,i,a){var n=new _DataPoint(t,e,e,a),r=i._getItem(this._rangeValues[e].pointIndex),s=i.bindingX||this.chart.bindingX,o=i._getBinding(0),l=i._getBinding(1),h=i._getBinding(2),c=i._getBinding(3),u=i._getAxisY();return n.item=_BasePlotter.cloneStyle(r,[]),n.item[o]=this._rangeValues[e].high,n.item[l]=this._rangeValues[e].low,n.item[h]=this._rangeValues[e].open,n.item[c]=this._rangeValues[e].close,n.y=this._rangeValues[e].close,n.yfmt=u._formatValue(this._rangeValues[e].close),n.x=n.item[s],n.xfmt=this._rangeXLabels[e]._text,n},e.prototype._init=function(){this._rangeValues=[],this._rangeXLabels=[]},e.prototype._calculate=function(t){},e.prototype._generateXLabels=function(t){var e,i=this,a=t._getAxisX(),n=t.getDataType(1)||this.chart._xDataType;this._rangeValues.forEach(function(t,r){var s=t.x;e=n===DataType.Date?Globalize.format(FlexChart._fromOADate(s),a.format||"d"):n===DataType.Number?a._formatValue(s):null!==n&&n!==DataType.String||!i.chart._xlabels?s.toString():i.chart._xlabels[s],i._rangeXLabels.push({value:r,text:e,_text:e})},this)},e}(_BasePlotter);export{_BaseRangePlotter};export var DataFields;!function(t){t[t.Close=0]="Close",t[t.High=1]="High",t[t.Low=2]="Low",t[t.Open=3]="Open",t[t.HighLow=4]="HighLow",t[t.HL2=5]="HL2",t[t.HLC3=6]="HLC3",t[t.HLOC4=7]="HLOC4"}(DataFields||(DataFields={}));export var RangeMode;!function(t){t[t.Fixed=0]="Fixed",t[t.ATR=1]="ATR",t[t.Percentage=2]="Percentage"}(RangeMode||(RangeMode={}));export var PointAndFigureScaling;!function(t){t[t.Traditional=0]="Traditional",t[t.Fixed=1]="Fixed",t[t.Dynamic=2]="Dynamic"}(PointAndFigureScaling||(PointAndFigureScaling={}));var _PointAndFigurePlotter=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.clear=function(){t.prototype.clear.call(this),this._boxSize=null,this._fields=null,this._reversal=null,this._scaling=null},e.prototype.unload=function(){t.prototype.unload.call(this),this.chart.axisX.itemsSource=this._xlbls},e.prototype._init=function(){this._boxSize=this.getNumOption("boxSize","pointAndFigure")||1,this._reversal=this.getNumOption("reversal","pointAndFigure")||3,this._period=this.getNumOption("period","pointAndFigure")||20,this._fields=this.getOption("fields","pointAndFigure")||DataFields.Close,this._fields=asEnum(this._fields,DataFields,!0),assert(this._fields==DataFields.Close||this._fields==DataFields.HighLow,"Only DataFields.Close and DataFields.HighLow are supported"),this._scaling=this.getOption("scaling","pointAndFigure")||PointAndFigureScaling.Traditional,this._scaling=asEnum(this._scaling,PointAndFigureScaling,!0),this._xlbls=[]},e.prototype.adjustLimits=function(t,e){this._init(),this.hitTester.clear();var i=new Rect(0,0,0,0),a=this.chart.series.length;if(assert(a<=1,"Current FinancialChartType only supports a single series"),a>0){var n=this.chart.series[0],r=this._reversal,s=n.collectionView?n.collectionView:this.chart.collectionView,o=s?s.items:null;if(o&&o.length>0){var l=n._getBinding(0),h=n._getBinding(1),c=n._getBinding(2),u=n._getBinding(3);this._fields==DataFields.Close&&(u?l=u:c&&(l=c),h=l);var _=n.bindingX?n.bindingX:this.chart.bindingX,p=this._actualBoxSize=this.calcBoxSize(o,l,h);if(this._pfdata=this.calcPFHiLo2(o,l,h,_,p,r),this._pfdata&&this._pfdata.length>0){var g=this._pfdata.reduce(function(t,e){return Math.max(t,e.max)},this._pfdata[0].max),d=this._pfdata.reduce(function(t,e){return Math.min(t,e.min)},this._pfdata[0].min);i=new Rect(-.5,d-.5*p,this._pfdata.length,g-d+p);for(var f=1;f<this._pfdata.length;f++){var y=this._pfdata[f-1],m=this._pfdata[f];isDate(m.date)&&isDate(y.date)&&m.date.getYear()!=y.date.getYear()&&this._xlbls.push({value:f,text:Globalize.formatNumber(m.date.getFullYear()%100,"d2")})}}}}return 0==this._xlbls.length&&this._xlbls.push({value:0}),this.axisYMajorGrid=this.chart.axisY.majorGrid,this.chart.axisY.majorGrid=!1,this.chart.axisX.itemsSource=this._xlbls,i},e.prototype.plotSeries=function(t,e,i,a,n,r,s){if(this._pfdata&&this._pfdata.length>0){var o=this._actualBoxSize;this.renderGrid(t,this._pfdata,o),this.renderData(this.chart,t,this._pfdata,o)}this.chart.axisY.majorGrid=this.axisYMajorGrid},e.prototype.calcBoxSize=function(t,e,i){var a=t.reduce(function(t,i){return Math.max(t,i[e])},t[0][e]),n=t.reduce(function(t,e){return Math.min(t,e[i])},t[0][i]),r=this._boxSize,s=a-n;switch(this._scaling){case PointAndFigureScaling.Traditional:s<.25?r=.0625:s>=.25&&s<1?r=.125:s>=1&&s<5?r=.25:s>=5&&s<20?r=.5:s>=20&&s<100?r=1:s>=100&&s<200?r=2:s>=200&&s<500?r=4:s>=500&&s<1e3?r=5:s>=1e3&&s<25e3?r=50:s>-25e3&&(r=500);break;case PointAndFigureScaling.Dynamic:var o=this.chart.series[0],l=o._getBindingValues(0),h=o._getBindingValues(1),c=(o._getBindingValues(2),_avgTrueRng(l,h,o._getBindingValues(3),this._period));r=c[c.length-1];break;case PointAndFigureScaling.Fixed:}return r},e.prototype.calcPFHiLo2=function(t,e,i,a,n,r){for(var s=[],o=0;o<t.length;o++){var l=t[o][e],h=t[o][i];assert(l>=h,"'High' value must be larger than 'low' value.");var c=t[o][a];if(0==s.length)s.push({min:this.roundDown(h,n),max:this.roundDown(l,n),rise:!1,date:c});else{var u=s[s.length-1];if(u.rise){var _=u.max+n,p=u.max-r*n;this.roundUp(l,n)>=_?u.max=this.roundUp(l,n):h<=p&&s.push({min:this.roundDown(h,n),max:u.max-n,rise:!1,date:c})}else{_=u.min-n,p=u.min+r*n;this.roundDown(h,n)<=_?u.min=this.roundDown(h,n):l>=p&&s.push({min:u.min+n,max:this.roundUp(l,n),rise:!0,date:c})}}}if(s.length>0){var g=s[0];g.min==g.max&&s.splice(0,1)}return s},e.prototype.roundUp=function(t,e){return Math.ceil(t/e-.999999)*e},e.prototype.roundDown=function(t,e){return Math.floor(t/e+.999999)*e},e.prototype.renderGrid=function(t,e,i){if(this._pfdata){for(var a=this._pfdata.reduce(function(t,e){return Math.max(t,e.max)},this._pfdata[0].max),n=this._pfdata.reduce(function(t,e){return Math.min(t,e.min)},this._pfdata[0].min),r=this.chart,s=this._pfdata.length,o=n-.5*i;o<=a+i;o+=i){var l=new Point(-.5,o);l=r.dataToPoint(l);var h=new Point(s,o);h=r.dataToPoint(h),t.stroke=FlexChartCore._FG,t.strokeWidth=1,t.drawLine(l.x,l.y,h.x,h.y,FlexChartCore._CSS_GRIDLINE)}for(var c=-.5;c<=s;c+=1){l=new Point(c,this.chart.axisY.actualMin);l=r.dataToPoint(l);h=new Point(c,this.chart.axisY.actualMax);h=r.dataToPoint(h),t.stroke=FlexChartCore._FG,t.strokeWidth=1,t.drawLine(l.x,l.y,h.x,h.y,FlexChartCore._CSS_GRIDLINE)}}},e.prototype.renderData=function(t,e,i,a){for(var n=t.series[0],r=n._getSymbolStroke(0),s=n._getAltSymbolStroke(0)||r,o=0;o<i.length;o++){var l=i[o],h=(i[o].max-i[o].min)/a;if(0!=h){var c=new Point(o-.5,l.min);c=t.dataToPoint(c);var u=new Point(o+.5,l.max);u=t.dataToPoint(u),e.fill="transparent";for(var _=(u.y-c.y)/h,p=0;p<h+1;p++)if(e.strokeWidth=1.5,l.rise?(e.stroke=r,e.drawLine(c.x,c.y+(p-.5)*_,u.x,c.y+(p+.5)*_),e.drawLine(u.x,c.y+(p-.5)*_,c.x,c.y+(p+.5)*_)):(e.stroke=s,e.drawEllipse(.5*(c.x+u.x),c.y+p*_,.5*Math.abs(c.x-u.x),.5*Math.abs(_))),this.hitTester){var g=l.min+p*a,d=new _DataPoint(0,o,l.date,g);d.y=g,d.yfmt=this.chart.axisY._formatValue(g),isDate(l.date)&&(d.x=l.date,d.xfmt=Globalize.formatDate(l.date,"d"));var f=new Rect(Math.min(c.x,u.x),c.y+p*_-.5*_,Math.abs(u.x-c.x),_);f.height<0&&(f.top+=_,f.height=-f.height);var y=new _RectArea(f);y.tag=d,this.hitTester.add(y,0)}}}},e}(_BasePlotter);export{_PointAndFigurePlotter};var _KagiPlotter=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype._calculate=function(t){this._init();var e=t._getBindingValues(0),i=t._getBindingValues(1),a=t._getBindingValues(2),n=t._getBindingValues(3),r=t.getValues(1)||this.chart._xvals;this._calculator=new _KagiCalculator(e,i,a,n,r,this._reversalAmount,this._rangeMode,this._fields),this._rangeValues=this._calculator.calculate(),(null===this._rangeValues||isUndefined(this._rangeValues))&&(this._rangeValues=[]),this._generateXLabels(t)},e.prototype.plotSeries=function(t,e,i,a,n,r,s){this._calculate(a);var o=this.chart.series.indexOf(a),l=this._rangeValues.length,h=e.actualMin,c=e.actualMax,u=this._DEFAULT_WIDTH,_=a._getSymbolStroke(o),p=a._getAltSymbolStroke(o)||_,g=[],d=[];t.stroke=_,t.strokeWidth=u;var f,y,m,v,x,C,b,w=0;t.startGroup();for(var k=0;k<l;k++)f=k,_DataInfo.isValid(f)&&h<=f&&f<=c&&(y=this._rangeValues[k].open,m=this._rangeValues[k].close,0===k?(v=Math.min(y,m),x=Math.max(y,m),t.strokeWidth=y>m?u:2*u,t.stroke=y>m?_:p,t.drawLine(e.convert(f),i.convert(y),e.convert(f),i.convert(m)),t.drawLine(e.convert(f-1)-t.strokeWidth/2,i.convert(y),e.convert(f)+t.strokeWidth/2,i.convert(y))):t.strokeWidth===u?m>y?(m>x?(t.drawLine(e.convert(f),i.convert(y),e.convert(f),i.convert(x)),t.strokeWidth=2*u,t.stroke=p,t.drawLine(e.convert(f),i.convert(x),e.convert(f),i.convert(m)),v=y):t.drawLine(e.convert(f),i.convert(y),e.convert(f),i.convert(m)),x=m):t.drawLine(e.convert(f),i.convert(y),e.convert(f),i.convert(m)):t.strokeWidth/2===u&&(m<y?(m<v?(t.drawLine(e.convert(f),i.convert(y),e.convert(f),i.convert(v)),t.strokeWidth=u,t.stroke=_,t.drawLine(e.convert(f),i.convert(v),e.convert(f),i.convert(m)),x=y):t.drawLine(e.convert(f),i.convert(y),e.convert(f),i.convert(m)),v=m):t.drawLine(e.convert(f),i.convert(y),e.convert(f),i.convert(m))),k<l-1&&t.drawLine(e.convert(f)-t.strokeWidth/2,i.convert(m),e.convert(f+1)+t.strokeWidth/2,i.convert(m)),b=this._getDataPoint(o,k,a,m),(C=new _CircleArea(new Point(e.convert(f),i.convert(m)),.5*t.strokeWidth)).tag=b,this.hitTester.add(C,o),a._setPointIndex(k,w),w++,g.push(e.convert(f)),d.push(i.convert(y)),g.push(e.convert(f)),d.push(i.convert(m)));t.endGroup(),this.hitTester.add(new _LinesArea(g,d),o)},e.prototype._init=function(){t.prototype._init.call(this),this._reversalAmount=this.getNumOption("reversalAmount","kagi")||14,this._rangeMode=this.getOption("rangeMode","kagi")||RangeMode.Fixed,this._rangeMode=asEnum(this._rangeMode,RangeMode,!0),this._fields=this.getOption("fields","kagi")||DataFields.Close,this._fields=asEnum(this._fields,DataFields,!0)},e.prototype.clear=function(){t.prototype.clear.call(this),this._reversalAmount=null,this._rangeMode=null},e}(_BaseRangePlotter);export{_KagiPlotter};var _RenkoPlotter=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.clear=function(){t.prototype.clear.call(this),this._boxSize=null,this._rangeMode=null},e.prototype._calculate=function(t){this._init();var e=t._getBindingValues(0),i=t._getBindingValues(1),a=t._getBindingValues(2),n=t._getBindingValues(3),r=t.getValues(1)||this.chart._xvals;this._calculator=new _RenkoCalculator(e,i,a,n,r,this._boxSize,this._rangeMode,this._fields,this._rounding),this._rangeValues=this._calculator.calculate(),(null===this._rangeValues||isUndefined(this._rangeValues))&&(this._rangeValues=[]),this._generateXLabels(t)},e.prototype._init=function(){t.prototype._init.call(this),this._boxSize=this.getNumOption("boxSize","renko")||14,this._rangeMode=this.getOption("rangeMode","renko")||RangeMode.Fixed,this._rangeMode=asEnum(this._rangeMode,RangeMode,!0),assert(this._rangeMode!==RangeMode.Percentage,"RangeMode.Percentage is not supported"),this._fields=this.getOption("fields","renko")||DataFields.Close,this._fields=asEnum(this._fields,DataFields,!0),assert(this._fields!==DataFields.HighLow,"DataFields.HighLow is not supported"),this._rounding=asBoolean(this.getOption("rounding","renko"),!0)},e.prototype._generateXLabels=function(e){var i=this;t.prototype._generateXLabels.call(this,e),this._rangeXLabels.forEach(function(t,e){e>0&&i._rangeXLabels[e-1]._text===t.text&&(t.text="")},this)},e}(_BaseRangePlotter);export{_RenkoPlotter};var _LineBreakPlotter=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.clear=function(){t.prototype.clear.call(this),this._newLineBreaks=null},e.prototype._calculate=function(t){this._init();var e=t._getBindingValues(3),i=t.getValues(1)||this.chart._xvals;this._calculator=new _LineBreakCalculator(null,null,null,e,i,this._newLineBreaks),this._rangeValues=this._calculator.calculate(),(null===this._rangeValues||isUndefined(this._rangeValues))&&(this._rangeValues=[]),this._generateXLabels(t)},e.prototype._init=function(){t.prototype._init.call(this),this._newLineBreaks=asInt(this.getNumOption("newLineBreaks","lineBreak"),!0,!0)||3,assert(this._newLineBreaks>=1,"Value must be greater than 1")},e}(_BaseRangePlotter);export{_LineBreakPlotter};var _HeikinAshiPlotter=function(t){function e(){var e=t.call(this)||this;return e._symFactor=.7,e.clear(),e}return __extends(e,t),e.prototype.clear=function(){t.prototype.clear.call(this),this._haValues=null,this._calculator=null},e.prototype.plotSeries=function(t,e,i,a,n,r,s){var o=this;this._calculate(a);var l=asType(a,SeriesBase),h=this.chart.series.indexOf(a),c=a.getValues(1),u=this._symFactor,_=this._haValues.length,p=!0;if(c){var g=this.dataInfo.getDeltaX();g>0&&(u*=g)}else c=this.dataInfo.getXVals();c?_=Math.min(_,c.length):(p=!1,c=new Array(_));var d=this._DEFAULT_WIDTH,f=l._getSymbolFill(h),y=l._getAltSymbolFill(h)||"transparent",m=l._getSymbolStroke(h),v=l._getAltSymbolStroke(h)||m,x=u,C=a.getDataType(1)||a.chart._xDataType;t.strokeWidth=d;for(var b,w,k,F,P,T,V,A,M=e.actualMin,L=e.actualMax,D=0,S=this.getItemFormatter(a),B=0;B<_;B++)if(k=p?c[B]:B,_DataInfo.isValid(k)&&M<=k&&k<=L){if(P=this._haValues[B].high,T=this._haValues[B].low,V=this._haValues[B].open,A=this._haValues[B].close,b=V<A?y:f,w=V<A?v:m,t.fill=b,t.stroke=w,t.startGroup(),F=this._getDataPoint(h,B,k,a),S){var R=new HitTestInfo(this.chart,new Point(e.convert(k),i.convert(P)),ChartElement.SeriesSymbol);R._setData(l,B),R._setDataPoint(F),S(t,R,function(){o._drawSymbol(t,e,i,h,B,b,x,k,P,T,V,A,F,C)})}else this._drawSymbol(t,e,i,h,B,b,x,k,P,T,V,A,F,C);t.endGroup(),a._setPointIndex(B,D),D++}},e.prototype._drawSymbol=function(t,e,i,a,n,r,s,o,l,h,c,u,_,p){var g,d=null,f=null,y=null,m=null,v=p===DataType.Date?432e5:.5;if((y=e.convert(o-v*s))>(m=e.convert(o+v*s))){var x=y;y=m,m=x}o=e.convert(o),_DataInfo.isValid(c)&&_DataInfo.isValid(u)&&(c=i.convert(c),u=i.convert(u),f=(d=Math.min(c,u))+Math.abs(c-u),t.drawRect(y,d,m-y,f-d),(g=new _RectArea(new Rect(y,d,m-y,f-d))).tag=_,this.hitTester.add(g,a)),_DataInfo.isValid(l)&&(l=i.convert(l),null!==d&&(t.drawLine(o,d,o,l),g.rect.top=l,g.rect.height=g.rect.height+l)),_DataInfo.isValid(h)&&(h=i.convert(h),null!==f&&(t.drawLine(o,f,o,h),g.rect.height=g.rect.height+h))},e.prototype._getDataPoint=function(t,e,i,a){var n=new _DataPoint(t,e,i,this._haValues[e].high),r=a._getItem(e),s=a._getBinding(0),o=a._getBinding(1),l=a._getBinding(2),h=a._getBinding(3),c=a._getAxisY();return null!=r&&(n.item=_BasePlotter.cloneStyle(r,[]),n.item[s]=this._haValues[e].high,n.item[o]=this._haValues[e].low,n.item[l]=this._haValues[e].open,n.item[h]=this._haValues[e].close),n.y=this._haValues[e].high,n.yfmt=c._formatValue(this._haValues[e].high),n},e.prototype._calculate=function(t){var e=t._getBindingValues(0),i=t._getBindingValues(1),a=t._getBindingValues(2),n=t._getBindingValues(3);this._calculator=new _HeikinAshiCalculator(e,i,a,n),this._haValues=this._calculator.calculate(),(null===this._haValues||isUndefined(this._haValues))&&this._init()},e.prototype._init=function(){this._haValues=[]},e}(_FinancePlotter);export{_HeikinAshiPlotter};export var FinancialChartType;!function(t){t[t.Column=0]="Column",t[t.Scatter=1]="Scatter",t[t.Line=2]="Line",t[t.LineSymbols=3]="LineSymbols",t[t.Area=4]="Area",t[t.Candlestick=5]="Candlestick",t[t.HighLowOpenClose=6]="HighLowOpenClose",t[t.HeikinAshi=7]="HeikinAshi",t[t.LineBreak=8]="LineBreak",t[t.Renko=9]="Renko",t[t.Kagi=10]="Kagi",t[t.ColumnVolume=11]="ColumnVolume",t[t.EquiVolume=12]="EquiVolume",t[t.CandleVolume=13]="CandleVolume",t[t.ArmsCandleVolume=14]="ArmsCandleVolume",t[t.PointAndFigure=15]="PointAndFigure"}(FinancialChartType||(FinancialChartType={}));var FinancialChart=function(t){function e(e,i){var a=t.call(this,e,null)||this;return a._chartType=FinancialChartType.Line,a.__heikinAshiPlotter=null,a.__lineBreakPlotter=null,a.__renkoPlotter=null,a.__kagiPlotter=null,a.__pfPlotter=null,a.initialize(i),a}return __extends(e,t),e.prototype._getProductInfo=function(){return"A78U,FinancialChart"},Object.defineProperty(e.prototype,"chartType",{get:function(){return this._chartType},set:function(t){(t=asEnum(t,FinancialChartType))!=this._chartType&&(this._chartType=t,this.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"options",{get:function(){return this._options},set:function(t){t!=this._options&&(this._options=t,this.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"_heikinAshiPlotter",{get:function(){return null===this.__heikinAshiPlotter&&(this.__heikinAshiPlotter=new _HeikinAshiPlotter,this._initPlotter(this.__heikinAshiPlotter)),this.__heikinAshiPlotter},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"_lineBreakPlotter",{get:function(){return null===this.__lineBreakPlotter&&(this.__lineBreakPlotter=new _LineBreakPlotter,this._initPlotter(this.__lineBreakPlotter)),this.__lineBreakPlotter},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"_renkoPlotter",{get:function(){return null===this.__renkoPlotter&&(this.__renkoPlotter=new _RenkoPlotter,this._initPlotter(this.__renkoPlotter)),this.__renkoPlotter},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"_kagiPlotter",{get:function(){return null===this.__kagiPlotter&&(this.__kagiPlotter=new _KagiPlotter,this._initPlotter(this.__kagiPlotter)),this.__kagiPlotter},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"_pfPlotter",{get:function(){return null===this.__pfPlotter&&(this.__pfPlotter=new _PointAndFigurePlotter,this._initPlotter(this.__pfPlotter)),this.__pfPlotter},enumerable:!0,configurable:!0}),e.prototype._getChartType=function(){var t=null;switch(this.chartType){case FinancialChartType.Area:t=ChartType.Area;break;case FinancialChartType.Line:case FinancialChartType.Kagi:case FinancialChartType.PointAndFigure:t=ChartType.Line;break;case FinancialChartType.Column:case FinancialChartType.ColumnVolume:t=ChartType.Column;break;case FinancialChartType.LineSymbols:t=ChartType.LineSymbols;break;case FinancialChartType.Scatter:t=ChartType.Scatter;break;case FinancialChartType.Candlestick:case FinancialChartType.Renko:case FinancialChartType.HeikinAshi:case FinancialChartType.LineBreak:case FinancialChartType.EquiVolume:case FinancialChartType.CandleVolume:case FinancialChartType.ArmsCandleVolume:t=ChartType.Candlestick;break;case FinancialChartType.HighLowOpenClose:t=ChartType.HighLowOpenClose}return t},e.prototype._getPlotter=function(e){var i=this.chartType,a=null;if(e){var n=e.chartType;n&&!isUndefined(n)&&n!=i&&(i=n,!0)}switch(i){case FinancialChartType.HeikinAshi:a=this._heikinAshiPlotter;break;case FinancialChartType.LineBreak:a=this._lineBreakPlotter;break;case FinancialChartType.Renko:a=this._renkoPlotter;break;case FinancialChartType.Kagi:a=this._kagiPlotter;break;case FinancialChartType.ColumnVolume:(a=t.prototype._getPlotter.call(this,e)).isVolume=!0,a.width=1;break;case FinancialChartType.EquiVolume:(a=t.prototype._getPlotter.call(this,e)).isEqui=!0,a.isCandle=!1,a.isArms=!1,a.isVolume=!0,a.symbolWidth="100%";break;case FinancialChartType.CandleVolume:(a=t.prototype._getPlotter.call(this,e)).isEqui=!1,a.isCandle=!0,a.isArms=!1,a.isVolume=!0,a.symbolWidth="100%";break;case FinancialChartType.ArmsCandleVolume:(a=t.prototype._getPlotter.call(this,e)).isEqui=!1,a.isCandle=!1,a.isArms=!0,a.isVolume=!0,a.symbolWidth="100%";break;case FinancialChartType.PointAndFigure:a=this._pfPlotter;break;default:a=t.prototype._getPlotter.call(this,e)}return a},e.prototype._createSeries=function(){return new FinancialSeries},e}(FlexChartCore);export{FinancialChart};_registerModule("wijmo.chart.finance",selfModule);